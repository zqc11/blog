(function(t){function e(e){for(var i,s,r=e[0],a=e[1],h=e[2],u=0,c=[];u<r.length;u++)s=r[u],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&c.push(o[s][0]),o[s]=0;for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(t[i]=a[i]);d&&d(e);while(c.length)c.shift()();return l.push.apply(l,h||[]),n()}function n(){for(var t,e=0;e<l.length;e++){for(var n=l[e],i=!0,r=1;r<n.length;r++){var a=n[r];0!==o[a]&&(i=!1)}i&&(l.splice(e--,1),t=s(s.s=n[0]))}return t}var i={},o={app:0},l=[];function s(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=i,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(n,i,function(e){return t[e]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],a=r.push.bind(r);r.push=e,r=r.slice();for(var h=0;h<r.length;h++)e(r[h]);var d=a;l.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";n("85ec")},"56d7":function(t,e,n){"use strict";n.r(e);n("f225"),n("450d");var i=n("89a9"),o=n.n(i),l=(n("10cb"),n("f3ad")),s=n.n(l),r=(n("eca7"),n("3787")),a=n.n(r),h=(n("425f"),n("4105")),d=n.n(h),u=(n("0fb4"),n("9944")),c=n.n(u),f=(n("1951"),n("eedf")),p=n.n(f),g=(n("f4f9"),n("c2cc")),y=n.n(g),x=(n("7a0f"),n("0f6c")),w=n.n(x),v=(n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("b0c0"),n("2b0e")),S=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("AddFlow")],1)},m=[],b=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Menu",{ref:"menu",on:{download:t.download,upload:t.upload,command:t.command}}),n("el-row",{staticClass:"margin-10",attrs:{gutter:10,justify:"center",type:"flex"}},[n("el-col",{attrs:{span:4}},[n("draggable",{attrs:{id:"components",tag:"div",list:t.elements,group:{name:"addflow",pull:"clone",put:!1},move:t.moveNode,"drag-class":"ghost"},on:{end:t.addNewNode}},t._l(t.elements,(function(e){return n("div",{key:e.id,staticClass:"component-item no-user-select"},[t._v(" "+t._s(e.text)+" ")])})),0)],1),n("el-col",{attrs:{span:20}},[n("draggable",{attrs:{id:"canvas-wrapper",tag:"div",list:t.list,group:"addflow",draggable:".drag"}},[n("canvas",{ref:"canvas",attrs:{height:"800",width:"800"}})])],1)],1),n("drawer-box",{ref:"drawer",attrs:{flow:t.flow}})],1)},k=[],M=n("b85c"),P=(n("bf19"),n("d3b7"),n("3ca3"),n("ddb0"),n("2b3d"),n("9861"),n("6e12")),A=n.n(P),z=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"no-user-select"},[n("el-row",{staticClass:"align-center",attrs:{gutter:.5,type:"flex",align:"middle"}},[n("el-col",{attrs:{span:.5}},[n("el-button",{attrs:{icon:"el-icon-refresh-left",size:"mini"},on:{click:t.undo}})],1),n("el-col",{attrs:{span:.5}},[n("el-button",{attrs:{icon:"el-icon-refresh-right",size:"mini"},on:{click:t.redo}})],1),n("el-col",{attrs:{span:.5}},[n("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:t.refresh}})],1),n("el-col",{attrs:{span:.5}},[n("el-button",{attrs:{icon:"el-icon-delete",size:"mini"},on:{click:t.deleteNode}})],1),n("el-col",{attrs:{span:.5}},[n("el-button",{attrs:{icon:"el-icon-zoom-in",size:"mini"},on:{click:t.zoomIn}})],1),n("el-col",{attrs:{span:.5}},[n("el-button",{attrs:{icon:"el-icon-zoom-out",size:"mini"},on:{click:t.zoomOut}})],1),n("el-col",{attrs:{span:1.5}},[n("el-upload",{staticClass:"upload-demo",attrs:{accept:".json",action:"",limit:1,"file-list":t.fileList,"on-change":t.upload,"auto-upload":!1,"show-file-list":!1}},[n("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")])],1)],1),n("el-col",{attrs:{span:1.5}},[n("el-button",{attrs:{size:"small",type:"success"},on:{click:t.download}},[t._v("点击下载")])],1)],1)],1)},_=[],L=n("1da1"),I=(n("96cf"),{name:"Menu",data:function(){return{fileList:[]}},methods:{download:function(){this.$emit("download")},upload:function(t,e){var n=this;console.log("upload"),this.fileList=[];var i=new FileReader;i.onload=function(){var t=Object(L["a"])(regeneratorRuntime.mark((function t(e){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:try{i=e.target.result,n.$emit("upload",i)}catch(o){console.log("load JSON document from file error: ".concat(o.message)),n.fileList=[],alert("填充失败，请重新选择文件或手动输入。")}case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),i.readAsText(t.raw)},undo:function(){this.$emit("command","undo")},redo:function(){this.$emit("command","redo")},refresh:function(){this.$emit("command","refresh")},deleteNode:function(){this.$emit("command","delete")},zoomIn:function(){this.$emit("command","zoom-in")},zoomOut:function(){this.$emit("command","zoom-out")}}}),O=I,C=(n("cb84"),n("2877")),T=Object(C["a"])(O,z,_,!1,null,"80dab468",null),D=T.exports,R=(n("ac1f"),n("5319"),n("1276"),n("a15b"),n("fb6a"),n("a434"),n("cb29"),n("99af"),n("9911"),{Flow:function(t){var e,n,i,o,l,s,r,a,h,d,u,c,f,p,g,y,x,w,v,S,m,b,k,M,P,A,z,_,L,I,O,C,T,D,R,F,N,H,j,W,B,E,G,X,Y,U,q,$,J,K,Q,Z,V,tt,et,nt,it,ot,lt,st,rt,at,ht,dt,ut,ct,ft,pt,gt,yt,xt,wt,vt,St,mt,bt,kt,Mt,Pt,At,zt,_t,Lt,It,Ot,Ct;function Tt(){var t,e,n,i,o,l,s;function r(t,e){var n,i,o,l,s,r,a,h,d;if(!(e.length<=2)){n=!0;while(n)for(n=!1,d=1;d<e.length-1;d++)if(i=e[d-1],o=e[d],l=e[d+1],i.y===o.y&&o.y===l.y||i.x===o.x&&o.x===l.x){e.splice(d,1),n=!0;break}for(d=0;d<e.length;d++)t.push(e[d]);2===e.length&&(s=t[0],h=t[1],s.y===h.y?(r={x:s.x+(h.x-s.x)/2,y:s.y},a={x:h.x-(h.x-s.x)/2,y:h.y}):(r={x:s.x,y:s.y+(h.y-s.y)/2},a={x:h.x,y:h.y-(h.y-s.y)/2}),t.splice(1,0,r),t.splice(2,0,a))}}function a(t,e,n){return t=t.inflate(-1,-1),t.intersectsWith(yt.getRectByTwoPoints(e,n))}function h(t,e,n){var i,o;for(o=!0,i=0;i<n.length;i++)if(a(n[i],t,e)){o=!1;break}return o}function d(t,e,n){var i;switch(n){case"left":i={x:e.left,y:t.y};break;case"top":i={x:t.x,y:e.top};break;case"right":i={x:e.left+e.width,y:t.y};break;case"bottom":i={x:t.x,y:e.top+e.height};break;default:break}return i}function u(t,e){var n="none";return t.x===e.x?n=t.y>=e.y?"bottom":"top":t.y===e.y&&(n=t.x>=e.x?"right":"left"),n}function c(t,e){var n,i,o,l,s,r,a;return i=ie(t),o=Math.abs(e.x-i.left),l=Math.abs(e.x-(i.left+i.width)),s=Math.abs(e.y-i.top),r=Math.abs(e.y-(i.top+i.height)),a=Math.min(Math.min(Math.min(o,l),s),r),n=a===o?"left":a===l?"right":a===s?"top":"bottom",n}function f(t,e){switch(t){case"left":n={x:e.left+e.width,y:e.top},i={x:e.left+e.width,y:e.top+e.height};break;case"top":n={x:e.left,y:e.top+e.height},i={x:e.left+e.width,y:e.top+e.height};break;case"right":n={x:e.left,y:e.top},i={x:e.left,y:e.top+e.height};break;case"bottom":n={x:e.left,y:e.top},i={x:e.left+e.width,y:e.top};break;default:break}}function p(t,e){switch(t){case"left":n={x:e.left,y:e.top},i={x:e.left,y:e.top+e.height};break;case"top":n={x:e.left,y:e.top},i={x:e.left+e.width,y:e.top};break;case"right":n={x:e.left+e.width,y:e.top},i={x:e.left+e.width,y:e.top+e.height};break;case"bottom":n={x:e.left,y:e.top+e.height},i={x:e.left+e.width,y:e.top+e.height};break;default:break}}function g(e,o,l,s){return p(t,o),l.containsPoint(n)?(!1,i):l.containsPoint(i)||yt.getPointsDistance(n,e)<=yt.getPointsDistance(i,e)?(!0,n):(!1,i)}function y(t,s,r,a){var d,u;return p(e,a),o=n,l=i,d=h(t,o,[r,a]),u=h(t,l,[r,a]),d?u?a.containsPoint(o)?l:a.containsPoint(l)||yt.getPointsDistance(o,s)<=yt.getPointsDistance(l,s)?o:l:o:u?l:{x:void 0,y:void 0}}function x(t,e,n){return!!h(t,{x:e.left,y:e.top},n)||(!!h(t,{x:e.left+e.width,y:e.top},n)||(!!h(t,{x:e.left,y:e.top+e.height},n)||!!h(t,{x:e.left+e.width,y:e.top+e.height},n)))}function w(t,e){var n=ie(t);return n=n.inflate(e,e),n}function v(n,i,o,l){var s={x:0,y:0},r={x:0,y:0};switch(t){case"left":s={x:n.x+l,y:n.y};break;case"top":s={x:n.x,y:n.y+l};break;case"right":s={x:n.x-l,y:n.y};break;case"bottom":s={x:n.x,y:n.y-l};break;default:break}switch(e){case"left":r={x:i.x+l,y:i.y};break;case"top":r={x:i.x,y:i.y+l};break;case"right":r={x:i.x-l,y:i.y};break;case"bottom":r={x:i.x,y:i.y-l};break;default:break}o.splice(0,0,s),o.push(r)}function S(n,i){var o,l,s,r,a,d,c,f,p;for(f=[],p=0,o=0;o<n.length;o++)if(o>=p){for(s=n.length-1;s>o;s--)if(h(n[o],n[s],i)){p=s;break}f.push(n[o])}for(l=0;l<f.length-1;l++)if(f[l].x!==f[l+1].x&&f[l].y!==f[l+1].y){if(r=0===l?t:u(f[l],f[l-1]),a=l===f.length-2?e:u(f[l+1],f[l+2]),("left"===r||"right"===r)&&("left"===a||"right"===a))return d=Math.min(f[l].x,f[l+1].x)+Math.abs(f[l].x-f[l+1].x)/2,f.splice(l+1,0,{x:d,y:f[l].y}),f.splice(l+2,0,{x:d,y:f[l+2].y}),f.length-1>l+3&&f.splice(l+3,1),f;if(("top"===r||"bottom"===r)&&("top"===a||"bottom"===a))return c=Math.min(f[l].y,f[l+1].y)+Math.abs(f[l].y-f[l+1].y)/2,f.splice(l+1,0,{x:f[l].x,y:c}),f.splice(l+2,0,{x:f[l+2].x,y:c}),f.length-1>l+3&&f.splice(l+3,1),f;if(("left"===r||"right"===r)&&("top"===a||"bottom"===a))return f.splice(l+1,0,{x:f[l+1].x,y:f[l].y}),f;if(("top"===r||"bottom"===r)&&("left"===a||"right"===a))return f.splice(l+1,0,{x:f[l].x,y:f[l+1].y}),f}return f}s=this,s.getConnectionLine=function(s,a,u,m,b){var k,M,P,A,z,_,L,I,O,C=[],T=!1,D=!1,R=null,F=null,N=w(s,b),H=w(a,b),j=N.centerPoint(),W=H.centerPoint();if(void 0!==u&&null!==u&&null!==s.pins||(T=!0,R=s.pins,s.pins=[[0,50],[50,0],[100,50],[50,100]],u=Math.abs(j.x-W.x)<Math.abs(j.y-W.y)?W.y>j.y?3:1:W.x>j.x?2:0),void 0!==m&&null!==m&&null!==a.pins||(D=!0,F=a.pins,a.pins=[[0,50],[50,0],[100,50],[50,100]],m=Math.abs(j.x-W.x)<Math.abs(j.y-W.y)?j.y<W.y?1:3:j.x<W.x?0:2),k=Tn(s,u),t=c(s,k),k=d(k,N,t),M=Tn(a,m),e=c(a,M),M=d(M,H,e),C.push(k),P=k,H.containsPoint(P)||N.containsPoint(M))C.push(M);else while(1){if(h(P,M,[N,H])){C.push(M),P=M;break}if(_=y(P,M,N,H),void 0!==_.x){C.push(_),C.push(M),P=M;break}if(P!==k){if(p(e,H),o=n,l=i,f(e,H),I=h(P,n,[N,H]),O=h(P,i,[N,H]),I&&O){if(N.containsPoint(n)){C.push(i),N.containsPoint(l)?(C.push(n),C.push(o)):C.push(l),C.push(M),P=M;break}if(N.containsPoint(i)){C.push(n),N.containsPoint(o)?(C.push(i),C.push(l)):C.push(o),C.push(M),P=M;break}if(yt.getPointsDistance(n,M)<=yt.getPointsDistance(i,M)){C.push(n),N.containsPoint(o)?(C.push(i),C.push(l)):C.push(o),C.push(M),P=M;break}C.push(i),N.containsPoint(l)?(C.push(n),C.push(o)):C.push(l),C.push(M),P=M;break}if(I){C.push(n),N.containsPoint(o)?(C.push(i),C.push(l)):C.push(o),C.push(M),P=M;break}C.push(i),N.containsPoint(l)?(C.push(n),C.push(o)):C.push(l),C.push(M),P=M;break}z=g(M,N,H,A),C.push(z),P=z,x(P,H,[N])||(f(t,N),A?(C.push(n),P=n):(C.push(i),P=i),x(P,H,[N])||(A?(C.push(i),P=i):(C.push(n),P=n)))}return C=S(C,[N,H]),v(k,M,C,b),D&&(a.pins=F),T&&(s.pins=R),L=[],r(L,C),L}}function Dt(t){var e,n,i,o,l,s,r,a,h,d;for(e=this,s=null,r=[],a=function(t,e){var n=this;n.offset=t,n.point=e},h=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},d=function(){if(r.length<2)return 0;var t=r[r.length-1];return t.offset},n=0;n<t.length;n++)i=t[n],0===r.length?r.push(new a(0,i)):(o=r[r.length-1],l=h(i,o.point),r.push(new a(o.offset+l,i)));e.getPointAtFractionLength=function(t){var e,n,i,o,l,a,h,u,c,f,p,g,y,x;if(t<0||t>1||0===d())return null;n=t*d(),i=0,o=r.length-1;while(o-i>1)l=Math.floor((o+i)/2),n<r[l].offset?o=l:i=l;return a=r[i],h=r[o],u=a.point,c=h.point,f=a.offset,p=h.offset,e={x:((p-n)*u.x+(n-f)*c.x)/(p-f),y:((p-n)*u.y+(n-f)*c.y)/(p-f)},g=c.x-u.x,y=c.y-u.y,x=Math.sqrt(Math.pow(g,2)+Math.pow(y,2)),s={x:g/x,y:y/x},e},e.getTangent=function(){return s}}gt=function(t,e,n,i){this.left=t,this.top=e,this.width=n,this.height=i},gt.prototype.doclone=function(){return new gt(this.left,this.top,this.width,this.height)},gt.prototype.equals=function(t){return this.left===t.left&&this.top===t.top&&this.width===t.width&&this.height===t.height},gt.prototype.intersectsWith=function(t){return this.left<t.left+t.width&&this.left+this.width>t.left&&this.top<t.top+t.height&&this.top+this.height>t.top},gt.prototype.inflate=function(t,e){return new gt(this.left-t,this.top-e,this.width+2*t,this.height+2*e)},gt.prototype.offset=function(t,e){return new gt(this.left+t,this.top+e,this.width,this.height)},gt.prototype.unionRect=function(t){var e=this.doclone();return e.boundingRect(t),e},gt.prototype.boundingRect=function(t){var e,n;e=Math.max(this.left+this.width,t.left+t.width),n=Math.max(this.top+this.height,t.top+t.height),this.left=Math.min(this.left,t.left),this.top=Math.min(this.top,t.top),this.width=e-this.left,this.height=n-this.top},gt.prototype.centerPoint=function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},gt.prototype.containsPoint=function(t){return t.x>=this.left&&t.x<=this.left+this.width&&t.y>=this.top&&t.y<=this.top+this.height},gt.prototype.containsRect=function(t){return t.left>=this.left&&t.left+t.width<=this.left+this.width&&t.top>=this.top&&t.top+t.height<=this.top+this.height},yt={drawBezier:function(t,e,n,i,o){t.beginPath(),t.moveTo(e.x,e.y),t.bezierCurveTo(n.x,n.y,i.x,i.y,o.x,o.y)},drawPolyline:function(t,e){var n;for(t.beginPath(),t.moveTo(e[0].x,e[0].y),n=1;n<e.length;n++)t.lineTo(e[n].x,e[n].y)},drawPolylineRounded:function(t,e,n){var i,o,l,s;for(s=e.length,t.beginPath(),t.moveTo(e[0].x,e[0].y),i=0;i<s-2;i++)o=yt.getStartingPointOfRoundedCorner(e,i,n),l=yt.getEndingPointOfRoundedCorner(e,i,n),0===o.x&&0===o.y||0===l.x&&0===l.y?t.lineTo(e[i+1].x,e[i+1].y):(t.lineTo(o.x,o.y),t.bezierCurveTo(e[i+1].x,e[i+1].y,e[i+1].x,e[i+1].y,l.x,l.y));t.lineTo(e[s-1].x,e[s-1].y)},drawEllipse:function(t,e,n,i,o){var l,s,r,a,h,d,u;l=.5522848,s=i/2*l,r=o/2*l,a=e+i,h=n+o,d=e+i/2,u=n+o/2,t.beginPath(),t.moveTo(e,u),t.bezierCurveTo(e,u-r,d-s,n,d,n),t.bezierCurveTo(d+s,n,a,u-r,a,u),t.bezierCurveTo(a,u+r,d+s,h,d,h),t.bezierCurveTo(d-s,h,e,u+r,e,u),t.closePath()},drawRectangle:function(t,e,n,i,o){t.beginPath(),t.moveTo(e,n),t.lineTo(e+i,n),t.lineTo(e+i,n+o),t.lineTo(e,n+o),t.closePath()},drawPolygon:function(t,e){var n;for(t.beginPath(),t.moveTo(e[0].x,e[0].y),n=1;n<e.length;n++)t.lineTo(e[n].x,e[n].y);t.closePath()},multiFillText:function(t,e,n,i,o,l,s){var r,a,h,d,u,c,f,p,g,y,x;for(g=0,y=0,x=0,e=e.replace(/(\r\n|\n\r|\r|\n)/g,"\n"),r=e.split("\n"),c=function(e){s&&t.fillText(e,n,i+o*g),g++,d=t.measureText(e).width,d>x&&(x=d)},a=0;a<r.length;a++){u=r[a].split(" "),p=1;while(u.length>0&&p<=u.length)h=u.slice(0,p).join(" "),d=t.measureText(h).width,d>l?(1===p?(h=u.slice(0,1).join(" "),u=u.splice(1)):(h=u.slice(0,p-1).join(" "),u=u.splice(p-1)),c(h),p=1):p++;p>0&&c(u.join(" "))}if(f=1/4*o,y=o*g+(g-1)*f,!s)return{height:y,width:x}},getFirstPointOfLastSegmentOfBezier:function(t,e,n,i){var o,l,s;return o=18/19,l=(1-o)*(1-o)*(1-o)*t.x+3*o*(1-o)*(1-o)*e.x+3*o*o*(1-o)*n.x+o*o*o*i.x,s=(1-o)*(1-o)*(1-o)*t.y+3*o*(1-o)*(1-o)*e.y+3*o*o*(1-o)*n.y+o*o*o*i.y,{x:l,y:s}},drawArrow:function(t,e){var n;for(n in t.beginPath(),t.moveTo(e[0][0],e[0][1]),e)n>0&&t.lineTo(e[n][0],e[n][1]);t.lineTo(e[0][0],e[0][1]),t.fill(),t.stroke()},translateShape:function(t,e,n){var i,o;for(i in o=[],t)o.push([t[i][0]+e,t[i][1]+n]);return o},rotateShape:function(t,e){var n,i;for(n in i=[],t)i.push(yt.rotatePoint(e,t[n][0],t[n][1]));return i},rotatePoint:function(t,e,n){return[e*Math.cos(t)-n*Math.sin(t),e*Math.sin(t)+n*Math.cos(t)]},getSplinePoints:function(t,e){var n,i;if(i=t.length,2===i)e.push(t[0]),e.push(t[1]);else if(3===i)yt.splineSegment(e,t[0],t[0],t[1],t[2]),yt.splineSegment(e,t[0],t[1],t[2],t[2]);else{for(yt.splineSegment(e,t[0],t[0],t[1],t[2]),n=0;n<i-3;n++)yt.splineSegment(e,t[n],t[n+1],t[n+2],t[n+3]);yt.splineSegment(e,t[i-3],t[i-2],t[i-1],t[i-1])}},splineSegment:function(t,e,n,i,o){var l,s,r,a=.5,h=10,d=a*(i.x-e.x),u=a*(i.y-e.y),c=a*(o.x-n.x),f=a*(o.y-n.y),p=d+c+2*n.x-2*i.x,g=u+f+2*n.y-2*i.y,y=-2*d-c-3*n.x+3*i.x,x=-2*u-f-3*n.y+3*i.y,w=d,v=u,S=n.x,m=n.y;for(l=0;l<h;l++)s=l/(h-1),r={x:p*s*s*s+y*s*s+w*s+S,y:g*s*s*s+x*s*s+v*s+m},t.push(r)},adjustGrid:function(t,e,n){var i,o,l,s;return l=Math.round(t.x),s=Math.round(t.y),e=Math.round(e),n=Math.round(n),e>0&&(i=l%e,i<e/2?l-=i:l+=e-i),n>0&&(o=s%n,o<n/2?s-=o:s+=n-o),{x:l,y:s}},middlePoint:function(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}},getRectByTwoPoints:function(t,e){return new gt(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.abs(e.x-t.x),Math.abs(e.y-t.y))},getEllipseNearestPt:function(t,e,n,i){var o,l,s,r,a,h,d,u,c,f;return d=t.width/2,u=t.height/2,0===d||0===u?n:(s=i*(Math.PI/180),e.x-=n.x,e.y-=n.y,0!==s&&(o=e.x,l=e.y,e.x=o*Math.cos(s)+l*Math.sin(s),e.y=o*Math.sin(s)-l*Math.cos(s)),r=Math.atan2(e.y,-e.x),a=d*Math.sin(r),h=u*Math.cos(r),c=d*u/Math.sqrt(Math.pow(a,2)+Math.pow(h,2)),f={x:-c*Math.cos(r),y:c*Math.sin(r)},0!==s&&(o=f.x,l=f.y,f.x=o*Math.cos(s)+l*Math.sin(s),f.y=o*Math.sin(s)-l*Math.cos(s)),e.x+=n.x,e.y+=n.y,f.x+=n.x,f.y+=n.y,f)},getPolyNearestPt:function(t,e,n){var i,o,l,s,r,a,h,d,u,c,f,p,g;for(f={x:0,y:0},p=0,g=t.length,i=0;i<g;i++){if(s={x:0,y:0},r=t[i],a=i<g-1?t[i+1]:t[0],Math.abs(r.x-a.x)<1e-4){if(Math.abs(n.x-e.x)<1e-4)continue;o=(e.y-n.y)/(e.x-n.x),s.x=r.x,s.y=o*(r.x-n.x)+n.y}else if(l=(a.y-r.y)/(a.x-r.x),Math.abs(n.x-e.x)<1e-4)s.x=e.x,s.y=l*(e.x-a.x)+a.y;else{if(o=(e.y-n.y)/(e.x-n.x),Math.abs(o-l)<1e-4)continue;s.x=-(a.y-l*a.x-n.y+o*n.x)/(l-o),s.y=o*(s.x-n.x)+n.y}h=yt.getRectByTwoPoints(r,a),h.left-=1,h.top-=1,h.width+=2,h.height+=2,h.containsPoint(s)&&(d=s.x-e.x,u=s.y-e.y,c=Math.pow(d,2)+Math.pow(u,2),(0===p||c<p)&&(p=c,f=s))}return f},getRectanglePoints:function(t,e){return e.push({x:t.left,y:t.top}),e.push({x:t.left+t.width,y:t.top}),e.push({x:t.left+t.width,y:t.top+t.height}),e.push({x:t.left,y:t.top+t.height}),4},getDistanceBetweenPointAndPolyline:function(t,e,n,i){var o,l,s,r;for(l=1e8,s=i/2,r=0;r<e-1;r++){if(0===r||r===e-2)if(t[r].x===t[r+1].x){if(n.y<Math.min(t[r].y,t[r+1].y)||n.y>Math.max(t[r].y,t[r+1].y))continue}else if(t[r].y===t[r+1].y){if(n.x<Math.min(t[r].x,t[r+1].x)||n.x>Math.max(t[r].x,t[r+1].x))continue}else if(o=yt.getRectByTwoPoints(t[r],t[r+1]),o=o.inflate(s,s),!o.containsPoint(n))continue;l=Math.min(l,yt.getSegDist(t[r],t[r+1],n))}return l},getSegDist:function(t,e,n){var i,o,l,s,r,a,h,d,u,c,f,p,g,y;return o=t.x-n.x,l=t.y-n.y,s=e.x-n.x,r=e.y-n.y,a=e.x-t.x,h=e.y-t.y,d=Math.pow(a,2)+Math.pow(h,2),u=Math.pow(o,2)+Math.pow(l,2),c=Math.pow(s,2)+Math.pow(r,2),f=Math.sqrt(d),f<1?(i=Math.sqrt(u),i):(i=Math.abs(h*o-a*l)/f,p={x:n.x-i*h/f,y:n.y+i*a/f},g={x:(e.x+t.x)/2,y:(e.y+t.y)/2},y=(p.x-g.x)*(p.x-g.x)+(p.y-g.y)*(p.y-g.y),y>d/4&&(i=Math.sqrt(Math.min(u,c))),i)},getStartingPointOfRoundedCorner:function(t,e,n){var i,o,l,s,r,a;return a={x:0,y:0},i=t[e+1].x-t[e].x,o=t[e].y-t[e+1].y,l=Math.sqrt(Math.pow(i,2)+Math.pow(o,2)),l>0&&(s=i/l,r=o/l,a={x:t[e+1].x-n*s,y:t[e+1].y+n*r}),a},getEndingPointOfRoundedCorner:function(t,e,n){var i,o,l,s,r,a;return a={x:0,y:0},i=t[e+2].x-t[e+1].x,o=t[e+1].y-t[e+2].y,l=Math.sqrt(Math.pow(i,2)+Math.pow(o,2)),l>0?(s=i/l,r=o/l,{x:t[e+1].x+n*s,y:t[e+1].y-n*r}):a},flattenBezier:function(t,e,n,i,o){var l,s,r;for(l=0;l<1;l+=.1)s=(1-l)*(1-l)*(1-l)*t.x+3*l*(1-l)*(1-l)*e.x+3*l*l*(1-l)*n.x+l*l*l*i.x,r=(1-l)*(1-l)*(1-l)*t.y+3*l*(1-l)*(1-l)*e.y+3*l*l*(1-l)*n.y+l*l*l*i.y,o.push({x:s,y:r});o.push(i)},getPointsDistance:function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},getBoundingRect:function(t){var e,n,i,o,l;if(0===t.length)return null;for(e=t[0][0],n=e,i=t[0][1],o=i,l=0;l<t.length;l++)e=Math.min(e,t[l][0]),i=Math.min(i,t[l][1]),n=Math.max(n,t[l][0]),o=Math.max(o,t[l][1]);return new gt(e,i,n-e,o-i)}};var Rt={_init:function(t,e,n,i){var o;return o=function(t,e,n,i){var l,s,r,a,h;return l=[],s=null,r=null,a=null,h=null,{x:t,y:e,w:n,h:i,_getIntersectingItems:function(o,d){var u,c,f,p,g;if(void 0!==d&&null!==d&&0!==d.width&&0!==d.height)for(u=new gt(t,e,n/2,i/2),c=new gt(t+n/2,e,n/2,i/2),f=new gt(t,e+i/2,n/2,i/2),p=new gt(t+n/2,e+i/2,n/2,i/2),u.intersectsWith(d)&&null!==s&&s._getIntersectingItems(o,d),c.intersectsWith(d)&&null!==r&&r._getIntersectingItems(o,d),f.intersectsWith(d)&&null!==a&&a._getIntersectingItems(o,d),p.intersectsWith(d)&&null!==h&&h._getIntersectingItems(o,d),g=0;g<l.length;g++)l[g].bounds.intersectsWith(d)&&o.push(l[g])},_insert:function(d,u){var c,f,p,g,y;if(c=new gt(t,e,n/2,i/2),f=new gt(t+n/2,e,n/2,i/2),p=new gt(t,e+i/2,n/2,i/2),g=new gt(t+n/2,e+i/2,n/2,i/2),y=null,c.containsRect(u)?(null===s&&(s=new o(c.left,c.top,c.width,c.height)),y=s):f.containsRect(u)?(null===r&&(r=new o(f.left,f.top,f.width,f.height)),y=r):p.containsRect(u)?(null===a&&(a=new o(p.left,p.top,p.width,p.height)),y=a):g.containsRect(u)&&(null===h&&(h=new o(g.left,g.top,g.width,g.height)),y=h),null!==y)return y._insert(d,u);l.push(d),d.quadrant=this},_remove:function(t){var e,n;if(e=-1,null!==l){for(n=0;n<l.length;n++)if(l[n]===t){e=n;break}l.splice(e,1)}},_clear:function(){null!==s&&s._clear(),null!==r&&r._clear(),null!==a&&a._clear(),null!==h&&h._clear(),l.length=0}}},{_root:function(){return o(t,e,n,i)}(),_insert:function(t,e){this._root._insert(t,e)},_remove:function(t){null!==t.quadrant&&t.quadrant._remove(t)},_getItems:function(t){var e=[];return this._root._getIntersectingItems(e,t),e},_clear:function(){this._root._clear()}}}};xt=function(t,e,n,i,o){var l=!1,s=[];this.kindOfItem="Node",this.index=-1,this.flow=null,this.bounds=null,this.quadrant=null,this.x=t,this.y=e,this.w=n,this.h=i,this.text=void 0!==o?o:null,this.strokeStyle="#000",this.fillStyle="#fff",this.gradientFillStyle="#fff",this.textFillStyle="#000",this.lineWidth=1,this.shapeFamily="ellipse",this.polygon=null,this.drawShape=null,this.fillShape=null,this.pins=null,this.isSelectable=!0,this.isXSizeable=!0,this.isYSizeable=!0,this.isXMoveable=!0,this.isYMoveable=!0,this.isOutLinkable=!0,this.isInLinkable=!0,this.isContextHandle=!1,this.isShadowed=!1,this.image=null,this.textMargin={left:0,top:0,right:0,bottom:0},this.imageMargin={left:0,top:0,right:0,bottom:0},this.textPosition="centerMiddle",this.imagePosition="centerMiddle",this.font="12px Arial",this.textLineHeight=null,this.getIsSelected=function(){return l},this.setIsSelected=function(t){t!==l&&(l=t,Qe(this,B))},this.getLinks=function(){return s},this.getLeft=function(){return this.x},this.setLeft=function(t){var e=ie(this);e.left=t,le(this,e)},this.getTop=function(){return this.y},this.setTop=function(t){var e=ie(this);e.top=t,le(this,e)},this.getWidth=function(){return this.w},this.setWidth=function(t){var e=ie(this);e.width=t,le(this,e)},this.getHeight=function(){return this.h},this.setHeight=function(t){var e=ie(this);e.height=t,le(this,e)},this.refresh=function(){oe(this),Ze()},this.clone=function(){var t=new xt(this.x,this.y,this.w,this.h,this.text);return Je(t,this),t}},wt=function(t,e,n,i,o){var l=!1;this.kindOfItem="Link",this.index=-1,this.flow=null,this.bounds=null,this.quadrant=null,this.org=t,this.dst=e,this.pinOrg=void 0===i?null:i,this.pinDst=void 0===o?null:o,this.font="12px Arial",this.text=void 0!==n?n:null,this.strokeStyle="#000",this.fillStyle="#fff",this.textFillStyle="#000",this.lineWidth=1,this.isStretchable=!0,this.isSelectable=!0,this.isContextHandle=!1,this.isShadowed=!1,this.isOrgPointAdjustable=!1,this.isDstPointAdjustable=!1,this.roundedCornerSize=0,this.isOrientedText=!1,this.isOpaque=!1,this.font="12px Arial",this.arrowDst=r,this.arrowOrg=null,this.lineStyle="polyline",this.orthoMargin=30,this.firstSegmentHorizontal=!1,this.points=[],this.getIsSelected=function(){return l},this.setIsSelected=function(t){t!==l&&(l=t,Qe(this,B))},this.getOrg=function(){return this.org},this.setOrg=function(t){me(this,t)},this.getDst=function(){return this.dst},this.setDst=function(t){Se(this,t)},this.getPinOrg=function(){return this.pinOrg},this.setPinOrg=function(t){ke(this,t)},this.getPinDst=function(){return this.pinDst},this.setPinDst=function(t){be(this,t)},this.refresh=function(){pe(this),Ze()},this.clone=function(){var t=new wt(this.org,this.dst,this.text,this.pinOrg,this.pinDst);return Ke(t,this),t},this.getLineStyle=function(){return this.lineStyle},this.setLineStyle=function(t){ve(this,t)},this.getIsOrgPointAdjustable=function(){return this.isOrgPointAdjustable},this.setIsOrgPointAdjustable=function(t){Me(this,t)},this.getIsDstPointAdjustable=function(){return this.isDstPointAdjustable},this.setIsDstPointAdjustable=function(t){Pe(this,t)},this.addPoint=function(t,e){Ae(this,t,e)},this.removePoint=function(t){ze(this,t)},this.clearPoints=function(){_e(this)},this.countPoints=function(){return this.points.length},this.getPoint=function(t){return Le(this,t)},this.setPoint=function(t,e,n){Ie(this,t,e,n)}},vt=function(){this._currentItem=null,this.group=-1,this.groupCode="AF_none",this.code="AF_none"},St=function(t,e,n){var i,o,l,s;vt.call(this),i=t.canvas.parentNode,o=0,l=0,s=this,s.code="AF_nodeMoveAndSize",s._currentItem=e,null!==i&&void 0!==i&&(o=i.scrollLeft,l=i.scrollTop),s.redo=function(){s.undo()},s.undo=function(){var e,r,a;r=0,a=0,null!==i&&void 0!==i&&(r=i.scrollLeft,a=i.scrollTop),e=ie(s._currentItem),le(s._currentItem,n),oe(s._currentItem),ue(s._currentItem),t.refresh(),n=e,null!==i&&void 0!==i&&(i.scrollLeft=o,i.scrollTop=l,o=r,l=a)}},mt=function(t,e){var n,o;vt.call(this),n=this,n._currentItem=e,n.code="AF_nodeAdd",n.redo=function(){i.push(e),e.index=i.length-1,t.refresh()},n.undo=function(){e.getIsSelected()&&e.setIsSelected(!1),oe(e),o=e.index,Qt(o),qn(),t.refresh()}},bt=function(t,e){var n,o;vt.call(this),n=this,n._currentItem=e,n.code="AF_nodeRemove",n.redo=function(){oe(e),o=e.index,Qt(o),qn(),t.refresh()},n.undo=function(){i.push(e),e.index=i.length-1,oe(e),t.refresh()}},kt=function(t,e){var n,o;vt.call(this),n=this,n._currentItem=e,n.code="AF_linkAdd",n.redo=function(){var n,o;i.push(e),e.index=i.length-1,pe(e),$n(Ce(e)),n=e.org,o=e.dst,de(n).push(e),de(o).push(e),t.refresh()},n.undo=function(){e.getIsSelected()&&e.setIsSelected(!1),o=e.index,Qt(o),e.setOrg(null),e.setDst(null),t.refresh()}},Mt=function(t,e){var n,o;vt.call(this),n=this,n._currentItem=e,n.code="AF_linkRemove",n.redo=function(){e.getIsSelected()&&e.setIsSelected(!1),o=e.index,Qt(o),e.setOrg(null),e.setDst(null),t.refresh()},n.undo=function(){var n,o;i.push(e),e.index=i.length-1,pe(e),$n(Ce(e)),n=e.org,o=e.dst,n.getLinks().push(e),o.getLinks().push(e),t.refresh()}},Pt=function(t,e){var n,i,o,l;vt.call(this),n=this,i=e.points.slice(),o=e.isOrgPointAdjustable,l=e.isDstPointAdjustable,n._currentItem=e,n.code="AF_linkStretch",n.redo=function(){n.undo()},n.undo=function(){var n,s,r,a,h;n=e.lineWidth+t.handleSize,s=Ce(e),s=s.inflate(n,n),r=e.points.slice(),e.points.splice(0,e.points.length),e.points=e.points.concat(i),i=r,a=e.isOrgPointAdjustable,h=e.isDstPointAdjustable,e.setIsOrgPointAdjustable(o),e.setIsDstPointAdjustable(l),o=a,l=h,Ve(s),pe(e),t.refresh()}},At=function(t,e,n){var i,o;vt.call(this),i=this,i._currentItem=e,i.code="AF_org",i.redo=function(){i.undo()},i.undo=function(){o=i._currentItem.org,i._currentItem.setOrg(n),n=o,t.refresh()}},zt=function(t,e,n){var i,o;vt.call(this),i=this,i._currentItem=e,i.code="AF_dst",i.redo=function(){i.undo()},i.undo=function(){o=i._currentItem.dst,i._currentItem.setDst(n),n=o,t.refresh()}},_t=function(t,e,n){var i,o,l;vt.call(this),i=this,i._currentItem=e,i.code="AF_pinOrg",l=e.points.slice(),i.redo=function(){i.undo()},i.undo=function(){o=i._currentItem.pinOrg,i._currentItem.setPinDst(n),n=o;var s=e.points.slice();e.points.splice(0,e.points.length),e.points=e.points.concat(l),l=s,t.refresh()}},Lt=function(t,e,n){var i,o,l;vt.call(this),i=this,i._currentItem=e,i.code="AF_pinDst",l=e.points.slice(),i.redo=function(){i.undo()},i.undo=function(){o=i._currentItem.pinDst,i._currentItem.setPinDst(n),n=o;var s=e.points.slice();e.points.splice(0,e.points.length),e.points=e.points.concat(l),l=s,t.refresh()}},It=function(t){var e,n;vt.call(this),e=this,n=i.slice(),e.code="AF_zOrder",e.redo=function(){e.undo()},e.undo=function(){var e,o;for(o=i.slice(),i=n.slice(),n=o,t.refresh(),e=0;e<i.length;e++)i[e].index=e}},Ot=function(t,e,n){var i,o;vt.call(this),i=this,o=e.points.slice(),i._currentItem=e,i.code="AF_lineStyle",i.redo=function(){i.undo()},i.undo=function(){var l,s,r,a;l=i._currentItem.lineWidth+t.handleSize,s=Ce(i._currentItem),s=s.inflate(l,l),a=i._currentItem.lineStyle,r=i._currentItem.points.slice(),i._currentItem.lineStyle=n,i._currentItem.points.splice(0,i._currentItem.points.length),i._currentItem.points=e.points.concat(o),n=a,o=r,Ve(s),i._currentItem.refresh()}};var Ft=function(){var t=[],e=-1,n=-1,i="AF_none",o=!1,l=!1,s=!1,r=this;function a(){h();while(e+1<t.length)t.splice(t.length-1,1)}function h(){var n,i;if(r.canUndoRedo&&r._canUndo()){for(s=!0,Xn(),n=t[e],e--,n.undo();;){if(!r._canUndo())break;if(i=t[e],i.group!==n.group)break;e--,i.undo()}Yn(),s=!1}}function d(){var n,i;if(r.canUndoRedo&&r._canRedo()){for(s=!0,Xn(),e++,n=t[e],n.redo();;){if(!r._canRedo())break;if(e++,i=t[e],i.group!==n.group){e--;break}i.redo()}Yn(),s=!1}}function u(t){t.length>=3&&"AF_"===t.substr(0,3)||p(t)}function c(){g()}function f(){o=!0}function p(t){var e=!1;return o||(o=!0,n++,i=t,e=!0),e}function g(){o&&(o=!1,i="AF_none")}function y(t){return"AF_none"!==t.groupCode?t.groupCode:t.code}function x(){t=[],e=-1,n=-1,o=!1,l=!1}this.canUndoRedo=!0,this.undoLimit=0,this.skipUndo=!1,this.undoCode=function(){return r._canUndo()?y(t[e]):"AF_none"},this.redoCode=function(){return r._canRedo()?y(t[e+1]):"AF_none"},this.undoItem=function(){return r._canUndo()?t[e]._currentItem:null},this.redoItem=function(){return r._canredo()?t[e+1]._currentItem:null},this.canUndo=function(){return r._canUndo()},this.canRedo=function(){return r._canRedo()},this.undo=function(){h()},this.redo=function(){d()},this.beginAction=function(t){u(t)},this.endAction=function(){c()},this.clear=function(){x()},this.addToLastAction=function(){f()},this.submitTask=function(t){r._submitTask(t)},this.removeLastTask=function(){a()},this.taskCount=function(){return e+1},this.undoAllowed=function(){return r.canUndoRedo&&!r.skipUndo&&!s},this._canUndo=function(){return!!r.canUndoRedo&&e>=0},this._canRedo=function(){return!!r.canUndoRedo&&e<t.length-1},this._beginActionInternal=function(t){o||(l=!0,n++,i=t)},this._endActionInternal=function(){o||(l=!1,i="AF_none")},this.isCurrentActionGroup=function(){return l||o},this._submitTask=function(o){var l;if(null!==o&&(e++,t.splice(e,t.length-1-e,o),r.isCurrentActionGroup()||n++,o.group=n,o.groupCode=i,r.undoLimit>0&&e>=r.undoLimit&&(l=t[0].group,l!==n))){t.spice(0,1),e--;while(e>0){if(t[0].group!==l)break;t.spice(0,1),e--}}}};function Nt(t){t.addEventListener("ready",ni,!1),t.addEventListener("mousedown",si,!1),t.addEventListener("mousemove",ri,!1),t.addEventListener("mouseup",ai,!1),t.addEventListener("touchstart",ii,!1),t.addEventListener("touchmove",oi,!1),t.addEventListener("touchend",li,!1),Ct&&Wt()}function Ht(t){var e;e=document.createEvent("Event"),e.initEvent("context",!0,!0),e.item=t,document.dispatchEvent(e)}function jt(t){var e;e=document.createEvent("Event"),e.initEvent("selectionChange",!0,!0),e.item=t,document.dispatchEvent(e)}function Wt(){var t,n;for(o=Rt._init(0,0,k.width,k.height),o._clear(),t=0;t<i.length;t++)n=i[t],e.isNode(n)?n.bounds=ie(n):n.bounds=Ce(n),o._insert(n,n.bounds)}function Bt(t){return t instanceof xt}function Et(t){return t instanceof wt}function Gt(t,l,s,r,a){var h,d=new xt(t,l,s,r,a);return i.push(d),d.index=e.getItems().length-1,d.flow=e,void 0!==e.nodeModel&&null!==e.nodeModel&&Je(d,e.nodeModel),0===V&&(h=ie(d),$n(h),d.bounds=h,Ct&&o._insert(d,d.bounds),d.refresh()),n.undoAllowed()&&n._submitTask(new mt(e,d)),d}function Xt(t){var i,l,s;if(void 0!==t&&null!==t){for(i=!1,n.undoAllowed()&&(i=n.isCurrentActionGroup(),i||n._beginActionInternal("AF_nodeRemove")),t.getIsSelected()&&t.setIsSelected(!1),l=t.getLinks(),s=l.length-1;s>=0;s--)Ut(l[s]);n.undoAllowed()&&n._submitTask(new bt(e,t)),Ct&&o._remove(t),Qt(t.index),e.refresh(),n.undoAllowed()&&(i||n._endActionInternal())}}function Yt(t,l,s,r,a){var h;if(void 0===t||void 0===l)return null;if(null===t||null===l)return null;if(h=new wt(t,l,s,r,a),i.push(h),t.getLinks().push(h),l.getLinks().push(h),h.flow=e,void 0!==e.linkModel&&null!==e.linkModel&&Ke(h,e.linkModel),Te(h),h.index=e.getItems().length-1,0===V){var d=Ce(h);$n(d),h.bounds=d,Ct&&o._insert(h,h.bounds),h.refresh()}return n.undoAllowed()&&n._submitTask(new kt(e,h)),h}function Ut(t){var i;void 0!==t&&null!==t&&(t.getIsSelected()&&t.setIsSelected(!1),i=!1,n.undoAllowed()&&(i=n.isCurrentActionGroup(),i||n._beginActionInternal("AF_linkRemove")),t.setOrg(null),t.setDst(null),n.undoAllowed()&&n._submitTask(new Mt(e,t)),Ct&&o._remove(t),Qt(t.index),e.refresh(),n.undoAllowed()&&(i||n._endActionInternal()))}function qt(){var t,e,n;if(0!==i.length){for(Xn(),n=[],t=0;t<i.length;t++)Bt(i[t])&&n.push(i[t]);for(e=n.length-1;e>=0;e--)Xt(n[e]);Yn()}}function $t(){var t,e,i;if(0!==l.length){for(i=!1,n.undoAllowed()&&(i=n.isCurrentActionGroup(),i||n._beginActionInternal("AF_del")),Xn(),t=l.length-1;t>=0;t--)e=l[t],Et(e)&&Ut(e);for(t=l.length-1;t>=0;t--)e=l[t],Bt(e)&&Xt(e);Yn(),n.undoAllowed()&&(i||n._endActionInternal(),n._endActionInternal())}}function Jt(){var t,e;for(Xn(),t=0;t<i.length;t++)e=i[t],e.getIsSelected()||e.setIsSelected(!0);Yn()}function Kt(){var t,n;for(B=!0,t=l.length-1;t>=0;t--)n=l[t],n.getIsSelected()&&n.setIsSelected(!1);l=[],B=!1,e.refresh()}function Qt(t){var n;if(t>=0&&t<i.length)for(e.isNode(i[t])?oe(i[t]):e.isLink(i[t])&&pe(i[t]),i.splice(t,1),n=t;n<i.length;n++)i[n].index=n}function Zt(){var t,o,s,r;for(n.undoAllowed()&&n._submitTask(new It(e)),t=0;t<l.length;t++)for(r=l[t],s=r.index,i.splice(s,1),i.splice(0,0,r),o=0;o<l.length;o++)o!==t&&l[o].index<s+1&&l[o].index++;for(t=0;t<i.length;t++)i[t].index=t;for(t=0;t<l.length;t++)r=l[t],r.refresh()}function Vt(){var t,o,s,r;for(n.undoAllowed()&&n._submitTask(new It(e)),t=0;t<l.length;t++)for(r=l[t],s=r.index,i.splice(s,1),i.push(r),o=0;o<l.length;o++)o!==t&&l[o].index>s-1&&l[o].index--;for(t=0;t<i.length;t++)i[t].index=t;for(t=0;t<l.length;t++)r=l[t],r.refresh()}function te(t){var n,i,o,l,s;return n=ie(t),l=e.contextHandleSize,s=2*e.contextHandleSize/5,i=n.left+n.width-l,o=n.top+1-l,new gt(i,o,l,s)}function ee(t){var n,i,o,l,s;s=[],"bezier"===t.lineStyle?yt.flattenBezier(t.points[0],t.points[1],t.points[2],t.points[3],s):s=t.points;var r=new Dt(s),a=r.getPointAtFractionLength(.5);return null!==a?(o=e.contextHandleSize,l=2*e.contextHandleSize/5,n=a.x-o/2-20,i=a.y-l/2-20,new gt(n,i,o,l)):null}function ne(t,n){var i,o,l,s;o=1*e.handleSize,l=e.handleSize,s=ie(t),s=s.inflate(o,o),i={x:s.left,y:s.top},n.push(new gt(i.x-l/2,i.y-l/2,l,l)),i={x:s.left+s.width/2,y:s.top},n.push(new gt(i.x-l/2,i.y-l/2,l,l)),i={x:s.left+s.width,y:s.top},n.push(new gt(i.x-l/2,i.y-l/2,l,l)),i={x:s.left,y:s.top+s.height/2},n.push(new gt(i.x-l/2,i.y-l/2,l,l)),i={x:s.left+s.width,y:s.top+s.height/2},n.push(new gt(i.x-l/2,i.y-l/2,l,l)),i={x:s.left,y:s.top+s.height},n.push(new gt(i.x-l/2,i.y-l/2,l,l)),i={x:s.left+s.width/2,y:s.top+s.height},n.push(new gt(i.x-l/2,i.y-l/2,l,l)),i={x:s.left+s.width,y:s.top+s.height},n.push(new gt(i.x-l/2,i.y-l/2,l,l))}function ie(t){return new gt(t.x,t.y,t.w,t.h)}function oe(t){Ve(jn(t))}function le(t,i){var o,l;o=!1,n.undoAllowed()&&(o=n.isCurrentActionGroup(),o||n._beginActionInternal("AF_nodeMoveAndSize")),n.undoAllowed()&&(l=ie(t),n._submitTask(new St(e,t,l))),oe(t),t.x=i.left,t.y=i.top,t.w=i.width,t.h=i.height,ue(t),t.refresh(),n.undoAllowed()&&(o||n._endActionInternal())}function se(t){return"ellipse"===t.shapeFamily}function re(t){return"rectangle"===t.shapeFamily}function ae(t){return"polygon"===t.shapeFamily}function he(t,e){var n,i,o,l,s,r,a,h,d;if(void 0!==t.polygon&&null!==t.polygon){if(n=yt.getBoundingRect(t.polygon),null===n)return;if(i=n.left,o=n.top,l=n.width,s=n.height,0===l||0===s)return;for(d=0;d<t.polygon.length;d++)r=ie(t),a=r.left+r.width/l*(t.polygon[d][0]-i),h=r.top+r.height/s*(t.polygon[d][1]-o),e.push({x:a,y:h})}}function de(t){return t.getLinks()}function ue(t){var e,n,i;for(n=de(t),e=0;e<n.length;e++)i=n[e],Ct&&o._remove(i),we(i),i.bounds=Ce(i),Ct&&o._insert(i,i.bounds)}function ce(t,e){var n,i,o,l;for(l=!1,o=de(t),n=0;n<o.length;n++)if(i=o[n],i.dst===e&&i.org===t){l=!0;break}return l}function fe(t,e){var n,i,o,l;for(o=!1,l=de(t),n=0;n<l.length;n++)if(i=l[n],i.org===e&&i.dst===t){o=!0;break}return o}function pe(t){Ve(Wn(t))}function ge(t,n){var i,o,l,s,r,a,h,d,u;for(i=xe(t),o=i?2*t.points.length-1:t.points.length,l=e.canChangeOrg||null!==t.org.pins,s=e.canChangeDst||null!==t.dst.pins,r=e.canStretchLink&&t.isStretchable,a=0;a<o;a++)!1,0===a?l:a===o-1?s:r,i?a%2===0?d=t.points[a/2]:(h=Math.round(a/2)-1,d=yt.middlePoint(t.points[h],t.points[h+1])):d=t.points[a],u=new gt(d.x-e.handleSize/2,d.y-e.handleSize/2,e.handleSize,e.handleSize),n.push(u)}function ye(t){return t.org===t.dst}function xe(t){return"polyline"===t.getLineStyle()||"spline"===t.getLineStyle()}function we(t){pe(t),"database"===t.getLineStyle()?He(t):"orthogonal"===t.getLineStyle()&&je(t),null!==t.org.pins||t.isOrgPointAdjustable||Be(t),null!==t.dst.pins||t.isDstPointAdjustable||We(t),pe(t)}function ve(t,i){t.lineStyle!==i&&(t!==e.linkModel?(n.undoAllowed()&&n._submitTask(new Ot(e,t,t.lineStyle)),t.lineStyle=i,("bezier"===t.lineStyle&&4!==t.points.length||"database"===t.lineStyle||"orthogonal"===t.lineStyle)&&Te(t),null!==t.org.pins||t.isOrgPointAdjustable||Be(t),null!==t.dst.pins||t.isDstPointAdjustable||We(t),t.refresh()):t.lineStyle=i)}function Se(t,i){var o,l,s;if(t!==e.linkModel){if(n.undoAllowed()&&n._submitTask(new zt(e,t,t.dst)),pe(t),l=t.dst,null!==l){for(o=l.getLinks(),s=0;s<o.length;s++)if(o[s]===t)break;o.splice(s,1)}null!==i&&(o=i.getLinks(),o.push(t),t.dst=i,"database"===t.getLineStyle()?He(t):"orthogonal"===t.getLineStyle()&&je(t),null!==t.org.pins||t.isOrgPointAdjustable||Be(t),null!==t.dst.pins||t.isDstPointAdjustable||We(t),t.refresh())}else t.dst=i}function me(t,i){var o,l,s;if(t!==e.linkModel){if(n.undoAllowed()&&n._submitTask(new At(e,t,t.org)),pe(t),l=t.org,null!==l){for(o=l.getLinks(),s=0;s<o.length;s++)if(o[s]===t)break;o.splice(s,1)}null!==i&&(o=i.getLinks(),o.push(t),t.org=i,"database"===t.getLineStyle()?He(t):"orthogonal"===t.getLineStyle()&&je(t),null!==t.org.pins||t.isOrgPointAdjustable||Be(t),null!==t.dst.pins||t.isDstPointAdjustable||We(t),t.refresh())}else t.org=i}function be(t,i){var o;o=t.pinDst,t.pinDst=i,null!==t.points&&t.points.length>0&&null!=t.org.pins&&t.pinDst>=0&&t.pinDst<t.dst.pins.length&&(n.undoAllowed()&&n.submitTask(new Lt(e,t,o)),t.points[t.points.length-1]=Tn(t.dst,t.pinDst),t.refresh())}function ke(t,i){var o;o=t.pinOrg,t.pinOrg=i,null!==t.points&&t.points.length>0&&null!=t.org.pins&&t.pinOrg>=0&&t.pinOrg<t.org.pins.length&&(n.undoAllowed()&&n.submitTask(new _t(e,t,o)),t.points[0]=Tn(t.org,t.pinOrg),t.refresh())}function Me(t,i){t.isOrgPointAdjustable!==i&&(t!==e.linkModel?(n.undoAllowed()&&n._submitTask(new Pt(e,t)),t.isOrgPointAdjustable=i,null!==t.org.pins||t.isOrgPointAdjustable||Be(t),null!==t.dst.pins||t.isDstPointAdjustable||We(t),t.refresh()):t.isOrgPointAdjustable=i)}function Pe(t,i){t.isDstPointAdjustable!==i&&(t!==e.linkModel?(n.undoAllowed()&&n._submitTask(new Pt(e,t)),t.isDstPointAdjustable=i,null!==t.org.pins||t.isOrgPointAdjustable||Be(t),null!==t.dst.pins||t.isDstPointAdjustable||We(t),t.refresh()):t.isDstPointAdjustable=i)}function Ae(t,i,o){n.undoAllowed()&&n._submitTask(new Pt(e,t)),pe(t),t.points.splice(t.points.length-1,0,{x:i,y:o}),null!==t.org.pins||t.isOrgPointAdjustable||Be(t),null!==t.dst.pins||t.isDstPointAdjustable||We(t),t.refresh()}function ze(t,i){n.undoAllowed()&&n._submitTask(new Pt(e,t)),pe(t),t.points.splice(i,1),null!==t.org.pins||t.isOrgPointAdjustable||Be(t),null!==t.dst.pins||t.isDstPointAdjustable||We(t),t.refresh()}function _e(t){n.undoAllowed()&&n._submitTask(new Pt(e,t)),pe(t),Te(t),null!==t.org.pins||t.isOrgPointAdjustable||Be(t),null!==t.dst.pins||t.isDstPointAdjustable||We(t),t.refresh()}function Le(t,e){return null===t.points||e<0||e>t.points.length-1?null:{x:t.points[e].x,y:t.points[e].y}}function Ie(t,i,o,l){null===t.points||l<0||l>t.points.length-1||0===l&&null===t.org.pins&&!t.isOrgPointAdjustable||l===t.points.length-1&&null===t.dst.pins&&!t.isDstPointAdjustable||(n.undoAllowed()&&n._submitTask(new Pt(e,t)),pe(t),Oe(t,l,{x:i,y:o}),null!==t.org.pins||t.isOrgPointAdjustable||Be(t),null!==t.dst.pins||t.isDstPointAdjustable||We(t),t.refresh())}function Oe(t,e,n){null!==t.points&&(t.points[e]=n)}function Ce(t){var e,n,i,o,l,s,r,a,h,d;if(d=[],"bezier"===t.getLineStyle()){for(yt.flattenBezier(t.points[0],t.points[1],t.points[2],t.points[3],d),e=new gt(d[0].x,d[0].y,0,0),i=0;i<d.length-1;i++)e.boundingRect(yt.getRectByTwoPoints(d[i],d[i+1]));if(t.getIsSelected())for(i=0;i<t.points.length-1;i++)e.boundingRect(yt.getRectByTwoPoints(t.points[i],t.points[i+1]))}else for(d=t.points,e=new gt(d[0].x,d[0].y,0,0),i=0;i<d.length-1;i++)e.boundingRect(yt.getRectByTwoPoints(d[i],d[i+1]));return null!==t.text&&t.text.length>0&&(o=new Dt(d),l=o.getPointAtFractionLength(.5),null!==l&&(s=t.flow.canvas.getContext("2d"),s.font=t.font,r=s.measureText(t.text),a=r.width,h=1.2*parseInt(t.font,10),void 0===h&&(h=16),n=new gt(l.x-a/2,l.y-h/2,a,h),n.inflate(h/2,h/2),e.boundingRect(n))),e=e.inflate(t.flow.linkSelectionAreaWidth,t.flow.linkSelectionAreaWidth),e}function Te(t){t.points.splice(0,t.points.length),"orthogonal"===t.getLineStyle()?De(t):"database"===t.getLineStyle()?Re(t):"bezier"===t.getLineStyle()?Fe(t):Ne(t)}function De(t){t.points=pt.getConnectionLine(t.org,t.dst,t.pinOrg,t.pinDst,t.orthoMargin),t.firstSegmentHorizontal=t.points[0].y===t.points[1].y}function Re(t){var e,n,i;for(e=0;e<4;e++)t.points.push({x:0,y:0});n=ie(t.org),i=ie(t.dst),n.left+n.width/2<i.left+i.width/2?($e(t)?t.points[0]=Ye(t):t.points[0]={x:n.left+n.width,y:n.top+n.height/2},qe(t)?t.points[3]=Ue(t):t.points[3]={x:i.left,y:i.top+i.height/2},t.points[1]={x:Math.max(t.points[0].x+W,0),y:t.points[0].y},t.points[2]={x:Math.max(t.points[3].x-W,0),y:t.points[3].y}):($e(t)?t.points[0]=Ye(t):t.points[0]={x:n.left,y:n.top+n.height/2},qe(t)?t.points[3]=Ue(t):t.points[3]={x:i.left+i.width,y:i.top+i.height/2},t.points[1]={x:Math.max(t.points[0].x-W,0),y:t.points[0].y},t.points[2]={x:Math.max(t.points[3].x+W,0),y:t.points[3].y})}function Fe(t){var e,n,i,o,l,s,r,a;t.points.push({x:0,y:0}),t.points.push({x:0,y:0}),ye(t)?(t.points.push({x:0,y:0}),t.points.push({x:0,y:0}),a=ie(t.org),t.points[0]=a.centerPoint(),t.points[1]={x:a.left+a.width+a.width/2,y:t.points[1].y},t.points[2]={x:a.left+a.width/2,y:t.points[2].y},a.top-a.height>=0?(t.points[1]={x:t.points[1].x,y:a.top-a.height/2},t.points[2]={x:t.points[2].x,y:a.top-a.height}):(t.points[1]={x:t.points[1].x,y:a.top+a.height+a.height/2},t.points[2]={x:t.points[2].x,y:a.top+a.height+a.height}),t.points[3]=t.points[0],$e(t)?t.points[0]=Ye(t):Be(t),qe(t)?t.points[t.points.length-1]=Ue(t):We(t)):($e(t)?t.points[0]=Ye(t):Be(t),qe(t)?t.points[t.points.length-1]=Ue(t):We(t),e=t.points[0],n=t.points[1],i=n.x-e.x,o=n.y-e.y,l=Math.sqrt(Math.pow(i,2)+Math.pow(o,2)),s={x:e.x+i/2-l/5,y:e.y+o/2-l/5},r={x:e.x+i/2+l/5,y:e.y+o/2+l/5},t.points.splice(0,t.points.length),t.points.push(e),t.points.push(s),t.points.push(r),t.points.push(n),$e(t)||Be(t),qe(t)||We(t))}function Ne(t){var e;t.points.push({x:0,y:0}),t.points.push({x:0,y:0}),ye(t)?(t.points.push({x:0,y:0}),t.points.push({x:0,y:0}),e=ie(t.org),t.points[0]=e.centerPoint(),t.points[1]={x:e.left+e.width+e.width/2,y:t.points[1].y},t.points[2]={x:e.left+e.width/2,y:t.points[2].y},e.top-e.height>=0?(t.points[1]={x:t.points[1].x,y:e.top-e.height/2},t.points[2]={x:t.points[2].x,y:e.top-e.height}):(t.points[1]={x:t.points[1].x,y:e.top+e.height+e.height/2},t.points[2]={x:t.points[2].x,y:e.top+e.height+e.height}),t.points[3]=t.points[0],Be(t),We(t)):($e(t)?t.points[0]=Ye(t):Be(t),qe(t)?t.points[t.points.length-1]=Ue(t):We(t))}function He(t){var e,n;e=null!==t.org.pins||t.isOrgPointAdjustable?t.points[0]:ie(t.org).centerPoint(),n=null!==t.dst.pins||t.isDstPointAdjustable?t.points[3]:ie(t.dst).centerPoint(),t.points[1]={x:t.points[0].x+W,y:e.y},t.points[2]={x:t.points[3].x-W,y:n.y}}function je(t){var e,n,i;e=t.points.length,null!==t.org.pins&&void 0!==t.pinOrg&&(t.points[0]=Tn(t.org,t.pinOrg)),null!==t.dst.pins&&void 0!==t.pinDst&&(t.points[e-1]=Tn(t.dst,t.pinDst)),n=null!==t.org.pins||t.isOrgPointAdjustable?t.points[0]:ie(t.org).centerPoint(),i=null!==t.dst.pins||t.isDstPointAdjustable?t.points[e-1]:ie(t.dst).centerPoint(),t.firstSegmentHorizontal?(t.points[1]={x:t.points[1].x,y:n.y},t.points[e-2]=e%2===0?{x:t.points[e-2].x,y:i.y}:{x:i.x,y:t.points[e-2].y}):(t.points[1]={x:n.x,y:t.points[1].y},t.points[e-2]=e%2===0?{x:i.x,y:t.points[e-2].y}:{x:t.points[e-2].x,y:i.y})}function We(t){var e,n,i,o,l,s,r;e=ie(t.org),n=ie(t.dst),i=e.centerPoint(),o=n.centerPoint(),s=t.points.length,0!==n.width&&0!==n.height?(l=2===s?$e(t)?Ye(t):i:t.points[s-2],se(t.dst)?t.points[s-1]=yt.getEllipseNearestPt(n,l,o,0):ae(t.dst)&&null!==t.dst.polygon?(r=[],he(t.dst,r),t.points[s-1]=yt.getPolyNearestPt(r,l,o)):(r=[],yt.getRectanglePoints(n,r),t.points[s-1]=yt.getPolyNearestPt(r,l,o))):t.points[s-1]=o}function Be(t){var e,n,i,o,l,s;e=ie(t.org),n=ie(t.dst),i=e.centerPoint(),o=n.centerPoint(),0!==e.width&&0!==e.height?(l=2===t.points.length?qe(t)?Ue(t):o:t.points[1],se(t.org)?t.points[0]=yt.getEllipseNearestPt(e,l,i,0):ae(t.org)&&null!==t.org.polygon?(s=[],he(t.org,s),t.points[0]=yt.getPolyNearestPt(s,l,i)):(s=[],yt.getRectanglePoints(e,s),t.points[0]=yt.getPolyNearestPt(s,l,i))):t.points[0]=i}function Ee(t,e,n){var i=t.points.length;t.firstSegmentHorizontal?i>3&&(0===n?(t.points[0]=e,t.points[1]={x:t.points[1].x,y:e.y}):1===n?(t.points[1]={x:e.x,y:t.points[1].y},t.points[2]={x:e.x,y:t.points[2].y}):n===i-1?i%2===0?(t.points[i-1]=e,t.points[i-2]={x:t.points[i-2].x,y:e.y}):t.points[i-2]={x:e.x,y:t.points[i-2].y}:n===i-2?i%2===0?(t.points[i-3]={x:e.x,y:t.points[i-3].y},t.points[i-2]={x:e.x,y:t.points[i-2].y}):(t.points[i-3]={x:t.points[i-3].x,y:e.y},t.points[i-2]={x:t.points[i-2].x,y:e.y}):(t.points[n]=e,n%2===0?(t.points[n-1]={x:e.x,y:t.points[n-1].y},t.points[n+1]={x:t.points[n+1].x,y:e.y}):(t.points[n-1]={x:t.points[n-1].x,y:e.y},t.points[n+1]={x:e.x,y:t.points[n+1].y}))):i>3&&(0===n?(t.points[0]=e,t.points[1]={x:e.x,y:t.points[1].y}):1===n?(t.points[1]={x:t.points[1].x,y:e.y},t.points[2]={x:t.points[2].x,y:e.y}):n===i-1?t.points[i-2]=i%2===0?{x:e.x,y:t.points[i-2].y}:{x:t.points[i-2].x,y:e.y}:n===i-2?i%2===0?(t.points[i-3]={x:t.points[i-3].x,y:e.y},t.points[i-2]={x:t.points[i-2].x,y:e.y}):(t.points[i-3]={x:e.x,y:t.points[i-3].y},t.points[i-2]={x:t.points[i-2].x,y:e.y}):(t.points[n]=e,n%2===0?(t.points[n-1]={x:t.points[n-1].x,y:e.y},t.points[n+1]={x:e.x,y:t.points[n+1].y}):(t.points[n-1]={x:e.x,y:t.points[n-1].y},t.points[n+1]={x:t.points[n+1].x,y:e.y})))}function Ge(t,e,n){t.points.splice(n+1,0,e)}function Xe(t){var e;for(t.points2=[t.points.length],e=0;e<t.points.length;e++)t.points2[e]=t.points[e]}function Ye(t){var e,n,i;return e=ie(t.org),n=e.left+e.width/100*t.org.pins[t.pinOrg][0],i=e.top+e.height/100*t.org.pins[t.pinOrg][1],{x:n,y:i}}function Ue(t){var e,n,i;return e=ie(t.dst),n=e.left+e.width/100*t.dst.pins[t.pinDst][0],i=e.top+e.height/100*t.dst.pins[t.pinDst][1],{x:n,y:i}}function qe(t){return null!==t.pinDst&&null!==t.dst.pins&&t.pinDst>=0&&t.pinDst<t.dst.pins.length}function $e(t){return null!==t.pinOrg&&null!==t.org.pins&&t.pinOrg>=0&&t.pinOrg<t.org.pins.length}function Je(t,e){void 0!==e.strokeStyle&&(t.strokeStyle=e.strokeStyle),void 0!==e.fillStyle&&(t.fillStyle=e.fillStyle),void 0!==e.gradientFillStyle&&(t.gradientFillStyle=e.gradientFillStyle),void 0!==e.textFillStyle&&(t.textFillStyle=e.textFillStyle),void 0!==e.lineWidth&&(t.lineWidth=e.lineWidth),void 0!==e.shapeFamily&&(t.shapeFamily=e.shapeFamily),void 0!==e.polygon&&(t.polygon=e.polygon),void 0!==e.drawShape&&(t.drawShape=e.drawShape),void 0!==e.fillShape&&(t.fillShape=e.fillShape),void 0!==e.pins&&(t.pins=e.pins),void 0!==e.isContextHandle&&(t.isContextHandle=e.isContextHandle),void 0!==e.isXSizeable&&(t.isXSizeable=e.isXSizeable),void 0!==e.isYSizeable&&(t.isYSizeable=e.isYSizeable),void 0!==e.isXMoveable&&(t.isXMoveable=e.isXMoveable),void 0!==e.isYMoveable&&(t.isYMoveable=e.isYMoveable),void 0!==e.isOutLinkable&&(t.isOutLinkable=e.isOutLinkable),void 0!==e.isInLinkable&&(t.isInLinkable=e.isInLinkable),void 0!==e.isSelectable&&(t.isSelectable=e.isSelectable),void 0!==e.isShadowed&&(t.isShadowed=e.isShadowed),void 0!==e.image&&(t.image=e.image),void 0!==e.textMargin&&(t.textMargin=e.textMargin),void 0!==e.imageMargin&&(t.imageMargin=e.imageMargin),void 0!==e.textPosition&&(t.textPosition=e.textPosition),void 0!==e.imagePosition&&(t.imagePosition=e.imagePosition),void 0!==e.font&&(t.font=e.font),void 0!==e.textLineHeight&&(t.textLineHeight=e.textLineHeight)}function Ke(t,e){void 0!==e.strokeStyle&&(t.strokeStyle=e.strokeStyle),void 0!==e.fillStyle&&(t.fillStyle=e.fillStyle),void 0!==e.textFillStyle&&(t.textFillStyle=e.textFillStyle),void 0!==e.lineWidth&&(t.lineWidth=e.lineWidth),void 0!==e.isStretchable&&(t.isStretchable=e.isStretchable),void 0!==e.isSelectable&&(t.isSelectable=e.isSelectable),void 0!==e.isContextHandle&&(t.isContextHandle=e.isContextHandle),void 0!==e.isShadowed&&(t.isShadowed=e.isShadowed),void 0!==e.font&&(t.font=e.font),void 0!==e.roundedCornerSize&&(t.roundedCornerSize=e.roundedCornerSize),void 0!==e.isOrientedText&&(t.isOrientedText=e.isOrientedText),void 0!==e.isOpaque&&(t.isOpaque=e.isOpaque),void 0!==e.arrowDst&&(t.arrowDst=e.arrowDst),void 0!==e.arrowOrg&&(t.arrowOrg=e.arrowOrg),void 0!==e.lineStyle&&(t.lineStyle=e.lineStyle),void 0!==e.orthoMargin&&(t.orthoMargin=e.orthoMargin),void 0!==e.points&&(t.points=e.points.slice())}function Qe(t,n){var i;if(X=!0,n)e.isNode(t)?oe(t):e.isLink(t)&&pe(t);else{if(t.getIsSelected())l.push(t);else{for(i=l.length-1;i>=0;i--)if(t===l[i])break;l.splice(i,1)}e.canSendSelectionChangedEvent&&jt(t),t.refresh()}}function Ze(){if(0===V){var t=e.canvas.getContext("2d");en(t),tn()}}function Ve(t){null===t&&(t=new gt(0,0,e.canvas.width/e.zoom,e.canvas.height/e.zoom)),null===S?S=t:S.boundingRect(t)}function tn(){S=null}function en(t){t.save(),t.scale(e.zoom,e.zoom),nn(t,S),on(t,S),null!==e.ownerDraw&&null!==S&&e.ownerDraw(t),rn(t,S),an(t,S),sn(t,O),xn(t),t.restore()}function nn(t,e){null!==e&&(t.beginPath(),t.moveTo(e.left,e.top),t.lineTo(e.left+e.width,e.top),t.lineTo(e.left+e.width,e.top+e.height),t.lineTo(e.left,e.top+e.height),t.closePath(),t.clip())}function on(t,n){null!==n&&(t.fillStyle=e.fillStyle,t.fillRect(n.left,n.top,n.width,n.height),e.gridDraw&&ln(t,e.gridSizeX,e.gridSizeY,e.gridStrokeStyle,n))}function ln(t,e,n,i,o){var l,s,r,a,h,d;for(l=Math.floor(o.left/e)*e,s=Math.floor(o.top/n)*n,r=o.left+o.width,a=o.top+o.height,t.strokeStyle=i,t.lineWidth=.5,h=l;h<=r;h+=e)t.beginPath(),t.moveTo(h,o.top),t.lineTo(h,o.top+o.height),t.stroke();for(d=s;d<=a;d+=n)t.beginPath(),t.moveTo(o.left,d),t.lineTo(o.left+o.width,d),t.stroke()}function sn(t,e){var n;if(null!==e&&!tt&&!ot&&!it&&!st&&!lt)if(null!==e.pins)for(n=0;n<L.length;n++)pn(t,L[n]);else null!==I&&gn(t,I)}function rn(t,n){var l,s,r,a,h;if(null!==n)for(h=Ct?o._getItems(n):i,l=0;l<h.length;l++)s=h[l],r=s.lineWidth+e.handleSize,a=e.isNode(s)?ie(s):Ce(s),a=a.inflate(r,r),a.intersectsWith(n)&&(e.isNode(s)?kn(t,s):zn(t,s))}function an(t,e){var n;if(null!==e)for(n=0;n<l.length;n++)hn(t,e,l[n])}function hn(t,n,i){var o,l,s,r;if(l=[],s=i.lineWidth+e.handleSize,r=e.isNode(i)?ie(i):Ce(i),r=r.inflate(s,s),r.intersectsWith(n))if(Bt(i)){for(ne(i,l),o=0;o<l.length;o++)fn(t,l[o]);e.canShowContextHandle&&i.isContextHandle&&dn(t,i)}else if(Et(i)){for(ge(i,l),o=0;o<l.length;o++)yn(t,l[o]);e.canShowContextHandle&&i.isContextHandle&&un(t,i),"bezier"===i.getLineStyle()&&mn(t,i)}}function dn(t,e){var n;n=te(e),null!==n&&cn(t,n.left,n.top)}function un(t,e){var n;n=ee(e),null!==n&&cn(t,n.left,n.top)}function cn(t,n,i){var o,l;o=2*e.contextHandleSize/5-2,t.lineWidth=1,t.strokeStyle=e.contextHandleStrokeStyle,l=t.createLinearGradient(n,i,n+o,i+o),l.addColorStop(0,e.contextHandleGradientColor1),l.addColorStop(1,e.contextHandleGradientColor2),t.fillStyle=l,yt.drawEllipse(t,n,i,o,o),t.stroke(),t.fill(),n+=1+o,l=t.createLinearGradient(n,i,n+o,i+o),l.addColorStop(0,e.contextHandleGradientColor1),l.addColorStop(1,e.contextHandleGradientColor2),t.fillStyle=l,yt.drawEllipse(t,n,i,o,o),t.stroke(),t.fill(),n+=1+o,l=t.createLinearGradient(n,i,n+o,i+o),l.addColorStop(0,e.contextHandleGradientColor1),l.addColorStop(1,e.contextHandleGradientColor2),t.fillStyle=l,yt.drawEllipse(t,n,i,o,o),t.stroke(),t.fill()}function fn(t,n){var i;t.lineWidth=1,i=t.createLinearGradient(n.left,n.top,n.left+n.width,n.top+n.height),i.addColorStop(0,e.handleGradientColor1),i.addColorStop(1,e.handleGradientColor2),t.fillStyle=i,t.strokeStyle=e.handleStrokeStyle,yt.drawEllipse(t,n.left,n.top,n.width,n.height),t.stroke(),t.fill()}function pn(t,n){var i;t.lineWidth=1,i=t.createLinearGradient(n.left,n.top,n.left+n.width,n.top+n.height),i.addColorStop(0,e.pinGradientColor1),i.addColorStop(1,e.pinGradientColor2),t.fillStyle=i,t.strokeStyle=e.pinStrokeStyle,yt.drawRectangle(t,n.left,n.top,n.width,n.height),t.stroke(),t.fill()}function gn(t,n){var i;t.lineWidth=1,i=t.createLinearGradient(n.left,n.top,n.left+n.width,n.top+n.height),i.addColorStop(0,e.centralPinGradientColor1),i.addColorStop(1,e.centralPinGradientColor2),t.fillStyle=i,t.strokeStyle=e.centralPinStrokeColor,yt.drawRectangle(t,n.left,n.top,n.width,n.height),t.stroke(),t.fill()}function yn(t,n){var i;t.lineWidth=1,i=t.createLinearGradient(n.left,n.top,n.left+n.width,n.top+n.height),i.addColorStop(0,e.handleGradientColor1),i.addColorStop(1,e.handleGradientColor2),t.fillStyle=i,t.strokeStyle=e.handleStrokeStyle,yt.drawEllipse(t,n.left,n.top,n.width,n.height),t.stroke(),t.fill()}function xn(t){tt?wn(t):et?vn(t):(lt||st)&&Sn(t)}function wn(t){var n,i,o;n=new gt(w.x,w.y,x.x-w.x,x.y-w.y),t.lineWidth=e.nodeModel.lineWidth,t.strokeStyle=e.nodeModel.strokeStyle,e.nodeModel.gradientFillStyle!==e.nodeModel.fillStyle?(i=t.createLinearGradient(n.left,n.top,n.left+n.width,n.top+n.height),i.addColorStop(0,e.nodeModel.fillStyle),i.addColorStop(1,e.nodeModel.gradientFillStyle),t.fillStyle=i):t.fillStyle=e.nodeModel.fillStyle,se(e.nodeModel)?yt.drawEllipse(t,n.left,n.top,n.width,n.height):re(e.nodeModel)?yt.drawRectangle(t,n.left,n.top,n.width,n.height):ae(e.nodeModel)?void 0!==e.nodeModel.polygon&&null!==e.nodeModel.polygon?(o=[],e.nodeModel.x=n.left,e.nodeModel.y=n.top,e.nodeModel.w=n.width,e.nodeModel.h=n.height,he(e.nodeModel,o),yt.drawPolygon(t,o)):yt.drawRectangle(t,n.left,n.top,n.width,n.height):e.nodeModel.drawShape(t,n.left,n.top,n.width,n.height),t.stroke(),t.fill()}function vn(t){t.lineWidth=e.linkModel.lineWidth,t.strokeStyle=e.linkModel.strokeStyle,t.beginPath(),t.moveTo(w.x,w.y),t.lineTo(x.x,x.y),t.stroke()}function Sn(t){t.strokeStyle=e.selRectStrokeStyle,t.fillStyle=e.selRectFillStyle,t.lineWidth=e.selRectLineWidth,t.strokeRect(b.left,b.top,b.width,b.height),t.fillRect(b.left,b.top,b.width,b.height)}function mn(t,n){t.lineWidth=.2,t.strokeStyle=e.bezierSelectionLinesStrokeStyle,t.moveTo(n.points[0].x,n.points[0].y),t.lineTo(n.points[1].x,n.points[1].y),t.moveTo(n.points[3].x,n.points[3].y),t.lineTo(n.points[2].x,n.points[2].y),t.stroke()}function bn(t,e){t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY,t.shadowBlur=e.shadowBlur,t.shadowColor=e.shadowColor}function kn(t,e){t.save(),Mn(t,e),t.restore(),t.save(),Pn(t,e),t.restore()}function Mn(t,n){var i,o;n.isShadowed&&bn(t,e),t.lineWidth=n.lineWidth,t.strokeStyle=n.strokeStyle,se(n)?yt.drawEllipse(t,n.x,n.y,n.w,n.h):re(n)?yt.drawRectangle(t,n.x,n.y,n.w,n.h):ae(n)?void 0!==n.polygon&&null!==n.polygon?(o=[],he(n,o),yt.drawPolygon(t,o)):yt.drawRectangle(t,n.x,n.y,n.w,n.h):void 0!==n.drawShape&&null!==n.drawShape?n.drawShape(t,n.x,n.y,n.w,n.h):yt.drawRectangle(t,n.x,n.y,n.w,n.h),t.stroke(),n.gradientFillStyle!==n.fillStyle?(i=t.createLinearGradient(n.x,n.y,n.x+n.w,n.y+n.h),i.addColorStop(0,n.fillStyle),i.addColorStop(1,n.gradientFillStyle),t.fillStyle=i):t.fillStyle=n.fillStyle,t.fill(),void 0!==n.fillShape&&null!==n.fillShape&&n.fillShape(t,n.x,n.y,n.w,n.h)}function Pn(t,e){var n,i,o,l,s,r,a,h;if((null!==e.text&&0!==e.text.length||null!==e.image)&&(h=e.lineWidth/2,a=ie(e),a=a.inflate(h,h),nn(t,a),void 0!==e.image&&null!==e.image&&(o=a.left+e.imageMargin.left,l=a.top+e.imageMargin.top,s=Math.max(0,a.width-e.imageMargin.left-e.imageMargin.right),r=Math.max(0,a.height-e.imageMargin.top-e.imageMargin.bottom),n=An(e,new gt(o,l,s,r),e.image),t.drawImage(e.image,n.left,n.top,n.width,n.height)),void 0!==e.text&&null!==e.text&&e.text.length>0)){switch(o=a.left+e.textMargin.left,l=a.top+e.textMargin.top,s=Math.max(0,a.width-e.textMargin.left-e.textMargin.right),r=Math.max(0,a.height-e.textMargin.top-e.textMargin.bottom),t.fillStyle=e.textFillStyle,t.font=e.font,t.textBaseline="top",i={width:0,height:0},null!==e.textLineHeight&&(i=yt.multiFillText(t,e.text,0,0,e.textLineHeight,s,!1)),e.textPosition){case"leftTop":t.textAlign="start";break;case"centerTop":t.textAlign="center",o+=s/2;break;case"rightTop":t.textAlign="end",o+=s;break;case"leftMiddle":t.textAlign="start",null===e.textLineHeight&&(t.textBaseline="middle"),l+=r/2-i.height/2;break;case"centerMiddle":t.textAlign="center",null===e.textLineHeight&&(t.textBaseline="middle"),o+=s/2,l+=r/2-i.height/2;break;case"rightMiddle":t.textAlign="end",null===e.textLineHeight&&(t.textBaseline="middle"),o+=s,l+=r/2-i.height/2;break;case"leftBottom":t.textAlign="start",null===e.textLineHeight&&(t.textBaseline="bottom"),l+=r-i.height;break;case"centerBottom":t.textAlign="center",null===e.textLineHeight&&(t.textBaseline="bottom"),o+=s/2,l+=r-i.height;break;case"rightBottom":t.textAlign="end",null===e.textLineHeight&&(t.textBaseline="bottom"),o+=s,l+=r-i.height;break}null!==e.textLineHeight?yt.multiFillText(t,e.text,o,l,e.textLineHeight,s,!0):t.fillText(e.text,o,l)}}function An(t,e,n){var i=e.doclone();switch(i.width=n.width,i.height=n.height,t.imagePosition){case"leftTop":break;case"leftMiddle":i.top+=e.height/2-i.height/2;break;case"leftBottom":i.top+=e.height-i.height;break;case"rightTop":i.left+=e.width-i.width;break;case"rightMiddle":i.left+=e.width-i.width,i.top+=e.height/2-i.height/2;break;case"rightBottom":i.left+=e.width-i.width,i.top+=e.height-i.height;break;case"centerTop":i.left+=e.width/2-i.width/2;break;case"centerMiddle":i.left+=e.width/2-i.width/2,i.top+=e.height/2-i.height/2;break;case"centerBottom":i.left+=e.width/2-i.width/2,i.top+=e.height-i.height;break}return i}function zn(t,e){var n,i,o,l,s,r,a,h,d,u,c;switch(t.save(),e.isShadowed&&bn(t,e.flow),t.lineWidth=e.lineWidth,t.strokeStyle=e.strokeStyle,e.getLineStyle()){case"polyline":case"database":case"orthogonal":n=e.roundedCornerSize,n>0&&e.points.length>2?yt.drawPolylineRounded(t,e.points,n):yt.drawPolyline(t,e.points);break;case"spline":i=[],yt.getSplinePoints(e.points,i),yt.drawPolyline(t,i);break;case"bezier":yt.drawBezier(t,e.points[0],e.points[1],e.points[2],e.points[3]);break}t.stroke(),void 0!==e.arrowDst&&null!==e.arrowDst&&_n(t,e),void 0!==e.arrowOrg&&null!==e.arrowOrg&&Ln(t,e),t.restore(),void 0!==e.text&&null!==e.text&&e.text.length>0&&(o=[],"bezier"===e.lineStyle?yt.flattenBezier(e.points[0],e.points[1],e.points[2],e.points[3],o):o=e.points,l=new Dt(o),s=l.getPointAtFractionLength(.5),null!==s&&(r=l.getTangent(),null!==r?(c=Math.atan2(r.y,r.y)*(180/Math.PI),r.y<0&&(c+=180)):c=0,t.translate(s.x,s.y),e.isOrientedText&&t.rotate(-c),t.font=e.font,a=t.measureText(e.text),h=a.width,d=1.2*parseInt(e.font,10),e.isOpaque&&void 0!==d?(u=new gt(-h/2,-d/2,h,d),u.inflate(2,2),t.fillStyle=e.flow.fillStyle,t.fillRect(u.left,u.top,u.width,u.height),t.fillStyle=e.textFillStyle,t.textBaseline="middle",t.fillText(e.text,-h/2,0)):(t.fillStyle=e.textFillStyle,t.fillText(e.text,-h/2,-2)),e.isOrientedText&&t.rotate(c),t.translate(-s.x,-s.y)))}function _n(t,e){var n,i,o;n=e.points[e.points.length-2],i=e.points[e.points.length-1],"bezier"===e.getLineStyle()&&(n=yt.getFirstPointOfLastSegmentOfBezier(e.points[0],e.points[1],e.points[2],e.points[3])),o=Math.atan2(i.y-n.y,i.x-n.x),t.fillStyle=e.fillStyle,t.strokeStyle=e.strokeStyle,yt.drawArrow(t,yt.translateShape(yt.rotateShape(e.arrowDst,o),i.x,i.y))}function Ln(t,e){var n,i,o;n=e.points[1],i=e.points[0],"bezier"===e.getLineStyle()&&(n=yt.getFirstPointOfLastSegmentOfBezier(e.points[3],e.points[2],e.points[1],e.points[0])),o=Math.atan2(i.y-n.y,i.x-n.x),t.fillStyle=e.fillStyle,t.strokeStyle=e.strokeStyle,yt.drawArrow(t,yt.translateShape(yt.rotateShape(e.arrowOrg,o),i.x,i.y))}function In(t,n){var i,o,l,s,r,a,h,d;return d=ie(t),h=!1,d.containsPoint(n)&&(re(t)?h=!0:se(t)?(r=d.centerPoint(),o=d.height/2*(n.x-r.x),l=d.width/2*(n.y-r.y),s=d.width/2*d.height/2,o*o+l*l<=s*s&&(h=!0)):ae(t)?(i=e.canvas.getContext("2d"),void 0!==t.polygon&&null!==t.polygon?(a=[],he(t,a),yt.drawPolygon(i,a),h=i.isPointInPath(n.x,n.y)):h=!0):(i=e.canvas.getContext("2d"),void 0!==t.drawShape&&null!==t.drawShape&&(t.drawShape(i,t.x,t.y,t.w,t.h),h=i.isPointInPath(n.x,n.y)))),h}function On(t,e){var n,i;for(i=ie(t),n=0;n<L.length;n++)i.boundingRect(L[n]);return i.containsPoint(e)}function Cn(t,n){var i,o,l,s;return i=!1,o=Ce(t),l=0,o.containsPoint(n)&&(s=[],"bezier"===t.getLineStyle()?yt.flattenBezier(t.points[0],t.points[1],t.points[2],t.points[3],s):s=t.points,l=yt.getDistanceBetweenPointAndPolyline(s,s.length,n,e.linkSelectionAreaWidth),l<=e.linkSelectionAreaWidth&&(z=l,i=!0)),i}function Tn(t,e){var n=ie(t);return{x:n.left+n.width/100*t.pins[e][0],y:n.top+n.height/100*t.pins[e][1]}}function Dn(t){var n,i;if(!rt){if(e.hitArea="outSide",j="default",s=Gn(t,nt?d.nodes:d.items),null!==O)if(null===s)if(On(O,t)){if(Rn(O,t))return}else oe(O),O=null,L.splice(0,L.length),I=null,Ze();else s!==O&&(oe(O),O=null,L.splice(0,L.length),I=null,Ze());if(null===s||(Bt(s)?(e.hitArea="node",!et&&e.canMoveNode&&(s.isXMoveable||s.isYMoveable)&&(j="move")):e.hitArea="_link",!Bt(s)||(O=s,!Rn(s,t))))for(!_&&et&&(null!==s&&Bt(s)||(_=!0)),n=0;n<l.length;n++)i=l[n],Bt(i)?Bn(i,t):Et(i)&&En(i,t)}}function Rn(t,n){var i;if(et){if(e.canDrawLink&&t.isInLinkable&&(t.refresh(),null!==t.pins))for(Nn(t,L),i=0;i<L.length;i++)if(L[i].containsPoint(n))return D=i,L[i].centerPoint(),e.hitArea="pin",j="crosshair",!0}else if(e.canDrawLink&&t.isOutLinkable)if(t.refresh(),null!==t.pins){for(Nn(t,L),i=0;i<L.length;i++)if(L[i].containsPoint(n))return T=i,v=L[i].centerPoint(),e.hitArea="pin",j="crosshair",!0}else if(I=Hn(t),I.containsPoint(n))return v=I.centerPoint(),e.hitArea="centralPin",j="crosshair",!0;return!1}function Fn(t,e){var n,i;if(i=-1,null!==t.pins)for(Nn(t,L),n=0;n<L.length;n++)if(L[n].containsPoint(e)){i=n;break}return i}function Nn(t,n){var i,o,l,s,r;if(r=e.pinSize,n.splice(0,n.length),void 0!==t.pins&&null!==t.pins)for(s=0;s<t.pins.length;s++)i=ie(t),o=i.left+i.width/100*t.pins[s][0],l=i.top+i.height/100*t.pins[s][1],n.push(new gt(o-r/2,l-r/2,r,r))}function Hn(t){var n,i,o,l;return l=e.pinSize,n=ie(t),i=n.left+n.width/2,o=n.top+n.height/2,new gt(i-l/2,o-l/2,l,l)}function jn(t){var n,i;return n=t.lineWidth+5*e.handleSize/2,t.isContextHandle&&(n+=e.contextHandleSize),i=ie(t),i=i.inflate(n,n),i}function Wn(t){var n,i;return i=t.lineWidth+e.handleSize,t.isContextHandle&&(i+=e.contextHandleSize),n=Ce(t),n=n.inflate(i,i),n}function Bn(t,n){var i,o,l;if(o=[],l=jn(t),l.containsPoint(n)){if(e.canShowContextHandle&&t.isContextHandle&&M&&(l=te(t),null!==l&&l.containsPoint(n)))return Ht(t),void(M=!1);for(ne(t,o),i=0;i<o.length;i++)if(o[i].containsPoint(n)){switch(e.hitArea="resizeHandle",e._resizeHandle=i,e._resizeHandle){case h.left:case h.right:e.canSizeNode&&t.isXSizeable?j="e-resize":(e.hitArea="outSide",j="default");break;case h.down:case h.up:e.canSizeNode&&t.isYSizeable?j="n-resize":(e.hitArea="outSide",j="default");break;case h.leftDown:case h.rightUp:case h.leftUp:case h.rightDown:e.canSizeNode&&(t.isXSizeable||t.isYSizeable)?t.isXSizeable?t.isYSizeable?j=e._resizeHandle===h.leftDown||e._resizeHandle===h.rightUp?"ne-resize":"se-resize":(e.hitArea="leftHandle",j="e-resize"):(e.hitArea="upHandle",j="n-resize"):(e.hitArea="outSide",j="default");break;default:break}break}}}function En(t,n){var i,o,l,s,r,h;if(!(nt||t.points.length<2)&&(r=Wn(t),r.containsPoint(n))){if(e.canShowContextHandle&&t.isContextHandle&&M&&(r=ee(t),null!==r&&r.containsPoint(n)))return Ht(t),void(M=!1);if(h=t.points.length,xe(t)){for(s=2*h-1,i=0;i<s;i++)if(i%2===0?l=t.points[i/2]:(o=Math.round(i/2)-1,l=yt.middlePoint(t.points[o],t.points[o+1])),r=new gt(l.x-e.handleSize/2,l.y-e.handleSize/2,e.handleSize,e.handleSize),r.containsPoint(n)){F=t,e.hitArea="stretchHandle",0===i?e.canChangeOrg&&(R=a.first,j="crosshair"):i===s-1?e.canChangeDst&&(R=a.last,j="crosshair"):e.canStretchLink&&t.isStretchable?(j="crosshair",R=i%2!==0?a.add:a.del):R=a.none,A=i%2!==0?Math.round(i/2)-1:i/2;break}}else for(s=h,i=0;i<s;i++)if(l=t.points[i],r=new gt(l.x-e.handleSize/2,l.y-e.handleSize/2,e.handleSize,e.handleSize),r.containsPoint(n)){e.hitArea="stretchHandle",F=t,0===i?e.canChangeOrg&&(R=a.first,j="crosshair"):i===h-1?e.canChangeDst&&(R=a.last,j="crosshair"):e.canStretchLink&&t.isStretchable?(j="crosshair",R=a.change):R=a.none,A=i;break}}}function Gn(t,n){var l,s,r,a;for(a=Ct?o._getItems(new gt(t.x-5,t.y-5,10,10)):i,r=null,z,l=0;l<a.length;l++)switch(s=a[l],n){case d.items:if(Bt(s))In(s,t)&&(r=s);else if(Et(s)){if(null!==r&&Bt(r)&&(s.dst===r||s.org===r))continue;Cn(s,t)&&z<=e.linkSelectionAreaWidth&&(z,r=s)}break;case d.nodes:Bt(s)&&In(s,t)&&(r=s);break;case d.links:Et(s)&&Cn(s,t)&&z<=e.linkSelectionAreaWidth&&(z,r=s);break;case d.selectableItems:if(s.isSelectable)if(Bt(s))In(s,t)&&(r=s);else if(Et(s)){if(null!==r&&Bt(r)&&(s.dst===r||s.org===r))continue;Cn(s,t)&&z<=e.linkSelectionAreaWidth&&(z,r=s)}break;case d.selectableNodes:s.isSelectable&&Bt(s)&&In(s,t)&&(r=s);break;case d.selectableLinks:s.isSelectable&&Et(s)&&Cn(s,t)&&z<=e.linkSelectionAreaWidth&&(z,r=s);break}return r}function Xn(){V++}function Yn(){V--,0===V&&(qn(),Ct&&Wt(),e.refresh())}function Un(){e.isFixedSize?(e.canvas.width=N,e.canvas.height=H):(e.canvas.width=k.width*e.zoom+N,e.canvas.height=k.height*e.zoom+H),Ve(null)}function qn(){if(0===V){var t=Jn();t.equals(k)||(k=t,Un())}}function $n(t){if(0===V){var e=k.unionRect(t);e.equals(k)||(k=e,Un())}}function Jn(){var t,n,o,l,s;for(o=new gt(0,0,0,0),s=!0,t=0;t<i.length;t++)n=i[t],l=e.isNode(n)?ie(n):Ce(n),s?(o=l,s=!1):o.boundingRect(l);return o.width+=o.left,o.height+=o.top,o.left=0,o.top=0,o}function Kn(t){var n,i,o,l,s,r,a;l=e.canvas.width,s=e.canvas.height,n=e.canvas.parentNode,null!==n&&void 0!==n&&(r=parseInt(n.style.width,10),a=parseInt(n.style.height,10),isNaN(r)||isNaN(a)||(l=r,s=a)),i=l/t.width,o=s/t.height,e.zoom=i>o?o:i,e.refresh(),null!==n&&void 0!==n&&(n.scrollLeft=t.left*e.zoom,n.scrollTop=t.top*e.zoom)}function Qn(t,n){return!!n.isInLinkable&&(!(!e.canReflexLink&&t.org===n)&&!(!e.canMultiLink&&ce(t.org,n)))}function Zn(t,n){return!!n.isOutLinkable&&(!(!e.canReflexLink&&t.dst===n)&&!(!e.canMultiLink&&fe(t.dst,n)))}function Vn(){e.canvas.setCapture?e.canvas.setCapture():window.addEventListener&&window.addEventListener("mousemove",e.canvas,!0)}function ti(){e.canvas.releaseCapture?e.canvas.releaseCapture():window.removeEventListener&&window.removeEventListener("mousemove",e.canvas,!0)}function ei(n){var i,o,l;return l=t.getBoundingClientRect(),i=n.clientX-l.left,o=n.clientY-l.top,i+=e.xCustomOffset,o+=e.yCustomOffset,{x:i,y:o}}function ni(t){e.refresh()}function ii(t){t.preventDefault(),si(t)}function oi(t){t.preventDefault(),ri(t)}function li(t){ai(t)}function si(t){var n,i,o,l,r,a,h,d,u,c;if(o=ei(t),l={out:0,outShift:1,node:2,selNode:3,nodeShift:4,selNodeShift:5,link:6,selLink:7,linkShift:8,selLinkShift:9},r=e.canMultiSelect&&(t.shiftKey||t.ctrlKey),a=!1,h=!1,d=!1,u=!1,c=!1,o.x=o.x/e.zoom,o.y=o.y/e.zoom,M=!0,P=!0,J=!1,Y=!1,U=!1,$=!1,q=!1,K=!1,Q=!1,Z=!1,y=o,w=x=o,b=new gt(w.x,w.y,0,0),Dn(o),"stretchHandle"!==e.hitArea){if("resizeHandle"===e.hitArea)return e.gridSnap&&(x=yt.adjustGrid(o,e.gridSizeX,e.gridSizeY)),void($=!0);if("pin"===e.hitArea||"centralPin"===e.hitArea)return q=!0,_=!1,C=O,x=v,void(w=v);switch(i=s,null!==i&&i.isSelectable?Et(i)?n=i.getIsSelected()?r?l.selLinkShift:l.selLink:r?l.linkShift:l.link:Bt(i)&&(n=i.getIsSelected()?r?l.selNodeShift:l.selNode:r?l.nodeShift:l.node):n=r?l.outShift:l.out,n){case l.out:Kt(),"none"===e.mouseSelection?e.canDrawNode&&(h=!0):"zoom"===e.mouseSelection?u=!0:"pan"===e.mouseSelection?c=!0:"none"!==e.mouseSelection&&"zoom"!==e.mouseSelection&&(d=!0);break;case l.link:Kt(),null!==i&&i.setIsSelected(!0);break;case l.node:Kt(),null!==i&&i.setIsSelected(!0),null!==i&&e.canMoveNode&&(i.isXMoveable||i.isYMoveable)&&(a=!0);break;case l.selNode:null!==i&&e.canMoveNode&&(i.isXMoveable||i.isYMoveable)&&(a=!0);break;case l.selLink:e.canMoveNode&&(a=!0);break;case l.selNodeShift:case l.nodeShift:case l.selLinkShift:case l.linkShift:null!==i&&i.setIsSelected(!i.getIsSelected());break;default:break}a?(Y=!0,e.gridSnap&&(x=yt.adjustGrid(x,e.gridSizeX,e.gridSizeY))):h?(U=!0,e.gridSnap&&(x=yt.adjustGrid(x,e.gridSizeX,e.gridSizeY)),w=x):d?K=!0:u?Q=!0:c&&(Z=!0),Ze()}else J=!0}function ri(t){var n,i;if(n=ei(t),i=e.canvas.parentNode,null!==i&&(dt={x:n.x-i.scrollLeft,y:n.y-i.scrollTop}),n.x=n.x/e.zoom,n.y=n.y/e.zoom,P){if(Math.abs(n.x-y.x)<u&&Math.abs(n.y-y.y)<u)return;P=!1}Dn(n),e.canvas.style.cursor=j,M&&(U?hi(fi,i)||vi(n):q?hi(pi,i)||bi(n):Y?hi(di,i)||Pi(n):$?hi(ui,i)||Oi(n):J?hi(ci,i)||Fi(n):K?hi(gi,i)||Ei(n):Q?hi(yi,i)||$i(n):Z&&Qi(n))}function ai(t){ti(),M&&(M=!1,tt?(tt=!1,Si()):et?(et=!1,ki()):ot?(ot=!1,Li()):it?(it=!1,Di()):nt?(nt=!1,Ni()):lt?(lt=!1,Gi()):st?(st=!1,Ji()):rt&&(rt=!1,Zi()))}function hi(t,n){var i,o,l,s,r;return null!==n&&void 0!==n&&(s=parseInt(n.style.width,10),r=parseInt(n.style.height,10),!isNaN(s)&&!isNaN(r)&&(i=n.scrollLeft,o=n.scrollTop,l=new gt(0,0,s,r),l.width-=20,l.height-=20,l.containsPoint(dt)?(null!==ct&&clearInterval(ct),ut=!1,!1):(e.canDragScroll&&(at="none",ht="none",dt.x>l.left+l.width?at="right":dt.x<l.left&&i>0&&(at="left"),dt.y>l.top+l.height?ht="bottom":dt.y<l.top&&o>0&&(ht="top"),"none"===at&&"none"===ht||ut||(ct=setInterval(t,f),ut=!0)),!0)))}function di(){Pi(xi())}function ui(){Oi(xi())}function ci(){Fi(xi())}function fi(){vi(xi())}function pi(){bi(xi())}function gi(){Ei(xi())}function yi(){$i(xi())}function xi(){var t,n,i,o,l;return M||(null!==ct&&clearInterval(ct),ut=!1),t=0,n=0,"none"!==at&&(t="right"===at?p:-p),"none"!==ht&&(n="bottom"===ht?g:-g),i=e.canvas.parentNode,null!==i&&void 0!==i?(o=i.scrollLeft,l=i.scrollTop,i.scrollLeft=o+t,i.scrollTop=l+n,{x:i.scrollLeft+dt.x,y:i.scrollTop+dt.y}):{x:0,y:0}}function wi(){tt=!0,Vn()}function vi(t){var n,i;e.gridSnap&&(t=yt.adjustGrid(t,e.gridSizeX,e.gridSizeY)),tt||wi(),i=e.nodeModel.lineWidth+e.handleSize,n=yt.getRectByTwoPoints(w,x),n=n.inflate(i,i),Ve(n),n=yt.getRectByTwoPoints(w,t),n=n.inflate(i,i),Ve(n),Ze(),x=t}function Si(){var t,n,i,o;t=yt.getRectByTwoPoints(w,x),i=e.nodeModel.lineWidth+e.handleSize,n=t.inflate(i,i),Ve(n),Ze(),e.canDrawNode&&t.width>c&&t.height>c&&(o=Gt(t.left,t.top,t.width,t.height),null!==o&&o.isSelectable&&(Kt(),o.setIsSelected(!0)))}function mi(){et=!0,Vn()}function bi(t){var n,i;et||mi(),_||null!==s&&Bt(s)||(_=!0),i=2*e.linkModel.lineWidth,n=yt.getRectByTwoPoints(w,x),n=n.inflate(i,i),Ve(n),n=yt.getRectByTwoPoints(w,t),n=n.inflate(i,i),Ve(n),x=t,Ze()}function ki(){var t,n,i,o,l,s;if(s=2*e.linkModel.lineWidth,t=yt.getRectByTwoPoints(w,x),t=t.inflate(s,s),Ve(t),Ze(),e.canDrawLink&&(n=T,i=D,T=null,D=null,o=null!==O?O:Gn(x,d.nodes),null!==o&&null!==C&&o.isInLinkable)){if(C===o){if(!e.canReflexLink)return;if(!_)return}!e.canMultiLink&&ce(C,o)||null!==C.pins&&null===n||null!==o.pins&&null===i||(e.linkModel.getLineStyle(),l=Yt(C,o,"",n,i),null!==l&&l.isSelectable&&(Kt(),l.setIsSelected(!0)))}}function Mi(){var t,i,o,s,r;for(ot=!0,Vn(),m=zi(),t=0;t<l.length;t++)if(s=l[t],Bt(s))for(n.undoAllowed()&&(s.tsk=new St(e,s,ie(s))),r=s.getLinks(),i=0;i<r.length;i++)r[i].flag=!0;for(t=0;t<l.length;t++)if(s=l[t],Bt(s))for(r=s.getLinks(),i=0;i<r.length;i++)o=r[i],o.flag&&(o.tsk=new Pt(e,o),o.flag=!1)}function Pi(t){var i,o,s,r;if(e.gridSnap&&(t=yt.adjustGrid(t,e.gridSizeX,e.gridSizeY)),ot||Mi(),n.skipUndo=!0,s=t.x-x.x,r=t.y-x.y,x=t,m.left+s<0&&(s-=m.left+s),m.top+r<0&&(r-=m.top+r),0!==s||0!==r){for(_i(),i=0;i<l.length;i++)o=l[i],Bt(o)&&Ai(o,s,r);m=zi()}qn(),Ze(),n.skipUndo=!1}function Ai(t,e,n){var i,l,s,r,a,h,d,u;if(d=t.isXMoveable?e:0,u=t.isYMoveable?n:0,0!==d||0!==u){for(Ct&&o._remove(t),h=de(t),l=0;l<h.length;l++){if(r=h[l],a=r.points.length,pe(r),r.org.getIsSelected()&&r.dst.getIsSelected()){if(r.flag)for(r.flag=!1,s=0;s<a;s++)i=r.points[s],r.points[s]={x:i.x+d,y:i.y+u}}else t===r.dst&&(null!==r.dst.pins||r.isDstPointAdjustable)&&(i=r.points[a-1],r.points[a-1]={x:i.x+d,y:i.y+u}),t===r.org&&(null!==r.org.pins||r.isOrgPointAdjustable)&&(i=r.points[0],r.points[0]={x:i.x+d,y:i.y+u});pe(r),r.refresh()}oe(t),t.x+=d,t.y+=u,t.bounds=ie(t),Ct&&o._insert(t,t.bounds),t.refresh(),ue(t)}}function zi(){var t,n,i,o,s,r,a;for(i=0;i<l.length;i++)if(s=l[i],n=e.isNode(s)?ie(s):Ce(s),0===i?t=n:t.boundingRect(n),Bt(s))for(r=s.getLinks(),o=0;o<r.length;o++)a=r[o],a.org.getIsSelected()&&a.dst.getIsSelected()&&t.boundingRect(Ce(a));else Et(s)&&0===i&&s.org.getIsSelected()&&s.dst.getIsSelected()&&(t=Ce(s));return t}function _i(){var t,e,n,i;for(t=0;t<l.length;t++)if(i=l[t],Bt(i))for(n=i.getLinks(),e=0;e<n.length;e++)n[e].flag=!0}function Li(){var t,e,i,o,s;if(n.undoAllowed()){for(n._beginActionInternal("AF_moveSelectedNodes"),_i(),o=0;o<l.length;o++)if(t=l[o],Bt(t))for(n._submitTask(t.tsk),t.tsk=null,i=t.getLinks(),s=0;s<i.length;s++)e=i[s],pe(e),void 0!==e.flag&&(e.flag&&(e.flag=!1,null!==e.tsk&&(n._submitTask(e.tsk),e.tsk=null)),delete e["flag"]);n._endActionInternal()}}function Ii(){var t,i,o,s;for(it=!0,Vn(),t=0;t<l.length;t++)if(o=l[t],Bt(o))for(n.undoAllowed()&&(o.tsk=new St(e,o,ie(o))),s=o.getLinks(),i=0;i<s.length;i++)s[i].flag=!0}function Oi(t){var i,s,r,a,d,u,c;for(e.gridSnap&&(t=yt.adjustGrid(t,e.gridSizeX,e.gridSizeY)),it||Ii(),n.skipUndo=!0,r=t.x-x.x,a=t.y-x.y,i=0;i<l.length;i++)if(s=l[i],Bt(s)){Ct&&o._remove(s),d=ie(s),u=d.left,c=d.top;var f=u+r<0?0:r,p=c+a<0?0:a;switch(e._resizeHandle){case h.leftUp:d.width=Math.max(d.width-f,e.handleSize),d.height=Math.max(d.height-p,e.handleSize),d.left=u+f,d.top=c+p;break;case h.up:d.height=Math.max(d.height-p,e.handleSize),d.top=c+p;break;case h.rightUp:d.width=Math.max(d.width+f,e.handleSize),d.height=Math.max(d.height-p,e.handleSize),d.top=c+p;break;case h.left:d.width=Math.max(d.width-f,e.handleSize),d.left=u+f;break;case h.right:d.width=Math.max(d.width+f,e.handleSize);break;case h.leftDown:d.width=Math.max(d.width-f,e.handleSize),d.height=Math.max(p+d.height,e.handleSize),d.left=u+f;break;case h.down:d.height=Math.max(d.height+p,e.handleSize);break;case h.rightDown:d.width=Math.max(d.width+f,e.handleSize),d.height=Math.max(p+d.height,e.handleSize);break}le(s,d),s.bounds=d,Ct&&o._insert(s,s.bounds),s.refresh(),Ci(s,d)}n.skipUndo=!1,qn(),Ze(),x=t}function Ci(t,e){var n,i,o,l,s,r;for(l=t.getLinks(),o=0;o<l.length;o++)s=l[o],s.flag||(t===s.dst&&null!==s.dst.pins&&(r=s.points.length,n=0===e.width?0:(s.points[r-1].x-e.left)*e.width/e.width,i=0===e.height?0:(s.points[r-1].y-e.top)*e.height/e.height,s.points[r-1]={x:e.left+n,y:e.top+i}),t===s.org&&null!==s.org.pins&&(n=0===e.width?0:(s.points[0].x-e.left)*e.width/e.width,i=0===e.height?0:(s.points[0].y-e.top)*e.height/e.height,s.points[0]={x:e.left+n,y:e.top+i})),ye(s)&&(s.flag=!s.flag);Ti(t)}function Ti(t){var e,n,i,o;if(null!==t.pins)for(o=t.getLinks(),e=0;e<o.length;e++)i=o[e],i.org===t&&null!==i.pinOrg?i.points[0]=Tn(t,i.pinOrg):i.dst===t&&null!==i.pinDst&&(n=i.points.length,i.points[n-1]=Tn(t,i.pinDst))}function Di(){var t,e,i,o,s;if(n.undoAllowed()){for(n._beginActionInternal("AF_resizeSelectedNodes"),t=0;t<l.length;t++)i=l[t],Bt(i)&&n._submitTask(i.tsk);n._endActionInternal()}for(t=0;t<l.length;t++)if(i=l[t],Bt(i))for(s=i.getLinks(),e=0;e<s.length;e++)o=s[e],pe(o),void 0!==o.flag&&delete o["flag"];Ze()}function Ri(t){var i;nt=!0,Vn(),n.undoAllowed()&&(t.tsk=new Pt(e,t)),"database"===t.getLineStyle()?Xe(t):(Xe(t),R===a.add&&(i=yt.middlePoint(t.points[A],t.points[A+1]),Ge(t,i,A),A++))}function Fi(t){null!==F&&(nt||Ri(F),t.x<0&&(t.x=0),t.y<0&&(t.y=0),Ct&&o._remove(F),pe(F),"database"===F.getLineStyle()?ji(t,F):"orthogonal"===F.getLineStyle()?Wi(t,F):Hi(t,F),pe(F),F.bounds=Ce(F),Ct&&o._insert(F,F.bounds),x=t,qn(),Ze())}function Ni(){var t,i,o,l,s;if(t=F,F=null,A=Math.max(Math.min(A,t.points.length-1),0),i=t.points[A],xe(t)&&(R===a.add||R===a.del)&&A>0&&A<t.points.length-1&&(o=yt.getSegDist(t.points[A-1],t.points[A+1],t.points[A]),o<=e.removePointDistance))return pe(t),t.removePoint(A),pe(t),R=a.none,void Ze();if(pe(t),"database"===t.getLineStyle()?He(t):"orthogonal"===t.getLineStyle()&&je(t),null!==t.org.pins||t.isOrgPointAdjustable||Be(t),null!==t.dst.pins||t.isDstPointAdjustable||We(t),pe(t),Ze(),R===a.first&&e.canChangeOrg){if(l=Gn(i,d.nodes),null===l)return void t.tsk.undo();if(l!==t.org)return Zn(t,l)?(n.undoAllowed&&n._beginActionInternal("AF_linkStretch"),n.undoAllowed()&&n._submitTask(t.tsk),ke(t,Fn(l,i)),t.setOrg(l),Ze(),void(n.undoAllowed&&n._endActionInternal())):void t.tsk.undo()}if(R===a.last&&e.canChangeDst){if(s=Gn(i,d.nodes),null===s)return void t.tsk.undo();if(s!==t.dst)return Qn(t,s)?(n.undoAllowed&&n._beginActionInternal("AF_linkStretch"),n.undoAllowed()&&n._submitTask(t.tsk),be(t,Fn(s,i)),t.setDst(s),Ze(),void(n.undoAllowed&&n._endActionInternal())):void t.tsk.undo()}n.undoAllowed()&&n._submitTask(t.tsk)}function Hi(t,e){A>=0&&A<=e.points.length-1&&(e.points[A]=t),null!==e.org.pins||e.isOrgPointAdjustable||R===a.first||Be(e),null!==e.dst.pins||e.isDstPointAdjustable||R===a.last||We(e)}function ji(t,e){var n,i;switch(A){case 0:n=e.points[1].x-e.points[0].x,e.points[0]=t,e.points[1]={x:e.points[0].x+n,y:t.y};break;case 1:e.points[1]={x:t.x,y:e.points[1].y};break;case 2:e.points[2]={x:t.x,y:e.points[2].y};break;case 3:i=e.points[2].x-e.points[3].x,e.points[3]=t,e.points[2]={x:e.points[3].x+i,y:t.y};break}}function Wi(t,e){var n,i;n=e.points.length,3===n?0===A?e.firstSegmentHorizontal?(e.points[0]=t,e.points[1]={x:e.points[1].x,y:t.y}):(e.points[0]=t,e.points[1]={x:t.x,y:e.points[1].y}):1===A?e.firstSegmentHorizontal?(t.x=Math.min(t.x,e.dst.x+e.dst.w),t.x=Math.max(t.x,e.dst.x),t.y=Math.min(t.y,e.org.y+e.org.h),t.y=Math.max(t.y,e.org.y),null===e.org.pins&&(e.points[0]={x:t.x,y:e.points[0].y},e.points[1]={x:e.points[1].x,y:t.y}),null===e.dst.pins&&(e.points[2]={x:e.points[2].x,y:t.y},e.points[1]={x:t.x,y:e.points[1].y})):(t.x=Math.min(t.x,e.org.x+e.org.w),t.x=Math.max(t.x,e.org.x),t.y=Math.min(t.y,e.dst.y+e.dst.h),t.y=Math.max(t.y,e.dst.y),null===e.org.pins&&(e.points[0]={x:t.x,y:e.points[0].y},e.points[1]={x:t.x,y:e.points[1].y}),null===e.dst.pins&&(e.points[2]={x:e.points[2].x,y:t.y},e.points[1]={x:e.points[1].x,y:t.y})):2===A&&(e.firstSegmentHorizontal?(e.points[2]=t,e.points[1]={x:t.x,y:e.points[1].y}):(e.points[2]=t,e.points[1]={x:e.points[1].x,y:t.y})):A<=1?1===A&&(e.firstSegmentHorizontal?null!==e.org.pins?e.points[1]={x:t.x,y:e.points[1].y}:(t.y=Math.min(t.y,e.org.y+e.org.h),t.y=Math.max(t.y,e.org.y),e.points[0]={x:e.points[0].x,y:t.y},e.points[1]=t):null!==e.org.pins?e.points[1]={x:e.points[1].x,y:t.y}:(t.x=Math.min(t.x,e.org.x+e.org.w),t.x=Math.max(t.x,e.org.x),e.points[0]={x:t.x,y:e.points[0].y},e.points[1]=t)):A>=n-2&&(i=e.firstSegmentHorizontal&&(n-1)%2===0||!e.firstSegmentHorizontal&&(n-1)%2===1,A===n-2&&(i?null!==e.dst.pins?e.points[n-2]={x:e.points[n-1].x,y:t.y}:(t.x=Math.min(t.x,e.dst.x+e.dst.w),t.x=Math.max(t.x,e.dst.x),e.points[n-1]={x:t.x,y:e.points[n-1].y},e.points[n-2]=t):null!==e.dst.pins?e.points[n-2]={x:t.x,y:e.points[n-1].y}:(t.y=Math.min(t.y,e.dst.y+e.dst.h),t.y=Math.max(t.y,e.dst.y),e.points[n-1]={x:e.points[n-1].x,y:t.y},e.points[n-2]=t))),Ee(e,t,A)}function Bi(){lt=!0,Vn()}function Ei(t){var n;lt||Bi(),n=b.inflate(e.selRectLineWidth,e.selRectLineWidth),Ve(n),b=yt.getRectByTwoPoints(w,t),n=b.inflate(e.selRectLineWidth,e.selRectLineWidth),Ve(n),e.canSelectOnMouseMove&&Xi(),Ze()}function Gi(){var t=b.inflate(e.selRectLineWidth,e.selRectLineWidth);Ve(t),e.canSelectOnMouseMove||Xi(),Ze()}function Xi(){Kt();var t=b;switch(e.mouseSelection){case"selection2":e.canMultiSelect&&Yi(t);break;case"selection":e.canMultiSelect&&Ui(t);break}}function Yi(t){var n,o,l;for(Kt(),n=0;n<i.length;n++)l=i[n],o=e.isNode(l)?ie(l):Ce(l),t.containsRect(o)&&l.isSelectable&&l.setIsSelected(!0)}function Ui(t){var n,o,l;for(Kt(),n=0;n<i.length;n++)l=i[n],o=e.isNode(l)?ie(l):Ce(l),t.intersectsWith(o)&&l.isSelectable&&l.setIsSelected(!0)}function qi(){st=!0,Vn()}function $i(t){var n;st||qi(),n=b.inflate(e.selRectLineWidth,e.selRectLineWidth),Ve(n),b=yt.getRectByTwoPoints(w,t),n=b.inflate(e.selRectLineWidth,e.selRectLineWidth),Ve(n),Ze()}function Ji(){var t=b.inflate(e.selRectLineWidth,e.selRectLineWidth);Ve(t),Ze(),t.width>u&&t.height>u&&Kn(t)}function Ki(t){var n=e.canvas.parentNode;null!==n&&void 0!==n&&(rt=!0,E=n.scrollLeft,G=n.scrollTop,ft=t,Vn())}function Qi(t){var n,i,o,l,s,r;rt||Ki(t),l=e.canvas.parentNode,null!==l&&void 0!==l&&(s=parseInt(l.style.width,10),r=parseInt(l.style.height,10),isNaN(s)||isNaN(r)||(n=e.canvas.width>s||e.canvas.height>r,j=n?"pointer":"default",i=t.x>ft.x?-(t.x-ft.x):ft.x-t.x,o=t.y>ft.y?-(t.y-ft.y):ft.y-t.y,0!==i&&(E+=i,l.scrollLeft=E),0!==o&&(G+=o,l.scrollTop=G)))}function Zi(){}e=this,n=new Ft,i=[],l=[],s=null,r=[[0,0],[-10,-4],[-10,4]],a={none:0,add:1,del:2,first:3,last:4,change:5},h={leftUp:0,up:1,rightUp:2,left:3,right:4,leftDown:5,down:6,rightDown:7},d={items:0,nodes:1,links:2,selectableItems:3,selectableNodes:4,selectableLinks:5},u=8,c=8,f=100,p=20,g=20,y=[0,0],S=null,m=null,b=null,k=new gt(0,0,0,0),M=!1,P=!1,A=0,z=0,_=!1,L=[],I=null,O=null,C=null,T=null,D=null,F=null,N=t.width,H=t.height,W=35,B=!1,E=0,G=0,X=!1,Y=!1,U=!1,q=!1,$=!1,J=!1,K=!1,Q=!1,Z=!1,V=0,Ct=!0,tt=!1,et=!1,nt=!1,it=!1,ot=!1,lt=!1,st=!1,rt=!1,at="none",ht="none",ut=!1,ct=null,pt=new Tt,this.canvas=t,this.nodeModel=new xt(0,0,0,0,""),this.linkModel=new wt(null,null,""),this.isFixedSize=!1,this.canDrawNode=!0,this.canDrawLink=!0,this.canMoveNode=!0,this.canSizeNode=!0,this.canStretchLink=!0,this.canMultiLink=!0,this.canReflexLink=!0,this.canChangeOrg=!0,this.canChangeDst=!0,this.canMultiSelect=!0,this.canDragScroll=!0,this.canSelectOnMouseMove=!0,this.canSendSelectionChangedEvent=!0,this.canShowContextHandle=!0,this.mouseSelection="none",this.hitArea="outSide",this.taskManager=n,this.shadowOffsetX=5,this.shadowOffsetY=5,this.shadowBlur=2,this.shadowColor="rgba(128, 128, 192, 0.5)",this.linkSelectionAreaWidth=6,this.removePointDistance=6,this.zoom=1,this.gridSizeX=16,this.gridSizeY=16,this.gridSnap=!1,this.gridDraw=!1,this.gridStrokeStyle="rgb(192, 192, 192)",this.fillStyle="#fff",this.ownerDraw=null,this.selRectFillStyle="rgba(224, 224, 224, 0.3)",this.selRectStrokeStyle="gray",this.selRectLineWidth=1,this.bezierSelectionLinesStrokeStyle="navy",this.handleSize=6,this.handleGradientColor1="white",this.handleGradientColor2="lightgray",this.handleStrokeStyle="black",this.contextHandleSize=20,this.contextHandleStrokeStyle="navy",this.contextHandleGradientColor1="white",this.contextHandleGradientColor2="lightblue",this.pinSize=8,this.pinGradientColor1="white",this.pinGradientColor2="navy",this.pinStrokeStyle="white",this.centralPinGradientColor1="white",this.centralPinGradientColor2="white",this.centralPinStrokeColor="black",this.xCustomOffset=0,this.yCustomOffset=0,this.refresh=function(){Ve(null),Un(),Ze()},this.useQuadtree=function(t){Ct!==t&&(Ct=t,Ct&&Wt())},this.getItems=function(){return i},this.getSelectedItems=function(){return l},this.getHitItem=function(){return s},this.addNode=function(t,e,n,i,o){return Gt(t,e,n,i,o)},this.addLink=function(t,e,n,i,o){return Yt(t,e,n,i,o)},this.removeNode=function(t){Xt(t)},this.removeLink=function(t){Ut(t)},this.deleteSel=function(){$t()},this.clear=function(){qt()},this.selectAll=function(){Jt()},this.unselectAll=function(){Kt()},this.beginUpdate=function(){Xn()},this.endUpdate=function(){Yn()},this.invalidateRect=function(t,e,n,i){Ve(new gt(t,e,n,i))},this.isMovingNode=function(){return ot},this.isCreatingNode=function(){return tt},this.isCreatingLink=function(){return et},this.isStretchingLink=function(){return nt},this.isResizingNode=function(){return it},this.isSelecting=function(){return lt},this.isZooming=function(){return st},this.isPanning=function(){return rt},this.setSelChangedFlag=function(t){X=t},this.isSelChanged=function(){return X},this.isNode=function(t){return Bt(t)},this.isLink=function(t){return Et(t)},this.sendToBack=function(){Zt()},this.bringToFront=function(){Vt()},this.zoomRectangle=function(t,e,n,i){Kn(new gt(t,e,n,i))},this.getXExtent=function(){return k.width},this.getYExtent=function(){return k.height},Nt(this.canvas)}}),F=[{id:"001",x:0,y:0,w:80,h:80,text:"矩形",shapeFamily:"rectangle",img:""},{id:"002",x:0,y:0,w:80,h:80,text:"losange",shapeFamily:"polygon",polygon:[[0,50],[50,0],[100,50],[50,100]],img:"",pins:[]},{id:"003",x:0,y:0,w:80,h:80,text:"circle",shapeFamily:"ellipse",img:""},{id:"004",x:0,y:0,w:80,h:80,text:"四边形",shapeFamily:"polygon",polygon:[[10,0],[60,0],[50,40],[0,40]],img:"",pins:[]},{id:"005",x:0,y:0,w:80,h:80,text:"hello",shapeFamily:"polygon",img:""},{id:"006",x:0,y:0,w:80,h:80,text:"hello",shapeFamily:"polygon",img:""},{id:"007",x:0,y:0,w:80,h:80,text:"hello",shapeFamily:"polygon",img:""},{id:"008",x:0,y:0,w:80,h:80,text:"hello",shapeFamily:"polygon",img:""},{id:"009",x:0,y:0,w:80,h:80,text:"hello",shapeFamily:"polygon",img:""},{id:"010",x:0,y:0,w:80,h:80,text:"hello",shapeFamily:"polygon",img:""}],N={toJSON:function(t){var e,n,i,o;function l(t){this.node=t.clone(),this.node.index=t.index,this.node.flow=null,void 0!==this.node.image&&null!==this.node.image&&(this.node.srcImage=this.image.src,this.node.image=null),this.toJSON=function(){var e;for(e in this.node.drawShapeKey="drawTerminator",this.node.fillShapeKey="fillPredefinedProcess",this.node)(null===this.node[e]||this.node[e]===t.flow.nodeModel[e]&&"kindOfItem"!==e)&&delete this.node[e];return this.node}}function s(t){this.link=t.clone(),this.link.index=t.index,this.link.idOrg=null!=t.org?t.org.index:-1,this.link.idDst=null!=t.dst?t.dst.index:-1,this.link.org=null,this.link.dst=null,this.link.flow=null,this.toJSON=function(){var e;for(e in this.link)(null===this.link[e]||this.link[e]===t.flow.linkModel[e]&&"kindOfItem"!==e)&&delete this.link[e];return this.link}}for(e=[],n=t.getItems(),o=0;o<n.length;o++)i=n[o],t.isNode(i)?e.push(new l(i)):t.isLink(i)&&e.push(new s(i));return JSON.stringify(e,void 0," ")},fromJSON:function(t,e){var n,i,o,l,s,r,a,h,d,u,c,f,p,g,y;function x(t,e){void 0!==e.strokeStyle&&(t.strokeStyle=e.strokeStyle),void 0!==e.fillStyle&&(t.fillStyle=e.fillStyle),void 0!==e.gradientFillStyle&&(t.gradientFillStyle=e.gradientFillStyle),void 0!==e.textFillStyle&&(t.textFillStyle=e.textFillStyle),void 0!==e.lineWidth&&(t.lineWidth=e.lineWidth),void 0!==e.shapeFamily&&(t.shapeFamily=e.shapeFamily),void 0!==e.polygon&&(t.polygon=e.polygon),void 0!==e.drawShape&&(t.drawShape=e.drawShape),void 0!==e.fillShape&&(t.fillShape=e.fillShape),void 0!==e.pins&&(t.pins=e.pins),void 0!==e.isXSizeable&&(t.isXSizeable=e.isXSizeable),void 0!==e.isYSizeable&&(t.isYSizeable=e.isYSizeable),void 0!==e.isXMoveable&&(t.isXMoveable=e.isXMoveable),void 0!==e.isYMoveable&&(t.isYMoveable=e.isYMoveable),void 0!==e.isOutLinkable&&(t.isOutLinkable=e.isOutLinkable),void 0!==e.isInLinkable&&(t.isInLinkable=e.isInLinkable),void 0!==e.isSelectable&&(t.isSelectable=e.isSelectable),void 0!==e.isContextHandle&&(t.isContextHandle=e.isContextHandle),void 0!==e.isShadowed&&(t.isShadowed=e.isShadowed),void 0!==e.image&&(t.image=e.image),void 0!==e.textMargin&&(t.textMargin=e.textMargin),void 0!==e.imageMargin&&(t.imageMargin=e.imageMargin),void 0!==e.textPosition&&(t.textPosition=e.textPosition),void 0!==e.imagePosition&&(t.imagePosition=e.imagePosition),void 0!==e.font&&(t.font=e.font),void 0!==e.textLineHeight&&(t.textLineHeight=e.textLineHeight)}function w(t,e){void 0!==e.strokeStyle&&(t.strokeStyle=e.strokeStyle),void 0!==e.fillStyle&&(t.fillStyle=e.fillStyle),void 0!==e.textFillStyle&&(t.textFillStyle=e.textFillStyle),void 0!==e.lineWidth&&(t.lineWidth=e.lineWidth),void 0!==e.isStretchable&&(t.isStretchable=e.isStretchable),void 0!==e.isSelectable&&(t.isSelectable=e.isSelectable),void 0!==e.isContextHandle&&(t.isContextHandle=e.isContextHandle),void 0!==e.isShadowed&&(t.isShadowed=e.isShadowed),void 0!==e.font&&(t.font=e.font),void 0!==e.roundedCornerSize&&(t.roundedCornerSize=e.roundedCornerSize),void 0!==e.isOrientedText&&(t.isOrientedText=e.isOrientedText),void 0!==e.isOpaque&&(t.isOpaque=e.isOpaque),void 0!==e.arrowDst&&(t.arrowDst=e.arrowDst),void 0!==e.arrowOrg&&(t.arrowOrg=e.arrowOrg),void 0!==e.lineStyle&&(t.lineStyle=e.lineStyle),void 0!==e.orthoMargin&&(t.orthoMargin=e.orthoMargin),void 0!==e.points&&(t.points=e.points.slice())}if(void 0!==e&&null!==e&&""!==e){for(y=0,h=t.getItems(),u=h.length,o=JSON.parse(e),n=0;n<o.length;n++)"Node"===o[n].kindOfItem&&(r=o[n],l=t.addNode(r.x,r.y,r.w,r.h,r.text),x(l,r),void 0!==r.srcImage&&null!==r.srcImage&&(p=new Image,p.src=r.srcImage,l.image=p,l.image.onload=function(){l.refresh()}),o[n]=l,g=r.index+u,g>y&&(y=g));for(d=[],n=0;n<o.length;n++)"Link"===o[n].kindOfItem&&(a=o[n],c=o[a.idOrg],f=o[a.idDst],null!==c&&null!==f&&(s=t.addLink(c,f,a.text,a.pinOrg,a.pinDst),w(s,a),d.push(s),s.tmpIdx=a.index+u));for(i=0;i<d.length;i++)s=d[i],s.tmpIdx<y&&(h.splice(s.index,1),h.splice(s.tmpIdx,0,s)),delete s["tmpIdx"];t.refresh()}}},H=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-drawer",{staticClass:"no-user-select",attrs:{title:"详细信息","before-close":t.handleClose,visible:t.dialog,direction:"rtl"},on:{"update:visible":function(e){t.dialog=e}}},[n("el-form",{attrs:{model:t.selectedNode,"label-width":"80px"},nativeOn:{submit:function(t){t.preventDefault()}}},[n("el-form-item",{attrs:{label:"ID"}},[n("el-input",{ref:"title",nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleClose.apply(null,arguments)}},model:{value:t.selectedNode.text,callback:function(e){t.$set(t.selectedNode,"text",e)},expression:"selectedNode.text"}})],1),n("el-form-item",{attrs:{label:"活动名称"}},[n("el-input",{ref:"title",nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleClose.apply(null,arguments)}},model:{value:t.selectedNode.text,callback:function(e){t.$set(t.selectedNode,"text",e)},expression:"selectedNode.text"}})],1)],1)],1)],1)},j=[],W={name:"DrawerBox",props:["flow"],data:function(){return{dialog:!1,selectedNode:{}}},methods:{handleClose:function(){this.dialog=!1,this.flow.refresh()},showInfo:function(){var t=this;setTimeout((function(){t.$nextTick((function(){t.$refs.title.focus()}))}),600);var e=this.getSelectedNode();void 0!==e&&(this.selectedNode=e,this.dialog=!0)},getSelectedNode:function(){if(null!==this.flow)return this.flow.getSelectedItems()[0]}}},B=W,E=Object(C["a"])(B,H,j,!1,null,null,null),G=E.exports,X={name:"AddFlow",components:{draggable:A.a,Menu:D,DrawerBox:G},data:function(){return{flow:null,dialog:!1,selectedNode:{text:""},config:{canDrawNode:!1,gridSnap:!1,gridDraw:!1,fillStyle:"black"},list:[],elements:F,nodes:[]}},methods:{addNewNode:function(t){var e=this.list.pop();e.x=Math.round(t.originalEvent.layerX/this.flow.zoom-e.w/2),e.y=Math.round(t.originalEvent.layerY/this.flow.zoom-e.h/2),this.flow.beginUpdate();var n=this.flow.addNode(e.x,e.y,e.w,e.h,e.text);e.polygon&&(n.polygon=e.polygon),n.shapeFamily=e.shapeFamily,this.flow.endUpdate(),this.updateNodes()},moveNode:function(t,e){var n,i=t.draggedContext.element,o=Math.round(e.layerX/this.flow.zoom-i.w/2),l=Math.round(e.layerY/this.flow.zoom-i.h/2),s=Object(M["a"])(this.nodes);try{for(s.s();!(n=s.n()).done;){var r=n.value;if(r.x==o)return void console.log(o);if(r.y==l)return void console.log(l)}}catch(a){s.e(a)}finally{s.f()}},updateNodes:function(){console.log("node");var t=this.flow.getItems();this.nodes=[];var e,n=Object(M["a"])(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.flow.isNode(i)&&this.nodes.push(i)}}catch(o){n.e(o)}finally{n.f()}},showInfo:function(){this.$refs.drawer.showInfo()},download:function(){var t=N.toJSON(this.flow),e=document.createElement("a"),n=new Blob([t],{type:"text/plain"});e.href=URL.createObjectURL(n),e.download="addflow.json",e.click()},upload:function(t){this.flow.clear(),N.fromJSON(this.flow,t)},command:function(t){"undo"===t&&this.flow.taskManager.undo(),"redo"===t&&this.flow.taskManager.redo(),"refresh"===t&&this.flow.refresh(),"delete"===t&&this.flow.deleteSel(),"zoom-in"===t&&(this.flow.unselectAll(),this.flow.zoom+=.1,this.flow.refresh()),"zoom-out"===t&&(this.flow.unselectAll(),this.flow.zoom-=.1,this.flow.refresh())}},created:function(){var t=this;this.$shortcut.bind("ctrl+z",(function(e){t.command("undo")})),this.$shortcut.bind("ctrl+r",(function(e){t.command("redo")})),this.$shortcut.bind("delete",(function(e){t.command("delete")})),document.addEventListener("dblclick",this.showInfo,!1)},mounted:function(){var t=this.$refs.canvas;this.flow=new R.Flow(t),this.flow.canDrawNode=!1,this.flow.gridSnap=!0,this.flow.gridDraw=!1,this.flow.gridSizeX=10,this.flow.gridSizeY=10,this.flow.fillStyle="yellow",this.flow.mouseSelection="selection",this.flow.nodeModel.isContextHandle=!1,this.flow.nodeModel.strokeStyle="black",this.flow.nodeModel.textFillStyle="black",this.flow.nodeModel.lineWidth=2,this.flow.nodeModel.textLineHeight=15,this.flow.pinSize=10,this.flow.nodeModel.pins=[[0,25],[0,50],[0,75],[25,0],[50,0],[75,0],[100,25],[100,50],[100,75],[25,100],[50,100],[75,100]],this.flow.linkModel.strokeStyle="black",this.flow.linkModel.textFillStyle="black",this.flow.linkModel.lineStyle="orthogonal",this.flow.linkModel.lineWidth=2,this.flow.linkModel.isShadowed=!0,this.flow.refresh()}},Y=X,U=(n("6348"),Object(C["a"])(Y,b,k,!1,null,"3198cf54",null)),q=U.exports,$={name:"App",components:{AddFlow:q},data:function(){return{}},methods:{},watch:{}},J=$,K=(n("034f"),Object(C["a"])(J,S,m,!1,null,null,null)),Q=K.exports,Z=n("5530"),V=n("4d7f"),tt=n.n(V),et=function(t){return function(){return t(),!1}},nt=Object(Z["a"])({bind:function(t,e){return tt()(t,et(e))}},tt.a);v["default"].prototype.$shortcut=nt;n("0fae");v["default"].component(w.a.name,w.a),v["default"].component(y.a.name,y.a),v["default"].component(p.a.name,p.a),v["default"].component(c.a.name,c.a),v["default"].component(d.a.name,d.a),v["default"].component(a.a.name,a.a),v["default"].component(s.a.name,s.a),v["default"].component(o.a.name,o.a),v["default"].config.productionTip=!1,new v["default"]({el:"#root",render:function(t){return t(Q)}})},6348:function(t,e,n){"use strict";n("89a96")},"85ec":function(t,e,n){},"89a96":function(t,e,n){},b2ca:function(t,e,n){},cb84:function(t,e,n){"use strict";n("b2ca")}});
//# sourceMappingURL=app.41333c25.js.map