(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-5d82d4a8"],{"93fb":function(e,t,a){"use strict";a.r(t);var i={data(){return{queryInfo:{keyword:"name",query:"",pageNum:1,pageSize:10},mUrl:"",mDocID:"",loadProgress:0,progressFlag:!1,tableHeight:this.$root.gScreenHeight-182,slbHeight:this.$root.gScreenHeight-90,mainHeight:this.$root.gScreenHeight-70,uploadFilelist:[],filelist:[],total:0,headerObj:{Authorization:window.sessionStorage.getItem("token")},RenameDialogVisible:!1,FileForm:{},newFileName:""}},created(){this.$root.leveOnePathName="文件管理",this.$root.leveTwoPathName="上传下载",this.tableHeight=JSON.parse(window.localStorage.getItem("gHeight"))-285,this.mUrl=this.$root.gBaseURL+"/UploadFileStore",this.getFileList()},methods:{uploadProcess(e,t,a){this.progressFlag=!0,this.loadProgress=parseInt(e.percent),100<=this.loadProgress&&(this.loadProgress=100,setTimeout(()=>{this.progressFlag=!1},1e3))},uploadSuccess(e,t,a){this.uploadFilelist=[],this.getFileList(),this.$message.success("上传成功!")},handleExceed(e,t){this.$message.warning(`当前限制选择 1 个文件，本次选择了 ${e.length} 个文件，共选择了 ${e.length+t.length} 个文件`)},table_header(e,t,a,i){return"background-color: #409EFF; color:white;font-size: 14px"},handleSizeChange(e){this.queryInfo.pageSize=e,this.getFileList()},handleCurrentChange(e){this.queryInfo.pageNum=e,this.getFileList()},resetForm(e){this.FileForm={},this.$refs[e].resetFields()},showRenameDialog(e){this.FileForm=e,this.newFileName=e.t_FileName,this.RenameDialogVisible=!0},refersh(){this.getFileList(),this.$message.success("刷新成功")},async findFileList(){var e=(await this.$http.post("FindFileList",{mFileName:this.queryInfo.query}))["data"];if(200!==e.status)return this.$message.error("查找文件失败");this.filelist=JSON.parse(e.data),this.total=e.data.total},async getFileList(){var e=(await this.$http.post("GetFileList"))["data"];if(200!==e.status)return this.$message.error("获取文件列表失败");this.filelist=JSON.parse(e.data),this.total=e.data.total},async download(e){const t=new FormData;t.append("fileName",e.t_SavePath);var{data:a,status:i}=await this.$http.post("DownloadFile",t,{responseType:"blob"});if(200!==i)return this.$message.error("获取文件信息失败");this.downloadfile(a,e.t_FileName)},downloadfile(e,t){if(e){e=window.URL.createObjectURL(new Blob([e]));const a=document.createElement("a");a.style.display="none",a.href=e,a.setAttribute("download",t),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(e)}},async deleteFile(e){if("confirm"!==await this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e))return this.$message.info("已取消删除");e=(await this.$http.post("DeleteFileOnServer",{mSavePathFileName:e.t_SavePath,mFileNameServer:e.t_FileNameServer})).data,200!==e.status?this.$message.error("服务器端文件并不存在，删除文件失败！"):this.$message.success("删除文件成功！"),this.getFileList()},async RenameFileInfo(e){if(""===this.newFileName)return this.$message.error("新文件名不能为空");e=(await this.$http.post("RenameFileOnServer",{mNewFileName:this.newFileName,mSavePath:e.t_SavePath,mFileNameServer:e.t_FileNameServer})).data,200===e.status?this.$message.success("文件重命名成功！"):201===e.status?this.$message.error("发现同名文件，不能修改！"):this.$message.error("文件重命名失败！"+e.Msg),this.RenameDialogVisible=!1,this.getFileList()}}};a("d8b6"),a=a("2877"),a=Object(a.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"mainZone",staticClass:"datalist-container",style:{height:e.mainHeight+"px"}},[a("el-card",[a("el-row",{attrs:{getter:24}},[a("el-col",{attrs:{span:3}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.queryInfo.keyword,callback:function(t){e.$set(e.queryInfo,"keyword",t)},expression:"queryInfo.keyword"}},[a("el-option",{attrs:{label:"文件名",value:"name"}}),a("el-option",{attrs:{label:"文件类型",value:"type"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-input",{attrs:{placeholder:"输入文件名开始查找",clearable:""},on:{clear:e.getFileList},model:{value:e.queryInfo.query,callback:function(t){e.$set(e.queryInfo,"query",t)},expression:"queryInfo.query"}})],1),a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{type:"primary"},on:{click:e.findFileList}},[e._v("查询")])],1),a("el-col",{attrs:{span:4}},[a("el-button",{attrs:{plain:"",icon:"el-icon-refresh",type:"primary"},on:{click:e.refersh}},[e._v("刷新")])],1),a("el-col",{attrs:{span:9}},[a("el-upload",{staticClass:"upload-demo right",attrs:{action:e.mUrl,"on-success":e.uploadSuccess,"on-progress":e.uploadProcess,headers:e.headerObj,multiple:"",limit:1e3,"on-exceed":e.handleExceed,"file-list":e.uploadFilelist}},[a("el-button",{attrs:{icon:"el-icon-upload",type:"primary"}},[e._v("点击上传")])],1),e.progressFlag?a("el-progress",{attrs:{percentage:e.loadProgress}}):e._e()],1)],1),a("el-table",{attrs:{data:e.filelist,height:e.tableHeight,border:"",stripe:"","header-row-class-name":"table_header","header-cell-style":e.table_header}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"80px",align:"center"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"原文件名",prop:"t_FileName",align:"left"}}),e._e(),e._e(),a("el-table-column",{attrs:{label:"创建时间",prop:"t_CreationTime",align:"center",width:"200px"}}),a("el-table-column",{attrs:{label:"大小",prop:"t_FileLength",align:"center",width:"100px"}}),a("el-table-column",{attrs:{label:"操作",align:"center",width:"250px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{staticStyle:{"margin-left":"15px"},attrs:{target:"_blank",underline:!1}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.showRenameDialog(t.row)}}},[e._v("重命名")])],1),a("el-link",{staticStyle:{"margin-left":"15px"},attrs:{target:"_blank",underline:!1}},[a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(a){return e.download(t.row)}}},[e._v("下载")])],1),a("el-link",{staticStyle:{"margin-left":"15px"},attrs:{target:"_blank",underline:!1}},[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.deleteFile(t.row)}}},[e._v("删除")])],1)]}}])})],1),a("el-pagination",{attrs:{"current-page":e.queryInfo.pageNum,"page-sizes":[2,5,10,15],"page-size":e.queryInfo.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total,background:"","hide-on-single-page":""},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),a("el-dialog",{attrs:{title:"文件重命名",visible:e.RenameDialogVisible,width:"40%","close-on-click-modal":!1},on:{"update:visible":function(t){e.RenameDialogVisible=t},close:function(t){return e.resetForm("FileFormRef")}}},[a("el-form",{ref:"FileFormRef",attrs:{model:e.FileForm,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"当前文件名: "}},[e._v(" "+e._s(e.FileForm.t_FileName)+" ")]),a("el-form-item",{attrs:{label:"新文件名"}},[a("el-input",{model:{value:e.newFileName,callback:function(t){e.newFileName=t},expression:"newFileName"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.RenameDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.RenameFileInfo(e.FileForm)}}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,null,null);t.default=a.exports},d8b6:function(e,t,a){"use strict";a("ecdc")},ecdc:function(e,t,a){}}]);