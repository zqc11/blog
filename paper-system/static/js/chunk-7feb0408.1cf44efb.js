(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7feb0408"],{"7ed2":function(t,e,i){},c675:function(t,e,i){"use strict";i.r(e);var s={data(){return{rolelist:[],setRightDialogVisible:!1,rightslist:[],treeProps:{label:"ParentID",children:"Children"},defKeys:[],roleId:"",addDialogVisible:!1,addForm:{rolename:"",remark:""},editDialogVisible:!1,editForm:{},setRoleDialogVisible:!1,userInfo:{}}},created(){this.getRoleList(),this.$root.leveOnePathName="权限管理",this.$root.leveTwoPathName="组织与角色",this.tableHeight=JSON.parse(window.localStorage.getItem("gHeight"))-240,this.slbHeight=JSON.parse(window.localStorage.getItem("gHeight"))-195,this.mainHeight=JSON.parse(window.localStorage.getItem("gHeight"))-185,this.mainWidth=this.$root.gScreenWidth-210},methods:{async getRoleList(){var t=(await this.$http.post("getRoleList"))["data"];if(200!==t.status)return this.$message.error("获取角色列表失败！");this.rolelist=t.data1},async deleteRole(t){return"confirm"!==await this.$confirm("此操作将永久删除该角色, 角色相关的用户、权限等将被移除， 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(t=>t)?this.$message.info("取消了删除！"):(t=(await this.$http.post("deleteRole",{hRoleID:t}))["data"],200!==t.status?this.$message.error("删除角色失败！"):(this.$message.error("删除角色成功！"),void this.getRoleList()))},async deleteRight(t,e){return"confirm"!==await this.$confirm("此操作删除角色的二级权限, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(t=>t)?this.$message.info("取消了删除！"):(t=(await this.$http.post("deleteRoleRight",{hRoleID:t.t_ID,hkeys:e}))["data"],200!==t.status?this.$message.error("删除权限失败！"):void this.getRoleList())},async deleteRightLevelOne(t,e){return"confirm"!==await this.$confirm("此操作将删除选中的一级权限，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(t=>t)?this.$message.info("取消了删除！"):(t=(await this.$http.post("deleteRoleRightLevelOne",{hRoleID:t.t_ID,hkeys:e}))["data"],200!==t.status?this.$message.error("删除一级权限失败！"):void this.getRoleList())},async showSetRightDialog(t){var e=(await this.$http.post("getRightList"))["data"];if(200!==e.status)return this.$message.error("获取权限数据失败！");this.rightslist=JSON.parse(e.data),this.getLeafKeys(t,this.defKeys),this.roleId=t.t_ID,this.setRightDialogVisible=!0},addDialogClosed(){this.$refs.addFormRef.resetFields()},addRole(){this.$refs.addFormRef.validate(async t=>{t&&(t=(await this.$http.post("addRole",{form:JSON.stringify(this.addForm)}))["data"],200!==t.status&&this.$message.error("添加角色失败！"),this.$message.success("添加角色成功！"),this.addDialogVisible=!1,this.getRoleList())})},async showEditDialog(t){if(t=(await this.$http.post("getRole",{mRoleID:t})).data,200!==t.status)return this.$message.error("查询用户信息失败！");this.editForm=JSON.parse(t.data),this.editDialogVisible=!0},editDialogClosed(){this.$refs.editFormRef.resetFields()},editRole(){this.$refs.editFormRef.validate(async t=>{if(t){if(t=(await this.$http.post("editRole",{form:JSON.stringify(this.editForm)}))["data"],200!==t.status)return this.$message.error("更新用户信息失败！");this.editDialogVisible=!1,this.getRoleList(),this.$message.success("更新角色信息成功！")}})},async setRole(t){if(this.userInfo=t,t=(await this.$http.get("roles")).data,200!==t.meta.status)return this.$message.error("获取角色列表失败！");this.rolesList=t.data,this.setRoleDialogVisible=!0},getLeafKeys(t,e){if(!t.Children)return e.push(t.t_ID);t.Children.forEach(t=>this.getLeafKeys(t,e))},setRightDialogClosed(){this.defKeys=[]},async allotRights(){const t=[this.$refs.treeRef.getCheckedKeys(),this.$refs.treeRef.getHalfCheckedKeys()];var e=t.join(",");e=(await this.$http.post("allotRoleRights",{hRoleID:this.roleId,hKeys:e}))["data"];if(200!==e.status)return this.$message.error("分配权限失败！");this.$message.success("分配权限成功！"),this.getRoleList(),this.setRightDialogVisible=!1}}};i("c8be"),i=i("2877"),i=Object(i.a)(s,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"mainZone",staticClass:"datalist-container"},[i("el-row",{attrs:{gutter:5}},[i("el-col",{attrs:{span:24}},[i("el-card",{attrs:{"body-style":{padding:"5px"}}},[i("el-row",[i("el-col",[i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.addDialogVisible=!0}}},[t._v("添加角色")])],1)],1),i("el-table",{attrs:{data:t.rolelist,border:"",stripe:"",height:t.tableHeight}},[i("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.Children,(function(s,a){return i("el-row",{key:s.id,class:["bdbottom",0===a?"bdtop":"","vcenter"]},[i("el-col",{attrs:{span:5}},[i("el-tag",{attrs:{closable:""},on:{close:function(i){return t.deleteRightLevelOne(e.row,s.ParentID)}}},[t._v(t._s(s.ParentID))]),i("i",{staticClass:"el-icon-caret-right"})],1),i("el-col",{attrs:{span:19}},t._l(s.Children,(function(s){return i("el-tag",{key:s.id,attrs:{type:"success",closable:""},on:{close:function(i){return t.deleteRight(e.row,s.t_ID)}}},[t._v(t._s(s.ParentID))])})),1)],1)}))}}])}),i("el-table-column",{attrs:{type:"index"}}),i("el-table-column",{attrs:{label:"角色名称",prop:"ParentID"}}),i("el-table-column",{attrs:{label:"角色描述",prop:"label"}}),i("el-table-column",{attrs:{label:"操作",width:"300px"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-edit"},on:{click:function(i){return t.showEditDialog(e.row.t_ID)}}},[t._v("编辑")]),i("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete"},on:{click:function(i){return t.deleteRole(e.row.t_ID)}}},[t._v("删除")]),i("el-button",{attrs:{size:"mini",type:"warning",icon:"el-icon-setting"},on:{click:function(i){return t.showSetRightDialog(e.row)}}},[t._v("分配权限")])]}}])})],1)],1)],1)],1),i("el-dialog",{attrs:{title:"添加角色",visible:t.addDialogVisible,width:"50%"},on:{"update:visible":function(e){t.addDialogVisible=e},close:t.addDialogClosed}},[i("el-form",{ref:"addFormRef",attrs:{model:t.addForm,"label-width":"70px"}},[i("el-form-item",{attrs:{label:"角色",prop:"rolename"}},[i("el-input",{model:{value:t.addForm.rolename,callback:function(e){t.$set(t.addForm,"rolename",e)},expression:"addForm.rolename"}})],1),i("el-form-item",{attrs:{label:"角色说明",prop:"remark"}},[i("el-input",{model:{value:t.addForm.remark,callback:function(e){t.$set(t.addForm,"remark",e)},expression:"addForm.remark"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.addDialogVisible=!1}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.addRole}},[t._v("确 定")])],1)],1),i("el-dialog",{attrs:{title:"修改角色",visible:t.editDialogVisible,width:"50%"},on:{"update:visible":function(e){t.editDialogVisible=e},close:t.editDialogClosed}},[i("el-form",{ref:"editFormRef",attrs:{model:t.editForm,"label-width":"70px"}},[i("el-form-item",{attrs:{label:"角色"}},[i("el-input",{model:{value:t.editForm.Name,callback:function(e){t.$set(t.editForm,"Name",e)},expression:"editForm.Name"}})],1),i("el-form-item",{attrs:{label:"角色说明"}},[i("el-input",{model:{value:t.editForm.Remark,callback:function(e){t.$set(t.editForm,"Remark",e)},expression:"editForm.Remark"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.editDialogVisible=!1}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.editRole}},[t._v("确 定")])],1)],1),i("el-dialog",{attrs:{title:"分配权限",visible:t.setRightDialogVisible,width:"50%"},on:{"update:visible":function(e){t.setRightDialogVisible=e},close:t.setRightDialogClosed}},[i("el-scrollbar",{staticStyle:{height:"500px"}},[i("el-tree",{ref:"treeRef",attrs:{data:t.rightslist,props:t.treeProps,"show-checkbox":"","node-key":"t_ID","default-checked-keys":t.defKeys}})],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.setRightDialogVisible=!1}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.allotRights}},[t._v("确 定")])],1)],1)],1)}),[],!1,null,"760e02f9",null);e.default=i.exports},c8be:function(t,e,i){"use strict";i("7ed2")}}]);