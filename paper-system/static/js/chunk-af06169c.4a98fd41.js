(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-af06169c"],{"17e0":function(e,t,i){"use strict";i.r(t);var a={data(){return{vFieldA:"",vFieldB:"",vBCatID:"",linkAfieldlist:[],linkBfieldlist:[],vName:"",vRemark:"",vTypeID:"",vID:"",vNo:"",vExpression:"",vIsUserdefine:!1,vIsInborn:!1,vIsActive:!1,vIsVersion:!1,queryInfo:{query:"",pageNum:"1",pageSize:"30",catID:"IDATA"},mtemp:[""],tableHeight:window.innerHeight-275,mainHeight:window.innerHeight-400,DataName:"Item Detail",addDataForm:{},editDataForm:{},editFieldForm:{},datalist:[],templist:[],FieldDropDownArgList:[],vStrOption:"",catLinkList:[],detailDialogVisible:!1,addDialogVisible:!1,parentCateList:[],cascaderProps:{value:"t_ID",label:"label",children:"Children",checkStrictly:!0,expandTrigger:"hover"},selectedKeys:[],linkACatName:"",linkBCatName:"",cat_pid:"",cat_level:0,config:{id:"t_ID",pid:"ParentID",children:"children"},idArray:[],pageFlag:!0}},created(){this.$root.leveOnePathName="系统管理",this.$root.leveTwoPathName="关联定义",this.tableHeight=JSON.parse(window.localStorage.getItem("gHeight"))-240,this.slbHeight=JSON.parse(window.localStorage.getItem("gHeight"))-195,this.mainHeight=JSON.parse(window.localStorage.getItem("gHeight"))-185,this.getParentCateList(),null!==window.localStorage.getItem("currentCatID")&&(this.queryInfo.catID=window.localStorage.getItem("currentCatID"),this.linkACatName=window.localStorage.getItem("currentCatName"),this.idArray=[this.queryInfo.catID]),this.$nextTick((function(){this.$refs.treeList.setCurrentKey(this.queryInfo.catID)}))},mounted(){this.tempselect=this.select2,this.getCatLinkList()},methods:{selectChange(e){const t=[];for(var i of(this.select2=[],this.allrole))e===i.pro&&(this.editFieldForm.t_ControlType=i.value,t.push({label:i.label,value:i.value})),this.select2=t;this.$forceUpdate()},selectValue(e){this.$forceUpdate()},dataTypeFormatter(e,t){return e=e.t_DataType,1===e?"字符":2===e?"整数":3===e?"数值":4===e?"日期":5===e?"文本":6===e?"图片":8===e?"文件":"其他"},controlTypeFormatter(e,t){return e=e.t_ControlType,0===e?"No Define":1===e?"el-input":2===e?"el-input textarea":3===e?"el-select":4===e?"el-checkbox-group":11===e?"el-radio":30===e?"el-radio-group":12===e?"el-date-picker":14===e?"el-14":15===e?"el-15":108===e?"el-108":"其他"},focus(e){},keyup_({e:e,i:t}){const i=this;i.$refs["input"+t]&&i.$nextTick(()=>{e.target.blur();var a="input"+(t+1);void 0!==i.$refs[a]?i.$refs[a][0].focus():i.$refs.addSubmit&&i.$refs.addSubmit.$el.focus()})},keyup_edit({e:e,i:t}){const i=this;i.$refs["m_input"+t]&&i.$nextTick(()=>{e.target.blur();var a="m_input"+(t+1);void 0!==i.$refs[a]?i.$refs[a][0].focus():i.$refs.editSubmit&&i.$refs.editSubmit.$el.focus()})},handleRadioChange:function(e,t,i){},handleChange:function(e,t,i){e?this.checkedData[i].push(t):this.delete(t,i)},delete(e,t){var i=this.checkedData[t].findIndex(t=>{if(t===e)return!0});this.checkedData[t].splice(i,1)},SetFirstAddFocus(){this.$nextTick(e=>{this.$refs.input0[0].focus()})},SetFirstEditFocus(){this.$nextTick(e=>{this.$refs.m_input0[0].focus()})},async openaddLinkDialog(){this.vName="",this.vRemark="",this.vExpression="",this.linkBfieldlist="",this.linkAfieldlist="",this.vFieldA="",this.vFieldB="",this.selectedKeys="",this.vIsActive=!1,this.vIsUserdefine=!1,this.getLinkAField(this.queryInfo.catID),this.addDialogVisible=!0},async addLinkRule(){var e=(await this.$http.post("addLinkRule",{hSourceCatID:this.queryInfo.catID,hTargetCatID:this.cat_pid,hLinkName:this.vName,hRemark:this.vRemark,hExpression:this.vExpression,hSourceCatName:this.linkACatName,hTargetCatName:this.linkBCatName,hIsActive:this.mapBool(this.vIsActive),hIsUserdefine:this.mapBool(this.vIsUDTable)}))["data"];200!==e.status?this.$message.error("新增关联失败！-- 020"):(this.$message.success("新增关联成功！"),this.addDialogVisible=!1,this.getParentCateList(),this.getCatLinkList())},async deleteLinkRule(e){if("confirm"!==await this.$confirm("此操作将永久删除关联规则，请谨慎使用！ 是否继续?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e))return this.$message.info("已取消删除!");e=(await this.$http.post("deleteLinkRule",{hSourceCatID:this.queryInfo.catID,hRuleID:e.t_ExpressionID})).data,200!==e.status?this.$message.error("删除 关联规则 失败！-- 030"):(this.getCatLinkList(),this.$message.success("删除 关联规则 成功！"))},mapStatus(e){return 1===e},mapBool(e){return!0===e?1:0},async showDetailDialog(e){this.vName=e.t_LinkName,this.linkACatName=e.SOURCENAME,this.linkBCatName=e.TARGERNAME,this.vRemark=e.t_Remark,this.vExpression=e.t_Expression,this.vIsActive=this.mapStatus(e.t_IsActive),this.detailDialogVisible=!0},async getCatLinkList(e){var t=(await this.$http.post("getCatLinkList",{hCatID:this.queryInfo.catID}))["data"];if(200!==t.status)return this.catLinkList=[],this.$message.error(" -- getCatLinkList--失败！");this.catLinkList=JSON.parse(t.data)},async getLinkAField(e){e=(await this.$http.post("getCatTableABField",{hCatID:e}))["data"];var t=(200!==e.status&&this.$message.error("获取指定类的字段失败！"),JSON.parse(e.tableAfield));this.linkAfieldlist=JSON.parse(e.tableBfield).concat(t)},async getLinkBField(e){e=(await this.$http.post("getCatTableABField",{hCatID:e}))["data"];var t=(200!==e.status&&this.$message.error("获取指定类的字段失败！"),JSON.parse(e.tableAfield));this.linkBfieldlist=JSON.parse(e.tableBfield).concat(t)},transArrToString(e){if(!Array.isArray(e))return!1;for(var t="",i=0,a=e.length;i<a;i++)0===i?t=e[i]:t+=","+e[i];return t},transStrToArr(e){return e.split(",")},async getParentCateList(){var e=(await this.$http.post("getCatTree"))["data"];if(200!==e.status)return this.$message.error("获取父级分类数据失败！");this.parentCateList=e.data1},parentCateChanged(e){0<this.selectedKeys.length?(this.cat_pid=this.selectedKeys[this.selectedKeys.length-1],this.cat_level=this.selectedKeys.length,this.linkBCatName=this.$refs.LinkBref.getCheckedNodes()[0].pathLabels[this.selectedKeys.length-1],this.getLinkBField(this.cat_pid)):(this.cat_pid="",this.linkBCatName="",this.cat_level=0,this.linkBfieldlist="",this.vFieldB="")},linkBFieldChanged(){""===this.vFieldA?this.$message.error("请先选择A类字段！"):(this.vExpression=this.linkACatName+"."+this.vFieldA+"  =   "+this.linkBCatName+"."+this.vFieldB,this.$message.error(this.vExpression))},linkAFieldChanged(){""!==this.vFieldB&&(this.vExpression=this.linkACatName+"."+this.vFieldA+"  =   "+this.linkBCatName+"."+this.vFieldB,this.$message.error(this.vExpression))},handleNodeClick(e){this.linkACatName=e.label,this.queryInfo.catID=e.t_ID,this.idArray=[e.t_ID],window.localStorage.setItem("currentCatID",e.t_ID),window.localStorage.setItem("currentCatName",e.label),this.getCatLinkList()}},computed:{menuLabel(){return null==this.nodeData.children?"表":"数据库"}}};i("74d6"),i=i("2877"),i=Object(i.a)(a,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"mainZone",staticClass:"datalist-container"},[i("el-row",{attrs:{gutter:5}},[i("el-col",{attrs:{span:4}},[i("el-card",{attrs:{"body-style":{padding:"5px"}}},[i("el-scrollbar",{style:{height:e.slbHeight+"px"}},[i("el-tree",{ref:"treeList",attrs:{"default-expanded-keys":e.idArray,"current-node-key":this.queryInfo.catID,"highlight-current":"",id:"el-tree",data:e.parentCateList,props:e.cascaderProps,"node-key":"t_ID"},on:{"node-click":e.handleNodeClick}})],1)],1)],1),i("el-col",{attrs:{span:20}},[i("el-row",[i("el-card",{attrs:{"body-style":{padding:"5px"}}},[i("el-row",{attrs:{gutter:10}},[i("el-button",{staticStyle:{"margin-left":"5px"},attrs:{icon:"el-icon-circle-plus-outline",type:"primary"},on:{click:e.openaddLinkDialog}},[e._v("增加关联")])],1),i("el-table",{attrs:{data:e.catLinkList,height:e.tableHeight,border:"",stripe:"","highlight-current-row":"","row-style":{height:"30px"},"cell-style":{padding:"0px"}}},[i("el-table-column",{attrs:{prop:"t_No",label:"序号",width:"50"}}),e._e(),i("el-table-column",{attrs:{prop:"t_LinkName",label:"名称"}}),i("el-table-column",{attrs:{prop:"SOURCENAME",label:"A类"}}),i("el-table-column",{attrs:{prop:"TARGERNAME",label:"B类"}}),e._e(),e._e(),i("el-table-column",{attrs:{prop:"t_Expression",label:"规则",width:"250"}}),e._e(),i("el-table-column",{attrs:{prop:"t_Remark",label:"备注"}}),i("el-table-column",{attrs:{label:"启用状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-switch",{attrs:{"active-value":1,"inactive-value":0,disabled:""},model:{value:t.row.t_IsActive,callback:function(i){e.$set(t.row,"t_IsActive",i)},expression:"scope.row.t_IsActive"}})]}}])}),e._e(),i("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"显示详情",enterable:!1,placement:"top"}},[i("el-button",{attrs:{type:"warning",icon:"el-icon-setting",size:"mini",circle:"",plain:""},on:{click:function(i){return e.showDetailDialog(t.row)}}})],1),i("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini",circle:"",plain:""},on:{click:function(i){return e.deleteLinkRule(t.row)}}})]}}])})],1)],1)],1)],1)],1),i("el-dialog",{attrs:{title:"增加关联",visible:e.addDialogVisible,width:"70%"},on:{"update:visible":function(t){e.addDialogVisible=t}}},[i("el-form",{staticClass:"form-1",attrs:{"label-width":"70px","label-position":"left"},nativeOn:{submit:function(e){e.preventDefault()}}},[i("el-form-item",{attrs:{label:"名称"}},[i("el-input",{model:{value:e.vName,callback:function(t){e.vName=t},expression:"vName"}})],1),i("el-form-item",{attrs:{label:"A类"}},[i("el-row",[i("el-col",{attrs:{span:8}},[i("el-input",{attrs:{label:e.linkACatName,value:e.linkACatName}},[e._v("AB类")])],1),i("el-col",{attrs:{span:16}},[i("el-select",{attrs:{placeholder:"请选择A类字段"},on:{change:e.linkAFieldChanged},model:{value:e.vFieldA,callback:function(t){e.vFieldA=t},expression:"vFieldA"}},e._l(e.linkAfieldlist,(function(e){return i("el-option",{key:e.t_FieldID,attrs:{label:e.t_Name,value:e.t_Name}})})),1)],1)],1)],1),i("el-form-item",{attrs:{label:"B类"}},[i("el-row",[i("el-col",{attrs:{span:8}},[i("el-cascader",{ref:"LinkBref",attrs:{options:e.parentCateList,props:e.cascaderProps,size:"medium",clearable:""},on:{change:e.parentCateChanged},model:{value:e.selectedKeys,callback:function(t){e.selectedKeys=t},expression:"selectedKeys"}})],1),i("el-col",{attrs:{span:16}},[i("el-select",{attrs:{placeholder:"请选择B类字段"},on:{change:e.linkBFieldChanged},model:{value:e.vFieldB,callback:function(t){e.vFieldB=t},expression:"vFieldB"}},e._l(e.linkBfieldlist,(function(e){return i("el-option",{key:e.t_FieldID,attrs:{label:e.t_Name,value:e.t_Name}})})),1)],1)],1)],1),i("el-form-item",{attrs:{label:"关联规则"}},[i("el-input",{model:{value:e.vExpression,callback:function(t){e.vExpression=t},expression:"vExpression"}})],1),i("el-form-item",{attrs:{label:"备注"}},[i("el-input",{model:{value:e.vRemark,callback:function(t){e.vRemark=t},expression:"vRemark"}})],1),i("el-form-item",{attrs:{label:"设置项"}},[i("el-checkbox",{model:{value:e.vIsActive,callback:function(t){e.vIsActive=t},expression:"vIsActive"}},[e._v("启用状态")])],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{ref:"editSubmit",attrs:{type:"primary"},on:{click:e.addLinkRule}},[e._v("确 定")]),i("el-button",{on:{click:function(t){e.addDialogVisible=!1}}},[e._v("取 消")])],1)],1),i("el-dialog",{attrs:{title:"关联规则详情",visible:e.detailDialogVisible,width:"70%"},on:{"update:visible":function(t){e.detailDialogVisible=t}}},[i("el-form",{staticClass:"form-1",attrs:{"label-width":"70px","label-position":"left"},nativeOn:{submit:function(e){e.preventDefault()}}},[i("el-form-item",{attrs:{label:"名称"}},[i("el-input",{attrs:{readonly:"readonly"},model:{value:e.vName,callback:function(t){e.vName=t},expression:"vName"}})],1),i("el-form-item",{attrs:{label:"A/B类"}},[i("el-row",[i("el-col",{attrs:{span:12}},[i("el-input",{attrs:{label:e.linkACatName,value:e.linkACatName,readonly:"readonly"}},[e._v("A类")])],1),i("el-col",{attrs:{span:12}},[i("el-input",{attrs:{label:e.linkBCatName,value:e.linkBCatName,readonly:"readonly"}},[e._v("B类")])],1)],1)],1),i("el-form-item",{attrs:{label:"关联规则"}},[i("el-input",{attrs:{readonly:"readonly"},model:{value:e.vExpression,callback:function(t){e.vExpression=t},expression:"vExpression"}})],1),i("el-form-item",{attrs:{label:"备注"}},[i("el-input",{attrs:{readonly:"readonly"},model:{value:e.vRemark,callback:function(t){e.vRemark=t},expression:"vRemark"}})],1),i("el-form-item",{attrs:{label:"设置项"}},[i("el-checkbox",{attrs:{disabled:""},model:{value:e.vIsActive,callback:function(t){e.vIsActive=t},expression:"vIsActive"}},[e._v("启用状态")])],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.detailDialogVisible=!1}}},[e._v("关 闭")])],1)],1)],1)}),[],!1,null,"67843246",null);t.default=i.exports},"29ce":function(e,t,i){},"74d6":function(e,t,i){"use strict";i("29ce")}}]);