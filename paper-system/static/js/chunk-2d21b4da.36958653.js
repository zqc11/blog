(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2d21b4da"],{becd:function(e,t,i){"use strict";i.r(t);var s={data(){return{rolelist:[],vRoleName:"",vRoleID:"",mFlag:!1,mFlagCat:!1,mFlagDef:!1,vRuleName:"",vRuleID:"",ruleList:[],ruleDefineList:[],setRightDialogVisible:!1,rightslist:[],treeProps:{label:"t_Name",children:"Children"},defKeys:[],roleId:"",addDialogVisible:!1,addForm:{rolename:"",remark:""},editDialogVisible:!1,editForm:{},setRoleDialogVisible:!1,userInfo:{},parentCateList:[],cascaderProps:{value:"t_ID",label:"label",children:"Children",checkStrictly:!0,expandTrigger:"hover"},selectedKeys:[],catName:"",cat_pid:"",cat_level:0,config:{id:"t_ID",pid:"ParentID",children:"children"}}},created(){this.getRoleList(),this.getParentCateList(),this.$root.leveOnePathName="系统配置",this.$root.leveTwoPathName="范围授权",this.tableHeight=JSON.parse(window.localStorage.getItem("gHeight"))-240,this.slbHeight=JSON.parse(window.localStorage.getItem("gHeight"))-200,this.mainHeight=JSON.parse(window.localStorage.getItem("gHeight"))-185},watch:{rolelist:function(){let e=1;this.$nextTick((function(){for(var t=0;t<this.rolelist.length;t++)this.rolelist[t].t_ID===this.vRoleID&&(e=t);this.$refs.roletableRef.setCurrentRow(this.rolelist[e]),this.getRuleList(this.rolelist[e].t_ID),this.vRoleName=this.rolelist[e].t_Name,this.vRoleID=this.rolelist[e].t_ID}))},selectedKeys(){this.$refs.LinkBref&&(this.$refs.LinkBref.dropDownVisible=!1)}},methods:{OpenAddDialog(){this.catName="",this.cat_pid="",this.vRuleID="",this.selectedKeys=[],this.ruleDefineList=[],this.mFlagCat=!1,this.mFlagDef=!1,this.addDialogVisible=!0},async handleRadioChange(e,t,i){this.vRuleID=i,this.mFlagDef=!0,this.addForm.remark=null===t?"全局范围":t},async getParentCateList(){var e=(await this.$http.post("getCatTree"))["data"];if(200!==e.status)return this.$message.error("获取父级分类数据失败！");this.parentCateList=e.data1},parentCateChanged(e){this.vOperation="",this.hValue="",this.vRuleName="",this.vFieldID="",this.vExpression="",this.vLength=0,this.mFlagCat=!1,this.mFlagDef=!1,0<this.selectedKeys.length?(this.cat_pid=this.selectedKeys[this.selectedKeys.length-1],this.cat_level=this.selectedKeys.length,this.catName=this.$refs.LinkBref.getCheckedNodes()[0].pathLabels[this.selectedKeys.length-1],this.mFlagCat=!0,this.getCatRuleList(this.cat_pid)):(this.cat_pid="",this.catName="",this.cat_level=0,this.fieldlist="",this.vFieldID="",this.mFlagCat=!1,this.mFlagDef=!1,this.vExpression="")},handleRowClick(e){this.getRuleList(e.t_ID),this.$refs.roletableRef.selection,this.vRoleName=e.t_Name,this.vRoleID=e.t_ID},async getCatRuleList(e){if(e=(await this.$http.post("getCatRuleList",{hCatID:e})).data,200!==e.status)return this.$message.error("获取Role规则失败！");this.ruleDefineList=JSON.parse(e.data),0<this.ruleDefineList.length&&(this.vRuleName="",this.mFlagDef=!0,null===this.ruleDefineList[0].t_ExpressionScope?this.addForm.remark="全局范围":this.addForm.remark=this.ruleDefineList[0].t_ExpressionScope)},async getRuleList(e){if(e=(await this.$http.post("getRoleRuleList",{hRoleID:e})).data,200!==e.status)return this.$message.error("获取Role规则失败！");this.ruleList=JSON.parse(e.data),0<this.ruleList.length?this.mFlag=!0:this.mFlag=!1},async getRoleList(){var e=(await this.$http.post("getSysRole"))["data"];if(200!==e.status)return this.$message.error("获取角色列表失败！");this.rolelist=JSON.parse(e.data)},async deleteListACL(e){return"confirm"!==await this.$confirm("此操作将解除角色与规则之间的关系， 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e)?this.$message.info("取消了删除！"):(e=(await this.$http.post("deleteRoleListACL",{hRoleID:this.vRoleID,hRuleID:e.t_RuleID}))["data"],200!==e.status?this.$message.error("解除绑定关系失败！"):(this.$message.error("解除规则与角色之间的关系成功！"),void this.getRoleList()))},async deleteRight(e,t){return"confirm"!==await this.$confirm("此操作删除角色的二级权限, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e)?this.$message.info("取消了删除！"):(e=(await this.$http.post("deleteRoleRight",{hRoleID:e.t_ID,hkeys:t}))["data"],200!==e.status?this.$message.error("删除权限失败！"):void this.getRoleList())},async deleteRightLevelOne(e,t){return"confirm"!==await this.$confirm("此操作将删除选中的一级权限，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e)?this.$message.info("取消了删除！"):(e=(await this.$http.post("deleteRoleRightLevelOne",{hRoleID:e.t_ID,hkeys:t}))["data"],200!==e.status?this.$message.error("删除一级权限失败！"):void this.getRoleList())},async showSetRightDialog(e){var t=(await this.$http.post("getRightList"))["data"];if(200!==t.status)return this.$message.error("获取权限数据失败！");this.rightslist=JSON.parse(t.data),this.getLeafKeys(e,this.defKeys),this.roleId=e.t_ID,this.setRightDialogVisible=!0},addDialogClosed(){this.$refs.addFormRef.resetFields()},addRoleListACL(){this.$refs.addFormRef.validate(async e=>{if(e)return""===this.cat_pid?this.$message.error("请选择授权对象的分类！"):0===this.ruleDefineList.length?this.$message.error("当前类型没有可选的限定范围。如需授权，请先增加该类的约束条件定义。然后再进行范围授权！"):(e=(await this.$http.post("AddRoleListACL",{hRoleID:this.vRoleID,hRuleID:this.vRuleID,hCatID:this.cat_pid}))["data"],200!==e.status?this.$message.error("范围授权失败！"+e.Msg):(this.$message.success("角色的范围授权成功！"),this.addDialogVisible=!1,void this.getRoleList()))})},async showEditDialog(e){if(e=(await this.$http.post("getRole",{mRoleID:e})).data,200!==e.status)return this.$message.error("查询用户信息失败！");this.editForm=JSON.parse(e.data),this.editDialogVisible=!0},editDialogClosed(){this.$refs.editFormRef.resetFields()},editRole(){this.$refs.editFormRef.validate(async e=>{if(e){if(e=(await this.$http.post("editRole",{form:JSON.stringify(this.editForm)}))["data"],200!==e.status)return this.$message.error("更新用户信息失败！");this.editDialogVisible=!1,this.getRoleList(),this.$message.success("更新角色信息成功！")}})},async setRole(e){if(this.userInfo=e,e=(await this.$http.get("roles")).data,200!==e.meta.status)return this.$message.error("获取角色列表失败！");this.rolesList=e.data,this.setRoleDialogVisible=!0},getLeafKeys(e,t){if(!e.Children)return t.push(e.t_ID);e.Children.forEach(e=>this.getLeafKeys(e,t))},setRightDialogClosed(){this.defKeys=[]},async allotRights(){const e=[this.$refs.treeRef.getCheckedKeys(),this.$refs.treeRef.getHalfCheckedKeys()];var t=e.join(",");t=(await this.$http.post("allotRoleRights",{hRoleID:this.roleId,hKeys:t}))["data"];if(200!==t.status)return this.$message.error("分配权限失败！");this.$message.success("分配权限成功！"),this.getRoleList(),this.setRightDialogVisible=!1}}};i=i("2877"),i=Object(i.a)(s,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"mainZone",staticClass:"datalist-container",style:{height:e.mainHeight+"px"}},[i("el-row",{attrs:{gutter:5}},[i("el-col",{attrs:{span:4}},[i("el-card",{attrs:{"body-style":{padding:"5px"}}},[i("el-table",{ref:"roletableRef",attrs:{data:e.rolelist,height:e.slbHeight,border:"",stripe:"","highlight-current-row":""},on:{"row-click":e.handleRowClick}},[e._e(),e._e(),i("el-table-column",{attrs:{label:"角色",prop:"t_Name",align:"center"}}),e._e()],1)],1)],1),i("el-col",{attrs:{span:20}},[i("el-card",{attrs:{"body-style":{padding:"5px"}}},[i("el-row",[i("el-col",[i("el-button",{staticStyle:{"margin-left":"5px"},attrs:{icon:"el-icon-circle-plus-outline",type:"primary"},on:{click:e.OpenAddDialog}},[e._v("增加基础权")])],1)],1),e.mFlag?i("el-table",{attrs:{data:e.ruleList,height:e.tableHeight,border:"",stripe:"","highlight-current-row":"","row-style":{height:"30px"},"cell-style":{padding:"0px"}}},[i("el-table-column",{attrs:{type:"index",label:"序号"}}),e._e(),e._e(),i("el-table-column",{attrs:{prop:"OBJCLASSNAME",label:"保密类型"}}),i("el-table-column",{attrs:{prop:"RULENAME",label:"授权规则"}}),i("el-table-column",{attrs:{prop:"ExpressionScope",label:"限制范围",width:"380"}}),e._e(),e._e(),i("el-table-column",{attrs:{label:"操作",width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除角色的该条范围授权",enterable:!1,placement:"top"}},[i("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini",circle:"",plain:""},on:{click:function(i){return e.deleteListACL(t.row)}}})],1)]}}],null,!1,451333965)})],1):e._e()],1)],1)],1),i("el-dialog",{attrs:{title:"范围授权",visible:e.addDialogVisible,width:"50%"},on:{"update:visible":function(t){e.addDialogVisible=t},close:e.addDialogClosed}},[i("el-form",{ref:"addFormRef",attrs:{model:e.addForm,"label-width":"70px"}},[i("el-form-item",{attrs:{label:"角色",prop:"rolename"}},[i("el-input",{attrs:{disabled:""},model:{value:e.vRoleName,callback:function(t){e.vRoleName=t},expression:"vRoleName"}})],1),i("el-form-item",{attrs:{label:"CatID"}},[i("el-input",{attrs:{disabled:""},model:{value:e.cat_pid,callback:function(t){e.cat_pid=t},expression:"cat_pid"}},[e._v("CatID")])],1),i("el-form-item",{attrs:{label:"选择分类"}},[i("el-cascader",{ref:"LinkBref",attrs:{options:e.parentCateList,props:e.cascaderProps,size:"medium",clearable:""},on:{change:e.parentCateChanged},model:{value:e.selectedKeys,callback:function(t){e.selectedKeys=t},expression:"selectedKeys"}})],1),0<this.ruleDefineList.length?i("el-form-item",{attrs:{label:"选择条件"}},[[i("el-radio-group",{model:{value:e.vRuleName,callback:function(t){e.vRuleName=t},expression:"vRuleName"}},e._l(e.ruleDefineList,(function(t){return i("el-radio",{key:t.t_ID,attrs:{label:t.t_Name},on:{change:function(i){return e.handleRadioChange(i,t.t_ExpressionScope,t.t_ID)}}},[e._v(e._s(t.t_Display)+" ")])})),1)]],2):e._e(),e.mFlagDef?i("el-form-item",{attrs:{label:"约束条件",prop:"remark"}},[i("el-input",{attrs:{disabled:""},model:{value:e.addForm.remark,callback:function(t){e.$set(e.addForm,"remark",t)},expression:"addForm.remark"}})],1):e._e()],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.addDialogVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.addRoleListACL}},[e._v("确 定")])],1)],1),i("el-dialog",{attrs:{title:"修改角色",visible:e.editDialogVisible,width:"50%"},on:{"update:visible":function(t){e.editDialogVisible=t},close:e.editDialogClosed}},[i("el-form",{ref:"editFormRef",attrs:{model:e.editForm,"label-width":"70px"}},[i("el-form-item",{attrs:{label:"角色"}},[i("el-input",{model:{value:e.editForm.Name,callback:function(t){e.$set(e.editForm,"Name",t)},expression:"editForm.Name"}})],1),i("el-form-item",{attrs:{label:"角色说明"}},[i("el-input",{model:{value:e.editForm.Remark,callback:function(t){e.$set(e.editForm,"Remark",t)},expression:"editForm.Remark"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.editDialogVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.editRole}},[e._v("确 定")])],1)],1),i("el-dialog",{attrs:{title:"分配权限",visible:e.setRightDialogVisible,width:"50%"},on:{"update:visible":function(t){e.setRightDialogVisible=t},close:e.setRightDialogClosed}},[i("el-scrollbar",{staticStyle:{height:"500px"}},[i("el-tree",{ref:"treeRef",attrs:{data:e.rightslist,props:e.treeProps,"show-checkbox":"","node-key":"t_ID","default-checked-keys":e.defKeys}})],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.setRightDialogVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.allotRights}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,"7a74c7c9",null);t.default=i.exports}}]);