(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-51788a60"],{"0223":function(e,t,a){"use strict";a.r(t);var s={data(){return{dataRoleACL:[],setACLDialogVisible:!1,dataACLList:[],currentIndex:"",treeProps:{label:"Name",disabled:"Flag",children:"Children"},defKeys:[],vRoleName:"",roleId:"",ruleId:"",addDialogVisible:!1,addForm:{rolename:"",remark:""},editDialogVisible:!1,editForm:{},setRoleDialogVisible:!1,userInfo:{},ruleList:[],ruleDefineList:[],mFlag:!1,mFlagCat:!1,mFlagDef:!1,vRuleName:"",parentCateList:[],cascaderProps:{value:"t_ID",label:"label",children:"Children",checkStrictly:!0,expandTrigger:"hover"},selectedKeys:[],catName:"",cat_pid:"",cat_level:0,config:{id:"t_ID",pid:"ParentID",children:"children"}}},created(){this.getRoleACL(),this.getParentCateList(),this.$root.leveOnePathName="系统管理",this.$root.leveTwoPathName="数据授权",this.tableHeight=JSON.parse(window.localStorage.getItem("gHeight"))-230,this.slbHeight=JSON.parse(window.localStorage.getItem("gHeight"))-195,this.mainHeight=JSON.parse(window.localStorage.getItem("gHeight"))-185},watch:{selectedKeys(){this.$refs.LinkBref&&(this.$refs.LinkBref.dropDownVisible=!1)}},methods:{toogleExpand(e){const t=this.$refs.table;this.dataRoleACL.map(a=>{e.RoleID!==a.RoleID&&t.toggleRowExpansion(a,!1)}),t.toggleRowExpansion(e),this.currentIndex=e.RoleID},addRoleListACL(){this.$refs.addFormRef.validate(async e=>{if(e)return""===this.cat_pid?this.$message.error("请选择授权对象的分类！"):0===this.ruleDefineList.length?this.$message.error("当前类型没有可选的限定范围。如需授权，请向管理员申请增加约束条件范围。然后再进行范围授权！"):(e=(await this.$http.post("AddRoleListACL",{hRoleID:this.vRoleID,hRuleID:this.vRuleID,hCatID:this.cat_pid}))["data"],200!==e.status?this.$message.error("范围授权失败！"+e.Msg):(this.$message.success("角色的范围授权成功！"),this.addDialogVisible=!1,void this.getRoleACL()))})},async getCatRuleList(e){if(e=(await this.$http.post("getCatRuleList",{hCatID:e})).data,200!==e.status)return this.$message.error("获取Role规则失败！");this.ruleDefineList=JSON.parse(e.data),0<this.ruleDefineList.length&&(this.vRuleName="",this.mFlagDef=!0,null===this.ruleDefineList[0].t_ExpressionScope?this.addForm.remark="全局范围":this.addForm.remark=this.ruleDefineList[0].t_ExpressionScope)},async handleRadioChange(e,t,a){this.vRuleID=a,this.mFlagDef=!0,this.addForm.remark=null===t?"全局范围":t},async getParentCateList(){var e=(await this.$http.post("getCatTree"))["data"];if(200!==e.status)return this.$message.error("获取父级分类数据失败！");this.parentCateList=e.data1},parentCateChanged(e){this.vOperation="",this.hValue="",this.vRuleName="",this.vFieldID="",this.vExpression="",this.vLength=0,this.mFlagCat=!1,this.mFlagDef=!1,0<this.selectedKeys.length?(this.cat_pid=this.selectedKeys[this.selectedKeys.length-1],this.cat_level=this.selectedKeys.length,this.catName=this.$refs.LinkBref.getCheckedNodes()[0].pathLabels[this.selectedKeys.length-1],this.mFlagCat=!0,this.getCatRuleList(this.cat_pid)):(this.cat_pid="",this.catName="",this.cat_level=0,this.fieldlist="",this.vFieldID="",this.mFlagCat=!1,this.mFlagDef=!1,this.vExpression="")},OpenAddDialog(e){this.catName="",this.cat_pid="",this.vRuleID="",this.selectedKeys=[],this.ruleDefineList=[],this.vRoleName=e.RoleName,this.vRoleID=e.RoleID,this.mFlagCat=!1,this.mFlagDef=!1,this.addDialogVisible=!0},addDialogClosed(){this.$refs.addFormRef.resetFields()},async getRoleACL(){var e=(await this.$http.post("getAllDataACL"))["data"];if(200!==e.status)return this.$message.error("获取角色列表失败！");this.dataRoleACL=e.dataRoleACL},async deleteDataLevelTwo(e,t){return"confirm"!==await this.$confirm("此操作将删除角色对该类数据的"+t.ACLName+"权限，确信删除吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e)?this.$message.info("取消了删除！"):(e=(await this.$http.post("deleteDataLevelTwo",{hRoleID:e.RoleID,hRuleID:e.RuleID,hkey:t.ACLID}))["data"],200!==e.status?this.$message.error(t.ACLName+"-- 权限删除失败！"):(this.$message.error(t.ACLName+" -- 数据权限删除成功！"),void this.getRoleACL()))},async deleteCatLevelOne(e,t){return"confirm"!==await this.$confirm("此操作将删除角色-"+e.RoleName+"-对该类数据的全部权限，从而无法访问，确信删除吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e)?this.$message.info("取消了删除！"):(e=(await this.$http.post("deleteCatLevelOne",{hRoleID:e.RoleID,hCatID:t}))["data"],200!==e.status?this.$message.error("删除该类的数据权限失败！"):void this.getRoleACL())},async showSetDataACLDialog(e){this.defKeys=[];var t=(await this.$http.post("getTreeDataACL",{hRoleID:e.RoleID,hRuleID:e.RuleID,hCatName:e.CatName}))["data"];if(200!==t.status)return this.$message.error("获取权限数据失败！");this.dataACLList=JSON.parse(t.data),this.getLeafKeys(e,this.defKeys),this.roleId=e.RoleID,this.ruleId=e.RuleID,this.setACLDialogVisible=!0},getLeafKeys(e,t){if(!e.Children)return t.push(e.ID);e.Children.forEach(e=>this.getLeafKeys(e,t))},setRightDialogClosed(){this.defKeys=[]},async allotDataACL(){const e=[this.$refs.treeRef.getCheckedKeys(),this.$refs.treeRef.getHalfCheckedKeys()];var t=e.join(",");t=(await this.$http.post("allotDataACL",{hRoleID:this.roleId,hRuleID:this.ruleId,hKeys:t}))["data"];if(200!==t.status)return this.$message.error("数据权限分配失败！---"+t.Msg);this.$message.success("数据权限分配成功！"),this.getRoleACL(),this.setACLDialogVisible=!1}}};a("ca5b"),a=a("2877"),a=Object(a.a)(s,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"mainZone",staticClass:"datalist-container",style:{height:e.mainHeight+"px"}},[a("el-card",[a("el-table",{ref:"table",attrs:{data:e.dataRoleACL,height:e.tableHeight,border:"",stripe:""}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.Children,(function(s,i){return a("el-row",{key:s.id,class:["bdbottom",0===i?"bdtop":"","vcenter"]},[a("el-col",{attrs:{span:5}},[a("el-tag",{attrs:{closable:""},on:{close:function(a){return e.deleteCatLevelOne(t.row,s.CatID)}}},[e._v(e._s(s.CatName))]),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:0<s.ExpressionScope.length?"受限范围":"全类范围",placement:"top-end"}},[a("i",{class:0<s.ExpressionScope.length?"el-icon-star-off":"el-icon-star-on"})])],1),a("el-col",{attrs:{span:15}},e._l(s.Children,(function(t){return a("el-tag",{key:t.id,attrs:{type:"success",closable:"9"!==t.ACLID},on:{close:function(a){return e.deleteDataLevelTwo(s,t)}}},[e._v(e._s(t.ACLName))])})),1),a("el-col",{attrs:{span:4}},[a("el-button",{attrs:{size:"mini",type:"warning",icon:"el-icon-setting"},on:{click:function(t){return e.showSetDataACLDialog(s)}}},[e._v("分配权限")])],1)],1)}))}}])}),a("el-table-column",{attrs:{type:"index"}}),a("el-table-column",{attrs:{label:"角色名称",prop:"RoleName"}}),e._e(),e._e(),a("el-table-column",{attrs:{label:"操作",width:"300px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary",plain:"",icon:"el-icon-search"},on:{click:function(a){return e.toogleExpand(t.row)}}},[e._v("查看权限")]),a("el-button",{attrs:{size:"mini",type:"primary",plain:"",icon:"el-icon-setting"},on:{click:function(a){return e.OpenAddDialog(t.row)}}},[e._v("设定范围")])]}}])})],1)],1),a("el-dialog",{attrs:{title:"设定范围",visible:e.addDialogVisible,width:"50%"},on:{"update:visible":function(t){e.addDialogVisible=t},close:e.addDialogClosed}},[a("el-form",{ref:"addFormRef",attrs:{model:e.addForm,"label-width":"70px"}},[a("el-form-item",{attrs:{label:"角色",prop:"rolename"}},[a("el-input",{attrs:{disabled:""},model:{value:e.vRoleName,callback:function(t){e.vRoleName=t},expression:"vRoleName"}})],1),e._e(),a("el-form-item",{attrs:{label:"选择分类"}},[a("el-cascader",{ref:"LinkBref",attrs:{options:e.parentCateList,props:e.cascaderProps,size:"medium",clearable:""},on:{change:e.parentCateChanged},model:{value:e.selectedKeys,callback:function(t){e.selectedKeys=t},expression:"selectedKeys"}})],1),0<this.ruleDefineList.length?a("el-form-item",{attrs:{label:"选择条件"}},[[a("el-radio-group",{model:{value:e.vRuleName,callback:function(t){e.vRuleName=t},expression:"vRuleName"}},e._l(e.ruleDefineList,(function(t){return a("el-radio",{key:t.t_ID,attrs:{label:t.t_Name},on:{change:function(a){return e.handleRadioChange(a,t.t_ExpressionScope,t.t_ID)}}},[e._v(e._s(t.t_Display)+" ")])})),1)]],2):e._e(),e.mFlagDef?a("el-form-item",{attrs:{label:"约束条件",prop:"remark"}},[a("el-input",{attrs:{disabled:""},model:{value:e.addForm.remark,callback:function(t){e.$set(e.addForm,"remark",t)},expression:"addForm.remark"}})],1):e._e()],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.addDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.addRoleListACL}},[e._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"分配数据权限",visible:e.setACLDialogVisible,width:"50%"},on:{"update:visible":function(t){e.setACLDialogVisible=t},close:e.setRightDialogClosed}},[a("el-scrollbar",{staticStyle:{height:"360px"}},[a("el-tree",{ref:"treeRef",attrs:{data:e.dataACLList,props:e.treeProps,"show-checkbox":"","node-key":"ID","default-expand-all":"","default-checked-keys":e.defKeys}})],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.setACLDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.allotDataACL}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,"2ee27060",null);t.default=a.exports},"9f19":function(e,t,a){},ca5b:function(e,t,a){"use strict";a("9f19")}}]);