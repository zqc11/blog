(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-30ab0f29"],{"1f8c":function(e,t,i){"use strict";i.r(t);var a={name:"DocItemDetail",props:["editItemID"],data(){return{editItemID:"",ItemCatID:"",DataName:"Item Detail",DataDetailDialogVisible:!1,activeName:"tab-1",addFileFlag:!1,delFlag:!0,fileList:[],mUrl:"",mDocObj:{DocID:"",hToken:window.sessionStorage.getItem("token")},loadProgress:0,progressFlag:!1,addDocForm:{},editDocForm:{},docList:[],fileItemlist:[],templist:[],linkExpressionList:[],linkItemList:[],tableBfieldlist:[],tableAfieldlist:[],linkAfieldlist:[],reviewItemList:[],reviewFieldList:[],versionItemList:[],treeProps:{value:"t_ID",label:"label",t_Type:-1,children:"Children",isLeaf:!0,checkStrictly:!0,expandTrigger:"hover"},selectedKeys:[],idArray:[],total:0,pageFlag:!0}},created(){this.getDocItemDetail(),this.mUrl=this.$root.gBaseURL+"/UploadFileDoc"},methods:{async downloadMainFile(){const e=new FormData;e.append("mDocID",this.editItemID),this.loading=!0,await this.$http.post("DownloadMainFile",e,{responseType:"arraybuffer"}).then(e=>{if(0===e.data.size)return this.loading=!1,this.$message.error("文件已经不存在，下载失败！");var t=e.headers["content-disposition"].split(";")[1].split("FileName=")[1];t=decodeURIComponent(t);this.saveMainFile(e.data,t),this.loading=!1}).catch(e=>{this.loading=!1,this.$message.error("文件可能不存在，或者网络处于断开状态！")})},saveMainFile(e,t){if(e){e=window.URL.createObjectURL(new Blob([e]));const i=document.createElement("a");i.style.display="none",i.href=e,i.setAttribute("download",t),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(e)}},async deleteDocItem(e,t){var i;return this.queryInfo.query="","confirm"!==await this.$confirm("此操作将永久删除该文档, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e)?this.$message.info("已取消删除"):(i=(await this.$http.post("deleteDocBusiness",{hItemID:this.editItemID,hCatID:this.ItemCatID,hToken:window.sessionStorage.getItem("token")}))["data"],200!==i.status?this.$message.error("删除文档失败 -- "+i.Msg):void this.$message.success("删除文档成功！"))},async showBrowseDialog(){this.componentKey=this.componentKey+1,this.getMainFileType().then(e=>{if(".pdf"!=e)throw new Error("检测到不是PDF文件格式！");this.openVuePdf()}).catch(e=>{this.loading=!1,this.$message.error("当前文件不是PDF格式，请下载后浏览！")})},async getDocItemDetail(){this.addFileFlag=!1,this.editItemID="2ffaaf8c-8720-42af-b832-0f4612ff1152";var e=(await this.$http.post("getDocItemDetail",{hDocItemID:this.editItemID,hToken:window.sessionStorage.getItem("token")}))["data"];return 202===e.status?this.$message.error("请重新登录！"):200!==e.status?this.$message.error("显示数据失败！"+e.Msg):(0!==e.total?this.fileItemlist=JSON.parse(e.data):this.fileItemlist=[],this.editDocForm=JSON.parse(e.mStream)[0],this.linkExpressionList=e.data_MetaLink,this.tableAfieldlist=JSON.parse(e.tableAfield),this.tableBfieldlist=JSON.parse(e.tableBfield),this.DataName=this.editDocForm.t_Name,this.editDocForm.t_CreateTime=this.showDate(this.editDocForm.t_CreateTime),this.editDocForm.t_CheckOutTime=this.showDate(this.editDocForm.t_CheckOutTime),this.editDocForm.t_ReleaseTime=this.showDate(this.editDocForm.t_ReleaseTime),this.editDocForm.t_LastModTime=this.showDate(this.editDocForm.t_LastModTime),this.DataDetailDialogVisible=!0,this.$nextTick(()=>{this.$refs.tableRef.setCurrentRow(this.fileItemlist[0]),this.$refs.linkRef.setCurrentRow(this.linkExpressionList[0])}),0<this.linkExpressionList.length&&this.getlinkItemList(this.linkExpressionList[0].SourceCatID,this.linkExpressionList[0].TargetCatID,this.editItemID,this.linkExpressionList[0].ExpressionID),void this.getReviewList(this.editItemID))},getDocItem(e){this.itemList.forEach(t=>{t.t_ID===e&&(t.t_ControlType,this.editDocForm=t,this.editDocForm.t_CreateTime=this.showDate(this.editDocForm.t_CreateTime),this.editDocForm.t_CheckOutTime=this.showDate(this.editDocForm.t_CheckOutTime),this.editDocForm.t_ReleaseTime=this.showDate(this.editDocForm.t_ReleaseTime),this.editDocForm.t_LastModTime=this.showDate(this.editDocForm.t_LastModTime))})},async getDocFile(){var e=(await this.$http.post("getDocFile",{hDocItemID:this.editItemID,hCatID:this.queryInfo.catID,hToken:window.sessionStorage.getItem("token")}))["data"];return 202===e.status?this.$message.error("请重新登录！"):200!==e.status?this.$message.error("显示数据失败！"+e.Msg):(0!==e.total?this.fileItemlist=JSON.parse(e.data):this.fileItemlist=[],this.total=e.total,void this.$nextTick(()=>{this.$refs.tableRef.setCurrentRow(this.fileItemlist[0])}))},async getlinkExpressionList(){var e=(await this.$http.post("getlinkExpressionList",{hCatID:this.queryInfo.catID}))["data"];if(200!==e.status)return this.$message.error("获取父级分类数据失败！");this.linkExpressionList=e.data_MetaLink,this.tableAfieldlist=JSON.parse(e.tableAfield),this.tableBfieldlist=JSON.parse(e.tableBfield)},async getReviewList(e){if(e=(await this.$http.post("getReviewList",{hItemID:e})).data,200!==e.status)return this.$message.error("评审过程数据失败！");0!==e.total?this.reviewItemList=JSON.parse(e.data):this.reviewItemList=[],this.reviewFieldList=JSON.parse(e.tableBfield)},HandCloseDetail(){this.$nextTick(()=>{})},uploadProcess(e,t,i){this.progressFlag=!0,this.loadProgress=parseInt(e.percent),100<=this.loadProgress&&(this.loadProgress=100,setTimeout(()=>{this.progressFlag=!1,this.addDialogVisible=!1},1e3))},handleSuccess(e){this.$message.success("上传 文件 成功！"),this.getDocItemDetail(),this.$refs.upload.clearFiles(),this.$nextTick((function(){this.addFileFlag=!1}))},handleFileChange(e,t){if(1<t.length&&"fail"!==e.status?t.splice(0,1):"fail"===e.status&&(this.$message.warning("上传失败，请重新上传！"),t.splice(0,1)),50<e.size/1048576)return this.$message.warning("当前限制文件大小不能大于50M"),!1;var i=e.name.replace(/(.*\/)*([^.]+).*/gi,"$2");e=e.name.split(".").pop();this.fileList=t.slice(-3),this.addFileFlag=!0,this.mDocObj.DocID=this.editItemID,this.addDocForm.t_Name=i,this.addDocForm.t_Extension=e},handLinkRowClick(e,t,i){this.linkItemList=[],this.getlinkItemList(e.SourceCatID,e.TargetCatID,this.editItemID,e.ExpressionID)},async getlinkItemList(e,t,i,a){if(e=(await this.$http.post("getLinkItemList",{hSourceCatID:e,hTargetCatID:t,hItemID:i,hExpressionID:a,hToken:window.sessionStorage.getItem("token"),argItemIDs:null})).data,200!==e.status)return this.$message.error("获取关联表达式对应的 LinkItem 数据失败！");0!==e.total?this.linkItemList=JSON.parse(e.data):this.linkItemList=[],this.linkAfieldlist=JSON.parse(e.tableAfield)},async submitFile(){if("confirm"!==await this.$confirm("确信要替换文件，并以新文件为正式版本吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e))return this.$message.info("已取消替换");this.mDocObj.DocID=this.editItemID,this.$refs.upload.submit().then(()=>{this.getDocItemDetail()}),this.$nextTick((function(){this.$refs.addSubmit.display=!1,this.addFileFlag=!1}))},showDate(e){return new Date(e).toLocaleString()},handleClick(e,t){"tab-whereused"===e.paneName?this.getWhereUsedItemList(this.queryInfo.catID,this.editItemID):"second"===e.paneName?alert(2):"third"===e.paneName&&alert(3),this.addFileFlag=!1}}};i("46d7"),i=i("2877"),i=Object(i.a)(a,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{attrs:{title:e.DataName,visible:e.DataDetailDialogVisible,width:"70%"},on:{"update:visible":function(t){e.DataDetailDialogVisible=t},close:e.HandCloseDetail}},[i("el-card",{staticClass:"card-3",attrs:{"body-style":{padding:"5px"}}},[i("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:"文件",name:"tab-1"}},[i("el-row",[i("el-col",{attrs:{span:16}},[i("el-table",{ref:"tableRef",attrs:{data:e.fileItemlist,"header-cell-style":{"text-align":"center"},height:"530px",border:"",stripe:""}},[i("el-table-column",{attrs:{type:"index"}}),i("el-table-column",{attrs:{width:"250px","show-overflow-tooltip":!0,label:"文件名",prop:"t_FileName"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"版本",prop:"t_VerNo"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"有效",prop:"t_IsNew"}}),e._e(),e._e(),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"长度",prop:"t_FileLength"}}),e._e(),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"提交人",prop:"t_Name"}}),i("el-table-column",{attrs:{width:"150px","show-overflow-tooltip":!0,label:"提交时间",prop:"t_ModTime"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.t_ModTime.substring(0,16).replace("T"," ")))])]}}])})],1)],1),i("el-col",{attrs:{span:8}},[i("el-card",{attrs:{"body-style":{padding:"5px"}}},[i("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{data:e.mDocObj,"on-change":e.handleFileChange,"on-progress":e.uploadProcess,"on-success":e.handleSuccess,drag:"",action:e.mUrl,limit:10,"file-list":e.fileList,"auto-upload":!1}},[i("i",{staticClass:"el-icon-upload"}),i("div",{staticClass:"el-upload__text"},[e._v(" 如替换，将文件拖到此处，或 "),i("em",[e._v("点击上传")])])]),e.progressFlag?i("el-progress",{attrs:{percentage:e.loadProgress}}):e._e()],1),e.addFileFlag?i("el-button",{ref:"addSubmit",attrs:{type:"primary"},on:{click:e.submitFile}},[e._v("确 定")]):e._e()],1)],1)],1),i("el-tab-pane",{attrs:{label:"状态",name:"tab-7"}},[i("el-form",{ref:"editDataFormRef",staticClass:"form-field",attrs:{model:e.editDocForm,"label-width":"80px","label-position":"left",disabled:""}},[i("el-form-item",{attrs:{label:"创建者"}},[i("el-input",{model:{value:e.editDocForm.v_CreateByName,callback:function(t){e.$set(e.editDocForm,"v_CreateByName",t)},expression:"editDocForm['v_CreateByName']"}})],1),i("el-form-item",{attrs:{label:"创建时间"}},[i("el-input",{model:{value:e.editDocForm.t_CreateTime,callback:function(t){e.$set(e.editDocForm,"t_CreateTime",t)},expression:"editDocForm['t_CreateTime']"}})],1),i("el-form-item",{attrs:{label:"修改者"}},[i("el-input",{model:{value:e.editDocForm.v_ModByName,callback:function(t){e.$set(e.editDocForm,"v_ModByName",t)},expression:"editDocForm['v_ModByName']"}})],1),i("el-form-item",{attrs:{label:"修改时间"}},[i("el-input",{model:{value:e.editDocForm.t_LastModTime,callback:function(t){e.$set(e.editDocForm,"t_LastModTime",t)},expression:"editDocForm['t_LastModTime']"}})],1),i("el-form-item",{attrs:{label:"类别"}},[i("el-input",{model:{value:e.editDocForm.v_CatName,callback:function(t){e.$set(e.editDocForm,"v_CatName",t)},expression:"editDocForm['v_CatName']"}})],1),i("el-form-item",{attrs:{label:"状态"}},[i("el-input",{model:{value:e.editDocForm.v_StateName,callback:function(t){e.$set(e.editDocForm,"v_StateName",t)},expression:"editDocForm['v_StateName']"}})],1),i("el-form-item",{attrs:{label:"版本"}},[i("el-input",{model:{value:e.editDocForm.t_Ver,callback:function(t){e.$set(e.editDocForm,"t_Ver",t)},expression:"editDocForm['t_Ver']"}})],1),i("el-form-item",{attrs:{label:"安全级别"}},[i("el-input",{model:{value:e.editDocForm.v_SecurityLevelName,callback:function(t){e.$set(e.editDocForm,"v_SecurityLevelName",t)},expression:"editDocForm['v_SecurityLevelName']"}})],1)],1)],1),i("el-tab-pane",{attrs:{label:"属性",name:"tab-2"}},e._l(e.tableBfieldlist,(function(t){return i("el-form",{key:t.t_FieldID,ref:"editDataFormRef",refInFor:!0,staticClass:"form-field",attrs:{model:e.editDocForm,"label-width":"80px",disabled:"",size:"small","label-position":"left"}},[i("el-form-item",{attrs:{label:t.t_Name}},[3===t.t_ControlType?i("div",[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.editDocForm[t.t_FieldName],callback:function(i){e.$set(e.editDocForm,t.t_FieldName,i)},expression:"editDocForm[Bfield.t_FieldName]"}},e._l(t.PropValue,(function(e){return i("el-option",{key:e.t_No,attrs:{label:e.t_Display,value:e.t_Value}})})),1)],1):i("div",[i("el-input",{model:{value:e.editDocForm[t.t_FieldName],callback:function(i){e.$set(e.editDocForm,t.t_FieldName,i)},expression:"editDocForm[Bfield.t_FieldName]"}})],1)])],1)})),1),i("el-tab-pane",{attrs:{label:"相关",name:"tab-3"}},[i("el-row",{attrs:{gutter:15}},[i("el-col",{attrs:{span:6}},[i("el-table",{ref:"linkRef",attrs:{data:e.linkExpressionList,height:"500px","header-cell-style":{"text-align":"center"},border:"",stripe:""},on:{"row-click":e.handLinkRowClick}},[i("el-table-column",{attrs:{type:"index",width:"50"}}),i("el-table-column",{attrs:{prop:"LinkName",label:"相关类别"}})],1)],1),i("el-col",{attrs:{span:18}},[i("el-table",{directives:[{name:"show",rawName:"v-show",value:0<e.linkItemList.length,expression:"linkItemList.length > 0 ? true: false"}],attrs:{data:e.linkItemList,"header-cell-style":{"text-align":"center"},height:"500px",border:"",stripe:""}},[i("el-table-column",{attrs:{type:"index"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"名称",prop:"t_Name"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"代号",prop:"t_Code"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"类别",prop:"v_CatName"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"创建者",prop:"v_CreateByName"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"创建时间",prop:"t_CreateTime"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.t_CreateTime.substring(0,16).replace("T"," ")))])]}}],null,!1,791078019)})],1)],1)],1)],1),e._e(),i("el-tab-pane",{attrs:{label:"审批",name:"tab-8"}},[i("el-table",{directives:[{name:"show",rawName:"v-show",value:0<e.reviewItemList.length,expression:"reviewItemList.length > 0 ? true: false"}],attrs:{data:e.reviewItemList,height:"500px",border:"",stripe:""}},[i("el-table-column",{attrs:{type:"index"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"审批流程",prop:"CFLOWOBJNAME"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"节点任务",prop:"t_StepName"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"负责人",prop:"t_LoginName"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"任务状态",prop:"t_StepState"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"评审结论",prop:"t_IsAgree"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"评审意见",prop:"t_Detail"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"附件",prop:"CATTACHFILE"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"签署时间",prop:"t_CreateTime"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"开始时间",prop:"t_ActualStart"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"结束时间",prop:"t_ActualFinish"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"批次号",prop:"t_BatchNo"}})],1)],1),e._e()],1)],1)],1)],1)}),[],!1,null,"6b3a3344",null);t.default=i.exports},"3f68":function(e,t,i){},"46d7":function(e,t,i){"use strict";i("3f68")}}]);