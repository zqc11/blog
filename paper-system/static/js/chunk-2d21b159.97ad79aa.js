(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2d21b159"],{bdef:function(e,t,a){"use strict";a.r(t);var s={data(){var e=(e,t,a)=>{if(!t)return a(new Error("手机号不能为空"));{const e=/^1[3|4|5|7|8][0-9]\d{8}$/;if(!e.test(t))return a(new Error("请输入正确的手机号"));a()}};return{mainHeight:this.$root.gScreenHeight-70,tableHeight:this.$root.gScreenHeight-182,queryInfo:{query:"",pagenum:1,pagesize:30},userlist:[],total:0,editForm:{vName:"",vLoginName:"",vPassword:"",vSex:1,vBirthday:"2022-01-01",vIsActive:1,vIsOnJob:1,vContactInfo:""},addForm:{vName:"",vLoginName:"",vPassword:"",vSex:1,vBirthday:"2022-01-01",vIsActive:1,vIsOnJob:1,vContactInfo:""},addDialogVisible:!1,addFormRules:{vName:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:3,max:10,message:"用户名的长度在1~10个字符之间",trigger:"blur"}],vLoginName:[{required:!0,message:"请输入登录用户名",trigger:"blur"},{min:3,max:10,message:"用户名的长度在1~10个字符之间",trigger:"blur"}],vContactInfo:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:e,trigger:"blur"}]},editFormRules:{vPassword:[{required:!0,message:"请输入密码",trigger:"blur"},{min:3,max:20,message:"密码长度在3~20个字符之间",trigger:"blur"}],vBirthday:[{required:!0,message:"请输入出生日期",trigger:"blur"}],vContactInfo:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:e,trigger:"blur"}]},editDialogVisible:!1,setRoleDialogVisible:!1,userInfo:{},rolesList:[],selectedRoleId:"",pageFlag:!0}},created(){this.getUserList(),this.$root.leveOnePathName="用户",this.$root.leveTwoPathName="用户列表",this.tableHeight=JSON.parse(window.localStorage.getItem("gHeight"))-240,this.slbHeight=JSON.parse(window.localStorage.getItem("gHeight"))-195,this.mainHeight=JSON.parse(window.localStorage.getItem("gHeight"))-185,this.mainWidth=this.$root.gScreenWidth-210},methods:{async getUserList(){var e=(await this.$http.post("getUserList",{hName:this.queryInfo.query,hPageNum:this.queryInfo.pagenum,hPageSize:this.queryInfo.pagesize}))["data"];if(200!==e.status)return this.$message.error("获取用户列表失败！");this.userlist=JSON.parse(e.data),this.total=this.userlist[0].total,this.pageFlag=this.total>this.queryInfo.pagesize,!0===this.pageFlag?this.tableHeight=JSON.parse(window.localStorage.getItem("gHeight"))-285:this.tableHeight=JSON.parse(window.localStorage.getItem("gHeight"))-240},handleSizeChange(e){this.queryInfo.pagesize=e,this.getUserList()},handleCurrentChange(e){this.queryInfo.pagenum=e,this.getUserList()},async userStateChanged(e){var t=(await this.$http.put(`users/${e.id}/state/`+e.mg_state))["data"];if(200!==t.meta.status)return e.mg_state=!e.mg_state,this.$message.error("更新用户状态失败！");this.$message.success("更新用户状态成功！")},addDialogClosed(){},async showAddDialog(){this.addForm.vID="",this.addForm.vName="",this.addForm.vLoginName="",this.addForm.vPassword="",this.addForm.vSex=1,this.addForm.vBirthday="2022-01-01",this.addForm.vIsActive=1,this.addForm.vIsOnJob=1,this.addForm.vContactInfo="",this.addDialogVisible=!0},addUser(){this.$refs.addFormRef.validate(async e=>{if(e){if(e=(await this.$http.post("addUser",{hName:this.addForm.vName,hUserName:this.addForm.vLoginName,hPassword:this.addForm.vPassword,hSex:this.addForm.vSex,hBirthday:this.addForm.vBirthday,hIsActive:this.addForm.vIsActive,hIsOnJob:this.addForm.vIsOnJob,hContactInfo:this.addForm.vContactInfo,hToken:window.sessionStorage.getItem("token")}))["data"],200!==e.status)return this.$message.error("添加用户失败！");this.$message.success("添加用户成功！"),this.addDialogVisible=!1,this.getUserList()}})},async showEditDialog(e){this.editForm.vID=e.t_ID,this.editForm.vName=e.t_Name,this.editForm.vLoginName=e.t_LoginName,this.editForm.vPassword="",this.editForm.vSex=e.t_Sex,this.editForm.vBirthday=e.t_Birthday,this.editForm.vIsActive=e.t_IsActive,this.editForm.vIsOnJob=e.t_IsOnJob,this.editForm.vContactInfo=e.t_ContactInfo,this.editDialogVisible=!0},editDialogClosed(){},async editUserInfo(){this.$refs.editFormRef.validate(async e=>{if(e)return"SYS_ADMIN"!==this.$root.gUserID?this.$message.error("只有系统管理员才能更改用户密码和信息！当前用户ID为"+this.$root.gUserID):(e=(await this.$http.post("EditUser",{hID:this.editForm.vID,hName:this.editForm.vName,hUserName:this.editForm.vLoginName,hBirthday:this.editForm.vBirthday,hPassword:this.editForm.vPassword,hSex:this.editForm.vSex,hIsActive:this.editForm.vIsActive,hIsOnJob:this.editForm.vIsOnJob,hContactInfo:this.editForm.vContactInfo}))["data"],200!==e.status?this.$message.error("更新用户信息失败！"+e.Msg):(this.editDialogVisible=!1,this.getUserList(),void this.$message.success("更新用户信息成功！")))})},mapStatus(e){return 1===e},mapBool(e){return!0===e?1:0},async deleteUserById(e){return 1===e.t_IsOnJob||1===e.t_IsActive?this.$message.info("用户处于激活状态，或者在岗状态，不能删除！"):"confirm"!==await this.$confirm("此操作将永久删除该用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e)?this.$message.info("已取消删除"):(e=(await this.$http.post("deleteUser",{hUserID:e.t_ID}))["data"],200!==e.status?this.$message.error("用户已经在系统中形成过历史记录，不允许删除！"):(this.$message.success("删除用户成功！"),void this.getUserList()))},async setRole(e){if(this.userInfo=e,e=(await this.$http.post("getRoleList")).data,200!==e.status)return this.$message.error("获取角色列表失败！");this.rolesList=JSON.parse(e.data),this.$message.error("获取角色列表--"+this.rolesList),this.setRoleDialogVisible=!0},async saveRoleInfo(){return this.selectedRoleId?(e=(await this.$http.put(`users/${this.userInfo.id}/role`,{rid:this.selectedRoleId}))["data"],200!==e.meta.status?this.$message.error("更新角色失败！"):(this.$message.success("更新角色成功！"),this.getUserList(),void(this.setRoleDialogVisible=!1))):this.$message.error("请选择要分配的角色！");var e},setRoleDialogClosed(){this.selectedRoleId="",this.userInfo={}}}};a=a("2877"),a=Object(a.a)(s,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"mainZone",staticClass:"datalist-container",style:{height:e.mainHeight+"px"}},[a("el-row",{attrs:{gutter:5}},[a("el-col",{attrs:{span:24}},[a("el-card",{attrs:{"body-style":{padding:"5px"}}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{placeholder:"请输入内容",clearable:""},on:{clear:e.getUserList},model:{value:e.queryInfo.query,callback:function(t){e.$set(e.queryInfo,"query",t)},expression:"queryInfo.query"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.getUserList},slot:"append"})],1)],1),a("el-col",{attrs:{span:4}},[a("el-button",{attrs:{type:"primary"},on:{click:e.showAddDialog}},[e._v("增加用户")])],1)],1),a("el-table",{attrs:{data:e.userlist,border:"",stripe:"",height:e.tableHeight}},[a("el-table-column",{attrs:{type:"index"}}),e._e(),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"姓名",prop:"t_Name"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"用户名",prop:"t_LoginName"}}),e._e(),e._e(),e._e(),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"联系方式",prop:"t_ContactInfo"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"出生年月",prop:"t_Birthday"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"建档日期",prop:"t_CreateTime"}}),a("el-table-column",{attrs:{label:"性别",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(0===t.row.t_Sex?"男":"女"))]}}])}),a("el-table-column",{attrs:{label:"在岗",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-value":1,"inactive-value":0,disabled:""},model:{value:t.row.t_IsOnJob,callback:function(a){e.$set(t.row,"t_IsOnJob",a)},expression:"scope.row.t_IsOnJob"}})]}}])}),a("el-table-column",{attrs:{label:"启用",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-value":1,"inactive-value":0,disabled:""},model:{value:t.row.t_IsActive,callback:function(a){e.$set(t.row,"t_IsActive",a)},expression:"scope.row.t_IsActive"}})]}}])}),a("el-table-column",{attrs:{label:"操作",width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(a){return e.showEditDialog(t.row)}}}),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(a){return e.deleteUserById(t.row)}}}),e._e()]}}])})],1),a("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.pageFlag,expression:"pageFlag"}],attrs:{"current-page":e.queryInfo.pagenum,"page-sizes":[10,30,50,100],"page-size":e.queryInfo.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)],1),a("el-dialog",{attrs:{title:"添加用户",visible:e.addDialogVisible,width:"50%"},on:{"update:visible":function(t){e.addDialogVisible=t},close:e.addDialogClosed}},[a("el-form",{ref:"addFormRef",attrs:{model:e.addForm,rules:e.addFormRules,"label-width":"70px"}},[a("el-form-item",{attrs:{label:"用户名",prop:"vLoginName"}},[a("el-input",{model:{value:e.addForm.vLoginName,callback:function(t){e.$set(e.addForm,"vLoginName",t)},expression:"addForm.vLoginName"}})],1),a("el-form-item",{attrs:{label:"姓名",prop:"vName"}},[a("el-input",{model:{value:e.addForm.vName,callback:function(t){e.$set(e.addForm,"vName",t)},expression:"addForm.vName"}})],1),e._e(),a("el-form-item",{attrs:{label:"性别"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-text":"男","inactive-text":"女"},model:{value:e.addForm.vSex,callback:function(t){e.$set(e.addForm,"vSex",t)},expression:"addForm.vSex"}})],1),a("el-form-item",{attrs:{label:"出生年月"}},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期"},model:{value:e.addForm.vBirthday,callback:function(t){e.$set(e.addForm,"vBirthday",t)},expression:"addForm.vBirthday"}})],1),a("el-form-item",{attrs:{label:"在岗"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-text":"是","inactive-text":"否"},model:{value:e.addForm.vIsOnJob,callback:function(t){e.$set(e.addForm,"vIsOnJob",t)},expression:"addForm.vIsOnJob"}})],1),a("el-form-item",{attrs:{label:"状态"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-text":"激活","inactive-text":"暂停"},model:{value:e.addForm.vIsActive,callback:function(t){e.$set(e.addForm,"vIsActive",t)},expression:"addForm.vIsActive"}})],1),a("el-form-item",{attrs:{label:"手机",prop:"vContactInfo"}},[a("el-input",{model:{value:e.addForm.vContactInfo,callback:function(t){e.$set(e.addForm,"vContactInfo",t)},expression:"addForm.vContactInfo"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.addDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.addUser}},[e._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"修改用户",visible:e.editDialogVisible,width:"50%"},on:{"update:visible":function(t){e.editDialogVisible=t},close:e.editDialogClosed}},[a("el-form",{ref:"editFormRef",attrs:{model:e.editForm,rules:e.editFormRules,"label-width":"70px"}},[e._e(),a("el-form-item",{attrs:{label:"用户名"}},[a("el-input",{attrs:{readonly:"",disabled:""},model:{value:e.editForm.vLoginName,callback:function(t){e.$set(e.editForm,"vLoginName",t)},expression:"editForm.vLoginName"}})],1),a("el-form-item",{attrs:{label:"姓名"}},[a("el-input",{attrs:{readonly:"",disabled:""},model:{value:e.editForm.vName,callback:function(t){e.$set(e.editForm,"vName",t)},expression:"editForm.vName"}})],1),a("el-form-item",{attrs:{label:"密码"}},[a("el-input",{attrs:{placeholder:"除非为用户重设密码，否则请勿输入！"},model:{value:e.editForm.vPassword,callback:function(t){e.$set(e.editForm,"vPassword",t)},expression:"editForm.vPassword"}})],1),a("el-form-item",{attrs:{label:"性别"}},[a("el-switch",{attrs:{"active-value":1,"active-text":"男","inactive-value":0,"inactive-text":"女"},model:{value:e.editForm.vSex,callback:function(t){e.$set(e.editForm,"vSex",t)},expression:"editForm.vSex"}})],1),a("el-form-item",{attrs:{label:"出生年月"}},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期"},model:{value:e.editForm.vBirthday,callback:function(t){e.$set(e.editForm,"vBirthday",t)},expression:"editForm.vBirthday"}})],1),a("el-form-item",{attrs:{label:"启用"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.editForm.vIsActive,callback:function(t){e.$set(e.editForm,"vIsActive",t)},expression:"editForm.vIsActive"}})],1),a("el-form-item",{attrs:{label:"在岗"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.editForm.vIsOnJob,callback:function(t){e.$set(e.editForm,"vIsOnJob",t)},expression:"editForm.vIsOnJob"}})],1),a("el-form-item",{attrs:{label:"手机号",prop:"vContactInfo"}},[a("el-input",{model:{value:e.editForm.vContactInfo,callback:function(t){e.$set(e.editForm,"vContactInfo",t)},expression:"editForm.vContactInfo"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.editDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.editUserInfo}},[e._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"分配角色",visible:e.setRoleDialogVisible,width:"50%"},on:{"update:visible":function(t){e.setRoleDialogVisible=t},close:e.setRoleDialogClosed}},[a("div",[a("p",[e._v("当前的用户："+e._s(e.userInfo.t_LoginName))]),a("p",[e._v("当前的角色："+e._s(e.userInfo.v_RoleName))]),a("p",[e._v("分配新角色： "),a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.selectedRoleId,callback:function(t){e.selectedRoleId=t},expression:"selectedRoleId"}},e._l(e.rolesList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.roleName,value:e.id}})})),1)],1)]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.setRoleDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.saveRoleInfo}},[e._v("确 定")])],1)])],1)}),[],!1,null,null,null);t.default=a.exports}}]);