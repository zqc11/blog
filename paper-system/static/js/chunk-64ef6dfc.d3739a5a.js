(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-64ef6dfc","chunk-0ab0bd56","chunk-46253dad"],{"0667":function(t,e,i){"use strict";i.r(e);var a=i("eff8");a={name:"viewPDF",props:["mDocItemID"],components:{pdf:i.n(a).a},data(){return{url:"",browseDialogVisible:!1,pageNum:1,pageTotalNum:1,pdfWidth:50,pdfLeft:25,pdfTop:2,pdfBottom:2,loadedRatio:0,pdfDialog:!1,canDownPDF:!1,downPDFCode:"",viewType:"page",clientHeight:1,rotate:0,nowScrollPage:1}},created(){this.pageNum=1,this.pageTotalNum=1,this.pdfWidth=50,this.pdfLeft=25,this.pdfTop=2,this.pdfBottom=2,this.loadedRatio=0,this.pdfDialog=!1,this.canDownPDF=!1,this.downPDFCode="",this.viewType="page",this.clientHeight=1,this.rotate=0,this.nowScrollPage=1,""!==this.mDocItemID&&this.browsePdf()},mounted(){window.addEventListener("scroll",this.setScrollPage,!0)},methods:{browsePdf(){this.getMainFileType().then(t=>{if(".pdf"!=t)throw new Error("检测到不是PDF文件格式！");this.openVuePdf()}).catch(t=>{this.loading=!1,this.$message.error("当前文件不是PDF格式，请下载后浏览！")})},async getMainFileType(){var t=(await this.$http.post("getMainFileType",{hDocItemID:this.mDocItemID,hToken:window.sessionStorage.getItem("token")}))["data"];if(200===t.status)return t.data;this.$message.error("获取主文件失败！")},async openVuePdf(){this.loading=!0;const t=new FormData;return t.append("mDocID",this.mDocItemID),await this.$http.post("DownloadMainFile",t,{responseType:"blob"}).then(t=>{if(0===t.data.size)return this.loading=!1,this.$message.error("服务器上文件已经不存在！");this.loading=!1,this.url=this.getObjectURL(t.data),this.browseDialogVisible=!0}).catch(t=>{this.browseDialogVisible=!1,this.loading=!1,this.$message.error(""+t)})},getObjectURL(t){let e=null;if(void 0!==window.createObjectURL)e=window.createObjectURL(t);else if(void 0!==window.webkitURL)try{e=window.webkitURL.createObjectURL(t)}catch(t){}else if(void 0!==window.URL)try{e=window.URL.createObjectURL(t)}catch(t){}return e},bePdfClose(){this.browseDialogVisible=!1},closePdf(){this.browseDialogVisible=!1,this.$emit("on-close")},setScrollPage(){var t=document.documentElement.scrollTop,e=document.documentElement.scrollHeight;this.nowScrollPage=Math.ceil(this.pageTotalNum*(t/e))},scrollView(){this.viewType="scroll",this.pageNum=this.pageTotalNum},pageView(){this.viewType="page",this.pageNum=1},downPDF(){"1234"==this.downPDFCode?(this.canDownPDF=!0,this.$notify({title:"提取码正确",message:"请点击按钮下载文件！",type:"success"})):this.$notify({title:"请重试",message:"提取码校验错误！",type:"error"})},zoomPDF(t){var e=this;"plus"===t&&(100===e.pdfWidth?e.$message({showClose:!0,message:"已放大至：100%",type:"info"}):(e.pdfWidth=e.pdfWidth+10,e.pdfLeft=(100-e.pdfWidth)/2)),"minus"===t&&(50===e.pdfWidth?e.$message({showClose:!0,message:"已缩小至标准尺寸，不可再缩小。",type:"info"}):(e.pdfWidth=e.pdfWidth-10,e.pdfLeft=(100-e.pdfWidth)/2))},rotatePDF(t){var e=this;"+90"===t&&(e.rotate+=90),"-90"===t&&(e.rotate-=90),e.rotate},prePage(){let t=this.pageNum;t=1<t?t-1:this.pageTotalNum,this.pageNum=t,window.scrollTo(0,0)},nextPage(){let t=this.pageNum;t=t<this.pageTotalNum?t+1:1,this.pageNum=t,window.scrollTo(0,0)}}},i("d0e1"),i=i("2877"),i=Object(i.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{ref:"parentPdf",attrs:{title:"",visible:t.browseDialogVisible,fullscreen:!0},on:{"update:visible":function(e){t.browseDialogVisible=e},close:t.bePdfClose}},[i("div",{staticClass:"vpdf-container"},[i("div",{staticClass:"pre_page page_bar pointer"},[t._e()]),t._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:"page"==t.viewType&&1<t.pageTotalNum,expression:"viewType == 'page' && pageTotalNum > 1 "}],staticClass:"num_bar"},[t._e(),i("el-select",{attrs:{placeholder:"请选择"},model:{value:t.pageNum,callback:function(e){t.pageNum=e},expression:"pageNum"}},t._l(t.pageTotalNum,(function(e){return i("el-option",{key:e,attrs:{label:"第"+e+"页，共"+t.pageTotalNum+"页",value:e}})})),1)],1),t._e(),i("div",{staticClass:"tools_bar"},[i("div",{staticClass:"mt10"},[i("el-button",{attrs:{type:"warning",plain:"",icon:"el-icon-close",circle:""},on:{click:t.closePdf}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:"scroll"==t.viewType&&1<t.pageTotalNum,expression:"viewType == 'scroll'  && pageTotalNum > 1  "}]},[i("el-button",{attrs:{plain:"",icon:"el-icon-document-copy",circle:""},on:{click:function(e){return t.pageView()}}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:"page"==t.viewType&&1<t.pageTotalNum,expression:"viewType == 'page'  && pageTotalNum > 1 "}]},[i("el-button",{attrs:{plain:"",icon:"el-icon-tickets",circle:""},on:{click:function(e){return t.scrollView()}}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:"page"==t.viewType&&1<t.pageTotalNum,expression:"viewType == 'page' && pageTotalNum > 1 "}],staticClass:"mt30"},[i("el-button",{attrs:{plain:"",icon:"el-icon-arrow-left",circle:""},on:{click:t.prePage}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:"page"==t.viewType&&1<t.pageTotalNum,expression:"viewType == 'page' && pageTotalNum > 1 "}],staticClass:"mt10"},[i("el-button",{attrs:{plain:"",icon:"el-icon-arrow-right",circle:""},on:{click:t.nextPage}})],1),i("div",{staticClass:"mt30"},[i("el-button",{attrs:{plain:"",icon:"el-icon-plus",circle:""},on:{click:function(e){return t.zoomPDF("plus")}}})],1),i("div",{staticClass:"mt10"},[i("el-button",{attrs:{plain:"",icon:"el-icon-minus",circle:""},on:{click:function(e){return t.zoomPDF("minus")}}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:"page"==t.viewType,expression:"viewType == 'page'"}],staticClass:"mt30"},[i("el-button",{attrs:{plain:"",icon:"el-icon-refresh-right",circle:""},on:{click:function(e){return t.rotatePDF("+90")}}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:"page"==t.viewType,expression:"viewType == 'page'"}],staticClass:"mt10"},[i("el-button",{attrs:{plain:"",icon:"el-icon-refresh-left",circle:""},on:{click:function(e){return t.rotatePDF("-90")}}})],1),t._e()]),i("el-dialog",{attrs:{title:"下载 PDF 文件",visible:t.pdfDialog,width:"30%"},on:{"update:visible":function(e){t.pdfDialog=e}}},[i("el-row",{directives:[{name:"show",rawName:"v-show",value:0==t.canDownPDF,expression:"canDownPDF == false"}],attrs:{gutter:20}},[i("el-col",{staticClass:"tagr mt10",attrs:{span:12,offset:6}},[i("el-input",{attrs:{placeholder:"请输入提取码"},model:{value:t.downPDFCode,callback:function(e){t.downPDFCode=e},expression:"downPDFCode"}},[i("el-button",{attrs:{slot:"append"},on:{click:function(e){return t.downPDF()}},slot:"append"},[t._v("提取文件")])],1)],1)],1),1==t.canDownPDF?i("div",{staticClass:"tagc"},[i("a",{attrs:{href:t.url,download:"文件"}},[i("el-button",{attrs:{type:"primary",plain:""}},[t._v("点击下载")])],1)]):t._e(),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.pdfDialog=!1}}},[t._v("取 消")])],1)],1),i("div",{staticStyle:{transition:"all .3s"},style:{width:t.pdfWidth+"%",marginLeft:t.pdfLeft+"%",marginTop:t.pdfTop+"%",marginBottom:t.pdfBottom+"%"}},["page"==t.viewType?i("pdf",{attrs:{page:t.pageNum,src:t.url,rotate:t.rotate},on:{progress:function(e){t.loadedRatio=e},"num-pages":function(e){t.pageTotalNum=e}}}):t._e(),"scroll"==t.viewType?i("div",t._l(t.pageNum,(function(e){return i("pdf",{key:e,ref:"pdf",refInFor:!0,attrs:{src:t.url,page:e}})})),1):t._e()],1)],1)])}),[],!1,null,"7359ff01",null);e.default=i.exports},"22ed":function(t,e,i){"use strict";i("bd33")},"23ee":function(t,e,i){"use strict";i("8629")},8629:function(t,e,i){},a2fa:function(t,e,i){},b4f4:function(t,e,i){"use strict";i.r(e);var a={name:"EditDrawer",props:["mDocItemID","mCatID"],data(){return{fItemID:"",fCatID:"",mtemp:[""],checkedData:{},vdx:[""],vdd:[[]],DataName:"Item Detail",addDocForm:{},editDocForm:{},docList:[],fileItemlist:[],templist:[],tableHeight:screen.height-110-182,mainHeight:screen.height-110-70,tableBfieldlist:[],tableAfieldlist:[],linkAfieldlist:[],ItemName:"",ItemCode:"",ItemCatID:"",editDataFormRules:{},editDialogVisible:!1}},created(){for(let t=0;t<this.tableAfieldlist.length;t++)this.addDocForm[this.tableAfieldlist[t].t_FieldName]="";for(let t=0;t<this.tableBfieldlist.length;t++)this.editDocForm[this.tableBfieldlist[t].t_FieldName]="";this.showEditDialog()},methods:{focus(t){},keyup_({e:t,i:e}){const i=this;i.$refs["input"+e]&&i.$nextTick(()=>{t.target.blur();var a="input"+(e+1);void 0!==i.$refs[a]?i.$refs[a][0].focus():i.$refs.addSubmit&&i.$refs.addSubmit.$el.focus()})},keyup_edit({e:t,i:e}){const i=this;i.$refs["m_input"+e]&&i.$nextTick(()=>{t.target.blur();var a="m_input"+(e+1);void 0!==i.$refs[a]?i.$refs[a][0].focus():i.$refs.editSubmit&&i.$refs.editSubmit.$el.focus()})},handleRadioChange:function(t,e,i){},handleChange:function(t,e,i){t?this.checkedData[i].push(e):this.delete(e,i)},delete(t,e){var i=this.checkedData[e].findIndex(e=>{if(e===t)return!0});this.checkedData[e].splice(i,1)},SetFirstAddFocus(){this.$nextTick(t=>{null!=this.$refs.input0&&this.$refs.input0[0].focus()})},SetFirstEditFocus(){this.$nextTick(t=>{this.$refs.m_input0[0].focus()})},editDialogClosed(){this.$emit("on-close");for(let t=0;t<this.tableBfieldlist.length;t++)this.editDocForm[this.tableBfieldlist[t].t_FieldName]=""},transArrToString(t){if(!Array.isArray(t))return!1;for(var e="",i=0,a=t.length;i<a;i++)0===i?e=t[i]:e+=","+t[i];return e},transStrToArr(t){return t.split(",")},async editDocItem(){for(let i=0;i<this.tableBfieldlist.length;i++){var t;4===this.tableBfieldlist[i].t_ControlType&&(t="",t=this.transArrToString(this.checkedData[this.tableBfieldlist[i].t_FieldName]),this.editDocForm[this.tableBfieldlist[i].t_FieldName]=t),30===this.tableBfieldlist[i].t_ControlType&&(this.editDocForm[this.tableBfieldlist[i].t_FieldName]=this.vdx[i])}var e=(await this.$http.post("editDocBusiness",{hItemID:this.mDocItemID,form:JSON.stringify(this.editDocForm),hToken:window.sessionStorage.getItem("token")}))["data"];200!==e.status&&this.$message.error("修改数据失败！"),this.$message.success("修改数据成功！"),this.editDialogVisible=!1},async showEditDialog(){var t,e,i=(await this.$http.post("getData",{hItemID:this.mDocItemID,hCatID:this.mCatID,hToken:window.sessionStorage.getItem("token")}))["data"];0===i.total?this.templist="":this.templist=JSON.parse(i.data),this.tableBfieldlist=JSON.parse(i.tableBfield),this.editDocForm=this.templist[0];for(let a=0;a<this.tableBfieldlist.length;a++)4===this.tableBfieldlist[a].t_ControlType?(t=this.editDocForm[this.tableBfieldlist[a].t_FieldName],this.vdd[a]=null===t?[]:this.transStrToArr(t),this.checkedData[this.tableBfieldlist[a].t_FieldName]=this.vdd[a]):30===this.tableBfieldlist[a].t_ControlType?(e=this.editDocForm[this.tableBfieldlist[a].t_FieldName],2===this.tableBfieldlist[a].t_DataType?this.vdx[a]=null===e?0:e.toString():1===this.tableBfieldlist[a].t_DataType&&(t=this.editDocForm[this.tableBfieldlist[a].t_FieldName],this.vdx[a]=t,this.checkedData[this.tableBfieldlist[a].t_FieldName]=t)):(this.checkedData[this.tableBfieldlist[a].t_FieldName]=[],this.vdd[a]=[0]);this.editDialogVisible=!0}}};i("23ee"),i=i("2877"),i=Object(i.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-drawer",{attrs:{title:"修改文档信息",visible:t.editDialogVisible,width:"60%"},on:{"update:visible":function(e){t.editDialogVisible=e},close:t.editDialogClosed}},[i("el-form",{ref:"editDataFormRef",attrs:{model:t.editDocForm,rules:t.editDataFormRules,"label-width":"100px","label-position":"right"},nativeOn:{submit:function(t){t.preventDefault()}}},t._l(t.tableBfieldlist,(function(e,a){return i("el-col",{key:e.t_FieldID,attrs:{span:24}},[i("el-form-item",{attrs:{label:e.t_Name}},[3===e.t_ControlType?i("div",[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"下拉框，请选择"},model:{value:t.editDocForm[e.t_FieldName],callback:function(i){t.$set(t.editDocForm,e.t_FieldName,i)},expression:"editDocForm[Bfield.t_FieldName]"}},t._l(e.PropValue,(function(t){return i("el-option",{key:t.t_No,attrs:{label:t.t_Display,value:t.t_Value}})})),1)],1):1===e.t_ControlType?i("div",[1===e.t_DataType?i("div",[i("el-input",{ref:"m_input"+a,refInFor:!0,attrs:{placeholder:"请输入字符串-- abc"},on:{focus:function(e){return t.focus(e)}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.keyup_edit({e:e,i:a})}},model:{value:t.editDocForm[e.t_FieldName],callback:function(i){t.$set(t.editDocForm,e.t_FieldName,i)},expression:"editDocForm[Bfield.t_FieldName]"}})],1):2===e.t_DataType?i("div",[i("el-input",{ref:"m_input"+a,refInFor:!0,attrs:{placeholder:"请输入整数-- 123"},on:{focus:function(e){return t.focus(e)}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.keyup_edit({e:e,i:a})}},model:{value:t.editDocForm[e.t_FieldName],callback:function(i){t.$set(t.editDocForm,e.t_FieldName,i)},expression:"editDocForm[Bfield.t_FieldName]"}})],1):3===e.t_DataType?i("div",[i("el-input",{ref:"m_input"+a,refInFor:!0,attrs:{placeholder:"请输入数值-- 00.10"},on:{focus:function(e){return t.focus(e)}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.keyup_edit({e:e,i:a})}},model:{value:t.editDocForm[e.t_FieldName],callback:function(i){t.$set(t.editDocForm,e.t_FieldName,i)},expression:"editDocForm[Bfield.t_FieldName]"}})],1):t._e()]):2===e.t_ControlType?i("div",[i("el-input",{attrs:{type:"textarea",rows:3,placeholder:"多行编辑框，请输入字符串 -- abcabc123"},model:{value:t.editDocForm[e.t_FieldName],callback:function(i){t.$set(t.editDocForm,e.t_FieldName,i)},expression:"editDocForm[Bfield.t_FieldName]"}})],1):4===e.t_ControlType?i("div",[i("el-checkbox-group",{model:{value:t.vdd[a],callback:function(e){t.$set(t.vdd,a,e)},expression:"vdd[i]"}},t._l(e.PropValue,(function(a){return i("el-checkbox",{key:a.t_No,attrs:{label:a.t_Display},on:{change:function(i){return t.handleChange(i,a.t_Display,e.t_FieldName)}}},[t._v(t._s(a.t_Display)+" ")])})),1)],1):30===e.t_ControlType?i("div",[i("el-radio-group",{model:{value:t.vdx[a],callback:function(e){t.$set(t.vdx,a,e)},expression:"vdx[i]"}},t._l(e.PropValue,(function(e){return i("el-radio",{key:e.t_No,attrs:{label:e.t_Display},on:{change:function(i){return t.handleRadioChange(i,e.t_Display,a)}}},[t._v(t._s(e.t_Display)+" ")])})),1)],1):110===e.t_ControlType?i("div",[i("el-checkbox",{attrs:{placeholder:"选择日期"},model:{value:t.editDocForm[e.t_FieldName],callback:function(i){t.$set(t.editDocForm,e.t_FieldName,i)},expression:"editDocForm[Bfield.t_FieldName]"}},[t._v(" "+t._s(e.t_Name)+" ")])],1):12===e.t_ControlType?i("div",[i("el-date-picker",{attrs:{type:"date",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:t.editDocForm[e.t_FieldName],callback:function(i){t.$set(t.editDocForm,e.t_FieldName,i)},expression:"editDocForm[Bfield.t_FieldName]"}})],1):i("div",[i("el-input",{ref:"linkName",refInFor:!0,attrs:{placeholder:"其她情况，引用等等"},model:{value:t.editDocForm[e.t_FieldName],callback:function(i){t.$set(t.editDocForm,e.t_FieldName,i)},expression:"editDocForm[Bfield.t_FieldName]"}})],1)])],1)})),1),i("span",{staticClass:"demo-drawer__footer"},[i("el-button",{ref:"editSubmit",attrs:{type:"primary"},on:{click:t.editDocItem}},[t._v("确 定")]),i("el-button",{on:{click:function(e){t.editDialogVisible=!1}}},[t._v("取 消")])],1)],1)}),[],!1,null,"2a592dbd",null);e.default=i.exports},bd33:function(t,e,i){},d0e1:function(t,e,i){"use strict";i("a2fa")},f6a8:function(t,e,i){"use strict";i.r(e);var a=i("0a14"),s=i("0667"),o=i("b4f4");a={components:{"v-DocItemDetail":a.default,"v-PdfFullScreen":s.default,"v-EditDrawer":o.default},data(){return{loading:!1,vPdfKey:100,vDrawerKey:1e3,editItemID:"",ItemCatID:"",ItemName:"",activeName:"tab-1",componentKey:1,browseDialogVisible:!1,addFileFlag:!1,delFlag:!0,fileList:[],mUrl:"",mDocObj:{DocID:"",hToken:window.sessionStorage.getItem("token")},loadProgress:0,progressFlag:!1,addDocForm:{},editDocForm:{},docList:[],fileItemlist:[],templist:[],linkExpressionList:[],linkItemList:[],tableBfieldlist:[],tableAfieldlist:[],linkAfieldlist:[],reviewItemList:[],reviewFieldList:[],versionItemList:[],queryInfo:{query:"",pageNum:"1",pageSize:"20",folderID:"0"},catType:"",dirType:0,isCatDir:0,mRootID:"",mCatID:"",mSqlPath:"",ACLList:[],tableHeight:this.$root.gScreenHeight-110-182,mainHeight:this.$root.gScreenHeight-70,slbHeight:this.$root.gScreenHeight-90,folderList:[],itemList:[],treeProps:{value:"t_ID",label:"label",t_Type:-1,children:"Children",isLeaf:!0,checkStrictly:!0,expandTrigger:"hover"},selectedKeys:[],idArray:[],total:0,pageFlag:!1}},created(){this.$root.leveOnePathName="目录",this.$root.leveTwoPathName="文件夹",this.tableHeight=JSON.parse(window.localStorage.getItem("gHeight"))-285,this.slbHeight=JSON.parse(window.localStorage.getItem("gHeight"))-195,this.mainHeight=JSON.parse(window.localStorage.getItem("gHeight"))-185,this.mainWidth=this.$root.gScreenWidth-210,this.mUrl=this.$root.gBaseURL+"/UploadFileDoc",null!==window.localStorage.getItem("currentFolderID")&&(this.queryInfo.folderID=window.localStorage.getItem("currentFolderID"),this.idArray=[this.queryInfo.folderID])},methods:{async downloadMainFile(){if("confirm"!==await this.$confirm("确信要下载该文件吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(t=>t))return this.$message.info("已取消下载");const t=new FormData;t.append("mDocID",this.editItemID),this.loading=!0,await this.$http.post("DownloadMainFile",t,{responseType:"arraybuffer"}).then(t=>{if(0===t.data.size)return this.loading=!1,this.$message.error("文件已经不存在，下载失败！");var e=t.headers["content-disposition"].split(";")[1].split("FileName=")[1];e=decodeURIComponent(e);this.saveMainFile(t.data,e),this.loading=!1}).catch(t=>{this.loading=!1,this.$message.error("文件可能不存在，或者网络处于断开状态！")})},saveMainFile(t,e){if(t){t=window.URL.createObjectURL(new Blob([t]));const i=document.createElement("a");i.style.display="none",i.href=t,i.setAttribute("download",e),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(t)}},async deleteDocItem(t,e){var i;return this.queryInfo.query="","confirm"!==await this.$confirm("此操作将永久删除该文档, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(t=>t)?this.$message.info("已取消删除"):(i=(await this.$http.post("deleteDocBusiness",{hItemID:this.editItemID,hCatID:this.ItemCatID,hToken:window.sessionStorage.getItem("token")}))["data"],200!==i.status?this.$message.error("删除文档失败 -- "+i.Msg):(this.getMapItem(),void this.$message.success("删除文档成功！")))},async showDatatDetailDialog(t,e,i,a){this.addFileFlag=!1,this.componentKey=this.componentKey+1},async showBrowseDialog(){this.vPdfKey=this.vPdfKey+1},async showEditDialog(){this.vDrawerKey=this.vDrawerKey+1},async publishItem(){var t;return"confirm"!==await this.$confirm("确定要发布、存档该文件吗?存档后，创建人修改文件需要获得授权。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(t=>t)?this.$message.info("已取消发布"):(t=(await this.$http.post("publishItem",{hCatID:this.ItemCatID,hItemID:this.editItemID,hItemName:this.ItemName,hToken:window.sessionStorage.getItem("token")}))["data"],200!==t.status?this.$message.error("发布失败--"+t.Msg):(this.getDocList(),void this.$message.error("数据发布成功！")))},getDocItem(t){this.itemList.forEach(e=>{e.t_ID===t&&(e.t_ControlType,this.editDocForm=e,this.editDocForm.t_CreateTime=this.showDate(this.editDocForm.t_CreateTime),this.editDocForm.t_CheckOutTime=this.showDate(this.editDocForm.t_CheckOutTime),this.editDocForm.t_ReleaseTime=this.showDate(this.editDocForm.t_ReleaseTime),this.editDocForm.t_LastModTime=this.showDate(this.editDocForm.t_LastModTime))})},async getDocFile(){var t=(await this.$http.post("getDocFile",{hDocItemID:this.editItemID,hCatID:this.queryInfo.catID,hToken:window.sessionStorage.getItem("token")}))["data"];if(202===t.status)return this.$message.error("请重新登录！");200===t.status&&(0!==t.total?this.fileItemlist=JSON.parse(t.data):this.fileItemlist=[],this.total=t.total,this.$nextTick(()=>{this.$refs.tableRef.setCurrentRow(this.fileItemlist[0])}))},async getlinkExpressionList(){var t=(await this.$http.post("getlinkExpressionList",{hCatID:this.queryInfo.catID}))["data"];if(200!==t.status)return this.$message.error("获取父级分类数据失败！");this.linkExpressionList=t.data_MetaLink,this.tableAfieldlist=JSON.parse(t.tableAfield),this.tableBfieldlist=JSON.parse(t.tableBfield)},async getReviewList(t){if(t=(await this.$http.post("getReviewList",{hItemID:t})).data,200!==t.status)return this.$message.error("评审过程数据失败！");0!==t.total?this.reviewItemList=JSON.parse(t.data):this.reviewItemList=[],this.reviewFieldList=JSON.parse(t.tableBfield)},HandCloseDetail(){this.$nextTick(()=>{this.$refs.tableRef.setCurrentRow(this.mCurrentRow)})},uploadProcess(t,e,i){this.progressFlag=!0,this.loadProgress=parseInt(t.percent),100<=this.loadProgress&&(this.loadProgress=100,setTimeout(()=>{this.progressFlag=!1,this.addDialogVisible=!1},1e3))},handleSuccess(t){this.$message.success("上传 文件 成功！"),this.getDocFile(),this.$refs.upload.clearFiles(),this.$nextTick((function(){this.addFileFlag=!1}))},handleFileChange(t,e){if(1<e.length&&"fail"!==t.status?e.splice(0,1):"fail"===t.status&&(this.$message.warning("上传失败，请重新上传！"),e.splice(0,1)),50<t.size/1048576)return this.$message.warning("当前限制文件大小不能大于50M"),!1;var i=t.name.replace(/(.*\/)*([^.]+).*/gi,"$2");t=t.name.split(".").pop();this.fileList=e.slice(-3),this.addFileFlag=!0,this.mDocObj.DocID=this.editItemID,this.addDocForm.t_Name=i,this.addDocForm.t_Extension=t},handLinkRowClick(t,e,i){this.linkItemList=[],this.getlinkItemList(t.SourceCatID,t.TargetCatID,this.editItemID,t.ExpressionID)},async getlinkItemList(t,e,i,a){if(t=(await this.$http.post("getLinkItemList",{hSourceCatID:t,hTargetCatID:e,hItemID:i,hExpressionID:a,hToken:window.sessionStorage.getItem("token"),argItemIDs:null})).data,200!==t.status)return this.$message.error("获取关联表达式对应的 LinkItem 数据失败！");0!==t.total?this.linkItemList=JSON.parse(t.data):this.linkItemList=[],this.linkAfieldlist=JSON.parse(t.tableAfield)},async submitFile(){if("confirm"!==await this.$confirm("确信要替换文件，并以新文件为正式版本吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(t=>t))return this.$message.info("已取消替换");this.mDocObj.DocID=this.editItemID,this.$refs.upload.submit(),this.$nextTick((function(){this.addFileFlag=!1}))},showDate(t){return new Date(t).toLocaleString()},async getDataACL(t,e){if(t=(await this.$http.post("CheckDataACL",{hCatID:t,hItemID:e,hToken:window.sessionStorage.getItem("token")})).data,200!==t.status)return this.$message.error("获取对象的数据权限失败！");0!==t.total?this.ACLList=JSON.parse(t.data):this.ACLList=[]},handleClick(t,e){this.getMapItem(),"tab-whereused"===t.paneName?this.getWhereUsedItemList(this.queryInfo.catID,this.editItemID):"second"===t.paneName?alert(2):"third"===t.paneName&&alert(3),this.addFileFlag=!1},loadNode(t,e){if("学校专用"!==this.$root.gAppVersion){if(0===t.level)return e([{id:this.currentGroupID="Root_FolderID",label:"目录根节点",t_IsActive:1}])}else if(0===t.level)return e([{id:this.currentGroupID="File_FolderID",label:"文件导航",t_IsActive:1}]);1<=t.level&&(2===t.data.t_Type&&(t.data.SqlPath="",t.data.t_Level=0,t.data.RootID=t.data.t_ID),2===t.data.t_Type||1===t.data.t_Type?this.getMapNode(t,e):(this.currentGroupID=t.data.id,this.getDirList(t.data.id,e)))},async getDirList(t,e){if(t=(await this.$http.post("getDirList",{hDirID:t,hFolderFlag:1})).data,200!==t.status)return this.$message.error("获取子组织节点失败！");var i=JSON.parse(t.data);return this.groupList=JSON.parse(t.data),i.forEach(t=>{t.id=t.t_ID,t.label=t.t_Name,t.leaf=t.Children}),e(i)},async getMapNode(t,e){if(t=(await this.$http.post("getMapNode",{hID:t.data.t_ID,hRootID:t.data.RootID,hSqlPath:t.data.SqlPath,hLevel:t.data.t_Level})).data,202===t.status)return e([]);if(201===t.status)return this.$message.error("获取子组织节点失败！");var i=JSON.parse(t.data);return this.groupList=JSON.parse(t.data),i.forEach(t=>{t.id=t.t_ID,t.label=t.label,t.t_Level=t.t_level,t.RootID=t.RootID,t.t_Type=1,t.isLeaf=t.leaf}),e(i)},async getFolderTree(){var t=(await this.$http.post("getFolderTree",{hFolderID:"Root_FolderID"}))["data"];if(200!==t.status)return this.$message.error("获取目录树数据失败！");this.folderList=t.data1},async getFolderItem(){var t=(await this.$http.post("getFolderItem",{query:this.queryInfo.query,pageNum:this.queryInfo.pageNum,pageSize:this.queryInfo.pageSize,hFolderID:this.queryInfo.folderID,hCatType:this.catType,hIsCatDir:this.isCatDir,hToken:window.sessionStorage.getItem("token"),hVersion:this.mVersion}))["data"];if(202===t.status)return this.itemList=[],this.$message.error("最后一级，没有子节点！");if(201===t.status)this.itemList=[];else{if(200!==t.status)return this.itemList=[],this.$message.error("返回条数为 0！"+t.Msg);0!==t.total?(this.itemList=JSON.parse(t.data),this.editItemID=this.itemList[0].t_ID,this.ItemName=this.itemList[0].t_Name,this.ItemCode=this.itemList[0].t_Code,this.ItemCatID=this.queryInfo.folderID):this.itemList=[],this.tableBfieldlist=JSON.parse(t.tableBfield),this.total=t.total,this.pageFlag=this.total>this.queryInfo.pageSize,!0===this.pageFlag?this.tableHeight=JSON.parse(window.localStorage.getItem("gHeight"))-285:this.tableHeight=JSON.parse(window.localStorage.getItem("gHeight"))-240,this.$nextTick(()=>{this.$refs.tableRef.setCurrentRow(this.itemList[0])})}},async getMapItem(){var t=(await this.$http.post("getMapItem",{query:this.queryInfo.query,pageNum:this.queryInfo.pageNum,pageSize:this.queryInfo.pageSize,hDirID:this.queryInfo.folderID,hRootID:this.mRootID,hCatID:this.mCatID,hSqlPath:this.mSqlPath,hToken:window.sessionStorage.getItem("token"),hVersion:this.mVersion}))["data"];return 202===t.status?(this.itemList=[],this.$message.error("返回数据为0！")):200!==t.status?(this.itemList=[],this.$message.error("获取数据失败！"+t.Msg)):(0!==t.total?(this.itemList=JSON.parse(t.data),this.editItemID=this.itemList[0].t_ID,this.ItemName=this.itemList[0].t_Name,this.ItemCode=this.itemList[0].t_Code,this.ItemCatID=this.queryInfo.folderID):this.itemList=[],this.tableBfieldlist=JSON.parse(t.tableBfield),this.total=t.total,this.pageFlag=this.total>this.queryInfo.pageSize,!0===this.pageFlag?this.tableHeight=JSON.parse(window.localStorage.getItem("gHeight"))-285:this.tableHeight=JSON.parse(window.localStorage.getItem("gHeight"))-240,void this.$nextTick(()=>{this.$refs.tableRef.setCurrentRow(this.itemList[0])}))},handleSizeChange(t){this.queryInfo.pageSize=t,this.getFolderItem()},handleCurrentChange(t){this.queryInfo.pageNum=t,this.getMapItem()},handItemRowClick(t,e,i){this.editItemID=t.t_ID,this.ItemCatID=t.t_CatID,this.getDataACL(t.t_CatID,t.t_ID)},handleNodeClick(t){this.ACLList=[],this.queryInfo.folderID=t.t_ID,this.idArray=[t.t_ID],this.catType=t.CObjDataType,this.isCatDir=t.t_IsCat,this.mRootID=t.RootID,this.mCatID=t.TypeID,this.mSqlPath=t.SqlPath,this.dirType=t.t_Type,window.localStorage.setItem("currentFolderID",t.t_ID),0===t.t_Type&&(this.itemList=[]),1===t.t_Type&&this.getMapItem()}}},i("22ed"),s=i("2877"),o=Object(s.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"mainZone",staticClass:"datalist-container",style:{height:t.mainHeight+"px"}},[i("el-row",{attrs:{gutter:5}},[i("el-col",{attrs:{span:4}},[i("el-card",{attrs:{"body-style":{padding:"5px"}}},[i("el-scrollbar",{style:{height:t.slbHeight+"px"}},[i("el-tree",{ref:"treeList",attrs:{"default-expanded-keys":t.idArray,"current-node-key":this.queryInfo.folderID,"highlight-current":"",props:t.treeProps,load:t.loadNode,lazy:"","node-key":"id"},on:{"node-click":t.handleNodeClick}})],1)],1)],1),i("el-col",{attrs:{span:20}},[i("el-card",{attrs:{"body-style":{padding:"5px"}}},[i("el-row",{attrs:{gutter:5}},[i("el-col",{attrs:{span:6}},[t._e()],1),i("el-col",{attrs:{span:18}},[i("el-button-group",{staticStyle:{float:"right"}},[i("el-button",{attrs:{icon:"el-icon-edit",type:"primary",disabled:this.ACLList.indexOf(1)<0},on:{click:t.showBrowseDialog}},[t._v("浏览")]),i("el-button",{attrs:{icon:"el-icon-view",type:"primary",disabled:this.ACLList.indexOf(1)<0},on:{click:t.showDatatDetailDialog}},[t._v("详情")]),i("el-button",{attrs:{icon:"el-icon-download",type:"primary",disabled:this.ACLList.indexOf(4)<0},on:{click:t.downloadMainFile}},[t._v("下载")]),i("el-button",{attrs:{icon:"el-icon-delete",type:"primary",disabled:this.ACLList.indexOf(3)<0},on:{click:t.deleteDocItem}},[t._v("删除")]),i("el-button",{attrs:{icon:"el-icon-edit",type:"primary",disabled:this.ACLList.indexOf(2)<0},on:{click:t.showEditDialog}},[t._v("编辑")]),t._e(),t._e(),t._e(),t._e()],1)],1)],1),i("el-table",{directives:[{name:"show",rawName:"v-show",value:0<t.itemList.length,expression:"itemList.length > 0 ? true: false"}],ref:"tableRef",attrs:{data:t.itemList,height:t.tableHeight,border:"","highlight-current-row":"","row-style":{height:"30px"},"cell-style":{padding:"0px"}},on:{"row-click":t.handItemRowClick}},[i("el-table-column",{attrs:{type:"index"}}),i("el-table-column",{attrs:{prop:"t_Name",label:"名称","show-overflow-tooltip":!0}}),i("el-table-column",{attrs:{prop:"t_Code",label:"编号",width:"120px","show-overflow-tooltip":!0}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"v_CatName",label:"类别",width:"120px"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"v_CreateByName",label:"创建人",width:"100px"}}),i("el-table-column",{attrs:{prop:"t_CreateTime",label:"创建时间",width:"75px"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(e.row.t_LastModTime.substring(0,7)))])]}}])}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"v_ModByName",label:"修改人",width:"100px"}}),i("el-table-column",{attrs:{prop:"t_LastModTime",label:"最后修改时间",width:"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(e.row.t_LastModTime.substring(2,16).replace("T"," ")))])]}}])}),t._e()],1),i("el-pagination",{directives:[{name:"show",rawName:"v-show",value:t.pageFlag,expression:"pageFlag"}],attrs:{"current-page":t.queryInfo.pagenum,"page-sizes":[20,50,100,200],"page-size":t.queryInfo.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),i("v-DocItemDetail",{key:t.componentKey,attrs:{mDocItemID:t.editItemID}}),i("v-PdfFullScreen",{key:t.vPdfKey,attrs:{mDocItemID:t.editItemID}}),i("v-EditDrawer",{key:t.vDrawerKey,attrs:{mDocItemID:t.editItemID,mCatID:t.ItemCatID}})],1)],1)],1)}),[],!1,null,"a9757bca",null);e.default=o.exports}}]);