(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-810ce810"],{"5dca":function(e,t,l){"use strict";l("6f03")},"6f03":function(e,t,l){},8351:function(e,t,l){"use strict";l.r(t);var i={data(){return{optionString:[{value:"%like%",label:"包含"},{value:"like%",label:"开始为"},{value:"%like",label:"结尾为"}],options:[],optionData:[{value:"=",label:"等于"},{value:">",label:"大于"},{value:"<",label:"小于"},{value:"<=",label:"小于等于"},{value:">=",label:"大于等于"},{value:"<>",label:"不等于"}],optionSelect:[{value:"=",label:"等于"}],vOperation:"",hValue:"",mFlagCat:!1,mFlagDef:!1,vLength:0,vFieldID:"",vFieldName:"",vName:"",vFieldModel:[],vRuleID:"",vFlowName:"",vRuleName:"",vExpression:"",fieldlist:[],flowlist:[],ruleDefineList:[],ruleContentList:[],currentRuleID:"",mainHeight:window.innerHeight-400,tableHeight:window.innerHeight-275,rule:{hNo:"",hFieldID:"",hOperation:"",hValue:""},flowRuleList:[],editDialogVisible:!1,addDialogVisible:!1,parentCateList:[],cascaderProps:{value:"t_ID",label:"label",children:"Children",checkStrictly:!0,expandTrigger:"hover"},selectedKeys:[],catName:"",cat_pid:"",cat_level:0,config:{id:"t_ID",pid:"ParentID",children:"children"}}},created(){this.$root.leveOnePathName="系统管理",this.$root.leveTwoPathName="自动加入流程的规则定义",this.tableHeight=JSON.parse(window.localStorage.getItem("gHeight"))-240,this.slbHeight=JSON.parse(window.localStorage.getItem("gHeight"))-195,this.mainHeight=JSON.parse(window.localStorage.getItem("gHeight"))-185,this.getFlowRuleList(),this.getMyFlowList()},watch:{selectedKeys(){this.$refs.LinkBref&&(this.$refs.LinkBref.dropDownVisible=!1)}},methods:{async getMyFlowList(){var e=(await this.$http.post("getMyFlowList",{hToken:window.sessionStorage.getItem("token")}))["data"];200!==e.status&&this.$message.error("获取流程失败！"),this.$message.success("获取流程成功！"),0===e.total?this.flowlist="":this.flowlist=JSON.parse(e.data)},async getParentCateList(){var e=(await this.$http.post("getCatTree"))["data"];if(200!==e.status)return this.$message.error("获取父级分类数据失败！");this.parentCateList=e.data1},parentCateChanged(e){this.vOperation="",this.hValue="",this.vName="",this.vFieldID="",this.vExpression="",this.vLength=0,this.ruleDefineList=[],this.mFlagCat=!1,this.mFlagDef=!1,0<this.selectedKeys.length?(this.cat_pid=this.selectedKeys[this.selectedKeys.length-1],this.cat_level=this.selectedKeys.length,this.catName=this.$refs.LinkBref.getCheckedNodes()[0].pathLabels[this.selectedKeys.length-1],this.mFlagCat=!0,this.getFieldList(this.cat_pid)):(this.cat_pid="",this.catName="",this.cat_level=0,this.fieldlist="",this.vFieldID="")},async getFieldList(e){e=(await this.$http.post("getCatTableABField",{hCatID:e})).data,200!==e.status&&this.$message.error("获取指定类的字段失败！"),this.fieldlist=JSON.parse(e.tableBfield)},fieldChanged(){for(var e=this.fieldlist.length,t=0;t<e;t++)if(this.fieldlist[t].t_FieldID===this.vFieldID){this.vFieldModel=this.fieldlist[t],this.vName=this.fieldlist[t].t_Name,this.vFieldName=this.fieldlist[t].t_FieldName,this.vOperation="",this.hValue="",3===this.vFieldModel.t_ControlType?this.options=this.optionSelect:1===this.vFieldModel.t_DataType?this.options=this.optionString:this.options=this.optionData;break}this.mFlagCat=!0},operationChanged(){},async openaddRuleDialog(){this.getParentCateList(),this.selectedKeys=[],this.mFlagCat=!1,this.mFlagDef=!1,this.vLength=0,this.vOperation="",this.hValue="",this.vFieldID="",this.vName="",this.vExpression="",this.ruleDefineList=[],this.catName="",this.cat_pid="",this.vFlowName="",this.addDialogVisible=!0},addRuleList(e,t,l,i){if(""===e||""===l||""===t||""===i)return this.$message.error("请输入完整参数，再增加！");this.mFlagDef=!0;var a=this.ruleDefineList.length+1;if(this.ruleDefineList.push({hKey:a,hFieldID:e,hName:t,hOperation:l,hValue:i}),this.vLength=this.ruleDefineList.length,this.vExpression="1",1<this.vLength)for(var s=2;s<this.vLength+1;s++)this.vExpression=this.vExpression+"  AND  "+s},removeAddRule(e){var t=this.ruleDefineList.filter(t=>t.hKey!==e.hKey);if(this.ruleDefineList=t,this.vLength=this.ruleDefineList.length,this.vExpression="1",(this.ruleDefineList[0].hKey=1)<this.vLength)for(var l=2;l<this.vLength+1;l++)this.vExpression=this.vExpression+"  AND  "+l,this.ruleDefineList[l-1].hKey=l},addEditRuleList(e,t,l,i,a){if(""===e||""===t||""===i||""===l||""===a)return this.$message.error("请输入完整参数，再增加！");this.mFlagDef=!0;var s=this.ruleContentList.length+1;if(this.ruleContentList.push({t_No:s,t_FieldID:e,t_FieldName:t,t_Name:l,t_Operator:i,t_Value:a}),this.vLength=this.ruleContentList.length,this.vExpression="1",1<this.vLength)for(var o=2;o<this.vLength+1;o++)this.vExpression=this.vExpression+"  AND  "+o},removeEditRule(e){var t=this.ruleContentList.filter(t=>t.t_No!==e.t_No);if(this.ruleContentList=t,this.vLength=this.ruleContentList.length,this.vExpression="1",(this.ruleContentList[0].t_No=1)<this.vLength)for(var l=2;l<this.vLength+1;l++)this.vExpression=this.vExpression+"  AND  "+l,this.ruleContentList[l-1].t_No=l},async submitRule(){if(""===this.vFlowName||""===this.vName||""===this.vFieldID||""===this.vOperation||0===this.vLength)return this.$message.error("参数输入不全,不能保存！");var e=(await this.$http.post("AddRulePushToFlow",{hExpression:this.vExpression,hRuleList:JSON.stringify(this.ruleDefineList),hCatName:this.catName,hCatID:this.cat_pid,hFlowName:this.vFlowName,hRuleNum:this.flowRuleList.length+1,hToken:window.sessionStorage.getItem("token")}))["data"];200!==e.status?this.$message.error("新增自动加入流程的规则失败！-- 020"+e.Msg):(this.$message.success("新增自动加入流程的规则成功！"),this.addDialogVisible=!1,this.getFlowRuleList())},async editRule(){var e=(await this.$http.post("EditRulePushToFlow",{hExpression:this.vExpression,hRuleList:JSON.stringify(this.ruleContentList),hRuleID:this.vRuleID}))["data"];200!==e.status?this.$message.error("修改自动加入流程的规则失败！-- 020"+e.Msg):(this.$message.success("修改自动加入流程的规则成功！"),this.editDialogVisible=!1,this.getFlowRuleList())},async getRuleContent(e){e=(await this.$http.post("getRuleContent",{hRuleID:e})).data,200!==e.status?this.$message.error("获取具体规则内容时失败！-- 020"+e.Msg):(this.$message.success("获取具体规则内容时成功！"),this.ruleContentList=JSON.parse(e.data))},async deleteRuleByID(e){return"confirm"!==await this.$confirm("此操作将删除一条流程规则,可能影响自动加入流程！ 是否继续?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e)?this.$message.info("已取消删除!"):(e=(await this.$http.post("DeleteFlowRule",{hRuleID:e.t_ID}))["data"],200!==e.status?this.$message.error("删除自定义类失败！-- 030"+e.Msg):(this.$message.success("删除规则成功！"),void this.getFlowRuleList()))},async showEditDialog(e){this.getFieldList(e.t_CatID),this.getRuleContent(e.t_RuleID),this.vExpression=e.t_Expression,this.vRuleID=e.t_RuleID,this.catName=e.v_CatName,this.cat_pid=e.t_CatID,this.vFlowName=e.t_FlowItemName,this.vRuleName=e.t_Name,this.vLength=this.ruleContentList.length,this.vOperation="",this.hValue="",this.vFieldID="",this.vName="",this.editDialogVisible=!0},async getFlowRuleList(e,t){var l=(await this.$http.post("getFlowRuleList"))["data"];if(200!==l.status)return this.$message.error("获取流程规则失败！");this.flowRuleList=JSON.parse(l.data)}}};l("5dca"),l=l("2877"),l=Object(l.a)(i,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{ref:"mainZone",staticClass:"datalist-container",style:{height:e.mainHeight+"px"}},[l("el-row",{attrs:{gutter:10}},[l("el-col",{attrs:{span:24}},[l("el-row",[l("el-card",{attrs:{"body-style":{padding:"5px"}}},[l("el-row",{attrs:{gutter:10}},[l("el-col",{attrs:{span:8}},[l("el-button",{attrs:{type:"primary"},on:{click:e.openaddRuleDialog}},[e._v("增加规则")])],1)],1),l("el-table",{attrs:{data:e.flowRuleList,height:e.tableHeight,border:"",stripe:"","highlight-current-row":"","row-style":{height:"30px"},"cell-style":{padding:"0px"}}},[l("el-table-column",{attrs:{prop:"t_No",label:"序号"}}),e._e(),l("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"t_FlowItemName",label:"流程"}}),l("el-table-column",{attrs:{prop:"t_Name",label:"规则名"}}),l("el-table-column",{attrs:{prop:"v_CatName",label:"数据类别"}}),l("el-table-column",{attrs:{prop:"t_Expression",label:"合并表达式"}}),l("el-table-column",{attrs:{prop:"CRULEWHERE",label:"约束规则",width:"500"}}),e._e(),e._e(),l("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"修改该条记录",enterable:!1,placement:"top"}},[l("el-button",{attrs:{type:"warning",icon:"el-icon-edit",size:"mini",circle:"",plain:""},on:{click:function(l){return e.showEditDialog(t.row)}}})],1),l("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除该条规则",enterable:!1,placement:"top"}},[l("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini",circle:"",plain:""},on:{click:function(l){return e.deleteRuleByID(t.row)}}})],1)]}}])})],1)],1)],1)],1)],1),l("el-dialog",{attrs:{title:"增加自动加入流程的规则",visible:e.addDialogVisible,width:"60%"},on:{"update:visible":function(t){e.addDialogVisible=t}}},[l("el-form",{staticClass:"form-1",attrs:{"label-width":"70px","label-position":"left"},nativeOn:{submit:function(e){e.preventDefault()}}},[l("el-form-item",{attrs:{label:"指定流程"}},[l("el-select",{attrs:{placeholder:"请指定流程"},model:{value:e.vFlowName,callback:function(t){e.vFlowName=t},expression:"vFlowName"}},e._l(e.flowlist,(function(e){return l("el-option",{key:e.t_FlowNumber,attrs:{label:e.t_Name,value:e.t_Name}})})),1)],1),l("el-form-item",{attrs:{label:"选择分类"}},[l("el-cascader",{ref:"LinkBref",attrs:{options:e.parentCateList,props:e.cascaderProps,size:"medium",clearable:""},on:{change:e.parentCateChanged},model:{value:e.selectedKeys,callback:function(t){e.selectedKeys=t},expression:"selectedKeys"}})],1),e.mFlagCat?l("el-form-item",{attrs:{label:"指定条件"}},[l("el-row",[l("el-col",{attrs:{span:8}},[l("el-select",{attrs:{placeholder:"请选择B类字段"},on:{change:e.fieldChanged},model:{value:e.vFieldID,callback:function(t){e.vFieldID=t},expression:"vFieldID"}},e._l(e.fieldlist,(function(e){return l("el-option",{key:e.t_FieldID,attrs:{label:e.t_Name,value:e.t_FieldID}})})),1)],1),l("el-col",{attrs:{span:8}},[l("el-select",{attrs:{placeholder:"请选择SQL符号"},on:{change:e.operationChanged},model:{value:e.vOperation,callback:function(t){e.vOperation=t},expression:"vOperation"}},e._l(e.options,(function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),l("el-col",{attrs:{span:6}},[3===e.vFieldModel.t_ControlType?l("div",[l("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"下拉框，请选择"},model:{value:e.hValue,callback:function(t){e.hValue=t},expression:"hValue"}},e._l(e.vFieldModel.PropValue,(function(e){return l("el-option",{key:e.t_No,attrs:{label:e.t_Display,value:e.t_Value}})})),1)],1):1===e.vFieldModel.t_ControlType?l("div",[l("el-input",{attrs:{placeholder:"请输入约束值"},model:{value:e.hValue,callback:function(t){e.hValue=t},expression:"hValue"}})],1):12===e.vFieldModel.t_ControlType?l("div",[l("el-date-picker",{attrs:{type:"date",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:e.hValue,callback:function(t){e.hValue=t},expression:"hValue"}})],1):l("div",[l("el-input",{attrs:{placeholder:"请输入约束值"},model:{value:e.hValue,callback:function(t){e.hValue=t},expression:"hValue"}})],1)]),l("el-col",{attrs:{span:2}},[l("el-button",{ref:"editSubmit",attrs:{type:"primary"},on:{click:function(t){return e.addRuleList(e.vFieldID,e.vName,e.vOperation,e.hValue)}}},[e._v("加入条件")])],1)],1)],1):e._e(),e.mFlagDef?l("el-form-item",{attrs:{label:"显示条件"}},[l("el-row",[l("el-table",{attrs:{data:e.ruleDefineList,border:"",stripe:"","highlight-current-row":"","row-style":{height:"30px"},"cell-style":{padding:"0px"}}},[l("el-table-column",{attrs:{type:"index",label:"序号"}}),e._e(),e._e(),l("el-table-column",{attrs:{prop:"hName",label:"字段名称"}}),l("el-table-column",{attrs:{prop:"hOperation",label:"操作符号"}}),l("el-table-column",{attrs:{prop:"hValue",label:"限定值"}}),l("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"移出条件",enterable:!1,placement:"top"}},[l("el-button",{attrs:{type:"warning",icon:"el-icon-edit",size:"mini",circle:"",plain:""},on:{click:function(l){return e.removeAddRule(t.row)}}})],1)]}}],null,!1,1537965931)})],1)],1)],1):e._e(),1<e.vLength?l("el-form-item",{attrs:{label:"合并条件"}},[l("el-input",{model:{value:e.vExpression,callback:function(t){e.vExpression=t},expression:"vExpression"}})],1):e._e()],1),l("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{ref:"editSubmit",attrs:{type:"primary"},on:{click:e.submitRule}},[e._v("提 交")]),l("el-button",{on:{click:function(t){e.addDialogVisible=!1}}},[e._v("取 消")])],1)],1),l("el-dialog",{attrs:{title:"修改自动加入流程的规则",visible:e.editDialogVisible,width:"60%"},on:{"update:visible":function(t){e.editDialogVisible=t}}},[l("el-form",{staticClass:"form-1",attrs:{"label-width":"70px","label-position":"left"},nativeOn:{submit:function(e){e.preventDefault()}}},[l("el-form-item",{attrs:{label:"流程名称"}},[l("el-input",{attrs:{disabled:""},model:{value:e.vFlowName,callback:function(t){e.vFlowName=t},expression:"vFlowName"}},[e._v("流程名称")])],1),e._e(),e._e(),l("el-form-item",{attrs:{label:"对象类别"}},[l("el-input",{attrs:{disabled:""},model:{value:e.catName,callback:function(t){e.catName=t},expression:"catName"}},[e._v("对象类别")])],1),l("el-form-item",{attrs:{label:"指定条件"}},[l("el-row",[l("el-col",{attrs:{span:8}},[l("el-select",{attrs:{placeholder:"请选择B类字段"},on:{change:e.fieldChanged},model:{value:e.vFieldID,callback:function(t){e.vFieldID=t},expression:"vFieldID"}},e._l(e.fieldlist,(function(e){return l("el-option",{key:e.t_FieldID,attrs:{label:e.t_Name,value:e.t_FieldID}})})),1)],1),l("el-col",{attrs:{span:8}},[l("el-select",{attrs:{placeholder:"请选择SQL符号"},on:{change:e.operationChanged},model:{value:e.vOperation,callback:function(t){e.vOperation=t},expression:"vOperation"}},e._l(e.options,(function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),l("el-col",{attrs:{span:6}},[3===e.vFieldModel.t_ControlType?l("div",[l("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"下拉框，请选择"},model:{value:e.hValue,callback:function(t){e.hValue=t},expression:"hValue"}},e._l(e.vFieldModel.PropValue,(function(e){return l("el-option",{key:e.t_No,attrs:{label:e.t_Display,value:e.t_Value}})})),1)],1):1===e.vFieldModel.t_ControlType?l("div",[l("el-input",{attrs:{placeholder:"请输入约束值"},model:{value:e.hValue,callback:function(t){e.hValue=t},expression:"hValue"}})],1):12===e.vFieldModel.t_ControlType?l("div",[l("el-date-picker",{attrs:{type:"date",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:e.hValue,callback:function(t){e.hValue=t},expression:"hValue"}})],1):l("div",[l("el-input",{attrs:{placeholder:"请输入约束值"},model:{value:e.hValue,callback:function(t){e.hValue=t},expression:"hValue"}})],1)]),l("el-col",{attrs:{span:2}},[l("el-button",{ref:"editSubmit",attrs:{type:"primary"},on:{click:function(t){return e.addEditRuleList(e.vFieldID,e.vFieldName,e.vName,e.vOperation,e.hValue)}}},[e._v("增加条件")])],1)],1)],1),l("el-form-item",{attrs:{label:"显示条件"}},[l("el-row",[l("el-table",{attrs:{data:e.ruleContentList,border:"",stripe:"","highlight-current-row":"","row-style":{height:"30px"},"cell-style":{padding:"0px"}}},[l("el-table-column",{attrs:{type:"index",label:"序号"}}),e._e(),e._e(),e._e(),e._e(),l("el-table-column",{attrs:{prop:"t_Name",label:"字段名称"}}),e._e(),l("el-table-column",{attrs:{prop:"t_Operator",label:"操作符号"}}),l("el-table-column",{attrs:{prop:"t_Value",label:"限定值"}}),l("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"移出条件",enterable:!1,placement:"top"}},[l("el-button",{attrs:{type:"warning",icon:"el-icon-edit",size:"mini",circle:"",plain:""},on:{click:function(l){return e.removeEditRule(t.row)}}})],1)]}}])})],1)],1)],1),l("el-form-item",{attrs:{label:"合并条件"}},[l("el-input",{model:{value:e.vExpression,callback:function(t){e.vExpression=t},expression:"vExpression"}})],1)],1),l("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{ref:"editFormRef",attrs:{type:"primary"},on:{click:e.editRule}},[e._v("确 定")]),l("el-button",{on:{click:function(t){e.editDialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)}),[],!1,null,"29ae7ba1",null);t.default=l.exports}}]);