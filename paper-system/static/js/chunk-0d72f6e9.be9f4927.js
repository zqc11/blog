(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-0d72f6e9"],{"29b8":function(e,t,r){"use strict";r("e93a")},b76f:function(e,t,r){"use strict";r.r(t);var a=r("5e90"),s=r.n(a),o=r("eb21"),n=r("69ab"),i=r("752b"),d=r("496b");r("417c"),r("7692"),a={props:{vHeight:{type:Number,default:450},vTemplateID:{type:String,default:"defaultID"},vFlowJson:{type:String,default:"defaultJson"},vIsSave:!1},data(){return{currentFlowJson:this.vFlowJson,currentTemplateID:this.vTemplateID,flowData:{nodes:[{id:1,type:"custom-circle",x:200,y:200,text:"节点1"},{id:2,type:"UserTask",x:400,y:200,text:"节点2"}],edges:[{type:"curved-edge",sourceNodeId:1,targetNodeId:2,text:"连线"}]},defaultData:{nodes:[],edges:[]}}},watch:{vTemplateID(e,t){this.currentTemplateID=e},vFlowJson(e,t){this.currentFlowJson=e,this.rePaint()}},mounted(){s.a.use(o.e),s.a.use(o.a),s.a.use(o.c),s.a.use(o.d),s.a.use(o.f),s.a.use(o.b),this.lf=new s.a({container:this.$refs.container,height:this.vHeight,stopScrollGraph:!1,stopZoomGraph:!1,keyboard:{enabled:!0},grid:{size:1,visible:!0,type:"dot",config:{color:"#ffffff",thickness:1}}}),this.lf.register(n.a),this.lf.register(i.a),this.lf.register(d.a),this.lf.extension.dndPanel.setPatternItems([{type:"bpmn:startEvent",text:"开始",label:"开始",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAAH6ji2bAAAABGdBTUEAALGPC/xhBQAAAnBJREFUOBGdVL1rU1EcPfdGBddmaZLiEhdx1MHZQXApraCzQ7GKLgoRBxMfcRELuihWKcXFRcEWF8HBf0DdDCKYRZpnl7p0svLe9Zzbd29eQhTbC8nv+9zf130AT63jvooOGS8Vf9Nt5zxba7sXQwODfkWpkbjTQfCGUd9gIp3uuPP8bZ946g56dYQvnBg+b1HB8VIQmMFrazKcKSvFW2dQTxJnJdQ77urmXWOMBCmXM2Rke4S7UAW+/8ywwFoewmBps2tu7mbTdp8VMOkIRAkKfrVawalJTtIliclFbaOBqa0M2xImHeVIfd/nKAfVq/LGnPss5Kh00VEdSzfwnBXPUpmykNss4lUI9C1ga+8PNrBD5YeqRY2Zz8PhjooIbfJXjowvQJBqkmEkVnktWhwu2SM7SMx7Cj0N9IC0oQXRo8xwAGzQms+xrB/nNSUWVveI48ayrFGyC2+E2C+aWrZHXvOuz+CiV6iycWe1Rd1Q6+QUG07nb5SbPrL4426d+9E1axKjY3AoRrlEeSQo2Eu0T6BWAAr6COhTcWjRaYfKG5csnvytvUr/WY4rrPMB53Uo7jZRjXaG6/CFfNMaXEu75nG47X+oepU7PKJvvzGDY1YLSKHJrK7vFUwXKkaxwhCW3u+sDFMVrIju54RYYbFKpALZAo7sB6wcKyyrd+aBMryMT2gPyD6GsQoRFkGHr14TthZni9ck0z+Pnmee460mHXbRAypKNy3nuMdrWgVKj8YVV8E7PSzp1BZ9SJnJAsXdryw/h5ctboUVi4AFiCd+lQaYMw5z3LGTBKjLQOeUF35k89f58Vv/tGh+l+PE/wG0rgfIUbZK5AAAAABJRU5ErkJggg=="},{type:"UserTask",text:"任务",label:"任务",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAEFVwZaAAAABGdBTUEAALGPC/xhBQAAAqlJREFUOBF9VM9rE0EUfrMJNUKLihGbpLGtaCOIR8VjQMGDePCgCCIiCNqzCAp2MyYUCXhUtF5E0D+g1t48qAd7CCLqQUQKEWkStcEfVGlLdp/fm3aW2QQdyLzf33zz5m2IsAZ9XhDpyaaIZkTS4ASzK41TFao88GuJ3hsr2pAbipHxuSYyKRugagICGANkfFnNh3HeE2N0b3nN2cgnpcictw5veJIzxmDamSlxxQZicq/mflxhbaH8BLRbuRwNtZp0JAhoplVRUdzmCe/vO27wFuuA3S5qXruGdboy5/PRGFsbFGKo/haRtQHIrM83bVeTrOgNhZReWaYGnE4aUQgTJNvijJFF4jQ8BxJE5xfKatZWmZcTQ+BVgh7s8SgPlCkcec4mGTmieTP4xd7PcpIEg1TX6gdeLW8rTVMVLVvb7ctXoH0Cydl2QOPJBG21STE5OsnbweVYzAnD3A7PVILuY0yiiyDwSm2g441r6rMSgp6iK42yqroI2QoXeJVeA+YeZSa47gZdXaZWQKTrG93rukk/l2Al6Kzh5AZEl7dDQy+JjgFahQjRopSxPbrbvK7GRe9ePWBo1wcU7sYrFZtavXALwGw/7Dnc50urrHJuTPSoO2IMV3gUQGNg87IbSOIY9BpiT9HV7FCZ94nPXb3MSnwHn/FFFE1vG6DTby+r31KAkUktB3Qf6ikUPWxW1BkXSPQeMHHiW0+HAd2GelJsZz1OJegCxqzl+CLVHa/IibuHeJ1HAKzhuDR+ymNaRFM+4jU6UWKXorRmbyqkq/D76FffevwdCp+jN3UAN/C9JRVTDuOxC/oh+EdMnqIOrlYteKSfadVRGLJFJPSB/ti/6K8f0CNymg/iH2gO/f0DwE0yjAFO6l8JaR5j0VPwPwfaYHqOqrCI319WzwhwzNW/aQAAAABJRU5ErkJggg==",className:"important-node",properties:{disabled:!1}},{type:"bpmn:endEvent",text:"结束",label:"结束",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAAH6ji2bAAAABGdBTUEAALGPC/xhBQAAA1BJREFUOBFtVE1IVUEYPXOf+tq40Y3vPcmFIdSjIorWoRG0ERWUgnb5FwVhYQSl72oUoZAboxKNFtWiwKRN0M+jpfSzqJAQclHo001tKkjl3emc8V69igP3znzfnO/M9zcDcKT67azmjYWTwl9Vn7Vumeqzj1DVb6cleQY4oAVnIOPb+mKAGxQmKI5CWNJ2aLPatxWa3aB9K7/fB+/Z0jUF6TmMlFLQqrkECWQzOZxYGjTlOl8eeKaIY5yHnFn486xBustDjWT6dG7pmjHOJd+33t0iitTPkK6tEvjxq4h2MozQ6WFSX/LkDUGfFwfhEZj1Auz/U4pyAi5Sznd7uKzznXeVHlI/Aywmk6j7fsUsEuCGADrWARXXwjxWQsUbIupDHJI7kF5dRktg0eN81IbiZXiTESic50iwS+t1oJgL83jAiBupLDCQqwziaWSoAFSeIR3P5Xv5az00wyIn35QRYTwdSYbz8pH8fxUUAtxnFvYmEmgI0wYXUXcCCSpeEVpXlsRhBnCEATxWylL9+EKCAYhe1NGstUa6356kS9NVvt3DU2fd+Wtbm/+lSbylJqsqkSm9CRhvoJVlvKPvF1RKY/FcPn5j4UfIMLn8D4UYb54BNsilTDXKnF4CfTobA0FpoW/LSp306wkXM+XaOJhZaFkcNM82ASNAWMrhrUbRfmyeI1FvRBTpN06WKxa9BK0o2E4Pd3zfBBEwPsv9sQBnmLVbLEIZ/Xe9LYwJu/Er17W6HYVBc7vmuk0xUQ+pqxdom5Fnp55SiytXLPYoMXNM4u4SNSCFWnrVIzKG3EGyMXo6n/BQOe+bX3FClY4PwydVhthOZ9NnS+ntiLh0fxtlUJHAuGaFoVmttpVMeum0p3WEXbcll94l1wM/gZ0Ccczop77VvN2I7TlsZCsuXf1WHvWEhjO8DPtyOVg2/mvK9QqboEth+7pD6NUQC1HN/TwvydGBARi9MZSzLE4b8Ru3XhX2PBxf8E1er2A6516o0w4sIA+lwURhAON82Kwe2iDAC1Watq4XHaGQ7skLcFOtI5lDxuM2gZe6WFIotPAhbaeYlU4to5cuarF1QrcZ/lwrLaCJl66JBocYZnrNlvm2+MBCTmUymPrYZVbjdlr/BxlMjmNmNI3SAAAAAElFTkSuQmCC"}]),this.lf.extension.control.addItem({iconClass:"custom-save",title:"保存",text:"保存",onMouseEnter:(e,t)=>{},onClick:(e,t)=>{this.saveFlow()}}),this.lf.on("node:click,edge:click",e=>{this.$message.error(e.data.text.x+"------"+e.data.text.y+"*** "+e.data.x+" **** "+e.data.y)}),this.lf.addMenuConfig({nodeMenu:[{text:"属性",callback(e){alert(`\n                    节点id：${e.id}\n                    节点类型：${e.type}\n                    节点坐标：(x: ${e.x}, y: ${e.y})`)}}],edgeMenu:[{text:"属性",callback(e){alert(`\n                    边id：${e.id}\n                    边类型：${e.type}\n                    边坐标：(x: ${e.x}, y: ${e.y})\n                    源节点id：${e.sourceNodeId}\n                    目标节点id：`+e.targetNodeId)}}],graphMenu:[]}),this.lf.render(this.defaultData),this.lf.setDefaultEdgeType("curved-edge")},methods:{rePaint(){var e;""===this.currentFlowJson||null===this.currentFlowJson?this.lf.graphModel.graphDataToModel(this.defaultData):(e=JSON.parse(this.currentFlowJson),this.lf.graphModel.graphDataToModel(e))},async saveFlow(){for(var e=this.lf.getGraphData(),t=this.lf.graphModel.modelToGraphData(),r=JSON.stringify(t),a=[],s=0;s<e.nodes.length;s++)a.push(e.nodes[s].text.value);var o=a.sort();for(s=0;s<o.length;s++)if(o[s]==o[s+1])return this.$message.error("重复性检查出错，任务节点名不能重复！");var n,i,d=!1,l=!1,h=!1,g="",A="",f="";for(s=0;s<e.nodes.length;s++)"bpmn:startEvent"===e.nodes[s].type&&(d=!0),"bpmn:endEvent"===e.nodes[s].type&&(l=!0),"UserTask"!==e.nodes[s].type&&"bpmn:userTask"!==e.nodes[s].type||(h=!0);if(!1===d||!1===l||!1===h)return this.$message.error("完备性检查出错，流程图必须包含开始节点、任务节点和结束节点！");for(s=0;s<e.nodes.length;s++){this.lf.graphModel.getNodeEdges(e.nodes[s].id);for(var p=this.lf.graphModel.getNodeOutgoingNode(e.nodes[s].id),u=this.lf.graphModel.getNodeIncomingNode(e.nodes[s].id),c=0;c<p.length;c++){for(var m=0,b=0;b<p.length;b++)p[c].id==p[b].id&&(m+=1);if(1<m)return this.$message.error("不允许有重复的输出线！")}for(c=0;c<u.length;c++){for(m=0,b=0;b<u.length;b++)u[c].id==u[b].id&&(m+=1);if(1<m)return this.$message.error("不允许有重复的输入线！")}if("bpmn:startEvent"===e.nodes[s].type&&1!==p.length)return this.$message.error("规范性检查出错，开始节点必须有且只能有一个输出的任务节点！");if("bpmn:endEvent"===e.nodes[s].type&&1!==u.length)return this.$message.error("规范性检查出错，结束节点必须有且只能有一个输入的任务节点！");if(("UserTask"===e.nodes[s].type||"rect"===e.nodes[s].type||"UserDiamond"===e.nodes[s].type)&&(p.length<1||u.length<1))return this.$message.error("规范性检查出错，任务节点必须要有输入和输出！");"bpmn:startEvent"===e.nodes[s].type&&1===p.length&&(g=e.nodes[s].id)}for(s=0;s<e.edges.length;s++)e.edges[s].sourceNodeId===g&&(A=e.edges[s].targetNodeId);if(""===A)return this.$message.error("节点排序时出错，找不到的第一个任务节点！");if(1!==(p=this.lf.graphModel.getNodeOutgoingNode(A)).length)return this.$message.error("节点排序时出错，第一个任务节点有且只能有一个输出！");var w=t.nodes;for(s=0;s<w.length;s++)if(w[s].id===A){w.splice(0,0,w[s]),w.splice(s+1,1);break}(o=[]).push(A);var v=[];v=w;do{if("noTargetNodeID"===(f=this.getTargetNodeID(e.edges,A,o)))break;if("tooManyLine"===f)return this.$message.error("---- 错误： 一个节点不允许有多条前向执行线！！！ -------")}while(n=this.getNodeIndex(v,A)+1,i=this.getNodeIndex(v,f),v=this.Move(v,i,n),o.push(f),"noTargetNodeID"!==(A=f));var y=JSON.stringify(t.nodes);t=JSON.stringify(t.edges);this.saveFlowToDataBase(r,y,t,this.vTemplateID)},async saveFlowToDataBase(e,t,r,a){e=(await this.$http.post("saveFlowToDataBase",{hFlowStr:e,hNodeStr:t,hEdgeStr:r,hTemplateID:a,hToken:window.sessionStorage.getItem("token")})).data,200!==e.status?this.$message.error("输入参数不正确，保存流程图信息失败！"):(this.$emit("getAllFlowItem"),this.$message.success("保存流程图信息成功！"))},getTargetNodeID(e,t,r){let a,s=0;for(var o=0;o<e.length;o++)e[o].sourceNodeId===t&&-1===r.indexOf(e[o].targetNodeId)&&(s+=1,a=e[o].targetNodeId);return 1===s?a:0===s?"noTargetNodeID":"tooManyLine"},getNodeIndex(e,t){for(var r=0;r<e.length;r++)if(e[r].id===t)return r;return-1},Move(e,t,r){return e.splice(r,0,e[t]),e.splice(t+1,1),e}}},r("29b8"),r=r("2877"),r=Object(r.a)(a,(function(){var e=this.$createElement;e=this._self._c||e;return e("div",{staticStyle:{"background-color":"'white'"}},[e("div",{ref:"container",staticClass:"container"})])}),[],!1,null,"85f11e98",null);t.default=r.exports},e93a:function(e,t,r){}}]);