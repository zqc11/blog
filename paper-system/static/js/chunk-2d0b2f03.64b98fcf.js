(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2d0b2f03"],{"25f0":function(e,t,s){"use strict";s.r(t);var i={data(){return{tableHeight:this.$root.gScreenHeight-120,slbHeight:this.$root.gScreenHeight-90,mainHeight:this.$root.gScreenHeight-70,queryInfo:{query:"",pagenum:1,pagesize:10},userrolelist:[],total:0,addDialogVisible:!1,addForm:{username:"",password:"",loginname:"",sex:"",postion:"",isOnJob:"",isActive:""},addFormRules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:1,max:10,message:"用户名的长度在1~10个字符之间",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:1,max:15,message:"用户名的长度在1~15个字符之间",trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:(e,t,s)=>{/^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/.test(t),s(new Error("请输入合法的手机号"))},trigger:"blur"}]},editDialogVisible:!1,editForm:{},setRoleDialogVisible:!1,userInfo:{},rolesList:[],cityOptions:[],checkedCities:[],cities:[]}},created(){this.getUserRoleList(),this.getSysRole(),this.$root.leveOnePathName="用户",this.$root.leveTwoPathName="用户与角色",this.tableHeight=JSON.parse(window.localStorage.getItem("gHeight"))-200,this.slbHeight=JSON.parse(window.localStorage.getItem("gHeight"))-195,this.mainHeight=JSON.parse(window.localStorage.getItem("gHeight"))-185,this.mainWidth=this.$root.gScreenWidth-210},methods:{async getUserRoleList(){var e=(await this.$http.post("getUserRoleList"))["data"];if(200!==e.status)return this.$message.error("获取用户列表失败！");this.userrolelist=e.dUserRole},handleSizeChange(e){this.queryInfo.pagesize=e,this.getUserRoleList()},handleCurrentChange(e){this.queryInfo.pagenum=e,this.getUserRoleList()},async userStateChanged(e){var t=(await this.$http.put(`users/${e.id}/state/`+e.mg_state))["data"];if(200!==t.meta.status)return e.mg_state=!e.mg_state,this.$message.error("更新用户状态失败！");this.$message.success("更新用户状态成功！")},addDialogClosed(){this.$refs.addFormRef.resetFields()},addUser(){this.$refs.addFormRef.validate(async e=>{e&&(e=(await this.$http.post("addUser",{form:JSON.stringify(this.addForm)}))["data"],200!==e.status&&this.$message.error("添加用户失败！"),this.$message.success("添加用户成功！"),this.addDialogVisible=!1,this.getUserRoleList())})},async showEditDialog(e){if(e=(await this.$http.post("getUser",{hUserID:e})).data,200!==e.status)return this.$message.error("查询用户信息失败！");this.editForm=JSON.parse(e.data),this.editDialogVisible=!0},editDialogClosed(){this.$refs.editFormRef.resetFields()},editUserInfo(){this.$refs.editFormRef.validate(async e=>{if(e){if(e=(await this.$http.post("editUser",{form:JSON.stringify(this.editForm)}))["data"],200!==e.status)return this.$message.error("更新用户信息失败！");this.editDialogVisible=!1,this.getUserRoleList(),this.$message.success("更新用户信息成功！")}})},async removeUserById(e){return"confirm"!==await this.$confirm("此操作将永久删除该用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e)?this.$message.info("已取消删除"):(e=(await this.$http.post("deleteUser",{hUserID:e}))["data"],200!==e.status?this.$message.error("删除用户失败！"):(this.$message.success("删除用户成功！"),void this.getUserRoleList()))},async setRole(e){if(this.userInfo=e,this.checkedCities=[],e=this.userInfo.RoleIDStr,null!==e&void 0!==e&""!==e&&(this.checkedCities=e.split(";")),e=(await this.$http.post("getRoleList")).data,200!==e.status)return this.$message.error("获取角色列表失败！");this.rolesList=JSON.parse(e.data),this.setRoleDialogVisible=!0},async saveRoleInfo(){return 0===this.checkedCities.length?this.$message.error("请选择要分配的角色！"):(e=(await this.$http.post("allotUserRole",{hRoleStr:JSON.stringify(this.checkedCities),hUserID:this.userInfo.UserID}))["data"],200!==e.status?this.$message.error("更新角色失败！"):(this.$message.success("分配角色成功！"),this.getUserRoleList(),void(this.setRoleDialogVisible=!1)));var e},setRoleDialogClosed(){this.checkedCities=[],this.userInfo={}},async getSysRole(){var e=(await this.$http.post("getSysRole"))["data"];if(200!==e.status)return this.$message.error("获取角色列表失败！");this.cities=JSON.parse(e.data),this.cityOptions=JSON.parse(e.data)},handleCheckedChange(e){}}};s=s("2877"),s=Object(s.a)(i,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"mainZone",staticClass:"datalist-container",style:{height:e.mainHeight+"px"}},[s("el-row",{attrs:{gutter:5}},[s("el-col",{attrs:{span:24}},[s("el-card",{attrs:{"body-style":{padding:"5px"}}},[s("el-table",{attrs:{data:e.userrolelist,border:"",stripe:"",height:e.tableHeight}},[s("el-table-column",{attrs:{type:"index"}}),s("el-table-column",{attrs:{label:"姓名",prop:"UserName"}}),s("el-table-column",{attrs:{label:"用户名",prop:"LoginName"}}),s("el-table-column",{attrs:{label:"角色",prop:"RoleNameStr"}}),s("el-table-column",{attrs:{label:"分配角色",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tooltip",{attrs:{effect:"dark",content:"分配角色",placement:"top",enterable:!1}},[s("el-button",{attrs:{type:"warning",icon:"el-icon-setting",size:"medium"},on:{click:function(s){return e.setRole(t.row)}}})],1)]}}])})],1)],1)],1)],1),s("el-dialog",{attrs:{title:"分配角色",visible:e.setRoleDialogVisible,width:"50%"},on:{"update:visible":function(t){e.setRoleDialogVisible=t},close:e.setRoleDialogClosed}},[s("div",[s("p",[e._v("当前用户："+e._s(e.userInfo.LoginName))]),s("p"),s("p"),[s("div",{staticStyle:{margin:"15px 0"}}),s("el-checkbox-group",{model:{value:e.checkedCities,callback:function(t){e.checkedCities=t},expression:"checkedCities"}},e._l(e.cities,(function(t){return s("el-checkbox",{key:t.t_Name,attrs:{label:t.t_ID},on:{change:function(s){return e.handleCheckedChange(t)}}},[e._v(" "+e._s(t.t_Name)+" ")])})),1)]],2),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.setRoleDialogVisible=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:e.saveRoleInfo}},[e._v("确 定")])],1)])],1)}),[],!1,null,"e9eea10c",null);t.default=s.exports}}]);