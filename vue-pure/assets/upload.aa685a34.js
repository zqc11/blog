import{_ as U,n as E,w as V,u as H,o as L,N as O}from"./index.b2e6b694.js";import{b as g}from"./ui.19e1b5b7.js";/* empty css                   */import{d as x,o as m,z as A,A as i,h as p,r as n,a2 as W,e as a,w as u,V as z,b as K,be as b,H as P,D as h,J as G,K as J}from"./element-plus.5e3a2ffc.js";import{_ as q}from"./plugin-vue_export-helper.98d5223b.js";import"./vform3-plus.79b63deb.js";const Q=x({name:"UploadFilled"}),X={class:"icon",width:"200",height:"200",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},Y=i("path",{fill:"currentColor",d:"M544 864V672h128L512 480 352 672h128v192H320v-1.6c-5.376.32-10.496 1.6-16 1.6A240 240 0 0164 624c0-123.136 93.12-223.488 212.608-237.248A239.808 239.808 0 01512 192a239.872 239.872 0 01235.456 194.752c119.488 13.76 212.48 114.112 212.48 237.248a240 240 0 01-240 240c-5.376 0-10.56-1.28-16-1.6v1.6H544z"},null,-1),Z=[Y];function ee(c,r,s,l,d,_){return m(),A("svg",X,Z)}var oe=q(Q,[["render",ee]]);const B=c=>(G("data-v-737cd94d"),c=c(),J(),c),te=h("\u6E05\u7A7A"),se=h("\u63D0\u4EA4\u56FE\u7EB8"),ae=B(()=>i("div",{class:"el-upload__text"},[h(" \u62D6\u653E\u6587\u4EF6 \u6216 "),i("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1)),ue=B(()=>i("div",{class:"el-upload__tip"},"\u652F\u6301 AutoCAD \u7684 dwg \u548C dxf \u6587\u4EF6\u7C7B\u578B",-1)),le=x({setup(c){const r=p(!1),s=p([]),l=p([]),d=E().GET_CURRENT_TASK(),_=p(),f=V(),D=H();let w=new L.Service(f.serviceUrl,f.accessToken);const y=e=>{if(e.status==="ready"){const o=e.name.endsWith(".dwg");s.value.push(e),o&&l.value.push(e)}},C=e=>{const o=e.name.endsWith(".dwg");s.value.splice(s.value.indexOf(e),1),o&&l.value.splice(l.value.indexOf(e),1)},k=(e,o)=>{b.error("\u6587\u4EF6\uFF1A"+o.name+" \u8FC7\u5927\u4E0A\u4F20\u5931\u8D25")},R=()=>{s.value=[],l.value=[]},$=()=>{r.value=!0,l.value.forEach(async e=>{await j(e)}),s.value.forEach(e=>{const o=e.name.endsWith(".pdf"),t={filename:e.name,location:"",type:"pdf"};o&&F(t)}),_.value.submit(),r.value=!1,E().SET_CURRENT_BLUEPRINT(d.blueprints[0]),D.push("/taskInfo")},j=async e=>{if(!!e)try{let o=await w.uploadMap(e.raw);const t=await w.openMap(o);if(t.error)g("\u6253\u5F00\u56FE\u5F62\u5931\u8D25!",t.error);else{f.addMyMapId(o.mapid);const v={filename:o.uploadname,location:o.mapid,type:"dwg"};F(v)}}catch(o){r.value=!1,g("\u4E0A\u4F20\u56FE\u5F62\u5931\u8D25!",o)}},F=e=>{const o={taskId:d.id,blueprint:e};O(o).then(t=>{t.success&&(b.success("\u63D0\u4EA4\u6210\u529F"),d.blueprints.push(e))})};return(e,o)=>{const t=n("el-button"),v=n("el-col"),I=n("el-row"),S=n("el-divider"),T=n("el-icon"),N=n("el-upload"),M=W("loading");return m(),A("div",null,[a(I,{justify:"end"},{default:u(()=>[a(v,null,{default:u(()=>[a(t,{onClick:R},{default:u(()=>[te]),_:1}),a(t,{type:"primary",onClick:$},{default:u(()=>[se]),_:1})]),_:1})]),_:1}),a(S),z((m(),K(N,{class:"uploadfile-wrapper",drag:"",multiple:"",ref_key:"uploadRef",ref:_,accept:".dwg, .dxf, .pdf",action:"http://localhost:8080/multiUpload","on-change":y,"on-remove":C,"on-error":k,"auto-upload":!1,"file-list":s.value,"element-loading-text":"\u6B63\u5728\u4E0A\u4F20,\u8BF7\u7A0D\u4FAF..."},{tip:u(()=>[ue]),default:u(()=>[a(T,{class:"el-icon--upload",color:"#0000ff"},{default:u(()=>[a(P(oe))]),_:1}),ae]),_:1},8,["file-list"])),[[M,r.value]])])}}});var _e=U(le,[["__scopeId","data-v-737cd94d"]]);export{_e as default};
