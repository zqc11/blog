import{_ as R,w as T,u as V,o as N,F as _}from"./index.8f675947.js";import{b as h}from"./ui.ef5d2b61.js";/* empty css                   */import{d as W,h as i,r as l,a2 as $,z as H,e as a,w as s,V as L,b as O,bc as U,o as w,H as z,D as f,J,K,A as m}from"./element-plus.ab042766.js";import{u as P}from"./upload-filled.b3e74b54.js";import"./vform3-plus.5c4eeb71.js";import"./plugin-vue_export-helper.98d5223b.js";const g=r=>(J("data-v-57f4952e"),r=r(),K(),r),q=f("\u6E05\u7A7A"),G=f("\u4E0B\u4E00\u6B65"),Q=g(()=>m("div",{class:"el-upload__text"},[f(" \u62D6\u653E\u6587\u4EF6 \u6216 "),m("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1)),X=g(()=>m("div",{class:"el-upload__tip"},"\u652F\u6301 AutoCAD \u7684 dwg \u548C dxf \u6587\u4EF6\u7C7B\u578B",-1)),Y=W({emits:["next"],setup(r,{emit:x}){const c=i(!1),u=i([]),n=i([]),v=i(),d=T(),E=V();let F=new N.Service(d.serviceUrl,d.accessToken);const b=e=>{if(e.status==="ready"){const o=e.name.endsWith(".dwg");u.value.push(e),o&&n.value.push(e)}},A=e=>{const o=e.name.endsWith(".dwg");u.value.splice(u.value.indexOf(e),1),o&&n.value.splice(n.value.indexOf(e),1)},D=(e,o)=>{U.error("\u6587\u4EF6\uFF1A"+o.name+" \u8FC7\u5927\u4E0A\u4F20\u5931\u8D25")},y=()=>{u.value=[],n.value=[],_().$state.blueprints=[]},B=()=>{c.value=!0,n.value.forEach(e=>{k(e)}),u.value.forEach(e=>{const o=e.name.endsWith(".pdf"),t={filename:e.name,location:"",type:"pdf"};o&&_().$state.blueprints.push(t)}),v.value.submit(),c.value=!1,E.push("/newTask/formDesign"),x("next",2)},k=async e=>{if(!!e)try{let o=await F.uploadMap(e.raw);const t=await F.openMap(o);if(t.error)h("\u6253\u5F00\u56FE\u5F62\u5931\u8D25!",t.error);else{d.addMyMapId(o.mapid);const p={filename:o.uploadname,location:o.mapid,type:"dwg"};_().$state.blueprints.push(p)}}catch(o){c.value=!1,h("\u4E0A\u4F20\u56FE\u5F62\u5931\u8D25!",o)}};return(e,o)=>{const t=l("el-button"),p=l("el-col"),C=l("el-row"),j=l("el-divider"),S=l("el-icon"),I=l("el-upload"),M=$("loading");return w(),H("div",null,[a(C,{justify:"end"},{default:s(()=>[a(p,null,{default:s(()=>[a(t,{onClick:y},{default:s(()=>[q]),_:1}),a(t,{type:"primary",onClick:B},{default:s(()=>[G]),_:1})]),_:1})]),_:1}),a(j),L((w(),O(I,{class:"uploadfile-wrapper",drag:"",multiple:"",ref_key:"uploadRef",ref:v,accept:".dwg, .dxf, .pdf",action:"http://localhost:8080/multiUpload","on-change":b,"on-remove":A,"on-error":D,"auto-upload":!1,"file-list":u.value,"element-loading-text":"\u6B63\u5728\u4E0A\u4F20,\u8BF7\u7A0D\u4FAF..."},{tip:s(()=>[X]),default:s(()=>[a(S,{class:"el-icon--upload",color:"#0000ff"},{default:s(()=>[a(z(P))]),_:1}),Q]),_:1},8,["file-list"])),[[M,c.value]])])}}});var le=R(Y,[["__scopeId","data-v-57f4952e"]]);export{le as default};
