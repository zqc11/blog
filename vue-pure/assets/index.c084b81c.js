import{N as ne}from"./index.a529677c.js";/* empty css                */import{_ as le,n as y,s as ae,M as L}from"./index.e3e59a78.js";/* empty css                   */import{d as de,h as i,x as k,Q as ce,N as S,r as l,z as g,e as u,w as s,H as _,o as p,F as V,G,b as T,D as m,C as B,A as ie,be as A}from"./element-plus.5e3a2ffc.js";import"./ui.a81870d9.js";import"./plugin-vue_export-helper.98d5223b.js";import"./vform3-plus.79b63deb.js";const pe={key:0},me={key:1},_e=m("\u6587\u4EF6\u4E0B\u8F7D"),fe=m("\u4EC5\u663E\u793A\u8868\u5355"),ve=m("\u4EC5\u663E\u793A\u56FE\u7EB8"),he=m("\u53CC\u5217\u663E\u793A"),ge={key:1},Ne={class:"dialog-footer"},Ce=m("\u53D6\u6D88"),Ee=m("\u786E\u5B9A"),ye=de({setup(ke){let x=i(2);const a=y().GET_CURRENT_TASK(),o=i(y().GET_CURRENT_NODE()),F=i(o.value.properties.orderNum),b=i(F.value),N=i([]),D=k(()=>a.blueprints);let R=k(()=>y().GET_CURRENT_BLUEPRINT());const C=i(""),j=i("primary"),w=i(""),v=ae.getItem("info").userInfo.id,E=i(!1);let I=k(()=>{const e=o.value.properties.hasPassed!==null?o.value.properties.hasPassed.indexOf(v+"")!==-1:!1,t=o.value.properties.hasRejected!==null?o.value.properties.hasRejected.indexOf(v+"")!==-1:!1;return"\u8FDB\u884C\u4E2D|\u88AB\u9A73\u56DE".indexOf(o.value.properties.status)===-1||e||t});const M=k(()=>{const e=o.value.properties,t=o.value.properties.rejectTo;return t===0||e.checkers.length===1||U(t)==="or"?"":e.hasRejected.length+"/"+e.checkers.length}),H=k(()=>{const e=o.value.properties;return e.checkers.length===1||O()==="or"?"":e.hasPassed.length+"/"+e.checkers.length}),J=()=>{const e=o.value.properties;return e.checkers.length===e.hasRejected.length+1},$=()=>{const e=o.value.properties;return e.checkers.length===e.hasPassed.length+1},O=()=>{const t=a.flowChart.nodes.filter(d=>d.properties.orderNum===o.value.properties.orderNum+1)[0].id,f=o.value.id;return a.flowChart.edges.filter(d=>d.sourceNodeId===f&&d.targetNodeId===t)[0].properties.condition},U=e=>{const f=a.flowChart.nodes.filter(n=>n.properties.orderNum===e)[0].id,r=o.value.id;return a.flowChart.edges.filter(n=>n.sourceNodeId===r&&n.targetNodeId===f)[0].properties.condition};function z(){x.value=1,C.value="primary",j.value="",w.value=""}function K(){x.value=2,C.value="",j.value="primary",w.value=""}function Q(){x.value=3,C.value="",j.value="",w.value="primary"}const q=e=>{y().SET_CURRENT_BLUEPRINT(e)},W=()=>{E.value=!0},X=()=>{const e={taskId:a.id,type:"\u5BA1\u6279\u901A\u8FC7",condition:O(),complete:$(),checker:v,launchOrderNum:o.value.properties.orderNum,endOrderNum:o.value.properties.orderNum+1};L(JSON.stringify(e)).then(t=>{t.success&&(o.value.properties.status="\u5DF2\u5B8C\u6210",o.value.properties.hasPassed.push(v+""),A.success("\u63D0\u4EA4\u6210\u529F"))}).catch(t=>{A.error(t.message)})},Y=()=>{const e={taskId:a.id,type:"\u5BA1\u6279\u9A73\u56DE",condition:U(b.value),complete:J(),checker:v,launchOrderNum:o.value.properties.orderNum,endOrderNum:b.value};L(JSON.stringify(e)).then(t=>{t.success&&(o.value.properties.status="\u672A\u5F00\u59CB",o.value.properties.hasRejected.push(v+""),E.value=!1,A.success("\u63D0\u4EA4\u6210\u529F"))}).catch(t=>{A.error(t.message)})},Z=e=>{b.value=e.properties.orderNum},ee=()=>{const e=R.value.filename,t=document.createElement("a");t.download=e,t.style.display="none",t.href="http://localhost:8080/getPdfFile/"+e,document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)};return ce(()=>{const e=a.flowChart.edges,t=a.flowChart.nodes,f=e.filter(r=>r.sourceNodeId===o.value.id).map(r=>r.targetNodeId);N.value=t.filter(r=>f.indexOf(r.id)!==-1&&r.properties.orderNum<F.value),N.value.sort((r,d)=>r.properties.orderNum-d.properties.orderNum)}),y().SET_CURRENT_BLUEPRINT(D.value[0]),S("show",x),S("disabled",I),(e,t)=>{const f=l("el-dropdown-item"),r=l("el-dropdown-menu"),d=l("el-dropdown"),n=l("el-button"),h=l("el-col"),te=l("el-row"),oe=l("el-step"),se=l("el-steps"),ue=l("el-dialog"),re=l("router-view");return p(),g("div",null,[u(te,{gutter:6,class:"toolbar",justify:"start"},{default:s(()=>[u(d,{trigger:"click","split-button":"",onCommand:q},{dropdown:s(()=>[u(r,null,{default:s(()=>[(p(!0),g(V,null,G(_(D),(c,P)=>(p(),T(f,{key:P,command:c},{default:s(()=>[m(B(c.filename),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:s(()=>[_(R)==null?(p(),g("span",pe,"\u663E\u793A\u56FE\u7EB8")):(p(),g("span",me,B(_(R).filename),1))]),_:1}),u(h,{xs:6,sm:4,md:3,lg:2,xl:2},{default:s(()=>[u(n,{class:"top-menu-button",onClick:ee,type:C.value},{default:s(()=>[_e]),_:1},8,["type"])]),_:1}),u(h,{xs:6,sm:4,md:3,lg:2,xl:2},{default:s(()=>[u(n,{class:"top-menu-button",onClick:z,type:C.value},{default:s(()=>[fe]),_:1},8,["type"])]),_:1}),u(h,{xs:6,sm:4,md:3,lg:2,xl:2},{default:s(()=>[u(n,{class:"top-menu-button",onClick:K,type:j.value},{default:s(()=>[ve]),_:1},8,["type"])]),_:1}),u(h,{xs:6,sm:4,md:3,lg:2,xl:2,class:"hidden-sm-and-down"},{default:s(()=>[u(n,{class:"top-menu-button",onClick:Q,type:w.value},{default:s(()=>[he]),_:1},8,["type"])]),_:1}),u(h,{xs:6,sm:4,md:3,lg:2,xl:2},{default:s(()=>[u(n,{type:"danger",class:"top-menu-button justify-end",disabled:_(I),onClick:W},{default:s(()=>[m("\u5BA1\u6279\u9A73\u56DE"+B(_(M)),1)]),_:1},8,["disabled"])]),_:1}),u(h,{xs:6,sm:4,md:3,lg:2,xl:2},{default:s(()=>[u(n,{type:"success",class:"top-menu-button justify-end",disabled:_(I),onClick:X},{default:s(()=>[m("\u5BA1\u6279\u901A\u8FC7"+B(_(H)),1)]),_:1},8,["disabled"])]),_:1})]),_:1}),u(_(ne)),u(ue,{modelValue:E.value,"onUpdate:modelValue":t[1]||(t[1]=c=>E.value=c),title:"\u8BF7\u9009\u62E9\u9A73\u56DE\u5230\u7684\u8282\u70B9",width:"30%"},{footer:s(()=>[ie("span",Ne,[u(n,{onClick:t[0]||(t[0]=c=>E.value=!1)},{default:s(()=>[Ce]),_:1}),u(n,{type:"primary",onClick:Y,disabled:N.value.length===0},{default:s(()=>[Ee]),_:1},8,["disabled"])])]),default:s(()=>[N.value.length>0?(p(),T(se,{key:0,active:b.value-1,"align-center":""},{default:s(()=>[(p(!0),g(V,null,G(N.value,c=>(p(),T(oe,{title:c.text.value,key:c.id,onClick:P=>Z(c)},null,8,["title","onClick"]))),128))]),_:1},8,["active"])):(p(),g("span",ge,"\u6682\u65E0\u53EF\u9009\u62E9\u7684\u9A73\u56DE\u8282\u70B9"))]),_:1},8,["modelValue"]),u(re)])}}});var Te=le(ye,[["__scopeId","data-v-78e9802a"]]);export{Te as default};
