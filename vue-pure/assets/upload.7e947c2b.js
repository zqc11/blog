import{_ as H,n as g,w as P,u as W,o as z,D as K,N as X}from"./index.f2fed7a2.js";import{b as A}from"./ui.94e37cee.js";/* empty css                   */import{d as x,o as v,z as D,A as d,h as i,r as l,a2 as Y,e as a,w as u,V as G,b as J,H as B,be as y,D as m,J as q,K as Q}from"./element-plus.5e3a2ffc.js";import{_ as Z}from"./plugin-vue_export-helper.98d5223b.js";import"./vform3-plus.79b63deb.js";const ee=x({name:"UploadFilled"}),oe={class:"icon",width:"200",height:"200",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},se=d("path",{fill:"currentColor",d:"M544 864V672h128L512 480 352 672h128v192H320v-1.6c-5.376.32-10.496 1.6-16 1.6A240 240 0 0164 624c0-123.136 93.12-223.488 212.608-237.248A239.808 239.808 0 01512 192a239.872 239.872 0 01235.456 194.752c119.488 13.76 212.48 114.112 212.48 237.248a240 240 0 01-240 240c-5.376 0-10.56-1.28-16-1.6v1.6H544z"},null,-1),te=[se];function ae(c,I,h,r,t,n){return v(),D("svg",oe,te)}var ue=Z(ee,[["render",ae]]);const C=c=>(q("data-v-548364ec"),c=c(),Q(),c),ne=m("\u6E05\u7A7A"),le=m("\u63D0\u4EA4\u56FE\u7EB8"),ce=C(()=>d("div",{class:"el-upload__text"},[m(" \u62D6\u653E\u6587\u4EF6 \u6216 "),d("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1)),re=C(()=>d("div",{class:"el-upload__tip"},"\u652F\u6301 AutoCAD \u7684 dwg \u548C dxf \u6587\u4EF6\u7C7B\u578B",-1)),de=x({setup(c){const{VITE_PROXY_DOMAIN:I,VITE_PROXY_DOMAIN_REAL:h}=K(),r=i(!1),t=i([]),n=i([]),p=g().GET_CURRENT_TASK(),E=i(),_=P(),R=W(),k=h;let w=new z.Service(_.serviceUrl,_.accessToken);const b=e=>{if(e.status==="ready"){const o=e.name.endsWith(".dwg");t.value.push(e),o&&n.value.push(e)}},T=e=>{const o=e.name.endsWith(".dwg");t.value.splice(t.value.indexOf(e),1),o&&n.value.splice(n.value.indexOf(e),1)},N=(e,o)=>{y.error("\u6587\u4EF6\uFF1A"+o.name+" \u8FC7\u5927\u4E0A\u4F20\u5931\u8D25")},$=()=>{t.value=[],n.value=[]},j=()=>{r.value=!0,n.value.forEach(async e=>{await M(e)}),t.value.forEach(e=>{const o=e.name.endsWith(".pdf"),s={filename:e.name,location:"",type:"pdf"};o&&F(s)}),E.value.submit(),r.value=!1,g().SET_CURRENT_BLUEPRINT(p.blueprints[0]),R.push("/taskInfo")},M=async e=>{if(!!e)try{let o=await w.uploadMap(e.raw);const s=await w.openMap(o);if(s.error)A("\u6253\u5F00\u56FE\u5F62\u5931\u8D25!",s.error);else{_.addMyMapId(o.mapid);const f={filename:o.uploadname,location:o.mapid,type:"dwg"};F(f)}}catch(o){r.value=!1,A("\u4E0A\u4F20\u56FE\u5F62\u5931\u8D25!",o)}},F=e=>{const o={taskId:p.id,blueprint:e};X(o).then(s=>{s.success&&(y.success("\u63D0\u4EA4\u6210\u529F"),p.blueprints.push(e))})};return(e,o)=>{const s=l("el-button"),f=l("el-col"),S=l("el-row"),O=l("el-divider"),V=l("el-icon"),L=l("el-upload"),U=Y("loading");return v(),D("div",null,[a(S,{justify:"end"},{default:u(()=>[a(f,null,{default:u(()=>[a(s,{onClick:$},{default:u(()=>[ne]),_:1}),a(s,{type:"primary",onClick:j},{default:u(()=>[le]),_:1})]),_:1})]),_:1}),a(O),G((v(),J(L,{class:"uploadfile-wrapper",drag:"",multiple:"",ref_key:"uploadRef",ref:E,accept:".dwg, .dxf, .pdf",action:B(k),"on-change":b,"on-remove":T,"on-error":N,"auto-upload":!1,"file-list":t.value,"element-loading-text":"\u6B63\u5728\u4E0A\u4F20,\u8BF7\u7A0D\u4FAF..."},{tip:u(()=>[re]),default:u(()=>[a(V,{class:"el-icon--upload",color:"#0000ff"},{default:u(()=>[a(B(ue))]),_:1}),ce]),_:1},8,["action","file-list"])),[[U,r.value]])])}}});var he=H(de,[["__scopeId","data-v-548364ec"]]);export{he as default};
