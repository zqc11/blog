import{d as defineComponent,H as useRouter,o as openBlock,n as createElementBlock,p as createBaseVNode,u as toDisplayString,a6 as h,a3 as renderSlot,Y as normalizeStyle,cE as inject,V as computed,$ as reactive,q as ref,r as resolveComponent,a as createVNode,w as withCtx,W as withDirectives,X as vShow,A as unref,v as createTextVNode,cF as ElMessage,cA as getDefaultExportFromCjs,aO as onMounted}from"./vendor.34685522.js";/* empty css                   */var _imports_0="/assets/cad.ab3c3c3c.jpg";const _hoisted_1$2=createBaseVNode("img",{src:_imports_0,alt:"\u673A\u68B0\u56FE\u7EB8"},null,-1),_sfc_main$3=defineComponent({props:{item:{type:Object}},setup(he){const w=he,U=useRouter();function O(I){console.log(I),U.push({path:"/taskInfo",query:{item:JSON.stringify(I)}})}return(I,g)=>(openBlock(),createElementBlock("div",{onClick:g[0]||(g[0]=a=>O(w.item))},[_hoisted_1$2,createBaseVNode("span",null,toDisplayString(he.item.title),1)]))}});var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(he,w,U)=>w in he?__defProp(he,w,{enumerable:!0,configurable:!0,writable:!0,value:U}):he[w]=U,__spreadValues=(he,w)=>{for(var U in w||(w={}))__hasOwnProp.call(w,U)&&__defNormalProp(he,U,w[U]);if(__getOwnPropSymbols)for(var U of __getOwnPropSymbols(w))__propIsEnum.call(w,U)&&__defNormalProp(he,U,w[U]);return he},__spreadProps=(he,w)=>__defProps(he,__getOwnPropDescs(w)),__objRest=(he,w)=>{var U={};for(var O in he)__hasOwnProp.call(he,O)&&w.indexOf(O)<0&&(U[O]=he[O]);if(he!=null&&__getOwnPropSymbols)for(var O of __getOwnPropSymbols(he))w.indexOf(O)<0&&__propIsEnum.call(he,O)&&(U[O]=he[O]);return U};const _sfc_main$1$1={name:"splitpanes",emits:["ready","resize","resized","pane-click","pane-maximize","pane-add","pane-remove","splitter-click"],props:{horizontal:{type:Boolean},pushOtherPanes:{type:Boolean,default:!0},dblClickSplitter:{type:Boolean,default:!0},rtl:{type:Boolean,default:!1},firstSplitter:{type:Boolean}},provide(){return{requestUpdate:this.requestUpdate,onPaneAdd:this.onPaneAdd,onPaneRemove:this.onPaneRemove,onPaneClick:this.onPaneClick}},data:()=>({container:null,ready:!1,panes:[],touch:{mouseDown:!1,dragging:!1,activeSplitter:null},splitterTaps:{splitter:null,timeoutId:null}}),computed:{panesCount(){return this.panes.length},indexedPanes(){return this.panes.reduce((he,w)=>(he[w.id]=w)&&he,{})}},methods:{updatePaneComponents(){this.panes.forEach(he=>{he.update&&he.update({[this.horizontal?"height":"width"]:`${this.indexedPanes[he.id].size}%`})})},bindEvents(){document.addEventListener("mousemove",this.onMouseMove,{passive:!1}),document.addEventListener("mouseup",this.onMouseUp),"ontouchstart"in window&&(document.addEventListener("touchmove",this.onMouseMove,{passive:!1}),document.addEventListener("touchend",this.onMouseUp))},unbindEvents(){document.removeEventListener("mousemove",this.onMouseMove,{passive:!1}),document.removeEventListener("mouseup",this.onMouseUp),"ontouchstart"in window&&(document.removeEventListener("touchmove",this.onMouseMove,{passive:!1}),document.removeEventListener("touchend",this.onMouseUp))},onMouseDown(he,w){this.bindEvents(),this.touch.mouseDown=!0,this.touch.activeSplitter=w},onMouseMove(he){this.touch.mouseDown&&(he.preventDefault(),this.touch.dragging=!0,this.calculatePanesSize(this.getCurrentMouseDrag(he)),this.$emit("resize",this.panes.map(w=>({min:w.min,max:w.max,size:w.size}))))},onMouseUp(){this.touch.dragging&&this.$emit("resized",this.panes.map(he=>({min:he.min,max:he.max,size:he.size}))),this.touch.mouseDown=!1,setTimeout(()=>{this.touch.dragging=!1,this.unbindEvents()},100)},onSplitterClick(he,w){"ontouchstart"in window&&(he.preventDefault(),this.dblClickSplitter&&(this.splitterTaps.splitter===w?(clearTimeout(this.splitterTaps.timeoutId),this.splitterTaps.timeoutId=null,this.onSplitterDblClick(he,w),this.splitterTaps.splitter=null):(this.splitterTaps.splitter=w,this.splitterTaps.timeoutId=setTimeout(()=>{this.splitterTaps.splitter=null},500)))),this.touch.dragging||this.$emit("splitter-click",this.panes[w])},onSplitterDblClick(he,w){let U=0;this.panes=this.panes.map((O,I)=>(O.size=I===w?O.max:O.min,I!==w&&(U+=O.min),O)),this.panes[w].size-=U,this.$emit("pane-maximize",this.panes[w])},onPaneClick(he,w){this.$emit("pane-click",this.indexedPanes[w])},getCurrentMouseDrag(he){const w=this.container.getBoundingClientRect(),{clientX:U,clientY:O}="ontouchstart"in window&&he.touches?he.touches[0]:he;return{x:U-w.left,y:O-w.top}},getCurrentDragPercentage(he){he=he[this.horizontal?"y":"x"];const w=this.container[this.horizontal?"clientHeight":"clientWidth"];return this.rtl&&!this.horizontal&&(he=w-he),he*100/w},calculatePanesSize(he){const w=this.touch.activeSplitter;let U={prevPanesSize:this.sumPrevPanesSize(w),nextPanesSize:this.sumNextPanesSize(w),prevReachedMinPanes:0,nextReachedMinPanes:0};const O=0+(this.pushOtherPanes?0:U.prevPanesSize),I=100-(this.pushOtherPanes?0:U.nextPanesSize),g=Math.max(Math.min(this.getCurrentDragPercentage(he),I),O);let a=[w,w+1],l=this.panes[a[0]]||null,n=this.panes[a[1]]||null;const u=l.max<100&&g>=l.max+U.prevPanesSize,v=n.max<100&&g<=100-(n.max+this.sumNextPanesSize(w+1));if(u||v){u?(l.size=l.max,n.size=Math.max(100-l.max-U.prevPanesSize-U.nextPanesSize,0)):(l.size=Math.max(100-n.max-U.prevPanesSize-this.sumNextPanesSize(w+1),0),n.size=n.max);return}if(this.pushOtherPanes){const _=this.doPushOtherPanes(U,g);if(!_)return;({sums:U,panesToResize:a}=_),l=this.panes[a[0]]||null,n=this.panes[a[1]]||null}l!==null&&(l.size=Math.min(Math.max(g-U.prevPanesSize-U.prevReachedMinPanes,l.min),l.max)),n!==null&&(n.size=Math.min(Math.max(100-g-U.nextPanesSize-U.nextReachedMinPanes,n.min),n.max))},doPushOtherPanes(he,w){const U=this.touch.activeSplitter,O=[U,U+1];return w<he.prevPanesSize+this.panes[O[0]].min&&(O[0]=this.findPrevExpandedPane(U).index,he.prevReachedMinPanes=0,O[0]<U&&this.panes.forEach((I,g)=>{g>O[0]&&g<=U&&(I.size=I.min,he.prevReachedMinPanes+=I.min)}),he.prevPanesSize=this.sumPrevPanesSize(O[0]),O[0]===void 0)?(he.prevReachedMinPanes=0,this.panes[0].size=this.panes[0].min,this.panes.forEach((I,g)=>{g>0&&g<=U&&(I.size=I.min,he.prevReachedMinPanes+=I.min)}),this.panes[O[1]].size=100-he.prevReachedMinPanes-this.panes[0].min-he.prevPanesSize-he.nextPanesSize,null):w>100-he.nextPanesSize-this.panes[O[1]].min&&(O[1]=this.findNextExpandedPane(U).index,he.nextReachedMinPanes=0,O[1]>U+1&&this.panes.forEach((I,g)=>{g>U&&g<O[1]&&(I.size=I.min,he.nextReachedMinPanes+=I.min)}),he.nextPanesSize=this.sumNextPanesSize(O[1]-1),O[1]===void 0)?(he.nextReachedMinPanes=0,this.panes[this.panesCount-1].size=this.panes[this.panesCount-1].min,this.panes.forEach((I,g)=>{g<this.panesCount-1&&g>=U+1&&(I.size=I.min,he.nextReachedMinPanes+=I.min)}),this.panes[O[0]].size=100-he.prevPanesSize-he.nextReachedMinPanes-this.panes[this.panesCount-1].min-he.nextPanesSize,null):{sums:he,panesToResize:O}},sumPrevPanesSize(he){return this.panes.reduce((w,U,O)=>w+(O<he?U.size:0),0)},sumNextPanesSize(he){return this.panes.reduce((w,U,O)=>w+(O>he+1?U.size:0),0)},findPrevExpandedPane(he){return[...this.panes].reverse().find(U=>U.index<he&&U.size>U.min)||{}},findNextExpandedPane(he){return this.panes.find(U=>U.index>he+1&&U.size>U.min)||{}},checkSplitpanesNodes(){Array.from(this.container.children).forEach(w=>{const U=w.classList.contains("splitpanes__pane"),O=w.classList.contains("splitpanes__splitter");if(!U&&!O){w.parentNode.removeChild(w),console.warn("Splitpanes: Only <pane> elements are allowed at the root of <splitpanes>. One of your DOM nodes was removed.");return}})},addSplitter(he,w,U=!1){const O=he-1,I=document.createElement("div");I.classList.add("splitpanes__splitter"),U||(I.onmousedown=g=>this.onMouseDown(g,O),typeof window!="undefined"&&"ontouchstart"in window&&(I.ontouchstart=g=>this.onMouseDown(g,O)),I.onclick=g=>this.onSplitterClick(g,O+1)),this.dblClickSplitter&&(I.ondblclick=g=>this.onSplitterDblClick(g,O+1)),w.parentNode.insertBefore(I,w)},removeSplitter(he){he.onmousedown=void 0,he.onclick=void 0,he.ondblclick=void 0,he.parentNode.removeChild(he)},redoSplitters(){const he=Array.from(this.container.children);he.forEach(U=>{U.className.includes("splitpanes__splitter")&&this.removeSplitter(U)});let w=0;he.forEach(U=>{U.className.includes("splitpanes__pane")&&(!w&&this.firstSplitter?this.addSplitter(w,U,!0):w&&this.addSplitter(w,U),w++)})},requestUpdate(he){var w=he,{target:U}=w,O=__objRest(w,["target"]);const I=this.indexedPanes[U._.uid];Object.entries(O).forEach(([g,a])=>I[g]=a)},onPaneAdd(he){let w=-1;Array.from(he.$el.parentNode.children).some(I=>(I.className.includes("splitpanes__pane")&&w++,I===he.$el));const U=parseFloat(he.minSize),O=parseFloat(he.maxSize);this.panes.splice(w,0,{id:he._.uid,index:w,min:isNaN(U)?0:U,max:isNaN(O)?100:O,size:he.size===null?null:parseFloat(he.size),givenSize:he.size,update:he.update}),this.panes.forEach((I,g)=>I.index=g),this.ready&&this.$nextTick(()=>{this.redoSplitters(),this.resetPaneSizes({addedPane:this.panes[w]}),this.$emit("pane-add",{index:w,panes:this.panes.map(I=>({min:I.min,max:I.max,size:I.size}))})})},onPaneRemove(he){const w=this.panes.findIndex(O=>O.id===he._.uid),U=this.panes.splice(w,1)[0];this.panes.forEach((O,I)=>O.index=I),this.$nextTick(()=>{this.redoSplitters(),this.resetPaneSizes({removedPane:__spreadProps(__spreadValues({},U),{index:w})}),this.$emit("pane-remove",{removed:U,panes:this.panes.map(O=>({min:O.min,max:O.max,size:O.size}))})})},resetPaneSizes(he={}){!he.addedPane&&!he.removedPane?this.initialPanesSizing():this.panes.some(w=>w.givenSize!==null||w.min||w.max<100)?this.equalizeAfterAddOrRemove(he):this.equalize(),this.ready&&this.$emit("resized",this.panes.map(w=>({min:w.min,max:w.max,size:w.size})))},equalize(){const he=100/this.panesCount;let w=0,U=[],O=[];this.panes.forEach(I=>{I.size=Math.max(Math.min(he,I.max),I.min),w-=I.size,I.size>=I.max&&U.push(I.id),I.size<=I.min&&O.push(I.id)}),w>.1&&this.readjustSizes(w,U,O)},initialPanesSizing(){100/this.panesCount;let he=100,w=[],U=[],O=0;this.panes.forEach(g=>{he-=g.size,g.size!==null&&O++,g.size>=g.max&&w.push(g.id),g.size<=g.min&&U.push(g.id)});let I=100;he>.1&&(this.panes.forEach(g=>{g.size===null&&(g.size=Math.max(Math.min(he/(this.panesCount-O),g.max),g.min)),I-=g.size}),I>.1&&this.readjustSizes(he,w,U))},equalizeAfterAddOrRemove({addedPane:he,removedPane:w}={}){let U=100/this.panesCount,O=0,I=[],g=[];he&&he.givenSize!==null&&(U=(100-he.givenSize)/(this.panesCount-1)),this.panes.forEach(a=>{O-=a.size,a.size>=a.max&&I.push(a.id),a.size<=a.min&&g.push(a.id)}),!(Math.abs(O)<.1)&&(this.panes.forEach(a=>{he&&he.givenSize!==null&&he.id===a.id||(a.size=Math.max(Math.min(U,a.max),a.min)),O-=a.size,a.size>=a.max&&I.push(a.id),a.size<=a.min&&g.push(a.id)}),O>.1&&this.readjustSizes(O,I,g))},readjustSizes(he,w,U){let O;he>0?O=he/(this.panesCount-w.length):O=he/(this.panesCount-U.length),this.panes.forEach((I,g)=>{if(he>0&&!w.includes(I.id)){const a=Math.max(Math.min(I.size+O,I.max),I.min);he-=a-I.size,I.size=a}else if(!U.includes(I.id)){const a=Math.max(Math.min(I.size+O,I.max),I.min);he-=a-I.size,I.size=a}I.update({[this.horizontal?"height":"width"]:`${this.indexedPanes[I.id].size}%`})}),Math.abs(he)>.1&&this.$nextTick(()=>{this.ready&&console.warn("Splitpanes: Could not resize panes correctly due to their constraints.")})}},watch:{panes:{deep:!0,immediate:!1,handler(){this.updatePaneComponents()}},horizontal(){this.updatePaneComponents()},firstSplitter(){this.redoSplitters()},dblClickSplitter(he){[...this.container.querySelectorAll(".splitpanes__splitter")].forEach((U,O)=>{U.ondblclick=he?I=>this.onSplitterDblClick(I,O):void 0})}},beforeUnmount(){this.ready=!1},mounted(){this.container=this.$refs.container,this.checkSplitpanesNodes(),this.redoSplitters(),this.resetPaneSizes(),this.$emit("ready"),this.ready=!0},render(){return h("div",{ref:"container",class:["splitpanes",`splitpanes--${this.horizontal?"horizontal":"vertical"}`,{"splitpanes--dragging":this.touch.dragging}]},this.$slots.default())}};var _export_sfc=(he,w)=>{const U=he.__vccOpts||he;for(const[O,I]of w)U[O]=I;return U};const _sfc_main$2={name:"pane",inject:["requestUpdate","onPaneAdd","onPaneRemove","onPaneClick"],props:{size:{type:[Number,String],default:null},minSize:{type:[Number,String],default:0},maxSize:{type:[Number,String],default:100}},data:()=>({style:{}}),mounted(){this.onPaneAdd(this)},beforeUnmount(){this.onPaneRemove(this)},methods:{update(he){this.style=he}},computed:{sizeNumber(){return this.size||this.size===0?parseFloat(this.size):null},minSizeNumber(){return parseFloat(this.minSize)},maxSizeNumber(){return parseFloat(this.maxSize)}},watch:{sizeNumber(he){this.requestUpdate({target:this,size:he})},minSizeNumber(he){this.requestUpdate({target:this,min:he})},maxSizeNumber(he){this.requestUpdate({target:this,max:he})}}};function _sfc_render(he,w,U,O,I,g){return openBlock(),createElementBlock("div",{class:"splitpanes__pane",onClick:w[0]||(w[0]=a=>g.onPaneClick(a,he._.uid)),style:normalizeStyle(he.style)},[renderSlot(he.$slots,"default")],4)}var pane=_export_sfc(_sfc_main$2,[["render",_sfc_render]]),splitpanes="",TaskInfo_vue_vue_type_style_index_0_lang="";const _hoisted_1$1=createTextVNode("Submit"),_sfc_main$1=defineComponent({setup(he){let w=inject("show"),U=computed(()=>w.value==1||w.value==2?100:50);function O(){return w.value!=2}function I(){return w.value!=1}let g=computed(()=>w.value==1?100:w.value==2?0:20),a=computed(()=>w.value==1?0:w.value==2?100:20);const l=reactive({widgetList:[{type:"static-text",icon:"static-text",formItemFlag:!1,options:{name:"statictext111193",columnWidth:"200px",hidden:!1,textContent:"\u5355\u5217\u8868\u5355",customClass:[],onCreated:"",onMounted:"",label:"static-text"},id:"statictext111193"},{type:"divider",icon:"divider",formItemFlag:!1,options:{name:"divider102346",label:"",columnWidth:"200px",direction:"horizontal",contentPosition:"center",hidden:!1,customClass:[],onCreated:"",onMounted:""},id:"divider102346"},{type:"input",icon:"text-field",formItemFlag:!0,options:{name:"input12931",label:"\u53D1\u4EF6\u4EBA\u59D3\u540D",labelAlign:"",type:"text",defaultValue:"",placeholder:"",columnWidth:"200px",size:"",labelWidth:null,labelHidden:!1,readonly:!1,disabled:!1,hidden:!1,clearable:!0,showPassword:!1,required:!0,validation:"",validationHint:"",customClass:[],labelIconClass:null,labelIconPosition:"rear",labelTooltip:null,minLength:null,maxLength:null,showWordLimit:!1,prefixIcon:"",suffixIcon:"",appendButton:!1,appendButtonDisabled:!1,buttonIcon:"el-icon-search",onCreated:"",onMounted:"",onInput:"",onChange:"",onFocus:"",onBlur:"",onValidate:""},id:"input12931"},{type:"switch",icon:"switch-field",formItemFlag:!0,options:{name:"switch96070",label:"\u662F\u5426\u4FDD\u5BC6",labelAlign:"",defaultValue:!0,columnWidth:"200px",labelWidth:null,labelHidden:!1,disabled:!1,hidden:!1,customClass:"",labelIconClass:null,labelIconPosition:"rear",labelTooltip:null,switchWidth:40,activeText:"",inactiveText:"",activeColor:null,inactiveColor:null,onCreated:"",onMounted:"",onChange:"",onValidate:""},id:"switch96070"},{type:"input",icon:"text-field",formItemFlag:!0,options:{name:"input23031",label:"\u53D1\u4EF6\u4EBA\u53F7\u7801",labelAlign:"",type:"text",defaultValue:"",placeholder:"",columnWidth:"200px",size:"",labelWidth:null,labelHidden:!1,readonly:!1,disabled:!1,hidden:!1,clearable:!0,showPassword:!1,required:!0,validation:"",validationHint:"",customClass:"",labelIconClass:null,labelIconPosition:"rear",labelTooltip:null,minLength:null,maxLength:null,showWordLimit:!1,prefixIcon:"",suffixIcon:"",appendButton:!1,appendButtonDisabled:!1,buttonIcon:"el-icon-search",onCreated:"",onMounted:"",onInput:"",onChange:"",onFocus:"",onBlur:"",onValidate:""},id:"input23031"},{type:"textarea",icon:"textarea-field",formItemFlag:!0,options:{name:"textarea21654",label:"\u53D1\u4EF6\u4EBA\u5730\u5740",labelAlign:"",rows:3,defaultValue:"",placeholder:"",columnWidth:"200px",size:"",labelWidth:null,labelHidden:!1,readonly:!1,disabled:!1,hidden:!1,required:!0,validation:"",validationHint:"",customClass:"",labelIconClass:null,labelIconPosition:"rear",labelTooltip:null,minLength:null,maxLength:null,showWordLimit:!1,onCreated:"",onMounted:"",onInput:"",onChange:"",onFocus:"",onBlur:"",onValidate:""},id:"textarea21654"},{type:"divider",icon:"divider",formItemFlag:!1,options:{name:"divider69240",label:"",columnWidth:"200px",direction:"horizontal",contentPosition:"center",hidden:!1,customClass:"",onCreated:"",onMounted:""},id:"divider69240"},{type:"input",icon:"text-field",formItemFlag:!0,options:{name:"input113152",label:"\u6536\u4EF6\u4EBA\u59D3\u540D",labelAlign:"",type:"text",defaultValue:"",placeholder:"",columnWidth:"200px",size:"",labelWidth:null,labelHidden:!1,readonly:!1,disabled:!1,hidden:!1,clearable:!0,showPassword:!1,required:!0,validation:"",validationHint:"",customClass:[],labelIconClass:null,labelIconPosition:"rear",labelTooltip:null,minLength:null,maxLength:null,showWordLimit:!1,prefixIcon:"",suffixIcon:"",appendButton:!1,appendButtonDisabled:!1,buttonIcon:"el-icon-search",onCreated:"",onMounted:"",onInput:"",onChange:"",onFocus:"",onBlur:"",onValidate:""},id:"input113152"},{type:"input",icon:"text-field",formItemFlag:!0,options:{name:"input40240",label:"\u6536\u4EF6\u4EBA\u53F7\u7801",labelAlign:"",type:"text",defaultValue:"",placeholder:"",columnWidth:"200px",size:"",labelWidth:null,labelHidden:!1,readonly:!1,disabled:!1,hidden:!1,clearable:!0,showPassword:!1,required:!0,validation:"",validationHint:"",customClass:"",labelIconClass:null,labelIconPosition:"rear",labelTooltip:null,minLength:null,maxLength:null,showWordLimit:!1,prefixIcon:"",suffixIcon:"",appendButton:!1,appendButtonDisabled:!1,buttonIcon:"el-icon-search",onCreated:"",onMounted:"",onInput:"",onChange:"",onFocus:"",onBlur:"",onValidate:""},id:"input40240"},{type:"input",icon:"text-field",formItemFlag:!0,options:{name:"input78584",label:"\u6536\u4EF6\u4EBA\u5730\u5740",labelAlign:"",type:"text",defaultValue:"",placeholder:"",columnWidth:"200px",size:"",labelWidth:null,labelHidden:!1,readonly:!1,disabled:!1,hidden:!1,clearable:!0,showPassword:!1,required:!0,validation:"",validationHint:"",customClass:"",labelIconClass:null,labelIconPosition:"rear",labelTooltip:null,minLength:null,maxLength:null,showWordLimit:!1,prefixIcon:"",suffixIcon:"",appendButton:!1,appendButtonDisabled:!1,buttonIcon:"el-icon-search",onCreated:"",onMounted:"",onInput:"",onChange:"",onFocus:"",onBlur:"",onValidate:""},id:"input78584"},{type:"divider",icon:"divider",formItemFlag:!1,options:{name:"divider75887",label:"",columnWidth:"200px",direction:"horizontal",contentPosition:"center",hidden:!1,customClass:[],onCreated:"",onMounted:""},id:"divider75887"},{type:"slider",icon:"slider-field",formItemFlag:!0,options:{name:"slider54714",label:"\u4EF7\u683C\u4FDD\u62A4",labelAlign:"",columnWidth:"200px",size:"",labelWidth:null,labelHidden:!1,disabled:!1,hidden:!1,required:!1,validation:"",validationHint:"",customClass:[],labelIconClass:null,labelIconPosition:"rear",labelTooltip:null,min:0,max:100,step:10,range:!1,height:null,onCreated:"",onMounted:"",onChange:"",onValidate:"",showStops:!0},id:"slider54714"},{type:"textarea",icon:"textarea-field",formItemFlag:!0,options:{name:"textarea64794",label:"\u5176\u4ED6\u4FE1\u606F",labelAlign:"",rows:3,defaultValue:"",placeholder:"",columnWidth:"200px",size:"",labelWidth:null,labelHidden:!1,readonly:!1,disabled:!1,hidden:!1,required:!1,validation:"",validationHint:"",customClass:"",labelIconClass:null,labelIconPosition:"rear",labelTooltip:null,minLength:null,maxLength:null,showWordLimit:!1,onCreated:"",onMounted:"",onInput:"",onChange:"",onFocus:"",onBlur:"",onValidate:""},id:"textarea64794"}],formConfig:{modelName:"formData",refName:"vForm",rulesName:"rules",labelWidth:150,labelPosition:"left",size:"",labelAlign:"label-right-align",cssCode:"",customClass:[],functions:"",layoutType:"PC",jsonVersion:3,onFormCreated:"",onFormMounted:"",onFormDataChange:""}}),n=reactive({}),u=reactive({}),v=ref(null),_=()=>{v.value.getFormData().then(b=>{alert(JSON.stringify(b))}).catch(b=>{ElMessage.error(b)})};return(b,M)=>{const P=resolveComponent("v-form-render"),C=resolveComponent("el-button"),L=resolveComponent("el-scrollbar");return openBlock(),createElementBlock("div",null,[createVNode(unref(_sfc_main$1$1),{class:"default-theme"},{default:withCtx(()=>[withDirectives(createVNode(unref(pane),{size:unref(U),"min-size":unref(g)},{default:withCtx(()=>[createVNode(L,{height:"80vh"},{default:withCtx(()=>[createVNode(P,{"form-json":unref(l),"form-data":unref(n),"option-data":unref(u),ref_key:"vFormRef",ref:v},null,8,["form-json","form-data","option-data"]),createVNode(C,{type:"primary",onClick:_},{default:withCtx(()=>[_hoisted_1$1]),_:1})]),_:1})]),_:1},8,["size","min-size"]),[[vShow,O()]]),withDirectives(createVNode(unref(pane),{size:unref(U),"min-size":unref(a)},{default:withCtx(()=>[createVNode(unref(Blueprint))]),_:1},8,["size","min-size"]),[[vShow,I()]])]),_:1})])}}});var vjmap_min$1={exports:{}};(function(module,exports){(function(he,w){module.exports=w()})(window,function(){return function(he){var w={};function U(O){if(w[O])return w[O].exports;var I=w[O]={i:O,l:!1,exports:{}};return he[O].call(I.exports,I,I.exports,U),I.l=!0,I.exports}return U.m=he,U.c=w,U.d=function(O,I,g){U.o(O,I)||Object.defineProperty(O,I,{enumerable:!0,get:g})},U.r=function(O){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(O,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(O,"__esModule",{value:!0})},U.t=function(O,I){if(1&I&&(O=U(O)),8&I||4&I&&typeof O=="object"&&O&&O.__esModule)return O;var g=Object.create(null);if(U.r(g),Object.defineProperty(g,"default",{enumerable:!0,value:O}),2&I&&typeof O!="string")for(var a in O)U.d(g,a,function(l){return O[l]}.bind(null,a));return g},U.n=function(O){var I=O&&O.__esModule?function(){return O.default}:function(){return O};return U.d(I,"a",I),I},U.o=function(O,I){return Object.prototype.hasOwnProperty.call(O,I)},U.p="",U(U.s=60)}([function(he,w,U){var O=this&&this.__createBinding||(Object.create?function(g,a,l,n){n===void 0&&(n=l),Object.defineProperty(g,n,{enumerable:!0,get:function(){return a[l]}})}:function(g,a,l,n){n===void 0&&(n=l),g[n]=a[l]}),I=this&&this.__exportStar||function(g,a){for(var l in g)l==="default"||a.hasOwnProperty(l)||O(a,g,l)};Object.defineProperty(w,"__esModule",{value:!0}),I(U(65),w),I(U(35),w),I(U(66),w),I(U(67),w),I(U(68),w),I(U(94),w),I(U(95),w),I(U(96),w),I(U(97),w)},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.geoPoint=w.GeoPoint=void 0;class O{constructor(g,a,l){this.x=g,this.y=a,this.z=l}static convert(g){if(g instanceof O)return g.clone();if(Array.isArray(g)){if(g.length===2)return new O(Number(g[0]),Number(g[1]));if(g.length>2)return new O(Number(g[0]),Number(g[1]),Number(g[2]))}if(!Array.isArray(g)&&typeof g=="object"&&g!==null)return"lat"in g?new O(Number("lng"in g?g.lng:g.lon),Number(g.lat)):new O(Number(g.x),Number(g.y));throw new Error("`GeoPointLike` argument must be specified as a GeoPoint instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [x, y, z?]")}static fromString(g){let a=(g=g!=null?g:"").split(",");if(a.length==2)return new O(+a[0],+a[1]);if(a.length>=3)return new O(+a[0],+a[1],+a[2]);throw Error("param is not string format x,y")}clone(){return new O(this.x,this.y,this.z)}_add(g){return this.x+=g.x,this.y+=g.y,g.z!==void 0&&this.z!==void 0&&(this.z+=g.z),this}toArray(){const g=[this.x,this.y];return this.z!==void 0&&g.push(this.z),g}toString(g=6){let a=`${this.x.toFixed(g)}, ${this.y.toFixed(g)}`;return this.z&&(a+=", "+this.z.toFixed(g)),a}round(g=6){const a=1/Math.pow(10,g),l=this.clone();return l.x=Math.round(l.x/a)*a,l.y=Math.round(l.y/a)*a,l.z&&(l.y=Math.round(l.z/a)*a),l}roundStr(g=6){return this.round(g).toString(g)}add(g){return this.clone()._add(g)}_sub(g){return this.x-=g.x,this.y-=g.y,g.z!==void 0&&this.z!==void 0&&(this.z-=g.z),this}sub(g){return this.clone()._sub(g)}lengthSq(){return this.z!==void 0?Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z):Math.sqrt(this.x*this.x+this.y*this.y)}_multByPoint(g){return this.x*=g.x,this.y*=g.y,g.z!==void 0&&this.z!==void 0&&(this.z*=g.y),this}multByPoint(g){return this.clone()._multByPoint(g)}_divByPoint(g){return this.x/=g.x,this.y/=g.y,g.z!==void 0&&this.z!==void 0&&(this.z/=g.y),this}divByPoint(g){return this.clone()._divByPoint(g)}dot(g){return this.z!==void 0&&g.z!==void 0?this.x*g.x+this.y*g.y+this.z*g.z:this.x*g.x+this.y*g.y}lerp(g,a){return this.x+=(g.x-this.x)*a,this.y+=(g.y-this.y)*a,this.z!==void 0&&g.z!==void 0&&(this.z+=(g.z-this.z)*a),this}_mult(g){return this.x*=g,this.y*=g,this.z!==void 0&&(this.z*=g),this}mult(g){return this.clone()._mult(g)}_div(g){return this.x/=g,this.y/=g,this.z!==void 0&&(this.z/=g),this}div(g){return this.clone()._div(g)}_rotate(g){const a=Math.cos(g),l=Math.sin(g),n=a*this.x-l*this.y,u=l*this.x+a*this.y;return this.x=n,this.y=u,this}rotate(g){return this.clone()._rotate(g)}_rotateAround(g,a){const l=Math.cos(g),n=Math.sin(g),u=a.x+l*(this.x-a.x)-n*(this.y-a.y),v=a.y+n*(this.x-a.x)+l*(this.y-a.y);return this.x=u,this.y=v,this}roateAround(g,a){return this.clone()._rotateAround(g,a)}_matMult(g){const a=g[0]*this.x+g[1]*this.y,l=g[2]*this.x+g[3]*this.y;return this.x=a,this.y=l,this}matMult(g){return this.clone()._matMult(g)}_unit(){return this.div(this.mag()),this}unit(){return this.clone()._unit()}_perp(){const g=this.y;return this.y=this.x,this.x=-g,this}perp(){return this.clone()._perp()}_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundInt(){return this.clone()._round()}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}equals(g,a=8){const l=1/Math.pow(10,a);return Math.abs(this.x-g.x)<=l&&Math.abs(this.y-g.y)<=l}equalsZ(g){return this.x===g.x&&this.y===g.y&&this.z===g.z}distanceTo(g){return Math.sqrt(this.distSqr(g))}distSqr(g){const a=g.x-this.x,l=g.y-this.y;return a*a+l*l}angle(){return Math.atan2(this.y,this.x)}angleTo(g){return Math.atan2(this.y-g.y,this.x-g.x)}angleWith(g){return this.angleWithSep(g.x,g.y)}angleWithSep(g,a){return Math.atan2(this.x*a-this.y*g,this.x*g+this.y*a)}}w.GeoPoint=O,w.geoPoint=function(I){return O.convert(I)}},function(he,w,U){var O=this&&this.__createBinding||(Object.create?function(g,a,l,n){n===void 0&&(n=l),Object.defineProperty(g,n,{enumerable:!0,get:function(){return a[l]}})}:function(g,a,l,n){n===void 0&&(n=l),g[n]=a[l]}),I=this&&this.__exportStar||function(g,a){for(var l in g)l==="default"||a.hasOwnProperty(l)||O(a,g,l)};Object.defineProperty(w,"__esModule",{value:!0}),I(U(1),w),I(U(10),w),I(U(11),w),I(U(9),w),I(U(75),w),I(U(76),w),I(U(12),w),I(U(77),w),I(U(17),w),I(U(18),w),I(U(13),w),I(U(36),w),I(U(78),w),I(U(79),w),I(U(80),w),I(U(81),w),I(U(82),w),I(U(83),w),I(U(84),w),I(U(85),w),I(U(88),w)},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbEntity=void 0,w.DbEntity=class{constructor(O={}){this.typename||(this.typename="DbEntity")}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbDimension=void 0;const O=U(3);class I extends O.DbEntity{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbDimension"}}w.DbDimension=I},function(he,w,U){(function(O){he.exports=function(){var I,g,a;function l(n,u){if(I)if(g){var v="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.vjmaps.com/vjmaps-gl-js/api/#transpiling-v2'); }; var sharedChunk = {}; ("+I+")(sharedChunk); ("+g+")(sharedChunk); self.onerror = null;",_={};I(_),a=u(_),typeof window!="undefined"&&(a.workerUrl=window.URL.createObjectURL(new Blob([v],{type:"text/javascript"})))}else g=u;else I=u}return l(0,function(n){var u="2.0.0",v=_;function _(r,e,i,o){this.cx=3*r,this.bx=3*(i-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=o,this.p2x=i,this.p2y=o}_.prototype.sampleCurveX=function(r){return((this.ax*r+this.bx)*r+this.cx)*r},_.prototype.sampleCurveY=function(r){return((this.ay*r+this.by)*r+this.cy)*r},_.prototype.sampleCurveDerivativeX=function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},_.prototype.solveCurveX=function(r,e){var i,o,c,m,y;for(e===void 0&&(e=1e-6),c=r,y=0;y<8;y++){if(m=this.sampleCurveX(c)-r,Math.abs(m)<e)return c;var T=this.sampleCurveDerivativeX(c);if(Math.abs(T)<1e-6)break;c-=m/T}if((c=r)<(i=0))return i;if(c>(o=1))return o;for(;i<o;){if(m=this.sampleCurveX(c),Math.abs(m-r)<e)return c;r>m?i=c:o=c,c=.5*(o-i)+i}return c},_.prototype.solve=function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))};var b=M;function M(r,e){this.x=r,this.y=e}M.prototype={clone:function(){return new M(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,i=r.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),i=Math.sin(r),o=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=o,this},_rotateAround:function(r,e){var i=Math.cos(r),o=Math.sin(r),c=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},M.convert=function(r){return r instanceof M?r:Array.isArray(r)?new M(r[0],r[1]):r};var P=typeof self!="undefined"?self:{};const C=Math.pow(2,53)-1,L=Math.PI/180,D=180/Math.PI;function F(r){return r*L}const j=[[0,0],[1,0],[1,1],[0,1]];function K(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,i=e*r;return 4*(r<.5?i:3*(r-e)+i-.75)}function ee(r,e,i,o){const c=new v(r,e,i,o);return function(m){return c.solve(m)}}const Q=ee(.25,.1,.25,1);function le(r,e,i){return Math.min(i,Math.max(e,r))}function pe(r,e,i){const o=i-e,c=((r-e)%o+o)%o+e;return c===e?i:c}function de(r,e,i){if(!r.length)return i(null,[]);let o=r.length;const c=new Array(r.length);let m=null;r.forEach((y,T)=>{e(y,(A,R)=>{A&&(m=A),c[T]=R,--o==0&&i(m,c)})})}function Ee(r){const e=[];for(const i in r)e.push(r[i]);return e}function Pe(r,...e){for(const i of e)for(const o in i)r[o]=i[o];return r}let Je=1;function xt(){return Je++}function vt(){return function r(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()}function ct(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function Rt(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)}function Pt(r,e){r.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function nn(r,e){return r.indexOf(e,r.length-e.length)!==-1}function mn(r,e,i){const o={};for(const c in r)o[c]=e.call(i||this,r[c],c,r);return o}function cn(r,e,i){const o={};for(const c in r)e.call(i||this,r[c],c,r)&&(o[c]=r[c]);return o}function ht(r){return Array.isArray(r)?r.map(ht):typeof r=="object"&&r?mn(r,ht):r}const un={};function rn(r){un[r]||(typeof console!="undefined"&&console.warn(r),un[r]=!0)}function wn(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function An(r){let e=0;for(let i,o,c=0,m=r.length,y=m-1;c<m;y=c++)i=r[c],o=r[y],e+=(o.x-i.x)*(i.y+o.y);return e}function dn(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Lr(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,c,m)=>{const y=c||m;return e[o]=!y||y.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let oi,kn,xi,co=null;function uo(r){if(co==null){const e=r.navigator?r.navigator.userAgent:null;co=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return co}function zi(r){try{const e=P[r];return e.setItem("_vjmaps_test_",1),e.removeItem("_vjmaps_test_"),!0}catch{return!1}}const Dr={now:()=>xi!==void 0?xi:P.performance.now(),setNow(r){xi=r},restoreNow(){xi=void 0},frame(r){const e=P.requestAnimationFrame(r);return{cancel:()=>P.cancelAnimationFrame(e)}},getImageData(r,e=0){const i=P.document.createElement("canvas"),o=i.getContext("2d");if(!o)throw new Error("failed to create canvas 2d context");return i.width=r.width,i.height=r.height,o.drawImage(r,0,0,r.width,r.height),o.getImageData(-e,-e,r.width+2*e,r.height+2*e)},resolveURL:r=>(oi||(oi=P.document.createElement("a")),oi.href=r,oi.href),get devicePixelRatio(){return P.devicePixelRatio},get prefersReducedMotion(){return!!P.matchMedia&&(kn==null&&(kn=P.matchMedia("(prefers-reduced-motion: reduce)")),kn.matches)}};let Eo;const Dn={API_URL:"https://vjmap.com     ",get API_URL_REGEX(){if(Eo==null){const r=/^((https?:)?\/\/)?([^\/]+\.)?vjmaps\.c(n|om)(\/|\?|$)/i;try{Eo=O.env.API_URL_REGEX!=null?new RegExp(O.env.API_URL_REGEX):r}catch{Eo=r}}return Eo},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.vjmap.com")===0?"https://events.vjmap.com/events/v2":this.API_URL.indexOf("https://vjmap.com     ")===0?"https://events.vjmap.com/events/v2 ":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:" https://apps.vjmap.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Hi={supported:!1,testSupport:function(r){!si&&Mr&&(pi?In(r):Oi=r)}};let Oi,Mr,si=!1,pi=!1;function In(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,Mr),r.isContextLost())return;Hi.supported=!0}catch{}r.deleteTexture(e),si=!0}P.document&&(Mr=P.document.createElement("img"),Mr.onload=function(){Oi&&In(Oi),Oi=null,pi=!0},Mr.onerror=function(){si=!0,Oi=null},Mr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const tr="01",Fi="NO_ACCESS_TOKEN";function $r(r){return r.indexOf("vjmaps:")===0}function Xi(r){return Dn.API_URL_REGEX.test(r)}const Vr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function gr(r){const e=r.match(Vr);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ei(r){const e=r.params.length?"?"+r.params.join("&"):"";return`${r.protocol}://${r.authority}${r.path}${e}`}function ho(r){if(!r)return null;const e=r.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(P.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ji{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=ho(Dn.ACCESS_TOKEN);let o="";return o=i&&i.u?P.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(c,m)=>String.fromCharCode(Number("0x"+m)))):Dn.ACCESS_TOKEN||"",e?`vjmaps.eventData.${e}:${o}`:"vjmaps.eventData:"+o}fetchEventData(){const e=zi("localStorage"),i=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{const c=P.localStorage.getItem(i);c&&(this.eventData=JSON.parse(c));const m=P.localStorage.getItem(o);m&&(this.anonId=m)}catch{rn("Unable to read from LocalStorage")}}saveEventData(){const e=zi("localStorage"),i=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{P.localStorage.setItem(o,this.anonId),Object.keys(this.eventData).length>=1&&P.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{rn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,o,c){if(!Dn.EVENTS_URL)return;const m=gr(Dn.EVENTS_URL);m.params.push("access_token="+(c||Dn.ACCESS_TOKEN||""));const y={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"vjmaps-gl-js",sdkVersion:u,skuId:tr,userId:this.anonId},T=i?Pe(y,i):y,A={url:ei(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([T])};this.pendingRequest=Ie(A,R=>{this.pendingRequest=null,o(R),this.saveEventData(),this.processRequests(c)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const Ki=new class extends Ji{constructor(r){super("appUserTurnstile"),this._customAccessToken=r}postTurnstileEvent(r,e){Dn.EVENTS_URL&&Dn.ACCESS_TOKEN&&Array.isArray(r)&&r.some(i=>$r(i)||Xi(i))&&this.queueRequest(Date.now(),e)}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=ho(Dn.ACCESS_TOKEN),i=e?e.u:Dn.ACCESS_TOKEN;let o=i!==this.eventData.tokenU;Rt(this.anonId)||(this.anonId=vt(),o=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),y=new Date(c),T=(c-this.eventData.lastSuccess)/864e5;o=o||T>=1||T<-1||m.getDate()!==y.getDate()}else o=!0;if(!o)return this.processRequests();this.postEvent(c,{"enabled.telemetry":!1},m=>{m||(this.eventData.lastSuccess=c,this.eventData.tokenU=i)},r)}},Io=Ki.postTurnstileEvent.bind(Ki),jo=new class extends Ji{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(r,e,i,o){this.skuToken=e,this.errorCb=o,Dn.EVENTS_URL&&(i||Dn.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},i):this.errorCb(new Error(Fi)))}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Rt(this.anonId)||(this.anonId=vt()),this.postEvent(i,{skuToken:this.skuToken},o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},r))}},we=jo.postMapLoadEvent.bind(jo),Oe=new class extends Ji{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(r,e,i,o){if(!Dn.API_URL||!Dn.SESSION_PATH)return;const c=gr(Dn.API_URL+Dn.SESSION_PATH);c.params.push("sku="+(e||"")),c.params.push("access_token="+(o||Dn.ACCESS_TOKEN||""));const m={url:ei(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Ue(m,y=>{this.pendingRequest=null,i(y),this.saveEventData(),this.processRequests(o)})}getSessionAPI(r,e,i,o){this.skuToken=e,this.errorCb=o,Dn.SESSION_PATH&&Dn.API_URL&&(i||Dn.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},i):this.errorCb(new Error(Fi)))}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},r)}},ke=Oe.getSessionAPI.bind(Oe),dt=new Set,mt="vjmaps-tiles";let Dt,Bt,Vt=500,Ft=50;function kt(){P.caches&&!Dt&&(Dt=P.caches.open(mt))}function Qt(r){const e=r.indexOf("?");return e<0?r:r.slice(0,e)}let Sn=1/0;const Mn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Mn);class ve extends Error{constructor(e,i,o){i===401&&Xi(o)&&(e+=": you may have provided an invalid vjmaps access token. See  https://www.vjmap.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const X=dn()?()=>self.worker&&self.worker.referrer:()=>(P.location.protocol==="blob:"?P.parent:P).location.href,te=function(r,e){if(!(/^file:/.test(i=r.url)||/^file:/.test(X())&&!/^\w+:/.test(i))){if(P.fetch&&P.Request&&P.AbortController&&P.Request.prototype.hasOwnProperty("signal"))return function(o,c){const m=new P.AbortController,y=new P.Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:X(),signal:m.signal});let T=!1,A=!1;const R=(N=y.url).indexOf("sku=")>0&&Xi(N);var N;o.type==="json"&&y.headers.set("Accept","application/json");const q=(Y,oe,be)=>{if(A)return;if(Y&&Y.message!=="SecurityError"&&rn(Y),oe&&be)return W(oe);const Ce=Date.now();P.fetch(y).then(Fe=>{if(Fe.ok){const Ze=R?Fe.clone():null;return W(Fe,Ze,Ce)}return c(new ve(Fe.statusText,Fe.status,o.url))}).catch(Fe=>{Fe.code!==20&&c(new Error(Fe.message))})},W=(Y,oe,be)=>{(o.type==="arrayBuffer"?Y.arrayBuffer():o.type==="json"?Y.json():Y.text()).then(Ce=>{A||(oe&&be&&function(Fe,Ze,Ye){if(kt(),!Dt)return;const ot={status:Ze.status,statusText:Ze.statusText,headers:new P.Headers};Ze.headers.forEach((at,Ot)=>ot.headers.set(Ot,at));const st=Lr(Ze.headers.get("Cache-Control")||"");st["no-store"]||(st["max-age"]&&ot.headers.set("Expires",new Date(Ye+1e3*st["max-age"]).toUTCString()),new Date(ot.headers.get("Expires")).getTime()-Ye<42e4||function(at,Ot){if(Bt===void 0)try{new Response(new ReadableStream),Bt=!0}catch{Bt=!1}Bt?Ot(at.body):at.blob().then(Ot)}(Ze,at=>{const Ot=new P.Response(at,ot);kt(),Dt&&Dt.then(At=>At.put(Qt(Fe.url),Ot)).catch(At=>rn(At.message))}))}(y,oe,be),T=!0,c(null,Ce,Y.headers.get("Cache-Control"),Y.headers.get("Expires")))}).catch(Ce=>{A||c(new Error(Ce.message))})};return R?function(Y,oe){if(kt(),!Dt)return oe(null);const be=Qt(Y.url);Dt.then(Ce=>{Ce.match(be).then(Fe=>{const Ze=function(Ye){if(!Ye)return!1;const ot=new Date(Ye.headers.get("Expires")||0),st=Lr(Ye.headers.get("Cache-Control")||"");return ot>Date.now()&&!st["no-cache"]}(Fe);Ce.delete(be),Ze&&Ce.put(be,Fe.clone()),oe(null,Fe,Ze)}).catch(oe)}).catch(oe)}(y,q):q(null,null),{cancel:()=>{A=!0,T||m.abort()}}}(r,e);if(dn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var i;return function(o,c){const m=new P.XMLHttpRequest;m.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const y in o.headers)m.setRequestHeader(y,o.headers[y]);return o.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=o.credentials==="include",m.onerror=()=>{c(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let y=m.response;if(o.type==="json")try{y=JSON.parse(m.response)}catch(T){return c(T)}c(null,y,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else c(new ve(m.statusText,m.status,o.url))},m.send(o.body),{cancel:()=>m.abort()}}(r,e)},xe=function(r,e){return te(Pe(r,{type:"arrayBuffer"}),e)},Ie=function(r,e){return te(Pe(r,{method:"POST"}),e)},Ue=function(r,e){return te(Pe(r,{method:"GET"}),e)};function Qe(r){const e=P.document.createElement("a");return e.href=r,e.protocol===P.document.location.protocol&&e.host===P.document.location.host}const Ke="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ve,et;Ve=[],et=0;const gt=function(r,e){if(Hi.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),et>=Dn.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ve.push(m),m}et++;let i=!1;const o=()=>{if(!i)for(i=!0,et--;Ve.length&&et<Dn.MAX_PARALLEL_IMAGE_REQUESTS;){const m=Ve.shift(),{requestParameters:y,callback:T,cancelled:A}=m;A||(m.cancel=gt(y,T).cancel)}},c=xe(r,(m,y,T,A)=>{o(),m?e(m):y&&(P.createImageBitmap?function(R,N){const q=new P.Blob([new Uint8Array(R)],{type:"image/png"});P.createImageBitmap(q).then(W=>{N(null,W)}).catch(W=>{N(new Error(`Could not load image because of ${W.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(R,N)=>e(R,N,T,A)):function(R,N){const q=new P.Image,W=P.URL;q.onload=()=>{N(null,q),W.revokeObjectURL(q.src),q.onload=null,P.requestAnimationFrame(()=>{q.src=Ke})},q.onerror=()=>N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Y=new P.Blob([new Uint8Array(R)],{type:"image/png"});q.src=R.byteLength?W.createObjectURL(Y):Ke}(y,(R,N)=>e(R,N,T,A)))});return{cancel:()=>{c.cancel(),o()}}};function jt(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function yt(r,e,i){if(i&&i[r]){const o=i[r].indexOf(e);o!==-1&&i[r].splice(o,1)}}class Xt{constructor(e,i={}){Pe(this,i),this.type=e}}class sn extends Xt{constructor(e,i={}){super("error",Pe({error:e},i))}}class Kt{on(e,i){return this._listeners=this._listeners||{},jt(e,i,this._listeners),this}off(e,i){return yt(e,i,this._listeners),yt(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},jt(e,i,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,i){typeof e=="string"&&(e=new Xt(e,i||{}));const o=e.type;if(this.listens(o)){e.target=this;const c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const T of c)T.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const T of m)yt(o,T,this._oneTimeListeners),T.call(this,e);const y=this._eventedParent;y&&(Pe(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof sn&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var je={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},vjmaps:{}},default:"vjmaps"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class ft{constructor(e,i,o,c){this.message=(e?e+": ":"")+o,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}function Zn(r){const e=r.value;return e?[new ft(r.key,e,"constants have been deprecated as of v8")]:[]}function Bn(r,...e){for(const i of e)for(const o in i)r[o]=i[o];return r}function bn(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function jn(r){if(Array.isArray(r))return r.map(jn);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=jn(r[i]);return e}return bn(r)}class Pr extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class bi{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,c]of i)this.bindings[o]=c}concat(e){return new bi(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const zr={kind:"null"},$t={kind:"number"},On={kind:"string"},Ln={kind:"boolean"},yr={kind:"color"},wi={kind:"object"},zn={kind:"value"},ts={kind:"collator"},Yi={kind:"formatted"},Si={kind:"resolvedImage"};function wr(r,e){return{kind:"array",itemType:r,N:e}}function hr(r){if(r.kind==="array"){const e=hr(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const Qs=[zr,$t,On,Ln,yr,Yi,wi,wr(zn),Si];function To(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!To(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of Qs)if(!To(i,e))return null}}return`Expected ${hr(r)} but found ${hr(e)} instead.`}function po(r,e){return e.some(i=>i.kind===r.kind)}function ns(r,e){return e.some(i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r)}function Mi(r){var e={exports:{}};return r(e,e.exports),e.exports}var Wr=Mi(function(r,e){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o(T){return(T=Math.round(T))<0?0:T>255?255:T}function c(T){return o(T[T.length-1]==="%"?parseFloat(T)/100*255:parseInt(T))}function m(T){return(A=T[T.length-1]==="%"?parseFloat(T)/100:parseFloat(T))<0?0:A>1?1:A;var A}function y(T,A,R){return R<0?R+=1:R>1&&(R-=1),6*R<1?T+(A-T)*R*6:2*R<1?A:3*R<2?T+(A-T)*(2/3-R)*6:T}try{e.parseCSSColor=function(T){var A,R=T.replace(/ /g,"").toLowerCase();if(R in i)return i[R].slice();if(R[0]==="#")return R.length===4?(A=parseInt(R.substr(1),16))>=0&&A<=4095?[(3840&A)>>4|(3840&A)>>8,240&A|(240&A)>>4,15&A|(15&A)<<4,1]:null:R.length===7&&(A=parseInt(R.substr(1),16))>=0&&A<=16777215?[(16711680&A)>>16,(65280&A)>>8,255&A,1]:null;var N=R.indexOf("("),q=R.indexOf(")");if(N!==-1&&q+1===R.length){var W=R.substr(0,N),Y=R.substr(N+1,q-(N+1)).split(","),oe=1;switch(W){case"rgba":if(Y.length!==4)return null;oe=m(Y.pop());case"rgb":return Y.length!==3?null:[c(Y[0]),c(Y[1]),c(Y[2]),oe];case"hsla":if(Y.length!==4)return null;oe=m(Y.pop());case"hsl":if(Y.length!==3)return null;var be=(parseFloat(Y[0])%360+360)%360/360,Ce=m(Y[1]),Fe=m(Y[2]),Ze=Fe<=.5?Fe*(Ce+1):Fe+Ce-Fe*Ce,Ye=2*Fe-Ze;return[o(255*y(Ye,Ze,be+1/3)),o(255*y(Ye,Ze,be)),o(255*y(Ye,Ze,be-1/3)),oe];default:return null}}return null}}catch{}});class $n{constructor(e,i,o,c=1){this.r=e,this.g=i,this.b=o,this.a=c}static parse(e){if(!e)return;if(e instanceof $n)return e;if(typeof e!="string")return;const i=Wr.parseCSSColor(e);return i?new $n(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,o,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(o)},${c})`}toArray(){const{r:e,g:i,b:o,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*i/c,255*o/c,c]}}$n.black=new $n(0,0,0,1),$n.white=new $n(1,1,1,1),$n.transparent=new $n(0,0,0,0),$n.red=new $n(1,0,0,1),$n.blue=new $n(0,0,1,1);class Uo{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class rs{constructor(e,i,o,c,m){this.text=e,this.image=i,this.scale=o,this.fontStack=c,this.textColor=m}}class Hr{constructor(e){this.sections=e}static fromString(e){return new Hr([new rs(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Hr?e:Hr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(o)}return e}}class ai{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ai({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Ms(r,e,i,o){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[r,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[r,e,i,o]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function _r(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof $n||r instanceof Uo||r instanceof Hr||r instanceof ai)return!0;if(Array.isArray(r)){for(const e of r)if(!_r(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!_r(r[e]))return!1;return!0}return!1}function vr(r){if(r===null)return zr;if(typeof r=="string")return On;if(typeof r=="boolean")return Ln;if(typeof r=="number")return $t;if(r instanceof $n)return yr;if(r instanceof Uo)return ts;if(r instanceof Hr)return Yi;if(r instanceof ai)return Si;if(Array.isArray(r)){const e=r.length;let i;for(const o of r){const c=vr(o);if(i){if(i===c)continue;i=zn;break}i=c}return wr(i||zn,e)}return wi}function Es(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof $n||r instanceof Hr||r instanceof ai?r.toString():JSON.stringify(r)}class qr{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!_r(e[1]))return i.error("invalid value");const o=e[1];let c=vr(o);const m=i.expectedType;return c.kind!=="array"||c.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(c=m),new qr(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof $n?["rgba"].concat(this.value.toArray()):this.value instanceof Hr?this.value.serialize():this.value}}class nr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Is={string:On,number:$t,boolean:Ln,object:wi};class xr{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,c=1;const m=e[0];if(m==="array"){let T,A;if(e.length>2){const R=e[1];if(typeof R!="string"||!(R in Is)||R==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);T=Is[R],c++}else T=zn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);A=e[2],c++}o=wr(T,A)}else o=Is[m];const y=[];for(;c<e.length;c++){const T=i.parse(e[c],c,zn);if(!T)return null;y.push(T)}return new xr(o,y)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!To(this.type,vr(o)))return o;if(i===this.args.length-1)throw new nr(`Expected value to be of type ${hr(this.type)}, but found ${hr(vr(o))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&i.push(c)}}return i.concat(this.args.map(o=>o.serialize()))}}class li{constructor(e){this.type=Yi,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const c=[];let m=!1;for(let y=1;y<=e.length-1;++y){const T=e[y];if(m&&typeof T=="object"&&!Array.isArray(T)){m=!1;let A=null;if(T["font-scale"]&&(A=i.parse(T["font-scale"],1,$t),!A))return null;let R=null;if(T["text-font"]&&(R=i.parse(T["text-font"],1,wr(On)),!R))return null;let N=null;if(T["text-color"]&&(N=i.parse(T["text-color"],1,yr),!N))return null;const q=c[c.length-1];q.scale=A,q.font=R,q.textColor=N}else{const A=i.parse(e[y],1,zn);if(!A)return null;const R=A.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,c.push({content:A,scale:null,font:null,textColor:null})}}return new li(c)}evaluate(e){return new Hr(this.sections.map(i=>{const o=i.content.evaluate(e);return vr(o)===Si?new rs("",o,null,null,null):new rs(Es(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),e.push(o)}return e}}class Ri{constructor(e){this.type=Si,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const o=i.parse(e[1],1,On);return o?new Ri(o):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),o=ai.fromString(i);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(i)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Sl={"to-boolean":Ln,"to-color":yr,"to-number":$t,"to-string":On};class Po{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0];if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");const c=Sl[o],m=[];for(let y=1;y<e.length;y++){const T=i.parse(e[y],y,zn);if(!T)return null;m.push(T)}return new Po(c,m)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let i,o;for(const c of this.args){if(i=c.evaluate(e),o=null,i instanceof $n)return i;if(typeof i=="string"){const m=e.parseColor(i);if(m)return m}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Ms(i[0],i[1],i[2],i[3]),!o))return new $n(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new nr(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const c=Number(i);if(!isNaN(c))return c}throw new nr(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Hr.fromString(Es(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ai.fromString(Es(this.args[0].evaluate(e))):Es(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new li([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ri(this.args[0]).serialize();const e=["to-"+this.type.kind];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Ya=["Unknown","Point","LineString","Polygon"];class is{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ya[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=$n.parse(e)),i}}class Ei{constructor(e,i,o,c){this.name=e,this.type=i,this._evaluate=o,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const o=e[0],c=Ei.definitions[o];if(!c)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(c)?c[0]:c.type,y=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,T=y.filter(([R])=>!Array.isArray(R)||R.length===e.length-1);let A=null;for(const[R,N]of T){A=new As(i.registry,i.path,null,i.scope);const q=[];let W=!1;for(let Y=1;Y<e.length;Y++){const oe=e[Y],be=Array.isArray(R)?R[Y-1]:R.type,Ce=A.parse(oe,1+q.length,be);if(!Ce){W=!0;break}q.push(Ce)}if(!W)if(Array.isArray(R)&&R.length!==q.length)A.error(`Expected ${R.length} arguments, but found ${q.length} instead.`);else{for(let Y=0;Y<q.length;Y++){const oe=Array.isArray(R)?R[Y]:R.type,be=q[Y];A.concat(Y+1).checkSubtype(oe,be.type)}if(A.errors.length===0)return new Ei(o,m,N,q)}}if(T.length===1)i.errors.push(...A.errors);else{const R=(T.length?T:y).map(([q])=>{return W=q,Array.isArray(W)?`(${W.map(hr).join(", ")})`:`(${hr(W.type)}...)`;var W}).join(" | "),N=[];for(let q=1;q<e.length;q++){const W=i.parse(e[q],1+N.length);if(!W)return null;N.push(hr(W.type))}i.error(`Expected arguments of type ${R}, but found (${N.join(", ")}) instead.`)}return null}static register(e,i){Ei.definitions=i;for(const o in i)e[o]=Ei}}class ea{constructor(e,i,o){this.type=ts,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const c=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Ln);if(!c)return null;const m=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Ln);if(!m)return null;let y=null;return o.locale&&(y=i.parse(o.locale,1,On),!y)?null:new ea(c,m,y)}evaluate(e){return new Uo(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Co=8192;function Ii(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function os(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function Ml(r,e){const i=(180+r[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(i*c*Co),Math.round(o*c*Co)]}function ta(r,e,i){const o=r[0]-e[0],c=r[1]-e[1],m=r[0]-i[0],y=r[1]-i[1];return o*y-m*c==0&&o*m<=0&&c*y<=0}function fi(r,e){let i=!1;for(let y=0,T=e.length;y<T;y++){const A=e[y];for(let R=0,N=A.length;R<N-1;R++){if(ta(r,A[R],A[R+1]))return!1;(c=A[R])[1]>(o=r)[1]!=(m=A[R+1])[1]>o[1]&&o[0]<(m[0]-c[0])*(o[1]-c[1])/(m[1]-c[1])+c[0]&&(i=!i)}}var o,c,m;return i}function Pa(r,e){for(let i=0;i<e.length;i++)if(fi(r,e[i]))return!0;return!1}function na(r,e,i,o){const c=o[0]-i[0],m=o[1]-i[1],y=(r[0]-i[0])*m-c*(r[1]-i[1]),T=(e[0]-i[0])*m-c*(e[1]-i[1]);return y>0&&T<0||y<0&&T>0}function Ca(r,e,i){for(const R of i)for(let N=0;N<R.length-1;++N)if((T=[(y=R[N+1])[0]-(m=R[N])[0],y[1]-m[1]])[0]*(A=[(c=e)[0]-(o=r)[0],c[1]-o[1]])[1]-T[1]*A[0]!=0&&na(o,c,m,y)&&na(m,y,o,c))return!0;var o,c,m,y,T,A;return!1}function Ts(r,e){for(let i=0;i<r.length;++i)if(!fi(r[i],e))return!1;for(let i=0;i<r.length-1;++i)if(Ca(r[i],r[i+1],e))return!1;return!0}function Bi(r,e){for(let i=0;i<e.length;i++)if(Ts(r,e[i]))return!0;return!1}function Ps(r,e,i){const o=[];for(let c=0;c<r.length;c++){const m=[];for(let y=0;y<r[c].length;y++){const T=Ml(r[c][y],i);Ii(e,T),m.push(T)}o.push(m)}return o}function ra(r,e,i){const o=[];for(let c=0;c<r.length;c++){const m=Ps(r[c],e,i);o.push(m)}return o}function ss(r,e,i,o){if(r[0]<i[0]||r[0]>i[2]){const c=.5*o;let m=r[0]-i[0]>c?-o:i[0]-r[0]>c?o:0;m===0&&(m=r[0]-i[2]>c?-o:i[2]-r[0]>c?o:0),r[0]+=m}Ii(e,r)}function Ao(r,e,i,o){const c=Math.pow(2,o.z)*Co,m=[o.x*Co,o.y*Co],y=[];for(const T of r)for(const A of T){const R=[A.x+m[0],A.y+m[1]];ss(R,e,i,c),y.push(R)}return y}function ia(r,e,i,o){const c=Math.pow(2,o.z)*Co,m=[o.x*Co,o.y*Co],y=[];for(const A of r){const R=[];for(const N of A){const q=[N.x+m[0],N.y+m[1]];Ii(e,q),R.push(q)}y.push(R)}if(e[2]-e[0]<=c/2){(T=e)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const A of y)for(const R of A)ss(R,e,i,c)}var T;return y}class ji{constructor(e,i){this.type=Ln,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(_r(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let c=0;c<o.features.length;++c){const m=o.features[c].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new ji(o,o.features[c].geometry)}else if(o.type==="Feature"){const c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new ji(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new ji(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=i.canonicalID();if(o.type==="Polygon"){const T=Ps(o.coordinates,m,y),A=Ao(i.geometry(),c,m,y);if(!os(c,m))return!1;for(const R of A)if(!fi(R,T))return!1}if(o.type==="MultiPolygon"){const T=ra(o.coordinates,m,y),A=Ao(i.geometry(),c,m,y);if(!os(c,m))return!1;for(const R of A)if(!Pa(R,T))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=i.canonicalID();if(o.type==="Polygon"){const T=Ps(o.coordinates,m,y),A=ia(i.geometry(),c,m,y);if(!os(c,m))return!1;for(const R of A)if(!Ts(R,T))return!1}if(o.type==="MultiPolygon"){const T=ra(o.coordinates,m,y),A=ia(i.geometry(),c,m,y);if(!os(c,m))return!1;for(const R of A)if(!Bi(R,T))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Cs(r){if(r instanceof Ei&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof ji)return!1;let e=!0;return r.eachChild(i=>{e&&!Cs(i)&&(e=!1)}),e}function Nn(r){if(r instanceof Ei&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(i=>{e&&!Nn(i)&&(e=!1)}),e}function fo(r,e){if(r instanceof Ei&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild(o=>{i&&!fo(o,e)&&(i=!1)}),i}class mo{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new mo(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class As{constructor(e,i=[],o,c=new bi,m=[]){this.registry=e,this.path=i,this.key=i.map(y=>`[${y}]`).join(""),this.scope=c,this.errors=m,this.expectedType=o}parse(e,i,o,c,m={}){return i?this.concat(i,o,c)._parse(e,m):this._parse(e,m)}_parse(e,i){function o(c,m,y){return y==="assert"?new xr(m,[c]):y==="coerce"?new Po(m,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[c];if(m){let y=m.parse(e,this);if(!y)return null;if(this.expectedType){const T=this.expectedType,A=y.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||A.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||A.kind!=="value"&&A.kind!=="string"){if(this.checkSubtype(T,A))return null}else y=o(y,T,i.typeAnnotation||"coerce");else y=o(y,T,i.typeAnnotation||"assert")}if(!(y instanceof qr)&&y.type.kind!=="resolvedImage"&&function T(A){if(A instanceof mo)return T(A.boundExpression);if(A instanceof Ei&&A.name==="error"||A instanceof ea||A instanceof ji)return!1;const R=A instanceof Po||A instanceof xr;let N=!0;return A.eachChild(q=>{N=R?N&&T(q):N&&q instanceof qr}),!!N&&Cs(A)&&fo(A,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script"])}(y)){const T=new is;try{y=new qr(y.type,y.evaluate(T))}catch(A){return this.error(A.message),null}}return y}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o){const c=typeof e=="number"?this.path.concat(e):this.path,m=o?this.scope.concat(o):this.scope;return new As(this.registry,c,i||null,m,this.errors)}error(e,...i){const o=`${this.key}${i.map(c=>`[${c}]`).join("")}`;this.errors.push(new Pr(o,e))}checkSubtype(e,i){const o=To(e,i);return o&&this.error(o),o}}function as(r,e){const i=r.length-1;let o,c,m=0,y=i,T=0;for(;m<=y;)if(T=Math.floor((m+y)/2),o=r[T],c=r[T+1],o<=e){if(T===i||e<c)return T;m=T+1}else{if(!(o>e))throw new nr("Input is not a number.");y=T-1}return 0}class Ui{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[c,m]of o)this.labels.push(c),this.outputs.push(m)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,$t);if(!o)return null;const c=[];let m=null;i.expectedType&&i.expectedType.kind!=="value"&&(m=i.expectedType);for(let y=1;y<e.length;y+=2){const T=y===1?-1/0:e[y],A=e[y+1],R=y,N=y+1;if(typeof T!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(c.length&&c[c.length-1][0]>=T)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const q=i.parse(A,N,m);if(!q)return null;m=m||q.type,c.push([T,q])}return new Ui(m,o,c)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return o[0].evaluate(e);const m=i.length;return c>=i[m-1]?o[m-1].evaluate(e):o[as(i,c)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}function Xn(r,e,i){return r*(1-i)+e*i}var Qi=Object.freeze({__proto__:null,number:Xn,color:function(r,e,i){return new $n(Xn(r.r,e.r,i),Xn(r.g,e.g,i),Xn(r.b,e.b,i),Xn(r.a,e.a,i))},array:function(r,e,i){return r.map((o,c)=>Xn(o,e[c],i))}});const ks=6/29*3*(6/29),oa=Math.PI/180,Ni=180/Math.PI;function sa(r){return r>.008856451679035631?Math.pow(r,1/3):r/ks+4/29}function ls(r){return r>6/29?r*r*r:ks*(r-4/29)}function Ls(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function cs(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function ko(r){const e=cs(r.r),i=cs(r.g),o=cs(r.b),c=sa((.4124564*e+.3575761*i+.1804375*o)/.95047),m=sa((.2126729*e+.7151522*i+.072175*o)/1);return{l:116*m-16,a:500*(c-m),b:200*(m-sa((.0193339*e+.119192*i+.9503041*o)/1.08883)),alpha:r.a}}function Qa(r){let e=(r.l+16)/116,i=isNaN(r.a)?e:e+r.a/500,o=isNaN(r.b)?e:e-r.b/200;return e=1*ls(e),i=.95047*ls(i),o=1.08883*ls(o),new $n(Ls(3.2404542*i-1.5371385*e-.4985314*o),Ls(-.969266*i+1.8760108*e+.041556*o),Ls(.0556434*i-.2040259*e+1.0572252*o),r.alpha)}function Aa(r,e,i){const o=e-r;return r+i*(o>180||o<-180?o-360*Math.round(o/360):o)}const No={forward:ko,reverse:Qa,interpolate:function(r,e,i){return{l:Xn(r.l,e.l,i),a:Xn(r.a,e.a,i),b:Xn(r.b,e.b,i),alpha:Xn(r.alpha,e.alpha,i)}}},go={forward:function(r){const{l:e,a:i,b:o}=ko(r),c=Math.atan2(o,i)*Ni;return{h:c<0?c+360:c,c:Math.sqrt(i*i+o*o),l:e,alpha:r.a}},reverse:function(r){const e=r.h*oa,i=r.c;return Qa({l:r.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:r.alpha})},interpolate:function(r,e,i){return{h:Aa(r.h,e.h,i),c:Xn(r.c,e.c,i),l:Xn(r.l,e.l,i),alpha:Xn(r.alpha,e.alpha,i)}}};var ka=Object.freeze({__proto__:null,lab:No,hcl:go});class Er{constructor(e,i,o,c,m){this.type=e,this.operator=i,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(const[y,T]of m)this.labels.push(y),this.outputs.push(T)}static interpolationFactor(e,i,o,c){let m=0;if(e.name==="exponential")m=mi(i,e.base,o,c);else if(e.name==="linear")m=mi(i,1,o,c);else if(e.name==="cubic-bezier"){const y=e.controlPoints;m=new v(y[0],y[1],y[2],y[3]).solve(mi(i,1,o,c))}return m}static parse(e,i){let[o,c,m,...y]=e;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const R=c[1];if(typeof R!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:R}}else{if(c[0]!=="cubic-bezier")return i.error("Unknown interpolation type "+String(c[0]),1,0);{const R=c.slice(1);if(R.length!==4||R.some(N=>typeof N!="number"||N<0||N>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:R}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(m=i.parse(m,2,$t),!m)return null;const T=[];let A=null;o==="interpolate-hcl"||o==="interpolate-lab"?A=yr:i.expectedType&&i.expectedType.kind!=="value"&&(A=i.expectedType);for(let R=0;R<y.length;R+=2){const N=y[R],q=y[R+1],W=R+3,Y=R+4;if(typeof N!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',W);if(T.length&&T[T.length-1][0]>=N)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',W);const oe=i.parse(q,Y,A);if(!oe)return null;A=A||oe.type,T.push([N,oe])}return A.kind==="number"||A.kind==="color"||A.kind==="array"&&A.itemType.kind==="number"&&typeof A.N=="number"?new Er(A,o,c,m,T):i.error(`Type ${hr(A)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return o[0].evaluate(e);const m=i.length;if(c>=i[m-1])return o[m-1].evaluate(e);const y=as(i,c),T=Er.interpolationFactor(this.interpolation,c,i[y],i[y+1]),A=o[y].evaluate(e),R=o[y+1].evaluate(e);return this.operator==="interpolate"?Qi[this.type.kind.toLowerCase()](A,R,T):this.operator==="interpolate-hcl"?go.reverse(go.interpolate(go.forward(A),go.forward(R),T)):No.reverse(No.interpolate(No.forward(A),No.forward(R),T))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function mi(r,e,i,o){const c=o-i,m=r-i;return c===0?0:e===1?m/c:(Math.pow(e,m)-1)/(Math.pow(e,c)-1)}class eo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null;const c=i.expectedType;c&&c.kind!=="value"&&(o=c);const m=[];for(const T of e.slice(1)){const A=i.parse(T,1+m.length,o,void 0,{typeAnnotation:"omit"});if(!A)return null;o=o||A.type,m.push(A)}const y=c&&m.some(T=>To(c,T.type));return new eo(y?zn:o,m)}evaluate(e){let i,o=null,c=0;for(const m of this.args)if(c++,o=m.evaluate(e),o&&o instanceof ai&&!o.available&&(i||(i=o.name),o=null,c===this.args.length&&(o=i)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Ds{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let m=1;m<e.length-1;m+=2){const y=e[m];if(typeof y!="string")return i.error(`Expected string, but found ${typeof y} instead.`,m);if(/[^a-zA-Z0-9_]/.test(y))return i.error("Variable names must contain only alphanumeric characters or '_'.",m);const T=i.parse(e[m+1],m+1);if(!T)return null;o.push([y,T])}const c=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return c?new Ds(o,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,o]of this.bindings)e.push(i,o.serialize());return e.push(this.result.serialize()),e}}class La{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,$t),c=i.parse(e[2],2,wr(i.expectedType||zn));return o&&c?new La(c.type.itemType,o,c):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new nr(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new nr(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new nr(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class us{constructor(e,i){this.type=Ln,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,zn),c=i.parse(e[2],2,zn);return o&&c?po(o.type,[Ln,On,$t,zr,zn])?new us(o,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${hr(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!ns(i,["boolean","string","number","null"]))throw new nr(`Expected first argument to be of type boolean, string, number or null, but found ${hr(vr(i))} instead.`);if(!ns(o,["string","array"]))throw new nr(`Expected second argument to be of type array or string, but found ${hr(vr(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ti{constructor(e,i,o){this.type=$t,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,zn),c=i.parse(e[2],2,zn);if(!o||!c)return null;if(!po(o.type,[Ln,On,$t,zr,zn]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${hr(o.type)} instead`);if(e.length===4){const m=i.parse(e[3],3,$t);return m?new Ti(o,c,m):null}return new Ti(o,c)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!ns(i,["boolean","string","number","null"]))throw new nr(`Expected first argument to be of type boolean, string, number or null, but found ${hr(vr(i))} instead.`);if(!ns(o,["string","array"]))throw new nr(`Expected second argument to be of type array or string, but found ${hr(vr(o))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return o.indexOf(i,c)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Da{constructor(e,i,o,c,m,y){this.inputType=e,this.type=i,this.input=o,this.cases=c,this.outputs=m,this.otherwise=y}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const m={},y=[];for(let R=2;R<e.length-1;R+=2){let N=e[R];const q=e[R+1];Array.isArray(N)||(N=[N]);const W=i.concat(R);if(N.length===0)return W.error("Expected at least one branch label.");for(const oe of N){if(typeof oe!="number"&&typeof oe!="string")return W.error("Branch labels must be numbers or strings.");if(typeof oe=="number"&&Math.abs(oe)>Number.MAX_SAFE_INTEGER)return W.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof oe=="number"&&Math.floor(oe)!==oe)return W.error("Numeric branch labels must be integer values.");if(o){if(W.checkSubtype(o,vr(oe)))return null}else o=vr(oe);if(m[String(oe)]!==void 0)return W.error("Branch labels must be unique.");m[String(oe)]=y.length}const Y=i.parse(q,R,c);if(!Y)return null;c=c||Y.type,y.push(Y)}const T=i.parse(e[1],1,zn);if(!T)return null;const A=i.parse(e[e.length-1],e.length-1,c);return A?T.type.kind!=="value"&&i.concat(1).checkSubtype(o,T.type)?null:new Da(o,c,T,m,y,A):null}evaluate(e){const i=this.input.evaluate(e);return(vr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],c={};for(const y of i){const T=c[this.cases[y]];T===void 0?(c[this.cases[y]]=o.length,o.push([this.cases[y],[y]])):o[T][1].push(y)}const m=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,T]of o)e.push(T.length===1?m(T[0]):T.map(m)),e.push(this.outputs[y].serialize());return e.push(this.otherwise.serialize()),e}}class hs{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const c=[];for(let y=1;y<e.length-1;y+=2){const T=i.parse(e[y],y,Ln);if(!T)return null;const A=i.parse(e[y+1],y+1,o);if(!A)return null;c.push([T,A]),o=o||A.type}const m=i.parse(e[e.length-1],e.length-1,o);return m?new hs(o,c,m):null}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class ds{constructor(e,i,o,c){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=c}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,zn),c=i.parse(e[2],2,$t);if(!o||!c)return null;if(!po(o.type,[wr(zn),On,zn]))return i.error(`Expected first argument to be of type array or string, but found ${hr(o.type)} instead`);if(e.length===4){const m=i.parse(e[3],3,$t);return m?new ds(o.type,o,c,m):null}return new ds(o.type,o,c)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!ns(i,["string","array"]))throw new nr(`Expected first argument to be of type array or string, but found ${hr(vr(i))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return i.slice(o,c)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function zs(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function za(r,e,i,o){return o.compare(e,i)===0}function to(r,e,i){const o=r!=="=="&&r!=="!=";return class Yh{constructor(m,y,T){this.type=Ln,this.lhs=m,this.rhs=y,this.collator=T,this.hasUntypedArgument=m.type.kind==="value"||y.type.kind==="value"}static parse(m,y){if(m.length!==3&&m.length!==4)return y.error("Expected two or three arguments.");const T=m[0];let A=y.parse(m[1],1,zn);if(!A)return null;if(!zs(T,A.type))return y.concat(1).error(`"${T}" comparisons are not supported for type '${hr(A.type)}'.`);let R=y.parse(m[2],2,zn);if(!R)return null;if(!zs(T,R.type))return y.concat(2).error(`"${T}" comparisons are not supported for type '${hr(R.type)}'.`);if(A.type.kind!==R.type.kind&&A.type.kind!=="value"&&R.type.kind!=="value")return y.error(`Cannot compare types '${hr(A.type)}' and '${hr(R.type)}'.`);o&&(A.type.kind==="value"&&R.type.kind!=="value"?A=new xr(R.type,[A]):A.type.kind!=="value"&&R.type.kind==="value"&&(R=new xr(A.type,[R])));let N=null;if(m.length===4){if(A.type.kind!=="string"&&R.type.kind!=="string"&&A.type.kind!=="value"&&R.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(N=y.parse(m[3],3,ts),!N)return null}return new Yh(A,R,N)}evaluate(m){const y=this.lhs.evaluate(m),T=this.rhs.evaluate(m);if(o&&this.hasUntypedArgument){const A=vr(y),R=vr(T);if(A.kind!==R.kind||A.kind!=="string"&&A.kind!=="number")throw new nr(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${A.kind}, ${R.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const A=vr(y),R=vr(T);if(A.kind!=="string"||R.kind!=="string")return e(m,y,T)}return this.collator?i(m,y,T,this.collator.evaluate(m)):e(m,y,T)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[r];return this.eachChild(y=>{m.push(y.serialize())}),m}}}const el=to("==",function(r,e,i){return e===i},za),Os=to("!=",function(r,e,i){return e!==i},function(r,e,i,o){return!za(0,e,i,o)}),aa=to("<",function(r,e,i){return e<i},function(r,e,i,o){return o.compare(e,i)<0}),El=to(">",function(r,e,i){return e>i},function(r,e,i,o){return o.compare(e,i)>0}),tl=to("<=",function(r,e,i){return e<=i},function(r,e,i,o){return o.compare(e,i)<=0}),la=to(">=",function(r,e,i){return e>=i},function(r,e,i,o){return o.compare(e,i)>=0});class Fs{constructor(e,i,o,c,m){this.type=On,this.number=e,this.locale=i,this.currency=o,this.minFractionDigits=c,this.maxFractionDigits=m}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,$t);if(!o)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let m=null;if(c.locale&&(m=i.parse(c.locale,1,On),!m))return null;let y=null;if(c.currency&&(y=i.parse(c.currency,1,On),!y))return null;let T=null;if(c["min-fraction-digits"]&&(T=i.parse(c["min-fraction-digits"],1,$t),!T))return null;let A=null;return c["max-fraction-digits"]&&(A=i.parse(c["max-fraction-digits"],1,$t),!A)?null:new Fs(o,m,y,T,A)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Rs{constructor(e){this.type=$t,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${hr(o.type)} instead.`):new Rs(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new nr(`Expected value to be of type string or array, but found ${hr(vr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Go={"==":el,"!=":Os,">":El,"<":aa,">=":la,"<=":tl,array:xr,at:La,boolean:xr,case:hs,coalesce:eo,collator:ea,format:li,image:Ri,in:us,"index-of":Ti,interpolate:Er,"interpolate-hcl":Er,"interpolate-lab":Er,length:Rs,let:Ds,literal:qr,match:Da,number:xr,"number-format":Fs,object:xr,slice:ds,step:Ui,string:xr,"to-boolean":Po,"to-color":Po,"to-number":Po,"to-string":Po,var:mo,within:ji};function ca(r,[e,i,o,c]){e=e.evaluate(r),i=i.evaluate(r),o=o.evaluate(r);const m=c?c.evaluate(r):1,y=Ms(e,i,o,m);if(y)throw new nr(y);return new $n(e/255*m,i/255*m,o/255*m,m)}function Oa(r,e){return r in e}function Vo(r,e){const i=e[r];return i===void 0?null:i}function yo(r){return{type:r}}function ua(r){return{result:"success",value:r}}function no(r){return{result:"error",value:r}}function qo(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function ha(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Bs(r){return!!r.expression&&r.expression.interpolated}function Wn(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Lo(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function da(r){return r}function ps(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function nl(r,e,i,o,c){return ps(typeof i===c?o[i]:void 0,r.default,e.default)}function Il(r,e,i){if(Wn(i)!=="number")return ps(r.default,e.default);const o=r.stops.length;if(o===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[o-1][0])return r.stops[o-1][1];const c=as(r.stops.map(m=>m[0]),i);return r.stops[c][1]}function rl(r,e,i){const o=r.base!==void 0?r.base:1;if(Wn(i)!=="number")return ps(r.default,e.default);const c=r.stops.length;if(c===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[c-1][0])return r.stops[c-1][1];const m=as(r.stops.map(N=>N[0]),i),y=function(N,q,W,Y){const oe=Y-W,be=N-W;return oe===0?0:q===1?be/oe:(Math.pow(q,be)-1)/(Math.pow(q,oe)-1)}(i,o,r.stops[m][0],r.stops[m+1][0]),T=r.stops[m][1],A=r.stops[m+1][1];let R=Qi[e.type]||da;if(r.colorSpace&&r.colorSpace!=="rgb"){const N=ka[r.colorSpace];R=(q,W)=>N.reverse(N.interpolate(N.forward(q),N.forward(W),y))}return typeof T.evaluate=="function"?{evaluate(...N){const q=T.evaluate.apply(void 0,N),W=A.evaluate.apply(void 0,N);if(q!==void 0&&W!==void 0)return R(q,W,y)}}:R(T,A,y)}function il(r,e,i){return e.type==="color"?i=$n.parse(i):e.type==="formatted"?i=Hr.fromString(i.toString()):e.type==="resolvedImage"?i=ai.fromString(i.toString()):Wn(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),ps(i,r.default,e.default)}Ei.register(Go,{error:[{kind:"error"},[On],(r,[e])=>{throw new nr(e.evaluate(r))}],typeof:[On,[zn],(r,[e])=>hr(vr(e.evaluate(r)))],"to-rgba":[wr($t,4),[yr],(r,[e])=>e.evaluate(r).toArray()],rgb:[yr,[$t,$t,$t],ca],rgba:[yr,[$t,$t,$t,$t],ca],has:{type:Ln,overloads:[[[On],(r,[e])=>Oa(e.evaluate(r),r.properties())],[[On,wi],(r,[e,i])=>Oa(e.evaluate(r),i.evaluate(r))]]},get:{type:zn,overloads:[[[On],(r,[e])=>Vo(e.evaluate(r),r.properties())],[[On,wi],(r,[e,i])=>Vo(e.evaluate(r),i.evaluate(r))]]},"feature-state":[zn,[On],(r,[e])=>Vo(e.evaluate(r),r.featureState||{})],properties:[wi,[],r=>r.properties()],"geometry-type":[On,[],r=>r.geometryType()],id:[zn,[],r=>r.id()],zoom:[$t,[],r=>r.globals.zoom],"heatmap-density":[$t,[],r=>r.globals.heatmapDensity||0],"line-progress":[$t,[],r=>r.globals.lineProgress||0],"sky-radial-progress":[$t,[],r=>r.globals.skyRadialProgress||0],accumulated:[zn,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[$t,yo($t),(r,e)=>{let i=0;for(const o of e)i+=o.evaluate(r);return i}],"*":[$t,yo($t),(r,e)=>{let i=1;for(const o of e)i*=o.evaluate(r);return i}],"-":{type:$t,overloads:[[[$t,$t],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[$t],(r,[e])=>-e.evaluate(r)]]},"/":[$t,[$t,$t],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[$t,[$t,$t],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[$t,[],()=>Math.LN2],pi:[$t,[],()=>Math.PI],e:[$t,[],()=>Math.E],"^":[$t,[$t,$t],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[$t,[$t],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[$t,[$t],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[$t,[$t],(r,[e])=>Math.log(e.evaluate(r))],log2:[$t,[$t],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[$t,[$t],(r,[e])=>Math.sin(e.evaluate(r))],cos:[$t,[$t],(r,[e])=>Math.cos(e.evaluate(r))],tan:[$t,[$t],(r,[e])=>Math.tan(e.evaluate(r))],asin:[$t,[$t],(r,[e])=>Math.asin(e.evaluate(r))],acos:[$t,[$t],(r,[e])=>Math.acos(e.evaluate(r))],atan:[$t,[$t],(r,[e])=>Math.atan(e.evaluate(r))],min:[$t,yo($t),(r,e)=>Math.min(...e.map(i=>i.evaluate(r)))],max:[$t,yo($t),(r,e)=>Math.max(...e.map(i=>i.evaluate(r)))],abs:[$t,[$t],(r,[e])=>Math.abs(e.evaluate(r))],round:[$t,[$t],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[$t,[$t],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[$t,[$t],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[Ln,[On,zn],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[Ln,[zn],(r,[e])=>r.id()===e.value],"filter-type-==":[Ln,[On],(r,[e])=>r.geometryType()===e.value],"filter-<":[Ln,[On,zn],(r,[e,i])=>{const o=r.properties()[e.value],c=i.value;return typeof o==typeof c&&o<c}],"filter-id-<":[Ln,[zn],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[Ln,[On,zn],(r,[e,i])=>{const o=r.properties()[e.value],c=i.value;return typeof o==typeof c&&o>c}],"filter-id->":[Ln,[zn],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[Ln,[On,zn],(r,[e,i])=>{const o=r.properties()[e.value],c=i.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[Ln,[zn],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[Ln,[On,zn],(r,[e,i])=>{const o=r.properties()[e.value],c=i.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[Ln,[zn],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[Ln,[zn],(r,[e])=>e.value in r.properties()],"filter-has-id":[Ln,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Ln,[wr(On)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[Ln,[wr(zn)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[Ln,[On,wr(zn)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[Ln,[On,wr(zn)],(r,[e,i])=>function(o,c,m,y){for(;m<=y;){const T=m+y>>1;if(c[T]===o)return!0;c[T]>o?y=T-1:m=T+1}return!1}(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Ln,overloads:[[[Ln,Ln],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[yo(Ln),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:Ln,overloads:[[[Ln,Ln],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[yo(Ln),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[Ln,[Ln],(r,[e])=>!e.evaluate(r)],"is-supported-script":[Ln,[On],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[On,[On],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[On,[On],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[On,yo(zn),(r,e)=>e.map(i=>Es(i.evaluate(r))).join("")],"resolved-locale":[On,[ts],(r,[e])=>e.evaluate(r).resolvedLocale()]});class Fa{constructor(e,i){this.expression=e,this._warningHistory={},this._evaluator=new is,this._defaultValue=i?function(o){return o.type==="color"&&Lo(o.default)?new $n(0,0,0,0):o.type==="color"?$n.parse(o.default)||null:o.default===void 0?null:o.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,o,c,m,y){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,c,m,y){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new nr(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console!="undefined"&&console.warn(T.message)),this._defaultValue}}}function js(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Go}function Us(r,e){const i=new As(Go,[],e?function(c){const m={color:yr,string:On,number:$t,enum:On,boolean:Ln,formatted:Yi,resolvedImage:Si};return c.type==="array"?wr(m[c.value]||zn,c.length):m[c.type]}(e):void 0),o=i.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?ua(new Fa(o,e)):no(i.errors)}class fs{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!Nn(i.expression)}evaluateWithoutErrorHandling(e,i,o,c,m,y){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,c,m,y)}evaluate(e,i,o,c,m,y){return this._styleExpression.evaluate(e,i,o,c,m,y)}}class Zo{constructor(e,i,o,c){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Nn(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,i,o,c,m,y){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,c,m,y)}evaluate(e,i,o,c,m,y){return this._styleExpression.evaluate(e,i,o,c,m,y)}interpolationFactor(e,i,o){return this.interpolationType?Er.interpolationFactor(this.interpolationType,e,i,o):0}}function Ra(r,e){if((r=Us(r,e)).result==="error")return r;const i=r.value.expression,o=Cs(i);if(!o&&!qo(e))return no([new Pr("","data expressions not supported")]);const c=fo(i,["zoom"]);if(!c&&!ha(e))return no([new Pr("","zoom expressions not supported")]);const m=function y(T){let A=null;if(T instanceof Ds)A=y(T.result);else if(T instanceof eo){for(const R of T.args)if(A=y(R),A)break}else(T instanceof Ui||T instanceof Er)&&T.input instanceof Ei&&T.input.name==="zoom"&&(A=T);return A instanceof Pr||T.eachChild(R=>{const N=y(R);N instanceof Pr?A=N:!A&&N?A=new Pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):A&&N&&A!==N&&(A=new Pr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),A}(i);return m||c?m instanceof Pr?no([m]):m instanceof Er&&!Bs(e)?no([new Pr("",'"interpolate" expressions cannot be used with this property')]):ua(m?new Zo(o?"camera":"composite",r.value,m.labels,m instanceof Er?m.interpolation:void 0):new fs(o?"constant":"source",r.value)):no([new Pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ns{constructor(e,i){this._parameters=e,this._specification=i,Bn(this,function o(c,m){const y=m.type==="color",T=c.stops&&typeof c.stops[0][0]=="object",A=T||!(T||c.property!==void 0),R=c.type||(Bs(m)?"exponential":"interval");if(y&&((c=Bn({},c)).stops&&(c.stops=c.stops.map(Y=>[Y[0],$n.parse(Y[1])])),c.default=$n.parse(c.default?c.default:m.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!ka[c.colorSpace])throw new Error("Unknown color space: "+c.colorSpace);let N,q,W;if(R==="exponential")N=rl;else if(R==="interval")N=Il;else if(R==="categorical"){N=nl,q=Object.create(null);for(const Y of c.stops)q[Y[0]]=Y[1];W=typeof c.stops[0][0]}else{if(R!=="identity")throw new Error(`Unknown function type "${R}"`);N=il}if(T){const Y={},oe=[];for(let Fe=0;Fe<c.stops.length;Fe++){const Ze=c.stops[Fe],Ye=Ze[0].zoom;Y[Ye]===void 0&&(Y[Ye]={zoom:Ye,type:c.type,property:c.property,default:c.default,stops:[]},oe.push(Ye)),Y[Ye].stops.push([Ze[0].value,Ze[1]])}const be=[];for(const Fe of oe)be.push([Y[Fe].zoom,o(Y[Fe],m)]);const Ce={name:"linear"};return{kind:"composite",interpolationType:Ce,interpolationFactor:Er.interpolationFactor.bind(void 0,Ce),zoomStops:be.map(Fe=>Fe[0]),evaluate:({zoom:Fe},Ze)=>rl({stops:be,base:c.base},m,Fe).evaluate(Fe,Ze)}}if(A){const Y=R==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:Y,interpolationFactor:Er.interpolationFactor.bind(void 0,Y),zoomStops:c.stops.map(oe=>oe[0]),evaluate:({zoom:oe})=>N(c,m,oe,q,W)}}return{kind:"source",evaluate(Y,oe){const be=oe&&oe.properties?oe.properties[c.property]:void 0;return be===void 0?ps(c.default,m.default):N(c,m,be,q,W)}}}(this._parameters,this._specification))}static deserialize(e){return new Ns(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ir(r){const e=r.key,i=r.value,o=r.valueSpec||{},c=r.objectElementValidators||{},m=r.style,y=r.styleSpec;let T=[];const A=Wn(i);if(A!=="object")return[new ft(e,i,`object expected, ${A} found`)];for(const R in i){const N=R.split(".")[0],q=o[N]||o["*"];let W;if(c[N])W=c[N];else if(o[N])W=Ur;else if(c["*"])W=c["*"];else{if(!o["*"]){T.push(new ft(e,i[R],`unknown property "${R}"`));continue}W=Ur}T=T.concat(W({key:(e&&e+".")+R,value:i[R],valueSpec:q,style:m,styleSpec:y,object:i,objectKey:R},i))}for(const R in o)c[R]||o[R].required&&o[R].default===void 0&&i[R]===void 0&&T.push(new ft(e,i,`missing required property "${R}"`));return T}function pa(r){const e=r.value,i=r.valueSpec,o=r.style,c=r.styleSpec,m=r.key,y=r.arrayElementValidator||Ur;if(Wn(e)!=="array")return[new ft(m,e,`array expected, ${Wn(e)} found`)];if(i.length&&e.length!==i.length)return[new ft(m,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new ft(m,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let T={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum};c.$version<7&&(T.function=i.function),Wn(i.value)==="object"&&(T=i.value);let A=[];for(let R=0;R<e.length;R++)A=A.concat(y({array:e,arrayIndex:R,value:e[R],valueSpec:T,style:o,styleSpec:c,key:`${m}[${R}]`}));return A}function $o(r){const e=r.key,i=r.value,o=r.valueSpec;let c=Wn(i);if(c==="number"&&i!=i&&(c="NaN"),c!=="number")return[new ft(e,i,`number expected, ${c} found`)];if("minimum"in o){let m=o.minimum;if(Wn(o.minimum)==="array"&&(m=o.minimum[r.arrayIndex]),i<m)return[new ft(e,i,`${i} is less than the minimum value ${m}`)]}if("maximum"in o){let m=o.maximum;if(Wn(o.maximum)==="array"&&(m=o.maximum[r.arrayIndex]),i>m)return[new ft(e,i,`${i} is greater than the maximum value ${m}`)]}return[]}function fa(r){const e=r.valueSpec,i=bn(r.value.type);let o,c,m,y={};const T=i!=="categorical"&&r.value.property===void 0,A=!T,R=Wn(r.value.stops)==="array"&&Wn(r.value.stops[0])==="array"&&Wn(r.value.stops[0][0])==="object",N=Ir({key:r.key,value:r.value,valueSpec:r.styleSpec.function,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(Y){if(i==="identity")return[new ft(Y.key,Y.value,'identity function may not have a "stops" property')];let oe=[];const be=Y.value;return oe=oe.concat(pa({key:Y.key,value:be,valueSpec:Y.valueSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:q})),Wn(be)==="array"&&be.length===0&&oe.push(new ft(Y.key,be,"array must have at least one stop")),oe},default:function(Y){return Ur({key:Y.key,value:Y.value,valueSpec:e,style:Y.style,styleSpec:Y.styleSpec})}}});return i==="identity"&&T&&N.push(new ft(r.key,r.value,'missing required property "property"')),i==="identity"||r.value.stops||N.push(new ft(r.key,r.value,'missing required property "stops"')),i==="exponential"&&r.valueSpec.expression&&!Bs(r.valueSpec)&&N.push(new ft(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(A&&!qo(r.valueSpec)?N.push(new ft(r.key,r.value,"property functions not supported")):T&&!ha(r.valueSpec)&&N.push(new ft(r.key,r.value,"zoom functions not supported"))),i!=="categorical"&&!R||r.value.property!==void 0||N.push(new ft(r.key,r.value,'"property" property is required')),N;function q(Y){let oe=[];const be=Y.value,Ce=Y.key;if(Wn(be)!=="array")return[new ft(Ce,be,`array expected, ${Wn(be)} found`)];if(be.length!==2)return[new ft(Ce,be,`array length 2 expected, length ${be.length} found`)];if(R){if(Wn(be[0])!=="object")return[new ft(Ce,be,`object expected, ${Wn(be[0])} found`)];if(be[0].zoom===void 0)return[new ft(Ce,be,"object stop key must have zoom")];if(be[0].value===void 0)return[new ft(Ce,be,"object stop key must have value")];if(m&&m>bn(be[0].zoom))return[new ft(Ce,be[0].zoom,"stop zoom values must appear in ascending order")];bn(be[0].zoom)!==m&&(m=bn(be[0].zoom),c=void 0,y={}),oe=oe.concat(Ir({key:Ce+"[0]",value:be[0],valueSpec:{zoom:{}},style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:$o,value:W}}))}else oe=oe.concat(W({key:Ce+"[0]",value:be[0],valueSpec:{},style:Y.style,styleSpec:Y.styleSpec},be));return js(jn(be[1]))?oe.concat([new ft(Ce+"[1]",be[1],"expressions are not allowed in function stops.")]):oe.concat(Ur({key:Ce+"[1]",value:be[1],valueSpec:e,style:Y.style,styleSpec:Y.styleSpec}))}function W(Y,oe){const be=Wn(Y.value),Ce=bn(Y.value),Fe=Y.value!==null?Y.value:oe;if(o){if(be!==o)return[new ft(Y.key,Fe,`${be} stop domain type must match previous stop domain type ${o}`)]}else o=be;if(be!=="number"&&be!=="string"&&be!=="boolean")return[new ft(Y.key,Fe,"stop domain value must be a number, string, or boolean")];if(be!=="number"&&i!=="categorical"){let Ze=`number expected, ${be} found`;return qo(e)&&i===void 0&&(Ze+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ft(Y.key,Fe,Ze)]}return i!=="categorical"||be!=="number"||isFinite(Ce)&&Math.floor(Ce)===Ce?i!=="categorical"&&be==="number"&&c!==void 0&&Ce<c?[new ft(Y.key,Fe,"stop domain values must appear in ascending order")]:(c=Ce,i==="categorical"&&Ce in y?[new ft(Y.key,Fe,"stop domain values must be unique")]:(y[Ce]=!0,[])):[new ft(Y.key,Fe,"integer expected, found "+Ce)]}}function Wo(r){const e=(r.expressionContext==="property"?Ra:Us)(jn(r.value),r.valueSpec);if(e.result==="error")return e.value.map(o=>new ft(`${r.key}${o.key}`,r.value,o.message));const i=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!i.outputDefined())return[new ft(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Nn(i))return[new ft(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Nn(i))return[new ft(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!fo(i,["zoom","feature-state"]))return[new ft(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Cs(i))return[new ft(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ms(r){const e=r.key,i=r.value,o=r.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(bn(i))===-1&&c.push(new ft(e,i,`expected one of [${o.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(o.values).indexOf(bn(i))===-1&&c.push(new ft(e,i,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(i)} found`)),c}function ro(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!ro(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Ba={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function _o(r){if(r==null)return{filter:()=>!0,needGeometry:!1};ro(r)||(r=Xr(r));const e=Us(r,Ba);if(e.result==="error")throw new Error(e.value.map(i=>`${i.key}: ${i.message}`).join(", "));return{filter:(i,o,c)=>e.value.evaluate(i,o,{},c),needGeometry:gi(r)}}function Gi(r,e){return r<e?-1:r>e?1:0}function gi(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let e=1;e<r.length;e++)if(gi(r[e]))return!0;return!1}function Xr(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?gs(r[1],r[2],"=="):e==="!="?ga(gs(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?gs(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(Xr))):e==="all"?["all"].concat(r.slice(1).map(Xr)):e==="none"?["all"].concat(r.slice(1).map(Xr).map(ga)):e==="in"?Vi(r[1],r.slice(2)):e==="!in"?ga(Vi(r[1],r.slice(2))):e==="has"?ma(r[1]):e==="!has"?ga(ma(r[1])):e!=="within"||r;var i}function gs(r,e,i){switch(r){case"$type":return["filter-type-"+i,e];case"$id":return["filter-id-"+i,e];default:return["filter-"+i,r,e]}}function Vi(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",r,["literal",e.sort(Gi)]]:["filter-in-small",r,["literal",e]]}}function ma(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function ga(r){return["!",r]}function vo(r){return ro(jn(r.value))?Wo(Bn({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function e(i){const o=i.value,c=i.key;if(Wn(o)!=="array")return[new ft(c,o,`array expected, ${Wn(o)} found`)];const m=i.styleSpec;let y,T=[];if(o.length<1)return[new ft(c,o,"filter array must have at least 1 element")];switch(T=T.concat(ms({key:c+"[0]",value:o[0],valueSpec:m.filter_operator,style:i.style,styleSpec:i.styleSpec})),bn(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&bn(o[1])==="$type"&&T.push(new ft(c,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&T.push(new ft(c,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(y=Wn(o[1]),y!=="string"&&T.push(new ft(c+"[1]",o[1],`string expected, ${y} found`)));for(let A=2;A<o.length;A++)y=Wn(o[A]),bn(o[1])==="$type"?T=T.concat(ms({key:`${c}[${A}]`,value:o[A],valueSpec:m.geometry_type,style:i.style,styleSpec:i.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&T.push(new ft(`${c}[${A}]`,o[A],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let A=1;A<o.length;A++)T=T.concat(e({key:`${c}[${A}]`,value:o[A],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":y=Wn(o[1]),o.length!==2?T.push(new ft(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):y!=="string"&&T.push(new ft(c+"[1]",o[1],`string expected, ${y} found`));break;case"within":y=Wn(o[1]),o.length!==2?T.push(new ft(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):y!=="object"&&T.push(new ft(c+"[1]",o[1],`object expected, ${y} found`))}return T}(r)}function yi(r,e){const i=r.key,o=r.style,c=r.styleSpec,m=r.value,y=r.objectKey,T=c[`${e}_${r.layerType}`];if(!T)return[];const A=y.match(/^(.*)-transition$/);if(e==="paint"&&A&&T[A[1]]&&T[A[1]].transition)return Ur({key:i,value:m,valueSpec:c.transition,style:o,styleSpec:c});const R=r.valueSpec||T[y];if(!R)return[new ft(i,m,`unknown property "${y}"`)];let N;if(Wn(m)==="string"&&qo(R)&&!R.tokens&&(N=/^{([^}]+)}$/.exec(m)))return[new ft(i,m,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(N[1])} }\`.`)];const q=[];return r.layerType==="symbol"&&(y==="text-field"&&o&&!o.glyphs&&q.push(new ft(i,m,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&Lo(jn(m))&&bn(m.type)==="identity"&&q.push(new ft(i,m,'"text-font" does not support identity functions'))),q.concat(Ur({key:r.key,value:m,valueSpec:R,style:o,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:y}))}function Gs(r){return yi(r,"paint")}function Do(r){return yi(r,"layout")}function zo(r){let e=[];const i=r.value,o=r.key,c=r.style,m=r.styleSpec;i.type||i.ref||e.push(new ft(o,i,'either "type" or "ref" is required'));let y=bn(i.type);const T=bn(i.ref);if(i.id){const A=bn(i.id);for(let R=0;R<r.arrayIndex;R++){const N=c.layers[R];bn(N.id)===A&&e.push(new ft(o,i.id,`duplicate layer id "${i.id}", previously used at line ${N.id.__line__}`))}}if("ref"in i){let A;["type","source","source-layer","filter","layout"].forEach(R=>{R in i&&e.push(new ft(o,i[R],`"${R}" is prohibited for ref layers`))}),c.layers.forEach(R=>{bn(R.id)===T&&(A=R)}),A?A.ref?e.push(new ft(o,i.ref,"ref cannot reference another ref layer")):y=bn(A.type):e.push(new ft(o,i.ref,`ref layer "${T}" not found`))}else if(y!=="background"&&y!=="sky")if(i.source){const A=c.sources&&c.sources[i.source],R=A&&bn(A.type);A?R==="vector"&&y==="raster"?e.push(new ft(o,i.source,`layer "${i.id}" requires a raster source`)):R==="raster"&&y!=="raster"?e.push(new ft(o,i.source,`layer "${i.id}" requires a vector source`)):R!=="vector"||i["source-layer"]?R==="raster-dem"&&y!=="hillshade"?e.push(new ft(o,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!i.paint||!i.paint["line-gradient"]||R==="geojson"&&A.lineMetrics||e.push(new ft(o,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ft(o,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new ft(o,i.source,`source "${i.source}" not found`))}else e.push(new ft(o,i,'missing required property "source"'));return e=e.concat(Ir({key:o,value:i,valueSpec:m.layer,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ur({key:o+".type",value:i.type,valueSpec:m.layer.type,style:r.style,styleSpec:r.styleSpec,object:i,objectKey:"type"}),filter:vo,layout:A=>Ir({layer:i,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":R=>Do(Bn({layerType:y},R))}}),paint:A=>Ir({layer:i,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":R=>Gs(Bn({layerType:y},R))}})}})),e}function Pi(r){const e=r.value,i=r.key,o=Wn(e);return o!=="string"?[new ft(i,e,`string expected, ${o} found`)]:[]}const Ci={promoteId:function({key:r,value:e}){if(Wn(e)==="string")return Pi({key:r,value:e});{const i=[];for(const o in e)i.push(...Pi({key:`${r}.${o}`,value:e[o]}));return i}}};function ys(r){const e=r.value,i=r.key,o=r.styleSpec,c=r.style;if(!e.type)return[new ft(i,e,'"type" is required')];const m=bn(e.type);let y;switch(m){case"vector":case"raster":case"raster-dem":return y=Ir({key:i,value:e,valueSpec:o["source_"+m.replace("-","_")],style:r.style,styleSpec:o,objectElementValidators:Ci}),y;case"geojson":if(y=Ir({key:i,value:e,valueSpec:o.source_geojson,style:c,styleSpec:o,objectElementValidators:Ci}),e.cluster)for(const T in e.clusterProperties){const[A,R]=e.clusterProperties[T],N=typeof A=="string"?[A,["accumulated"],["get",T]]:A;y.push(...Wo({key:`${i}.${T}.map`,value:R,expressionContext:"cluster-map"})),y.push(...Wo({key:`${i}.${T}.reduce`,value:N,expressionContext:"cluster-reduce"}))}return y;case"video":return Ir({key:i,value:e,valueSpec:o.source_video,style:c,styleSpec:o});case"image":return Ir({key:i,value:e,valueSpec:o.source_image,style:c,styleSpec:o});case"canvas":return[new ft(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ms({key:i+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,styleSpec:o})}}function ti(r){const e=r.value,i=r.styleSpec,o=i.light,c=r.style;let m=[];const y=Wn(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new ft("light",e,`object expected, ${y} found`)]),m;for(const T in e){const A=T.match(/^(.*)-transition$/);m=m.concat(A&&o[A[1]]&&o[A[1]].transition?Ur({key:T,value:e[T],valueSpec:i.transition,style:c,styleSpec:i}):o[T]?Ur({key:T,value:e[T],valueSpec:o[T],style:c,styleSpec:i}):[new ft(T,e[T],`unknown property "${T}"`)])}return m}function _s(r){const e=r.value,i=r.key,o=r.style,c=r.styleSpec,m=c.terrain;let y=[];const T=Wn(e);if(e===void 0)return y;if(T!=="object")return y=y.concat([new ft("terrain",e,`object expected, ${T} found`)]),y;for(const A in e){const R=A.match(/^(.*)-transition$/);y=y.concat(R&&m[R[1]]&&m[R[1]].transition?Ur({key:A,value:e[A],valueSpec:c.transition,style:o,styleSpec:c}):m[A]?Ur({key:A,value:e[A],valueSpec:m[A],style:o,styleSpec:c}):[new ft(A,e[A],`unknown property "${A}"`)])}if(e.source){const A=o.sources&&o.sources[e.source],R=A&&bn(A.type);A?R!=="raster-dem"&&y.push(new ft(i,e.source,`terrain cannot be used with a source of type ${R}, it only be used with a "raster-dem" source type`)):y.push(new ft(i,e.source,`source "${e.source}" not found`))}else y.push(new ft(i,e,'terrain is missing required property "source"'));return y}function Ai(r){const e=r.value,i=r.style,o=r.styleSpec,c=o.fog;let m=[];const y=Wn(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new ft("fog",e,`object expected, ${y} found`)]),m;for(const T in e){const A=T.match(/^(.*)-transition$/);m=m.concat(A&&c[A[1]]&&c[A[1]].transition?Ur({key:T,value:e[T],valueSpec:o.transition,style:i,styleSpec:o}):c[T]?Ur({key:T,value:e[T],valueSpec:c[T],style:i,styleSpec:o}):[new ft(T,e[T],`unknown property "${T}"`)])}return m}const ja={"*":()=>[],array:pa,boolean:function(r){const e=r.value,i=r.key,o=Wn(e);return o!=="boolean"?[new ft(i,e,`boolean expected, ${o} found`)]:[]},number:$o,color:function(r){const e=r.key,i=r.value,o=Wn(i);return o!=="string"?[new ft(e,i,`color expected, ${o} found`)]:Wr.parseCSSColor(i)===null?[new ft(e,i,`color expected, "${i}" found`)]:[]},constants:Zn,enum:ms,filter:vo,function:fa,layer:zo,object:Ir,source:ys,light:ti,terrain:_s,fog:Ai,string:Pi,formatted:function(r){return Pi(r).length===0?[]:Wo(r)},resolvedImage:function(r){return Pi(r).length===0?[]:Wo(r)}};function Ur(r){const e=r.value,i=r.valueSpec,o=r.styleSpec;return i.expression&&Lo(bn(e))?fa(r):i.expression&&js(jn(e))?Wo(r):i.type&&ja[i.type]?ja[i.type](r):Ir(Bn({},r,{valueSpec:i.type?o[i.type]:i}))}function Ua(r){const e=r.value,i=r.key,o=Pi(r);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new ft(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new ft(i,e,'"glyphs" url must include a "{range}" token'))),o}function ki(r,e=je){let i=[];return i=i.concat(Ur({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,objectElementValidators:{glyphs:Ua,"*":()=>[]}})),r.constants&&(i=i.concat(Zn({key:"constants",value:r.constants,style:r,styleSpec:e}))),ol(i)}function ol(r){return[].concat(r).sort((e,i)=>e.line-i.line)}function qi(r){return function(...e){return ol(r.apply(this,e))}}ki.source=qi(ys),ki.light=qi(ti),ki.terrain=qi(_s),ki.fog=qi(Ai),ki.layer=qi(zo),ki.filter=qi(vo),ki.paintProperty=qi(Gs),ki.layoutProperty=qi(Do);const vs=ki,Tl=vs.light,Na=vs.fog,sl=vs.paintProperty,Ga=vs.layoutProperty;function ya(r,e){let i=!1;if(e&&e.length)for(const o of e)r.fire(new sn(new Error(o.message))),i=!0;return i}var io=f;function f(r,e,i){var o=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var c=new Int32Array(this.arrayBuffer);r=c[0],this.d=(e=c[1])+2*(i=c[2]);for(var m=0;m<this.d*this.d;m++){var y=c[3+m],T=c[3+m+1];o.push(y===T?null:c.subarray(y,T))}var A=c[3+o.length+1];this.keys=c.subarray(c[3+o.length],A),this.bboxes=c.subarray(A),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var R=0;R<this.d*this.d;R++)o.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=r,this.padding=i,this.scale=e/r,this.uid=0;var N=i/e*r;this.min=-N,this.max=r+N}f.prototype.insert=function(r,e,i,o,c){this._forEachCell(e,i,o,c,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(c)},f.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},f.prototype._insertCell=function(r,e,i,o,c,m){this.cells[c].push(m)},f.prototype.query=function(r,e,i,o,c){var m=this.min,y=this.max;if(r<=m&&e<=m&&y<=i&&y<=o&&!c)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(r,e,i,o,this._queryCell,T,{},c),T},f.prototype._queryCell=function(r,e,i,o,c,m,y,T){var A=this.cells[c];if(A!==null)for(var R=this.keys,N=this.bboxes,q=0;q<A.length;q++){var W=A[q];if(y[W]===void 0){var Y=4*W;(T?T(N[Y+0],N[Y+1],N[Y+2],N[Y+3]):r<=N[Y+2]&&e<=N[Y+3]&&i>=N[Y+0]&&o>=N[Y+1])?(y[W]=!0,m.push(R[W])):y[W]=!1}}},f.prototype._forEachCell=function(r,e,i,o,c,m,y,T){for(var A=this._convertToCellCoord(r),R=this._convertToCellCoord(e),N=this._convertToCellCoord(i),q=this._convertToCellCoord(o),W=A;W<=N;W++)for(var Y=R;Y<=q;Y++){var oe=this.d*Y+W;if((!T||T(this._convertFromCellCoord(W),this._convertFromCellCoord(Y),this._convertFromCellCoord(W+1),this._convertFromCellCoord(Y+1)))&&c.call(this,r,e,i,o,oe,m,y,T))return}},f.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},f.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},f.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,e=3+this.cells.length+1+1,i=0,o=0;o<this.cells.length;o++)i+=this.cells[o].length;var c=new Int32Array(e+i+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var m=e,y=0;y<r.length;y++){var T=r[y];c[3+y]=m,c.set(T,m),m+=T.length}return c[3+r.length]=m,c.set(this.keys,m),c[3+r.length+1]=m+=this.keys.length,c.set(this.bboxes,m),m+=this.bboxes.length,c.buffer};const{ImageData:E,ImageBitmap:k}=P,G={};function Z(r,e,i={}){Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),G[r]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}Z("Object",Object),io.serialize=function(r,e){const i=r.toArrayBuffer();return e&&e.push(i),{buffer:i}},io.deserialize=function(r){return new io(r.buffer)},Z("Grid",io),Z("Color",$n),Z("Error",Error),Z("ResolvedImage",ai),Z("StylePropertyFunction",Ns),Z("StyleExpression",Fa,{omit:["_evaluator"]}),Z("ZoomDependentExpression",Zo),Z("ZoomConstantExpression",fs),Z("CompoundExpression",Ei,{omit:["_evaluate"]});for(const r in Go)Go[r]._classRegistryKey||Z("Expression_"+r,Go[r]);function J(r){return r&&typeof ArrayBuffer!="undefined"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function ne(r){return k&&r instanceof k}function fe(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(J(r)||ne(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const i=r;return e&&e.push(i.buffer),i}if(r instanceof E)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const o of r)i.push(fe(o,e));return i}if(typeof r=="object"){const i=r.constructor,o=i._classRegistryKey;if(!o)throw new Error("can't serialize object of unregistered class");const c=i.serialize?i.serialize(r,e):{};if(!i.serialize){for(const m in r){if(!r.hasOwnProperty(m)||G[o].omit.indexOf(m)>=0)continue;const y=r[m];c[m]=G[o].shallow.indexOf(m)>=0?y:fe(y,e)}r instanceof Error&&(c.message=r.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(c.$name=o),c}throw new Error("can't serialize object of type "+typeof r)}function ce(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||J(r)||ne(r)||ArrayBuffer.isView(r)||r instanceof E)return r;if(Array.isArray(r))return r.map(ce);if(typeof r=="object"){const e=r.$name||"Object",{klass:i}=G[e];if(!i)throw new Error("can't deserialize unregistered class "+e);if(i.deserialize)return i.deserialize(r);const o=Object.create(i.prototype);for(const c of Object.keys(r)){if(c==="$name")continue;const m=r[c];o[c]=G[e].shallow.indexOf(c)>=0?m:ce(m)}return o}throw new Error("can't deserialize object of type "+typeof r)}class Se{constructor(){this.first=!0}update(e,i){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const _e=r=>r>=1536&&r<=1791,De=r=>r>=1872&&r<=1919,Ge=r=>r>=2208&&r<=2303,Xe=r=>r>=11904&&r<=12031,it=r=>r>=12032&&r<=12255,Zt=r=>r>=12272&&r<=12287,Wt=r=>r>=12288&&r<=12351,Nt=r=>r>=12352&&r<=12447,Te=r=>r>=12448&&r<=12543,qe=r=>r>=12544&&r<=12591,wt=r=>r>=12704&&r<=12735,pt=r=>r>=12736&&r<=12783,Jt=r=>r>=12784&&r<=12799,en=r=>r>=12800&&r<=13055,Ht=r=>r>=13056&&r<=13311,_n=r=>r>=13312&&r<=19903,gn=r=>r>=19968&&r<=40959,Un=r=>r>=40960&&r<=42127,Kn=r=>r>=42128&&r<=42191,Tn=r=>r>=44032&&r<=55215,fr=r=>r>=63744&&r<=64255,ni=r=>r>=64336&&r<=65023,Li=r=>r>=65040&&r<=65055,ci=r=>r>=65072&&r<=65103,Cr=r=>r>=65104&&r<=65135,Di=r=>r>=65136&&r<=65279,mr=r=>r>=65280&&r<=65519;function Vs(r){for(const e of r)if(ie(e.charCodeAt(0)))return!0;return!1}function Tr(r){for(const e of r)if(!rt(e.charCodeAt(0)))return!1;return!0}function rt(r){return!(_e(r)||De(r)||Ge(r)||ni(r)||Di(r))}function ie(r){return!(r!==746&&r!==747&&(r<4352||!(wt(r)||qe(r)||ci(r)&&!(r>=65097&&r<=65103)||fr(r)||Ht(r)||Xe(r)||pt(r)||!(!Wt(r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||_n(r)||gn(r)||en(r)||(e=>e>=12592&&e<=12687)(r)||(e=>e>=43360&&e<=43391)(r)||(e=>e>=55216&&e<=55295)(r)||(e=>e>=4352&&e<=4607)(r)||Tn(r)||Nt(r)||Zt(r)||(e=>e>=12688&&e<=12703)(r)||it(r)||Jt(r)||Te(r)&&r!==12540||!(!mr(r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Cr(r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||(e=>e>=5120&&e<=5759)(r)||(e=>e>=6320&&e<=6399)(r)||Li(r)||(e=>e>=19904&&e<=19967)(r)||Un(r)||Kn(r))))}function ge(r){return!(ie(r)||function(e){return!!((i=>i>=128&&i<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(i=>i>=8192&&i<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&e!==9251||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Wt(e)||Te(e)||(i=>i>=57344&&i<=63743)(e)||ci(e)||Cr(e)||mr(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function Re(r){return r>=1424&&r<=2303||ni(r)||Di(r)}function $e(r,e){return!(!e&&Re(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||(i=>i>=6016&&i<=6143)(r))}function tt(r){for(const e of r)if(Re(e.charCodeAt(0)))return!0;return!1}const Ut="deferred",Et="loading",Ct="loaded";let tn=null,ln="unavailable",hn=null;const vn=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(ln="error"),tn&&tn(r)};function d(){t.fire(new Xt("pluginStateChange",{pluginStatus:ln,pluginURL:hn}))}const t=new Kt,s=function(){return ln},p=function(){if(ln!==Ut||!hn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ln=Et,d(),hn&&xe({url:hn},r=>{r?vn(r):(ln=Ct,d())})},x={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ln===Ct||x.applyArabicShaping!=null,isLoading:()=>ln===Et,setState(r){ln=r.pluginStatus,hn=r.pluginURL},isParsed:()=>x.applyArabicShaping!=null&&x.processBidirectionalText!=null&&x.processStyledBidirectionalText!=null,getPluginURL:()=>hn};class S{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Se,this.transition={})}isSupportedScript(e){return function(i,o){for(const c of i)if(!$e(c.charCodeAt(0),o))return!1;return!0}(e,x.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*i}}}class z{constructor(e,i){this.property=e,this.value=i,this.expression=function(o,c){if(Lo(o))return new Ns(o,c);if(js(o)){const m=Ra(o,c);if(m.result==="error")throw new Error(m.value.map(y=>`${y.key}: ${y.message}`).join(", "));return m.value}{let m=o;return typeof o=="string"&&c.type==="color"&&(m=$n.parse(o)),{kind:"constant",evaluate:()=>m}}}(i===void 0?e.specification.default:i,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class B{constructor(e){this.property=e,this.value=new z(e,void 0)}transitioned(e,i){return new $(this.property,this.value,i,Pe({},e.transition,this.transition),e.now)}untransitioned(){return new $(this.property,this.value,null,{},0)}}class V{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return ht(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new B(this._values[e].property)),this._values[e].value=new z(this._values[e].property,i===null?void 0:ht(i))}getTransition(e){return ht(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new B(this._values[e].property)),this._values[e].transition=ht(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const c=this.getTransition(i);c!==void 0&&(e[i+"-transition"]=c)}return e}transitioned(e,i){const o=new H(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(e,i._values[c]);return o}untransitioned(){const e=new H(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class ${constructor(e,i,o,c,m){const y=c.delay||0,T=c.duration||0;m=m||0,this.property=e,this.value=i,this.begin=m+y,this.end=this.begin+T,e.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const c=e.now||0,m=this.value.possiblyEvaluate(e,i,o),y=this.prior;if(y){if(c>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(c<this.begin)return y.possiblyEvaluate(e,i,o);{const T=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,i,o),m,K(T))}}return m}}class H{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const c=new me(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(e,i,o);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class re{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return ht(this._values[e].value)}setValue(e,i){this._values[e]=new z(this._values[e].property,i===null?void 0:ht(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const c=new me(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(e,i,o);return c}}class se{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,c){return this.property.evaluate(this.value,this.parameters,e,i,o,c)}}class me{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ae{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,o){const c=Qi[this.specification.type];return c?c(e,i,o):e}}class ue{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,c){return new se(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,c)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new se(this,{kind:"constant",value:void 0},e.parameters);const c=Qi[this.specification.type];return c?new se(this,{kind:"constant",value:c(e.value.value,i.value.value,o)},e.parameters):e}evaluate(e,i,o,c,m,y){return e.kind==="constant"?e.value:e.evaluate(i,o,c,m,y)}}class Le extends ue{possiblyEvaluate(e,i,o,c){if(e.value===void 0)return new se(this,{kind:"constant",value:void 0},i);if(e.expression.kind==="constant"){const m=e.expression.evaluate(i,null,{},o,c),y=e.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,T=this._calculate(y,y,y,i);return new se(this,{kind:"constant",value:T},i)}if(e.expression.kind==="camera"){const m=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new se(this,{kind:"constant",value:m},i)}return new se(this,e.expression,i)}evaluate(e,i,o,c,m,y){if(e.kind==="source"){const T=e.evaluate(i,o,c,m,y);return this._calculate(T,T,T,i)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},o,c),e.evaluate({zoom:Math.floor(i.zoom)},o,c),e.evaluate({zoom:Math.floor(i.zoom)+1},o,c),i):e.value}_calculate(e,i,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:i,other:o}:{from:o,to:i,other:e}}interpolate(e){return e}}class ye{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const m=e.expression.evaluate(i,null,{},o,c);return this._calculate(m,m,m,i)}return this._calculate(e.expression.evaluate(new S(Math.floor(i.zoom-1),i)),e.expression.evaluate(new S(Math.floor(i.zoom),i)),e.expression.evaluate(new S(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class Me{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,c){return!!e.expression.evaluate(i,null,{},o,c)}interpolate(){return!1}}class Ae{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in e){const o=e[i];o.specification.overridable&&this.overridableProperties.push(i);const c=this.defaultPropertyValues[i]=new z(o,void 0),m=this.defaultTransitionablePropertyValues[i]=new B(o);this.defaultTransitioningPropertyValues[i]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=c.possiblyEvaluate({})}}}function Ne(r,e){return 256*(r=le(Math.floor(r),0,255))+le(Math.floor(e),0,255)}Z("DataDrivenProperty",ue),Z("DataConstantProperty",ae),Z("CrossFadedDataDrivenProperty",Le),Z("CrossFadedProperty",ye),Z("ColorRampProperty",Me);const He={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class We{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class lt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ut(r,e=1){let i=0,o=0;return{members:r.map(c=>{const m=He[c.type].BYTES_PER_ELEMENT,y=i=It(i,Math.max(e,m)),T=c.components||1;return o=Math.max(o,m),i+=m*T,{name:c.name,type:c.type,components:T,offset:y}}),size:It(i,Math.max(o,e)),alignment:e}}function It(r,e){return Math.ceil(r/e)*e}class ze extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const c=2*e;return this.int16[c+0]=i,this.int16[c+1]=o,e}}ze.prototype.bytesPerElement=4,Z("StructArrayLayout2i4",ze);class Gt extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,c)}emplace(e,i,o,c,m){const y=4*e;return this.int16[y+0]=i,this.int16[y+1]=o,this.int16[y+2]=c,this.int16[y+3]=m,e}}Gt.prototype.bytesPerElement=8,Z("StructArrayLayout4i8",Gt);class Lt extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,y,T){const A=this.length;return this.resize(A+1),this.emplace(A,e,i,o,c,m,y,T)}emplace(e,i,o,c,m,y,T,A){const R=6*e,N=12*e,q=3*e;return this.int16[R+0]=i,this.int16[R+1]=o,this.uint8[N+4]=c,this.uint8[N+5]=m,this.uint8[N+6]=y,this.uint8[N+7]=T,this.float32[q+2]=A,e}}Lt.prototype.bytesPerElement=12,Z("StructArrayLayout2i4ub1f12",Lt);class pn extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const c=2*e;return this.float32[c+0]=i,this.float32[c+1]=o,e}}pn.prototype.bytesPerElement=8,Z("StructArrayLayout2f8",pn);class on extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,y,T,A,R,N){const q=this.length;return this.resize(q+1),this.emplace(q,e,i,o,c,m,y,T,A,R,N)}emplace(e,i,o,c,m,y,T,A,R,N,q){const W=10*e;return this.uint16[W+0]=i,this.uint16[W+1]=o,this.uint16[W+2]=c,this.uint16[W+3]=m,this.uint16[W+4]=y,this.uint16[W+5]=T,this.uint16[W+6]=A,this.uint16[W+7]=R,this.uint16[W+8]=N,this.uint16[W+9]=q,e}}on.prototype.bytesPerElement=20,Z("StructArrayLayout10ui20",on);class an extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,y,T,A){const R=this.length;return this.resize(R+1),this.emplace(R,e,i,o,c,m,y,T,A)}emplace(e,i,o,c,m,y,T,A,R){const N=8*e;return this.uint16[N+0]=i,this.uint16[N+1]=o,this.uint16[N+2]=c,this.uint16[N+3]=m,this.uint16[N+4]=y,this.uint16[N+5]=T,this.uint16[N+6]=A,this.uint16[N+7]=R,e}}an.prototype.bytesPerElement=16,Z("StructArrayLayout8ui16",an);class Pn extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,y,T,A,R,N,q,W){const Y=this.length;return this.resize(Y+1),this.emplace(Y,e,i,o,c,m,y,T,A,R,N,q,W)}emplace(e,i,o,c,m,y,T,A,R,N,q,W,Y){const oe=12*e;return this.int16[oe+0]=i,this.int16[oe+1]=o,this.int16[oe+2]=c,this.int16[oe+3]=m,this.uint16[oe+4]=y,this.uint16[oe+5]=T,this.uint16[oe+6]=A,this.uint16[oe+7]=R,this.int16[oe+8]=N,this.int16[oe+9]=q,this.int16[oe+10]=W,this.int16[oe+11]=Y,e}}Pn.prototype.bytesPerElement=24,Z("StructArrayLayout4i4ui4i24",Pn);class Be extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const m=3*e;return this.float32[m+0]=i,this.float32[m+1]=o,this.float32[m+2]=c,e}}Be.prototype.bytesPerElement=12,Z("StructArrayLayout3f12",Be);class nt extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}nt.prototype.bytesPerElement=4,Z("StructArrayLayout1ul4",nt);class zt extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,y,T,A,R,N){const q=this.length;return this.resize(q+1),this.emplace(q,e,i,o,c,m,y,T,A,R,N)}emplace(e,i,o,c,m,y,T,A,R,N,q){const W=16*e,Y=8*e;return this.int16[W+0]=i,this.int16[W+1]=o,this.float32[Y+1]=c,this.float32[Y+2]=m,this.float32[Y+3]=y,this.float32[Y+4]=T,this.int16[W+10]=A,this.uint32[Y+6]=R,this.uint16[W+14]=N,this.uint16[W+15]=q,e}}zt.prototype.bytesPerElement=32,Z("StructArrayLayout2i4f1i1ul2ui32",zt);class Yt extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,y){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,o,c,m,y)}emplace(e,i,o,c,m,y,T){const A=6*e;return this.int16[A+0]=i,this.int16[A+1]=o,this.int16[A+2]=c,this.int16[A+3]=m,this.int16[A+4]=y,this.int16[A+5]=T,e}}Yt.prototype.bytesPerElement=12,Z("StructArrayLayout2i2i2i12",Yt);class yn extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,c,m)}emplace(e,i,o,c,m,y){const T=4*e,A=8*e;return this.float32[T+0]=i,this.float32[T+1]=o,this.float32[T+2]=c,this.int16[A+6]=m,this.int16[A+7]=y,e}}yn.prototype.bytesPerElement=16,Z("StructArrayLayout2f1f2i16",yn);class fn extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,c)}emplace(e,i,o,c,m){const y=12*e,T=3*e;return this.uint8[y+0]=i,this.uint8[y+1]=o,this.float32[T+1]=c,this.float32[T+2]=m,e}}fn.prototype.bytesPerElement=12,Z("StructArrayLayout2ub2f12",fn);class Cn extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const m=3*e;return this.uint16[m+0]=i,this.uint16[m+1]=o,this.uint16[m+2]=c,e}}Cn.prototype.bytesPerElement=6,Z("StructArrayLayout3ui6",Cn);class rr extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,y,T,A,R,N,q,W,Y,oe,be,Ce,Fe){const Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,e,i,o,c,m,y,T,A,R,N,q,W,Y,oe,be,Ce,Fe)}emplace(e,i,o,c,m,y,T,A,R,N,q,W,Y,oe,be,Ce,Fe,Ze){const Ye=24*e,ot=12*e,st=48*e;return this.int16[Ye+0]=i,this.int16[Ye+1]=o,this.uint16[Ye+2]=c,this.uint16[Ye+3]=m,this.uint32[ot+2]=y,this.uint32[ot+3]=T,this.uint32[ot+4]=A,this.uint16[Ye+10]=R,this.uint16[Ye+11]=N,this.uint16[Ye+12]=q,this.float32[ot+7]=W,this.float32[ot+8]=Y,this.uint8[st+36]=oe,this.uint8[st+37]=be,this.uint8[st+38]=Ce,this.uint32[ot+10]=Fe,this.int16[Ye+22]=Ze,e}}rr.prototype.bytesPerElement=48,Z("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",rr);class br extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,y,T,A,R,N,q,W,Y,oe,be,Ce,Fe,Ze,Ye,ot,st,at,Ot,At,Tt,qt,bt){const St=this.length;return this.resize(St+1),this.emplace(St,e,i,o,c,m,y,T,A,R,N,q,W,Y,oe,be,Ce,Fe,Ze,Ye,ot,st,at,Ot,At,Tt,qt,bt)}emplace(e,i,o,c,m,y,T,A,R,N,q,W,Y,oe,be,Ce,Fe,Ze,Ye,ot,st,at,Ot,At,Tt,qt,bt,St){const _t=32*e,Mt=16*e;return this.int16[_t+0]=i,this.int16[_t+1]=o,this.int16[_t+2]=c,this.int16[_t+3]=m,this.int16[_t+4]=y,this.int16[_t+5]=T,this.int16[_t+6]=A,this.int16[_t+7]=R,this.uint16[_t+8]=N,this.uint16[_t+9]=q,this.uint16[_t+10]=W,this.uint16[_t+11]=Y,this.uint16[_t+12]=oe,this.uint16[_t+13]=be,this.uint16[_t+14]=Ce,this.uint16[_t+15]=Fe,this.uint16[_t+16]=Ze,this.uint16[_t+17]=Ye,this.uint16[_t+18]=ot,this.uint16[_t+19]=st,this.uint16[_t+20]=at,this.uint16[_t+21]=Ot,this.uint16[_t+22]=At,this.uint32[Mt+12]=Tt,this.float32[Mt+13]=qt,this.float32[Mt+14]=bt,this.float32[Mt+15]=St,e}}br.prototype.bytesPerElement=64,Z("StructArrayLayout8i15ui1ul3f64",br);class Yn extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Yn.prototype.bytesPerElement=4,Z("StructArrayLayout1f4",Yn);class or extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const m=3*e;return this.int16[m+0]=i,this.int16[m+1]=o,this.int16[m+2]=c,e}}or.prototype.bytesPerElement=6,Z("StructArrayLayout3i6",or);class Or extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,c)}emplace(e,i,o,c,m){const y=6*e;return this.uint32[3*e+0]=i,this.uint16[y+2]=o,this.uint16[y+3]=c,this.uint16[y+4]=m,e}}Or.prototype.bytesPerElement=12,Z("StructArrayLayout1ul3ui12",Or);class Hn extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const c=2*e;return this.uint16[c+0]=i,this.uint16[c+1]=o,e}}Hn.prototype.bytesPerElement=4,Z("StructArrayLayout2ui4",Hn);class Jn extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Jn.prototype.bytesPerElement=2,Z("StructArrayLayout1ui2",Jn);class Fn extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,c)}emplace(e,i,o,c,m){const y=4*e;return this.float32[y+0]=i,this.float32[y+1]=o,this.float32[y+2]=c,this.float32[y+3]=m,e}}Fn.prototype.bytesPerElement=16,Z("StructArrayLayout4f16",Fn);class dr extends We{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.float32[this._pos4+1]}get y1(){return this._structArray.float32[this._pos4+2]}get x2(){return this._structArray.float32[this._pos4+3]}get y2(){return this._structArray.float32[this._pos4+4]}get padding(){return this._structArray.int16[this._pos2+10]}get featureIndex(){return this._structArray.uint32[this._pos4+6]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+14]}get bucketIndex(){return this._structArray.uint16[this._pos2+15]}get anchorPoint(){return new b(this.anchorPointX,this.anchorPointY)}}dr.prototype.size=32;class Fr extends zt{get(e){return new dr(this,e)}}Z("CollisionBoxArray",Fr);class ir extends We{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ir.prototype.size=48;class Jr extends rr{get(e){return new ir(this,e)}}Z("PlacedSymbolArray",Jr);class xs extends We{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textOffset0(){return this._structArray.float32[this._pos4+13]}get textOffset1(){return this._structArray.float32[this._pos4+14]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+15]}}xs.prototype.size=64;class _i extends br{get(e){return new xs(this,e)}}Z("SymbolInstanceArray",_i);class Oo extends Yn{getoffsetX(e){return this.float32[1*e+0]}}Z("GlyphOffsetArray",Oo);class ar extends or{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Z("SymbolLineVertexArray",ar);class Qn extends We{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Qn.prototype.size=12;class xo extends Or{get(e){return new Qn(this,e)}}Z("FeatureIndexArray",xo);class bo extends We{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}bo.prototype.size=4;class Ho extends Hn{get(e){return new bo(this,e)}}Z("FillExtrusionCentroidArray",Ho);const ui=ut([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Xo=ut([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Jo=Mi(function(r){r.exports=function(e,i){var o,c,m,y,T,A,R,N;for(c=e.length-(o=3&e.length),m=i,T=3432918353,A=461845907,N=0;N<c;)R=255&e.charCodeAt(N)|(255&e.charCodeAt(++N))<<8|(255&e.charCodeAt(++N))<<16|(255&e.charCodeAt(++N))<<24,++N,m=27492+(65535&(y=5*(65535&(m=(m^=R=(65535&(R=(R=(65535&R)*T+(((R>>>16)*T&65535)<<16)&4294967295)<<15|R>>>17))*A+(((R>>>16)*A&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(R=0,o){case 3:R^=(255&e.charCodeAt(N+2))<<16;case 2:R^=(255&e.charCodeAt(N+1))<<8;case 1:m^=R=(65535&(R=(R=(65535&(R^=255&e.charCodeAt(N)))*T+(((R>>>16)*T&65535)<<16)&4294967295)<<15|R>>>17))*A+(((R>>>16)*A&65535)<<16)&4294967295}return m^=e.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}}),Va=Mi(function(r){r.exports=function(e,i){for(var o,c=e.length,m=i^c,y=0;c>=4;)o=1540483477*(65535&(o=255&e.charCodeAt(y)|(255&e.charCodeAt(++y))<<8|(255&e.charCodeAt(++y))<<16|(255&e.charCodeAt(++y))<<24))+((1540483477*(o>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),c-=4,++y;switch(c){case 3:m^=(255&e.charCodeAt(y+2))<<16;case 2:m^=(255&e.charCodeAt(y+1))<<8;case 1:m=1540483477*(65535&(m^=255&e.charCodeAt(y)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}}),bs=Jo,va=Va;bs.murmur3=Jo,bs.murmur2=va;class wo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,o,c){this.ids.push(Pl(e)),this.positions.push(i,o,c)}getPositions(e){const i=Pl(e);let o=0,c=this.ids.length-1;for(;o<c;){const y=o+c>>1;this.ids[y]>=i?c=y:o=y+1}const m=[];for(;this.ids[o]===i;)m.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return m}static serialize(e,i){const o=new Float64Array(e.ids),c=new Uint32Array(e.positions);return function m(y,T,A,R){for(;A<R;){const N=y[A+R>>1];let q=A-1,W=R+1;for(;;){do q++;while(y[q]<N);do W--;while(y[W]>N);if(q>=W)break;qs(y,q,W),qs(T,3*q,3*W),qs(T,3*q+1,3*W+1),qs(T,3*q+2,3*W+2)}W-A<R-W?(m(y,T,A,W),A=W+1):(m(y,T,W+1,R),R=W)}}(o,c,0,o.length-1),i&&i.push(o.buffer,c.buffer),{ids:o,positions:c}}static deserialize(e){const i=new wo;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function Pl(r){const e=+r;return!isNaN(e)&&e<=C?e:bs(String(r))}function qs(r,e,i){const o=r[e];r[e]=r[i],r[i]=o}Z("FeaturePositionMap",wo);class Fo{constructor(e,i){this.gl=e.gl,this.location=i}}class Zs extends Fo{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class qa extends Fo{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Cl extends Fo{constructor(e,i){super(e,i),this.current=$n.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const al=new Float32Array(16),ll=new Float32Array(9);function gc(r){return[Ne(255*r.r,255*r.g),Ne(255*r.b,255*r.a)]}class Al{constructor(e,i,o){this.value=e,this.uniformNames=i.map(c=>"u_"+c),this.type=o}setUniform(e,i,o){e.set(o.constantOr(this.value))}getBinding(e,i,o){return this.type==="color"?new Cl(e,i):new Zs(e,i)}}class cl{constructor(e,i){this.uniformNames=i.map(o=>"u_"+o),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=i.tl.concat(i.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,i,o,c){const m=c==="u_pattern_to"||c==="u_dash_to"?this.patternTo:c==="u_pattern_from"||c==="u_dash_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&e.set(m)}getBinding(e,i,o){return o==="u_pattern_from"||o==="u_pattern_to"||o==="u_dash_from"||o==="u_dash_to"?new qa(e,i):new Zs(e,i)}}class $s{constructor(e,i,o,c){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(m=>({name:"a_"+m,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,i,o,c,m){const y=this.paintVertexArray.length,T=this.expression.evaluate(new S(0),i,{},c,[],m);this.paintVertexArray.resize(e),this._setPaintValue(y,e,T)}updatePaintArray(e,i,o,c){const m=this.expression.evaluate({zoom:0},o,c);this._setPaintValue(e,i,m)}_setPaintValue(e,i,o){if(this.type==="color"){const c=gc(o);for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,c[0],c[1])}else{for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ko{constructor(e,i,o,c,m,y){this.expression=e,this.uniformNames=i.map(T=>`u_${T}_t`),this.type=o,this.useIntegerZoom=c,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=i.map(T=>({name:"a_"+T,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,i,o,c,m){const y=this.expression.evaluate(new S(this.zoom),i,{},c,[],m),T=this.expression.evaluate(new S(this.zoom+1),i,{},c,[],m),A=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(A,e,y,T)}updatePaintArray(e,i,o,c){const m=this.expression.evaluate({zoom:this.zoom},o,c),y=this.expression.evaluate({zoom:this.zoom+1},o,c);this._setPaintValue(e,i,m,y)}_setPaintValue(e,i,o,c){if(this.type==="color"){const m=gc(o),y=gc(c);for(let T=e;T<i;T++)this.paintVertexArray.emplace(T,m[0],m[1],y[0],y[1])}else{for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,c=le(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,i,o){return new Zs(e,i)}}class xa{constructor(e,i,o,c,m,y,T){this.expression=e,this.type=o,this.useIntegerZoom=c,this.zoom=m,this.layerId=T,this.paintVertexAttributes=(o==="array"?Xo:ui).members;for(let A=0;A<i.length;++A);this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(e,i,o){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,c,m){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],m)}_setPaintValues(e,i,o,c){if(!c||!o)return;const{min:m,mid:y,max:T}=o,A=c[m],R=c[y],N=c[T];if(A&&R&&N)for(let q=e;q<i;q++)this._setPaintValue(this.zoomInPaintVertexArray,q,R,A),this._setPaintValue(this.zoomOutPaintVertexArray,q,R,N)}_setPaintValue(e,i,o,c){e.emplace(i,o.tl[0],o.tl[1],o.br[0],o.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],o.pixelRatio,c.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ws{constructor(e,i,o=()=>!0){this.binders={},this._buffers=[];const c=[];for(const m in e.paint._values){if(!o(m))continue;const y=e.paint.get(m);if(!(y instanceof se&&qo(y.property.specification)))continue;const T=ed(m,e.type),A=y.value,R=y.property.specification.type,N=y.property.useIntegerZoom,q=y.property.specification["property-type"],W=q==="cross-faded"||q==="cross-faded-data-driven",Y=String(m)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(A.kind!=="constant"||Y)if(A.kind==="source"||Y||W){const oe=uu(m,R,"source");this.binders[m]=W?new xa(A,T,R,N,i,oe,e.id):new $s(A,T,R,oe),c.push("/a_"+m)}else{const oe=uu(m,R,"composite");this.binders[m]=new Ko(A,T,R,N,i,oe),c.push("/z_"+m)}else this.binders[m]=W?new cl(A.value,T):new Al(A.value,T,R),c.push("/u_"+m)}this.cacheKey=c.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof $s||i instanceof Ko?i.maxValue:0}populatePaintArrays(e,i,o,c,m){for(const y in this.binders){const T=this.binders[y];(T instanceof $s||T instanceof Ko||T instanceof xa)&&T.populatePaintArray(e,i,o,c,m)}}setConstantPatternPositions(e,i){for(const o in this.binders){const c=this.binders[o];c instanceof cl&&c.setConstantPatternPositions(e,i)}}updatePaintArrays(e,i,o,c,m){let y=!1;for(const T in e){const A=i.getPositions(T);for(const R of A){const N=o.feature(R.index);for(const q in this.binders){const W=this.binders[q];if((W instanceof $s||W instanceof Ko||W instanceof xa)&&W.expression.isStateDependent===!0){const Y=c.paint.get(q);W.expression=Y.value,W.updatePaintArray(R.start,R.end,N,e[T],m),y=!0}}}}return y}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof Al||o instanceof cl)&&e.push(...o.uniformNames.map(c=>"#define HAS_UNIFORM_"+c))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof $s||o instanceof Ko||o instanceof xa)for(let c=0;c<o.paintVertexAttributes.length;c++)e.push(o.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Al||o instanceof cl||o instanceof Ko)for(const c of o.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const o=[];for(const c in this.binders){const m=this.binders[c];if(m instanceof Al||m instanceof cl||m instanceof Ko){for(const y of m.uniformNames)if(i[y]){const T=m.getBinding(e,i[y],y);o.push({name:y,property:c,binding:T})}}}return o}setUniforms(e,i,o,c){for(const{name:m,property:y,binding:T}of i)this.binders[y].setUniform(T,c,o.get(y),m)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const o=this.binders[i];if(e&&o instanceof xa){const c=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(o instanceof $s||o instanceof Ko)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof $s||o instanceof Ko||o instanceof xa)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof $s||i instanceof Ko||i instanceof xa)&&i.destroy()}}}class Za{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new Ws(c,i,o);this.needsUpload=!1,this._featureMap=new wo,this._bufferOffset=0}populatePaintArrays(e,i,o,c,m,y){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(e,i,c,m,y);i.id!==void 0&&this._featureMap.add(i.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,c){for(const m of o)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,i,m,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Qh={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function ed(r,e){return Qh[r]||[r.replace(e+"-","").replace(/-/g,"_")]}const td={"line-pattern":{source:on,composite:on},"fill-pattern":{source:on,composite:on},"fill-extrusion-pattern":{source:on,composite:on},"line-dasharray":{source:an,composite:an}},nd={color:{source:pn,composite:Fn},number:{source:Yn,composite:pn}};function uu(r,e,i){const o=td[r];return o&&o[i]||nd[e][i]}Z("ConstantBinder",Al),Z("CrossFadedConstantBinder",cl),Z("SourceExpressionBinder",$s),Z("CrossFadedCompositeBinder",xa),Z("CompositeExpressionBinder",Ko),Z("ProgramConfiguration",Ws,{omit:["_buffers"]}),Z("ProgramConfigurationSet",Za);const Wl="-transition";class Yo extends Kt{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new re(i.layout)),i.paint)){this._transitionablePaint=new V(i.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new me(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,o={}){i!=null&&this._validate(Ga,`layers.${this.id}.layout.${e}`,e,i,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return nn(e,Wl)?this._transitionablePaint.getTransition(e.slice(0,-Wl.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,o={}){if(i!=null&&this._validate(sl,`layers.${this.id}.paint.${e}`,e,i,o))return!1;if(nn(e,Wl))return this._transitionablePaint.setTransition(e.slice(0,-Wl.length),i||void 0),!1;{const c=this._transitionablePaint._values[e],m=c.property.specification["property-type"]==="cross-faded-data-driven",y=c.value.isDataDriven(),T=c.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const A=this._transitionablePaint._values[e].value;return A.isDataDriven()||y||m||this._handleOverridablePaintPropertyUpdate(e,T,A)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),cn(e,(i,o)=>!(i===void 0||o==="layout"&&!Object.keys(i).length||o==="paint"&&!Object.keys(i).length))}_validate(e,i,o,c,m={}){return(!m||m.validate!==!1)&&ya(this,e.call(vs,{key:i,layerType:this.type,objectKey:o,value:c,styleSpec:je,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof se&&qo(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}const rd=ut([{name:"a_pos",components:2,type:"Int16"}],4),{members:id}=rd;class vi{constructor(e=[]){this.segments=e}prepareSegment(e,i,o,c){let m=this.segments[this.segments.length-1];return e>vi.MAX_VERTEX_ARRAY_LENGTH&&rn(`Max vertices per segment is ${vi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>vi.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==c)&&(m={vertexOffset:i.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},c!==void 0&&(m.sortKey=c),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,c){return new vi([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}vi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Z("SegmentVector",vi);var sr=8192;const yc=Math.pow(2,14)-1,hu=-yc-1;function $a(r){const e=sr/r.extent,i=r.loadGeometry();for(let o=0;o<i.length;o++){const c=i[o];for(let m=0;m<c.length;m++){const y=c[m],T=Math.round(y.x*e),A=Math.round(y.y*e);y.x=le(T,hu,yc),y.y=le(A,hu,yc),(T<y.x||T>y.x+1||A<y.y||A>y.y+1)&&rn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function Wa(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?$a(r):[]}}function Hl(r,e,i,o,c){r.emplaceBack(2*e+(o+1)/2,2*i+(c+1)/2)}class vc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ze,this.indexArray=new Cn,this.segments=new vi,this.programConfigurations=new Za(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o){const c=this.layers[0],m=[];let y=null;c.type==="circle"&&(y=c.layout.get("circle-sort-key"));for(const{feature:T,id:A,index:R,sourceLayerIndex:N}of e){const q=this.layers[0]._featureFilter.needGeometry,W=Wa(T,q);if(!this.layers[0]._featureFilter.filter(new S(this.zoom),W,o))continue;const Y=y?y.evaluate(W,{},o):void 0,oe={id:A,properties:T.properties,type:T.type,sourceLayerIndex:N,index:R,geometry:q?W.geometry:$a(T),patterns:{},sortKey:Y};m.push(oe)}y&&m.sort((T,A)=>T.sortKey-A.sortKey);for(const T of m){const{geometry:A,index:R,sourceLayerIndex:N}=T,q=e[R].feature;this.addFeature(T,A,R,o),i.featureIndex.insert(q,A,R,N,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,id),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,c){for(const m of i)for(const y of m){const T=y.x,A=y.y;if(T<0||T>=sr||A<0||A>=sr)continue;const R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),N=R.vertexLength;Hl(this.layoutVertexArray,T,A,-1,-1),Hl(this.layoutVertexArray,T,A,1,-1),Hl(this.layoutVertexArray,T,A,1,1),Hl(this.layoutVertexArray,T,A,-1,1),this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+3,N+2),R.vertexLength+=4,R.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},c)}}function du(r,e){for(let i=0;i<r.length;i++)if(ul(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(ul(r,e[i]))return!0;return!!xc(r,e)}function od(r,e,i){return!!ul(r,e)||!!bc(e,r,i)}function pu(r,e){if(r.length===1)return mu(e,r[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let c=0;c<o.length;c++)if(ul(r,o[c]))return!0}for(let i=0;i<r.length;i++)if(mu(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(xc(r,e[i]))return!0;return!1}function sd(r,e,i){if(r.length>1){if(xc(r,e))return!0;for(let o=0;o<e.length;o++)if(bc(e[o],r,i))return!0}for(let o=0;o<r.length;o++)if(bc(r[o],e,i))return!0;return!1}function xc(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const o=r[i],c=r[i+1];for(let m=0;m<e.length-1;m++)if(ad(o,c,e[m],e[m+1]))return!0}return!1}function ad(r,e,i,o){return wn(r,i,o)!==wn(e,i,o)&&wn(r,e,i)!==wn(r,e,o)}function bc(r,e,i){const o=i*i;if(e.length===1)return r.distSqr(e[0])<o;for(let c=1;c<e.length;c++)if(fu(r,e[c-1],e[c])<o)return!0;return!1}function fu(r,e,i){const o=e.distSqr(i);if(o===0)return r.distSqr(e);const c=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/o;return r.distSqr(c<0?e:c>1?i:i.sub(e)._mult(c)._add(e))}function mu(r,e){let i,o,c,m=!1;for(let y=0;y<r.length;y++){i=r[y];for(let T=0,A=i.length-1;T<i.length;A=T++)o=i[T],c=i[A],o.y>e.y!=c.y>e.y&&e.x<(c.x-o.x)*(e.y-o.y)/(c.y-o.y)+o.x&&(m=!m)}return m}function ul(r,e){let i=!1;for(let o=0,c=r.length-1;o<r.length;c=o++){const m=r[o],y=r[c];m.y>e.y!=y.y>e.y&&e.x<(y.x-m.x)*(e.y-m.y)/(y.y-m.y)+m.x&&(i=!i)}return i}function gu(r,e,i,o,c){for(const y of r)if(e<=y.x&&i<=y.y&&o>=y.x&&c>=y.y)return!0;const m=[new b(e,i),new b(e,c),new b(o,c),new b(o,i)];if(r.length>2){for(const y of m)if(ul(r,y))return!0}for(let y=0;y<r.length-1;y++)if(ld(r[y],r[y+1],m))return!0;return!1}function ld(r,e,i){const o=i[0],c=i[2];if(r.x<o.x&&e.x<o.x||r.x>c.x&&e.x>c.x||r.y<o.y&&e.y<o.y||r.y>c.y&&e.y>c.y)return!1;const m=wn(r,e,i[0]);return m!==wn(r,e,i[1])||m!==wn(r,e,i[2])||m!==wn(r,e,i[3])}function kl(r,e,i){const o=e.paint.get(r).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(r)}function Xl(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function yu(r,e,i,o,c){if(!e[0]&&!e[1])return r;const m=b.convert(e)._mult(c);i==="viewport"&&m._rotate(-o);const y=[];for(let T=0;T<r.length;T++)y.push(r[T].sub(m));return y}function _u(r,e,i,o){const c=b.convert(r)._mult(o);return e==="viewport"&&c._rotate(-i),c}Z("CircleBucket",vc,{omit:["layers"]});const cd=new Ae({"circle-sort-key":new ue(je.layout_circle["circle-sort-key"])});var ud={paint:new Ae({"circle-radius":new ue(je.paint_circle["circle-radius"]),"circle-color":new ue(je.paint_circle["circle-color"]),"circle-blur":new ue(je.paint_circle["circle-blur"]),"circle-opacity":new ue(je.paint_circle["circle-opacity"]),"circle-translate":new ae(je.paint_circle["circle-translate"]),"circle-translate-anchor":new ae(je.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ae(je.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ae(je.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ue(je.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ue(je.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ue(je.paint_circle["circle-stroke-opacity"])}),layout:cd},oo=typeof Float32Array!="undefined"?Float32Array:Array;function vu(){var r=new oo(9);return oo!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function wc(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function xu(r,e,i){var o=e[0],c=e[1],m=e[2],y=e[3],T=e[4],A=e[5],R=e[6],N=e[7],q=e[8],W=e[9],Y=e[10],oe=e[11],be=e[12],Ce=e[13],Fe=e[14],Ze=e[15],Ye=i[0],ot=i[1],st=i[2],at=i[3];return r[0]=Ye*o+ot*T+st*q+at*be,r[1]=Ye*c+ot*A+st*W+at*Ce,r[2]=Ye*m+ot*R+st*Y+at*Fe,r[3]=Ye*y+ot*N+st*oe+at*Ze,r[4]=(Ye=i[4])*o+(ot=i[5])*T+(st=i[6])*q+(at=i[7])*be,r[5]=Ye*c+ot*A+st*W+at*Ce,r[6]=Ye*m+ot*R+st*Y+at*Fe,r[7]=Ye*y+ot*N+st*oe+at*Ze,r[8]=(Ye=i[8])*o+(ot=i[9])*T+(st=i[10])*q+(at=i[11])*be,r[9]=Ye*c+ot*A+st*W+at*Ce,r[10]=Ye*m+ot*R+st*Y+at*Fe,r[11]=Ye*y+ot*N+st*oe+at*Ze,r[12]=(Ye=i[12])*o+(ot=i[13])*T+(st=i[14])*q+(at=i[15])*be,r[13]=Ye*c+ot*A+st*W+at*Ce,r[14]=Ye*m+ot*R+st*Y+at*Fe,r[15]=Ye*y+ot*N+st*oe+at*Ze,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var hd=xu;function Jl(){var r=new oo(3);return oo!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function bu(r){return Math.hypot(r[0],r[1],r[2])}function hl(r,e,i){var o=new oo(3);return o[0]=r,o[1]=e,o[2]=i,o}function wu(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r}function Su(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r}function Mu(r,e,i,o){return r[0]=e[0]+i[0]*o,r[1]=e[1]+i[1]*o,r[2]=e[2]+i[2]*o,r}function Eu(r,e){var i=e[0],o=e[1],c=e[2],m=i*i+o*o+c*c;return m>0&&(m=1/Math.sqrt(m)),r[0]=e[0]*m,r[1]=e[1]*m,r[2]=e[2]*m,r}function Iu(r,e,i){var o=i[0],c=i[1],m=i[2],y=e[0],T=e[1],A=e[2],R=c*A-m*T,N=m*y-o*A,q=o*T-c*y,W=c*q-m*N,Y=m*R-o*q,oe=o*N-c*R,be=2*i[3];return N*=be,q*=be,Y*=2,oe*=2,r[0]=y+(R*=be)+(W*=2),r[1]=T+N+Y,r[2]=A+q+oe,r}var Ll,dd=wu,pd=Su,fd=bu;function Dl(r,e,i){var o=e[0],c=e[1],m=e[2],y=e[3];return r[0]=i[0]*o+i[4]*c+i[8]*m+i[12]*y,r[1]=i[1]*o+i[5]*c+i[9]*m+i[13]*y,r[2]=i[2]*o+i[6]*c+i[10]*m+i[14]*y,r[3]=i[3]*o+i[7]*c+i[11]*m+i[15]*y,r}function Sc(){var r=new oo(4);return oo!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Tu(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function Pu(r,e,i){i*=.5;var o=e[0],c=e[1],m=e[2],y=e[3],T=Math.sin(i),A=Math.cos(i);return r[0]=o*A+y*T,r[1]=c*A+m*T,r[2]=m*A-c*T,r[3]=y*A-o*T,r}function md(r,e,i){const o=Dl([],[r.x,r.y,e,1],i);return new b(o[0]/o[3],o[1]/o[3])}Jl(),Ll=new oo(4),oo!=Float32Array&&(Ll[0]=0,Ll[1]=0,Ll[2]=0,Ll[3]=0),Jl(),hl(1,0,0),hl(0,1,0),Sc(),Sc(),vu();const Cu=hl(0,0,0),gd=hl(0,0,1);function yd(r,e){const i=Jl();return Cu[2]=e,r.intersectsPlane(Cu,gd,i),new b(i[0],i[1])}class Au extends vc{}function Mc(r,{width:e,height:i},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*i*o)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*i*o);return r.width=e,r.height=i,r.data=c,r}function ku(r,{width:e,height:i},o){if(e===r.width&&i===r.height)return;const c=Mc({},{width:e,height:i},o);Ec(r,c,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,i)},o),r.width=e,r.height=i,r.data=c.data}function Ec(r,e,i,o,c,m){if(c.width===0||c.height===0)return e;if(c.width>r.width||c.height>r.height||i.x>r.width-c.width||i.y>r.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||o.x>e.width-c.width||o.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const y=r.data,T=e.data;for(let A=0;A<c.height;A++){const R=((i.y+A)*r.width+i.x)*m,N=((o.y+A)*e.width+o.x)*m;for(let q=0;q<c.width*m;q++)T[N+q]=y[R+q]}return e}Z("HeatmapBucket",Au,{omit:["layers"]});class ba{constructor(e,i){Mc(this,e,1,i)}resize(e){ku(this,e,1)}clone(){return new ba({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,c,m){Ec(e,i,o,c,m,1)}}class So{constructor(e,i){Mc(this,e,4,i)}resize(e){ku(this,e,4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new So({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,c,m){Ec(e,i,o,c,m,4)}}Z("AlphaImage",ba),Z("RGBAImage",So);var _d={paint:new Ae({"heatmap-radius":new ue(je.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ue(je.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ae(je.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Me(je.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ae(je.paint_heatmap["heatmap-opacity"])})};function Ic(r){const e={},i=r.resolution||256,o=r.clips?r.clips.length:1,c=r.image||new So({width:i,height:o}),m=(y,T,A)=>{e[r.evaluationKey]=A;const R=r.expression.evaluate(e);c.data[y+T+0]=Math.floor(255*R.r/R.a),c.data[y+T+1]=Math.floor(255*R.g/R.a),c.data[y+T+2]=Math.floor(255*R.b/R.a),c.data[y+T+3]=Math.floor(255*R.a)};if(r.clips)for(let y=0,T=0;y<o;++y,T+=4*i)for(let A=0,R=0;A<i;A++,R+=4){const N=A/(i-1),{start:q,end:W}=r.clips[y];m(T,R,q*(1-N)+W*N)}else for(let y=0,T=0;y<i;y++,T+=4)m(0,T,y/(i-1));return c}var vd={paint:new Ae({"hillshade-illumination-direction":new ae(je.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ae(je.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ae(je.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ae(je.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ae(je.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ae(je.paint_hillshade["hillshade-accent-color"])})};const xd=ut([{name:"a_pos",components:2,type:"Int16"}],4),{members:bd}=xd;var Tc=Kl,wd=Kl;function Kl(r,e,i){i=i||2;var o,c,m,y,T,A,R,N=e&&e.length,q=N?e[0]*i:r.length,W=Lu(r,0,q,i,!0),Y=[];if(!W||W.next===W.prev)return Y;if(N&&(W=function(be,Ce,Fe,Ze){var Ye,ot,st,at=[];for(Ye=0,ot=Ce.length;Ye<ot;Ye++)(st=Lu(be,Ce[Ye]*Ze,Ye<ot-1?Ce[Ye+1]*Ze:be.length,Ze,!1))===st.next&&(st.steiner=!0),at.push(Ad(st));for(at.sort(Td),Ye=0;Ye<at.length;Ye++)Pd(at[Ye],Fe),Fe=wa(Fe,Fe.next);return Fe}(r,e,W,i)),r.length>80*i){o=m=r[0],c=y=r[1];for(var oe=i;oe<q;oe+=i)(T=r[oe])<o&&(o=T),(A=r[oe+1])<c&&(c=A),T>m&&(m=T),A>y&&(y=A);R=(R=Math.max(m-o,y-c))!==0?1/R:0}return zl(W,Y,i,o,c,R),Y}function Lu(r,e,i,o,c){var m,y;if(c===Ac(r,e,i,o)>0)for(m=e;m<i;m+=o)y=Ou(m,r[m],r[m+1],y);else for(m=i-o;m>=e;m-=o)y=Ou(m,r[m],r[m+1],y);return y&&Yl(y,y.next)&&(Fl(y),y=y.next),y}function wa(r,e){if(!r)return r;e||(e=r);var i,o=r;do if(i=!1,o.steiner||!Yl(o,o.next)&&Rr(o.prev,o,o.next)!==0)o=o.next;else{if(Fl(o),(o=e=o.prev)===o.next)break;i=!0}while(i||o!==e);return e}function zl(r,e,i,o,c,m,y){if(r){!y&&m&&function(N,q,W,Y){var oe=N;do oe.z===null&&(oe.z=Pc(oe.x,oe.y,q,W,Y)),oe.prevZ=oe.prev,oe.nextZ=oe.next,oe=oe.next;while(oe!==N);oe.prevZ.nextZ=null,oe.prevZ=null,function(be){var Ce,Fe,Ze,Ye,ot,st,at,Ot,At=1;do{for(Fe=be,be=null,ot=null,st=0;Fe;){for(st++,Ze=Fe,at=0,Ce=0;Ce<At&&(at++,Ze=Ze.nextZ);Ce++);for(Ot=At;at>0||Ot>0&&Ze;)at!==0&&(Ot===0||!Ze||Fe.z<=Ze.z)?(Ye=Fe,Fe=Fe.nextZ,at--):(Ye=Ze,Ze=Ze.nextZ,Ot--),ot?ot.nextZ=Ye:be=Ye,Ye.prevZ=ot,ot=Ye;Fe=Ze}ot.nextZ=null,At*=2}while(st>1)}(oe)}(r,o,c,m);for(var T,A,R=r;r.prev!==r.next;)if(T=r.prev,A=r.next,m?Md(r,o,c,m):Sd(r))e.push(T.i/i),e.push(r.i/i),e.push(A.i/i),Fl(r),r=A.next,R=A.next;else if((r=A)===R){y?y===1?zl(r=Ed(wa(r),e,i),e,i,o,c,m,2):y===2&&Id(r,e,i,o,c,m):zl(wa(r),e,i,o,c,m,1);break}}}function Sd(r){var e=r.prev,i=r,o=r.next;if(Rr(e,i,o)>=0)return!1;for(var c=r.next.next;c!==r.prev;){if(dl(e.x,e.y,i.x,i.y,o.x,o.y,c.x,c.y)&&Rr(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function Md(r,e,i,o){var c=r.prev,m=r,y=r.next;if(Rr(c,m,y)>=0)return!1;for(var T=c.x>m.x?c.x>y.x?c.x:y.x:m.x>y.x?m.x:y.x,A=c.y>m.y?c.y>y.y?c.y:y.y:m.y>y.y?m.y:y.y,R=Pc(c.x<m.x?c.x<y.x?c.x:y.x:m.x<y.x?m.x:y.x,c.y<m.y?c.y<y.y?c.y:y.y:m.y<y.y?m.y:y.y,e,i,o),N=Pc(T,A,e,i,o),q=r.prevZ,W=r.nextZ;q&&q.z>=R&&W&&W.z<=N;){if(q!==r.prev&&q!==r.next&&dl(c.x,c.y,m.x,m.y,y.x,y.y,q.x,q.y)&&Rr(q.prev,q,q.next)>=0||(q=q.prevZ,W!==r.prev&&W!==r.next&&dl(c.x,c.y,m.x,m.y,y.x,y.y,W.x,W.y)&&Rr(W.prev,W,W.next)>=0))return!1;W=W.nextZ}for(;q&&q.z>=R;){if(q!==r.prev&&q!==r.next&&dl(c.x,c.y,m.x,m.y,y.x,y.y,q.x,q.y)&&Rr(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;W&&W.z<=N;){if(W!==r.prev&&W!==r.next&&dl(c.x,c.y,m.x,m.y,y.x,y.y,W.x,W.y)&&Rr(W.prev,W,W.next)>=0)return!1;W=W.nextZ}return!0}function Ed(r,e,i){var o=r;do{var c=o.prev,m=o.next.next;!Yl(c,m)&&Du(c,o,o.next,m)&&Ol(c,m)&&Ol(m,c)&&(e.push(c.i/i),e.push(o.i/i),e.push(m.i/i),Fl(o),Fl(o.next),o=r=m),o=o.next}while(o!==r);return wa(o)}function Id(r,e,i,o,c,m){var y=r;do{for(var T=y.next.next;T!==y.prev;){if(y.i!==T.i&&kd(y,T)){var A=zu(y,T);return y=wa(y,y.next),A=wa(A,A.next),zl(y,e,i,o,c,m),void zl(A,e,i,o,c,m)}T=T.next}y=y.next}while(y!==r)}function Td(r,e){return r.x-e.x}function Pd(r,e){if(e=function(o,c){var m,y=c,T=o.x,A=o.y,R=-1/0;do{if(A<=y.y&&A>=y.next.y&&y.next.y!==y.y){var N=y.x+(A-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(N<=T&&N>R){if(R=N,N===T){if(A===y.y)return y;if(A===y.next.y)return y.next}m=y.x<y.next.x?y:y.next}}y=y.next}while(y!==c);if(!m)return null;if(T===R)return m;var q,W=m,Y=m.x,oe=m.y,be=1/0;y=m;do T>=y.x&&y.x>=Y&&T!==y.x&&dl(A<oe?T:R,A,Y,oe,A<oe?R:T,A,y.x,y.y)&&(q=Math.abs(A-y.y)/(T-y.x),Ol(y,o)&&(q<be||q===be&&(y.x>m.x||y.x===m.x&&Cd(m,y)))&&(m=y,be=q)),y=y.next;while(y!==W);return m}(r,e)){var i=zu(e,r);wa(e,e.next),wa(i,i.next)}}function Cd(r,e){return Rr(r.prev,r,e.prev)<0&&Rr(e.next,r,r.next)<0}function Pc(r,e,i,o,c){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-i)*c)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-o)*c)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Ad(r){var e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function dl(r,e,i,o,c,m,y,T){return(c-y)*(e-T)-(r-y)*(m-T)>=0&&(r-y)*(o-T)-(i-y)*(e-T)>=0&&(i-y)*(m-T)-(c-y)*(o-T)>=0}function kd(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(i,o){var c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==o.i&&c.next.i!==o.i&&Du(c,c.next,i,o))return!0;c=c.next}while(c!==i);return!1}(r,e)&&(Ol(r,e)&&Ol(e,r)&&function(i,o){var c=i,m=!1,y=(i.x+o.x)/2,T=(i.y+o.y)/2;do c.y>T!=c.next.y>T&&c.next.y!==c.y&&y<(c.next.x-c.x)*(T-c.y)/(c.next.y-c.y)+c.x&&(m=!m),c=c.next;while(c!==i);return m}(r,e)&&(Rr(r.prev,r,e.prev)||Rr(r,e.prev,e))||Yl(r,e)&&Rr(r.prev,r,r.next)>0&&Rr(e.prev,e,e.next)>0)}function Rr(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function Yl(r,e){return r.x===e.x&&r.y===e.y}function Du(r,e,i,o){var c=ec(Rr(r,e,i)),m=ec(Rr(r,e,o)),y=ec(Rr(i,o,r)),T=ec(Rr(i,o,e));return c!==m&&y!==T||!(c!==0||!Ql(r,i,e))||!(m!==0||!Ql(r,o,e))||!(y!==0||!Ql(i,r,o))||!(T!==0||!Ql(i,e,o))}function Ql(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function ec(r){return r>0?1:r<0?-1:0}function Ol(r,e){return Rr(r.prev,r,r.next)<0?Rr(r,e,r.next)>=0&&Rr(r,r.prev,e)>=0:Rr(r,e,r.prev)<0||Rr(r,r.next,e)<0}function zu(r,e){var i=new Cc(r.i,r.x,r.y),o=new Cc(e.i,e.x,e.y),c=r.next,m=e.prev;return r.next=e,e.prev=r,i.next=c,c.prev=i,o.next=i,i.prev=o,m.next=o,o.prev=m,o}function Ou(r,e,i,o){var c=new Cc(r,e,i);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function Fl(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Cc(r,e,i){this.i=r,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ac(r,e,i,o){for(var c=0,m=e,y=i-o;m<i;m+=o)c+=(r[y]-r[m])*(r[m+1]+r[y+1]),y=m;return c}function Ld(r,e,i,o,c){(function m(y,T,A,R,N){for(;R>A;){if(R-A>600){var q=R-A+1,W=T-A+1,Y=Math.log(q),oe=.5*Math.exp(2*Y/3),be=.5*Math.sqrt(Y*oe*(q-oe)/q)*(W-q/2<0?-1:1);m(y,T,Math.max(A,Math.floor(T-W*oe/q+be)),Math.min(R,Math.floor(T+(q-W)*oe/q+be)),N)}var Ce=y[T],Fe=A,Ze=R;for(Rl(y,A,T),N(y[R],Ce)>0&&Rl(y,A,R);Fe<Ze;){for(Rl(y,Fe,Ze),Fe++,Ze--;N(y[Fe],Ce)<0;)Fe++;for(;N(y[Ze],Ce)>0;)Ze--}N(y[A],Ce)===0?Rl(y,A,Ze):Rl(y,++Ze,R),Ze<=T&&(A=Ze+1),T<=Ze&&(R=Ze-1)}})(r,e,i||0,o||r.length-1,c||Dd)}function Rl(r,e,i){var o=r[e];r[e]=r[i],r[i]=o}function Dd(r,e){return r<e?-1:r>e?1:0}function kc(r,e){const i=r.length;if(i<=1)return[r];const o=[];let c,m;for(let y=0;y<i;y++){const T=An(r[y]);T!==0&&(r[y].area=Math.abs(T),m===void 0&&(m=T<0),m===T<0?(c&&o.push(c),c=[r[y]]):c.push(r[y]))}if(c&&o.push(c),e>1)for(let y=0;y<o.length;y++)o[y].length<=e||(Ld(o[y],e,1,o[y].length-1,zd),o[y]=o[y].slice(0,e));return o}function zd(r,e){return e.area-r.area}function Lc(r,e,i){const o=i.patternDependencies;let c=!1;for(const m of e){const y=m.paint.get(r+"-pattern");y.isConstant()||(c=!0);const T=y.constantOr(null);T&&(c=!0,o[T.to]=!0,o[T.from]=!0)}return c}function Dc(r,e,i,o,c){const m=c.patternDependencies;for(const y of e){const T=y.paint.get(r+"-pattern").value;if(T.kind!=="constant"){let A=T.evaluate({zoom:o-1},i,{},c.availableImages),R=T.evaluate({zoom:o},i,{},c.availableImages),N=T.evaluate({zoom:o+1},i,{},c.availableImages);A=A&&A.name?A.name:A,R=R&&R.name?R.name:R,N=N&&N.name?N.name:N,m[A]=!0,m[R]=!0,m[N]=!0,i.patterns[y.id]={min:A,mid:R,max:N}}}return i}Kl.deviation=function(r,e,i,o){var c=e&&e.length,m=Math.abs(Ac(r,0,c?e[0]*i:r.length,i));if(c)for(var y=0,T=e.length;y<T;y++)m-=Math.abs(Ac(r,e[y]*i,y<T-1?e[y+1]*i:r.length,i));var A=0;for(y=0;y<o.length;y+=3){var R=o[y]*i,N=o[y+1]*i,q=o[y+2]*i;A+=Math.abs((r[R]-r[q])*(r[N+1]-r[R+1])-(r[R]-r[N])*(r[q+1]-r[R+1]))}return m===0&&A===0?0:Math.abs((A-m)/m)},Kl.flatten=function(r){for(var e=r[0][0].length,i={vertices:[],holes:[],dimensions:e},o=0,c=0;c<r.length;c++){for(var m=0;m<r[c].length;m++)for(var y=0;y<e;y++)i.vertices.push(r[c][m][y]);c>0&&i.holes.push(o+=r[c-1].length)}return i},Tc.default=wd;class zc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ze,this.indexArray=new Cn,this.indexArray2=new Hn,this.programConfigurations=new Za(e.layers,e.zoom),this.segments=new vi,this.segments2=new vi,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o){this.hasPattern=Lc("fill",this.layers,i);const c=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:y,id:T,index:A,sourceLayerIndex:R}of e){const N=this.layers[0]._featureFilter.needGeometry,q=Wa(y,N);if(!this.layers[0]._featureFilter.filter(new S(this.zoom),q,o))continue;const W=c?c.evaluate(q,{},o,i.availableImages):void 0,Y={id:T,properties:y.properties,type:y.type,sourceLayerIndex:R,index:A,geometry:N?q.geometry:$a(y),patterns:{},sortKey:W};m.push(Y)}c&&m.sort((y,T)=>y.sortKey-T.sortKey);for(const y of m){const{geometry:T,index:A,sourceLayerIndex:R}=y;if(this.hasPattern){const N=Dc("fill",this.layers,y,this.zoom,i);this.patternFeatures.push(N)}else this.addFeature(y,T,A,o,{});i.featureIndex.insert(e[A].feature,T,A,R,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,o)}addFeatures(e,i,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,i,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bd),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,c,m){for(const y of kc(i,500)){let T=0;for(const Y of y)T+=Y.length;const A=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),R=A.vertexLength,N=[],q=[];for(const Y of y){if(Y.length===0)continue;Y!==y[0]&&q.push(N.length/2);const oe=this.segments2.prepareSegment(Y.length,this.layoutVertexArray,this.indexArray2),be=oe.vertexLength;this.layoutVertexArray.emplaceBack(Y[0].x,Y[0].y),this.indexArray2.emplaceBack(be+Y.length-1,be),N.push(Y[0].x),N.push(Y[0].y);for(let Ce=1;Ce<Y.length;Ce++)this.layoutVertexArray.emplaceBack(Y[Ce].x,Y[Ce].y),this.indexArray2.emplaceBack(be+Ce-1,be+Ce),N.push(Y[Ce].x),N.push(Y[Ce].y);oe.vertexLength+=Y.length,oe.primitiveLength+=Y.length}const W=Tc(N,q);for(let Y=0;Y<W.length;Y+=3)this.indexArray.emplaceBack(R+W[Y],R+W[Y+1],R+W[Y+2]);A.vertexLength+=T,A.primitiveLength+=W.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,m,c)}}Z("FillBucket",zc,{omit:["layers","patternFeatures"]});const Od=new Ae({"fill-sort-key":new ue(je.layout_fill["fill-sort-key"])});var Fd={paint:new Ae({"fill-antialias":new ae(je.paint_fill["fill-antialias"]),"fill-opacity":new ue(je.paint_fill["fill-opacity"]),"fill-color":new ue(je.paint_fill["fill-color"]),"fill-outline-color":new ue(je.paint_fill["fill-outline-color"]),"fill-translate":new ae(je.paint_fill["fill-translate"]),"fill-translate-anchor":new ae(je.paint_fill["fill-translate-anchor"]),"fill-pattern":new Le(je.paint_fill["fill-pattern"])}),layout:Od};const Rd=ut([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Bd=ut([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:jd}=Rd;var Fu=pl;function pl(r,e,i,o,c){this.properties={},this.extent=i,this.type=0,this._pbf=r,this._geometry=-1,this._keys=o,this._values=c,r.readFields(Ud,this,e)}function Ud(r,e,i){r==1?e.id=i.readVarint():r==2?function(o,c){for(var m=o.readVarint()+o.pos;o.pos<m;){var y=c._keys[o.readVarint()],T=c._values[o.readVarint()];c.properties[y]=T}}(i,e):r==3?e.type=i.readVarint():r==4&&(e._geometry=i.pos)}function Nd(r){for(var e,i,o=0,c=0,m=r.length,y=m-1;c<m;y=c++)o+=((i=r[y]).x-(e=r[c]).x)*(e.y+i.y);return o}pl.types=["Unknown","Point","LineString","Polygon"],pl.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,i=r.readVarint()+r.pos,o=1,c=0,m=0,y=0,T=[];r.pos<i;){if(c<=0){var A=r.readVarint();o=7&A,c=A>>3}if(c--,o===1||o===2)m+=r.readSVarint(),y+=r.readSVarint(),o===1&&(e&&T.push(e),e=[]),e.push(new b(m,y));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&T.push(e),T},pl.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,i=1,o=0,c=0,m=0,y=1/0,T=-1/0,A=1/0,R=-1/0;r.pos<e;){if(o<=0){var N=r.readVarint();i=7&N,o=N>>3}if(o--,i===1||i===2)(c+=r.readSVarint())<y&&(y=c),c>T&&(T=c),(m+=r.readSVarint())<A&&(A=m),m>R&&(R=m);else if(i!==7)throw new Error("unknown command "+i)}return[y,A,T,R]},pl.prototype.toGeoJSON=function(r,e,i){var o,c,m=this.extent*Math.pow(2,i),y=this.extent*r,T=this.extent*e,A=this.loadGeometry(),R=pl.types[this.type];function N(Y){for(var oe=0;oe<Y.length;oe++){var be=Y[oe];Y[oe]=[360*(be.x+y)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(be.y+T)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var q=[];for(o=0;o<A.length;o++)q[o]=A[o][0];N(A=q);break;case 2:for(o=0;o<A.length;o++)N(A[o]);break;case 3:for(A=function(Y){var oe=Y.length;if(oe<=1)return[Y];for(var be,Ce,Fe=[],Ze=0;Ze<oe;Ze++){var Ye=Nd(Y[Ze]);Ye!==0&&(Ce===void 0&&(Ce=Ye<0),Ce===Ye<0?(be&&Fe.push(be),be=[Y[Ze]]):be.push(Y[Ze]))}return be&&Fe.push(be),Fe}(A),o=0;o<A.length;o++)for(c=0;c<A[o].length;c++)N(A[o][c])}A.length===1?A=A[0]:R="Multi"+R;var W={type:"Feature",geometry:{type:R,coordinates:A},properties:this.properties};return"id"in this&&(W.id=this.id),W};var Ru=Bu;function Bu(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(Gd,this,e),this.length=this._features.length}function Gd(r,e,i){r===15?e.version=i.readVarint():r===1?e.name=i.readString():r===5?e.extent=i.readVarint():r===2?e._features.push(i.pos):r===3?e._keys.push(i.readString()):r===4&&e._values.push(function(o){for(var c=null,m=o.readVarint()+o.pos;o.pos<m;){var y=o.readVarint()>>3;c=y===1?o.readString():y===2?o.readFloat():y===3?o.readDouble():y===4?o.readVarint64():y===5?o.readVarint():y===6?o.readSVarint():y===7?o.readBoolean():null}return c}(i))}function Vd(r,e,i){if(r===3){var o=new Ru(i,i.readVarint()+i.pos);o.length&&(e[o.name]=o)}}Bu.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new Fu(this._pbf,e,this.extent,this._keys,this._values)};var Ha={VectorTile:function(r,e){this.layers=r.readFields(Vd,{},e)},VectorTileFeature:Fu,VectorTileLayer:Ru};const ju=Ha.VectorTileFeature.types,qd=Math.pow(2,13);function Bl(r,e,i,o,c,m,y,T){r.emplaceBack((e<<1)+y,(i<<1)+m,(Math.floor(o*qd)<<1)+c,Math.round(T))}class Uu{constructor(){this.acc=new b(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new b(e.x,e.y),this.max=new b(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);let o=!!this.borders;const c=this.min,m=this.max;e.x<c.x?(c.x=e.x,o=!0):e.x>m.x&&(m.x=e.x,o=!0),e.y<c.y?(c.y=e.y,o=!0):e.y>m.y&&(m.y=e.y,o=!0),((e.x===0||e.x===sr)&&e.x===i.x)!=((e.y===0||e.y===sr)&&e.y===i.y)&&this.processBorderOverlap(e,i),o&&this.checkBorderIntersection(e,i)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Xn(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>sr!=e.x>sr&&this.addBorderIntersection(1,Xn(i.y,e.y,(sr-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Xn(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>sr!=e.y>sr&&this.addBorderIntersection(3,Xn(i.x,e.x,(sr-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,e.x)}}centroid(){const e=this.polyCount.reduce((i,o)=>i+o.edges,0);return e!==0?this.acc.div(e)._round():new b(0,0)}span(){return new b(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class Oc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Gt,this.centroidVertexArray=new Ho,this.indexArray=new Cn,this.programConfigurations=new Za(e.layers,e.zoom),this.segments=new vi,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,o){this.features=[],this.hasPattern=Lc("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(c){const m=Math.exp(Math.PI*(1-c.y/(1<<c.z)*2));return 80150034*m/(m*m+1)/sr/(1<<c.z)}(o);for(const{feature:c,id:m,index:y,sourceLayerIndex:T}of e){const A=this.layers[0]._featureFilter.needGeometry,R=Wa(c,A);if(!this.layers[0]._featureFilter.filter(new S(this.zoom),R,o))continue;const N={id:m,sourceLayerIndex:T,index:y,geometry:A?R.geometry:$a(c),properties:c.properties,type:c.type,patterns:{}},q=this.layoutVertexArray.length;this.hasPattern?this.features.push(Dc("fill-extrusion",this.layers,N,this.zoom,i)):this.addFeature(N,N.geometry,y,o,{}),i.featureIndex.insert(c,N.geometry,y,T,this.index,q)}this.sortBorders()}addFeatures(e,i,o){for(const c of this.features){const{geometry:m}=c;this.addFeature(c,m,c.index,i,o)}this.sortBorders()}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jd),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Bd.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,c,m){const y=this.enableTerrain&&e.properties&&ju[e.type]==="Polygon"?new Uu:null;for(const A of kc(i,500)){let R=0,N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(A.length===0||(T=A[0]).every(be=>be.x<=0)||T.every(be=>be.x>=sr)||T.every(be=>be.y<=0)||T.every(be=>be.y>=sr))continue;for(let be=0;be<A.length;be++){const Ce=A[be];if(Ce.length===0)continue;R+=Ce.length;let Fe=0;y&&y.startRing(Ce[0]);for(let Ze=0;Ze<Ce.length;Ze++){const Ye=Ce[Ze];if(Ze>=1){const ot=Ce[Ze-1];if(!Zd(Ye,ot)){y&&y.append(Ye,ot),N.vertexLength+4>vi.MAX_VERTEX_ARRAY_LENGTH&&(N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const st=Ye.sub(ot)._perp(),at=st.x/(Math.abs(st.x)+Math.abs(st.y)),Ot=st.y>0?1:0,At=ot.dist(Ye);Fe+At>32768&&(Fe=0),Bl(this.layoutVertexArray,Ye.x,Ye.y,at,Ot,0,0,Fe),Bl(this.layoutVertexArray,Ye.x,Ye.y,at,Ot,0,1,Fe),Fe+=At,Bl(this.layoutVertexArray,ot.x,ot.y,at,Ot,0,0,Fe),Bl(this.layoutVertexArray,ot.x,ot.y,at,Ot,0,1,Fe);const Tt=N.vertexLength;this.indexArray.emplaceBack(Tt,Tt+2,Tt+1),this.indexArray.emplaceBack(Tt+1,Tt+2,Tt+3),N.vertexLength+=4,N.primitiveLength+=2}}}}if(N.vertexLength+R>vi.MAX_VERTEX_ARRAY_LENGTH&&(N=this.segments.prepareSegment(R,this.layoutVertexArray,this.indexArray)),ju[e.type]!=="Polygon")continue;const q=[],W=[],Y=N.vertexLength;for(let be=0;be<A.length;be++){const Ce=A[be];if(Ce.length!==0){Ce!==A[0]&&W.push(q.length/2);for(let Fe=0;Fe<Ce.length;Fe++){const Ze=Ce[Fe];Bl(this.layoutVertexArray,Ze.x,Ze.y,0,0,1,1,0),q.push(Ze.x),q.push(Ze.y),y&&y.currentPolyCount.top++}}}const oe=Tc(q,W);for(let be=0;be<oe.length;be+=3)this.indexArray.emplaceBack(Y+oe[be],Y+oe[be+2],Y+oe[be+1]);N.primitiveLength+=oe.length/3,N.vertexLength+=R}var T;if(y&&y.polyCount.length>0){if(y.borders){y.vertexArrayOffset=this.centroidVertexArray.length;const A=y.borders,R=this.featuresOnBorder.push(y)-1;for(let N=0;N<4;N++)A[N][0]!==Number.MAX_VALUE&&this.borders[N].push(R)}this.encodeCentroid(y.borders?void 0:y.centroid(),y)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,m,c)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,o)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}encodeCentroid(e,i,o=!0){let c,m;if(e)if(e.y!==0){const T=i.span()._mult(this.tileToMeter);c=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(T.x/10)),m=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(T.y/10))}else c=Math.ceil(7*(e.x+450)),m=0;else c=0,m=+o;let y=o?this.centroidVertexArray.length:i.vertexArrayOffset;for(const T of i.polyCount){o&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*T.edges+T.top);for(let A=0;A<2*T.edges;A++)this.centroidVertexArray.emplace(y++,0,m),this.centroidVertexArray.emplace(y++,c,m);for(let A=0;A<T.top;A++)this.centroidVertexArray.emplace(y++,c,m)}}}function Zd(r,e){return r.x===e.x&&(r.x<0||r.x>sr)||r.y===e.y&&(r.y<0||r.y>sr)}Z("FillExtrusionBucket",Oc,{omit:["layers","features"]}),Z("PartMetadata",Uu);var $d={paint:new Ae({"fill-extrusion-opacity":new ae(je["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ue(je["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ae(je["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ae(je["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Le(je["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ue(je["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ue(je["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ae(je["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function jl(r,e){return r.x*e.x+r.y*e.y}function Nu(r,e){if(r.length===1){let i=0;const o=e[i++];let c;for(;!c||o.equals(c);)if(c=e[i++],!c)return 1/0;for(;i<e.length;i++){const m=e[i],y=r[0],T=c.sub(o),A=m.sub(o),R=y.sub(o),N=jl(T,T),q=jl(T,A),W=jl(A,A),Y=jl(R,T),oe=jl(R,A),be=N*W-q*q,Ce=(W*Y-q*oe)/be,Fe=(N*oe-q*Y)/be,Ze=o.z*(1-Ce-Fe)+c.z*Ce+m.z*Fe;if(isFinite(Ze))return Ze}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}function Gu(r){const e=new b(r[0],r[1]);return e.z=r[2],e}function Wd(r,e,i,o,c,m,y,T){const A=y*c.getElevationAt(r,e,!0,!0),R=m[0]!==0,N=R?m[1]===0?y*(m[0]/7-450):y*function(q,W,Y){const oe=Math.floor(W[0]/8),be=Math.floor(W[1]/8),Ce=10*(W[0]-8*oe),Fe=10*(W[1]-8*be),Ze=q.getElevationAt(oe,be,!0,!0),Ye=q.getMeterToDEM(Y),ot=Math.floor(.5*(Ce*Ye-1)),st=Math.floor(.5*(Fe*Ye-1)),at=q.tileCoordToPixel(oe,be),Ot=2*ot+1,At=2*st+1,Tt=function(xn,Rn,Gn,Vn,lr){return[xn.getElevationAtPixel(Rn,Gn,!0),xn.getElevationAtPixel(Rn+lr,Gn,!0),xn.getElevationAtPixel(Rn,Gn+lr,!0),xn.getElevationAtPixel(Rn+Vn,Gn+lr,!0)]}(q,at.x-ot,at.y-st,Ot,At),qt=Math.abs(Tt[0]-Tt[1]),bt=Math.abs(Tt[2]-Tt[3]),St=Math.abs(Tt[0]-Tt[2])+Math.abs(Tt[1]-Tt[3]),_t=Math.min(.25,.5*Ye*(qt+bt)/Ot),Mt=Math.min(.25,.5*Ye*St/At);return Ze+Math.max(_t*Ce,Mt*Fe)}(c,m,T):A;return{base:A+(i===0)?-1:i,top:R?Math.max(N+o,A+i+2):A+o}}const Hd=ut([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Xd}=Hd,Jd=ut([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Kd}=Jd,Yd=Ha.VectorTileFeature.types,Qd=Math.cos(Math.PI/180*37.5);class Fc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Lt,this.layoutVertexArray2=new pn,this.indexArray=new Cn,this.programConfigurations=new Za(e.layers,e.zoom),this.segments=new vi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o){this.hasPattern=Lc("line",this.layers,i);const c=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:R,id:N,index:q,sourceLayerIndex:W}of e){const Y=this.layers[0]._featureFilter.needGeometry,oe=Wa(R,Y);if(!this.layers[0]._featureFilter.filter(new S(this.zoom),oe,o))continue;const be=c?c.evaluate(oe,{},o):void 0,Ce={id:N,properties:R.properties,type:R.type,sourceLayerIndex:W,index:q,geometry:Y?oe.geometry:$a(R),patterns:{},sortKey:be};m.push(Ce)}c&&m.sort((R,N)=>R.sortKey-N.sortKey);const{lineAtlas:y,featureIndex:T}=i,A=this.addConstantDashes(y);for(const R of m){const{geometry:N,index:q,sourceLayerIndex:W}=R;if(A&&this.addFeatureDashes(R,y),this.hasPattern){const Y=Dc("line",this.layers,R,this.zoom,i);this.patternFeatures.push(Y)}else this.addFeature(R,N,q,o,y.positions);T.insert(e[q].feature,N,q,W,this.index)}}addConstantDashes(e){let i=!1;for(const o of this.layers){const c=o.paint.get("line-dasharray").value,m=o.layout.get("line-cap").value;if(c.kind!=="constant"||m.kind!=="constant")i=!0;else{const y=m.value,T=c.value;if(!T)continue;e.addDash(T.from,y),e.addDash(T.to,y),T.other&&e.addDash(T.other,y)}}return i}addFeatureDashes(e,i){const o=this.zoom;for(const c of this.layers){const m=c.paint.get("line-dasharray").value,y=c.layout.get("line-cap").value;if(m.kind==="constant"&&y.kind==="constant")continue;let T,A,R,N,q,W;if(m.kind==="constant"){const Ce=m.value;if(!Ce)continue;T=Ce.other||Ce.to,A=Ce.to,R=Ce.from}else T=m.evaluate({zoom:o-1},e),A=m.evaluate({zoom:o},e),R=m.evaluate({zoom:o+1},e);y.kind==="constant"?N=q=W=y.value:(N=y.evaluate({zoom:o-1},e),q=y.evaluate({zoom:o},e),W=y.evaluate({zoom:o+1},e)),i.addDash(T,N),i.addDash(A,q),i.addDash(R,W);const Y=i.getKey(T,N),oe=i.getKey(A,q),be=i.getKey(R,W);e.patterns[c.id]={min:Y,mid:oe,max:be}}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,o)}addFeatures(e,i,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,i,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Kd)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xd),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("vjmaps_clip_start")&&e.properties.hasOwnProperty("vjmaps_clip_end"))return{start:+e.properties.vjmaps_clip_start,end:+e.properties.vjmaps_clip_end}}addFeature(e,i,o,c,m){const y=this.layers[0].layout,T=y.get("line-join").evaluate(e,{}),A=y.get("line-cap").evaluate(e,{}),R=y.get("line-miter-limit"),N=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const q of i)this.addLine(q,e,T,A,R,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,m,c)}addLine(e,i,o,c,m,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Fe=0;Fe<e.length-1;Fe++)this.totalDistance+=e[Fe].dist(e[Fe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=Yd[i.type]==="Polygon";let A=e.length;for(;A>=2&&e[A-1].equals(e[A-2]);)A--;let R=0;for(;R<A-1&&e[R].equals(e[R+1]);)R++;if(A<(T?3:2))return;o==="bevel"&&(m=1.05);const N=this.overscaling<=16?122880/(512*this.overscaling):0,q=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let W,Y,oe,be,Ce;this.e1=this.e2=-1,T&&(W=e[A-2],Ce=e[R].sub(W)._unit()._perp());for(let Fe=R;Fe<A;Fe++){if(oe=Fe===A-1?T?e[R+1]:void 0:e[Fe+1],oe&&e[Fe].equals(oe))continue;Ce&&(be=Ce),W&&(Y=W),W=e[Fe],Ce=oe?oe.sub(W)._unit()._perp():be,be=be||Ce;let Ze=be.add(Ce);Ze.x===0&&Ze.y===0||Ze._unit();const Ye=be.x*Ce.x+be.y*Ce.y,ot=Ze.x*Ce.x+Ze.y*Ce.y,st=ot!==0?1/ot:1/0,at=2*Math.sqrt(2-2*ot),Ot=ot<Qd&&Y&&oe,At=be.x*Ce.y-be.y*Ce.x>0;if(Ot&&Fe>R){const bt=W.dist(Y);if(bt>2*N){const St=W.sub(W.sub(Y)._mult(N/bt)._round());this.updateDistance(Y,St),this.addCurrentVertex(St,be,0,0,q),Y=St}}const Tt=Y&&oe;let qt=Tt?o:T?"butt":c;if(Tt&&qt==="round"&&(st<y?qt="miter":st<=2&&(qt="fakeround")),qt==="miter"&&st>m&&(qt="bevel"),qt==="bevel"&&(st>2&&(qt="flipbevel"),st<m&&(qt="miter")),Y&&this.updateDistance(Y,W),qt==="miter")Ze._mult(st),this.addCurrentVertex(W,Ze,0,0,q);else if(qt==="flipbevel"){if(st>100)Ze=Ce.mult(-1);else{const bt=st*be.add(Ce).mag()/be.sub(Ce).mag();Ze._perp()._mult(bt*(At?-1:1))}this.addCurrentVertex(W,Ze,0,0,q),this.addCurrentVertex(W,Ze.mult(-1),0,0,q)}else if(qt==="bevel"||qt==="fakeround"){const bt=-Math.sqrt(st*st-1),St=At?bt:0,_t=At?0:bt;if(Y&&this.addCurrentVertex(W,be,St,_t,q),qt==="fakeround"){const Mt=Math.round(180*at/Math.PI/20);for(let xn=1;xn<Mt;xn++){let Rn=xn/Mt;if(Rn!==.5){const Vn=Rn-.5;Rn+=Rn*Vn*(Rn-1)*((1.0904+Ye*(Ye*(3.55645-1.43519*Ye)-3.2452))*Vn*Vn+(.848013+Ye*(.215638*Ye-1.06021)))}const Gn=Ce.sub(be)._mult(Rn)._add(be)._unit()._mult(At?-1:1);this.addHalfVertex(W,Gn.x,Gn.y,!1,At,0,q)}}oe&&this.addCurrentVertex(W,Ce,-St,-_t,q)}else if(qt==="butt")this.addCurrentVertex(W,Ze,0,0,q);else if(qt==="square"){const bt=Y?1:-1;Y||this.addCurrentVertex(W,Ze,bt,bt,q),this.addCurrentVertex(W,Ze,0,0,q),Y&&this.addCurrentVertex(W,Ze,bt,bt,q)}else qt==="round"&&(Y&&(this.addCurrentVertex(W,be,0,0,q),this.addCurrentVertex(W,be,1,1,q,!0)),oe&&(this.addCurrentVertex(W,Ce,-1,-1,q,!0),this.addCurrentVertex(W,Ce,0,0,q)));if(Ot&&Fe<A-1){const bt=W.dist(oe);if(bt>2*N){const St=W.add(oe.sub(W)._mult(N/bt)._round());this.updateDistance(W,St),this.addCurrentVertex(St,Ce,0,0,q),W=St}}}}addCurrentVertex(e,i,o,c,m,y=!1){const T=i.y*c-i.x,A=-i.y-i.x*c;this.addHalfVertex(e,i.x+i.y*o,i.y-i.x*o,y,!1,o,m),this.addHalfVertex(e,T,A,y,!0,-c,m)}addHalfVertex({x:e,y:i},o,c,m,y,T,A){this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(i<<1)+(y?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(T===0?0:T<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length);const R=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),A.primitiveLength++),y?this.e2=R:this.e1=R}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}Z("LineBucket",Fc,{omit:["layers","patternFeatures"]});const ep=new Ae({"line-cap":new ue(je.layout_line["line-cap"]),"line-join":new ue(je.layout_line["line-join"]),"line-miter-limit":new ae(je.layout_line["line-miter-limit"]),"line-round-limit":new ae(je.layout_line["line-round-limit"]),"line-sort-key":new ue(je.layout_line["line-sort-key"])});var Vu={paint:new Ae({"line-opacity":new ue(je.paint_line["line-opacity"]),"line-color":new ue(je.paint_line["line-color"]),"line-translate":new ae(je.paint_line["line-translate"]),"line-translate-anchor":new ae(je.paint_line["line-translate-anchor"]),"line-width":new ue(je.paint_line["line-width"]),"line-gap-width":new ue(je.paint_line["line-gap-width"]),"line-offset":new ue(je.paint_line["line-offset"]),"line-blur":new ue(je.paint_line["line-blur"]),"line-dasharray":new Le(je.paint_line["line-dasharray"]),"line-pattern":new Le(je.paint_line["line-pattern"]),"line-gradient":new Me(je.paint_line["line-gradient"])}),layout:ep};const qu=new class extends ue{possiblyEvaluate(r,e){return e=new S(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(r,e)}evaluate(r,e,i,o){return e=Pe({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(r,e,i,o)}}(Vu.paint.properties["line-width"].specification);function Zu(r,e){return e>0?e+2*r:r}qu.useIntegerZoom=!0;const tp=ut([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),np=ut([{name:"a_projected_pos",components:3,type:"Float32"}],4);ut([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const rp=ut([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),ip=ut([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ut([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const $u=ut([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),op=ut([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ut([{name:"triangle",components:3,type:"Uint16"}]),ut([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ut([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ut([{type:"Float32",name:"offsetX"}]),ut([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const ws=128;function Rc(r,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new S(r+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:c}=i;let m=0;for(;m<o.length&&o[m]<=r;)m++;m=Math.max(0,m-1);let y=m;for(;y<o.length&&o[y]<r+1;)y++;y=Math.min(o.length-1,y);const T=o[m],A=o[y];return i.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:A,interpolationType:c}:{kind:"camera",minZoom:T,maxZoom:A,minSize:i.evaluate(new S(T)),maxSize:i.evaluate(new S(A)),interpolationType:c}}}function tc(r,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:c}){return r.kind==="source"?o/ws:r.kind==="composite"?Xn(o/ws,c/ws,i):e}function fl(r,e){let i=0,o=0;if(r.kind==="constant")o=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:c,minZoom:m,maxZoom:y}=r,T=c?le(Er.interpolationFactor(c,e,m,y),0,1):0;r.kind==="camera"?o=Xn(r.minSize,r.maxSize,T):i=T}return{uSizeT:i,uSize:o}}var sp=Object.freeze({__proto__:null,getSizeData:Rc,evaluateSizeForFeature:tc,evaluateSizeForZoom:fl,SIZE_PACK_FACTOR:ws});function ap(r,e,i){return r.sections.forEach(o=>{o.text=function(c,m,y){const T=m.layout.get("text-transform").evaluate(y,{});return T==="uppercase"?c=c.toLocaleUpperCase():T==="lowercase"&&(c=c.toLocaleLowerCase()),x.applyArabicShaping&&(c=x.applyArabicShaping(c)),c}(o.text,e,i)}),r}const Ul={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var Wu=function(r,e,i,o,c){var m,y,T=8*c-o-1,A=(1<<T)-1,R=A>>1,N=-7,q=i?c-1:0,W=i?-1:1,Y=r[e+q];for(q+=W,m=Y&(1<<-N)-1,Y>>=-N,N+=T;N>0;m=256*m+r[e+q],q+=W,N-=8);for(y=m&(1<<-N)-1,m>>=-N,N+=o;N>0;y=256*y+r[e+q],q+=W,N-=8);if(m===0)m=1-R;else{if(m===A)return y?NaN:1/0*(Y?-1:1);y+=Math.pow(2,o),m-=R}return(Y?-1:1)*y*Math.pow(2,m-o)},Hu=function(r,e,i,o,c,m){var y,T,A,R=8*m-c-1,N=(1<<R)-1,q=N>>1,W=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,Y=o?0:m-1,oe=o?1:-1,be=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(T=isNaN(e)?1:0,y=N):(y=Math.floor(Math.log(e)/Math.LN2),e*(A=Math.pow(2,-y))<1&&(y--,A*=2),(e+=y+q>=1?W/A:W*Math.pow(2,1-q))*A>=2&&(y++,A/=2),y+q>=N?(T=0,y=N):y+q>=1?(T=(e*A-1)*Math.pow(2,c),y+=q):(T=e*Math.pow(2,q-1)*Math.pow(2,c),y=0));c>=8;r[i+Y]=255&T,Y+=oe,T/=256,c-=8);for(y=y<<c|T,R+=c;R>0;r[i+Y]=255&y,Y+=oe,y/=256,R-=8);r[i+Y-oe]|=128*be},Nl=cr;function cr(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}cr.Varint=0,cr.Fixed64=1,cr.Bytes=2,cr.Fixed32=5;var Bc=4294967296,Xu=1/Bc,Ju=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Hs(r){return r.type===cr.Bytes?r.readVarint()+r.pos:r.pos+1}function ml(r,e,i){return i?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function Ku(r,e,i){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(var c=i.pos-1;c>=r;c--)i.buf[c+o]=i.buf[c]}function lp(r,e){for(var i=0;i<r.length;i++)e.writeVarint(r[i])}function cp(r,e){for(var i=0;i<r.length;i++)e.writeSVarint(r[i])}function up(r,e){for(var i=0;i<r.length;i++)e.writeFloat(r[i])}function hp(r,e){for(var i=0;i<r.length;i++)e.writeDouble(r[i])}function dp(r,e){for(var i=0;i<r.length;i++)e.writeBoolean(r[i])}function pp(r,e){for(var i=0;i<r.length;i++)e.writeFixed32(r[i])}function fp(r,e){for(var i=0;i<r.length;i++)e.writeSFixed32(r[i])}function mp(r,e){for(var i=0;i<r.length;i++)e.writeFixed64(r[i])}function gp(r,e){for(var i=0;i<r.length;i++)e.writeSFixed64(r[i])}function nc(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function gl(r,e,i){r[i]=e,r[i+1]=e>>>8,r[i+2]=e>>>16,r[i+3]=e>>>24}function Yu(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}function yp(r,e,i){r===1&&i.readMessage(_p,e)}function _p(r,e,i){if(r===3){const{id:o,bitmap:c,width:m,height:y,left:T,top:A,advance:R}=i.readMessage(vp,{});e.push({id:o,bitmap:new ba({width:m+6,height:y+6},c),metrics:{width:m,height:y,left:T,top:A,advance:R}})}}function vp(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}function jc(r){let e=0,i=0;for(const y of r)e+=y.w*y.h,i=Math.max(i,y.w);r.sort((y,T)=>T.h-y.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let c=0,m=0;for(const y of r)for(let T=o.length-1;T>=0;T--){const A=o[T];if(!(y.w>A.w||y.h>A.h)){if(y.x=A.x,y.y=A.y,m=Math.max(m,y.y+y.h),c=Math.max(c,y.x+y.w),y.w===A.w&&y.h===A.h){const R=o.pop();T<o.length&&(o[T]=R)}else y.h===A.h?(A.x+=y.w,A.w-=y.w):y.w===A.w?(A.y+=y.h,A.h-=y.h):(o.push({x:A.x+y.w,y:A.y,w:A.w-y.w,h:y.h}),A.y+=y.h,A.h-=y.h);break}}return{w:c,h:m,fill:e/(c*m)||0}}cr.prototype={destroy:function(){this.buf=null},readFields:function(r,e,i){for(i=i||this.length;this.pos<i;){var o=this.readVarint(),c=o>>3,m=this.pos;this.type=7&o,r(c,e,this),this.pos===m&&this.skip(o)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=nc(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Yu(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=nc(this.buf,this.pos)+nc(this.buf,this.pos+4)*Bc;return this.pos+=8,r},readSFixed64:function(){var r=nc(this.buf,this.pos)+Yu(this.buf,this.pos+4)*Bc;return this.pos+=8,r},readFloat:function(){var r=Wu(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=Wu(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,i,o=this.buf;return e=127&(i=o[this.pos++]),i<128?e:(e|=(127&(i=o[this.pos++]))<<7,i<128?e:(e|=(127&(i=o[this.pos++]))<<14,i<128?e:(e|=(127&(i=o[this.pos++]))<<21,i<128?e:function(c,m,y){var T,A,R=y.buf;if(T=(112&(A=R[y.pos++]))>>4,A<128||(T|=(127&(A=R[y.pos++]))<<3,A<128)||(T|=(127&(A=R[y.pos++]))<<10,A<128)||(T|=(127&(A=R[y.pos++]))<<17,A<128)||(T|=(127&(A=R[y.pos++]))<<24,A<128)||(T|=(1&(A=R[y.pos++]))<<31,A<128))return ml(c,T,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=o[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&Ju?function(i,o,c){return Ju.decode(i.subarray(o,c))}(this.buf,e,r):function(i,o,c){for(var m="",y=o;y<c;){var T,A,R,N=i[y],q=null,W=N>239?4:N>223?3:N>191?2:1;if(y+W>c)break;W===1?N<128&&(q=N):W===2?(192&(T=i[y+1]))==128&&(q=(31&N)<<6|63&T)<=127&&(q=null):W===3?(A=i[y+2],(192&(T=i[y+1]))==128&&(192&A)==128&&((q=(15&N)<<12|(63&T)<<6|63&A)<=2047||q>=55296&&q<=57343)&&(q=null)):W===4&&(A=i[y+2],R=i[y+3],(192&(T=i[y+1]))==128&&(192&A)==128&&(192&R)==128&&((q=(15&N)<<18|(63&T)<<12|(63&A)<<6|63&R)<=65535||q>=1114112)&&(q=null)),q===null?(q=65533,W=1):q>65535&&(q-=65536,m+=String.fromCharCode(q>>>10&1023|55296),q=56320|1023&q),m+=String.fromCharCode(q),y+=W}return m}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==cr.Bytes)return r.push(this.readVarint(e));var i=Hs(this);for(r=r||[];this.pos<i;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==cr.Bytes)return r.push(this.readSVarint());var e=Hs(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==cr.Bytes)return r.push(this.readBoolean());var e=Hs(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==cr.Bytes)return r.push(this.readFloat());var e=Hs(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==cr.Bytes)return r.push(this.readDouble());var e=Hs(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==cr.Bytes)return r.push(this.readFixed32());var e=Hs(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==cr.Bytes)return r.push(this.readSFixed32());var e=Hs(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==cr.Bytes)return r.push(this.readFixed64());var e=Hs(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==cr.Bytes)return r.push(this.readSFixed64());var e=Hs(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===cr.Varint)for(;this.buf[this.pos++]>127;);else if(e===cr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===cr.Fixed32)this.pos+=4;else{if(e!==cr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),gl(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),gl(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),gl(this.buf,-1&r,this.pos),gl(this.buf,Math.floor(r*Xu),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),gl(this.buf,-1&r,this.pos),gl(this.buf,Math.floor(r*Xu),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,i){var o,c;if(e>=0?(o=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(m,y,T){T.buf[T.pos++]=127&m|128,m>>>=7,T.buf[T.pos++]=127&m|128,m>>>=7,T.buf[T.pos++]=127&m|128,m>>>=7,T.buf[T.pos++]=127&m|128,T.buf[T.pos]=127&(m>>>=7)}(o,0,i),function(m,y){var T=(7&m)<<4;y.buf[y.pos++]|=T|((m>>>=3)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m)))))}(c,i)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(Boolean(r))},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(o,c,m){for(var y,T,A=0;A<c.length;A++){if((y=c.charCodeAt(A))>55295&&y<57344){if(!T){y>56319||A+1===c.length?(o[m++]=239,o[m++]=191,o[m++]=189):T=y;continue}if(y<56320){o[m++]=239,o[m++]=191,o[m++]=189,T=y;continue}y=T-55296<<10|y-56320|65536,T=null}else T&&(o[m++]=239,o[m++]=191,o[m++]=189,T=null);y<128?o[m++]=y:(y<2048?o[m++]=y>>6|192:(y<65536?o[m++]=y>>12|224:(o[m++]=y>>18|240,o[m++]=y>>12&63|128),o[m++]=y>>6&63|128),o[m++]=63&y|128)}return m}(this.buf,r,this.pos);var i=this.pos-e;i>=128&&Ku(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(r){this.realloc(4),Hu(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Hu(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=r[i]},writeRawMessage:function(r,e){this.pos++;var i=this.pos;r(e,this);var o=this.pos-i;o>=128&&Ku(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o},writeMessage:function(r,e,i){this.writeTag(r,cr.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,lp,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,cp,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,dp,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,up,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,hp,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,pp,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,fp,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,mp,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,gp,e)},writeBytesField:function(r,e){this.writeTag(r,cr.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,cr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,cr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,cr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,cr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,cr.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,cr.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,cr.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,cr.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,cr.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,Boolean(e))}};class Uc{constructor(e,{pixelRatio:i,version:o,stretchX:c,stretchY:m,content:y}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=c,this.stretchY=m,this.content=y,this.version=o}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Qu{constructor(e,i){const o={},c={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,o,m),this.addImages(i,c,m);const{w:y,h:T}=jc(m),A=new So({width:y||1,height:T||1});for(const R in e){const N=e[R],q=o[R].paddedRect;So.copy(N.data,A,{x:0,y:0},{x:q.x+1,y:q.y+1},N.data)}for(const R in i){const N=i[R],q=c[R].paddedRect,W=q.x+1,Y=q.y+1,oe=N.data.width,be=N.data.height;So.copy(N.data,A,{x:0,y:0},{x:W,y:Y},N.data),So.copy(N.data,A,{x:0,y:be-1},{x:W,y:Y-1},{width:oe,height:1}),So.copy(N.data,A,{x:0,y:0},{x:W,y:Y+be},{width:oe,height:1}),So.copy(N.data,A,{x:oe-1,y:0},{x:W-1,y:Y},{width:1,height:be}),So.copy(N.data,A,{x:0,y:0},{x:W+oe,y:Y},{width:1,height:be})}this.image=A,this.iconPositions=o,this.patternPositions=c}addImages(e,i,o){for(const c in e){const m=e[c],y={x:0,y:0,w:m.data.width+2,h:m.data.height+2};o.push(y),i[c]=new Uc(y,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,i){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),i),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),i)}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[c,m]=e.tl;o.update(i.data,void 0,{x:c,y:m})}}Z("ImagePosition",Uc),Z("ImageAtlas",Qu);const so={horizontal:1,vertical:2,horizontalOnly:3};class Gl{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const o=new Gl;return o.scale=e||1,o.fontStack=i,o}static forImage(e){const i=new Gl;return i.imageName=e,i}}class yl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const o=new yl;for(let c=0;c<e.sections.length;c++){const m=e.sections[c];m.image?o.addImageSection(m):o.addTextSection(m,i)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let i="";for(let o=0;o<e.length;o++){const c=e.charCodeAt(o+1)||null,m=e.charCodeAt(o-1)||null;i+=c&&ge(c)&&!Ul[e[o+1]]||m&&ge(m)&&!Ul[e[o-1]]||!Ul[e[o]]?e[o]:Ul[e[o]]}return i}(this.text)}trim(){let e=0;for(let o=0;o<this.text.length&&ic[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&ic[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const o=new yl;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Gl.forText(e.scale,e.fontStack||i));const o=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(o)}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void rn("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Gl.forImage(i)),this.sectionIndex.push(this.sections.length-1)):rn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function rc(r,e,i,o,c,m,y,T,A,R,N,q,W,Y,oe,be){const Ce=yl.fromFeature(r,c);let Fe;q===so.vertical&&Ce.verticalizePunctuation();const{processBidirectionalText:Ze,processStyledBidirectionalText:Ye}=x;if(Ze&&Ce.sections.length===1){Fe=[];const at=Ze(Ce.toString(),Nc(Ce,R,m,e,o,Y,oe));for(const Ot of at){const At=new yl;At.text=Ot,At.sections=Ce.sections;for(let Tt=0;Tt<Ot.length;Tt++)At.sectionIndex.push(0);Fe.push(At)}}else if(Ye){Fe=[];const at=Ye(Ce.text,Ce.sectionIndex,Nc(Ce,R,m,e,o,Y,oe));for(const Ot of at){const At=new yl;At.text=Ot[0],At.sectionIndex=Ot[1],At.sections=Ce.sections,Fe.push(At)}}else Fe=function(at,Ot){const At=[],Tt=at.text;let qt=0;for(const bt of Ot)At.push(at.substring(qt,bt)),qt=bt;return qt<Tt.length&&At.push(at.substring(qt,Tt.length)),At}(Ce,Nc(Ce,R,m,e,o,Y,oe));const ot=[],st={positionedLines:ot,text:Ce.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:q,iconsInText:!1,verticalizable:!1};return function(at,Ot,At,Tt,qt,bt,St,_t,Mt,xn,Rn,Gn){let Vn=0,lr=-17,er=0,En=0;const Nr=_t==="right"?1:_t==="left"?0:.5;let Kr=0;for(const kr of qt){kr.trim();const jr=kr.getMaxScale(),Zr=24*(jr-1),ii={positionedGlyphs:[],lineOffset:0};at.positionedLines[Kr]=ii;const di=ii.positionedGlyphs;let pr=0;if(!kr.length()){lr+=bt,++Kr;continue}for(let Gr=0;Gr<kr.length();Gr++){const qn=kr.getSection(Gr),Mo=kr.getSectionIndex(Gr),Sr=kr.getCharCode(Gr);let $i=0,Qr=null,Ro=null,Bo=null,Ta=24;const es=!(Mt===so.horizontal||!Rn&&!ie(Sr)||Rn&&(ic[Sr]||(Br=Sr,_e(Br)||De(Br)||Ge(Br)||ni(Br)||Di(Br))));if(qn.imageName){const Xs=Tt[qn.imageName];if(!Xs)continue;Bo=qn.imageName,at.iconsInText=at.iconsInText||!0,Ro=Xs.paddedRect;const Wi=Xs.displaySize;qn.scale=24*qn.scale/Gn,Qr={width:Wi[0],height:Wi[1],left:1,top:-3,advance:es?Wi[1]:Wi[0],localGlyph:!1},$i=Zr+(24-Wi[1]*qn.scale),Ta=Qr.advance;const Js=es?Wi[0]*qn.scale-24*jr:Wi[1]*qn.scale-24*jr;Js>0&&Js>pr&&(pr=Js)}else{const Xs=At[qn.fontStack],Wi=Xs&&Xs[Sr];if(Wi&&Wi.rect)Ro=Wi.rect,Qr=Wi.metrics;else{const Js=Ot[qn.fontStack],Zl=Js&&Js[Sr];if(!Zl)continue;Qr=Zl.metrics}$i=24*(jr-qn.scale)}es?(at.verticalizable=!0,di.push({glyph:Sr,imageName:Bo,x:Vn,y:lr+$i,vertical:es,scale:qn.scale,localGlyph:Qr.localGlyph,fontStack:qn.fontStack,sectionIndex:Mo,metrics:Qr,rect:Ro}),Vn+=Ta*qn.scale+xn):(di.push({glyph:Sr,imageName:Bo,x:Vn,y:lr+$i,vertical:es,scale:qn.scale,localGlyph:Qr.localGlyph,fontStack:qn.fontStack,sectionIndex:Mo,metrics:Qr,rect:Ro}),Vn+=Qr.advance*qn.scale+xn)}di.length!==0&&(er=Math.max(Vn-xn,er),wp(di,0,di.length-1,Nr,pr)),Vn=0;const ur=bt*jr+pr;ii.lineOffset=Math.max(pr,Zr),lr+=ur,En=Math.max(ur,En),++Kr}var Br;const Yr=lr- -17,{horizontalAlign:hi,verticalAlign:ri}=Gc(St);(function(kr,jr,Zr,ii,di,pr,ur,Gr,qn){const Mo=(jr-Zr)*di;let Sr=0;Sr=pr!==ur?-Gr*ii- -17:(-ii*qn+.5)*ur;for(const $i of kr)for(const Qr of $i.positionedGlyphs)Qr.x+=Mo,Qr.y+=Sr})(at.positionedLines,Nr,hi,ri,er,En,bt,Yr,qt.length),at.top+=-ri*Yr,at.bottom=at.top+Yr,at.left+=-hi*er,at.right=at.left+er}(st,e,i,o,Fe,y,T,A,q,R,W,be),!function(at){for(const Ot of at)if(Ot.positionedGlyphs.length!==0)return!1;return!0}(ot)&&st}const ic={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},xp={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function eh(r,e,i,o,c,m){if(e.imageName){const y=o[e.imageName];return y?y.displaySize[0]*e.scale*24/m+c:0}{const y=i[e.fontStack],T=y&&y[r];return T?T.metrics.advance*e.scale+c:0}}function th(r,e,i,o){const c=Math.pow(r-e,2);return o?r<e?c/2:2*c:c+Math.abs(i)*i}function bp(r,e,i){let o=0;return r===10&&(o-=1e4),i&&(o+=150),r!==40&&r!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function nh(r,e,i,o,c,m){let y=null,T=th(e,i,c,m);for(const A of o){const R=th(e-A.x,i,c,m)+A.badness;R<=T&&(y=A,T=R)}return{index:r,x:e,priorBreak:y,badness:T}}function Nc(r,e,i,o,c,m,y){if(m!=="point")return[];if(!r)return[];const T=[],A=function(W,Y,oe,be,Ce,Fe){let Ze=0;for(let Ye=0;Ye<W.length();Ye++){const ot=W.getSection(Ye);Ze+=eh(W.getCharCode(Ye),ot,be,Ce,Y,Fe)}return Ze/Math.max(1,Math.ceil(Ze/oe))}(r,e,i,o,c,y),R=r.text.indexOf("\u200B")>=0;let N=0;for(let W=0;W<r.length();W++){const Y=r.getSection(W),oe=r.getCharCode(W);if(ic[oe]||(N+=eh(oe,Y,o,c,e,y)),W<r.length()-1){const be=!((q=oe)<11904||!(wt(q)||qe(q)||ci(q)||fr(q)||Ht(q)||Xe(q)||pt(q)||Wt(q)||_n(q)||gn(q)||en(q)||mr(q)||Nt(q)||Zt(q)||it(q)||Jt(q)||Te(q)||Li(q)||Kn(q)||Un(q)));(xp[oe]||be||Y.imageName)&&T.push(nh(W+1,N,A,T,bp(oe,r.getCharCode(W+1),be&&R),!1))}}var q;return function W(Y){return Y?W(Y.priorBreak).concat(Y.index):[]}(nh(r.length(),N,A,T,0,!0))}function Gc(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function wp(r,e,i,o,c){if(!o&&!c)return;const m=r[i],y=(r[i].x+m.metrics.advance*m.scale)*o;for(let T=e;T<=i;T++)r[T].x-=y,r[T].y+=c}function Sp(r,e,i){const{horizontalAlign:o,verticalAlign:c}=Gc(i),m=e[0]-r.displaySize[0]*o,y=e[1]-r.displaySize[1]*c;return{image:r,top:y,bottom:y+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function rh(r,e,i,o,c,m){const y=r.image;let T;if(y.content){const Ce=y.content,Fe=y.pixelRatio||1;T=[Ce[0]/Fe,Ce[1]/Fe,y.displaySize[0]-Ce[2]/Fe,y.displaySize[1]-Ce[3]/Fe]}const A=e.left*m,R=e.right*m;let N,q,W,Y;i==="width"||i==="both"?(Y=c[0]+A-o[3],q=c[0]+R+o[1]):(Y=c[0]+(A+R-y.displaySize[0])/2,q=Y+y.displaySize[0]);const oe=e.top*m,be=e.bottom*m;return i==="height"||i==="both"?(N=c[1]+oe-o[0],W=c[1]+be+o[2]):(N=c[1]+(oe+be-y.displaySize[1])/2,W=N+y.displaySize[1]),{image:y,top:N,right:q,bottom:W,left:Y,collisionPadding:T}}class Sa extends b{constructor(e,i,o,c){super(e,i),this.angle=o,c!==void 0&&(this.segment=c)}clone(){return new Sa(this.x,this.y,this.angle,this.segment)}}function ih(r,e,i,o,c){if(e.segment===void 0)return!0;let m=e,y=e.segment+1,T=0;for(;T>-i/2;){if(y--,y<0)return!1;T-=r[y].dist(m),m=r[y]}T+=r[y].dist(r[y+1]),y++;const A=[];let R=0;for(;T<i/2;){const N=r[y],q=r[y+1];if(!q)return!1;let W=r[y-1].angleTo(N)-N.angleTo(q);for(W=Math.abs((W+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:T,angleDelta:W}),R+=W;T-A[0].distance>o;)R-=A.shift().angleDelta;if(R>c)return!1;y++,T+=N.dist(q)}return!0}function oh(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function sh(r,e,i){return r?.6*e*i:0}function ah(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function Mp(r,e,i,o,c,m){const y=sh(i,c,m),T=ah(i,o)*m;let A=0;const R=oh(r)/2;for(let N=0;N<r.length-1;N++){const q=r[N],W=r[N+1],Y=q.dist(W);if(A+Y>R){const oe=(R-A)/Y,be=Xn(q.x,W.x,oe),Ce=Xn(q.y,W.y,oe),Fe=new Sa(be,Ce,W.angleTo(q),N);return Fe._round(),!y||ih(r,Fe,T,y,e)?Fe:void 0}A+=Y}}function Ep(r,e,i,o,c,m,y,T,A){const R=sh(o,m,y),N=ah(o,c),q=N*y,W=r[0].x===0||r[0].x===A||r[0].y===0||r[0].y===A;return e-q<e/4&&(e=q+e/4),function Y(oe,be,Ce,Fe,Ze,Ye,ot,st,at){const Ot=Ye/2,At=oh(oe);let Tt=0,qt=be-Ce,bt=[];for(let St=0;St<oe.length-1;St++){const _t=oe[St],Mt=oe[St+1],xn=_t.dist(Mt),Rn=Mt.angleTo(_t);for(;qt+Ce<Tt+xn;){qt+=Ce;const Gn=(qt-Tt)/xn,Vn=Xn(_t.x,Mt.x,Gn),lr=Xn(_t.y,Mt.y,Gn);if(Vn>=0&&Vn<at&&lr>=0&&lr<at&&qt-Ot>=0&&qt+Ot<=At){const er=new Sa(Vn,lr,Rn,St);er._round(),Fe&&!ih(oe,er,Ye,Fe,Ze)||bt.push(er)}}Tt+=xn}return st||bt.length||ot||(bt=Y(oe,Tt/2,Ce,Fe,Ze,Ye,ot,!0,at)),bt}(r,W?e/2*T%e:(N/2+2*m)*y*T%e,e,R,i,q,W,!1,A)}function lh(r,e,i,o,c){const m=[];for(let y=0;y<r.length;y++){const T=r[y];let A;for(let R=0;R<T.length-1;R++){let N=T[R],q=T[R+1];N.x<e&&q.x<e||(N.x<e?N=new b(e,N.y+(e-N.x)/(q.x-N.x)*(q.y-N.y))._round():q.x<e&&(q=new b(e,N.y+(e-N.x)/(q.x-N.x)*(q.y-N.y))._round()),N.y<i&&q.y<i||(N.y<i?N=new b(N.x+(i-N.y)/(q.y-N.y)*(q.x-N.x),i)._round():q.y<i&&(q=new b(N.x+(i-N.y)/(q.y-N.y)*(q.x-N.x),i)._round()),N.x>=o&&q.x>=o||(N.x>=o?N=new b(o,N.y+(o-N.x)/(q.x-N.x)*(q.y-N.y))._round():q.x>=o&&(q=new b(o,N.y+(o-N.x)/(q.x-N.x)*(q.y-N.y))._round()),N.y>=c&&q.y>=c||(N.y>=c?N=new b(N.x+(c-N.y)/(q.y-N.y)*(q.x-N.x),c)._round():q.y>=c&&(q=new b(N.x+(c-N.y)/(q.y-N.y)*(q.x-N.x),c)._round()),A&&N.equals(A[A.length-1])||(A=[N],m.push(A)),A.push(q)))))}}return m}Z("Anchor",Sa);var ch=Vl,Ip=Vl,_l=1e20;function Vl(r,e,i,o,c,m){this.fontSize=r||24,this.buffer=e===void 0?3:e,this.cutoff=o||.25,this.fontFamily=c||"sans-serif",this.fontWeight=m||"normal",this.radius=i||8;var y=this.size=this.fontSize+2*this.buffer,T=y+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=y,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(y/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function uh(r,e,i,o,c,m){for(var y=0;y<e;y++)hh(r,y,e,i,o,c,m);for(var T=0;T<i;T++)hh(r,T*e,1,e,o,c,m)}function hh(r,e,i,o,c,m,y){var T,A,R,N;for(m[0]=0,y[0]=-_l,y[1]=_l,T=0;T<o;T++)c[T]=r[e+T*i];for(T=1,A=0,R=0;T<o;T++){do R=(c[T]-c[N=m[A]]+T*T-N*N)/(T-N)/2;while(R<=y[A]&&--A>-1);m[++A]=T,y[A]=R,y[A+1]=_l}for(T=0,A=0;T<o;T++){for(;y[A+1]<T;)A++;r[e+T*i]=c[N=m[A]]+(T-N)*(T-N)}}Vl.prototype._draw=function(r,e){var i,o,c,m,y,T,A,R,N,q=this.ctx.measureText(r),W=q.width,Y=2*this.buffer;e&&this.useMetrics?(y=Math.floor(q.actualBoundingBoxAscent),R=this.buffer+Math.ceil(q.actualBoundingBoxAscent),T=this.buffer,A=this.buffer,i=(o=Math.min(this.size,Math.ceil(q.actualBoundingBoxRight-q.actualBoundingBoxLeft)))+Y,c=(m=Math.min(this.size-T,Math.ceil(q.actualBoundingBoxAscent+q.actualBoundingBoxDescent)))+Y,this.ctx.textBaseline="alphabetic"):(i=o=this.size,c=m=this.size,y=19*this.fontSize/24,T=A=0,R=this.middle,this.ctx.textBaseline="middle"),o&&m&&(this.ctx.clearRect(A,T,o,m),this.ctx.fillText(r,this.buffer,R),N=this.ctx.getImageData(A,T,o,m));var oe=new Uint8ClampedArray(i*c);return function(be,Ce,Fe,Ze,Ye,ot,st){ot.fill(_l,0,Ce*Fe),st.fill(0,0,Ce*Fe);for(var at=(Ce-Ze)/2,Ot=0;Ot<Ye;Ot++)for(var At=0;At<Ze;At++){var Tt=(Ot+at)*Ce+At+at,qt=be.data[4*(Ot*Ze+At)+3]/255;if(qt===1)ot[Tt]=0,st[Tt]=_l;else if(qt===0)ot[Tt]=_l,st[Tt]=0;else{var bt=Math.max(0,.5-qt),St=Math.max(0,qt-.5);ot[Tt]=bt*bt,st[Tt]=St*St}}}(N,i,c,o,m,this.gridOuter,this.gridInner),uh(this.gridOuter,i,c,this.f,this.v,this.z),uh(this.gridInner,i,c,this.f,this.v,this.z),function(be,Ce,Fe,Ze,Ye,ot,st){for(var at=0;at<Ce*Fe;at++){var Ot=Math.sqrt(Ze[at])-Math.sqrt(Ye[at]);be[at]=Math.round(255-255*(Ot/ot+st))}}(oe,i,c,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:oe,metrics:{width:o,height:m,sdfWidth:i,sdfHeight:c,top:y,left:0,advance:W}}},Vl.prototype.draw=function(r){return this._draw(r,!1).data},Vl.prototype.drawWithMetrics=function(r){return this._draw(r,!0)},ch.default=Ip;const Vc={none:0,ideographs:1,all:2};class vl{constructor(e,i,o){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=o,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const o=[];for(const c in e)for(const m of e[c])o.push({stack:c,id:m});de(o,({stack:c,id:m},y)=>{let T=this.entries[c];T||(T=this.entries[c]={glyphs:{},requests:{},ranges:{}});let A=T.glyphs[m];if(A!==void 0)return void y(null,{stack:c,id:m,glyph:A});if(A=this._tinySDF(T,c,m),A)return T.glyphs[m]=A,void y(null,{stack:c,id:m,glyph:A});const R=Math.floor(m/256);if(256*R>65535)return void y(new Error("glyphs > 65535 not supported"));if(T.ranges[R])return void y(null,{stack:c,id:m,glyph:A});let N=T.requests[R];N||(N=T.requests[R]=[],vl.loadGlyphRange(c,R,this.url,this.requestManager,(q,W)=>{if(W){for(const Y in W)this._doesCharSupportLocalGlyph(+Y)||(T.glyphs[+Y]=W[+Y]);T.ranges[R]=!0}for(const Y of N)Y(q,W);delete T.requests[R]})),N.push((q,W)=>{q?y(q):W&&y(null,{stack:c,id:m,glyph:W[m]||null})})},(c,m)=>{if(c)i(c);else if(m){const y={};for(const{stack:T,id:A,glyph:R}of m)(y[T]||(y[T]={}))[A]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics};i(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Vc.none&&(this.localGlyphMode===Vc.all?!!this.localFontFamily:!!this.localFontFamily&&(gn(e)||Tn(e)||Nt(e)||Te(e)))}_tinySDF(e,i,o){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(o))return;let m=e.tinySDF;if(!m){let be="400";/bold/i.test(i)?be="900":/medium/i.test(i)?be="500":/light/i.test(i)&&(be="200"),m=e.tinySDF=new vl.TinySDF(48,6,16,.25,c,be)}if(this.localGlyphs[m.fontWeight][o])return this.localGlyphs[m.fontWeight][o];const{data:y,metrics:T}=m.drawWithMetrics(String.fromCharCode(o)),{sdfWidth:A,sdfHeight:R,width:N,height:q,left:W,top:Y,advance:oe}=T;return this.localGlyphs[m.fontWeight][o]={id:o,bitmap:new ba({width:A,height:R},y),metrics:{width:N/2,height:q/2,left:W/2,top:Y/2-27,advance:oe/2,localGlyph:!0}}}}function dh(r,e,i,o){const c=[],m=r.image,y=m.pixelRatio,T=m.paddedRect.w-2,A=m.paddedRect.h-2,R=r.right-r.left,N=r.bottom-r.top,q=m.stretchX||[[0,T]],W=m.stretchY||[[0,A]],Y=(bt,St)=>bt+St[1]-St[0],oe=q.reduce(Y,0),be=W.reduce(Y,0),Ce=T-oe,Fe=A-be;let Ze=0,Ye=oe,ot=0,st=be,at=0,Ot=Ce,At=0,Tt=Fe;if(m.content&&o){const bt=m.content;Ze=oc(q,0,bt[0]),ot=oc(W,0,bt[1]),Ye=oc(q,bt[0],bt[2]),st=oc(W,bt[1],bt[3]),at=bt[0]-Ze,At=bt[1]-ot,Ot=bt[2]-bt[0]-Ye,Tt=bt[3]-bt[1]-st}const qt=(bt,St,_t,Mt)=>{const xn=sc(bt.stretch-Ze,Ye,R,r.left),Rn=ac(bt.fixed-at,Ot,bt.stretch,oe),Gn=sc(St.stretch-ot,st,N,r.top),Vn=ac(St.fixed-At,Tt,St.stretch,be),lr=sc(_t.stretch-Ze,Ye,R,r.left),er=ac(_t.fixed-at,Ot,_t.stretch,oe),En=sc(Mt.stretch-ot,st,N,r.top),Nr=ac(Mt.fixed-At,Tt,Mt.stretch,be),Kr=new b(xn,Gn),Br=new b(lr,Gn),Yr=new b(lr,En),hi=new b(xn,En),ri=new b(Rn/y,Vn/y),kr=new b(er/y,Nr/y),jr=e*Math.PI/180;if(jr){const di=Math.sin(jr),pr=Math.cos(jr),ur=[pr,-di,di,pr];Kr._matMult(ur),Br._matMult(ur),hi._matMult(ur),Yr._matMult(ur)}const Zr=bt.stretch+bt.fixed,ii=St.stretch+St.fixed;return{tl:Kr,tr:Br,bl:hi,br:Yr,tex:{x:m.paddedRect.x+1+Zr,y:m.paddedRect.y+1+ii,w:_t.stretch+_t.fixed-Zr,h:Mt.stretch+Mt.fixed-ii},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ri,pixelOffsetBR:kr,minFontScaleX:Ot/y/R,minFontScaleY:Tt/y/N,isSDF:i}};if(o&&(m.stretchX||m.stretchY)){const bt=ph(q,Ce,oe),St=ph(W,Fe,be);for(let _t=0;_t<bt.length-1;_t++){const Mt=bt[_t],xn=bt[_t+1];for(let Rn=0;Rn<St.length-1;Rn++)c.push(qt(Mt,St[Rn],xn,St[Rn+1]))}}else c.push(qt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:A+1}));return c}function oc(r,e,i){let o=0;for(const c of r)o+=Math.max(e,Math.min(i,c[1]))-Math.max(e,Math.min(i,c[0]));return o}function ph(r,e,i){const o=[{fixed:-1,stretch:0}];for(const[c,m]of r){const y=o[o.length-1];o.push({fixed:c-y.stretch,stretch:y.stretch}),o.push({fixed:c-y.stretch,stretch:y.stretch+(m-c)})}return o.push({fixed:e+1,stretch:i}),o}function sc(r,e,i,o){return r/e*i+o}function ac(r,e,i,o){return r-e*i/o}vl.loadGlyphRange=function(r,e,i,o,c){const m=256*e,y=m+255,T=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",r).replace("{range}",`${m}-${y}`),Mn.Glyphs);xe(T,(A,R)=>{if(A)c(A);else if(R){const N={};for(const q of function(W){return new Nl(W).readFields(yp,[])}(R))N[q.id]=q;c(null,N)}})},vl.TinySDF=ch;class Tp{constructor(e=[],i=Pp){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,c=i[e];for(;e>0;){const m=e-1>>1,y=i[m];if(o(c,y)>=0)break;i[e]=y,e=m}i[e]=c}_down(e){const{data:i,compare:o}=this,c=this.length>>1,m=i[e];for(;e<c;){let y=1+(e<<1),T=i[y];const A=y+1;if(A<this.length&&o(i[A],T)<0&&(y=A,T=i[A]),o(T,m)>=0)break;i[e]=T,e=y}i[e]=m}}function Pp(r,e){return r<e?-1:r>e?1:0}function Cp(r,e=1,i=!1){let o=1/0,c=1/0,m=-1/0,y=-1/0;const T=r[0];for(let Y=0;Y<T.length;Y++){const oe=T[Y];(!Y||oe.x<o)&&(o=oe.x),(!Y||oe.y<c)&&(c=oe.y),(!Y||oe.x>m)&&(m=oe.x),(!Y||oe.y>y)&&(y=oe.y)}const A=Math.min(m-o,y-c);let R=A/2;const N=new Tp([],Ap);if(A===0)return new b(o,c);for(let Y=o;Y<m;Y+=A)for(let oe=c;oe<y;oe+=A)N.push(new xl(Y+R,oe+R,R,r));let q=function(Y){let oe=0,be=0,Ce=0;const Fe=Y[0];for(let Ze=0,Ye=Fe.length,ot=Ye-1;Ze<Ye;ot=Ze++){const st=Fe[Ze],at=Fe[ot],Ot=st.x*at.y-at.x*st.y;be+=(st.x+at.x)*Ot,Ce+=(st.y+at.y)*Ot,oe+=3*Ot}return new xl(be/oe,Ce/oe,0,Y)}(r),W=N.length;for(;N.length;){const Y=N.pop();(Y.d>q.d||!q.d)&&(q=Y),Y.max-q.d<=e||(R=Y.h/2,N.push(new xl(Y.p.x-R,Y.p.y-R,R,r)),N.push(new xl(Y.p.x+R,Y.p.y-R,R,r)),N.push(new xl(Y.p.x-R,Y.p.y+R,R,r)),N.push(new xl(Y.p.x+R,Y.p.y+R,R,r)),W+=4)}return i&&(console.log("num probes: "+W),console.log("best distance: "+q.d)),q.p}function Ap(r,e){return e.max-r.max}function xl(r,e,i,o){this.p=new b(r,e),this.h=i,this.d=function(c,m){let y=!1,T=1/0;for(let A=0;A<m.length;A++){const R=m[A];for(let N=0,q=R.length,W=q-1;N<q;W=N++){const Y=R[N],oe=R[W];Y.y>c.y!=oe.y>c.y&&c.x<(oe.x-Y.x)*(c.y-Y.y)/(oe.y-Y.y)+Y.x&&(y=!y),T=Math.min(T,fu(c,Y,oe))}}return(y?1:-1)*Math.sqrt(T)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}const qc=Number.POSITIVE_INFINITY;function fh(r,e){return e[1]!==qc?function(i,o,c){let m=0,y=0;switch(o=Math.abs(o),c=Math.abs(c),i){case"top-right":case"top-left":case"top":y=c-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-c}switch(i){case"top-right":case"bottom-right":case"right":m=-o;break;case"top-left":case"bottom-left":case"left":m=o}return[m,y]}(r,e[0],e[1]):function(i,o){let c=0,m=0;o<0&&(o=0);const y=o/Math.sqrt(2);switch(i){case"top-right":case"top-left":m=y-7;break;case"bottom-right":case"bottom-left":m=7-y;break;case"bottom":m=7-o;break;case"top":m=o-7}switch(i){case"top-right":case"bottom-right":c=-y;break;case"top-left":case"bottom-left":c=y;break;case"left":c=o;break;case"right":c=-o}return[c,m]}(r,e[0])}function kp(r,e,i,o,c,m,y,T){r.createArrays(),r.tilePixelRatio=sr/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const A=r.layers[0].layout,R=r.layers[0]._unevaluatedLayout._values,N={};if(r.textSizeData.kind==="composite"){const{minZoom:oe,maxZoom:be}=r.textSizeData;N.compositeTextSizes=[R["text-size"].possiblyEvaluate(new S(oe),y),R["text-size"].possiblyEvaluate(new S(be),y)]}if(r.iconSizeData.kind==="composite"){const{minZoom:oe,maxZoom:be}=r.iconSizeData;N.compositeIconSizes=[R["icon-size"].possiblyEvaluate(new S(oe),y),R["icon-size"].possiblyEvaluate(new S(be),y)]}N.layoutTextSize=R["text-size"].possiblyEvaluate(new S(T+1),y),N.layoutIconSize=R["icon-size"].possiblyEvaluate(new S(T+1),y),N.textMaxSize=R["text-size"].possiblyEvaluate(new S(18),y);const q=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",W=A.get("text-keep-upright"),Y=A.get("text-size");for(const oe of r.features){const be=A.get("text-font").evaluate(oe,{},y).join(","),Ce=Y.evaluate(oe,{},y),Fe=N.layoutTextSize.evaluate(oe,{},y),Ze=(N.layoutIconSize.evaluate(oe,{},y),{horizontal:{},vertical:void 0}),Ye=oe.text;let ot,st=[0,0];if(Ye){const At=Ye.toString(),Tt=24*A.get("text-letter-spacing").evaluate(oe,{},y),qt=24*A.get("text-line-height").evaluate(oe,{},y),bt=Tr(At)?Tt:0,St=A.get("text-anchor").evaluate(oe,{},y),_t=A.get("text-variable-anchor");if(!_t){const Vn=A.get("text-radial-offset").evaluate(oe,{},y);st=Vn?fh(St,[24*Vn,qc]):A.get("text-offset").evaluate(oe,{},y).map(lr=>24*lr)}let Mt=q?"center":A.get("text-justify").evaluate(oe,{},y);const xn=A.get("symbol-placement"),Rn=xn==="point"?24*A.get("text-max-width").evaluate(oe,{},y):0,Gn=()=>{r.allowVerticalPlacement&&Vs(At)&&(Ze.vertical=rc(Ye,e,i,c,be,Rn,qt,St,"left",bt,st,so.vertical,!0,xn,Fe,Ce))};if(!q&&_t){const Vn=Mt==="auto"?_t.map(er=>Zc(er)):[Mt];let lr=!1;for(let er=0;er<Vn.length;er++){const En=Vn[er];if(!Ze.horizontal[En])if(lr)Ze.horizontal[En]=Ze.horizontal[0];else{const Nr=rc(Ye,e,i,c,be,Rn,qt,"center",En,bt,st,so.horizontal,!1,xn,Fe,Ce);Nr&&(Ze.horizontal[En]=Nr,lr=Nr.positionedLines.length===1)}}Gn()}else{Mt==="auto"&&(Mt=Zc(St));const Vn=rc(Ye,e,i,c,be,Rn,qt,St,Mt,bt,st,so.horizontal,!1,xn,Fe,Ce);Vn&&(Ze.horizontal[Mt]=Vn),Gn(),Vs(At)&&q&&W&&(Ze.vertical=rc(Ye,e,i,c,be,Rn,qt,St,Mt,bt,st,so.vertical,!1,xn,Fe,Ce))}}let at=!1;if(oe.icon&&oe.icon.name){const At=o[oe.icon.name];At&&(ot=Sp(c[oe.icon.name],A.get("icon-offset").evaluate(oe,{},y),A.get("icon-anchor").evaluate(oe,{},y)),at=At.sdf,r.sdfIcons===void 0?r.sdfIcons=At.sdf:r.sdfIcons!==At.sdf&&rn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(At.pixelRatio!==r.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0))}const Ot=gh(Ze.horizontal)||Ze.vertical;r.iconsInText||(r.iconsInText=!!Ot&&Ot.iconsInText),(Ot||ot)&&Lp(r,oe,Ze,ot,o,N,Fe,0,st,at,y)}m&&r.generateCollisionDebugBuffers(T,r.collisionBoxArray)}function Zc(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Lp(r,e,i,o,c,m,y,T,A,R,N){let q=m.textMaxSize.evaluate(e,{},N);q===void 0&&(q=y);const W=r.layers[0].layout,Y=W.get("icon-offset").evaluate(e,{},N),oe=gh(i.horizontal),be=y/24,Ce=r.tilePixelRatio*q/24,Fe=r.tilePixelRatio*W.get("symbol-spacing"),Ze=W.get("text-padding")*r.tilePixelRatio,Ye=W.get("icon-padding")*r.tilePixelRatio,ot=F(W.get("text-max-angle")),st=W.get("text-rotation-alignment")==="map"&&W.get("symbol-placement")!=="point",at=W.get("icon-rotation-alignment")==="map"&&W.get("symbol-placement")!=="point",Ot=W.get("symbol-placement"),At=Fe/2,Tt=W.get("icon-text-fit");let qt;o&&Tt!=="none"&&(r.allowVerticalPlacement&&i.vertical&&(qt=rh(o,i.vertical,Tt,W.get("icon-text-fit-padding"),Y,be)),oe&&(o=rh(o,oe,Tt,W.get("icon-text-fit-padding"),Y,be)));const bt=(St,_t)=>{_t.x<0||_t.x>=sr||_t.y<0||_t.y>=sr||function(Mt,xn,Rn,Gn,Vn,lr,er,En,Nr,Kr,Br,Yr,hi,ri,kr,jr,Zr,ii,di,pr,ur,Gr,qn,Mo){const Sr=Mt.addToLineVertexArray(xn,Rn);let $i,Qr,Ro,Bo,Ta,es,Xs,Wi=0,Js=0,Zl=0,Hh=0,iu=-1,ou=-1;const Ks={};let Xh=bs(""),su=0,au=0;if(En._unevaluatedLayout.getValue("text-radial-offset")===void 0?[su,au]=En.layout.get("text-offset").evaluate(pr,{},qn).map(ao=>24*ao):(su=24*En.layout.get("text-radial-offset").evaluate(pr,{},qn),au=qc),Mt.allowVerticalPlacement&&Gn.vertical){const ao=Gn.vertical;if(ri)es=$c(ao),er&&(Xs=$c(er));else{const lo=En.layout.get("text-rotate").evaluate(pr,{},qn)+90;Ro=lc(Nr,xn,Kr,Br,Yr,ao,hi,lo),er&&(Bo=lc(Nr,xn,Kr,Br,Yr,er,Zr,lo))}}if(Vn){const ao=En.layout.get("icon-rotate").evaluate(pr,{},qn),lo=En.layout.get("icon-text-fit")!=="none",$l=dh(Vn,ao,Gr,lo),cu=er?dh(er,ao,Gr,lo):void 0;Qr=lc(Nr,xn,Kr,Br,Yr,Vn,Zr,ao),Wi=4*$l.length;const Kh=Mt.iconSizeData;let Ka=null;Kh.kind==="source"?(Ka=[ws*En.layout.get("icon-size").evaluate(pr,{},qn)],Ka[0]>Ma&&rn(Mt.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".')):Kh.kind==="composite"&&(Ka=[ws*ur.compositeIconSizes[0].evaluate(pr,{},qn),ws*ur.compositeIconSizes[1].evaluate(pr,{},qn)],(Ka[0]>Ma||Ka[1]>Ma)&&rn(Mt.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".')),Mt.addSymbols(Mt.icon,$l,Ka,di,ii,pr,!1,xn,Sr.lineStartIndex,Sr.lineLength,-1,qn),iu=Mt.icon.placedSymbolArray.length-1,cu&&(Js=4*cu.length,Mt.addSymbols(Mt.icon,cu,Ka,di,ii,pr,so.vertical,xn,Sr.lineStartIndex,Sr.lineLength,-1,qn),ou=Mt.icon.placedSymbolArray.length-1)}for(const ao in Gn.horizontal){const lo=Gn.horizontal[ao];$i||(Xh=bs(lo.text),ri?Ta=$c(lo):$i=lc(Nr,xn,Kr,Br,Yr,lo,hi,En.layout.get("text-rotate").evaluate(pr,{},qn)));const $l=lo.positionedLines.length===1;if(Zl+=mh(Mt,xn,lo,lr,En,ri,pr,kr,Sr,Gn.vertical?so.horizontal:so.horizontalOnly,$l?Object.keys(Gn.horizontal):[ao],Ks,iu,ur,qn),$l)break}Gn.vertical&&(Hh+=mh(Mt,xn,Gn.vertical,lr,En,ri,pr,kr,Sr,so.vertical,["vertical"],Ks,ou,ur,qn));let Ys=-1;const lu=(ao,lo)=>ao?Math.max(ao,lo):lo;Ys=lu(Ta,Ys),Ys=lu(es,Ys),Ys=lu(Xs,Ys);const Jh=Ys>-1?1:0;Jh&&(Ys*=Mo/24),Mt.glyphOffsetArray.length>=Ea.MAX_GLYPHS&&rn("Too many glyphs being rendered in a tile. See                                                   "),pr.sortKey!==void 0&&Mt.addToSortKeyRanges(Mt.symbolInstances.length,pr.sortKey),Mt.symbolInstances.emplaceBack(xn.x,xn.y,Ks.right>=0?Ks.right:-1,Ks.center>=0?Ks.center:-1,Ks.left>=0?Ks.left:-1,Ks.vertical||-1,iu,ou,Xh,$i!==void 0?$i:Mt.collisionBoxArray.length,$i!==void 0?$i+1:Mt.collisionBoxArray.length,Ro!==void 0?Ro:Mt.collisionBoxArray.length,Ro!==void 0?Ro+1:Mt.collisionBoxArray.length,Qr!==void 0?Qr:Mt.collisionBoxArray.length,Qr!==void 0?Qr+1:Mt.collisionBoxArray.length,Bo||Mt.collisionBoxArray.length,Bo?Bo+1:Mt.collisionBoxArray.length,Kr,Zl,Hh,Wi,Js,Jh,0,su,au,Ys)}(r,_t,St,i,o,c,qt,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,Ze,st,A,0,Ye,at,Y,e,m,R,N,y)};if(Ot==="line")for(const St of lh(e.geometry,0,0,sr,sr)){const _t=Ep(St,Fe,ot,i.vertical||oe,o,24,Ce,r.overscaling,sr);for(const Mt of _t){const xn=oe;xn&&Dp(r,xn.text,At,Mt)||bt(St,Mt)}}else if(Ot==="line-center"){for(const St of e.geometry)if(St.length>1){const _t=Mp(St,ot,i.vertical||oe,o,24,Ce);_t&&bt(St,_t)}}else if(e.type==="Polygon")for(const St of kc(e.geometry,0)){const _t=Cp(St,16);bt(St[0],new Sa(_t.x,_t.y,0))}else if(e.type==="LineString")for(const St of e.geometry)bt(St,new Sa(St[0].x,St[0].y,0));else if(e.type==="Point")for(const St of e.geometry)for(const _t of St)bt([_t],new Sa(_t.x,_t.y,0))}const Ma=32640;function mh(r,e,i,o,c,m,y,T,A,R,N,q,W,Y,oe){const be=function(Ze,Ye,ot,st,at,Ot,At,Tt){const qt=st.layout.get("text-rotate").evaluate(Ot,{})*Math.PI/180,bt=[];for(const St of Ye.positionedLines)for(const _t of St.positionedGlyphs){if(!_t.rect)continue;const Mt=_t.rect||{};let xn=4,Rn=!0,Gn=1,Vn=0;const lr=(at||Tt)&&_t.vertical,er=_t.metrics.advance*_t.scale/2;if(Tt&&Ye.verticalizable){const ur=24*(_t.scale-1),Gr=(24-_t.metrics.width*_t.scale)/2;Vn=St.lineOffset/2-(_t.imageName?-Gr:ur)}if(_t.imageName){const ur=At[_t.imageName];Rn=ur.sdf,Gn=ur.pixelRatio,xn=1/Gn}const En=at?[_t.x+er,_t.y]:[0,0];let Nr=at?[0,0]:[_t.x+er+ot[0],_t.y+ot[1]-Vn],Kr=[0,0];lr&&(Kr=Nr,Nr=[0,0]);const Br=(_t.metrics.left-xn)*_t.scale-er+Nr[0],Yr=(-_t.metrics.top-xn)*_t.scale+Nr[1],hi=Br+Mt.w*_t.scale/(Gn*(_t.localGlyph?2:1)),ri=Yr+Mt.h*_t.scale/(Gn*(_t.localGlyph?2:1)),kr=new b(Br,Yr),jr=new b(hi,Yr),Zr=new b(Br,ri),ii=new b(hi,ri);if(lr){const ur=new b(-er,er- -17),Gr=-Math.PI/2,qn=12-er,Mo=new b(22-qn,-(_t.imageName?qn:0)),Sr=new b(...Kr);kr._rotateAround(Gr,ur)._add(Mo)._add(Sr),jr._rotateAround(Gr,ur)._add(Mo)._add(Sr),Zr._rotateAround(Gr,ur)._add(Mo)._add(Sr),ii._rotateAround(Gr,ur)._add(Mo)._add(Sr)}if(qt){const ur=Math.sin(qt),Gr=Math.cos(qt),qn=[Gr,-ur,ur,Gr];kr._matMult(qn),jr._matMult(qn),Zr._matMult(qn),ii._matMult(qn)}const di=new b(0,0),pr=new b(0,0);bt.push({tl:kr,tr:jr,bl:Zr,br:ii,tex:Mt,writingMode:Ye.writingMode,glyphOffset:En,sectionIndex:_t.sectionIndex,isSDF:Rn,pixelOffsetTL:di,pixelOffsetBR:pr,minFontScaleX:0,minFontScaleY:0})}return bt}(0,i,T,c,m,y,o,r.allowVerticalPlacement),Ce=r.textSizeData;let Fe=null;Ce.kind==="source"?(Fe=[ws*c.layout.get("text-size").evaluate(y,{},oe)],Fe[0]>Ma&&rn(r.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".')):Ce.kind==="composite"&&(Fe=[ws*Y.compositeTextSizes[0].evaluate(y,{},oe),ws*Y.compositeTextSizes[1].evaluate(y,{},oe)],(Fe[0]>Ma||Fe[1]>Ma)&&rn(r.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".')),r.addSymbols(r.text,be,Fe,T,m,y,R,e,A.lineStartIndex,A.lineLength,W,oe);for(const Ze of N)q[Ze]=r.text.placedSymbolArray.length-1;return 4*be.length}function gh(r){for(const e in r)return r[e];return null}function lc(r,e,i,o,c,m,y,T){let A=m.top,R=m.bottom,N=m.left,q=m.right;const W=m.collisionPadding;if(W&&(N-=W[0],A-=W[1],q+=W[2],R+=W[3]),T){const Y=new b(N,A),oe=new b(q,A),be=new b(N,R),Ce=new b(q,R),Fe=F(T);Y._rotate(Fe),oe._rotate(Fe),be._rotate(Fe),Ce._rotate(Fe),N=Math.min(Y.x,oe.x,be.x,Ce.x),q=Math.max(Y.x,oe.x,be.x,Ce.x),A=Math.min(Y.y,oe.y,be.y,Ce.y),R=Math.max(Y.y,oe.y,be.y,Ce.y)}return r.emplaceBack(e.x,e.y,N,A,q,R,y,i,o,c),r.length-1}function $c(r){r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function Dp(r,e,i,o){const c=r.compareText;if(e in c){const m=c[e];for(let y=m.length-1;y>=0;y--)if(o.dist(m[y])<i)return!0}else c[e]=[];return c[e].push(o),!1}const zp=Ha.VectorTileFeature.types,Op=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function cc(r,e,i,o,c,m,y,T,A,R,N,q,W){const Y=T?Math.min(Ma,Math.round(T[0])):0,oe=T?Math.min(Ma,Math.round(T[1])):0;r.emplaceBack(e,i,Math.round(32*o),Math.round(32*c),m,y,(Y<<1)+(A?1:0),oe,16*R,16*N,256*q,256*W)}function Wc(r,e,i){r.emplaceBack(e.x,e.y,i),r.emplaceBack(e.x,e.y,i),r.emplaceBack(e.x,e.y,i),r.emplaceBack(e.x,e.y,i)}function Fp(r){for(const e of r.sections)if(tt(e.text))return!0;return!1}class Hc{constructor(e){this.layoutVertexArray=new Pn,this.indexArray=new Cn,this.programConfigurations=e,this.segments=new vi,this.dynamicLayoutVertexArray=new Be,this.opacityVertexArray=new nt,this.placedSymbolArray=new Jr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,o,c){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,tp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,np.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Op,!0),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Z("SymbolBuffers",Hc);class Xc{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new vi,this.collisionVertexArray=new fn,this.collisionVertexArrayExt=new Be}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,rp.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,ip.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Z("CollisionBuffers",Xc);class Ea{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=wc([]),this.placementViewportMatrix=wc([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Rc(this.zoom,i["text-size"]),this.iconSizeData=Rc(this.zoom,i["icon-size"]);const o=this.layers[0].layout,c=o.get("symbol-sort-key"),m=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(y=>so[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID}createArrays(){this.text=new Hc(new Za(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Hc(new Za(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Oo,this.lineVertexArray=new ar,this.symbolInstances=new _i}calculateGlyphDependencies(e,i,o,c,m){for(let y=0;y<e.length;y++)if(i[e.charCodeAt(y)]=!0,(o||c)&&m){const T=Ul[e.charAt(y)];T&&(i[T.charCodeAt(0)]=!0)}}populate(e,i,o){const c=this.layers[0],m=c.layout,y=m.get("text-font"),T=m.get("text-field"),A=m.get("icon-image"),R=(T.value.kind!=="constant"||T.value.value instanceof Hr&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),N=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,q=m.get("symbol-sort-key");if(this.features=[],!R&&!N)return;const W=i.iconDependencies,Y=i.glyphDependencies,oe=i.availableImages,be=new S(this.zoom);for(const{feature:Ce,id:Fe,index:Ze,sourceLayerIndex:Ye}of e){const ot=c._featureFilter.needGeometry,st=Wa(Ce,ot);if(!c._featureFilter.filter(be,st,o))continue;let at,Ot;if(ot||(st.geometry=$a(Ce)),R){const Tt=c.getValueAndResolveTokens("text-field",st,o,oe),qt=Hr.factory(Tt);Fp(qt)&&(this.hasRTLText=!0),(!this.hasRTLText||s()==="unavailable"||this.hasRTLText&&x.isParsed())&&(at=ap(qt,c,st))}if(N){const Tt=c.getValueAndResolveTokens("icon-image",st,o,oe);Ot=Tt instanceof ai?Tt:ai.fromString(Tt)}if(!at&&!Ot)continue;const At=this.sortFeaturesByKey?q.evaluate(st,{},o):void 0;if(this.features.push({id:Fe,text:at,icon:Ot,index:Ze,sourceLayerIndex:Ye,geometry:st.geometry,properties:Ce.properties,type:zp[Ce.type],sortKey:At}),Ot&&(W[Ot.name]=!0),at){const Tt=y.evaluate(st,{},o).join(","),qt=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(so.vertical)>=0;for(const bt of at.sections)if(bt.image)W[bt.image.name]=!0;else{const St=Vs(at.toString()),_t=bt.fontStack||Tt,Mt=Y[_t]=Y[_t]||{};this.calculateGlyphDependencies(bt.text,Mt,qt,this.allowVerticalPlacement,St)}}}m.get("symbol-placement")==="line"&&(this.features=function(Ce){const Fe={},Ze={},Ye=[];let ot=0;function st(Tt){Ye.push(Ce[Tt]),ot++}function at(Tt,qt,bt){const St=Ze[Tt];return delete Ze[Tt],Ze[qt]=St,Ye[St].geometry[0].pop(),Ye[St].geometry[0]=Ye[St].geometry[0].concat(bt[0]),St}function Ot(Tt,qt,bt){const St=Fe[qt];return delete Fe[qt],Fe[Tt]=St,Ye[St].geometry[0].shift(),Ye[St].geometry[0]=bt[0].concat(Ye[St].geometry[0]),St}function At(Tt,qt,bt){const St=bt?qt[0][qt[0].length-1]:qt[0][0];return`${Tt}:${St.x}:${St.y}`}for(let Tt=0;Tt<Ce.length;Tt++){const qt=Ce[Tt],bt=qt.geometry,St=qt.text?qt.text.toString():null;if(!St){st(Tt);continue}const _t=At(St,bt),Mt=At(St,bt,!0);if(_t in Ze&&Mt in Fe&&Ze[_t]!==Fe[Mt]){const xn=Ot(_t,Mt,bt),Rn=at(_t,Mt,Ye[xn].geometry);delete Fe[_t],delete Ze[Mt],Ze[At(St,Ye[Rn].geometry,!0)]=Rn,Ye[xn].geometry=null}else _t in Ze?at(_t,Mt,bt):Mt in Fe?Ot(_t,Mt,bt):(st(Tt),Fe[_t]=ot-1,Ze[Mt]=ot-1)}return Ye.filter(Tt=>Tt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ce,Fe)=>Ce.sortKey-Fe.sortKey)}update(e,i,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,o),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(i[e.segment+1]),m=e.dist(i[e.segment]);const y={};for(let T=e.segment+1;T<i.length;T++)y[T]={x:i[T].x,y:i[T].y,tileUnitDistanceFromAnchor:c},T<i.length-1&&(c+=i[T+1].dist(i[T]));for(let T=e.segment||0;T>=0;T--)y[T]={x:i[T].x,y:i[T].y,tileUnitDistanceFromAnchor:m},T>0&&(m+=i[T-1].dist(i[T]));for(let T=0;T<i.length;T++){const A=y[T];this.lineVertexArray.emplaceBack(A.x,A.y,A.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,c,m,y,T,A,R,N,q,W){const Y=e.indexArray,oe=e.layoutVertexArray,be=e.segments.prepareSegment(4*i.length,oe,Y,this.canOverlap?y.sortKey:void 0),Ce=this.glyphOffsetArray.length,Fe=be.vertexLength,Ze=this.allowVerticalPlacement&&T===so.vertical?Math.PI/2:0,Ye=y.text&&y.text.sections;for(let ot=0;ot<i.length;ot++){const{tl:st,tr:at,bl:Ot,br:At,tex:Tt,pixelOffsetTL:qt,pixelOffsetBR:bt,minFontScaleX:St,minFontScaleY:_t,glyphOffset:Mt,isSDF:xn,sectionIndex:Rn}=i[ot],Gn=be.vertexLength,Vn=Mt[1];cc(oe,A.x,A.y,st.x,Vn+st.y,Tt.x,Tt.y,o,xn,qt.x,qt.y,St,_t),cc(oe,A.x,A.y,at.x,Vn+at.y,Tt.x+Tt.w,Tt.y,o,xn,bt.x,qt.y,St,_t),cc(oe,A.x,A.y,Ot.x,Vn+Ot.y,Tt.x,Tt.y+Tt.h,o,xn,qt.x,bt.y,St,_t),cc(oe,A.x,A.y,At.x,Vn+At.y,Tt.x+Tt.w,Tt.y+Tt.h,o,xn,bt.x,bt.y,St,_t),Wc(e.dynamicLayoutVertexArray,A,Ze),Y.emplaceBack(Gn,Gn+1,Gn+2),Y.emplaceBack(Gn+1,Gn+2,Gn+3),be.vertexLength+=4,be.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Mt[0]),ot!==i.length-1&&Rn===i[ot+1].sectionIndex||e.programConfigurations.populatePaintArrays(oe.length,y,y.index,{},W,Ye&&Ye[Rn])}e.placedSymbolArray.emplaceBack(A.x,A.y,Ce,this.glyphOffsetArray.length-Ce,Fe,R,N,A.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],T,0,!1,0,q)}_commitLayoutVertex(e,i,o,c,m){e.emplaceBack(i.x,i.y,o,c,Math.round(m.x),Math.round(m.y))}_addCollisionDebugVertices(e,i,o,c,m){const y=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),T=y.vertexLength,A=m.anchorX,R=m.anchorY;for(let q=0;q<4;q++)o.collisionVertexArray.emplaceBack(0,0,0,0);o.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),o.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),o.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),o.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(o.layoutVertexArray,c,A,R,new b(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,A,R,new b(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,A,R,new b(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,c,A,R,new b(e.x1,e.y2)),y.vertexLength+=4;const N=o.indexArray;N.emplaceBack(T,T+1),N.emplaceBack(T+1,T+2),N.emplaceBack(T+2,T+3),N.emplaceBack(T+3,T),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,c,m,y){for(let T=c;T<m;T++){const A=o.get(T),R=this.getSymbolInstanceTextSize(e,y,i,T);this._addCollisionDebugVertices(A,R,this.textCollisionBox,A.anchorPoint,y)}}_addIconDebugCollisionBoxes(e,i,o,c,m,y){for(let T=c;T<m;T++){const A=o.get(T),R=this.getSymbolInstanceIconSize(e,i,T);this._addCollisionDebugVertices(A,R,this.iconCollisionBox,A.anchorPoint,y)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Xc(Yt,$u.members,Hn),this.iconCollisionBox=new Xc(Yt,$u.members,Hn);const o=fl(this.iconSizeData,e),c=fl(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){const y=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(c,e,i,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(c,e,i,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(o,e,i,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(o,e,i,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(e,i,o,c){const m=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:c),y=tc(this.textSizeData,e,m)/24;return this.tilePixelRatio*y}getSymbolInstanceIconSize(e,i,o){const c=this.icon.placedSymbolArray.get(o),m=tc(this.iconSizeData,e,c);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(e,i,o){e.emplaceBack(i,-o,-o),e.emplaceBack(i,o,-o),e.emplaceBack(i,o,o),e.emplaceBack(i,-o,o)}_updateTextDebugCollisionBoxes(e,i,o,c,m,y){for(let T=c;T<m;T++){const A=o.get(T),R=this.getSymbolInstanceTextSize(e,y,i,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,R,A.padding)}}_updateIconDebugCollisionBoxes(e,i,o,c,m){for(let y=c;y<m;y++){const T=o.get(y),A=this.getSymbolInstanceIconSize(e,i,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,A,T.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const o=fl(this.iconSizeData,e),c=fl(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){const y=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(c,e,i,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(c,e,i,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(o,e,i,y.iconBoxStartIndex,y.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(o,e,i,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,o,c,m,y,T,A,R){const N={};for(let q=i;q<o;q++){const W=e.get(q);N.textBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,padding:W.padding,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},N.textFeatureIndex=W.featureIndex;break}for(let q=c;q<m;q++){const W=e.get(q);N.verticalTextBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,padding:W.padding,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},N.verticalTextFeatureIndex=W.featureIndex;break}for(let q=y;q<T;q++){const W=e.get(q);N.iconBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,padding:W.padding,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},N.iconFeatureIndex=W.featureIndex;break}for(let q=A;q<R;q++){const W=e.get(q);N.verticalIconBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,padding:W.padding,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},N.verticalIconFeatureIndex=W.featureIndex;break}return N}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),c=o.vertexStartIndex+4*o.numGlyphs;for(let m=o.vertexStartIndex;m<c;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),c=[],m=[],y=[];for(let T=0;T<this.symbolInstances.length;++T){y.push(T);const A=this.symbolInstances.get(T);c.push(0|Math.round(i*A.anchorX+o*A.anchorY)),m.push(A.featureIndex)}return y.sort((T,A)=>c[T]-c[A]||m[A]-m[T]),y}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((c,m,y)=>{c>=0&&y.indexOf(c)===m&&this.addIndicesForPlacedSymbol(this.text,c)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Z("SymbolBucket",Ea,{omit:["layers","collisionBoxArray","features","compareText"]}),Ea.MAX_GLYPHS=65535,Ea.addDynamicAttributes=Wc;const Rp=new Ae({"symbol-placement":new ae(je.layout_symbol["symbol-placement"]),"symbol-spacing":new ae(je.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ae(je.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ue(je.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ae(je.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ae(je.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ae(je.layout_symbol["icon-ignore-placement"]),"icon-optional":new ae(je.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ae(je.layout_symbol["icon-rotation-alignment"]),"icon-size":new ue(je.layout_symbol["icon-size"]),"icon-text-fit":new ae(je.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ae(je.layout_symbol["icon-text-fit-padding"]),"icon-image":new ue(je.layout_symbol["icon-image"]),"icon-rotate":new ue(je.layout_symbol["icon-rotate"]),"icon-padding":new ae(je.layout_symbol["icon-padding"]),"icon-keep-upright":new ae(je.layout_symbol["icon-keep-upright"]),"icon-offset":new ue(je.layout_symbol["icon-offset"]),"icon-anchor":new ue(je.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ae(je.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ae(je.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ae(je.layout_symbol["text-rotation-alignment"]),"text-field":new ue(je.layout_symbol["text-field"]),"text-font":new ue(je.layout_symbol["text-font"]),"text-size":new ue(je.layout_symbol["text-size"]),"text-max-width":new ue(je.layout_symbol["text-max-width"]),"text-line-height":new ue(je.layout_symbol["text-line-height"]),"text-letter-spacing":new ue(je.layout_symbol["text-letter-spacing"]),"text-justify":new ue(je.layout_symbol["text-justify"]),"text-radial-offset":new ue(je.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ae(je.layout_symbol["text-variable-anchor"]),"text-anchor":new ue(je.layout_symbol["text-anchor"]),"text-max-angle":new ae(je.layout_symbol["text-max-angle"]),"text-writing-mode":new ae(je.layout_symbol["text-writing-mode"]),"text-rotate":new ue(je.layout_symbol["text-rotate"]),"text-padding":new ae(je.layout_symbol["text-padding"]),"text-keep-upright":new ae(je.layout_symbol["text-keep-upright"]),"text-transform":new ue(je.layout_symbol["text-transform"]),"text-offset":new ue(je.layout_symbol["text-offset"]),"text-allow-overlap":new ae(je.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ae(je.layout_symbol["text-ignore-placement"]),"text-optional":new ae(je.layout_symbol["text-optional"])});var Jc={paint:new Ae({"icon-opacity":new ue(je.paint_symbol["icon-opacity"]),"icon-color":new ue(je.paint_symbol["icon-color"]),"icon-halo-color":new ue(je.paint_symbol["icon-halo-color"]),"icon-halo-width":new ue(je.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ue(je.paint_symbol["icon-halo-blur"]),"icon-translate":new ae(je.paint_symbol["icon-translate"]),"icon-translate-anchor":new ae(je.paint_symbol["icon-translate-anchor"]),"text-opacity":new ue(je.paint_symbol["text-opacity"]),"text-color":new ue(je.paint_symbol["text-color"],{runtimeType:yr,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new ue(je.paint_symbol["text-halo-color"]),"text-halo-width":new ue(je.paint_symbol["text-halo-width"]),"text-halo-blur":new ue(je.paint_symbol["text-halo-blur"]),"text-translate":new ae(je.paint_symbol["text-translate"]),"text-translate-anchor":new ae(je.paint_symbol["text-translate-anchor"])}),layout:Rp};class yh{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:zr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Z("FormatSectionOverride",yh,{omit:["defaultValue"]});class uc extends Yo{constructor(e){super(e,Jc)}recalculate(e,i){if(super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const c=[];for(const m of o)c.indexOf(m)<0&&c.push(m);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,i,o,c){const m=this.layout.get(e).evaluate(i,{},o,c),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||js(y.value)||!m?m:function(T,A){return A.replace(/{([^{}]+)}/g,(R,N)=>N in T?String(T[N]):"")}(i.properties,m)}createBucket(e){return new Ea(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Jc.paint.overridableProperties){if(!uc.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new yh(i),c=new Fa(o,i.property.specification);let m=null;m=i.value.kind==="constant"||i.value.kind==="source"?new fs("source",c):new Zo("composite",c,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new se(i.property,m,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&uc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),c=Jc.paint.properties[i];let m=!1;const y=T=>{for(const A of T)if(c.overrides&&c.overrides.hasOverride(A))return void(m=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Hr)y(o.value.value.sections);else if(o.value.kind==="source"){const T=R=>{m||(R instanceof qr&&vr(R.value)===Yi?y(R.value.sections):R instanceof li?y(R.sections):R.eachChild(T))},A=o.value;A._styleExpression&&T(A._styleExpression.expression)}return m}getProgramConfiguration(e){return new Ws(this,e)}}var Bp={paint:new Ae({"background-color":new ae(je.paint_background["background-color"]),"background-pattern":new ye(je.paint_background["background-pattern"]),"background-opacity":new ae(je.paint_background["background-opacity"])})},jp={paint:new Ae({"raster-opacity":new ae(je.paint_raster["raster-opacity"]),"raster-hue-rotate":new ae(je.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ae(je.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ae(je.paint_raster["raster-brightness-max"]),"raster-saturation":new ae(je.paint_raster["raster-saturation"]),"raster-contrast":new ae(je.paint_raster["raster-contrast"]),"raster-resampling":new ae(je.paint_raster["raster-resampling"]),"raster-fade-duration":new ae(je.paint_raster["raster-fade-duration"])})};class Up extends Yo{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Np={paint:new Ae({"sky-type":new ae(je.paint_sky["sky-type"]),"sky-atmosphere-sun":new ae(je.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ae(je.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ae(je.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ae(je.paint_sky["sky-gradient-radius"]),"sky-gradient":new Me(je.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ae(je.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ae(je.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ae(je.paint_sky["sky-opacity"])})};function Kc(r,e,i){const o=hl(0,0,1),c=Tu(Sc());return function(m,y,T){T*=.5;var A=y[0],R=y[1],N=y[2],q=y[3],W=Math.sin(T),Y=Math.cos(T);m[0]=A*Y-N*W,m[1]=R*Y+q*W,m[2]=N*Y+A*W,m[3]=q*Y-R*W}(c,c,i?-F(r)+Math.PI:F(r)),Pu(c,c,-F(e)),Iu(o,o,c),Eu(o,o)}const Gp={circle:class extends Yo{constructor(r){super(r,ud)}createBucket(r){return new vc(r)}queryRadius(r){const e=r;return kl("circle-radius",this,e)+kl("circle-stroke-width",this,e)+Xl(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,i,o,c,m,y,T){const A=this.paint.get("circle-pitch-alignment")==="map";if(A&&r.queryGeometry.isAboveHorizon)return!1;const R=_u(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),N=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i),q=A?N*r.pixelToTileUnitsFactor:N;for(const W of o)for(const Y of W){const oe=Y.add(R),be=T&&m.elevation?m.elevation.exaggeration()*T.getElevationAt(oe.x,oe.y,!0):0,Ce=A?oe:md(oe,be,y),Fe=A?r.tilespaceRays.map(ot=>yd(ot,be)):r.queryGeometry.screenGeometry;let Ze=q;const Ye=Dl([],[Y.x,Y.y,be,1],y);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ze*=Ye[3]/m.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ze*=m.cameraToCenterDistance/Ye[3]),od(Fe,Ce,Ze))return!0}return!1}getProgramIds(){return["circle"]}getProgramConfiguration(r){return new Ws(this,r)}},heatmap:class extends Yo{createBucket(r){return new Au(r)}constructor(r){super(r,_d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ic({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(r){return new Ws(this,r)}},hillshade:class extends Yo{constructor(r){super(r,vd)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(r){return new Ws(this,r)}},fill:class extends Yo{constructor(r){super(r,Fd)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(r){return new Ws(this,r)}recalculate(r,e){super.recalculate(r,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new zc(r)}queryRadius(){return Xl(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,i,o,c,m){return!r.queryGeometry.isAboveHorizon&&pu(yu(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends Yo{constructor(r){super(r,$d)}createBucket(r){return new Oc(r)}queryRadius(){return Xl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(r){return new Ws(this,r)}queryIntersectsFeature(r,e,i,o,c,m,y,T,A){const R=_u(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),N=this.paint.get("fill-extrusion-height").evaluate(e,i),q=this.paint.get("fill-extrusion-base").evaluate(e,i),W=[0,0],Y=T&&m.elevation,oe=m.elevation?m.elevation.exaggeration():1;if(Y){const Fe=r.tile.getBucket(this).centroidVertexArray,Ze=A+1;if(Ze<Fe.length){const Ye=Fe.get(Ze);W[0]=Ye.a_centroid_pos0,W[1]=Ye.a_centroid_pos1}}if(W[0]===0&&W[1]===1)return!1;const be=function(Fe,Ze,Ye,ot,st,at,Ot,At,Tt){return at?function(qt,bt,St,_t,Mt,xn,Rn,Gn,Vn){const lr=[],er=[],En=[0,0,0,1];for(const Nr of qt){const Kr=[],Br=[];for(const Yr of Nr){const hi=Yr.x+_t.x,ri=Yr.y+_t.y,kr=Wd(hi,ri,bt,St,xn,Rn,Gn,Vn);En[0]=hi,En[1]=ri,En[2]=kr.base,En[3]=1,Dl(En,En,Mt),En[3]=Math.max(En[3],1e-5);const jr=Gu([En[0]/En[3],En[1]/En[3],En[2]/En[3]]);En[0]=hi,En[1]=ri,En[2]=kr.top,En[3]=1,Dl(En,En,Mt),En[3]=Math.max(En[3],1e-5);const Zr=Gu([En[0]/En[3],En[1]/En[3],En[2]/En[3]]);Kr.push(jr),Br.push(Zr)}lr.push(Kr),er.push(Br)}return[lr,er]}(Fe,Ze,Ye,ot,st,at,Ot,At,Tt):function(qt,bt,St,_t,Mt){const xn=[],Rn=[],Gn=Mt[8]*bt,Vn=Mt[9]*bt,lr=Mt[10]*bt,er=Mt[11]*bt,En=Mt[8]*St,Nr=Mt[9]*St,Kr=Mt[10]*St,Br=Mt[11]*St;for(const Yr of qt){const hi=[],ri=[];for(const kr of Yr){const jr=kr.x+_t.x,Zr=kr.y+_t.y,ii=Mt[0]*jr+Mt[4]*Zr+Mt[12],di=Mt[1]*jr+Mt[5]*Zr+Mt[13],pr=Mt[2]*jr+Mt[6]*Zr+Mt[14],ur=Mt[3]*jr+Mt[7]*Zr+Mt[15],Gr=ii+Gn,qn=di+Vn,Mo=pr+lr,Sr=Math.max(ur+er,1e-5),$i=ii+En,Qr=di+Nr,Ro=pr+Kr,Bo=Math.max(ur+Br,1e-5),Ta=new b(Gr/Sr,qn/Sr);Ta.z=Mo/Sr,hi.push(Ta);const es=new b($i/Bo,Qr/Bo);es.z=Ro/Bo,ri.push(es)}xn.push(hi),Rn.push(ri)}return[xn,Rn]}(Fe,Ze,Ye,ot,st)}(o,q,N,R,y,Y?T:null,W,oe,m.center.lat),Ce=r.queryGeometry;return function(Fe,Ze,Ye){let ot=1/0;pu(Ye,Ze)&&(ot=Nu(Ye,Ze[0]));for(let st=0;st<Ze.length;st++){const at=Ze[st],Ot=Fe[st];for(let At=0;At<at.length-1;At++){const Tt=at[At],qt=[Tt,at[At+1],Ot[At+1],Ot[At],Tt];du(Ye,qt)&&(ot=Math.min(ot,Nu(Ye,qt)))}}return ot!==1/0&&ot}(be[0],be[1],Ce.isPointQuery()?Ce.screenBounds:Ce.screenGeometry)}},line:class extends Yo{constructor(r){super(r,Vu),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ui,this.gradientVersion=(this.gradientVersion+1)%C}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=qu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Fc(r)}getProgramIds(){const r=this.paint.get("line-dasharray"),e=this.paint.get("line-pattern").constantOr(1),i=this.paint.get("line-gradient");return[e?"linePattern":r?"lineSDF":i?"lineGradient":"line"]}getProgramConfiguration(r){return new Ws(this,r)}queryRadius(r){const e=r,i=Zu(kl("line-width",this,e),kl("line-gap-width",this,e)),o=kl("line-offset",this,e);return i/2+Math.abs(o)+Xl(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,i,o,c,m){if(r.queryGeometry.isAboveHorizon)return!1;const y=yu(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),T=r.pixelToTileUnitsFactor/2*Zu(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),A=this.paint.get("line-offset").evaluate(e,i);return A&&(o=function(R,N){const q=[],W=new b(0,0);for(let Y=0;Y<R.length;Y++){const oe=R[Y],be=[];for(let Ce=0;Ce<oe.length;Ce++){const Fe=oe[Ce-1],Ze=oe[Ce],Ye=oe[Ce+1],ot=Ce===0?W:Ze.sub(Fe)._unit()._perp(),st=Ce===oe.length-1?W:Ye.sub(Ze)._unit()._perp(),at=ot._add(st)._unit();at._mult(1/(at.x*st.x+at.y*st.y)),be.push(at._mult(N)._add(Ze))}q.push(be)}return q}(o,A*r.pixelToTileUnitsFactor)),function(R,N,q){for(let W=0;W<N.length;W++){const Y=N[W];if(R.length>=3){for(let oe=0;oe<Y.length;oe++)if(ul(R,Y[oe]))return!0}if(sd(R,Y,q))return!0}return!1}(y,o,T)}isTileClipped(){return!0}},symbol:uc,background:class extends Yo{constructor(r){super(r,Bp)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Yo{constructor(r){super(r,jp)}getProgramIds(){return["raster"]}},sky:class extends Yo{constructor(r){super(r,Np),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ic({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(r,e){const i=this.paint.get("sky-type");if(i==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),c=!o,m=r.style.light,y=m.properties.get("position");return c&&m.properties.get("anchor")==="viewport"&&rn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?Kc(y.azimuthal,90-y.polar,e):Kc(o[0],90-o[1],e)}if(i==="gradient"){const o=this.paint.get("sky-gradient-center");return Kc(o[0],90-o[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}}},{HTMLImageElement:_h,HTMLCanvasElement:vh,HTMLVideoElement:xh,ImageData:bh,ImageBitmap:hc}=P;class dc{constructor(e,i,o,c){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(i,c)}update(e,i,o){const{width:c,height:m}=e,y=!(this.size&&this.size[0]===c&&this.size[1]===m||o),{context:T}=this,{gl:A}=T;if(this.useMipmap=Boolean(i&&i.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!i||i.premultiply!==!1)),y)this.size=[c,m],e instanceof _h||e instanceof vh||e instanceof xh||e instanceof bh||hc&&e instanceof hc?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,e):A.texImage2D(A.TEXTURE_2D,0,this.format,c,m,0,this.format,A.UNSIGNED_BYTE,e.data);else{const{x:R,y:N}=o||{x:0,y:0};e instanceof _h||e instanceof vh||e instanceof xh||e instanceof bh||hc&&e instanceof hc?A.texSubImage2D(A.TEXTURE_2D,0,R,N,A.RGBA,A.UNSIGNED_BYTE,e):A.texSubImage2D(A.TEXTURE_2D,0,R,N,c,m,A.RGBA,A.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D)}bind(e,i,o){const{context:c}=this,{gl:m}=c;m.bindTexture(m.TEXTURE_2D,this.texture),o!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=m.LINEAR),e!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,o||e),this.filter=e),i!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,i),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Xa{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Ar?new Ar(e.lng,e.lat):Ar.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ar?new Ar(e.lng,e.lat):Ar.convert(e),this}extend(e){const i=this._sw,o=this._ne;let c,m;if(e instanceof Ar)c=e,m=e;else{if(!(e instanceof Xa))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Xa.convert(e)):this.extend(Ar.convert(e)):this;if(c=e._sw,m=e._ne,!c||!m)return this}return i||o?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),o.lng=Math.max(m.lng,o.lng),o.lat=Math.max(m.lat,o.lat)):(this._sw=new Ar(c.lng,c.lat),this._ne=new Ar(m.lng,m.lat)),this}getCenter(){return new Ar((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ar(this.getWest(),this.getNorth())}getSouthEast(){return new Ar(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:o}=Ar.convert(e);let c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&c}static convert(e){return!e||e instanceof Xa?e:new Xa(e)}}const wh=63710088e-1;class Ar{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ar(pe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,c=e.lat*i,m=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((e.lng-this.lng)*i);return wh*Math.acos(Math.min(m,1))}toBounds(e=0){const i=360*e/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new Xa(new Ar(this.lng-o,this.lat-i),new Ar(this.lng+o,this.lat+i))}static convert(e){if(e instanceof Ar)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ar(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ar(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Sh=2*Math.PI*wh;function Mh(r){return Sh*Math.cos(r*Math.PI/180)}function Eh(r){return(180+r)/360}function Ih(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Yc(r,e){return r/Mh(e)}function pc(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Qc(r,e){return r*Mh(pc(e))}class bl{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=Ar.convert(e);return new bl(Eh(o.lng),Ih(o.lat),Yc(i,o.lat))}toLngLat(){return new Ar(360*this.x-180,pc(this.y))}toAltitude(){return Qc(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Sh*(e=pc(this.y),1/Math.cos(e*Math.PI/180));var e}}class eu{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new ba({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const o=this.getKey(e,i);return this.positions[o]}trim(){const e=this.width,i=this.height=ct(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,o){const c=[];let m=e.length%2==1?-e[e.length-1]*o:0,y=e[0]*o,T=!0;c.push({left:m,right:y,isDash:T,zeroLength:e[0]===0});let A=e[0];for(let R=1;R<e.length;R++){T=!T;const N=e[R];m=A*o,A+=N,y=A*o,c.push({left:m,right:y,isDash:T,zeroLength:N===0})}return c}addRoundDash(e,i,o){const c=i/2;for(let m=-o;m<=o;m++){const y=this.width*(this.nextRow+o+m);let T=0,A=e[T];for(let R=0;R<this.width;R++){R/A.right>1&&(A=e[++T]);const N=Math.abs(R-A.left),q=Math.abs(R-A.right),W=Math.min(N,q);let Y;const oe=m/o*(c+1);if(A.isDash){const be=c-Math.abs(oe);Y=Math.sqrt(W*W+be*be)}else Y=c-Math.sqrt(W*W+oe*oe);this.image.data[y+R]=Math.max(0,Math.min(255,Y+128))}}}addRegularDash(e,i){for(let A=e.length-1;A>=0;--A){const R=e[A],N=e[A+1];R.zeroLength?e.splice(A,1):N&&N.isDash===R.isDash&&(N.left=R.left,e.splice(A,1))}const o=e[0],c=e[e.length-1];o.isDash===c.isDash&&(o.left=c.left-this.width,c.right=o.right+this.width);const m=this.width*this.nextRow;let y=0,T=e[y];for(let A=0;A<this.width;A++){A/T.right>1&&(T=e[++y]);const R=Math.abs(A-T.left),N=Math.abs(A-T.right),q=Math.min(R,N);this.image.data[m+A]=Math.max(0,Math.min(255,(T.isDash?q:-q)+i+128))}}addDash(e,i){const o=this.getKey(e,i);if(this.positions[o])return this.positions[o];const c=i==="round",m=c?7:0,y=2*m+1;if(this.nextRow+y>this.height)return rn("LineAtlas out of space"),null;e.length===0&&e.push(1);let T=0;for(let N=0;N<e.length;N++)e[N]<0&&(rn("Negative value is found in line dasharray, replacing values with 0"),e[N]=0),T+=e[N];if(T!==0){const N=this.width/T,q=this.getDashRanges(e,this.width,N);c?this.addRoundDash(q,N,m):this.addRegularDash(q,i==="square"?.5*N:0)}const A=this.nextRow+m;this.nextRow+=y;const R={tl:[A,m],br:[T,0]};return this.positions[o]=R,R}}Z("LineAtlas",eu);class Vp{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const qp=P.performance;function Th(r){const e=r?r.url.toString():void 0;return qp.getEntriesByName(e)}class Zp{constructor(){this.tasks={},this.taskQueue=[],Pt(["process"],this),this.invoker=new Vp(this.process),this.nextId=0}add(e,i){const o=this.nextId++,c=function({type:m,isSymbolTile:y,zoom:T}){return T=T||0,m==="message"?0:m!=="maybePrepare"||y?m!=="parseTile"||y?m==="parseTile"&&y?300-T:m==="maybePrepare"&&y?400-T:500:200-T:100-T}(i);if(c===0){dn();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[o]={fn:e,metadata:i,priority:c,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){dn();try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let c=0;c<this.taskQueue.length;c++){const m=this.tasks[this.taskQueue[c]];m.priority<i&&(i=m.priority,e=c)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}function Ph(r,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[r*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class tu{constructor(e,i,o){this.z=e,this.x=i,this.y=o,this.key=ql(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const o=(m=this.y,y=this.z,T=Ph(256*(c=this.x),256*(m=Math.pow(2,y)-m-1),y),A=Ph(256*(c+1),256*(m+1),y),T[0]+","+T[1]+","+A[0]+","+A[1]);var c,m,y,T,A;const R=function(N,q,W){let Y,oe="";for(let be=N;be>0;be--)Y=1<<be-1,oe+=(q&Y?1:0)+(W&Y?2:0);return oe}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",R).replace("{bbox-epsg-3857}",o)}getTilePoint(e){const i=Math.pow(2,this.z);return new b((e.x*i-this.x)*sr,(e.y*i-this.y)*sr)}getTileVec3(e){const i=Math.pow(2,this.z);return hl((e.x*i-this.x)*sr,(e.y*i-this.y)*sr,Qc(e.z,e.y))}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ch{constructor(e,i){this.wrap=e,this.canonical=i,this.key=ql(e,i.z,i.z,i.x,i.y)}}class Zi{constructor(e,i,o,c,m){this.overscaledZ=e,this.wrap=i,this.canonical=new tu(o,+c,+m),this.key=i===0&&e===o?this.canonical.key:ql(i,e,o,c,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Zi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Zi(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return ql(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return ql(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Zi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new Zi(i,this.wrap,i,o,c),new Zi(i,this.wrap,i,o+1,c),new Zi(i,this.wrap,i,o,c+1),new Zi(i,this.wrap,i,o+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Zi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Zi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ch(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new bl(e.x-this.wrap,e.y))}getTileVec3(e){return this.canonical.getTileVec3(new bl(e.x-this.wrap,e.y,e.z))}}function ql(r,e,i,o,c){const m=1<<Math.min(i,22);let y=m*(c%m)+o%m;return r&&i<22&&(y+=m*m*((r<0?-2*r-1:2*r)%(1<<2*(22-i)))),16*(32*y+i)+(e-i)}Z("CanonicalTileID",tu),Z("OverscaledTileID",Zi,{omit:["projMatrix"]});class Ah{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class kh{constructor(e,i,o,c,m){this.type="Feature",this._vectorTileFeature=e,e._z=i,e._x=o,e._y=c,this.properties=e.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&(e[i]=this[i]);return e}}var $p=ut([{name:"a_pos",type:"Int16",components:2}]);class Lh{constructor(e,i,o){this.tileID=e,this.uid=xt(),this.uses=0,this.tileSize=i,this.tileZoom=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const i=e+this.timeAdded;i<Dr.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}loadVectorData(e,i,o){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,m){const y={};if(!m)return y;for(const T of c){const A=T.layerIds.map(R=>m.getLayer(R)).filter(Boolean);if(A.length!==0){T.layers=A,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(R=>A.filter(N=>N.id===R)[0]));for(const R of A)y[R.id]=T}}return y}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const m=this.buckets[c];if(m instanceof Ea){if(this.hasSymbolBuckets=!0,!o)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const m=this.buckets[c];if(m instanceof Ea&&m.hasRTLText){this.hasRTLText=!0,x.isLoading()||x.isLoaded()||s()!=="deferred"||p();break}}this.queryPadding=0;for(const c in this.buckets){const m=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(c).queryRadius(m))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Fr}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const o in this.buckets){const c=this.buckets[o];c.uploadPending()&&c.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new dc(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new dc(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new dc(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,o,c,m,y,T,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:T,transform:y,params:m},e,i,o):{}}querySourceFeatures(e,i){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const c=o.loadVTLayers(),m=i?i.sourceLayer:"",y=c._geojsonTileLayer||c[m];if(!y)return;const T=_o(i&&i.filter),{z:A,x:R,y:N}=this.tileID.canonical,q={z:A,x:R,y:N};for(let W=0;W<y.length;W++){const Y=y.feature(W);if(T.needGeometry){const Ce=Wa(Y,!0);if(!T.filter(new S(this.tileID.overscaledZ),Ce,this.tileID.canonical))continue}else if(!T.filter(new S(this.tileID.overscaledZ),Y))continue;const oe=o.getId(Y,m),be=new kh(Y,A,R,N,oe);be.tile=q,e.push(be)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const o=Lr(e.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const o=Date.now();let c=!1;if(this.expirationTime>o)c=!1;else if(i)if(this.expirationTime<i)c=!0;else{const m=this.expirationTime-i;m?this.expirationTime=o+Math.max(m,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const o=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!i.style.hasLayer(c))continue;const m=this.buckets[c],y=m.layers[0].sourceLayer||"_geojsonTileLayer",T=o[y],A=e[y];if(!T||!A||Object.keys(A).length===0)continue;m.update(A,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});const R=i&&i.style&&i.style.getLayer(c);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Dr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Dr.now()+e}setDependencies(e,i){const o={};for(const c of i)o[c]=!0;this.dependencies[e]=o}hasDependency(e,i){for(const o of e){const c=this.dependencies[o];if(c){for(const m of i)if(c[m])return!0}}return!1}clearQueryDebugViz(){}}class Wp{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,o){const c=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},Pe(this.stateChanges[e][c],o),this.deletedStates[e]===null){this.deletedStates[e]={};for(const m in this.state[e])m!==c&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const m in this.state[e][c])o[m]||(this.deletedStates[e][c][m]=null)}else for(const m in o)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][m]===null&&delete this.deletedStates[e][c][m]}removeFeatureState(e,i,o){if(this.deletedStates[e]===null)return;const c=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},o&&i!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][o]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(o in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][o]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,i){const o=String(i),c=Pe({},(this.state[e]||{})[o],(this.stateChanges[e]||{})[o]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const m=this.deletedStates[e][i];if(m===null)return{};for(const y in m)delete c[y]}return c}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const o={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const m={};for(const y in this.stateChanges[c])this.state[c][y]||(this.state[c][y]={}),Pe(this.state[c][y],this.stateChanges[c][y]),m[y]=this.state[c][y];o[c]=m}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const m={};if(this.deletedStates[c]===null)for(const y in this.state[c])m[y]={},this.state[c][y]={};else for(const y in this.deletedStates[c]){if(this.deletedStates[c][y]===null)this.state[c][y]={};else for(const T of Object.keys(this.deletedStates[c][y]))delete this.state[c][y][T];m[y]=this.state[c][y]}o[c]=o[c]||{},Pe(o[c],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(const c in e)e[c].setFeatureState(o,i)}}class Dh{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const o=this.toIdx(e,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function zh(r,e,i,o){let c=0,m=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(o[y])<1e-15){if(i[y]<r[y]||i[y]>e[y])return null}else{const T=1/o[y];let A=(r[y]-i[y])*T,R=(e[y]-i[y])*T;if(A>R){const N=A;A=R,R=N}if(A>c&&(c=A),R<m&&(m=R),c>m)return null}return c}function Oh(r,e,i,o,c,m,y,T,A,R,N){const q=o-r,W=c-e,Y=m-i,oe=y-r,be=T-e,Ce=A-i,Fe=N[1]*Ce-N[2]*be,Ze=N[2]*oe-N[0]*Ce,Ye=N[0]*be-N[1]*oe,ot=q*Fe+W*Ze+Y*Ye;if(Math.abs(ot)<1e-15)return null;const st=1/ot,at=R[0]-r,Ot=R[1]-e,At=R[2]-i,Tt=(at*Fe+Ot*Ze+At*Ye)*st;if(Tt<0||Tt>1)return null;const qt=Ot*Y-At*W,bt=At*q-at*Y,St=at*W-Ot*q,_t=(N[0]*qt+N[1]*bt+N[2]*St)*st;return _t<0||Tt+_t>1?null:(oe*qt+be*bt+Ce*St)*st}function Fh(r,e,i){return(r-e)/(i-e)}function Rh(r,e,i,o,c,m,y,T,A){const R=1<<i,N=m-o,q=y-c,W=(r+1)/R*N+o,Y=(e+0)/R*q+c,oe=(e+1)/R*q+c;T[0]=(r+0)/R*N+o,T[1]=Y,A[0]=W,A[1]=oe}class Bh{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(m){const y=Math.ceil(Math.log2(m.dim/8)),T=[];let A=Math.ceil(Math.pow(2,y));const R=1/A,N=(Y,oe,be,Ce,Fe)=>{const Ze=Ce?1:0,Ye=(Y+1)*be-Ze,ot=oe*be,st=(oe+1)*be-Ze;Fe[0]=Y*be,Fe[1]=ot,Fe[2]=Ye,Fe[3]=st};let q=new Dh(A);const W=[];for(let Y=0;Y<A*A;Y++){N(Y%A,Math.floor(Y/A),R,!1,W);const oe=Ia(W[0],W[1],m),be=Ia(W[2],W[1],m),Ce=Ia(W[2],W[3],m),Fe=Ia(W[0],W[3],m);q.minimums.push(Math.min(oe,be,Ce,Fe)),q.maximums.push(Math.max(oe,be,Ce,Fe)),q.leaves.push(1)}for(T.push(q),A/=2;A>=1;A/=2){const Y=T[T.length-1];q=new Dh(A);for(let oe=0;oe<A*A;oe++){N(oe%A,Math.floor(oe/A),2,!0,W);const be=Y.getElevation(W[0],W[1]),Ce=Y.getElevation(W[2],W[1]),Fe=Y.getElevation(W[2],W[3]),Ze=Y.getElevation(W[0],W[3]),Ye=Y.isLeaf(W[0],W[1]),ot=Y.isLeaf(W[2],W[1]),st=Y.isLeaf(W[2],W[3]),at=Y.isLeaf(W[0],W[3]),Ot=Math.min(be.min,Ce.min,Fe.min,Ze.min),At=Math.max(be.max,Ce.max,Fe.max,Ze.max),Tt=Ye&&ot&&st&&at;q.maximums.push(At),q.minimums.push(Ot),q.leaves.push(At-Ot<=5&&Tt?1:0)}T.push(q)}return T}(this.dem),o=i.length-1,c=i[o];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(e,i,o,c,m,y,T=1){return zh([e,i,-100],[o,c,this.maximums[0]*T],m,y)}raycast(e,i,o,c,m,y,T=1){if(!this.nodeCount)return null;const A=this.raycastRoot(e,i,o,c,m,y,T);if(A==null)return null;const R=[],N=[],q=[],W=[],Y=[{idx:0,t:A,nodex:0,nodey:0,depth:0}];for(;Y.length>0;){const{idx:oe,t:be,nodex:Ce,nodey:Fe,depth:Ze}=Y.pop();if(this.leaves[oe]){Rh(Ce,Fe,Ze,e,i,o,c,q,W);const ot=1<<Ze,st=(Ce+0)/ot,at=(Ce+1)/ot,Ot=(Fe+0)/ot,At=(Fe+1)/ot,Tt=Ia(st,Ot,this.dem)*T,qt=Ia(at,Ot,this.dem)*T,bt=Ia(at,At,this.dem)*T,St=Ia(st,At,this.dem)*T,_t=Oh(q[0],q[1],Tt,W[0],q[1],qt,W[0],W[1],bt,m,y),Mt=Oh(W[0],W[1],bt,q[0],W[1],St,q[0],q[1],Tt,m,y),xn=Math.min(_t!==null?_t:Number.MAX_VALUE,Mt!==null?Mt:Number.MAX_VALUE);if(xn!==Number.MAX_VALUE)return xn;{const Rn=Mu([],m,y,be);if(jh(Tt,qt,St,bt,Fh(Rn[0],q[0],W[0]),Fh(Rn[1],q[1],W[1]))>=Rn[2])return be}continue}let Ye=0;for(let ot=0;ot<this._siblingOffset.length;ot++){Rh((Ce<<1)+this._siblingOffset[ot][0],(Fe<<1)+this._siblingOffset[ot][1],Ze+1,e,i,o,c,q,W),q[2]=-100,W[2]=this.maximums[this.childOffsets[oe]+ot]*T;const st=zh(q,W,m,y);if(st!=null){const at=st;R[ot]=at;let Ot=!1;for(let At=0;At<Ye&&!Ot;At++)at>=R[N[At]]&&(N.splice(At,0,ot),Ot=!0);Ot||(N[Ye]=ot),Ye++}}for(let ot=0;ot<Ye;ot++){const st=N[ot];Y.push({idx:this.childOffsets[oe]+st,t:R[st],nodex:(Ce<<1)+this._siblingOffset[st][0],nodey:(Fe<<1)+this._siblingOffset[st][1],depth:Ze+1})}}return null}_addNode(e,i,o){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,o,c,m){if(e[c].isLeaf(i,o)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const y=c-1,T=e[y];let A,R=0;for(let N=0;N<this._siblingOffset.length;N++){const q=2*i+this._siblingOffset[N][0],W=2*o+this._siblingOffset[N][1],Y=T.getElevation(q,W),oe=T.isLeaf(q,W),be=this._addNode(Y.min,Y.max,oe);oe&&(R|=1<<N),A||(A=be)}for(let N=0;N<this._siblingOffset.length;N++)R&1<<N||this._construct(e,2*i+this._siblingOffset[N][0],2*o+this._siblingOffset[N][1],y,A+N)}}function jh(r,e,i,o,c,m){return Xn(Xn(r,i,m),Xn(e,o,m),c)}function Ia(r,e,i){const o=i.dim,c=le(r*o-.5,0,o-1),m=le(e*o-.5,0,o-1),y=Math.floor(c),T=Math.floor(m),A=Math.min(y+1,o-1),R=Math.min(T+1,o-1);return jh(i.get(y,T),i.get(A,T),i.get(y,R),i.get(A,R),c-y,m-T)}const Uh={vjmaps:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class fc{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,o,c=!1,m=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="vjmaps"&&o!=="terrarium")return rn(`"${o}" is not a valid encoding type. Valid types include "vjmaps" and "terrarium".`);this.stride=i.height;const y=this.dim=i.height-2;if(this.data=new Uint32Array(i.data.buffer),this.encoding=o||"vjmaps",this.borderReady=c,!c){for(let T=0;T<y;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(y,T)]=this.data[this._idx(y-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,y)]=this.data[this._idx(T,y-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(y,-1)]=this.data[this._idx(y-1,0)],this.data[this._idx(-1,y)]=this.data[this._idx(0,y-1)],this.data[this._idx(y,y)]=this.data[this._idx(y-1,y-1)],m&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Bh(this)}get(e,i,o=!1){const c=new Uint8Array(this.data.buffer);o&&(e=le(e,-1,this.dim),i=le(i,-1,this.dim));const m=4*this._idx(e,i);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackvjmaps)(c[m],c[m+1],c[m+2])}static getUnpackVector(e){return Uh[e]}get unpackVector(){return Uh[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}_unpackvjmaps(e,i,o){return(256*e*256+256*i+o)/10-1e4}_unpackTerrarium(e,i,o){return 256*e+i+o/256-32768}static pack(e,i){const o=[0,0,0,0],c=fc.getUnpackVector(i);let m=Math.floor((e+c[3])/c[2]);return o[2]=m%256,m=Math.floor(m/256),o[1]=m%256,m=Math.floor(m/256),o[0]=m,o}getPixels(){return new So({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,m=i*this.dim+this.dim,y=o*this.dim,T=o*this.dim+this.dim;switch(i){case-1:c=m-1;break;case 1:m=c+1}switch(o){case-1:y=T-1;break;case 1:T=y+1}const A=-i*this.dim,R=-o*this.dim;for(let N=y;N<T;N++)for(let q=c;q<m;q++)this.data[this._idx(q,N)]=e.data[this._idx(q+A,N+R)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Z("DEMData",fc),Z("DemMinMaxQuadTree",Bh,{omit:["dem"]});class Hp{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,o){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const m={value:i,timeout:void 0};if(o!==void 0&&(m.timeout=setTimeout(()=>{this.remove(e,m)},o)),this.data[c].push(m),this.order.push(c),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const o=e.wrapped().key,c=i===void 0?0:this.data[o].indexOf(i),m=this.data[o][c];return this.data[o].splice(c,1),m.timeout&&clearTimeout(m.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(m.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const o in this.data)for(const c of this.data[o])e(c.value)||i.push(c);for(const o of i)this.remove(o.value.tileID,o)}}class wl{constructor(e,i,o){this.func=e,this.mask=i,this.range=o}}wl.ReadOnly=!1,wl.ReadWrite=!0,wl.disabled=new wl(519,wl.ReadOnly,[0,1]);class nu{constructor(e,i,o,c,m,y){this.test=e,this.ref=i,this.mask=o,this.fail=c,this.depthFail=m,this.pass=y}}nu.disabled=new nu({func:519,mask:0},0,0,7680,7680,7680);class Ss{constructor(e,i,o){this.blendFunction=e,this.blendColor=i,this.mask=o}}Ss.Replace=[1,0],Ss.disabled=new Ss(Ss.Replace,$n.transparent,[!1,!1,!1,!1]),Ss.unblended=new Ss(Ss.Replace,$n.transparent,[!0,!0,!0,!0]),Ss.alphaBlended=new Ss([1,771],$n.transparent,[!0,!0,!0,!0]);class Qo{constructor(e,i,o){this.enable=e,this.mode=i,this.frontFace=o}}Qo.disabled=new Qo(!1,1029,2305),Qo.backCCW=new Qo(!0,1029,2305),Qo.backCW=new Qo(!0,1029,2304),Qo.frontCW=new Qo(!0,1028,2304),Qo.frontCCW=new Qo(!0,1028,2305);class Ja extends Kt{constructor(e,i,o){super(),this.id=e,this._onlySymbols=o,i.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new Hp(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Wp}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const o=this._tiles[i];o.upload(e),o.prepare(this.map.style.imageManager)}}getIds(){return Ee(this._tiles).map(e=>e.tileID).sort(Nh).map(e=>e.key)}getRenderableIds(e){const i=[];for(const o in this._tiles)this._isIdRenderable(+o,e)&&i.push(this._tiles[o]);return e?i.sort((o,c)=>{const m=o.tileID,y=c.tileID,T=new b(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),A=new b(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-y.overscaledZ||A.y-T.y||A.x-T.x}).map(o=>o.tileID.key):i.map(o=>o.tileID).sort(Nh).map(o=>o.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const o=this._tiles[e];o&&(o.state!=="loading"&&(o.state=i),this._loadTile(o,this._tileLoaded.bind(this,o,e,i)))}_tileLoaded(e,i,o,c){if(c)return e.state="errored",void(c.status!==404?this._source.fire(new sn(c,{tile:e})):this.update(this.transform));e.timeAdded=Dr.now(),o==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Xt("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let c=0;c<i.length;c++){const m=i[c];if(e.neighboringTiles&&e.neighboringTiles[m]){const y=this.getTileByID(m);o(e,y),o(y,e)}}function o(c,m){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let y=m.tileID.canonical.x-c.tileID.canonical.x;const T=m.tileID.canonical.y-c.tileID.canonical.y,A=Math.pow(2,c.tileID.canonical.z),R=m.tileID.key;y===0&&T===0||Math.abs(T)>1||(Math.abs(y)>1&&(Math.abs(y+A)===1?y+=A:Math.abs(y-A)===1&&(y-=A)),m.dem&&c.dem&&(c.dem.backfillBorder(m.dem,y,T),c.neighboringTiles&&c.neighboringTiles[R]&&(c.neighboringTiles[R].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,o,c){for(const m in this._tiles){let y=this._tiles[m];if(c[m]||!y.hasData()||y.tileID.overscaledZ<=i||y.tileID.overscaledZ>o)continue;let T=y.tileID;for(;y&&y.tileID.overscaledZ>i+1;){const R=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[R.key],y&&y.hasData()&&(T=R)}let A=T;for(;A.overscaledZ>i;)if(A=A.scaledTo(A.overscaledZ-1),e[A.key]){c[T.key]=T;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const o=this._loadedParentTiles[e.key];return o&&o.tileID.overscaledZ>=i?o:null}for(let o=e.overscaledZ-1;o>=i;o--){const c=e.scaledTo(o),m=this._getLoadedTile(c);if(m)return m}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const o=Math.ceil(e.width/i)+1,c=Math.ceil(e.height/i)+1,m=Math.floor(o*c*5),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const o={};for(const c in this._tiles){const m=this._tiles[c];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+i),o[m.tileID.key]=m}this._tiles=o;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,i,o){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!o)return;let c;this.updateCacheSize(e,i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(T=>new Zi(T.canonical.z,T.wrap,T.canonical.z,T.canonical.x,T.canonical.y)):(c=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(T=>this._source.hasTile(T)))):c=[];const m=this._updateRetainedTiles(c);if(Gh(this._source.type)&&c.length!==0){const T={},A={},R=Object.keys(m);for(const q of R){const W=m[q],Y=this._tiles[q];if(!Y||Y.fadeEndTime&&Y.fadeEndTime<=Dr.now())continue;const oe=this.findLoadedParent(W,Math.max(W.overscaledZ-Ja.maxOverzooming,this._source.minzoom));oe&&(this._addTile(oe.tileID),T[oe.tileID.key]=oe.tileID),A[q]=W}const N=c[c.length-1].overscaledZ;for(const q in this._tiles){const W=this._tiles[q];if(m[q]||!W.hasData())continue;let Y=W.tileID;for(;Y.overscaledZ>N;){Y=Y.scaledTo(Y.overscaledZ-1);const oe=this._tiles[Y.key];if(oe&&oe.hasData()&&A[Y.key]){m[q]=W.tileID;break}}}for(const q in T)m[q]||(this._coveredTiles[q]=!0,m[q]=T[q])}for(const T in m)this._tiles[T].clearFadeHold();const y=function(T,A){const R=[];for(const N in T)N in A||R.push(N);return R}(this._tiles,m);for(const T of y){const A=this._tiles[T];A.hasSymbolBuckets&&!A.holdingForFade()?A.setHoldDuration(this.map._fadeDuration):A.hasSymbolBuckets&&!A.symbolFadeFinished()||this._removeTile(+T)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(e.length===0)return i;const o={},c=e[e.length-1].overscaledZ,m=e[0].overscaledZ,y=Math.max(m-Ja.maxOverzooming,this._source.minzoom),T=Math.max(m+Ja.maxUnderzooming,this._source.minzoom),A={};for(const R of e){const N=this._addTile(R);i[R.key]=R,N.hasData()||c<this._source.maxzoom&&(A[R.key]=R)}this._retainLoadedChildren(A,c,T,i);for(const R of e){let N=this._tiles[R.key];if(N.hasData())continue;if(R.canonical.z>=this._source.maxzoom){const W=R.children(this._source.maxzoom)[0],Y=this.getTile(W);if(Y&&Y.hasData()){i[W.key]=W;continue}}else{const W=R.children(this._source.maxzoom);if(i[W[0].key]&&i[W[1].key]&&i[W[2].key]&&i[W[3].key])continue}let q=N.wasRequested();for(let W=R.overscaledZ-1;W>=y;--W){const Y=R.scaledTo(W);if(o[Y.key]||(o[Y.key]=!0,N=this.getTile(Y),!N&&q&&(N=this._addTile(Y)),N&&(i[Y.key]=Y,q=N.wasRequested(),N.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let o,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){o=this._loadedParentTiles[c.key];break}i.push(c.key);const m=c.scaledTo(c.overscaledZ-1);if(o=this._getLoadedTile(m),o)break;c=m}for(const m of i)this._loadedParentTiles[m]=o}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const o=Boolean(i);return o||(i=new Lh(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))),i?(i.uses++,this._tiles[e.key]=i,o||this._source.fire(new Xt("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const o=i.getExpiryTimeout();o&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},o))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._cache.reset()}tilesIn(e,i,o){const c=[],m=this.transform;if(!m)return c;for(const y in this._tiles){const T=this._tiles[y];if(o&&T.clearQueryDebugViz(),T.holdingForFade())continue;const A=e.containsTile(T,m,i);A&&c.push(A)}return c}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(o=>this._tiles[o].tileID);for(const o of i)o.projMatrix=this.transform.calculateProjMatrix(o.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(Gh(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=Dr.now())return!0}return!1}setFeatureState(e,i,o){this._state.updateState(e=e||"_geojsonTileLayer",i,o)}removeFeatureState(e,i,o){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,o)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,o){const c=this._tiles[e];c&&c.setDependencies(i,o)}reloadTilesForDependencies(e,i){for(const o in this._tiles)this._tiles[o].hasDependency(e,i)&&this._reloadTile(+o,"reloading");this._cache.filter(o=>!o.hasDependency(e,i))}}function Nh(r,e){const i=Math.abs(2*r.wrap)-+(r.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return r.overscaledZ-e.overscaledZ||o-i||e.canonical.y-r.canonical.y||e.canonical.x-r.canonical.x}function Gh(r){return r==="raster"||r==="image"||r==="video"}Ja.maxOverzooming=10,Ja.maxUnderzooming=3;class mc{constructor(e,i,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(e,i,o){const c=o||e.findDEMTileFor(i);if(!c||!c.dem)return;const m=c.dem,y=c.tileID,T=1<<i.canonical.z-y.canonical.z;return new mc(c,c.tileSize/sr/T,[(i.canonical.x/T-y.canonical.x)*m.dim,(i.canonical.y/T-y.canonical.y)*m.dim])}tileCoordToPixel(e,i){const o=i*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),m=Math.floor(o);return new b(c,m)}getElevationAt(e,i,o,c){const m=e*this._scale+this._offset[0],y=i*this._scale+this._offset[1],T=Math.floor(m),A=Math.floor(y),R=this._dem;return c=!!c,o?Xn(Xn(R.get(T,A,c),R.get(T,A+1,c),y-A),Xn(R.get(T+1,A,c),R.get(T+1,A+1,c),y-A),m-T):R.get(T,A,c)}getElevationAtPixel(e,i,o){return this._dem.get(e,i,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Yc(1,e)*this._dem.stride}}class Vh{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new io(sr,16,0),this.featureIndexArray=new xo,this.promoteId=i}insert(e,i,o,c,m,y=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,m,y);const A=this.grid;for(let R=0;R<i.length;R++){const N=i[R],q=[1/0,1/0,-1/0,-1/0];for(let W=0;W<N.length;W++){const Y=N[W];q[0]=Math.min(q[0],Y.x),q[1]=Math.min(q[1],Y.y),q[2]=Math.max(q[2],Y.x),q[3]=Math.max(q[3],Y.y)}q[0]<sr&&q[1]<sr&&q[2]>=0&&q[3]>=0&&A.insert(T,q[0],q[1],q[2],q[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ha.VectorTile(new Nl(this.rawTileData)).layers,this.sourceLayerCoder=new Ah(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,i,o,c){this.loadVTLayers();const m=e.params||{},y=_o(m.filter),T=e.tileResult,A=e.transform,R=T.bufferedTilespaceBounds,N=this.grid.query(R.min.x,R.min.y,R.max.x,R.max.y,(oe,be,Ce,Fe)=>gu(T.bufferedTilespaceGeometry,oe,be,Ce,Fe));N.sort(Xp);let q=null;A.elevation&&N.length>0&&(q=mc.create(A.elevation,this.tileID));const W={};let Y;for(let oe=0;oe<N.length;oe++){const be=N[oe];if(be===Y)continue;Y=be;const Ce=this.featureIndexArray.get(be);let Fe=null;this.loadMatchingFeature(W,Ce,y,m.layers,m.availableImages,i,o,c,(Ze,Ye,ot,st=0)=>(Fe||(Fe=$a(Ze)),Ye.queryIntersectsFeature(T,Ze,ot,Fe,this.z,e.transform,e.pixelPosMatrix,q,st)))}return W}loadMatchingFeature(e,i,o,c,m,y,T,A,R){const{featureIndex:N,bucketIndex:q,sourceLayerIndex:W,layoutVertexArrayOffset:Y}=i,oe=this.bucketLayerIDs[q];if(c&&!function(Ze,Ye){for(let ot=0;ot<Ze.length;ot++)if(Ye.indexOf(Ze[ot])>=0)return!0;return!1}(c,oe))return;const be=this.sourceLayerCoder.decode(W),Ce=this.vtLayers[be].feature(N);if(o.needGeometry){const Ze=Wa(Ce,!0);if(!o.filter(new S(this.tileID.overscaledZ),Ze,this.tileID.canonical))return}else if(!o.filter(new S(this.tileID.overscaledZ),Ce))return;const Fe=this.getId(Ce,be);for(let Ze=0;Ze<oe.length;Ze++){const Ye=oe[Ze];if(c&&c.indexOf(Ye)<0)continue;const ot=y[Ye];if(!ot)continue;let st={};Fe!==void 0&&A&&(st=A.getState(ot.sourceLayer||"_geojsonTileLayer",Fe));const at=Pe({},T[Ye]);at.paint=qh(at.paint,ot.paint,Ce,st,m),at.layout=qh(at.layout,ot.layout,Ce,st,m);const Ot=!R||R(Ce,ot,st,Y);if(!Ot)continue;const At=new kh(Ce,this.z,this.x,this.y,Fe);At.layer=at;let Tt=e[Ye];Tt===void 0&&(Tt=e[Ye]=[]),Tt.push({featureIndex:N,feature:At,intersectionZ:Ot})}}lookupSymbolFeatures(e,i,o,c,m,y,T,A){const R={};this.loadVTLayers();const N=_o(m);for(const q of e)this.loadMatchingFeature(R,{bucketIndex:o,sourceLayerIndex:c,featureIndex:q,layoutVertexArrayOffset:0},N,y,T,A,i);return R}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof o=="boolean"&&(o=Number(o))),o}}function qh(r,e,i,o,c){return mn(r,(m,y)=>{const T=e instanceof me?e.get(y):null;return T&&T.evaluate?T.evaluate(i,o,c):T})}function Xp(r,e){return e-r}Z("FeatureIndex",Vh,{omit:["rawTileData","sourceLayerCoder"]});class Zh{constructor(e){const i={},o=[];for(const T in e){const A=e[T],R=i[T]={};for(const N in A){const q=A[+N];if(!q||q.bitmap.width===0||q.bitmap.height===0)continue;const W=q.metrics.localGlyph?2:1,Y={x:0,y:0,w:q.bitmap.width+2*W,h:q.bitmap.height+2*W};o.push(Y),R[N]={rect:Y,metrics:q.metrics}}}const{w:c,h:m}=jc(o),y=new ba({width:c||1,height:m||1});for(const T in e){const A=e[T];for(const R in A){const N=A[+R];if(!N||N.bitmap.width===0||N.bitmap.height===0)continue;const q=i[T][R].rect,W=N.metrics.localGlyph?2:1;ba.copy(N.bitmap,y,{x:0,y:0},{x:q.x+W,y:q.y+W},N.bitmap)}}this.image=y,this.positions=i}}Z("GlyphAtlas",Zh);class Jp{constructor(e){this.tileID=new Zi(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile}parse(e,i,o,c,m){this.status="parsing",this.data=e,this.collisionBoxArray=new Fr;const y=new Ah(Object.keys(e.layers).sort()),T=new Vh(this.tileID,this.promoteId);T.bucketLayerIDs=[];const A={},R=new eu(256,256),N={featureIndex:T,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:R,availableImages:o},q=i.familiesBySource[this.source];for(const st in q){const at=e.layers[st];if(!at)continue;let Ot=!1,At=!1;for(const bt of q[st])bt[0].type==="symbol"?Ot=!0:At=!0;if(this.isSymbolTile===!0&&!Ot||this.isSymbolTile===!1&&!At)continue;at.version===1&&rn(`Vector tile source "${this.source}" layer "${st}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Tt=y.encode(st),qt=[];for(let bt=0;bt<at.length;bt++){const St=at.feature(bt),_t=T.getId(St,st);qt.push({feature:St,id:_t,index:bt,sourceLayerIndex:Tt})}for(const bt of q[st]){const St=bt[0];this.isSymbolTile!==void 0&&St.type==="symbol"!==this.isSymbolTile||St.minzoom&&this.zoom<Math.floor(St.minzoom)||St.maxzoom&&this.zoom>=St.maxzoom||St.visibility!=="none"&&(ru(bt,this.zoom,o),(A[St.id]=St.createBucket({index:T.bucketLayerIDs.length,layers:bt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Tt,sourceID:this.source,enableTerrain:this.enableTerrain})).populate(qt,N,this.tileID.canonical),T.bucketLayerIDs.push(bt.map(_t=>_t.id)))}}let W,Y,oe,be;R.trim();const Ce={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Fe=mn(N.glyphDependencies,st=>Object.keys(st).map(Number));Object.keys(Fe).length?c.send("getGlyphs",{uid:this.uid,stacks:Fe},(st,at)=>{W||(W=st,Y=at,ot.call(this))},void 0,!1,Ce):Y={};const Ze=Object.keys(N.iconDependencies);Ze.length?c.send("getImages",{icons:Ze,source:this.source,tileID:this.tileID,type:"icons"},(st,at)=>{W||(W=st,oe=at,ot.call(this))},void 0,!1,Ce):oe={};const Ye=Object.keys(N.patternDependencies);function ot(){if(W)return m(W);if(Y&&oe&&be){const st=new Zh(Y),at=new Qu(oe,be);for(const Ot in A){const At=A[Ot];At instanceof Ea?(ru(At.layers,this.zoom,o),kp(At,Y,st.positions,oe,at.iconPositions,this.showCollisionBoxes,this.tileID.canonical,this.tileZoom)):At.hasPattern&&(At instanceof Fc||At instanceof zc||At instanceof Oc)&&(ru(At.layers,this.zoom,o),At.addFeatures(N,this.tileID.canonical,at.patternPositions))}this.status="done",m(null,{buckets:Ee(A).filter(Ot=>!Ot.isEmpty()),featureIndex:T,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:st.image,lineAtlas:R,imageAtlas:at,glyphMap:this.returnDependencies?Y:null,iconMap:this.returnDependencies?oe:null,glyphPositions:this.returnDependencies?st.positions:null})}}Ye.length?c.send("getImages",{icons:Ye,source:this.source,tileID:this.tileID,type:"patterns"},(st,at)=>{W||(W=st,be=at,ot.call(this))},void 0,!1,Ce):be={},ot.call(this)}}function ru(r,e,i){const o=new S(e);for(const c of r)c.recalculate(o,i)}class $h{constructor(e){this.entries={},this.scheduler=e}request(e,i,o,c){const m=this.entries[e]=this.entries[e]||{callbacks:[]};if(m.result){const[y,T]=m.result;return this.scheduler?this.scheduler.add(()=>{c(y,T)},i):c(y,T),()=>{}}return m.callbacks.push(c),m.cancel||(m.cancel=o((y,T)=>{m.result=[y,T];for(const A of m.callbacks)this.scheduler?this.scheduler.add(()=>{A(y,T)},i):A(y,T);setTimeout(()=>delete this.entries[e],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(y=>y!==c),m.callbacks.length||(m.cancel(),delete this.entries[e]))}}}function Wh(r,e,i){const o=JSON.stringify(r.request);return r.data&&(this.deduped.entries[o]={result:[null,r.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},c=>{const m=xe(r.request,(y,T,A,R)=>{y?c(y):T&&c(null,{vectorTile:i?void 0:new Ha.VectorTile(new Nl(T)),rawData:T,cacheControl:A,expires:R})});return()=>{m.cancel(),c()}},e)}n.ARRAY_TYPE=oo,n.AUTH_ERR_MSG=Fi,n.Actor=class{constructor(r,e,i){this.target=r,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},Pt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=dn()?r:P,this.scheduler=new Zp}send(r,e,i,o,c=!1,m){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=m,this.callbacks[y]=i);const T=uo(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:r,hasCallback:!!i,targetMapId:o,mustQueue:c,sourceMapId:this.mapId,data:fe(e,T)},T),{cancel:()=>{i&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(r){const e=r.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const o=this.cancelCallbacks[i];delete this.cancelCallbacks[i],o&&o.cancel()}else if(e.mustQueue||dn()){const o=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),o&&o.metadata||{type:"message"})}else this.processTask(i,e)}processTask(r,e){if(e.type==="<response>"){const i=this.callbacks[r];delete this.callbacks[r],i&&(e.error?i(ce(e.error)):i(null,ce(e.data)))}else{const i=uo(this.globalScope)?void 0:[],o=e.hasCallback?(m,y)=>{delete this.cancelCallbacks[r],this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:m?fe(m):null,data:fe(y,i)},i)}:m=>{},c=ce(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,c,o);else if(this.parent.getWorkerSource){const m=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,m[0],c.source)[m[1]](c,o)}else o(new Error("Could not find function "+e.type))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},n.CanonicalTileID=tu,n.Color=$n,n.ColorMode=Ss,n.CullFaceMode=Qo,n.DEMData=fc,n.DataConstantProperty=ae,n.DedupedRequest=$h,n.DepthMode=wl,n.EXTENT=sr,n.Elevation=class{getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,i=!0){e==null&&(e=null);const o=this._source();if(!o||r.y<0||r.y>1)return e;const c=o.getSource().maxzoom,m=1<<c,y=Math.floor(r.x),T=r.x-y,A=new Zi(c,y,c,Math.floor(T*m),Math.floor(r.y*m)),R=this.findDEMTileFor(A);if(!R||!R.dem)return e;const N=R.dem,q=1<<R.tileID.canonical.z,W=(T*q-R.tileID.canonical.x)*N.dim,Y=(r.y*q-R.tileID.canonical.y)*N.dim,oe=Math.floor(W),be=Math.floor(Y);return(i?this.exaggeration():1)*Xn(Xn(N.get(oe,be),N.get(oe,be+1),Y-be),Xn(N.get(oe+1,be),N.get(oe+1,be+1),Y-be),W-oe)}getAtTileOffset(r,e,i){const o=1<<r.canonical.z;return this.getAtPointOrZero(new bl(r.wrap+(r.canonical.x+e/sr)/o,(r.canonical.y+i/sr)/o))}getForTilePoints(r,e,i,o){const c=mc.create(this,r,o);return!!c&&(e.forEach(m=>{m[2]=this.exaggeration()*c.getElevationAt(m[0],m[1],i)}),!0)}getMinMaxForTile(r){const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const i=e.dem.tree,o=e.tileID,c=1<<r.canonical.z-o.canonical.z;let m=r.canonical.x/c-o.canonical.x,y=r.canonical.y/c-o.canonical.y,T=0;for(let A=0;A<r.canonical.z-o.canonical.z&&!i.leaves[T];A++){m*=2,y*=2;const R=2*Math.floor(y)+Math.floor(m);T=i.childOffsets[T]+R,m%=1,y%=1}return{min:this.exaggeration()*i.minimums[T],max:this.exaggeration()*i.maximums[T]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},n.ErrorEvent=sn,n.EvaluationParameters=S,n.Event=Xt,n.Evented=Kt,n.GlyphManager=vl,n.ImagePosition=Uc,n.LineAtlas=eu,n.LngLat=Ar,n.LngLatBounds=Xa,n.LocalGlyphMode=Vc,n.MAX_SAFE_INTEGER=C,n.MercatorCoordinate=bl,n.ONE_EM=24,n.OverscaledTileID=Zi,n.Properties=Ae,n.RGBAImage=So,n.RequestManager=class{constructor(r,e,i){this._transformRequestFn=r,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const r=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",tr,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,e){return this._transformRequestFn&&this._transformRequestFn(r,e)||{url:r}}normalizeStyleURL(r,e){if(!$r(r))return r;const i=gr(r);return i.path="/styles/v1"+i.path,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(r,e){if(!$r(r))return r;const i=gr(r);return i.path="/fonts/v1"+i.path,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(r,e){if(!$r(r))return r;const i=gr(r);return i.path=`/v4/${i.authority}.json`,i.params.push("secure"),this._makeAPIURL(i,this._customAccessToken||e)}normalizeSpriteURL(r,e,i,o){const c=gr(r);return $r(r)?(c.path=`/styles/v1${c.path}/sprite${e}${i}`,this._makeAPIURL(c,this._customAccessToken||o)):(c.path+=`${e}${i}`,ei(c))}normalizeTileURL(r,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!$r(r))return r;const o=gr(r);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&o.authority!=="raster"&&i===512?"@2x":""}${Hi.supported?".webp":"$1"}`),o.authority==="raster"?o.path=`/${Dn.RASTER_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${Dn.TILE_URL_VERSION}${o.path}`);const c=this._customAccessToken||function(m){for(const y of m){const T=y.match(/^access_token=(.*)$/);if(T)return T[1]}return null}(o.params)||Dn.ACCESS_TOKEN;return Dn.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&o.params.push("sku="+this._skuToken),this._makeAPIURL(o,c)}canonicalizeTileURL(r,e){const i=gr(r);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return r;let o="vjmaps://";i.path.match(/^\/raster\/v1\//)?o+="raster/"+i.path.replace(`/${Dn.RASTER_URL_PREFIX}/`,""):o+="tiles/"+i.path.replace(`/${Dn.TILE_URL_VERSION}/`,"");let c=i.params;return e&&(c=c.filter(m=>!m.match(/^access_token=/))),c.length&&(o+="?"+c.join("&")),o}canonicalizeTileset(r,e){const i=!!e&&$r(e),o=[];for(const c of r.tiles||[])Xi(c)?o.push(this.canonicalizeTileURL(c,i)):o.push(c);return o}_makeAPIURL(r,e){const i="See  https://www.vjmap.com/api-documentation/#access-tokens-and-token-scopes",o=gr(Dn.API_URL);if(r.protocol=o.protocol,r.authority=o.authority,r.protocol==="http"){const c=r.params.indexOf("secure");c>=0&&r.params.splice(c,1)}if(o.path!=="/"&&(r.path=`${o.path}${r.path}`),!Dn.REQUIRE_ACCESS_TOKEN)return ei(r);if(e=e||Dn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error("An API access token is required to use vjmaps GL. "+i);if(e[0]==="s")throw new Error("Use a public access token (pk.*) with vjmaps GL, not a secret access token (sk.*). "+i)}return r.params=r.params.filter(c=>c.indexOf("access_token")===-1),r.params.push("access_token="+(e||"")),ei(r)}},n.ResourceType=Mn,n.SegmentVector=vi,n.SourceCache=Ja,n.StencilMode=nu,n.StructArrayLayout1ui2=Jn,n.StructArrayLayout2f1f2i16=yn,n.StructArrayLayout2i4=ze,n.StructArrayLayout2ui4=Hn,n.StructArrayLayout3f12=Be,n.StructArrayLayout3ui6=Cn,n.StructArrayLayout4i8=Gt,n.Texture=dc,n.Tile=Lh,n.Transitionable=V,n.Uniform1f=Zs,n.Uniform1i=class extends Fo{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},n.Uniform2f=class extends Fo{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},n.Uniform3f=class extends Fo{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},n.Uniform4f=qa,n.UniformColor=Cl,n.UniformMatrix3f=class extends Fo{constructor(r,e){super(r,e),this.current=ll}set(r){for(let e=0;e<9;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}},n.UniformMatrix4f=class extends Fo{constructor(r,e){super(r,e),this.current=al}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},n.UnwrappedTileID=Ch,n.ValidationError=ft,n.VectorTileWorkerSource=class extends Kt{constructor(r,e,i,o,c){super(),this.actor=r,this.layerIndex=e,this.availableImages=i,this.loadVectorData=c||Wh,this.loading={},this.loaded={},this.deduped=new $h(r.scheduler),this.isSpriteLoaded=o,this.scheduler=r.scheduler}loadTile(r,e){const i=r.uid,o=r&&r.request,c=o&&o.collectResourceTiming,m=this.loading[i]=new Jp(r);m.abort=this.loadVectorData(r,(y,T)=>{const A=!this.loading[i];if(delete this.loading[i],A||y||!T)return m.status="done",A||(this.loaded[i]=m),e(y);const R=T.rawData,N={};T.expires&&(N.expires=T.expires),T.cacheControl&&(N.cacheControl=T.cacheControl),m.vectorTile=T.vectorTile||new Ha.VectorTile(new Nl(R));const q=()=>{m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,(W,Y)=>{if(W||!Y)return e(W);const oe={};if(c){const be=Th(o);be.length>0&&(oe.resourceTiming=JSON.parse(JSON.stringify(be)))}e(null,Pe({rawTileData:R.slice(0)},Y,N,oe))})};this.isSpriteLoaded?q():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(q,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom}):q()}),this.loaded=this.loaded||{},this.loaded[i]=m})}reloadTile(r,e){const i=this.loaded,o=r.uid,c=this;if(i&&i[o]){const m=i[o];m.showCollisionBoxes=r.showCollisionBoxes,m.enableTerrain=!!r.enableTerrain;const y=(T,A)=>{const R=m.reloadCallback;R&&(delete m.reloadCallback,m.parse(m.vectorTile,c.layerIndex,this.availableImages,c.actor,R)),e(T,A)};m.status==="parsing"?m.reloadCallback=y:m.status==="done"&&(m.vectorTile?m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(r,e){const i=r.uid,o=this.loading[i];o&&(o.abort&&o.abort(),delete this.loading[i]),e()}removeTile(r,e){const i=this.loaded,o=r.uid;i&&i[o]&&delete i[o],e()}},n.WritingMode=so,n.ZoomHistory=Se,n.add=function(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r},n.addDynamicAttributes=Wc,n.altitudeFromMercatorZ=Qc,n.asyncAll=de,n.bezier=ee,n.bindAll=Pt,n.bufferConvexPolygon=function(r,e){const i=[];for(let o=0;o<r.length;o++){const c=pe(o-1,-1,r.length-1),m=pe(o+1,-1,r.length-1),y=r[o],T=r[m],A=r[c].sub(y).unit(),R=T.sub(y).unit(),N=R.angleWithSep(A.x,A.y),q=A.add(R).unit().mult(-1*e/Math.sin(N/2));i.push(y.add(q))}return i},n.cacheEntryPossiblyAdded=function(r){Sn++,Sn>Ft&&(r.getActor().send("enforceCacheSizeLimit",Vt),Sn=0)},n.clamp=le,n.clearTileCache=function(r){const e=P.caches.delete(mt);r&&e.catch(r).then(()=>r())},n.clipLine=lh,n.clone=function(r){var e=new oo(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e},n.clone$1=function(r){var e=new oo(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},n.clone$2=ht,n.collisionCircleLayout=op,n.config=Dn,n.conjugate=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},n.copy=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r},n.create=Jl,n.create$1=function(){var r=new oo(16);return oo!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},n.create$2=vu,n.createExpression=Us,n.createFilter=_o,n.createLayout=ut,n.createStyleLayer=function(r){return r.type==="custom"?new Up(r):new Gp[r.type](r)},n.cross=function(r,e,i){var o=e[0],c=e[1],m=e[2],y=i[0],T=i[1],A=i[2];return r[0]=c*A-m*T,r[1]=m*y-o*A,r[2]=o*T-c*y,r},n.degToRad=F,n.div=function(r,e,i){return r[0]=e[0]/i[0],r[1]=e[1]/i[1],r[2]=e[2]/i[2],r},n.dot=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]},n.dot$1=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]},n.ease=Q,n.easeCubicInOut=K,n.emitValidationErrors=ya,n.endsWith=nn,n.enforceCacheSizeLimit=function(r){kt(),Dt&&Dt.then(e=>{e.keys().then(i=>{for(let o=0;o<i.length-r;o++)e.delete(i[o])})})},n.evaluateSizeForFeature=tc,n.evaluateSizeForZoom=fl,n.evaluateVariableOffset=fh,n.evented=t,n.exactEquals=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},n.exactEquals$1=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]},n.exported=Dr,n.exported$1=Hi,n.extend=Pe,n.filterObject=cn,n.fromMat4=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},n.fromQuat=function(r,e){var i=e[0],o=e[1],c=e[2],m=e[3],y=i+i,T=o+o,A=c+c,R=i*y,N=o*y,q=o*T,W=c*y,Y=c*T,oe=c*A,be=m*y,Ce=m*T,Fe=m*A;return r[0]=1-q-oe,r[1]=N+Fe,r[2]=W-Ce,r[3]=0,r[4]=N-Fe,r[5]=1-R-oe,r[6]=Y+be,r[7]=0,r[8]=W+Ce,r[9]=Y-be,r[10]=1-R-q,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},n.fromRotation=function(r,e){var i=Math.sin(e),o=Math.cos(e);return r[0]=o,r[1]=i,r[2]=0,r[3]=-i,r[4]=o,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},n.fromScaling=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},n.furthestTileCorner=function(r){const e=Math.round((r+45+360)%360/90)%4;return j[e]},n.getAABBPointSquareDist=function(r,e,i){let o=0;for(let c=0;c<2;++c){const m=i?i[c]:0;r[c]>m&&(o+=(r[c]-m)*(r[c]-m)),e[c]<m&&(o+=(m-e[c])*(m-e[c]))}return o},n.getAnchorAlignment=Gc,n.getAnchorJustification=Zc,n.getBounds=function(r){let e=1/0,i=1/0,o=-1/0,c=-1/0;for(const m of r)e=Math.min(e,m.x),i=Math.min(i,m.y),o=Math.max(o,m.x),c=Math.max(c,m.y);return{min:new b(e,i),max:new b(o,c)}},n.getImage=gt,n.getJSON=function(r,e){return te(Pe(r,{type:"json"}),e)},n.getMapSessionAPI=ke,n.getPerformanceMeasurement=Th,n.getRTLTextPluginStatus=s,n.getReferrer=X,n.getVideo=function(r,e){const i=P.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<r.length;o++){const c=P.document.createElement("source");Qe(r[o])||(i.crossOrigin="Anonymous"),c.src=r[o],i.appendChild(c)}return{cancel:()=>{}}},n.identity=wc,n.identity$1=Tu,n.invert=function(r,e){var i=e[0],o=e[1],c=e[2],m=e[3],y=e[4],T=e[5],A=e[6],R=e[7],N=e[8],q=e[9],W=e[10],Y=e[11],oe=e[12],be=e[13],Ce=e[14],Fe=e[15],Ze=i*T-o*y,Ye=i*A-c*y,ot=i*R-m*y,st=o*A-c*T,at=o*R-m*T,Ot=c*R-m*A,At=N*be-q*oe,Tt=N*Ce-W*oe,qt=N*Fe-Y*oe,bt=q*Ce-W*be,St=q*Fe-Y*be,_t=W*Fe-Y*Ce,Mt=Ze*_t-Ye*St+ot*bt+st*qt-at*Tt+Ot*At;return Mt?(r[0]=(T*_t-A*St+R*bt)*(Mt=1/Mt),r[1]=(c*St-o*_t-m*bt)*Mt,r[2]=(be*Ot-Ce*at+Fe*st)*Mt,r[3]=(W*at-q*Ot-Y*st)*Mt,r[4]=(A*qt-y*_t-R*Tt)*Mt,r[5]=(i*_t-c*qt+m*Tt)*Mt,r[6]=(Ce*ot-oe*Ot-Fe*Ye)*Mt,r[7]=(N*Ot-W*ot+Y*Ye)*Mt,r[8]=(y*St-T*qt+R*At)*Mt,r[9]=(o*qt-i*St-m*At)*Mt,r[10]=(oe*at-be*ot+Fe*Ze)*Mt,r[11]=(q*ot-N*at-Y*Ze)*Mt,r[12]=(T*Tt-y*bt-A*At)*Mt,r[13]=(i*bt-o*Tt+c*At)*Mt,r[14]=(be*Ye-oe*st-Ce*Ze)*Mt,r[15]=(N*st-q*Ye+W*Ze)*Mt,r):null},n.isMapAuthenticated=function(r){return dt.has(r)},n.isvjmapsURL=$r,n.latFromMercatorY=pc,n.len=fd,n.length=bu,n.length$1=function(r){return Math.hypot(r[0],r[1],r[2],r[3])},n.loadVectorTile=Wh,n.makeRequest=te,n.mercatorXfromLng=Eh,n.mercatorYfromLat=Ih,n.mercatorZfromAltitude=Yc,n.mul=function(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r[3]=e[3]*i[3],r},n.mul$1=hd,n.mul$2=pd,n.multiply=xu,n.multiply$1=Su,n.nextPowerOfTwo=ct,n.normalize=Eu,n.normalize$1=function(r,e){var i=e[0],o=e[1],c=e[2],m=e[3],y=i*i+o*o+c*c+m*m;return y>0&&(y=1/Math.sqrt(y)),r[0]=i*y,r[1]=o*y,r[2]=c*y,r[3]=m*y,r},n.number=Xn,n.ortho=function(r,e,i,o,c,m,y){var T=1/(e-i),A=1/(o-c),R=1/(m-y);return r[0]=-2*T,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*A,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*R,r[11]=0,r[12]=(e+i)*T,r[13]=(c+o)*A,r[14]=(y+m)*R,r[15]=1,r},n.pbf=Nl,n.perspective=function(r,e,i,o,c){var m,y=1/Math.tan(e/2);return r[0]=y/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=y,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,c!=null&&c!==1/0?(r[10]=(c+o)*(m=1/(o-c)),r[14]=2*c*o*m):(r[10]=-1,r[14]=-2*o),r},n.pick=function(r,e){const i={};for(let o=0;o<e.length;o++){const c=e[o];c in r&&(i[c]=r[c])}return i},n.plugin=x,n.pointGeometry=b,n.polygonIntersectsBox=gu,n.polygonIntersectsPolygon=du,n.polygonizeBounds=function(r,e,i=0,o=!0){const c=new b(i,i),m=r.sub(c),y=e.add(c),T=[m,new b(y.x,m.y),y,new b(m.x,y.y)];return o&&T.push(m),T},n.posAttributes=$p,n.postMapLoadEvent=we,n.postTurnstileEvent=Io,n.potpack=jc,n.prevPowerOfTwo=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},n.radToDeg=function(r){return r*D},n.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.registerForPluginStateChange=function(r){return r({pluginStatus:ln,pluginURL:hn}),t.on("pluginStateChange",r),r},n.removeAuthState=function(r){dt.delete(r)},n.renderColorRamp=Ic,n.rotateX=function(r,e,i){var o=Math.sin(i),c=Math.cos(i),m=e[4],y=e[5],T=e[6],A=e[7],R=e[8],N=e[9],q=e[10],W=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=m*c+R*o,r[5]=y*c+N*o,r[6]=T*c+q*o,r[7]=A*c+W*o,r[8]=R*c-m*o,r[9]=N*c-y*o,r[10]=q*c-T*o,r[11]=W*c-A*o,r},n.rotateX$1=Pu,n.rotateY=function(r,e,i){var o=Math.sin(i),c=Math.cos(i),m=e[0],y=e[1],T=e[2],A=e[3],R=e[8],N=e[9],q=e[10],W=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=m*c-R*o,r[1]=y*c-N*o,r[2]=T*c-q*o,r[3]=A*c-W*o,r[8]=m*o+R*c,r[9]=y*o+N*c,r[10]=T*o+q*c,r[11]=A*o+W*c,r},n.rotateZ=function(r,e,i){var o=Math.sin(i),c=Math.cos(i),m=e[0],y=e[1],T=e[2],A=e[3],R=e[4],N=e[5],q=e[6],W=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=m*c+R*o,r[1]=y*c+N*o,r[2]=T*c+q*o,r[3]=A*c+W*o,r[4]=R*c-m*o,r[5]=N*c-y*o,r[6]=q*c-T*o,r[7]=W*c-A*o,r},n.rotateZ$1=function(r,e,i){i*=.5;var o=e[0],c=e[1],m=e[2],y=e[3],T=Math.sin(i),A=Math.cos(i);return r[0]=o*A+c*T,r[1]=c*A-o*T,r[2]=m*A+y*T,r[3]=y*A-m*T,r},n.scale=function(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r},n.scale$1=function(r,e,i){var o=i[0],c=i[1],m=i[2];return r[0]=e[0]*o,r[1]=e[1]*o,r[2]=e[2]*o,r[3]=e[3]*o,r[4]=e[4]*c,r[5]=e[5]*c,r[6]=e[6]*c,r[7]=e[7]*c,r[8]=e[8]*m,r[9]=e[9]*m,r[10]=e[10]*m,r[11]=e[11]*m,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},n.scale$2=function(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r},n.scaleAndAdd=Mu,n.setCacheLimits=function(r,e){Vt=r,Ft=e},n.setRTLTextPlugin=function(r,e,i=!1){if(ln===Ut||ln===Et||ln===Ct)throw new Error("setRTLTextPlugin cannot be called multiple times.");hn=Dr.resolveURL(r),ln=Ut,tn=e,d(),i||p()},n.smoothstep=function(r,e,i){return(i=le((i-r)/(e-r),0,1))*i*(3-2*i)},n.spec=je,n.storeAuthState=function(r,e){e?dt.add(r):dt.delete(r)},n.sub=dd,n.subtract=wu,n.symbolSize=sp,n.transformMat3=function(r,e,i){var o=e[0],c=e[1],m=e[2];return r[0]=o*i[0]+c*i[3]+m*i[6],r[1]=o*i[1]+c*i[4]+m*i[7],r[2]=o*i[2]+c*i[5]+m*i[8],r},n.transformMat4=Dl,n.transformMat4$1=function(r,e,i){var o=e[0],c=e[1],m=e[2],y=i[3]*o+i[7]*c+i[11]*m+i[15];return r[0]=(i[0]*o+i[4]*c+i[8]*m+i[12])/(y=y||1),r[1]=(i[1]*o+i[5]*c+i[9]*m+i[13])/y,r[2]=(i[2]*o+i[6]*c+i[10]*m+i[14])/y,r},n.transformQuat=Iu,n.translate=function(r,e,i){var o,c,m,y,T,A,R,N,q,W,Y,oe,be=i[0],Ce=i[1],Fe=i[2];return e===r?(r[12]=e[0]*be+e[4]*Ce+e[8]*Fe+e[12],r[13]=e[1]*be+e[5]*Ce+e[9]*Fe+e[13],r[14]=e[2]*be+e[6]*Ce+e[10]*Fe+e[14],r[15]=e[3]*be+e[7]*Ce+e[11]*Fe+e[15]):(c=e[1],m=e[2],y=e[3],T=e[4],A=e[5],R=e[6],N=e[7],q=e[8],W=e[9],Y=e[10],oe=e[11],r[0]=o=e[0],r[1]=c,r[2]=m,r[3]=y,r[4]=T,r[5]=A,r[6]=R,r[7]=N,r[8]=q,r[9]=W,r[10]=Y,r[11]=oe,r[12]=o*be+T*Ce+q*Fe+e[12],r[13]=c*be+A*Ce+W*Fe+e[13],r[14]=m*be+R*Ce+Y*Fe+e[14],r[15]=y*be+N*Ce+oe*Fe+e[15]),r},n.triggerPluginCompletionEvent=vn,n.uniqueId=xt,n.validateCustomStyleLayer=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},n.validateFog=Na,n.validateLight=Tl,n.validateStyle=vs,n.values=Ee,n.vectorTile=Ha,n.version=u,n.warnOnce=rn,n.window=P,n.wrap=pe}),l(0,function(n){function u(ve){const X=typeof ve;if(X==="number"||X==="boolean"||X==="string"||ve==null)return JSON.stringify(ve);if(Array.isArray(ve)){let Ie="[";for(const Ue of ve)Ie+=u(Ue)+",";return Ie+"]"}const te=Object.keys(ve).sort();let xe="{";for(let Ie=0;Ie<te.length;Ie++)xe+=`${JSON.stringify(te[Ie])}:${u(ve[te[Ie]])},`;return xe+"}"}function v(ve){let X="";for(const te of n.refProperties)X+="/"+u(ve[te]);return X}class _{constructor(X){this.keyCache={},X&&this.replace(X)}replace(X){this._layerConfigs={},this._layers={},this.update(X,[])}update(X,te){for(const Ie of X){this._layerConfigs[Ie.id]=Ie;const Ue=this._layers[Ie.id]=n.createStyleLayer(Ie);Ue._featureFilter=n.createFilter(Ue.filter),this.keyCache[Ie.id]&&delete this.keyCache[Ie.id]}for(const Ie of te)delete this.keyCache[Ie],delete this._layerConfigs[Ie],delete this._layers[Ie];this.familiesBySource={};const xe=function(Ie,Ue){const Qe={};for(let Ve=0;Ve<Ie.length;Ve++){const et=Ue&&Ue[Ie[Ve].id]||v(Ie[Ve]);Ue&&(Ue[Ie[Ve].id]=et);let gt=Qe[et];gt||(gt=Qe[et]=[]),gt.push(Ie[Ve])}const Ke=[];for(const Ve in Qe)Ke.push(Qe[Ve]);return Ke}(n.values(this._layerConfigs),this.keyCache);for(const Ie of xe){const Ue=Ie.map(jt=>this._layers[jt.id]),Qe=Ue[0];if(Qe.visibility==="none")continue;const Ke=Qe.source||"";let Ve=this.familiesBySource[Ke];Ve||(Ve=this.familiesBySource[Ke]={});const et=Qe.sourceLayer||"_geojsonTileLayer";let gt=Ve[et];gt||(gt=Ve[et]=[]),gt.push(Ue)}}}const{ImageBitmap:b}=n.window;class M{loadTile(X,te){const{uid:xe,encoding:Ie,rawImageData:Ue,padding:Qe,buildQuadTree:Ke}=X,Ve=b&&Ue instanceof b?this.getImageData(Ue,Qe):Ue;te(null,new n.DEMData(xe,Ve,Ie,Qe<1,Ke))}getImageData(X,te){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(X.width,X.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=X.width,this.offscreenCanvas.height=X.height,this.offscreenCanvasContext.drawImage(X,0,0,X.width,X.height);const xe=this.offscreenCanvasContext.getImageData(-te,-te,X.width+2*te,X.height+2*te);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new n.RGBAImage({width:xe.width,height:xe.height},xe.data)}}var P=function ve(X,te){var xe,Ie=X&&X.type;if(Ie==="FeatureCollection")for(xe=0;xe<X.features.length;xe++)ve(X.features[xe],te);else if(Ie==="GeometryCollection")for(xe=0;xe<X.geometries.length;xe++)ve(X.geometries[xe],te);else if(Ie==="Feature")ve(X.geometry,te);else if(Ie==="Polygon")C(X.coordinates,te);else if(Ie==="MultiPolygon")for(xe=0;xe<X.coordinates.length;xe++)C(X.coordinates[xe],te);return X};function C(ve,X){if(ve.length!==0){L(ve[0],X);for(var te=1;te<ve.length;te++)L(ve[te],!X)}}function L(ve,X){for(var te=0,xe=0,Ie=ve.length,Ue=Ie-1;xe<Ie;Ue=xe++)te+=(ve[xe][0]-ve[Ue][0])*(ve[Ue][1]+ve[xe][1]);te>=0!=!!X&&ve.reverse()}const D=n.vectorTile.VectorTileFeature.prototype.toGeoJSON;class F{constructor(X){this._feature=X,this.extent=n.EXTENT,this.type=X.type,this.properties=X.tags,"id"in X&&!isNaN(X.id)&&(this.id=parseInt(X.id,10))}loadGeometry(){if(this._feature.type===1){const X=[];for(const te of this._feature.geometry)X.push([new n.pointGeometry(te[0],te[1])]);return X}{const X=[];for(const te of this._feature.geometry){const xe=[];for(const Ie of te)xe.push(new n.pointGeometry(Ie[0],Ie[1]));X.push(xe)}return X}}toGeoJSON(X,te,xe){return D.call(this,X,te,xe)}}class j{constructor(X){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.EXTENT,this.length=X.length,this._features=X}feature(X){return new F(this._features[X])}}var K=n.vectorTile.VectorTileFeature,ee=Q;function Q(ve,X){this.options=X||{},this.features=ve,this.length=ve.length}function le(ve,X){this.id=typeof ve.id=="number"?ve.id:void 0,this.type=ve.type,this.rawGeometry=ve.type===1?[ve.geometry]:ve.geometry,this.properties=ve.tags,this.extent=X||4096}Q.prototype.feature=function(ve){return new le(this.features[ve],this.options.extent)},le.prototype.loadGeometry=function(){var ve=this.rawGeometry;this.geometry=[];for(var X=0;X<ve.length;X++){for(var te=ve[X],xe=[],Ie=0;Ie<te.length;Ie++)xe.push(new n.pointGeometry(te[Ie][0],te[Ie][1]));this.geometry.push(xe)}return this.geometry},le.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ve=this.geometry,X=1/0,te=-1/0,xe=1/0,Ie=-1/0,Ue=0;Ue<ve.length;Ue++)for(var Qe=ve[Ue],Ke=0;Ke<Qe.length;Ke++){var Ve=Qe[Ke];X=Math.min(X,Ve.x),te=Math.max(te,Ve.x),xe=Math.min(xe,Ve.y),Ie=Math.max(Ie,Ve.y)}return[X,xe,te,Ie]},le.prototype.toGeoJSON=K.prototype.toGeoJSON;var pe=Ee,de=ee;function Ee(ve){var X=new n.pbf;return function(te,xe){for(var Ie in te.layers)xe.writeMessage(3,Pe,te.layers[Ie])}(ve,X),X.finish()}function Pe(ve,X){var te;X.writeVarintField(15,ve.version||1),X.writeStringField(1,ve.name||""),X.writeVarintField(5,ve.extent||4096);var xe={keys:[],values:[],keycache:{},valuecache:{}};for(te=0;te<ve.length;te++)xe.feature=ve.feature(te),X.writeMessage(2,Je,xe);var Ie=xe.keys;for(te=0;te<Ie.length;te++)X.writeStringField(3,Ie[te]);var Ue=xe.values;for(te=0;te<Ue.length;te++)X.writeMessage(4,Pt,Ue[te])}function Je(ve,X){var te=ve.feature;te.id!==void 0&&X.writeVarintField(1,te.id),X.writeMessage(2,xt,ve),X.writeVarintField(3,te.type),X.writeMessage(4,Rt,te)}function xt(ve,X){var te=ve.feature,xe=ve.keys,Ie=ve.values,Ue=ve.keycache,Qe=ve.valuecache;for(var Ke in te.properties){var Ve=Ue[Ke];Ve===void 0&&(xe.push(Ke),Ue[Ke]=Ve=xe.length-1),X.writeVarint(Ve);var et=te.properties[Ke],gt=typeof et;gt!=="string"&&gt!=="boolean"&&gt!=="number"&&(et=JSON.stringify(et));var jt=gt+":"+et,yt=Qe[jt];yt===void 0&&(Ie.push(et),Qe[jt]=yt=Ie.length-1),X.writeVarint(yt)}}function vt(ve,X){return(X<<3)+(7&ve)}function ct(ve){return ve<<1^ve>>31}function Rt(ve,X){for(var te=ve.loadGeometry(),xe=ve.type,Ie=0,Ue=0,Qe=te.length,Ke=0;Ke<Qe;Ke++){var Ve=te[Ke],et=1;xe===1&&(et=Ve.length),X.writeVarint(vt(1,et));for(var gt=xe===3?Ve.length-1:Ve.length,jt=0;jt<gt;jt++){jt===1&&xe!==1&&X.writeVarint(vt(2,gt-1));var yt=Ve[jt].x-Ie,Xt=Ve[jt].y-Ue;X.writeVarint(ct(yt)),X.writeVarint(ct(Xt)),Ie+=yt,Ue+=Xt}xe===3&&X.writeVarint(vt(7,1))}}function Pt(ve,X){var te=typeof ve;te==="string"?X.writeStringField(1,ve):te==="boolean"?X.writeBooleanField(7,ve):te==="number"&&(ve%1!=0?X.writeDoubleField(3,ve):ve<0?X.writeSVarintField(6,ve):X.writeVarintField(5,ve))}function nn(ve,X,te,xe,Ie,Ue){if(Ie-xe<=te)return;const Qe=xe+Ie>>1;(function Ke(Ve,et,gt,jt,yt,Xt){for(;yt>jt;){if(yt-jt>600){const ft=yt-jt+1,Zn=gt-jt+1,Bn=Math.log(ft),bn=.5*Math.exp(2*Bn/3),jn=.5*Math.sqrt(Bn*bn*(ft-bn)/ft)*(Zn-ft/2<0?-1:1);Ke(Ve,et,gt,Math.max(jt,Math.floor(gt-Zn*bn/ft+jn)),Math.min(yt,Math.floor(gt+(ft-Zn)*bn/ft+jn)),Xt)}const sn=et[2*gt+Xt];let Kt=jt,je=yt;for(mn(Ve,et,jt,gt),et[2*yt+Xt]>sn&&mn(Ve,et,jt,yt);Kt<je;){for(mn(Ve,et,Kt,je),Kt++,je--;et[2*Kt+Xt]<sn;)Kt++;for(;et[2*je+Xt]>sn;)je--}et[2*jt+Xt]===sn?mn(Ve,et,jt,je):(je++,mn(Ve,et,je,yt)),je<=gt&&(jt=je+1),gt<=je&&(yt=je-1)}})(ve,X,Qe,xe,Ie,Ue%2),nn(ve,X,te,xe,Qe-1,Ue+1),nn(ve,X,te,Qe+1,Ie,Ue+1)}function mn(ve,X,te,xe){cn(ve,te,xe),cn(X,2*te,2*xe),cn(X,2*te+1,2*xe+1)}function cn(ve,X,te){const xe=ve[X];ve[X]=ve[te],ve[te]=xe}function ht(ve,X,te,xe){const Ie=ve-te,Ue=X-xe;return Ie*Ie+Ue*Ue}pe.fromVectorTileJs=Ee,pe.fromGeojsonVt=function(ve,X){X=X||{};var te={};for(var xe in ve)te[xe]=new ee(ve[xe].features,X),te[xe].name=xe,te[xe].version=X.version,te[xe].extent=X.extent;return Ee({layers:te})},pe.GeoJSONWrapper=de;const un=ve=>ve[0],rn=ve=>ve[1];class wn{constructor(X,te=un,xe=rn,Ie=64,Ue=Float64Array){this.nodeSize=Ie,this.points=X;const Qe=X.length<65536?Uint16Array:Uint32Array,Ke=this.ids=new Qe(X.length),Ve=this.coords=new Ue(2*X.length);for(let et=0;et<X.length;et++)Ke[et]=et,Ve[2*et]=te(X[et]),Ve[2*et+1]=xe(X[et]);nn(Ke,Ve,Ie,0,Ke.length-1,0)}range(X,te,xe,Ie){return function(Ue,Qe,Ke,Ve,et,gt,jt){const yt=[0,Ue.length-1,0],Xt=[];let sn,Kt;for(;yt.length;){const je=yt.pop(),ft=yt.pop(),Zn=yt.pop();if(ft-Zn<=jt){for(let jn=Zn;jn<=ft;jn++)sn=Qe[2*jn],Kt=Qe[2*jn+1],sn>=Ke&&sn<=et&&Kt>=Ve&&Kt<=gt&&Xt.push(Ue[jn]);continue}const Bn=Math.floor((Zn+ft)/2);sn=Qe[2*Bn],Kt=Qe[2*Bn+1],sn>=Ke&&sn<=et&&Kt>=Ve&&Kt<=gt&&Xt.push(Ue[Bn]);const bn=(je+1)%2;(je===0?Ke<=sn:Ve<=Kt)&&(yt.push(Zn),yt.push(Bn-1),yt.push(bn)),(je===0?et>=sn:gt>=Kt)&&(yt.push(Bn+1),yt.push(ft),yt.push(bn))}return Xt}(this.ids,this.coords,X,te,xe,Ie,this.nodeSize)}within(X,te,xe){return function(Ie,Ue,Qe,Ke,Ve,et){const gt=[0,Ie.length-1,0],jt=[],yt=Ve*Ve;for(;gt.length;){const Xt=gt.pop(),sn=gt.pop(),Kt=gt.pop();if(sn-Kt<=et){for(let bn=Kt;bn<=sn;bn++)ht(Ue[2*bn],Ue[2*bn+1],Qe,Ke)<=yt&&jt.push(Ie[bn]);continue}const je=Math.floor((Kt+sn)/2),ft=Ue[2*je],Zn=Ue[2*je+1];ht(ft,Zn,Qe,Ke)<=yt&&jt.push(Ie[je]);const Bn=(Xt+1)%2;(Xt===0?Qe-Ve<=ft:Ke-Ve<=Zn)&&(gt.push(Kt),gt.push(je-1),gt.push(Bn)),(Xt===0?Qe+Ve>=ft:Ke+Ve>=Zn)&&(gt.push(je+1),gt.push(sn),gt.push(Bn))}return jt}(this.ids,this.coords,X,te,xe,this.nodeSize)}}const An={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ve=>ve},dn=Math.fround||(Lr=new Float32Array(1),ve=>(Lr[0]=+ve,Lr[0]));var Lr;class oi{constructor(X){this.options=Dn(Object.create(An),X),this.trees=new Array(this.options.maxZoom+1)}load(X){const{log:te,minZoom:xe,maxZoom:Ie,nodeSize:Ue}=this.options;te&&console.time("total time");const Qe=`prepare ${X.length} points`;te&&console.time(Qe),this.points=X;let Ke=[];for(let Ve=0;Ve<X.length;Ve++)X[Ve].geometry&&Ke.push(xi(X[Ve],Ve));this.trees[Ie+1]=new wn(Ke,Hi,Oi,Ue,Float32Array),te&&console.timeEnd(Qe);for(let Ve=Ie;Ve>=xe;Ve--)Ke=this._cluster(Ke,Ve),this.trees[Ve]=new wn(Ke,Hi,Oi,Ue,Float32Array);return te&&console.timeEnd("total time"),this}getClusters(X,te){let xe=((X[0]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,X[1]));let Ue=X[2]===180?180:((X[2]+180)%360+360)%360-180;const Qe=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)xe=-180,Ue=180;else if(xe>Ue){const gt=this.getClusters([xe,Ie,180,Qe],te),jt=this.getClusters([-180,Ie,Ue,Qe],te);return gt.concat(jt)}const Ke=this.trees[this._limitZoom(te)],Ve=Ke.range(zi(xe),Dr(Qe),zi(Ue),Dr(Ie)),et=[];for(const gt of Ve){const jt=Ke.points[gt];et.push(jt.numPoints?co(jt):this.points[jt.index])}return et}getChildren(X){const te=this._getOriginId(X),xe=this._getOriginZoom(X),Ie="No cluster with the specified id.",Ue=this.trees[xe];if(!Ue)throw new Error(Ie);const Qe=Ue.points[te];if(!Qe)throw new Error(Ie);const Ke=this.options.radius/(this.options.extent*Math.pow(2,xe-1)),Ve=Ue.within(Qe.x,Qe.y,Ke),et=[];for(const gt of Ve){const jt=Ue.points[gt];jt.parentId===X&&et.push(jt.numPoints?co(jt):this.points[jt.index])}if(et.length===0)throw new Error(Ie);return et}getLeaves(X,te,xe){const Ie=[];return this._appendLeaves(Ie,X,te=te||10,xe=xe||0,0),Ie}getTile(X,te,xe){const Ie=this.trees[this._limitZoom(X)],Ue=Math.pow(2,X),{extent:Qe,radius:Ke}=this.options,Ve=Ke/Qe,et=(xe-Ve)/Ue,gt=(xe+1+Ve)/Ue,jt={features:[]};return this._addTileFeatures(Ie.range((te-Ve)/Ue,et,(te+1+Ve)/Ue,gt),Ie.points,te,xe,Ue,jt),te===0&&this._addTileFeatures(Ie.range(1-Ve/Ue,et,1,gt),Ie.points,Ue,xe,Ue,jt),te===Ue-1&&this._addTileFeatures(Ie.range(0,et,Ve/Ue,gt),Ie.points,-1,xe,Ue,jt),jt.features.length?jt:null}getClusterExpansionZoom(X){let te=this._getOriginZoom(X)-1;for(;te<=this.options.maxZoom;){const xe=this.getChildren(X);if(te++,xe.length!==1)break;X=xe[0].properties.cluster_id}return te}_appendLeaves(X,te,xe,Ie,Ue){const Qe=this.getChildren(te);for(const Ke of Qe){const Ve=Ke.properties;if(Ve&&Ve.cluster?Ue+Ve.point_count<=Ie?Ue+=Ve.point_count:Ue=this._appendLeaves(X,Ve.cluster_id,xe,Ie,Ue):Ue<Ie?Ue++:X.push(Ke),X.length===xe)break}return Ue}_addTileFeatures(X,te,xe,Ie,Ue,Qe){for(const Ke of X){const Ve=te[Ke],et=Ve.numPoints;let gt,jt,yt;if(et)gt=uo(Ve),jt=Ve.x,yt=Ve.y;else{const Kt=this.points[Ve.index];gt=Kt.properties,jt=zi(Kt.geometry.coordinates[0]),yt=Dr(Kt.geometry.coordinates[1])}const Xt={type:1,geometry:[[Math.round(this.options.extent*(jt*Ue-xe)),Math.round(this.options.extent*(yt*Ue-Ie))]],tags:gt};let sn;et?sn=Ve.id:this.options.generateId?sn=Ve.index:this.points[Ve.index].id&&(sn=this.points[Ve.index].id),sn!==void 0&&(Xt.id=sn),Qe.features.push(Xt)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(+X,this.options.maxZoom+1))}_cluster(X,te){const xe=[],{radius:Ie,extent:Ue,reduce:Qe,minPoints:Ke}=this.options,Ve=Ie/(Ue*Math.pow(2,te));for(let et=0;et<X.length;et++){const gt=X[et];if(gt.zoom<=te)continue;gt.zoom=te;const jt=this.trees[te+1],yt=jt.within(gt.x,gt.y,Ve),Xt=gt.numPoints||1;let sn=Xt;for(const Kt of yt){const je=jt.points[Kt];je.zoom>te&&(sn+=je.numPoints||1)}if(sn>=Ke){let Kt=gt.x*Xt,je=gt.y*Xt,ft=Qe&&Xt>1?this._map(gt,!0):null;const Zn=(et<<5)+(te+1)+this.points.length;for(const Bn of yt){const bn=jt.points[Bn];if(bn.zoom<=te)continue;bn.zoom=te;const jn=bn.numPoints||1;Kt+=bn.x*jn,je+=bn.y*jn,bn.parentId=Zn,Qe&&(ft||(ft=this._map(gt,!0)),Qe(ft,this._map(bn)))}gt.parentId=Zn,xe.push(kn(Kt/sn,je/sn,Zn,sn,ft))}else if(xe.push(gt),sn>1)for(const Kt of yt){const je=jt.points[Kt];je.zoom<=te||(je.zoom=te,xe.push(je))}}return xe}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,te){if(X.numPoints)return te?Dn({},X.properties):X.properties;const xe=this.points[X.index].properties,Ie=this.options.map(xe);return te&&Ie===xe?Dn({},Ie):Ie}}function kn(ve,X,te,xe,Ie){return{x:dn(ve),y:dn(X),zoom:1/0,id:te,parentId:-1,numPoints:xe,properties:Ie}}function xi(ve,X){const[te,xe]=ve.geometry.coordinates;return{x:dn(zi(te)),y:dn(Dr(xe)),zoom:1/0,index:X,parentId:-1}}function co(ve){return{type:"Feature",id:ve.id,properties:uo(ve),geometry:{type:"Point",coordinates:[(X=ve.x,360*(X-.5)),Eo(ve.y)]}};var X}function uo(ve){const X=ve.numPoints,te=X>=1e4?Math.round(X/1e3)+"k":X>=1e3?Math.round(X/100)/10+"k":X;return Dn(Dn({},ve.properties),{cluster:!0,cluster_id:ve.id,point_count:X,point_count_abbreviated:te})}function zi(ve){return ve/360+.5}function Dr(ve){const X=Math.sin(ve*Math.PI/180),te=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return te<0?0:te>1?1:te}function Eo(ve){const X=(180-360*ve)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function Dn(ve,X){for(const te in X)ve[te]=X[te];return ve}function Hi(ve){return ve.x}function Oi(ve){return ve.y}function Mr(ve,X,te,xe,Ie,Ue){var Qe=Ie-te,Ke=Ue-xe;if(Qe!==0||Ke!==0){var Ve=((ve-te)*Qe+(X-xe)*Ke)/(Qe*Qe+Ke*Ke);Ve>1?(te=Ie,xe=Ue):Ve>0&&(te+=Qe*Ve,xe+=Ke*Ve)}return(Qe=ve-te)*Qe+(Ke=X-xe)*Ke}function si(ve,X,te,xe){var Ie={id:ve===void 0?null:ve,type:X,geometry:te,tags:xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ue){var Qe=Ue.geometry,Ke=Ue.type;if(Ke==="Point"||Ke==="MultiPoint"||Ke==="LineString")pi(Ue,Qe);else if(Ke==="Polygon"||Ke==="MultiLineString")for(var Ve=0;Ve<Qe.length;Ve++)pi(Ue,Qe[Ve]);else if(Ke==="MultiPolygon")for(Ve=0;Ve<Qe.length;Ve++)for(var et=0;et<Qe[Ve].length;et++)pi(Ue,Qe[Ve][et])}(Ie),Ie}function pi(ve,X){for(var te=0;te<X.length;te+=3)ve.minX=Math.min(ve.minX,X[te]),ve.minY=Math.min(ve.minY,X[te+1]),ve.maxX=Math.max(ve.maxX,X[te]),ve.maxY=Math.max(ve.maxY,X[te+1])}function In(ve,X,te,xe){if(X.geometry){var Ie=X.geometry.coordinates,Ue=X.geometry.type,Qe=Math.pow(te.tolerance/((1<<te.maxZoom)*te.extent),2),Ke=[],Ve=X.id;if(te.promoteId?Ve=X.properties[te.promoteId]:te.generateId&&(Ve=xe||0),Ue==="Point")tr(Ie,Ke);else if(Ue==="MultiPoint")for(var et=0;et<Ie.length;et++)tr(Ie[et],Ke);else if(Ue==="LineString")Fi(Ie,Ke,Qe,!1);else if(Ue==="MultiLineString"){if(te.lineMetrics){for(et=0;et<Ie.length;et++)Fi(Ie[et],Ke=[],Qe,!1),ve.push(si(Ve,"LineString",Ke,X.properties));return}$r(Ie,Ke,Qe,!1)}else if(Ue==="Polygon")$r(Ie,Ke,Qe,!0);else{if(Ue!=="MultiPolygon"){if(Ue==="GeometryCollection"){for(et=0;et<X.geometry.geometries.length;et++)In(ve,{id:Ve,geometry:X.geometry.geometries[et],properties:X.properties},te,xe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(et=0;et<Ie.length;et++){var gt=[];$r(Ie[et],gt,Qe,!0),Ke.push(gt)}}ve.push(si(Ve,Ue,Ke,X.properties))}}function tr(ve,X){X.push(Xi(ve[0])),X.push(Vr(ve[1])),X.push(0)}function Fi(ve,X,te,xe){for(var Ie,Ue,Qe=0,Ke=0;Ke<ve.length;Ke++){var Ve=Xi(ve[Ke][0]),et=Vr(ve[Ke][1]);X.push(Ve),X.push(et),X.push(0),Ke>0&&(Qe+=xe?(Ie*et-Ve*Ue)/2:Math.sqrt(Math.pow(Ve-Ie,2)+Math.pow(et-Ue,2))),Ie=Ve,Ue=et}var gt=X.length-3;X[2]=1,function jt(yt,Xt,sn,Kt){for(var je,ft=Kt,Zn=sn-Xt>>1,Bn=sn-Xt,bn=yt[Xt],jn=yt[Xt+1],Pr=yt[sn],bi=yt[sn+1],zr=Xt+3;zr<sn;zr+=3){var $t=Mr(yt[zr],yt[zr+1],bn,jn,Pr,bi);if($t>ft)je=zr,ft=$t;else if($t===ft){var On=Math.abs(zr-Zn);On<Bn&&(je=zr,Bn=On)}}ft>Kt&&(je-Xt>3&&jt(yt,Xt,je,Kt),yt[je+2]=ft,sn-je>3&&jt(yt,je,sn,Kt))}(X,0,gt,te),X[gt+2]=1,X.size=Math.abs(Qe),X.start=0,X.end=X.size}function $r(ve,X,te,xe){for(var Ie=0;Ie<ve.length;Ie++){var Ue=[];Fi(ve[Ie],Ue,te,xe),X.push(Ue)}}function Xi(ve){return ve/360+.5}function Vr(ve){var X=Math.sin(ve*Math.PI/180),te=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return te<0?0:te>1?1:te}function gr(ve,X,te,xe,Ie,Ue,Qe,Ke){if(xe/=X,Ue>=(te/=X)&&Qe<xe)return ve;if(Qe<te||Ue>=xe)return null;for(var Ve=[],et=0;et<ve.length;et++){var gt=ve[et],jt=gt.geometry,yt=gt.type,Xt=Ie===0?gt.minX:gt.minY,sn=Ie===0?gt.maxX:gt.maxY;if(Xt>=te&&sn<xe)Ve.push(gt);else if(!(sn<te||Xt>=xe)){var Kt=[];if(yt==="Point"||yt==="MultiPoint")ei(jt,Kt,te,xe,Ie);else if(yt==="LineString")ho(jt,Kt,te,xe,Ie,!1,Ke.lineMetrics);else if(yt==="MultiLineString")Ki(jt,Kt,te,xe,Ie,!1);else if(yt==="Polygon")Ki(jt,Kt,te,xe,Ie,!0);else if(yt==="MultiPolygon")for(var je=0;je<jt.length;je++){var ft=[];Ki(jt[je],ft,te,xe,Ie,!0),ft.length&&Kt.push(ft)}if(Kt.length){if(Ke.lineMetrics&&yt==="LineString"){for(je=0;je<Kt.length;je++)Ve.push(si(gt.id,yt,Kt[je],gt.tags));continue}yt!=="LineString"&&yt!=="MultiLineString"||(Kt.length===1?(yt="LineString",Kt=Kt[0]):yt="MultiLineString"),yt!=="Point"&&yt!=="MultiPoint"||(yt=Kt.length===3?"Point":"MultiPoint"),Ve.push(si(gt.id,yt,Kt,gt.tags))}}}return Ve.length?Ve:null}function ei(ve,X,te,xe,Ie){for(var Ue=0;Ue<ve.length;Ue+=3){var Qe=ve[Ue+Ie];Qe>=te&&Qe<=xe&&(X.push(ve[Ue]),X.push(ve[Ue+1]),X.push(ve[Ue+2]))}}function ho(ve,X,te,xe,Ie,Ue,Qe){for(var Ke,Ve,et=Ji(ve),gt=Ie===0?jo:we,jt=ve.start,yt=0;yt<ve.length-3;yt+=3){var Xt=ve[yt],sn=ve[yt+1],Kt=ve[yt+2],je=ve[yt+3],ft=ve[yt+4],Zn=Ie===0?Xt:sn,Bn=Ie===0?je:ft,bn=!1;Qe&&(Ke=Math.sqrt(Math.pow(Xt-je,2)+Math.pow(sn-ft,2))),Zn<te?Bn>te&&(Ve=gt(et,Xt,sn,je,ft,te),Qe&&(et.start=jt+Ke*Ve)):Zn>xe?Bn<xe&&(Ve=gt(et,Xt,sn,je,ft,xe),Qe&&(et.start=jt+Ke*Ve)):Io(et,Xt,sn,Kt),Bn<te&&Zn>=te&&(Ve=gt(et,Xt,sn,je,ft,te),bn=!0),Bn>xe&&Zn<=xe&&(Ve=gt(et,Xt,sn,je,ft,xe),bn=!0),!Ue&&bn&&(Qe&&(et.end=jt+Ke*Ve),X.push(et),et=Ji(ve)),Qe&&(jt+=Ke)}var jn=ve.length-3;Xt=ve[jn],sn=ve[jn+1],Kt=ve[jn+2],(Zn=Ie===0?Xt:sn)>=te&&Zn<=xe&&Io(et,Xt,sn,Kt),jn=et.length-3,Ue&&jn>=3&&(et[jn]!==et[0]||et[jn+1]!==et[1])&&Io(et,et[0],et[1],et[2]),et.length&&X.push(et)}function Ji(ve){var X=[];return X.size=ve.size,X.start=ve.start,X.end=ve.end,X}function Ki(ve,X,te,xe,Ie,Ue){for(var Qe=0;Qe<ve.length;Qe++)ho(ve[Qe],X,te,xe,Ie,Ue,!1)}function Io(ve,X,te,xe){ve.push(X),ve.push(te),ve.push(xe)}function jo(ve,X,te,xe,Ie,Ue){var Qe=(Ue-X)/(xe-X);return ve.push(Ue),ve.push(te+(Ie-te)*Qe),ve.push(1),Qe}function we(ve,X,te,xe,Ie,Ue){var Qe=(Ue-te)/(Ie-te);return ve.push(X+(xe-X)*Qe),ve.push(Ue),ve.push(1),Qe}function Oe(ve,X){for(var te=[],xe=0;xe<ve.length;xe++){var Ie,Ue=ve[xe],Qe=Ue.type;if(Qe==="Point"||Qe==="MultiPoint"||Qe==="LineString")Ie=ke(Ue.geometry,X);else if(Qe==="MultiLineString"||Qe==="Polygon"){Ie=[];for(var Ke=0;Ke<Ue.geometry.length;Ke++)Ie.push(ke(Ue.geometry[Ke],X))}else if(Qe==="MultiPolygon")for(Ie=[],Ke=0;Ke<Ue.geometry.length;Ke++){for(var Ve=[],et=0;et<Ue.geometry[Ke].length;et++)Ve.push(ke(Ue.geometry[Ke][et],X));Ie.push(Ve)}te.push(si(Ue.id,Qe,Ie,Ue.tags))}return te}function ke(ve,X){var te=[];te.size=ve.size,ve.start!==void 0&&(te.start=ve.start,te.end=ve.end);for(var xe=0;xe<ve.length;xe+=3)te.push(ve[xe]+X,ve[xe+1],ve[xe+2]);return te}function dt(ve,X){if(ve.transformed)return ve;var te,xe,Ie,Ue=1<<ve.z,Qe=ve.x,Ke=ve.y;for(te=0;te<ve.features.length;te++){var Ve=ve.features[te],et=Ve.geometry,gt=Ve.type;if(Ve.geometry=[],gt===1)for(xe=0;xe<et.length;xe+=2)Ve.geometry.push(mt(et[xe],et[xe+1],X,Ue,Qe,Ke));else for(xe=0;xe<et.length;xe++){var jt=[];for(Ie=0;Ie<et[xe].length;Ie+=2)jt.push(mt(et[xe][Ie],et[xe][Ie+1],X,Ue,Qe,Ke));Ve.geometry.push(jt)}}return ve.transformed=!0,ve}function mt(ve,X,te,xe,Ie,Ue){return[Math.round(te*(ve*xe-Ie)),Math.round(te*(X*xe-Ue))]}function Dt(ve,X,te,xe,Ie){for(var Ue=X===Ie.maxZoom?0:Ie.tolerance/((1<<X)*Ie.extent),Qe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:te,y:xe,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ke=0;Ke<ve.length;Ke++){Qe.numFeatures++,Bt(Qe,ve[Ke],Ue,Ie);var Ve=ve[Ke].minX,et=ve[Ke].minY,gt=ve[Ke].maxX,jt=ve[Ke].maxY;Ve<Qe.minX&&(Qe.minX=Ve),et<Qe.minY&&(Qe.minY=et),gt>Qe.maxX&&(Qe.maxX=gt),jt>Qe.maxY&&(Qe.maxY=jt)}return Qe}function Bt(ve,X,te,xe){var Ie=X.geometry,Ue=X.type,Qe=[];if(Ue==="Point"||Ue==="MultiPoint")for(var Ke=0;Ke<Ie.length;Ke+=3)Qe.push(Ie[Ke]),Qe.push(Ie[Ke+1]),ve.numPoints++,ve.numSimplified++;else if(Ue==="LineString")Vt(Qe,Ie,ve,te,!1,!1);else if(Ue==="MultiLineString"||Ue==="Polygon")for(Ke=0;Ke<Ie.length;Ke++)Vt(Qe,Ie[Ke],ve,te,Ue==="Polygon",Ke===0);else if(Ue==="MultiPolygon")for(var Ve=0;Ve<Ie.length;Ve++){var et=Ie[Ve];for(Ke=0;Ke<et.length;Ke++)Vt(Qe,et[Ke],ve,te,!0,Ke===0)}if(Qe.length){var gt=X.tags||null;if(Ue==="LineString"&&xe.lineMetrics){for(var jt in gt={},X.tags)gt[jt]=X.tags[jt];gt.vjmaps_clip_start=Ie.start/Ie.size,gt.vjmaps_clip_end=Ie.end/Ie.size}var yt={geometry:Qe,type:Ue==="Polygon"||Ue==="MultiPolygon"?3:Ue==="LineString"||Ue==="MultiLineString"?2:1,tags:gt};X.id!==null&&(yt.id=X.id),ve.features.push(yt)}}function Vt(ve,X,te,xe,Ie,Ue){var Qe=xe*xe;if(xe>0&&X.size<(Ie?Qe:xe))te.numPoints+=X.length/3;else{for(var Ke=[],Ve=0;Ve<X.length;Ve+=3)(xe===0||X[Ve+2]>Qe)&&(te.numSimplified++,Ke.push(X[Ve]),Ke.push(X[Ve+1])),te.numPoints++;Ie&&function(et,gt){for(var jt=0,yt=0,Xt=et.length,sn=Xt-2;yt<Xt;sn=yt,yt+=2)jt+=(et[yt]-et[sn])*(et[yt+1]+et[sn+1]);if(jt>0===gt)for(yt=0,Xt=et.length;yt<Xt/2;yt+=2){var Kt=et[yt],je=et[yt+1];et[yt]=et[Xt-2-yt],et[yt+1]=et[Xt-1-yt],et[Xt-2-yt]=Kt,et[Xt-1-yt]=je}}(Ke,Ue),ve.push(Ke)}}function Ft(ve,X){var te=(X=this.options=function(Ie,Ue){for(var Qe in Ue)Ie[Qe]=Ue[Qe];return Ie}(Object.create(this.options),X)).debug;if(te&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");var xe=function(Ie,Ue){var Qe=[];if(Ie.type==="FeatureCollection")for(var Ke=0;Ke<Ie.features.length;Ke++)In(Qe,Ie.features[Ke],Ue,Ke);else In(Qe,Ie.type==="Feature"?Ie:{geometry:Ie},Ue);return Qe}(ve,X);this.tiles={},this.tileCoords=[],te&&(console.timeEnd("preprocess data"),console.time("generate tiles"),this.stats={},this.total=0),(xe=function(Ie,Ue){var Qe=Ue.buffer/Ue.extent,Ke=Ie,Ve=gr(Ie,1,-1-Qe,Qe,0,-1,2,Ue),et=gr(Ie,1,1-Qe,2+Qe,0,-1,2,Ue);return(Ve||et)&&(Ke=gr(Ie,1,-Qe,1+Qe,0,-1,2,Ue)||[],Ve&&(Ke=Oe(Ve,1).concat(Ke)),et&&(Ke=Ke.concat(Oe(et,-1)))),Ke}(xe,X)).length&&this.splitTile(xe,0,0,0),te&&(xe.length,console.timeEnd("generate tiles"))}function kt(ve,X,te){return 32*((1<<ve)*te+X)+ve}function Qt(ve,X){const te=ve.tileID.canonical;if(!this._geoJSONIndex)return X(null,null);const xe=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!xe)return X(null,null);const Ie=new j(xe.features);let Ue=pe(Ie);Ue.byteOffset===0&&Ue.byteLength===Ue.buffer.byteLength||(Ue=new Uint8Array(Ue)),X(null,{vectorTile:Ie,rawData:Ue.buffer})}Ft.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ft.prototype.splitTile=function(ve,X,te,xe,Ie,Ue,Qe){for(var Ke=[ve,X,te,xe],Ve=this.options,et=Ve.debug;Ke.length;){xe=Ke.pop(),te=Ke.pop(),X=Ke.pop(),ve=Ke.pop();var gt=1<<X,jt=kt(X,te,xe),yt=this.tiles[jt];if(!yt&&(et>1&&console.time("creation"),yt=this.tiles[jt]=Dt(ve,X,te,xe,Ve),this.tileCoords.push({z:X,x:te,y:xe}),et)){et>1&&console.timeEnd("creation");var Xt="z"+X;this.stats[Xt]=(this.stats[Xt]||0)+1,this.total++}if(yt.source=ve,Ie){if(X===Ve.maxZoom||X===Ie)continue;var sn=1<<Ie-X;if(te!==Math.floor(Ue/sn)||xe!==Math.floor(Qe/sn))continue}else if(X===Ve.indexMaxZoom||yt.numPoints<=Ve.indexMaxPoints)continue;if(yt.source=null,ve.length!==0){et>1&&console.time("clipping");var Kt,je,ft,Zn,Bn,bn,jn=.5*Ve.buffer/Ve.extent,Pr=.5-jn,bi=.5+jn,zr=1+jn;Kt=je=ft=Zn=null,Bn=gr(ve,gt,te-jn,te+bi,0,yt.minX,yt.maxX,Ve),bn=gr(ve,gt,te+Pr,te+zr,0,yt.minX,yt.maxX,Ve),ve=null,Bn&&(Kt=gr(Bn,gt,xe-jn,xe+bi,1,yt.minY,yt.maxY,Ve),je=gr(Bn,gt,xe+Pr,xe+zr,1,yt.minY,yt.maxY,Ve),Bn=null),bn&&(ft=gr(bn,gt,xe-jn,xe+bi,1,yt.minY,yt.maxY,Ve),Zn=gr(bn,gt,xe+Pr,xe+zr,1,yt.minY,yt.maxY,Ve),bn=null),et>1&&console.timeEnd("clipping"),Ke.push(Kt||[],X+1,2*te,2*xe),Ke.push(je||[],X+1,2*te,2*xe+1),Ke.push(ft||[],X+1,2*te+1,2*xe),Ke.push(Zn||[],X+1,2*te+1,2*xe+1)}}},Ft.prototype.getTile=function(ve,X,te){var xe=this.options,Ie=xe.extent,Ue=xe.debug;if(ve<0||ve>24)return null;var Qe=1<<ve,Ke=kt(ve,X=(X%Qe+Qe)%Qe,te);if(this.tiles[Ke])return dt(this.tiles[Ke],Ie);for(var Ve,et=ve,gt=X,jt=te;!Ve&&et>0;)et--,gt=Math.floor(gt/2),jt=Math.floor(jt/2),Ve=this.tiles[kt(et,gt,jt)];return Ve&&Ve.source?(Ue>1&&console.time("drilling down"),this.splitTile(Ve.source,et,gt,jt,ve,X,te),Ue>1&&console.timeEnd("drilling down"),this.tiles[Ke]?dt(this.tiles[Ke],Ie):null):null};class Sn extends n.VectorTileWorkerSource{constructor(X,te,xe,Ie,Ue){super(X,te,xe,Ie,Qt),Ue&&(this.loadGeoJSON=Ue)}loadData(X,te){const xe=X&&X.request,Ie=xe&&xe.collectResourceTiming;this.loadGeoJSON(X,(Ue,Qe)=>{if(Ue||!Qe)return te(Ue);if(typeof Qe!="object")return te(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));{P(Qe,!0);try{if(X.filter){const Ve=n.createExpression(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ve.result==="error")throw new Error(Ve.value.map(gt=>`${gt.key}: ${gt.message}`).join(", "));const et=Qe.features.filter(gt=>Ve.value.evaluate({zoom:0},gt));Qe={type:"FeatureCollection",features:et}}this._geoJSONIndex=X.cluster?new oi(function({superclusterOptions:Ve,clusterProperties:et}){if(!et||!Ve)return Ve;const gt={},jt={},yt={accumulated:null,zoom:0},Xt={properties:null},sn=Object.keys(et);for(const Kt of sn){const[je,ft]=et[Kt],Zn=n.createExpression(ft),Bn=n.createExpression(typeof je=="string"?[je,["accumulated"],["get",Kt]]:je);gt[Kt]=Zn.value,jt[Kt]=Bn.value}return Ve.map=Kt=>{Xt.properties=Kt;const je={};for(const ft of sn)je[ft]=gt[ft].evaluate(yt,Xt);return je},Ve.reduce=(Kt,je)=>{Xt.properties=je;for(const ft of sn)yt.accumulated=Kt[ft],Kt[ft]=jt[ft].evaluate(yt,Xt)},Ve}(X)).load(Qe.features):function(Ve,et){return new Ft(Ve,et)}(Qe,X.geojsonVtOptions)}catch(Ve){return te(Ve)}this.loaded={};const Ke={};if(Ie){const Ve=n.getPerformanceMeasurement(xe);Ve&&(Ke.resourceTiming={},Ke.resourceTiming[X.source]=JSON.parse(JSON.stringify(Ve)))}te(null,Ke)}})}reloadTile(X,te){const xe=this.loaded;return xe&&xe[X.uid]?super.reloadTile(X,te):this.loadTile(X,te)}loadGeoJSON(X,te){if(X.request)n.getJSON(X.request,te);else{if(typeof X.data!="string")return te(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));try{return te(null,JSON.parse(X.data))}catch{return te(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(X,te){try{te(null,this._geoJSONIndex.getClusterExpansionZoom(X.clusterId))}catch(xe){te(xe)}}getClusterChildren(X,te){try{te(null,this._geoJSONIndex.getChildren(X.clusterId))}catch(xe){te(xe)}}getClusterLeaves(X,te){try{te(null,this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset))}catch(xe){te(xe)}}}class Mn{constructor(X){this.self=X,this.actor=new n.Actor(X,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded=!1,this.workerSourceTypes={vector:n.VectorTileWorkerSource,geojson:Sn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(te,xe)=>{if(this.workerSourceTypes[te])throw new Error(`Worker source with name "${te}" already registered.`);this.workerSourceTypes[te]=xe},this.self.registerRTLTextPlugin=te=>{if(n.plugin.isParsed())throw new Error("RTL text plugin already registered.");n.plugin.applyArabicShaping=te.applyArabicShaping,n.plugin.processBidirectionalText=te.processBidirectionalText,n.plugin.processStyledBidirectionalText=te.processStyledBidirectionalText}}checkIfReady(X,te,xe){xe()}setReferrer(X,te){this.referrer=te}spriteLoaded(X,te){this.isSpriteLoaded=te;for(const xe in this.workerSources[X]){const Ie=this.workerSources[X][xe];for(const Ue in Ie)Ie[Ue]instanceof n.VectorTileWorkerSource&&(Ie[Ue].isSpriteLoaded=te,Ie[Ue].fire(new n.Event("isSpriteLoaded")))}}setImages(X,te,xe){this.availableImages[X]=te;for(const Ie in this.workerSources[X]){const Ue=this.workerSources[X][Ie];for(const Qe in Ue)Ue[Qe].availableImages=te}xe()}enableTerrain(X,te,xe){this.terrain=te,xe()}setLayers(X,te,xe){this.getLayerIndex(X).replace(te),xe()}updateLayers(X,te,xe){this.getLayerIndex(X).update(te.layers,te.removedIds),xe()}loadTile(X,te,xe){const Ie=this.enableTerrain?n.extend({enableTerrain:this.terrain},te):te;this.getWorkerSource(X,te.type,te.source).loadTile(Ie,xe)}loadDEMTile(X,te,xe){const Ie=this.enableTerrain?n.extend({buildQuadTree:this.terrain},te):te;this.getDEMWorkerSource(X,te.source).loadTile(Ie,xe)}reloadTile(X,te,xe){const Ie=this.enableTerrain?n.extend({enableTerrain:this.terrain},te):te;this.getWorkerSource(X,te.type,te.source).reloadTile(Ie,xe)}abortTile(X,te,xe){this.getWorkerSource(X,te.type,te.source).abortTile(te,xe)}removeTile(X,te,xe){this.getWorkerSource(X,te.type,te.source).removeTile(te,xe)}removeSource(X,te,xe){if(!this.workerSources[X]||!this.workerSources[X][te.type]||!this.workerSources[X][te.type][te.source])return;const Ie=this.workerSources[X][te.type][te.source];delete this.workerSources[X][te.type][te.source],Ie.removeSource!==void 0?Ie.removeSource(te,xe):xe()}loadWorkerSource(X,te,xe){try{this.self.importScripts(te.url),xe()}catch(Ie){xe(Ie.toString())}}syncRTLPluginState(X,te,xe){try{n.plugin.setState(te);const Ie=n.plugin.getPluginURL();if(n.plugin.isLoaded()&&!n.plugin.isParsed()&&Ie!=null){this.self.importScripts(Ie);const Ue=n.plugin.isParsed();xe(Ue?void 0:new Error("RTL Text Plugin failed to import scripts from "+Ie),Ue)}}catch(Ie){xe(Ie.toString())}}getAvailableImages(X){let te=this.availableImages[X];return te||(te=[]),te}getLayerIndex(X){let te=this.layerIndexes[X];return te||(te=this.layerIndexes[X]=new _),te}getWorkerSource(X,te,xe){return this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][te]||(this.workerSources[X][te]={}),this.workerSources[X][te][xe]||(this.workerSources[X][te][xe]=new this.workerSourceTypes[te]({send:(Ie,Ue,Qe,Ke,Ve,et)=>{this.actor.send(Ie,Ue,Qe,X,Ve,et)},scheduler:this.actor.scheduler},this.getLayerIndex(X),this.getAvailableImages(X),this.isSpriteLoaded)),this.workerSources[X][te][xe]}getDEMWorkerSource(X,te){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][te]||(this.demWorkerSources[X][te]=new M),this.demWorkerSources[X][te]}enforceCacheSizeLimit(X,te){n.enforceCacheSizeLimit(te)}getWorkerPerformanceMetrics(X,te,xe){xe(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Mn(self)),Mn}),l(0,function(n){var u=v;function v(d){return!function(t){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,x,S=new Blob([""],{type:"text/javascript"}),z=URL.createObjectURL(S);try{x=new Worker(z),p=!0}catch{p=!1}return x&&x.terminate(),URL.revokeObjectURL(z),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var x=p.getContext("2d");if(!x)return!1;var S=x.getImageData(0,0,1,1);return S&&S.width===p.width}()?(_[s=t&&t.failIfMajorPerformanceCaveat]===void 0&&(_[s]=function(p){var x,S=function(z){var B=document.createElement("canvas"),V=Object.create(v.webGLContextAttributes);return V.failIfMajorPerformanceCaveat=z,B.getContext("webgl",V)||B.getContext("experimental-webgl",V)}(p);if(!S)return!1;try{x=S.createShader(S.VERTEX_SHADER)}catch{return!1}return!(!x||S.isContextLost())&&(S.shaderSource(x,"void main() {}"),S.compileShader(x),S.getShaderParameter(x,S.COMPILE_STATUS)===!0)}(s)),_[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(d)}var _={};function b(d,t){if(Array.isArray(d)){if(!Array.isArray(t)||d.length!==t.length)return!1;for(let s=0;s<d.length;s++)if(!b(d[s],t[s]))return!1;return!0}if(typeof d=="object"&&d!==null&&t!==null){if(typeof t!="object"||Object.keys(d).length!==Object.keys(t).length)return!1;for(const s in d)if(!b(d[s],t[s]))return!1;return!0}return d===t}v.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const M={create:function(d,t,s){const p=n.window.document.createElement(d);return t!==void 0&&(p.className=t),s&&s.appendChild(p),p},createNS:function(d,t){return n.window.document.createElementNS(d,t)}},P=n.window.document&&n.window.document.documentElement.style,C=P&&P.userSelect!==void 0?"userSelect":"WebkitUserSelect";let L;M.disableDrag=function(){P&&C&&(L=P[C],P[C]="none")},M.enableDrag=function(){P&&C&&(P[C]=L)},M.setTransform=function(d,t){d.style.transform=t};let D=!1;try{const d=Object.defineProperty({},"passive",{get(){D=!0}});n.window.addEventListener("test",d,d),n.window.removeEventListener("test",d,d)}catch{D=!1}M.addEventListener=function(d,t,s,p={}){d.addEventListener(t,s,"passive"in p&&D?p:p.capture)},M.removeEventListener=function(d,t,s,p={}){d.removeEventListener(t,s,"passive"in p&&D?p:p.capture)};const F=function(d){d.preventDefault(),d.stopPropagation(),n.window.removeEventListener("click",F,!0)};function j(d,t,s){const p=d.offsetWidth===t.width?1:d.offsetWidth/t.width;return new n.pointGeometry((s.clientX-t.left)*p,(s.clientY-t.top)*p)}M.suppressClick=function(){n.window.addEventListener("click",F,!0),n.window.setTimeout(()=>{n.window.removeEventListener("click",F,!0)},0)},M.mousePos=function(d,t){const s=d.getBoundingClientRect();return j(d,s,t)},M.touchPos=function(d,t){const s=d.getBoundingClientRect(),p=[];for(let x=0;x<t.length;x++)p.push(j(d,s,t[x]));return p},M.mouseButton=function(d){return n.window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&n.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button},M.remove=function(d){d.parentNode&&d.parentNode.removeChild(d)};class K{constructor(t,s){this.pos=t,this.dir=s}intersectsPlane(t,s,p){const x=n.dot(s,this.dir);if(Math.abs(x)<1e-6)return!1;const S=n.dot(n.sub(n.create(),t,this.pos),s)/x,z=n.scaleAndAdd(n.create(),this.pos,this.dir,S);return n.copy(p,z),!0}}class ee{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,p){const x=Math.pow(2,p),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(B=>{const V=n.transformMat4([],B,t),$=1/V[3]/s*x;return n.mul(V,V,[$,$,1/V[3],$])}),z=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(B=>{const V=n.sub([],S[B[0]],S[B[1]]),$=n.sub([],S[B[2]],S[B[1]]),H=n.normalize([],n.cross([],V,$)),re=-n.dot(H,S[B[1]]);return H.concat(re)});return new ee(S,z)}}class Q{constructor(t,s){this.min=t,this.max=s,this.center=n.scale([],n.add([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],p=n.clone(this.min),x=n.clone(this.max);for(let S=0;S<s.length;S++)p[S]=s[S]?this.min[S]:this.center[S],x[S]=s[S]?this.center[S]:this.max[S];return x[2]=this.max[2],new Q(p,x)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}intersects(t){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let x=0;x<t.planes.length;x++){const S=t.planes[x];let z=0;for(let B=0;B<s.length;B++)z+=n.dot$1(S,s[B])>=0;if(z===0)return 0;z!==s.length&&(p=!1)}if(p)return 2;for(let x=0;x<3;x++){let S=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(let B=0;B<t.points.length;B++){const V=t.points[B][x]-this.min[x];S=Math.min(S,V),z=Math.max(z,V)}if(z<0||S>this.max[x]-this.min[x])return 0}return 1}}function le(d){const{userImage:t}=d;return!!(t&&t.render&&t.render())&&(d.data.replace(new Uint8Array(t.data.buffer)),!0)}class pe extends n.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new n.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,callback:p}of this.requestors)this._notify(s,p);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,s){this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let p=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new n.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),p=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new n.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),p=!1),this._validateContent(s.content,s)||(this.fire(new n.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),p=!1),p}_validateStretch(t,s){if(!t)return!0;let p=0;for(const x of t){if(x[0]<p||x[1]<x[0]||s<x[1])return!1;p=x[1]}return!0}_validateContent(t,s){return!(t&&(t.length!==4||t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,s){s.version=this.images[t].version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,s){let p=!0;if(!this.isLoaded())for(const x of t)this.images[x]||(p=!1);this.isLoaded()||p?this._notify(t,s):this.requestors.push({ids:t,callback:s})}_notify(t,s){const p={};for(const x of t){this.images[x]||this.fire(new n.Event("styleimagemissing",{id:x}));const S=this.images[x];S?p[x]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:Boolean(S.userImage&&S.userImage.render)}:n.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,p)}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],p=this.getImage(t);if(!p)return null;if(s&&s.position.version===p.version)return s.position;if(s)s.position.version=p.version;else{const x={w:p.data.width+2,h:p.data.height+2,x:0,y:0},S=new n.ImagePosition(x,p);this.patterns[t]={bin:x,position:S}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new n.Texture(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const S in this.patterns)t.push(this.patterns[S].bin);const{w:s,h:p}=n.potpack(t),x=this.atlasImage;x.resize({width:s||1,height:p||1});for(const S in this.patterns){const{bin:z}=this.patterns[S],B=z.x+1,V=z.y+1,$=this.images[S].data,H=$.width,re=$.height;n.RGBAImage.copy($,x,{x:0,y:0},{x:B,y:V},{width:H,height:re}),n.RGBAImage.copy($,x,{x:0,y:re-1},{x:B,y:V-1},{width:H,height:1}),n.RGBAImage.copy($,x,{x:0,y:0},{x:B,y:V+re},{width:H,height:1}),n.RGBAImage.copy($,x,{x:H-1,y:0},{x:B-1,y:V},{width:1,height:re}),n.RGBAImage.copy($,x,{x:0,y:0},{x:B+H,y:V},{width:1,height:re})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const p=this.images[s];le(p)&&this.updateImage(s,p)}}}const de=new n.Properties({anchor:new n.DataConstantProperty(n.spec.light.anchor),position:new class{constructor(){this.specification=n.spec.light.position}possiblyEvaluate(d,t){return function([s,p,x]){const S=n.degToRad(p+90),z=n.degToRad(x);return{x:s*Math.cos(S)*Math.sin(z),y:s*Math.sin(S)*Math.sin(z),z:s*Math.cos(z),azimuthal:p,polar:x}}(d.expression.evaluate(t))}interpolate(d,t,s){return{x:n.number(d.x,t.x,s),y:n.number(d.y,t.y,s),z:n.number(d.z,t.z,s),azimuthal:n.number(d.azimuthal,t.azimuthal,s),polar:n.number(d.polar,t.polar,s)}}},color:new n.DataConstantProperty(n.spec.light.color),intensity:new n.DataConstantProperty(n.spec.light.intensity)}),Ee="-transition";class Pe extends n.Evented{constructor(t){super(),this._transitionable=new n.Transitionable(de),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(n.validateLight,t,s))for(const p in t){const x=t[p];n.endsWith(p,Ee)?this._transitionable.setTransition(p.slice(0,-Ee.length),x):this._transitionable.setValue(p,x)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,p){return(!p||p.validate!==!1)&&n.emitValidationErrors(this,t.call(n.validateStyle,n.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:n.spec})))}}const Je=new n.Properties({source:new n.DataConstantProperty(n.spec.terrain.source),exaggeration:new n.DataConstantProperty(n.spec.terrain.exaggeration)}),xt="-transition";class vt extends n.Evented{constructor(t){super(),this._transitionable=new n.Transitionable(Je),this.set(t),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(t){for(const s in t){const p=t[s];n.endsWith(s,xt)?this._transitionable.setTransition(s.slice(0,-xt.length),p):this._transitionable.setValue(s,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function ct(d,t,s,p){const x=n.smoothstep(45,65,s),[S,z]=Rt(d,p),B=n.length(t);let V=1-Math.min(1,Math.exp((B-S)/(z-S)*-6));return V*=V*V,V=Math.min(1,1.00747*V),V*x*d.alpha}function Rt(d,t){const s=.5/Math.tan(.5*t);return[d.range[0]+s,d.range[1]+s]}const Pt=new n.Properties({range:new n.DataConstantProperty(n.spec.fog.range),color:new n.DataConstantProperty(n.spec.fog.color),"horizon-blend":new n.DataConstantProperty(n.spec.fog["horizon-blend"])}),nn="-transition";class mn extends n.Evented{constructor(t){super(),this._transitionable=new n.Transitionable(Pt),this.set(t),this._transitioning=this._transitionable.untransitioned()}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t){if(!this._validate(n.validateFog,t))for(const s in t){const p=t[s];n.endsWith(s,nn)?this._transitionable.setTransition(s.slice(0,-nn.length),p):this._transitionable.setValue(s,p)}}getOpacity(t){const s=this.properties&&this.properties.get("color")||1;return n.smoothstep(45,65,t)*s.a}getOpacityAtLatLng(t,s){return function(p,x,S){const z=n.MercatorCoordinate.fromLngLat(x),B=S.elevation?S.elevation.getAtPointOrZero(z):0,V=[z.x,z.y,B];return n.transformMat4$1(V,V,S.mercatorFogMatrix),ct(p,V,S.pitch,S._fov)}(this.state,t,s)}getFovAdjustedRange(t){return Rt(this.state,t)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,p){return(!p||p.validate!==!1)&&n.emitValidationErrors(this,t.call(n.validateStyle,n.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:n.spec})))}}class cn{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=n.uniqueId();const p=this.workerPool.acquire(this.id);for(let x=0;x<p.length;x++){const S=new cn.Actor(p[x],s,this.id);S.name="Worker "+x,this.actors.push(S)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,s,p){n.asyncAll(this.actors,(x,S)=>{x.send(t,s,S)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function ht(d,t,s){return t*(n.EXTENT/(d.tileSize*Math.pow(2,s-d.tileID.overscaledZ)))}cn.Actor=n.Actor;class un{constructor(t,s,p,x){this.screenBounds=t,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(S=>x.pointCoordinate3D(S)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(t,s){let p,x;if(t instanceof n.pointGeometry||typeof t[0]=="number"){const S=n.pointGeometry.convert(t);p=[n.pointGeometry.convert(t)],x=s.isPointAboveHorizon(S)}else{const S=n.pointGeometry.convert(t[0]),z=n.pointGeometry.convert(t[1]);p=[S,z],x=n.polygonizeBounds(S,z).every(B=>s.isPointAboveHorizon(B))}return new un(p,s.getCameraPoint(),x,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return n.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const s=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new n.pointGeometry(1,1)):this.screenBounds[1],x=n.polygonizeBounds(s,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<p.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?x[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(x[3]=this.cameraPoint)),n.bufferConvexPolygon(x,t)}containsTile(t,s,p){const x=t.queryPadding+1,S=p?this._bufferedCameraMercator(x,s).map(me=>t.tileID.getTilePoint(me)):this._bufferedScreenMercator(x,s).map(me=>t.tileID.getTilePoint(me)),z=this.screenGeometryMercator.map(me=>t.tileID.getTileVec3(me)),B=z.map(me=>new n.pointGeometry(me[0],me[1])),V=s.getFreeCameraOptions().position||new n.MercatorCoordinate(0,0,0),$=t.tileID.getTileVec3(V),H=z.map(me=>{const ae=n.sub(me,me,$);return n.normalize(ae,ae),new K($,ae)}),re=ht(t,1,s.zoom);if(n.polygonIntersectsBox(S,0,0,n.EXTENT,n.EXTENT))return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:H,bufferedTilespaceGeometry:S,bufferedTilespaceBounds:(se=n.getBounds(S),se.min.x=n.clamp(se.min.x,0,n.EXTENT),se.min.y=n.clamp(se.min.y,0,n.EXTENT),se.max.x=n.clamp(se.max.x,0,n.EXTENT),se.max.y=n.clamp(se.max.y,0,n.EXTENT),se),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:re};var se}_bufferedScreenMercator(t,s){const p=rn(t);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{const x=this.bufferedScreenGeometry(t).map(S=>s.pointCoordinate3D(S));return this._screenRaycastCache[p]=x,x}}_bufferedCameraMercator(t,s){const p=rn(t);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{const x=this.bufferedCameraGeometry(t).map(S=>s.pointCoordinate3D(S));return this._cameraRaycastCache[p]=x,x}}}function rn(d){return 100*d|0}function wn(d,t,s){const p=function(x,S){if(x)return s(x);if(S){const z=n.pick(n.extend(S,d),["tiles","minzoom","maxzoom","attribution","vjmaps_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(z.vectorLayers=S.vector_layers,z.vectorLayerIds=z.vectorLayers.map(B=>B.id)),z.tiles=t.canonicalizeTileset(z,d.url),s(null,z)}};return d.url?n.getJSON(t.transformRequest(t.normalizeSourceURL(d.url),n.ResourceType.Source),p):n.exported.frame(()=>p(null,d))}class An{constructor(t,s,p){this.bounds=n.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=p||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),p=Math.floor(n.mercatorXfromLng(this.bounds.getWest())*s),x=Math.floor(n.mercatorYfromLat(this.bounds.getNorth())*s),S=Math.ceil(n.mercatorXfromLng(this.bounds.getEast())*s),z=Math.ceil(n.mercatorYfromLat(this.bounds.getSouth())*s);return t.x>=p&&t.x<S&&t.y>=x&&t.y<z}}class dn{constructor(t,s,p){this.context=t;const x=t.gl;this.buffer=x.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Lr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class oi{constructor(t,s,p,x){this.length=s.length,this.attributes=p,this.itemSize=s.bytesPerElement,this.dynamicDraw=x,this.context=t;const S=t.gl;this.buffer=S.createBuffer(),t.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let p=0;p<this.attributes.length;p++){const x=s.attributes[this.attributes[p].name];x!==void 0&&t.enableVertexAttribArray(x)}}setVertexAttribPointers(t,s,p){for(let x=0;x<this.attributes.length;x++){const S=this.attributes[x],z=s.attributes[S.name];z!==void 0&&t.vertexAttribPointer(z,S.components,t[Lr[S.type]],!1,this.itemSize,S.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class kn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class xi extends kn{getDefault(){return n.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class co extends kn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class uo extends kn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class zi extends kn{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Dr extends kn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Eo extends kn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Dn extends kn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Hi extends kn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Oi extends kn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class Mr extends kn{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class si extends kn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class pi extends kn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class In extends kn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class tr extends kn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Fi extends kn{getDefault(){return n.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class $r extends kn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Xi extends kn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class Vr extends kn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class gr extends kn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class ei extends kn{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class ho extends kn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Ji extends kn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ki extends kn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Io extends kn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class jo extends kn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class we extends kn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Oe extends kn{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ke extends kn{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class dt extends kn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class mt extends kn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Dt extends kn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Bt extends kn{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class Vt extends Bt{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ft extends Bt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class kt extends Ft{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Qt{constructor(t,s,p,x){this.context=t,this.width=s,this.height=p;const S=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new Vt(t,S),x&&(this.depthAttachment=new Ft(t,S))}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const p=this.depthAttachment.get();p&&t.deleteRenderbuffer(p)}t.deleteFramebuffer(this.framebuffer)}}class Sn{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new xi(this),this.clearDepth=new co(this),this.clearStencil=new uo(this),this.colorMask=new zi(this),this.depthMask=new Dr(this),this.stencilMask=new Eo(this),this.stencilFunc=new Dn(this),this.stencilOp=new Hi(this),this.stencilTest=new Oi(this),this.depthRange=new Mr(this),this.depthTest=new si(this),this.depthFunc=new pi(this),this.blend=new In(this),this.blendFunc=new tr(this),this.blendColor=new Fi(this),this.blendEquation=new $r(this),this.cullFace=new Xi(this),this.cullFaceSide=new Vr(this),this.frontFace=new gr(this),this.program=new ei(this),this.activeTexture=new ho(this),this.viewport=new Ji(this),this.bindFramebuffer=new Ki(this),this.bindRenderbuffer=new Io(this),this.bindTexture=new jo(this),this.bindVertexBuffer=new we(this),this.bindElementBuffer=new Oe(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ke(this),this.pixelStoreUnpack=new dt(this),this.pixelStoreUnpackPremultiplyAlpha=new mt(this),this.pixelStoreUnpackFlipY=new Dt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new dn(this,t,s)}createVertexBuffer(t,s,p){return new oi(this,t,s,p)}createRenderbuffer(t,s,p){const x=this.gl,S=x.createRenderbuffer();return this.bindRenderbuffer.set(S),x.renderbufferStorage(x.RENDERBUFFER,t,s,p),this.bindRenderbuffer.set(null),S}createFramebuffer(t,s,p){return new Qt(this,t,s,p)}clear({color:t,depth:s,stencil:p}){const x=this.gl;let S=0;t&&(S|=x.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(S|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),p!==void 0&&(S|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),x.clear(S)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){b(t.blendFunction,n.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Mn extends n.Evented{constructor(t,s,p,x){super(),this.id=t,this.dispatcher=p,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.extend({type:"raster"},s),n.extend(this,n.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=wn(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new n.ErrorEvent(t)):s&&(n.extend(this,s),s.bounds&&(this.tileBounds=new An(s.bounds,this.minzoom,this.maxzoom)),n.postTurnstileEvent(s.tiles),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return n.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const p=n.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);t.request=n.getImage(this.map._requestManager.transformRequest(x,n.ResourceType.Tile),(S,z,B,V)=>{if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(S)t.state="errored",s(S);else if(z){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:B,expires:V});const $=this.map.painter.context,H=$.gl;t.texture=this.map.painter.getTileTexture(z.width),t.texture?t.texture.update(z,{useMipmap:!0}):(t.texture=new n.Texture($,z,H.RGBA,{useMipmap:!0}),t.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),$.extTextureFilterAnisotropic&&H.texParameterf(H.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax)),t.state="loaded",n.cacheEntryPossiblyAdded(this.dispatcher),s(null)}})}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s()}unloadTile(t,s){t.texture&&this.map.painter.saveTileTexture(t.texture),s()}hasTransition(){return!1}}let ve;var X=n.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class te extends n.Evented{constructor(t,s,p,x){super(),this.id=t,this.dispatcher=p,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=s}load(t,s){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this.url=this.options.url,n.getImage(this.map._requestManager.transformRequest(this.url,n.ResourceType.Image),(p,x)=>{this._loaded=!0,p?this.fire(new n.ErrorEvent(p)):x&&(this.image=x,t&&(this.coordinates=t),s&&s(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t;const s=t.map(n.MercatorCoordinate.fromLngLat);this.tileID=function(x){let S=1/0,z=1/0,B=-1/0,V=-1/0;for(const se of x)S=Math.min(S,se.x),z=Math.min(z,se.y),B=Math.max(B,se.x),V=Math.max(V,se.y);const $=Math.max(B-S,V-z),H=Math.max(0,Math.floor(-Math.log($)/Math.LN2)),re=Math.pow(2,H);return new n.CanonicalTileID(H,Math.floor((S+B)/2*re),Math.floor((z+V)/2*re))}(s),this.minzoom=this.maxzoom=this.tileID.z;const p=s.map(x=>this.tileID.getTilePoint(x)._round());return this._boundsArray=new n.StructArrayLayout4i8,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,n.EXTENT,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,n.EXTENT),this._boundsArray.emplaceBack(p[2].x,p[2].y,n.EXTENT,n.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,X.members)),this.boundsSegments||(this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new n.Texture(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const p in this.tiles){const x=this.tiles[p];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture)}}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const xe={vector:class extends n.Evented{constructor(d,t,s,p){if(super(),this.id=d,this.dispatcher=s,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.extend(this,n.pick(t,["url","scheme","tileSize","promoteId"])),this._options=n.extend({type:"vector"},t),this._collectResourceTiming=t.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new n.DedupedRequest}load(){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=wn(this._options,this.map._requestManager,(d,t)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new n.ErrorEvent(d)):t&&(n.extend(this,t),t.bounds&&(this.tileBounds=new An(t.bounds,this.minzoom,this.maxzoom)),n.postTurnstileEvent(t.tiles,this.map._requestManager._customAccessToken),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}onAdd(d){this.map=d,this.load()}setSourceProperty(d){this._tileJSONRequest&&this._tileJSONRequest.cancel(),d();const t=this.map.style._getSourceCaches(this.id);for(const s of t)s.clearTiles();this.load()}setTiles(d){return this.setSourceProperty(()=>{this._options.tiles=d}),this}setUrl(d){return this.setSourceProperty(()=>{this.url=d,this._options.url=d}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return n.extend({},this._options)}loadTile(d,t){const s=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(s,n.ResourceType.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:n.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:d.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,d.actor&&d.state!=="expired")d.state==="loading"?d.reloadCallback=t:d.request=d.actor.send("reloadTile",p,x.bind(this));else if(d.actor=this._tileWorkers[s]=this._tileWorkers[s]||this.dispatcher.getActor(),this.dispatcher.ready)d.request=d.actor.send("loadTile",p,x.bind(this),void 0,!0);else{const S=n.loadVectorTile.call({deduped:this._deduped},p,(z,B)=>{z||!B?x.call(this,z):(p.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},d.actor&&d.actor.send("loadTile",p,x.bind(this),void 0,!0))},!0);d.request={cancel:S}}function x(S,z){return delete d.request,d.aborted?t(null):S&&S.status!==404?t(S):(z&&z.resourceTiming&&(d.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&d.setExpiryData(z),d.loadVectorData(z,this.map.painter),n.cacheEntryPossiblyAdded(this.dispatcher),t(null),void(d.reloadCallback&&(this.loadTile(d,d.reloadCallback),d.reloadCallback=null)))}}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id})}unloadTile(d){d.unloadVectorData(),d.actor&&d.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Mn,"raster-dem":class extends Mn{constructor(d,t,s,p){super(d,t,s,p),this.type="raster-dem",this.maxzoom=22,this._options=n.extend({type:"raster-dem"},t),this.encoding=t.encoding||"vjmaps"}loadTile(d,t){const s=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(x,S){x&&(d.state="errored",t(x)),S&&(d.dem=S,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",t(null))}d.request=n.getImage(this.map._requestManager.transformRequest(s,n.ResourceType.Tile),function(x,S,z,B){if(delete d.request,d.aborted)d.state="unloaded",t(null);else if(x)d.state="errored",t(x);else if(S){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:z,expires:B});const V=n.window.ImageBitmap&&S instanceof n.window.ImageBitmap&&(ve==null&&(ve=n.window.OffscreenCanvas&&new n.window.OffscreenCanvas(1,1).getContext("2d")&&typeof n.window.createImageBitmap=="function"),ve),$=1-(S.width-n.prevPowerOfTwo(S.width))/2;$<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const H=V?S:n.exported.getImageData(S,$),re={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:H,encoding:this.encoding,padding:$};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",re,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(d){const t=d.canonical,s=Math.pow(2,t.z),p=(t.x-1+s)%s,x=t.x===0?d.wrap-1:d.wrap,S=(t.x+1+s)%s,z=t.x+1===s?d.wrap+1:d.wrap,B={};return B[new n.OverscaledTileID(d.overscaledZ,x,t.z,p,t.y).key]={backfilled:!1},B[new n.OverscaledTileID(d.overscaledZ,z,t.z,S,t.y).key]={backfilled:!1},t.y>0&&(B[new n.OverscaledTileID(d.overscaledZ,x,t.z,p,t.y-1).key]={backfilled:!1},B[new n.OverscaledTileID(d.overscaledZ,d.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},B[new n.OverscaledTileID(d.overscaledZ,z,t.z,S,t.y-1).key]={backfilled:!1}),t.y+1<s&&(B[new n.OverscaledTileID(d.overscaledZ,x,t.z,p,t.y+1).key]={backfilled:!1},B[new n.OverscaledTileID(d.overscaledZ,d.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},B[new n.OverscaledTileID(d.overscaledZ,z,t.z,S,t.y+1).key]={backfilled:!1}),B}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends n.Evented{constructor(d,t,s,p){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(p),this._data=t.data,this._options=n.extend({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const x=n.EXTENT/this.tileSize;this.workerOptions=n.extend({source:this.id,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*x,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*x,extent:n.EXTENT,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:n.EXTENT,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*x,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},t),this}getClusterChildren(d,t){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},t),this}getClusterLeaves(d,t,s,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:t,offset:s},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.Event("dataloading",{dataType:"source"})),this._loaded=!1;const d=n.extend({},this.workerOptions),t=this._data;typeof t=="string"?(d.request=this.map._requestManager.transformRequest(n.exported.resolveURL(t),n.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(t),this._pendingLoad=this.actor.send(this.type+".loadData",d,(s,p)=>{if(this._loaded=!0,this._pendingLoad=null,s)this.fire(new n.ErrorEvent(s));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(x.resourceTiming=p.resourceTiming[this.id]),this.fire(new n.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,t){const s=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(s,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:n.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,x)=>(delete d.request,d.unloadVectorData(),d.aborted?t(null):p?t(p):(d.loadVectorData(x,this.map.painter,s==="reloadTile"),t(null))),void 0,s==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return n.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends te{constructor(d,t,s,p){super(d,t,s,p),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const t of d.urls)this.urls.push(this.map._requestManager.transformRequest(t,n.ResourceType.Source).url);n.getVideo(this.urls,(t,s)=>{this._loaded=!0,t?this.fire(new n.ErrorEvent(t)):s&&(this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const t=this.video.seekable;d<t.start(0)||d>t.end(0)?this.fire(new n.ErrorEvent(new n.ValidationError("sources."+this.id,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,t=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,X.members)),this.boundsSegments||(this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new n.Texture(d,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE));for(const s in this.tiles){const p=this.tiles[s];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:te,canvas:class extends te{constructor(d,t,s,p){super(d,t,s,p),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(S=>typeof S!="number"))||this.fire(new n.ErrorEvent(new n.ValidationError("sources."+d,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.ErrorEvent(new n.ValidationError("sources."+d,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new n.ErrorEvent(new n.ValidationError("sources."+d,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof n.window.HTMLCanvasElement||this.fire(new n.ErrorEvent(new n.ValidationError("sources."+d,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.ErrorEvent(new n.ValidationError("sources."+d,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof n.window.HTMLCanvasElement?this.options.canvas:n.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,X.members)),this.boundsSegments||(this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.Texture(t,this.canvas,s.RGBA,{premultiply:!0});for(const p in this.tiles){const x=this.tiles[p];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}}},Ie=function(d,t,s,p){const x=new xe[t.type](d,t,s,p);if(x.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${x.id}`);return n.bindAll(["load","abort","unload","serialize","prepare"],x),x};function Ue(d,t){const s=n.identity([]);return n.scale$1(s,s,[.5*d.width,.5*-d.height,1]),n.translate(s,s,[1,-1,0]),n.multiply(s,s,d.calculateProjMatrix(t.toUnwrapped()))}function Qe(d,t,s,p,x,S,z,B=!1){const V=d.tilesIn(p,z,B);V.sort(Ve);const $=[];for(const re of V)$.push({wrappedTileID:re.tile.tileID.wrapped().key,queryResults:re.tile.queryRenderedFeatures(t,s,d._state,re,x,S,Ue(d.transform,re.tile.tileID),B)});const H=function(re){const se={},me={};for(const ae of re){const ue=ae.queryResults,Le=ae.wrappedTileID,ye=me[Le]=me[Le]||{};for(const Me in ue){const Ae=ue[Me],Ne=ye[Me]=ye[Me]||{},He=se[Me]=se[Me]||[];for(const We of Ae)Ne[We.featureIndex]||(Ne[We.featureIndex]=!0,He.push(We))}}return se}($);for(const re in H)H[re].forEach(se=>{const me=se.feature,ae=d.getFeatureState(me.layer["source-layer"],me.id);me.source=me.layer.source,me.layer["source-layer"]&&(me.sourceLayer=me.layer["source-layer"]),me.state=ae});return H}function Ke(d,t){const s=d.getRenderableIds().map(S=>d.getTileByID(S)),p=[],x={};for(let S=0;S<s.length;S++){const z=s[S],B=z.tileID.canonical.key;x[B]||(x[B]=!0,z.querySourceFeatures(p,t))}return p}function Ve(d,t){const s=d.tileID,p=t.tileID;return s.overscaledZ-p.overscaledZ||s.canonical.y-p.canonical.y||s.wrap-p.wrap||s.canonical.x-p.canonical.x}function et(){return vn.workerClass!=null?new vn.workerClass:new n.window.Worker(vn.workerUrl)}const gt="vjmapgis_preloaded_worker_pool";class jt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<jt.workerCount;)this.workers.push(new et);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[gt]}numActive(){return Object.keys(this.active).length}}let yt;function Xt(){return yt||(yt=new jt),yt}function sn(d,t){const s={};for(const p in d)p!=="ref"&&(s[p]=d[p]);return n.refProperties.forEach(p=>{p in t&&(s[p]=t[p])}),s}function Kt(d){d=d.slice();const t=Object.create(null);for(let s=0;s<d.length;s++)t[d[s].id]=d[s];for(let s=0;s<d.length;s++)"ref"in d[s]&&(d[s]=sn(d[s],t[d[s].ref]));return d}jt.workerCount=2;const je={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog"};function ft(d,t,s){s.push({command:je.addSource,args:[d,t[d]]})}function Zn(d,t,s){t.push({command:je.removeSource,args:[d]}),s[d]=!0}function Bn(d,t,s,p){Zn(d,s,p),ft(d,t,s)}function bn(d,t,s){let p;for(p in d[s])if(d[s].hasOwnProperty(p)&&p!=="data"&&!b(d[s][p],t[s][p]))return!1;for(p in t[s])if(t[s].hasOwnProperty(p)&&p!=="data"&&!b(d[s][p],t[s][p]))return!1;return!0}function jn(d,t,s,p,x,S){let z;for(z in t=t||{},d=d||{})d.hasOwnProperty(z)&&(b(d[z],t[z])||s.push({command:S,args:[p,z,t[z],x]}));for(z in t)t.hasOwnProperty(z)&&!d.hasOwnProperty(z)&&(b(d[z],t[z])||s.push({command:S,args:[p,z,t[z],x]}))}function Pr(d){return d.id}function bi(d,t){return d[t.id]=t,d}class zr{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=n.clamp(t,0,1);let s=1,p=this._distances[s];const x=t*this.paddedLength+this.padding;for(;p<x&&s<this._distances.length;)p=this._distances[++s];const S=s-1,z=this._distances[S],B=p-z,V=B>0?(x-z)/B:0;return this.points[S].mult(1-V).add(this.points[s].mult(V))}}class $t{constructor(t,s,p){const x=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(t/p),this.yCellCount=Math.ceil(s/p);for(let z=0;z<this.xCellCount*this.yCellCount;z++)x.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,p,x,S){this._forEachCell(s,p,x,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(S)}insertCircle(t,s,p,x){this._forEachCell(s-x,p-x,s+x,p+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(p),this.circles.push(x)}_insertBoxCell(t,s,p,x,S,z){this.boxCells[S].push(z)}_insertCircleCell(t,s,p,x,S,z){this.circleCells[S].push(z)}_query(t,s,p,x,S,z){if(p<0||t>this.width||x<0||s>this.height)return!S&&[];const B=[];if(t<=0&&s<=0&&this.width<=p&&this.height<=x){if(S)return!0;for(let V=0;V<this.boxKeys.length;V++)B.push({key:this.boxKeys[V],x1:this.bboxes[4*V],y1:this.bboxes[4*V+1],x2:this.bboxes[4*V+2],y2:this.bboxes[4*V+3]});for(let V=0;V<this.circleKeys.length;V++){const $=this.circles[3*V],H=this.circles[3*V+1],re=this.circles[3*V+2];B.push({key:this.circleKeys[V],x1:$-re,y1:H-re,x2:$+re,y2:H+re})}return z?B.filter(z):B}return this._forEachCell(t,s,p,x,this._queryCell,B,{hitTest:S,seenUids:{box:{},circle:{}}},z),S?B.length>0:B}_queryCircle(t,s,p,x,S){const z=t-p,B=t+p,V=s-p,$=s+p;if(B<0||z>this.width||$<0||V>this.height)return!x&&[];const H=[];return this._forEachCell(z,V,B,$,this._queryCellCircle,H,{hitTest:x,circle:{x:t,y:s,radius:p},seenUids:{box:{},circle:{}}},S),x?H.length>0:H}query(t,s,p,x,S){return this._query(t,s,p,x,!1,S)}hitTest(t,s,p,x,S){return this._query(t,s,p,x,!0,S)}hitTestCircle(t,s,p,x){return this._queryCircle(t,s,p,!0,x)}_queryCell(t,s,p,x,S,z,B,V){const $=B.seenUids,H=this.boxCells[S];if(H!==null){const se=this.bboxes;for(const me of H)if(!$.box[me]){$.box[me]=!0;const ae=4*me;if(t<=se[ae+2]&&s<=se[ae+3]&&p>=se[ae+0]&&x>=se[ae+1]&&(!V||V(this.boxKeys[me]))){if(B.hitTest)return z.push(!0),!0;z.push({key:this.boxKeys[me],x1:se[ae],y1:se[ae+1],x2:se[ae+2],y2:se[ae+3]})}}}const re=this.circleCells[S];if(re!==null){const se=this.circles;for(const me of re)if(!$.circle[me]){$.circle[me]=!0;const ae=3*me;if(this._circleAndRectCollide(se[ae],se[ae+1],se[ae+2],t,s,p,x)&&(!V||V(this.circleKeys[me]))){if(B.hitTest)return z.push(!0),!0;{const ue=se[ae],Le=se[ae+1],ye=se[ae+2];z.push({key:this.circleKeys[me],x1:ue-ye,y1:Le-ye,x2:ue+ye,y2:Le+ye})}}}}}_queryCellCircle(t,s,p,x,S,z,B,V){const $=B.circle,H=B.seenUids,re=this.boxCells[S];if(re!==null){const me=this.bboxes;for(const ae of re)if(!H.box[ae]){H.box[ae]=!0;const ue=4*ae;if(this._circleAndRectCollide($.x,$.y,$.radius,me[ue+0],me[ue+1],me[ue+2],me[ue+3])&&(!V||V(this.boxKeys[ae])))return z.push(!0),!0}}const se=this.circleCells[S];if(se!==null){const me=this.circles;for(const ae of se)if(!H.circle[ae]){H.circle[ae]=!0;const ue=3*ae;if(this._circlesCollide(me[ue],me[ue+1],me[ue+2],$.x,$.y,$.radius)&&(!V||V(this.circleKeys[ae])))return z.push(!0),!0}}}_forEachCell(t,s,p,x,S,z,B,V){const $=this._convertToXCellCoord(t),H=this._convertToYCellCoord(s),re=this._convertToXCellCoord(p),se=this._convertToYCellCoord(x);for(let me=$;me<=re;me++)for(let ae=H;ae<=se;ae++)if(S.call(this,t,s,p,x,this.xCellCount*ae+me,z,B,V))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,p,x,S,z){const B=x-t,V=S-s,$=p+z;return $*$>B*B+V*V}_circleAndRectCollide(t,s,p,x,S,z,B){const V=(z-x)/2,$=Math.abs(t-(x+V));if($>V+p)return!1;const H=(B-S)/2,re=Math.abs(s-(S+H));if(re>H+p)return!1;if($<=V||re<=H)return!0;const se=$-V,me=re-H;return se*se+me*me<=p*p}}function On(d,t,s,p,x){const S=n.create$1();return t?(n.scale$1(S,S,[1/x,1/x,1]),s||n.rotateZ(S,S,p.angle)):n.multiply(S,p.labelPlaneMatrix,d),S}function Ln(d,t,s,p,x){if(t){const S=n.clone$1(d);return n.scale$1(S,S,[x,x,1]),s||n.rotateZ(S,S,-p.angle),S}return p.glCoordMatrix}function yr(d,t,s=0){const p=[d.x,d.y,s,1];s?n.transformMat4(p,p,t):ns(p,p,t);const x=p[3];return{point:new n.pointGeometry(p[0]/x,p[1]/x),signedDistanceFromCamera:x}}function wi(d,t){return Math.min(.5+d/t*.5,1.5)}function zn(d,t){const s=d[0]/d[3],p=d[1]/d[3];return s>=-t[0]&&s<=t[0]&&p>=-t[1]&&p<=t[1]}function ts(d,t,s,p,x,S,z,B,V){const $=p?d.textSizeData:d.iconSizeData,H=n.evaluateSizeForZoom($,s.transform.zoom),re=[256/s.width*2+1,256/s.height*2+1],se=p?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;se.clear();const me=d.lineVertexArray,ae=p?d.text.placedSymbolArray:d.icon.placedSymbolArray,ue=s.transform.width/s.transform.height;let Le=!1;for(let ye=0;ye<ae.length;ye++){const Me=ae.get(ye);if(Me.hidden||Me.writingMode===n.WritingMode.vertical&&!Le){po(Me.numGlyphs,se);continue}Le=!1;const Ae=V?V({x:Me.anchorX,y:Me.anchorY}):0,Ne=[Me.anchorX,Me.anchorY,Ae,1];if(n.transformMat4(Ne,Ne,t),!zn(Ne,re)){po(Me.numGlyphs,se);continue}const He=wi(s.transform.cameraToCenterDistance,Ne[3]),We=n.evaluateSizeForFeature($,H,Me),lt=z?We/He:We*He,ut=new n.pointGeometry(Me.anchorX,Me.anchorY),It=yr(ut,x,Ae);if(It.signedDistanceFromCamera<=0){po(Me.numGlyphs,se);continue}const ze=It.point;let Gt={};const Lt=z?null:V,pn=wr(Me,lt,!1,B,t,x,S,d.glyphOffsetArray,me,se,ze,ut,Gt,ue,Lt);Le=pn.useVertical,Lt&&pn.needsFlipping&&(Gt={}),(pn.notEnoughRoom||Le||pn.needsFlipping&&wr(Me,lt,!0,B,t,x,S,d.glyphOffsetArray,me,se,ze,ut,Gt,ue,Lt).notEnoughRoom)&&po(Me.numGlyphs,se)}p?d.text.dynamicLayoutVertexBuffer.updateData(se):d.icon.dynamicLayoutVertexBuffer.updateData(se)}function Yi(d,t,s,p,x,S,z,B,V,$,H,re,se){const me=B.glyphStartIndex+B.numGlyphs,ae=B.lineStartIndex,ue=B.lineStartIndex+B.lineLength,Le=t.getoffsetX(B.glyphStartIndex),ye=t.getoffsetX(me-1),Me=Qs(d*Le,s,p,x,S,z,B.segment,ae,ue,V,$,H,re,se,!0);if(!Me)return null;const Ae=Qs(d*ye,s,p,x,S,z,B.segment,ae,ue,V,$,H,re,se,!0);return Ae?{first:Me,last:Ae}:null}function Si(d,t,s,p){return d===n.WritingMode.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*p?{useVertical:!0}:(d===n.WritingMode.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function wr(d,t,s,p,x,S,z,B,V,$,H,re,se,me,ae){const ue=t/24,Le=d.lineOffsetX*ue,ye=d.lineOffsetY*ue;let Me;if(d.numGlyphs>1){const Ae=d.glyphStartIndex+d.numGlyphs,Ne=d.lineStartIndex,He=d.lineStartIndex+d.lineLength,We=Yi(ue,B,Le,ye,s,H,re,d,V,S,se,ae);if(!We)return{notEnoughRoom:!0};const lt=yr(We.first.point,z).point,ut=yr(We.last.point,z).point;if(p&&!s){const It=Si(d.writingMode,lt,ut,me);if(It)return It}Me=[We.first];for(let It=d.glyphStartIndex+1;It<Ae-1;It++)Me.push(Qs(ue*B.getoffsetX(It),Le,ye,s,H,re,d.segment,Ne,He,V,S,se,ae));Me.push(We.last)}else{if(p&&!s){const Ne=yr(re,x).point,He=d.lineStartIndex+d.segment+1,We=new n.pointGeometry(V.getx(He),V.gety(He)),lt=yr(We,x),ut=lt.signedDistanceFromCamera>0?lt.point:hr(re,We,Ne,1,x),It=Si(d.writingMode,Ne,ut,me);if(It)return It}const Ae=Qs(ue*B.getoffsetX(d.glyphStartIndex),Le,ye,s,H,re,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,V,S,se,ae);if(!Ae)return{notEnoughRoom:!0};Me=[Ae]}for(const Ae of Me)n.addDynamicAttributes($,Ae.point,Ae.angle);return{}}function hr(d,t,s,p,x,S){const z=d.add(d.sub(t)._unit()),B=yr(z,x,S?S(z):0).point,V=s.sub(B);return s.add(V._mult(p/V.mag()))}function Qs(d,t,s,p,x,S,z,B,V,$,H,re,se,me,ae){const ue=p?d-t:d+t;let Le=ue>0?1:-1,ye=0;p&&(Le*=-1,ye=Math.PI),Le<0&&(ye+=Math.PI);let Me=Le>0?B+z:B+z+1,Ae=x,Ne=x,He=0,We=0;const lt=Math.abs(ue),ut=[],It=[];let ze=S;const Gt=()=>{const Be=Me-Le;return He===0?S:new n.pointGeometry($.getx(Be),$.gety(Be))},Lt=()=>hr(Gt(),ze,Ne,lt-He+1,H,se);for(;He+We<=lt;){if(Me+=Le,Me<B||Me>=V)return null;if(Ne=Ae,ut.push(Ae),me&&It.push(ze||Gt()),Ae=re[Me],Ae===void 0){ze=new n.pointGeometry($.getx(Me),$.gety(Me));const Be=yr(ze,H,se?se(ze):0);Ae=Be.signedDistanceFromCamera>0?re[Me]=Be.point:Lt()}else ze=null;He+=We,We=Ne.dist(Ae)}ae&&se&&(ze=ze||new n.pointGeometry($.getx(Me),$.gety(Me)),re[Me]=Ae=re[Me]===void 0?Ae:Lt(),We=Ne.dist(Ae));const pn=(lt-He)/We,on=Ae.sub(Ne),an=on.mult(pn)._add(Ne);s&&an._add(on._unit()._perp()._mult(s*Le));const Pn=ye+Math.atan2(Ae.y-Ne.y,Ae.x-Ne.x);return ut.push(an),me&&(ze=ze||new n.pointGeometry($.getx(Me),$.gety(Me)),It.push(function(Be,nt,zt){const Yt=1-zt;return new n.pointGeometry(Be.x*Yt+nt.x*zt,Be.y*Yt+nt.y*zt)}(It.length>0?It[It.length-1]:ze,ze,pn))),{point:an,angle:Pn,path:ut,tilePath:It}}const To=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function po(d,t){for(let s=0;s<d;s++){const p=t.length;t.resize(p+4),t.float32.set(To,3*p)}}function ns(d,t,s){const p=t[0],x=t[1];return d[0]=s[0]*p+s[4]*x+s[12],d[1]=s[1]*p+s[5]*x+s[13],d[3]=s[3]*p+s[7]*x+s[15],d}const Mi=100;class Wr{constructor(t,s,p=new $t(t.width+200,t.height+200,25),x=new $t(t.width+200,t.height+200,25)){this.transform=t,this.grid=p,this.ignoredGrid=x,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Mi,this.screenBottomBoundary=t.height+Mi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=s}placeCollisionBox(t,s,p,x,S,z,B){const V=this.projectAndGetPerspectiveRatio(z,s.anchorPointX,s.anchorPointY,s.elevation,s.tileID),$=S*V.perspectiveRatio,H=(s.x1*t+p.x-s.padding)*$+V.point.x,re=(s.y1*t+p.y-s.padding)*$+V.point.y,se=(s.x2*t+p.x+s.padding)*$+V.point.x,me=(s.y2*t+p.y+s.padding)*$+V.point.y,ae=V.perspectiveRatio<=.55||V.aboveHorizon;return!this.isInsideGrid(H,re,se,me)||!x&&this.grid.hitTest(H,re,se,me,B)||ae?{box:[],offscreen:!1}:{box:[H,re,se,me],offscreen:this.isOffscreen(H,re,se,me)}}placeCollisionCircles(t,s,p,x,S,z,B,V,$,H,re,se,me,ae){const ue=[],Le=this.transform.elevation,ye=Le?Lt=>Le.getAtTileOffset(ae,Lt.x,Lt.y):Lt=>0,Me=new n.pointGeometry(s.anchorX,s.anchorY),Ae=ye(Me),Ne=this.projectAndGetPerspectiveRatio(z,Me.x,Me.y,Ae,ae),{perspectiveRatio:He}=Ne,We=(H?S/He:S*He)/n.ONE_EM,lt=yr(Me,B,Ae).point,ut=Ne.signedDistanceFromCamera>0?Yi(We,x,s.lineOffsetX*We,s.lineOffsetY*We,!1,lt,Me,s,p,B,{},Le&&!H?ye:null,H&&!!Le):null;let It=!1,ze=!1,Gt=!0;if(ut&&!Ne.aboveHorizon){const Lt=.5*se*He+me,pn=new n.pointGeometry(-100,-100),on=new n.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),an=new zr,Pn=ut.first,Be=ut.last;let nt=[];for(let yn=Pn.path.length-1;yn>=1;yn--)nt.push(Pn.path[yn]);for(let yn=1;yn<Be.path.length;yn++)nt.push(Be.path[yn]);const zt=2.5*Lt;if(V){const yn=nt.map(Le?(fn,Cn)=>{const rr=ye(Cn<Pn.path.length-1?Pn.tilePath[Pn.path.length-1-Cn]:Be.tilePath[Cn-Pn.path.length+2]);return yr(fn,V,rr)}:fn=>yr(fn,V));nt=yn.some(fn=>fn.signedDistanceFromCamera<=0)?[]:yn.map(fn=>fn.point)}let Yt=[];if(nt.length>0){const yn=nt[0].clone(),fn=nt[0].clone();for(let Cn=1;Cn<nt.length;Cn++)yn.x=Math.min(yn.x,nt[Cn].x),yn.y=Math.min(yn.y,nt[Cn].y),fn.x=Math.max(fn.x,nt[Cn].x),fn.y=Math.max(fn.y,nt[Cn].y);Yt=yn.x>=pn.x&&fn.x<=on.x&&yn.y>=pn.y&&fn.y<=on.y?[nt]:fn.x<pn.x||yn.x>on.x||fn.y<pn.y||yn.y>on.y?[]:n.clipLine([nt],pn.x,pn.y,on.x,on.y)}for(const yn of Yt){an.reset(yn,.25*Lt);let fn=0;fn=an.length<=.5*Lt?1:Math.ceil(an.paddedLength/zt)+1;for(let Cn=0;Cn<fn;Cn++){const rr=Cn/Math.max(fn-1,1),br=an.lerp(rr),Yn=br.x+Mi,or=br.y+Mi;ue.push(Yn,or,Lt,0);const Or=Yn-Lt,Hn=or-Lt,Jn=Yn+Lt,Fn=or+Lt;if(Gt=Gt&&this.isOffscreen(Or,Hn,Jn,Fn),ze=ze||this.isInsideGrid(Or,Hn,Jn,Fn),!t&&this.grid.hitTestCircle(Yn,or,Lt,re)&&(It=!0,!$))return{circles:[],offscreen:!1,collisionDetected:It}}}}return{circles:!$&&It||!ze?[]:ue,offscreen:Gt,collisionDetected:It}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let p=1/0,x=1/0,S=-1/0,z=-1/0;for(const H of t){const re=new n.pointGeometry(H.x+Mi,H.y+Mi);p=Math.min(p,re.x),x=Math.min(x,re.y),S=Math.max(S,re.x),z=Math.max(z,re.y),s.push(re)}const B=this.grid.query(p,x,S,z).concat(this.ignoredGrid.query(p,x,S,z)),V={},$={};for(const H of B){const re=H.key;if(V[re.bucketInstanceId]===void 0&&(V[re.bucketInstanceId]={}),V[re.bucketInstanceId][re.featureIndex])continue;const se=[new n.pointGeometry(H.x1,H.y1),new n.pointGeometry(H.x2,H.y1),new n.pointGeometry(H.x2,H.y2),new n.pointGeometry(H.x1,H.y2)];n.polygonIntersectsPolygon(s,se)&&(V[re.bucketInstanceId][re.featureIndex]=!0,$[re.bucketInstanceId]===void 0&&($[re.bucketInstanceId]=[]),$[re.bucketInstanceId].push(re.featureIndex))}return $}insertCollisionBox(t,s,p,x,S){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:x,collisionGroupID:S},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,p,x,S){const z=s?this.ignoredGrid:this.grid,B={bucketInstanceId:p,featureIndex:x,collisionGroupID:S};for(let V=0;V<t.length;V+=4)z.insertCircle(B,t[V],t[V+1],t[V+2])}projectAndGetPerspectiveRatio(t,s,p,x,S){const z=[s,p,x||0,1];let B=!1;if(x||this.transform.pitch>0){n.transformMat4(z,z,t);let V=!1;this.fogState&&S&&(V=function($,H,re,se,me,ae){const ue=ae.calculateFogTileMatrix(me),Le=[H,re,se];return n.transformMat4$1(Le,Le,ue),ct($,Le,ae.pitch,ae._fov)}(this.fogState,s,p,x||0,S.toUnwrapped(),this.transform)>.9),B=z[2]>z[3]||V}else ns(z,z,t);return{point:new n.pointGeometry((z[0]/z[3]+1)/2*this.transform.width+Mi,(-z[1]/z[3]+1)/2*this.transform.height+Mi),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/z[3]*.5,1.5),signedDistanceFromCamera:z[3],aboveHorizon:B}}isOffscreen(t,s,p,x){return p<Mi||t>=this.screenRightBoundary||x<Mi||s>this.screenBottomBoundary}isInsideGrid(t,s,p,x){return p>=0&&t<this.gridRightBoundary&&x>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=n.identity([]);return n.translate(t,t,[-100,-100,0]),t}}class $n{constructor(t,s,p,x){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):x&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Uo{constructor(t,s,p,x,S){this.text=new $n(t?t.text:null,s,p,S),this.icon=new $n(t?t.icon:null,s,x,S)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class rs{constructor(t,s,p){this.text=t,this.icon=s,this.skipFade=p}}class Hr{constructor(){this.invProjMatrix=n.create$1(),this.viewportMatrix=n.create$1(),this.circles=[]}}class ai{constructor(t,s,p,x,S){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=p,this.bucketIndex=x,this.tileID=S}}class Ms{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:p=>p.collisionGroupID===s}}return this.collisionGroups[t]}}function _r(d,t,s,p,x){const{horizontalAlign:S,verticalAlign:z}=n.getAnchorAlignment(d),B=-(S-.5)*t,V=-(z-.5)*s,$=n.evaluateVariableOffset(d,p);return new n.pointGeometry(B+$[0]*x,V+$[1]*x)}function vr(d,t,s,p,x){const S=new n.pointGeometry(d,t);return s&&S._rotate(p?x:-x),S}class Es{constructor(t,s,p,x,S){this.transform=t.clone(),this.collisionIndex=new Wr(this.transform,S),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new Ms(p),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,p,x){const S=p.getBucket(s),z=p.latestFeatureIndex;if(!S||!z||s.id!==S.layerIds[0])return;const B=p.collisionBoxArray,V=S.layers[0].layout,$=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),H=p.tileSize/n.EXTENT,re=this.transform.calculateProjMatrix(p.tileID.toUnwrapped()),se=V.get("text-pitch-alignment")==="map",me=V.get("text-rotation-alignment")==="map",ae=ht(p,1,this.transform.zoom),ue=On(re,se,me,this.transform,ae);let Le=null;if(se){const Me=Ln(re,se,me,this.transform,ae);Le=n.multiply([],this.transform.labelPlaneMatrix,Me)}this.retainedQueryData[S.bucketInstanceId]=new ai(S.bucketInstanceId,z,S.sourceLayerIndex,S.index,p.tileID);const ye={bucket:S,layout:V,posMatrix:re,textLabelPlaneMatrix:ue,labelToScreenMatrix:Le,scale:$,textPixelRatio:H,holdingForFade:p.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:n.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:n.evaluateSizeForZoom(S.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(x)for(const Me of S.sortKeyRanges){const{sortKey:Ae,symbolInstanceStart:Ne,symbolInstanceEnd:He}=Me;t.push({sortKey:Ae,symbolInstanceStart:Ne,symbolInstanceEnd:He,parameters:ye})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:ye})}attemptAnchorPlacement(t,s,p,x,S,z,B,V,$,H,re,se,me,ae,ue,Le,ye,Me){const Ae=[se.textOffset0,se.textOffset1],Ne=_r(t,p,x,Ae,S),He=this.collisionIndex.placeCollisionBox(S,s,vr(Ne.x,Ne.y,z,B,this.transform.angle),re,V,$,H.predicate);if((!Le||this.collisionIndex.placeCollisionBox(ae.getSymbolInstanceIconSize(Me,this.transform.zoom,me),Le,vr(Ne.x,Ne.y,z,B,this.transform.angle),re,V,$,H.predicate).box.length!==0)&&He.box.length>0){let We;return this.prevPlacement&&this.prevPlacement.variableOffsets[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID].text&&(We=this.prevPlacement.variableOffsets[se.crossTileID].anchor),this.variableOffsets[se.crossTileID]={textOffset:Ae,width:p,height:x,anchor:t,textScale:S,prevAnchor:We},this.markUsedJustification(ae,t,se,ue),ae.allowVerticalPlacement&&(this.markUsedOrientation(ae,ue,se),this.placedOrientations[se.crossTileID]=ue),{shift:Ne,placedGlyphBoxes:He}}}placeLayerBucketPart(t,s,p){const{bucket:x,layout:S,posMatrix:z,textLabelPlaneMatrix:B,labelToScreenMatrix:V,textPixelRatio:$,holdingForFade:H,collisionBoxArray:re,partiallyEvaluatedTextSize:se,partiallyEvaluatedIconSize:me,collisionGroup:ae}=t.parameters,ue=S.get("text-optional"),Le=S.get("icon-optional"),ye=S.get("text-allow-overlap"),Me=S.get("icon-allow-overlap"),Ae=S.get("text-rotation-alignment")==="map",Ne=S.get("text-pitch-alignment")==="map",He=S.get("icon-text-fit")!=="none",We=S.get("symbol-z-order")==="viewport-y",lt=ye&&(Me||!x.hasIconData()||Le),ut=Me&&(ye||!x.hasTextData()||ue);!x.collisionArrays&&re&&x.deserializeCollisionBoxes(re),p&&x.updateCollisionDebugBuffers(this.transform.zoom,re);const It=(ze,Gt,Lt)=>{if(s[ze.crossTileID])return;if(H)return void(this.placements[ze.crossTileID]=new rs(!1,!1,!1));let pn=!1,on=!1,an=!0,Pn=null,Be={box:null,offscreen:null},nt={box:null,offscreen:null},zt=null,Yt=null,yn=null,fn=0,Cn=0,rr=0;Lt.textFeatureIndex?fn=Lt.textFeatureIndex:ze.useRuntimeCollisionCircles&&(fn=ze.featureIndex),Lt.verticalTextFeatureIndex&&(Cn=Lt.verticalTextFeatureIndex);const br=Hn=>{Hn.tileID=this.retainedQueryData[x.bucketInstanceId].tileID,(this.transform.elevation||Hn.elevation)&&(Hn.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[x.bucketInstanceId].tileID,Hn.anchorPointX,Hn.anchorPointY):0)},Yn=Lt.textBox;if(Yn){br(Yn);const Hn=Fn=>{let dr=n.WritingMode.horizontal;if(x.allowVerticalPlacement&&!Fn&&this.prevPlacement){const Fr=this.prevPlacement.placedOrientations[ze.crossTileID];Fr&&(this.placedOrientations[ze.crossTileID]=Fr,dr=Fr,this.markUsedOrientation(x,dr,ze))}return dr},Jn=(Fn,dr)=>{if(x.allowVerticalPlacement&&ze.numVerticalGlyphVertices>0&&Lt.verticalTextBox){for(const Fr of x.writingModes)if(Fr===n.WritingMode.vertical?(Be=dr(),nt=Be):Be=Fn(),Be&&Be.box&&Be.box.length)break}else Be=Fn()};if(S.get("text-variable-anchor")){let Fn=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ze.crossTileID]){const ir=this.prevPlacement.variableOffsets[ze.crossTileID];Fn.indexOf(ir.anchor)>0&&(Fn=Fn.filter(Jr=>Jr!==ir.anchor),Fn.unshift(ir.anchor))}const dr=(ir,Jr,xs)=>{const _i=x.getSymbolInstanceTextSize(se,ze,this.transform.zoom,Gt),Oo=(ir.x2-ir.x1)*_i+2*ir.padding,ar=(ir.y2-ir.y1)*_i+2*ir.padding,Qn=He&&!Me?Jr:null;Qn&&br(Qn);let xo={box:[],offscreen:!1};const bo=ye?2*Fn.length:Fn.length;for(let Ho=0;Ho<bo;++Ho){const ui=this.attemptAnchorPlacement(Fn[Ho%Fn.length],ir,Oo,ar,_i,Ae,Ne,$,z,ae,Ho>=Fn.length,ze,Gt,x,xs,Qn,se,me);if(ui&&(xo=ui.placedGlyphBoxes,xo&&xo.box&&xo.box.length)){pn=!0,Pn=ui.shift;break}}return xo};Jn(()=>dr(Yn,Lt.iconBox,n.WritingMode.horizontal),()=>{const ir=Lt.verticalTextBox;return ir&&br(ir),x.allowVerticalPlacement&&!(Be&&Be.box&&Be.box.length)&&ze.numVerticalGlyphVertices>0&&ir?dr(ir,Lt.verticalIconBox,n.WritingMode.vertical):{box:null,offscreen:null}}),Be&&(pn=Be.box,an=Be.offscreen);const Fr=Hn(Be&&Be.box);if(!pn&&this.prevPlacement){const ir=this.prevPlacement.variableOffsets[ze.crossTileID];ir&&(this.variableOffsets[ze.crossTileID]=ir,this.markUsedJustification(x,ir.anchor,ze,Fr))}}else{const Fn=(dr,Fr)=>{const ir=x.getSymbolInstanceTextSize(se,ze,this.transform.zoom,Gt),Jr=this.collisionIndex.placeCollisionBox(ir,dr,new n.pointGeometry(0,0),ye,$,z,ae.predicate);return Jr&&Jr.box&&Jr.box.length&&(this.markUsedOrientation(x,Fr,ze),this.placedOrientations[ze.crossTileID]=Fr),Jr};Jn(()=>Fn(Yn,n.WritingMode.horizontal),()=>{const dr=Lt.verticalTextBox;return x.allowVerticalPlacement&&ze.numVerticalGlyphVertices>0&&dr?(br(dr),Fn(dr,n.WritingMode.vertical)):{box:null,offscreen:null}}),Hn(Be&&Be.box&&Be.box.length)}}if(zt=Be,pn=zt&&zt.box&&zt.box.length>0,an=zt&&zt.offscreen,ze.useRuntimeCollisionCircles){const Hn=x.text.placedSymbolArray.get(ze.centerJustifiedTextSymbolIndex),Jn=n.evaluateSizeForFeature(x.textSizeData,se,Hn),Fn=S.get("text-padding");Yt=this.collisionIndex.placeCollisionCircles(ye,Hn,x.lineVertexArray,x.glyphOffsetArray,Jn,z,B,V,p,Ne,ae.predicate,ze.collisionCircleDiameter,Fn,this.retainedQueryData[x.bucketInstanceId].tileID),pn=ye||Yt.circles.length>0&&!Yt.collisionDetected,an=an&&Yt.offscreen}if(Lt.iconFeatureIndex&&(rr=Lt.iconFeatureIndex),Lt.iconBox){const Hn=Jn=>{br(Jn);const Fn=He&&Pn?vr(Pn.x,Pn.y,Ae,Ne,this.transform.angle):new n.pointGeometry(0,0),dr=x.getSymbolInstanceIconSize(me,this.transform.zoom,Gt);return this.collisionIndex.placeCollisionBox(dr,Jn,Fn,Me,$,z,ae.predicate)};nt&&nt.box&&nt.box.length&&Lt.verticalIconBox?(yn=Hn(Lt.verticalIconBox),on=yn.box.length>0):(yn=Hn(Lt.iconBox),on=yn.box.length>0),an=an&&yn.offscreen}const or=ue||ze.numHorizontalGlyphVertices===0&&ze.numVerticalGlyphVertices===0,Or=Le||ze.numIconVertices===0;if(or||Or?Or?or||(on=on&&pn):pn=on&&pn:on=pn=on&&pn,pn&&zt&&zt.box&&this.collisionIndex.insertCollisionBox(zt.box,S.get("text-ignore-placement"),x.bucketInstanceId,nt&&nt.box&&Cn?Cn:fn,ae.ID),on&&yn&&this.collisionIndex.insertCollisionBox(yn.box,S.get("icon-ignore-placement"),x.bucketInstanceId,rr,ae.ID),Yt&&(pn&&this.collisionIndex.insertCollisionCircles(Yt.circles,S.get("text-ignore-placement"),x.bucketInstanceId,fn,ae.ID),p)){const Hn=x.bucketInstanceId;let Jn=this.collisionCircleArrays[Hn];Jn===void 0&&(Jn=this.collisionCircleArrays[Hn]=new Hr);for(let Fn=0;Fn<Yt.circles.length;Fn+=4)Jn.circles.push(Yt.circles[Fn+0]),Jn.circles.push(Yt.circles[Fn+1]),Jn.circles.push(Yt.circles[Fn+2]),Jn.circles.push(Yt.collisionDetected?1:0)}this.placements[ze.crossTileID]=new rs(pn||lt,on||ut,an||x.justReloaded),s[ze.crossTileID]=!0};if(We){const ze=x.getSortedSymbolIndexes(this.transform.angle);for(let Gt=ze.length-1;Gt>=0;--Gt){const Lt=ze[Gt];It(x.symbolInstances.get(Lt),Lt,x.collisionArrays[Lt])}}else for(let ze=t.symbolInstanceStart;ze<t.symbolInstanceEnd;ze++)It(x.symbolInstances.get(ze),ze,x.collisionArrays[ze]);if(p&&x.bucketInstanceId in this.collisionCircleArrays){const ze=this.collisionCircleArrays[x.bucketInstanceId];n.invert(ze.invProjMatrix,z),ze.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(t,s,p,x){let S;S=x===n.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[n.getAnchorJustification(s)];const z=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const B of z)B>=0&&(t.text.placedSymbolArray.get(B).crossTileID=S>=0&&B!==S?0:p.crossTileID)}markUsedOrientation(t,s,p){const x=s===n.WritingMode.horizontal||s===n.WritingMode.horizontalOnly?s:0,S=s===n.WritingMode.vertical?s:0,z=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const B of z)t.text.placedSymbolArray.get(B).placedOrientation=x;p.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=S)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let p=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const x=s?s.symbolFadeChange(t):1,S=s?s.opacities:{},z=s?s.variableOffsets:{},B=s?s.placedOrientations:{};for(const V in this.placements){const $=this.placements[V],H=S[V];H?(this.opacities[V]=new Uo(H,x,$.text,$.icon),p=p||$.text!==H.text.placed||$.icon!==H.icon.placed):(this.opacities[V]=new Uo(null,x,$.text,$.icon,$.skipFade),p=p||$.text||$.icon)}for(const V in S){const $=S[V];if(!this.opacities[V]){const H=new Uo($,x,!1,!1);H.isHidden()||(this.opacities[V]=H,p=p||$.text.placed||$.icon.placed)}}for(const V in z)this.variableOffsets[V]||!this.opacities[V]||this.opacities[V].isHidden()||(this.variableOffsets[V]=z[V]);for(const V in B)this.placedOrientations[V]||!this.opacities[V]||this.opacities[V].isHidden()||(this.placedOrientations[V]=B[V]);p?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const p={};for(const x of s){const S=x.getBucket(t);S&&x.latestFeatureIndex&&t.id===S.layerIds[0]&&this.updateBucketOpacities(S,p,x.collisionBoxArray)}}updateBucketOpacities(t,s,p){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const x=t.layers[0].layout,S=new Uo(null,0,!1,!1,!0),z=x.get("text-allow-overlap"),B=x.get("icon-allow-overlap"),V=x.get("text-variable-anchor"),$=x.get("text-rotation-alignment")==="map",H=x.get("text-pitch-alignment")==="map",re=x.get("icon-text-fit")!=="none",se=new Uo(null,0,z&&(B||!t.hasIconData()||x.get("icon-optional")),B&&(z||!t.hasTextData()||x.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const me=(ae,ue,Le)=>{for(let ye=0;ye<ue/4;ye++)ae.opacityVertexArray.emplaceBack(Le)};for(let ae=0;ae<t.symbolInstances.length;ae++){const ue=t.symbolInstances.get(ae),{numHorizontalGlyphVertices:Le,numVerticalGlyphVertices:ye,crossTileID:Me}=ue;let Ae=this.opacities[Me];s[Me]?Ae=S:Ae||(Ae=se,this.opacities[Me]=Ae),s[Me]=!0;const Ne=ue.numIconVertices>0,He=this.placedOrientations[ue.crossTileID],We=He===n.WritingMode.vertical,lt=He===n.WritingMode.horizontal||He===n.WritingMode.horizontalOnly;if(Le>0||ye>0){const ut=Ya(Ae.text);me(t.text,Le,We?is:ut),me(t.text,ye,lt?is:ut);const It=Ae.text.isHidden();[ue.rightJustifiedTextSymbolIndex,ue.centerJustifiedTextSymbolIndex,ue.leftJustifiedTextSymbolIndex].forEach(Lt=>{Lt>=0&&(t.text.placedSymbolArray.get(Lt).hidden=It||We?1:0)}),ue.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(ue.verticalPlacedTextSymbolIndex).hidden=It||lt?1:0);const ze=this.variableOffsets[ue.crossTileID];ze&&this.markUsedJustification(t,ze.anchor,ue,He);const Gt=this.placedOrientations[ue.crossTileID];Gt&&(this.markUsedJustification(t,"left",ue,Gt),this.markUsedOrientation(t,Gt,ue))}if(Ne){const ut=Ya(Ae.icon),It=!(re&&ue.verticalPlacedIconSymbolIndex&&We);ue.placedIconSymbolIndex>=0&&(me(t.icon,ue.numIconVertices,It?ut:is),t.icon.placedSymbolArray.get(ue.placedIconSymbolIndex).hidden=Ae.icon.isHidden()),ue.verticalPlacedIconSymbolIndex>=0&&(me(t.icon,ue.numVerticalIconVertices,It?is:ut),t.icon.placedSymbolArray.get(ue.verticalPlacedIconSymbolIndex).hidden=Ae.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const ut=t.collisionArrays[ae];if(ut){let It=new n.pointGeometry(0,0);if(ut.textBox||ut.verticalTextBox){let Gt=!0;if(V){const Lt=this.variableOffsets[Me];Lt?(It=_r(Lt.anchor,Lt.width,Lt.height,Lt.textOffset,Lt.textScale),$&&It._rotate(H?this.transform.angle:-this.transform.angle)):Gt=!1}ut.textBox&&qr(t.textCollisionBox.collisionVertexArray,Ae.text.placed,!Gt||We,It.x,It.y),ut.verticalTextBox&&qr(t.textCollisionBox.collisionVertexArray,Ae.text.placed,!Gt||lt,It.x,It.y)}const ze=Boolean(!lt&&ut.verticalIconBox);ut.iconBox&&qr(t.iconCollisionBox.collisionVertexArray,Ae.icon.placed,ze,re?It.x:0,re?It.y:0),ut.verticalIconBox&&qr(t.iconCollisionBox.collisionVertexArray,Ae.icon.placed,!ze,re?It.x:0,re?It.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ae=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ae.invProjMatrix,t.placementViewportMatrix=ae.viewportMatrix,t.collisionCircleArray=ae.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const p=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*p>t}setStale(){this.stale=!0}}function qr(d,t,s,p,x){d.emplaceBack(t?1:0,s?1:0,p||0,x||0),d.emplaceBack(t?1:0,s?1:0,p||0,x||0),d.emplaceBack(t?1:0,s?1:0,p||0,x||0),d.emplaceBack(t?1:0,s?1:0,p||0,x||0)}const nr=Math.pow(2,25),Is=Math.pow(2,24),xr=Math.pow(2,17),li=Math.pow(2,16),Ri=Math.pow(2,9),Sl=Math.pow(2,8),Po=Math.pow(2,1);function Ya(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const t=d.placed?1:0,s=Math.floor(127*d.opacity);return s*nr+t*Is+s*xr+t*li+s*Ri+t*Sl+s*Po+t}const is=0;class Ei{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,p,x,S){const z=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(z,x,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,z.sort((B,V)=>B.sortKey-V.sortKey));this._currentPartIndex<z.length;)if(s.placeLayerBucketPart(z[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,S())return!0;return!1}}class ea{constructor(t,s,p,x,S,z,B,V){this.placement=new Es(t,S,z,B,V),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(t,s,p){const x=n.exported.now(),S=()=>{const z=n.exported.now()-x;return!this._forceFullPlacement&&z>2};for(;this._currentPlacementIndex>=0;){const z=s[t[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(z.type==="symbol"&&(!z.minzoom||z.minzoom<=B)&&(!z.maxzoom||z.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new Ei(z)),this._inProgressLayer.continuePlacement(p[z.source],this.placement,this._showCollisionBoxes,z,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Co=512/n.EXTENT/2;class Ii{constructor(t,s,p){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let x=0;x<s.length;x++){const S=s.get(x),z=S.key;this.indexedSymbolInstances[z]||(this.indexedSymbolInstances[z]=[]),this.indexedSymbolInstances[z].push({crossTileID:S.crossTileID,coord:this.getScaledCoordinates(S,t)})}}getScaledCoordinates(t,s){const p=Co/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*n.EXTENT+t.anchorX)*p),y:Math.floor((s.canonical.y*n.EXTENT+t.anchorY)*p)}}findMatches(t,s,p){const x=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let S=0;S<t.length;S++){const z=t.get(S);if(z.crossTileID)continue;const B=this.indexedSymbolInstances[z.key];if(!B)continue;const V=this.getScaledCoordinates(z,s);for(const $ of B)if(Math.abs($.coord.x-V.x)<=x&&Math.abs($.coord.y-V.y)<=x&&!p[$.crossTileID]){p[$.crossTileID]=!0,z.crossTileID=$.crossTileID;break}}}}class os{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ml{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const p in this.indexes){const x=this.indexes[p],S={};for(const z in x){const B=x[z];B.tileID=B.tileID.unwrapTo(B.tileID.wrap+s),S[B.tileID.key]=B}this.indexes[p]=S}this.lng=t}addBucket(t,s,p){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let S=0;S<s.symbolInstances.length;S++)s.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const x=this.usedCrossTileIDs[t.overscaledZ];for(const S in this.indexes){const z=this.indexes[S];if(Number(S)>t.overscaledZ)for(const B in z){const V=z[B];V.tileID.isChildOf(t)&&V.findMatches(s.symbolInstances,t,x)}else{const B=z[t.scaledTo(Number(S)).key];B&&B.findMatches(s.symbolInstances,t,x)}}for(let S=0;S<s.symbolInstances.length;S++){const z=s.symbolInstances.get(S);z.crossTileID||(z.crossTileID=p.generate(),x[z.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ii(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const p in s.indexedSymbolInstances)for(const x of s.indexedSymbolInstances[p])delete this.usedCrossTileIDs[t][x.crossTileID]}removeStaleBuckets(t){let s=!1;for(const p in this.indexes){const x=this.indexes[p];for(const S in x)t[x[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,x[S]),delete x[S],s=!0)}return s}}class ta{constructor(){this.layerIndexes={},this.crossTileIDs=new os,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,p){let x=this.layerIndexes[t.id];x===void 0&&(x=this.layerIndexes[t.id]=new Ml);let S=!1;const z={};x.handleWrapJump(p);for(const B of s){const V=B.getBucket(t);V&&t.id===V.layerIds[0]&&(V.bucketInstanceId||(V.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(B.tileID,V,this.crossTileIDs)&&(S=!0),z[V.bucketInstanceId]=!0)}return x.removeStaleBuckets(z)&&(S=!0),S}pruneUnusedLayers(t){const s={};t.forEach(p=>{s[p]=!0});for(const p in this.layerIndexes)s[p]||delete this.layerIndexes[p]}}const fi=(d,t)=>n.emitValidationErrors(d,t&&t.filter(s=>s.identifier!=="source.canvas")),Pa=n.pick(je,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog"]),na=n.pick(je,["setCenter","setZoom","setBearing","setPitch"]),Ca=function(){const d={},t=n.spec.$version;for(const s in n.spec.$root){const p=n.spec.$root[s];if(p.required){let x=null;x=s==="version"?t:p.type==="array"?[]:{},x!=null&&(d[s]=x)}}return d}(),Ts={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Bi extends n.Evented{constructor(t,s={}){super(),this.map=t,this.dispatcher=new cn(Xt(),this),this.imageManager=new pe,this.imageManager.setEventedParent(this),this.glyphManager=new n.GlyphManager(t._requestManager,s.localFontFamily?n.LocalGlyphMode.all:s.localIdeographFontFamily?n.LocalGlyphMode.ideographs:n.LocalGlyphMode.none,s.localFontFamily||s.localIdeographFontFamily),this.lineAtlas=new n.LineAtlas(256,512),this.crossTileSymbolIndex=new ta,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new n.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",n.getReferrer());const p=this;this._rtlTextPluginCallback=Bi.registerForPluginStateChange(x=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(S,z)=>{if(n.triggerPluginCompletionEvent(S),z&&z.every(B=>B))for(const B in p._sourceCaches){const V=p._sourceCaches[B],$=V.getSource().type;$!=="vector"&&$!=="geojson"||V.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const S=this.getSource(x.sourceId);if(S&&S.vectorLayerIds)for(const z in this._layers){const B=this._layers[z];B.source===S.id&&this._validateLayer(B)}})}loadURL(t,s={}){this.fire(new n.Event("dataloading",{dataType:"style"}));const p=typeof s.validate=="boolean"?s.validate:!n.isvjmapsURL(t);t=this.map._requestManager.normalizeStyleURL(t,s.accessToken);const x=this.map._requestManager.transformRequest(t,n.ResourceType.Style);this._request=n.getJSON(x,(S,z)=>{this._request=null,S?this.fire(new n.ErrorEvent(S)):z&&this._load(z,p)})}loadJSON(t,s={}){this.fire(new n.Event("dataloading",{dataType:"style"})),this._request=n.exported.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new n.Event("dataloading",{dataType:"style"})),this._load(Ca,!1)}_updateLayerCount(t,s){const p=s?1:-1;t.is3D()&&(this._num3DLayers+=p),t.type==="circle"&&(this._numCircleLayers+=p),t.type==="symbol"&&(this._numSymbolLayers+=p)}_load(t,s){if(s&&fi(this,n.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const x in t.sources)this.addSource(x,t.sources[x],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const p=Kt(this.stylesheet.layers);this._order=p.map(x=>x.id),this._layers={},this._serializedLayers={};for(let x of p)x=n.createStyleLayer(x),x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Pe(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new n.Event("data",{dataType:"style"})),this.fire(new n.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(s,p,x){let S,z,B;const V=n.exported.devicePixelRatio>1?"@2x":"";let $=n.getJSON(p.transformRequest(p.normalizeSpriteURL(s,V,".json"),n.ResourceType.SpriteJSON),(se,me)=>{$=null,B||(B=se,S=me,re())}),H=n.getImage(p.transformRequest(p.normalizeSpriteURL(s,V,".png"),n.ResourceType.SpriteImage),(se,me)=>{H=null,B||(B=se,z=me,re())});function re(){if(B)x(B);else if(S&&z){const se=n.exported.getImageData(z),me={};for(const ae in S){const{width:ue,height:Le,x:ye,y:Me,sdf:Ae,pixelRatio:Ne,stretchX:He,stretchY:We,content:lt}=S[ae],ut=new n.RGBAImage({width:ue,height:Le});n.RGBAImage.copy(se,ut,{x:ye,y:Me},{x:0,y:0},{width:ue,height:Le}),me[ae]={data:ut,pixelRatio:Ne,sdf:Ae,stretchX:He,stretchY:We,content:lt}}x(null,me)}}return{cancel(){$&&($.cancel(),$=null),H&&(H.cancel(),H=null)}}}(t,this.map._requestManager,(s,p)=>{if(this._spriteRequest=null,s)this.fire(new n.ErrorEvent(s));else if(p)for(const x in p)this.imageManager.addImage(x,p[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new n.Event("data",{dataType:"style"}))})}_validateLayer(t){const s=this.getSource(t.source);if(!s)return;const p=t.sourceLayer;p&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(p)===-1)&&this.fire(new n.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${s.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const s=[];for(const p of t){const x=this._layers[p];x.type!=="custom"&&s.push(x.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&Ts[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const s=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(x.length||S.length)&&this._updateWorkerLayers(x,S);for(const z in this._updatedSources){const B=this._updatedSources[z];B==="reload"?this._reloadSource(z):B==="clear"&&this._clearSource(z)}this._updateTilesForChangedImages();for(const z in this._updatedPaintProps)this._layers[z].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const p={};for(const x in this._sourceCaches){const S=this._sourceCaches[x];p[x]=S.used,S.used=!1}for(const x of this._order){const S=this._layers[x];if(S.recalculate(t,this._availableImages),!S.isHidden(t.zoom)){const B=this._getLayerSourceCache(S);B&&(B.used=!0)}const z=this.map.painter;if(z){const B=S.getProgramIds();if(!B)continue;const V=S.getProgramConfiguration(t.zoom);for(const $ of B)z.useProgram($,V)}}for(const x in p){const S=this._sourceCaches[x];p[x]!==S.used&&S.getSource().fire(new n.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:S.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),s&&this.fire(new n.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),fi(this,n.validateStyle(t)))return!1;(t=n.clone$2(t)).layers=Kt(t.layers);const s=function(x,S){if(!x)return[{command:je.setStyle,args:[S]}];let z=[];try{if(!b(x.version,S.version))return[{command:je.setStyle,args:[S]}];b(x.center,S.center)||z.push({command:je.setCenter,args:[S.center]}),b(x.zoom,S.zoom)||z.push({command:je.setZoom,args:[S.zoom]}),b(x.bearing,S.bearing)||z.push({command:je.setBearing,args:[S.bearing]}),b(x.pitch,S.pitch)||z.push({command:je.setPitch,args:[S.pitch]}),b(x.sprite,S.sprite)||z.push({command:je.setSprite,args:[S.sprite]}),b(x.glyphs,S.glyphs)||z.push({command:je.setGlyphs,args:[S.glyphs]}),b(x.transition,S.transition)||z.push({command:je.setTransition,args:[S.transition]}),b(x.light,S.light)||z.push({command:je.setLight,args:[S.light]}),b(x.fog,S.fog)||z.push({command:je.setFog,args:[S.fog]});const B={},V=[];(function(re,se,me,ae){let ue;for(ue in se=se||{},re=re||{})re.hasOwnProperty(ue)&&(se.hasOwnProperty(ue)||Zn(ue,me,ae));for(ue in se)se.hasOwnProperty(ue)&&(re.hasOwnProperty(ue)?b(re[ue],se[ue])||(re[ue].type==="geojson"&&se[ue].type==="geojson"&&bn(re,se,ue)?me.push({command:je.setGeoJSONSourceData,args:[ue,se[ue].data]}):Bn(ue,se,me,ae)):ft(ue,se,me))})(x.sources,S.sources,V,B);const $=[];x.layers&&x.layers.forEach(re=>{B[re.source]?z.push({command:je.removeLayer,args:[re.id]}):$.push(re)});let H=x.terrain;H&&B[H.source]&&(z.push({command:je.setTerrain,args:[void 0]}),H=void 0),z=z.concat(V),b(H,S.terrain)||z.push({command:je.setTerrain,args:[S.terrain]}),function(re,se,me){se=se||[];const ae=(re=re||[]).map(Pr),ue=se.map(Pr),Le=re.reduce(bi,{}),ye=se.reduce(bi,{}),Me=ae.slice(),Ae=Object.create(null);let Ne,He,We,lt,ut,It,ze;for(Ne=0,He=0;Ne<ae.length;Ne++)We=ae[Ne],ye.hasOwnProperty(We)?He++:(me.push({command:je.removeLayer,args:[We]}),Me.splice(Me.indexOf(We,He),1));for(Ne=0,He=0;Ne<ue.length;Ne++)We=ue[ue.length-1-Ne],Me[Me.length-1-Ne]!==We&&(Le.hasOwnProperty(We)?(me.push({command:je.removeLayer,args:[We]}),Me.splice(Me.lastIndexOf(We,Me.length-He),1)):He++,It=Me[Me.length-Ne],me.push({command:je.addLayer,args:[ye[We],It]}),Me.splice(Me.length-Ne,0,We),Ae[We]=!0);for(Ne=0;Ne<ue.length;Ne++)if(We=ue[Ne],lt=Le[We],ut=ye[We],!Ae[We]&&!b(lt,ut))if(b(lt.source,ut.source)&&b(lt["source-layer"],ut["source-layer"])&&b(lt.type,ut.type)){for(ze in jn(lt.layout,ut.layout,me,We,null,je.setLayoutProperty),jn(lt.paint,ut.paint,me,We,null,je.setPaintProperty),b(lt.filter,ut.filter)||me.push({command:je.setFilter,args:[We,ut.filter]}),b(lt.minzoom,ut.minzoom)&&b(lt.maxzoom,ut.maxzoom)||me.push({command:je.setLayerZoomRange,args:[We,ut.minzoom,ut.maxzoom]}),lt)lt.hasOwnProperty(ze)&&ze!=="layout"&&ze!=="paint"&&ze!=="filter"&&ze!=="metadata"&&ze!=="minzoom"&&ze!=="maxzoom"&&(ze.indexOf("paint.")===0?jn(lt[ze],ut[ze],me,We,ze.slice(6),je.setPaintProperty):b(lt[ze],ut[ze])||me.push({command:je.setLayerProperty,args:[We,ze,ut[ze]]}));for(ze in ut)ut.hasOwnProperty(ze)&&!lt.hasOwnProperty(ze)&&ze!=="layout"&&ze!=="paint"&&ze!=="filter"&&ze!=="metadata"&&ze!=="minzoom"&&ze!=="maxzoom"&&(ze.indexOf("paint.")===0?jn(lt[ze],ut[ze],me,We,ze.slice(6),je.setPaintProperty):b(lt[ze],ut[ze])||me.push({command:je.setLayerProperty,args:[We,ze,ut[ze]]}))}else me.push({command:je.removeLayer,args:[We]}),It=Me[Me.lastIndexOf(We)+1],me.push({command:je.addLayer,args:[ut,It]})}($,S.layers,z)}catch(B){console.warn("Unable to compute style diff:",B),z=[{command:je.setStyle,args:[S]}]}return z}(this.serialize(),t).filter(x=>!(x.command in na));if(s.length===0)return!1;const p=s.filter(x=>!(x.command in Pa));if(p.length>0)throw new Error(`Unimplemented: ${p.map(x=>x.command).join(", ")}.`);return s.forEach(x=>{x.command!=="setTransition"&&this[x.command].apply(this,x.args)}),this.stylesheet=t,!0}addImage(t,s){if(this.getImage(t))return this.fire(new n.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new n.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,p={}){if(this._checkLoaded(),this.getSource(t)!==void 0)throw new Error("There is already a source with this ID");if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(n.validateStyle.source,"sources."+t,s,null,p))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const x=Ie(t,s,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:x.serialize(),sourceId:t}));const S=z=>{const B=(z?"symbol:":"other:")+t,V=this._sourceCaches[B]=new n.SourceCache(B,x,z);(z?this._symbolSourceCaches:this._otherSourceCaches)[t]=V,V.style=this,V.onAdd(this.map)};S(!1),s.type!=="vector"&&s.type!=="geojson"||S(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const s=this.getSource(t);if(s===void 0)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===t)return this.fire(new n.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new n.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(t);for(const x of p)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new n.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){this._checkLoaded(),this.getSource(t).setData(s),this._changed=!0}getSource(t){const s=this._getSourceCache(t);return s&&s.getSource()}addLayer(t,s,p={}){this._checkLoaded();const x=t.id;if(this.getLayer(x))return void this.fire(new n.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let S;if(t.type==="custom"){if(fi(this,n.validateCustomStyleLayer(t)))return;S=n.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(x,t.source),t=n.clone$2(t),t=n.extend(t,{source:x})),this._validate(n.validateStyle.layer,"layers."+x,t,{arrayIndex:-1},p))return;S=n.createStyleLayer(t),this._validateLayer(S),S.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[S.id]=S.serialize(),this._updateLayerCount(S,!0)}const z=s?this._order.indexOf(s):this._order.length;if(s&&z===-1)return void this.fire(new n.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`)));this._order.splice(z,0,x),this._layerOrderChanged=!0,this._layers[x]=S;const B=this._getLayerSourceCache(S);if(this._removedLayers[x]&&S.source&&B&&S.type!=="custom"){const V=this._removedLayers[x];delete this._removedLayers[x],V.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",B.pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new n.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const p=this._order.indexOf(t);this._order.splice(p,1);const x=s?this._order.indexOf(s):this._order.length;s&&x===-1?this.fire(new n.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`))):(this._order.splice(x,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new n.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));s.setEventedParent(null),this._updateLayerCount(s,!1);const p=this._order.indexOf(t);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const s in this._layers)if(this._layers[s].type===t)return!0;return!1}setLayerZoomRange(t,s,p){this._checkLoaded();const x=this.getLayer(t);x?x.minzoom===s&&x.maxzoom===p||(s!=null&&(x.minzoom=s),p!=null&&(x.maxzoom=p),this._updateLayer(x)):this.fire(new n.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,s,p={}){this._checkLoaded();const x=this.getLayer(t);if(x){if(!b(x.filter,s))return s==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(n.validateStyle.filter,`layers.${x.id}.filter`,s,null,p)||(x.filter=n.clone$2(s),this._updateLayer(x)))}else this.fire(new n.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){return n.clone$2(this.getLayer(t).filter)}setLayoutProperty(t,s,p,x={}){this._checkLoaded();const S=this.getLayer(t);S?b(S.getLayoutProperty(s),p)||(S.setLayoutProperty(s,p,x),this._updateLayer(S)):this.fire(new n.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,s){const p=this.getLayer(t);if(p)return p.getLayoutProperty(s);this.fire(new n.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,s,p,x={}){this._checkLoaded();const S=this.getLayer(t);S?b(S.getPaintProperty(s),p)||(S.setPaintProperty(s,p,x)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new n.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const p=t.source,x=t.sourceLayer,S=this.getSource(p);if(S===void 0)return void this.fire(new n.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const z=S.type;if(z==="geojson"&&x)return void this.fire(new n.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(z==="vector"&&!x)return void this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided.")));const B=this._getSourceCaches(p);for(const V of B)V.setFeatureState(x,t.id,s)}removeFeatureState(t,s){this._checkLoaded();const p=t.source,x=this.getSource(p);if(x===void 0)return void this.fire(new n.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const S=x.type,z=S==="vector"?t.sourceLayer:void 0;if(S==="vector"&&!z)return void this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new n.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const B=this._getSourceCaches(p);for(const V of B)V.removeFeatureState(z,t.id,s)}getFeatureState(t){this._checkLoaded();const s=t.source,p=t.sourceLayer,x=this.getSource(s);if(x!==void 0){if(x.type!=="vector"||p)return t.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(s)[0].getFeatureState(p,t.id);this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new n.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return n.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const s in this._sourceCaches){const p=this._sourceCaches[s].getSource();t[p.id]||(t[p.id]=p.serialize())}return n.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t,layers:this._serializeLayers(this._order)},s=>s!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0;const s=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&s&&s.getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",s.pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=z=>this._layers[z].type==="fill-extrusion",p={},x=[];for(let z=this._order.length-1;z>=0;z--){const B=this._order[z];if(s(B)){p[B]=z;for(const V of t){const $=V[B];if($)for(const H of $)x.push(H)}}}x.sort((z,B)=>B.intersectionZ-z.intersectionZ);const S=[];for(let z=this._order.length-1;z>=0;z--){const B=this._order[z];if(s(B))for(let V=x.length-1;V>=0;V--){const $=x[V].feature;if(p[$.layer.id]<z)break;S.push($),x.pop()}else for(const V of t){const $=V[B];if($)for(const H of $)S.push(H.feature)}}return S}queryRenderedFeatures(t,s,p){s&&s.filter&&this._validate(n.validateStyle.filter,"queryRenderedFeatures.filter",s.filter,null,s);const x={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new n.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const V of s.layers){const $=this._layers[V];if(!$)return this.fire(new n.ErrorEvent(new Error(`The layer '${V}' does not exist in the map's style and cannot be queried for features.`))),[];x[$.source]=!0}}const S=[];s.availableImages=this._availableImages;const z=s&&s.layers?s.layers.some(V=>{const $=this.getLayer(V);return $&&$.is3D()}):this.has3DLayers(),B=un.createFromScreenPoints(t,p);for(const V in this._sourceCaches){const $=this._sourceCaches[V].getSource().id;s.layers&&!x[$]||S.push(Qe(this._sourceCaches[V],this._layers,this._serializedLayers,B,s,p,z,!!this.map._showQueryGeometry))}return this.placement&&S.push(function(V,$,H,re,se,me,ae){const ue={},Le=me.queryRenderedSymbols(re),ye=[];for(const Me of Object.keys(Le).map(Number))ye.push(ae[Me]);ye.sort(Ve);for(const Me of ye){const Ae=Me.featureIndex.lookupSymbolFeatures(Le[Me.bucketInstanceId],$,Me.bucketIndex,Me.sourceLayerIndex,se.filter,se.layers,se.availableImages,V);for(const Ne in Ae){const He=ue[Ne]=ue[Ne]||[],We=Ae[Ne];We.sort((lt,ut)=>{const It=Me.featureSortOrder;if(It){const ze=It.indexOf(lt.featureIndex);return It.indexOf(ut.featureIndex)-ze}return ut.featureIndex-lt.featureIndex});for(const lt of We)He.push(lt)}}for(const Me in ue)ue[Me].forEach(Ae=>{const Ne=Ae.feature,He=H(V[Me]).getFeatureState(Ne.layer["source-layer"],Ne.id);Ne.source=Ne.layer.source,Ne.layer["source-layer"]&&(Ne.sourceLayer=Ne.layer["source-layer"]),Ne.state=He});return ue}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),B.screenGeometry,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(t,s){s&&s.filter&&this._validate(n.validateStyle.filter,"querySourceFeatures.filter",s.filter,null,s);const p=this._getSourceCaches(t);let x=[];for(const S of p)x=x.concat(Ke(S,s));return x}addSourceType(t,s,p){return Bi.getSourceType(t)?p(new Error(`A source type called "${t}" already exists.`)):(Bi.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const p=this.light.getLight();let x=!1;for(const z in t)if(!b(t[z],p[z])){x=!0;break}if(!x)return;const S={now:n.exported.now(),transition:n.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(S)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(t){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(typeof t.source=="object"){const s="terrain-dem-src";this.addSource(s,t.source),t=n.clone$2(t),t=n.extend(t,{source:s})}if(!this._validate(n.validateStyle.terrain,"terrain",t)){if(this.terrain){const s=this.terrain,p=s.get();for(const x in t)if(!b(t[x],p[x])){s.set(t),this.stylesheet.terrain=t;const S={now:n.exported.now(),transition:n.extend({duration:0},this.stylesheet.transition)};s.updateTransitions(S);break}}else this._createTerrain(t);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(t){const s=this.fog=new mn(t);this.stylesheet.fog=t;const p={now:n.exported.now(),transition:n.extend({duration:0},this.stylesheet.transition)};s.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog,p=s.get();for(const x in t)if(!b(t[x],p[x])){s.set(t),this.stylesheet.fog=t;const S={now:n.exported.now(),transition:n.extend({duration:0},this.stylesheet.transition)};s.updateTransitions(S);break}}else this._createFog(t);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(p=>this.isLayerDraped(this._layers[p])),s=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...s)}_createTerrain(t){const s=this.terrain=new vt(t);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const p={now:n.exported.now(),transition:n.extend({duration:0},this.stylesheet.transition)};s.updateTransitions(p)}_force3DLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="fill-extrusion"&&this._updateLayer(s)}}_validate(t,s,p,x,S={}){return(!S||S.validate!==!1)&&fi(this,t.call(n.validateStyle,n.extend({key:s,style:this.serialize(),value:p,styleSpec:n.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const s=this._getSourceCaches(t);for(const p of s)p.clearTiles()}_reloadSource(t){const s=this._getSourceCaches(t);for(const p of s)p.resume(),p.reload()}_updateSources(t){for(const s in this._sourceCaches)this._sourceCaches[s].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const s=this._sourceCaches[t];s.resume(),s.reload()}}_updatePlacement(t,s,p,x,S=!1){let z=!1,B=!1;const V={};for(const $ of this._order){const H=this._layers[$];if(H.type!=="symbol")continue;if(!V[H.source]){const se=this._getLayerSourceCache(H);if(!se)continue;V[H.source]=se.getRenderableIds(!0).map(me=>se.getTileByID(me)).sort((me,ae)=>ae.tileID.overscaledZ-me.tileID.overscaledZ||(me.tileID.isLessThan(ae.tileID)?-1:1))}const re=this.crossTileSymbolIndex.addLayer(H,V[H.source],t.center.lng);z=z||re}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),S=S||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new n.Event("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.exported.now(),t.zoom))&&(this.pauseablePlacement=new ea(t,this._order,S,s,p,x,this.placement,this.fog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,V),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.exported.now()),B=!0),z&&this.pauseablePlacement.placement.setStale()),B||z)for(const $ of this._order){const H=this._layers[$];H.type==="symbol"&&this.placement.updateLayerOpacities(H,V[H.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s,p){this.imageManager.getImages(s.icons,p),this._updateTilesForChangedImages();const x=S=>{S&&S.setDependencies(s.tileID.key,s.type,s.icons)};x(this._otherSourceCaches[s.source]),x(this._symbolSourceCaches[s.source])}getGlyphs(t,s,p){this.glyphManager.getGlyphs(s.stacks,p)}getResource(t,s,p){return n.makeRequest(s,p)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const s=[];return this._otherSourceCaches[t]&&s.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&s.push(this._symbolSourceCaches[t]),s}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}}Bi.getSourceType=function(d){return xe[d]},Bi.setSourceType=function(d,t){xe[d]=t},Bi.registerForPluginStateChange=n.registerForPluginStateChange;var Ps=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,ra="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let ss={},Ao={};ss=Nn("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef TERRAIN
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}float prevElevation(vec2 apos) {float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),Ao=Nn(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const ia=Nn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),ji=Ps;var Cs={background:Nn(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Nn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Nn(`varying vec3 v_data;varying float v_visibility;
#pragma vjmaps: define highp vec4 color
#pragma vjmaps: define mediump float radius
#pragma vjmaps: define lowp float blur
#pragma vjmaps: define lowp float opacity
#pragma vjmaps: define highp vec4 stroke_color
#pragma vjmaps: define mediump float stroke_width
#pragma vjmaps: define lowp float stroke_opacity
void main() {
#pragma vjmaps: initialize highp vec4 color
#pragma vjmaps: initialize mediump float radius
#pragma vjmaps: initialize lowp float blur
#pragma vjmaps: initialize lowp float opacity
#pragma vjmaps: initialize highp vec4 stroke_color
#pragma vjmaps: initialize mediump float stroke_width
#pragma vjmaps: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma vjmaps: define highp vec4 color
#pragma vjmaps: define mediump float radius
#pragma vjmaps: define lowp float blur
#pragma vjmaps: define lowp float opacity
#pragma vjmaps: define highp vec4 stroke_color
#pragma vjmaps: define mediump float stroke_width
#pragma vjmaps: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma vjmaps: initialize highp vec4 color
#pragma vjmaps: initialize mediump float radius
#pragma vjmaps: initialize lowp float blur
#pragma vjmaps: initialize lowp float opacity
#pragma vjmaps: initialize highp vec4 stroke_color
#pragma vjmaps: initialize mediump float stroke_width
#pragma vjmaps: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Nn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Nn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma vjmaps: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma vjmaps: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma vjmaps: define highp float weight
#pragma vjmaps: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma vjmaps: initialize highp float weight
#pragma vjmaps: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec3 pos=vec3(floor(a_pos*0.5)+extrude,elevation(floor(a_pos*0.5)));gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Nn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Nn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=u_matrix*vec4(a_pos,elevation(a_pos),1.0);gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Nn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Nn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:Nn(`#pragma vjmaps: define highp vec4 color
#pragma vjmaps: define lowp float opacity
void main() {
#pragma vjmaps: initialize highp vec4 color
#pragma vjmaps: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma vjmaps: define highp vec4 color
#pragma vjmaps: define lowp float opacity
void main() {
#pragma vjmaps: initialize highp vec4 color
#pragma vjmaps: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Nn(`varying vec2 v_pos;
#pragma vjmaps: define highp vec4 outline_color
#pragma vjmaps: define lowp float opacity
void main() {
#pragma vjmaps: initialize highp vec4 outline_color
#pragma vjmaps: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma vjmaps: define highp vec4 outline_color
#pragma vjmaps: define lowp float opacity
void main() {
#pragma vjmaps: initialize highp vec4 outline_color
#pragma vjmaps: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Nn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma vjmaps: define lowp float opacity
#pragma vjmaps: define lowp vec4 pattern_from
#pragma vjmaps: define lowp vec4 pattern_to
void main() {
#pragma vjmaps: initialize lowp float opacity
#pragma vjmaps: initialize mediump vec4 pattern_from
#pragma vjmaps: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma vjmaps: define lowp float opacity
#pragma vjmaps: define lowp vec4 pattern_from
#pragma vjmaps: define lowp vec4 pattern_to
#pragma vjmaps: define lowp float pixel_ratio_from
#pragma vjmaps: define lowp float pixel_ratio_to
void main() {
#pragma vjmaps: initialize lowp float opacity
#pragma vjmaps: initialize mediump vec4 pattern_from
#pragma vjmaps: initialize mediump vec4 pattern_to
#pragma vjmaps: initialize lowp float pixel_ratio_from
#pragma vjmaps: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Nn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma vjmaps: define lowp float opacity
#pragma vjmaps: define lowp vec4 pattern_from
#pragma vjmaps: define lowp vec4 pattern_to
void main() {
#pragma vjmaps: initialize lowp float opacity
#pragma vjmaps: initialize mediump vec4 pattern_from
#pragma vjmaps: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma vjmaps: define lowp float opacity
#pragma vjmaps: define lowp vec4 pattern_from
#pragma vjmaps: define lowp vec4 pattern_to
#pragma vjmaps: define lowp float pixel_ratio_from
#pragma vjmaps: define lowp float pixel_ratio_to
void main() {
#pragma vjmaps: initialize lowp float opacity
#pragma vjmaps: initialize mediump vec4 pattern_from
#pragma vjmaps: initialize mediump vec4 pattern_to
#pragma vjmaps: initialize lowp float pixel_ratio_from
#pragma vjmaps: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Nn(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;
#pragma vjmaps: define highp float base
#pragma vjmaps: define highp float height
#pragma vjmaps: define highp vec4 color
void main() {
#pragma vjmaps: initialize highp float base
#pragma vjmaps: initialize highp float height
#pragma vjmaps: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;
#ifdef TERRAIN
vec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);gl_Position=u_matrix*vec4(pos,1);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Nn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma vjmaps: define lowp float base
#pragma vjmaps: define lowp float height
#pragma vjmaps: define lowp vec4 pattern_from
#pragma vjmaps: define lowp vec4 pattern_to
#pragma vjmaps: define lowp float pixel_ratio_from
#pragma vjmaps: define lowp float pixel_ratio_to
void main() {
#pragma vjmaps: initialize lowp float base
#pragma vjmaps: initialize lowp float height
#pragma vjmaps: initialize mediump vec4 pattern_from
#pragma vjmaps: initialize mediump vec4 pattern_to
#pragma vjmaps: initialize lowp float pixel_ratio_from
#pragma vjmaps: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma vjmaps: define lowp float base
#pragma vjmaps: define lowp float height
#pragma vjmaps: define lowp vec4 pattern_from
#pragma vjmaps: define lowp vec4 pattern_to
#pragma vjmaps: define lowp float pixel_ratio_from
#pragma vjmaps: define lowp float pixel_ratio_to
void main() {
#pragma vjmaps: initialize lowp float base
#pragma vjmaps: initialize lowp float height
#pragma vjmaps: initialize mediump vec4 pattern_from
#pragma vjmaps: initialize mediump vec4 pattern_to
#pragma vjmaps: initialize lowp float pixel_ratio_from
#pragma vjmaps: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;
#ifdef TERRAIN
vec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);
#else
vec3 p=vec3(pos_nx.xy,z);gl_Position=u_matrix*vec4(p,1);
#endif
vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Nn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Nn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Nn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma vjmaps: define highp vec4 color
#pragma vjmaps: define lowp float blur
#pragma vjmaps: define lowp float opacity
void main() {
#pragma vjmaps: initialize highp vec4 color
#pragma vjmaps: initialize lowp float blur
#pragma vjmaps: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#pragma vjmaps: define highp vec4 color
#pragma vjmaps: define lowp float blur
#pragma vjmaps: define lowp float opacity
#pragma vjmaps: define mediump float gapwidth
#pragma vjmaps: define lowp float offset
#pragma vjmaps: define mediump float width
void main() {
#pragma vjmaps: initialize highp vec4 color
#pragma vjmaps: initialize lowp float blur
#pragma vjmaps: initialize lowp float opacity
#pragma vjmaps: initialize mediump float gapwidth
#pragma vjmaps: initialize lowp float offset
#pragma vjmaps: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),lineGradient:Nn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma vjmaps: define lowp float blur
#pragma vjmaps: define lowp float opacity
void main() {
#pragma vjmaps: initialize lowp float blur
#pragma vjmaps: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma vjmaps: define lowp float blur
#pragma vjmaps: define lowp float opacity
#pragma vjmaps: define mediump float gapwidth
#pragma vjmaps: define lowp float offset
#pragma vjmaps: define mediump float width
void main() {
#pragma vjmaps: initialize lowp float blur
#pragma vjmaps: initialize lowp float opacity
#pragma vjmaps: initialize mediump float gapwidth
#pragma vjmaps: initialize lowp float offset
#pragma vjmaps: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Nn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma vjmaps: define lowp vec4 pattern_from
#pragma vjmaps: define lowp vec4 pattern_to
#pragma vjmaps: define lowp float pixel_ratio_from
#pragma vjmaps: define lowp float pixel_ratio_to
#pragma vjmaps: define lowp float blur
#pragma vjmaps: define lowp float opacity
void main() {
#pragma vjmaps: initialize mediump vec4 pattern_from
#pragma vjmaps: initialize mediump vec4 pattern_to
#pragma vjmaps: initialize lowp float pixel_ratio_from
#pragma vjmaps: initialize lowp float pixel_ratio_to
#pragma vjmaps: initialize lowp float blur
#pragma vjmaps: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma vjmaps: define lowp float blur
#pragma vjmaps: define lowp float opacity
#pragma vjmaps: define lowp float offset
#pragma vjmaps: define mediump float gapwidth
#pragma vjmaps: define mediump float width
#pragma vjmaps: define lowp float floorwidth
#pragma vjmaps: define lowp vec4 pattern_from
#pragma vjmaps: define lowp vec4 pattern_to
#pragma vjmaps: define lowp float pixel_ratio_from
#pragma vjmaps: define lowp float pixel_ratio_to
void main() {
#pragma vjmaps: initialize lowp float blur
#pragma vjmaps: initialize lowp float opacity
#pragma vjmaps: initialize lowp float offset
#pragma vjmaps: initialize mediump float gapwidth
#pragma vjmaps: initialize mediump float width
#pragma vjmaps: initialize lowp float floorwidth
#pragma vjmaps: initialize mediump vec4 pattern_from
#pragma vjmaps: initialize mediump vec4 pattern_to
#pragma vjmaps: initialize lowp float pixel_ratio_from
#pragma vjmaps: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),lineSDF:Nn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma vjmaps: define highp vec4 color
#pragma vjmaps: define lowp float blur
#pragma vjmaps: define lowp float opacity
#pragma vjmaps: define mediump float width
#pragma vjmaps: define lowp float floorwidth
#pragma vjmaps: define lowp vec4 dash_from
#pragma vjmaps: define lowp vec4 dash_to
void main() {
#pragma vjmaps: initialize highp vec4 color
#pragma vjmaps: initialize lowp float blur
#pragma vjmaps: initialize lowp float opacity
#pragma vjmaps: initialize mediump float width
#pragma vjmaps: initialize lowp float floorwidth
#pragma vjmaps: initialize mediump vec4 dash_from
#pragma vjmaps: initialize mediump vec4 dash_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma vjmaps: define highp vec4 color
#pragma vjmaps: define lowp float blur
#pragma vjmaps: define lowp float opacity
#pragma vjmaps: define mediump float gapwidth
#pragma vjmaps: define lowp float offset
#pragma vjmaps: define mediump float width
#pragma vjmaps: define lowp float floorwidth
#pragma vjmaps: define lowp vec4 dash_from
#pragma vjmaps: define lowp vec4 dash_to
void main() {
#pragma vjmaps: initialize highp vec4 color
#pragma vjmaps: initialize lowp float blur
#pragma vjmaps: initialize lowp float opacity
#pragma vjmaps: initialize mediump float gapwidth
#pragma vjmaps: initialize lowp float offset
#pragma vjmaps: initialize mediump float width
#pragma vjmaps: initialize lowp float floorwidth
#pragma vjmaps: initialize mediump vec4 dash_from
#pragma vjmaps: initialize mediump vec4 dash_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float widthA=dash_from.z*fromScale;float widthB=dash_to.z*toScale;float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*(tileZoomRatio/widthA)/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*(tileZoomRatio/widthB)/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Nn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Nn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma vjmaps: define lowp float opacity
void main() {
#pragma vjmaps: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma vjmaps: define lowp float opacity
void main() {
#pragma vjmaps: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));}`),symbolSDF:Nn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma vjmaps: define highp vec4 fill_color
#pragma vjmaps: define highp vec4 halo_color
#pragma vjmaps: define lowp float opacity
#pragma vjmaps: define lowp float halo_width
#pragma vjmaps: define lowp float halo_blur
void main() {
#pragma vjmaps: initialize highp vec4 fill_color
#pragma vjmaps: initialize highp vec4 halo_color
#pragma vjmaps: initialize lowp float opacity
#pragma vjmaps: initialize lowp float halo_width
#pragma vjmaps: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma vjmaps: define highp vec4 fill_color
#pragma vjmaps: define highp vec4 halo_color
#pragma vjmaps: define lowp float opacity
#pragma vjmaps: define lowp float halo_width
#pragma vjmaps: define lowp float halo_blur
void main() {
#pragma vjmaps: initialize highp vec4 fill_color
#pragma vjmaps: initialize highp vec4 halo_color
#pragma vjmaps: initialize lowp float opacity
#pragma vjmaps: initialize lowp float halo_width
#pragma vjmaps: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Nn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma vjmaps: define highp vec4 fill_color
#pragma vjmaps: define highp vec4 halo_color
#pragma vjmaps: define lowp float opacity
#pragma vjmaps: define lowp float halo_width
#pragma vjmaps: define lowp float halo_blur
void main() {
#pragma vjmaps: initialize highp vec4 fill_color
#pragma vjmaps: initialize highp vec4 halo_color
#pragma vjmaps: initialize lowp float opacity
#pragma vjmaps: initialize lowp float halo_width
#pragma vjmaps: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma vjmaps: define highp vec4 fill_color
#pragma vjmaps: define highp vec4 halo_color
#pragma vjmaps: define lowp float opacity
#pragma vjmaps: define lowp float halo_width
#pragma vjmaps: define lowp float halo_blur
void main() {
#pragma vjmaps: initialize highp vec4 fill_color
#pragma vjmaps: initialize highp vec4 halo_color
#pragma vjmaps: initialize lowp float opacity
#pragma vjmaps: initialize lowp float halo_width
#pragma vjmaps: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrainRaster:Nn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:Nn(`#ifdef GL_ES
precision highp float;
#endif
vec4 pack_depth(float ndc_z) {float depth=ndc_z*0.5+0.5;const vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Nn(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ra),skyboxGradient:Nn(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform lowp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ra),skyboxCapture:Nn(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}")};function Nn(d,t,s){const p=/#pragma vjmaps: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,x=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,S=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),z=d.match(x),B=t.match(x),V=Ps.match(x);let $=B?B.concat(z):z;s||(ss.staticUniforms&&($=ss.staticUniforms.concat($)),Ao.staticUniforms&&($=Ao.staticUniforms.concat($))),$&&($=$.concat(V));const H={};return{fragmentSource:d=d.replace(p,(re,se,me,ae,ue)=>(H[ue]=!0,se==="define"?`
#ifndef HAS_UNIFORM_u_${ue}
varying ${me} ${ae} ${ue};
#else
uniform ${me} ${ae} u_${ue};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ue}
    ${me} ${ae} ${ue} = u_${ue};
#endif
`)),vertexSource:t=t.replace(p,(re,se,me,ae,ue)=>{const Le=ae==="float"?"vec2":"vec4",ye=ue.match(/color/)?"color":Le;return H[ue]?se==="define"?`
#ifndef HAS_UNIFORM_u_${ue}
uniform lowp float u_${ue}_t;
attribute ${me} ${Le} a_${ue};
varying ${me} ${ae} ${ue};
#else
uniform ${me} ${ae} u_${ue};
#endif
`:ye==="vec4"?`
#ifndef HAS_UNIFORM_u_${ue}
    ${ue} = a_${ue};
#else
    ${me} ${ae} ${ue} = u_${ue};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ue}
    ${ue} = unpack_mix_${ye}(a_${ue}, u_${ue}_t);
#else
    ${me} ${ae} ${ue} = u_${ue};
#endif
`:se==="define"?`
#ifndef HAS_UNIFORM_u_${ue}
uniform lowp float u_${ue}_t;
attribute ${me} ${Le} a_${ue};
#else
uniform ${me} ${ae} u_${ue};
#endif
`:ye==="vec4"?`
#ifndef HAS_UNIFORM_u_${ue}
    ${me} ${ae} ${ue} = a_${ue};
#else
    ${me} ${ae} ${ue} = u_${ue};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ue}
    ${me} ${ae} ${ue} = unpack_mix_${ye}(a_${ue}, u_${ue}_t);
#else
    ${me} ${ae} ${ue} = u_${ue};
#endif
`}),staticAttributes:S,staticUniforms:$}}class fo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,p,x,S,z,B,V){this.context=t;let $=this.boundPaintVertexBuffers.length!==x.length;for(let H=0;!$&&H<x.length;H++)this.boundPaintVertexBuffers[H]!==x[H]&&($=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===s&&this.boundLayoutVertexBuffer===p&&!$&&this.boundIndexBuffer===S&&this.boundVertexOffset===z&&this.boundDynamicVertexBuffer===B&&this.boundDynamicVertexBuffer2===V?(t.bindVertexArrayOES.set(this.vao),B&&B.bind(),S&&S.dynamicDraw&&S.bind(),V&&V.bind()):this.freshBind(s,p,x,S,z,B,V)}freshBind(t,s,p,x,S,z,B){let V;const $=t.numAttributes,H=this.context,re=H.gl;if(H.extVertexArrayObject)this.vao&&this.destroy(),this.vao=H.extVertexArrayObject.createVertexArrayOES(),H.bindVertexArrayOES.set(this.vao),V=0,this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=x,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=z,this.boundDynamicVertexBuffer2=B;else{V=H.currentNumAttributes||0;for(let se=$;se<V;se++)re.disableVertexAttribArray(se)}s.enableAttributes(re,t);for(const se of p)se.enableAttributes(re,t);z&&z.enableAttributes(re,t),B&&B.enableAttributes(re,t),s.bind(),s.setVertexAttribPointers(re,t,S);for(const se of p)se.bind(),se.setVertexAttribPointers(re,t,S);z&&(z.bind(),z.setVertexAttribPointers(re,t,S)),x&&x.bind(),B&&(B.bind(),B.setVertexAttribPointers(re,t,S)),H.currentNumAttributes=$}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function mo(d,t){const s=Math.pow(2,t.canonical.z),p=t.canonical.y;return[new n.MercatorCoordinate(0,p/s).toLngLat().lat,new n.MercatorCoordinate(0,(p+1)/s).toLngLat().lat]}function As(d,t,s,p,x,S,z){const B=d.context,V=B.gl,$=s.fbo;if(!$)return;d.prepareDrawTile(t);const H=d.useProgram("hillshade");B.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,$.colorAttachment.get());const re=((se,me,ae,ue)=>{const Le=ae.paint.get("hillshade-shadow-color"),ye=ae.paint.get("hillshade-highlight-color"),Me=ae.paint.get("hillshade-accent-color");let Ae=ae.paint.get("hillshade-illumination-direction")*(Math.PI/180);ae.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ae-=se.transform.angle);const Ne=!se.options.moving;return{u_matrix:ue||se.transform.calculateProjMatrix(me.tileID.toUnwrapped(),Ne),u_image:0,u_latrange:mo(0,me.tileID),u_light:[ae.paint.get("hillshade-exaggeration"),Ae],u_shadow:Le,u_highlight:ye,u_accent:Me}})(d,s,p,d.terrain?t.projMatrix:null);d.prepareDrawProgram(B,H,t.toUnwrapped()),H.draw(B,V.TRIANGLES,x,S,z,n.CullFaceMode.disabled,re,p.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}function as(d,t,s){if(!t.needsDEMTextureUpload)return;const p=d.context,x=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||d.getTileTexture(s.stride);const S=s.getPixels();t.demTexture?t.demTexture.update(S,{premultiply:!1}):t.demTexture=new n.Texture(p,S,x.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Ui(d,t,s,p,x,S){const z=d.context,B=z.gl;if(!t.dem)return;const V=t.dem;if(z.activeTexture.set(B.TEXTURE1),as(d,t,V),!t.demTexture)return;t.demTexture.bind(B.NEAREST,B.CLAMP_TO_EDGE);const $=V.dim;z.activeTexture.set(B.TEXTURE0);let H=t.fbo;if(!H){const re=new n.Texture(z,{width:$,height:$,data:null},B.RGBA);re.bind(B.LINEAR,B.CLAMP_TO_EDGE),H=t.fbo=z.createFramebuffer($,$,!0),H.colorAttachment.set(re.texture)}z.bindFramebuffer.set(H.framebuffer),z.viewport.set([0,0,$,$]),d.useProgram("hillshadePrepare").draw(z,B.TRIANGLES,p,x,S,n.CullFaceMode.disabled,((re,se)=>{const me=se.stride,ae=n.create$1();return n.ortho(ae,0,n.EXTENT,-n.EXTENT,0,0,1),n.translate(ae,ae,[0,-n.EXTENT,0]),{u_matrix:ae,u_image:1,u_dimension:[me,me],u_zoom:re.overscaledZ,u_unpack:se.unpackVector}})(t.tileID,V),s.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments),t.needsHillshadePrepare=!1}const Xn=(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_image0:new n.Uniform1i(d,t.u_image0),u_skirt_height:new n.Uniform1f(d,t.u_skirt_height)}),Qi=(d,t)=>({u_matrix:d,u_image0:0,u_skirt_height:t}),ks=new class{constructor(){this.operations={}}newMorphing(d,t,s,p,x){if(d in this.operations){const S=this.operations[d];S.to.tileID.key!==s.tileID.key&&(S.queued=s)}else this.operations[d]={startTime:p,phase:0,duration:x,from:t,to:s,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const t=this.operations[d];return{from:t.from,to:t.to,phase:t.phase}}update(d){for(const t in this.operations){const s=this.operations[t];for(s.phase=(d-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,d)){delete this.operations[t];break}}}_nextOp(d,t){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=t,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},oa={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Ni(d,t,s,p,x){const S=d.context,z=S.gl;let B,V;const $=d.options.showTerrainWireframe?2:0,H=(ue,Le)=>{if(V===ue)return;const ye=[oa[ue]];Le&&ye.push(oa[$]),B=d.useProgram("terrainRaster",null,ye),V=ue},re=d.colorModeForRenderPass(),se=new n.DepthMode(z.LEQUAL,n.DepthMode.ReadWrite,d.depthRangeFor3D);ks.update(x);const me=d.transform,ae=6*Math.pow(1.5,22-me.zoom)*t.exaggeration();($?[!1,!0]:[!1]).forEach(ue=>{V=-1;const Le=ue?z.LINES:z.TRIANGLES,[ye,Me]=ue?t.getWirefameBuffer():[t.gridIndexBuffer,t.gridSegments];for(const He of p){const We=s.getTile(He),lt=n.StencilMode.disabled,ut=t.prevTerrainTileForTile[He.key],It=t.terrainTileForTile[He.key];Ne=It,(Ae=ut)!=null&&Ne!=null&&Ae.hasData()&&Ne.hasData()&&Ae.demTexture!=null&&Ne.demTexture!=null&&Ae.tileID.key!==Ne.tileID.key&&ks.newMorphing(He.key,ut,It,x,250),S.activeTexture.set(z.TEXTURE0),We.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const ze=ks.getMorphValuesForProxy(He.key),Gt=ze?1:0;let Lt;ze&&(Lt={morphing:{srcDemTile:ze.from,dstDemTile:ze.to,phase:n.easeCubicInOut(ze.phase)}});const pn=Qi(He.projMatrix,sa(He.canonical,me.renderWorldCopies)?ae/10:ae);H(Gt,ue),t.setupElevationDraw(We,B,Lt),d.prepareDrawProgram(S,B,He.toUnwrapped()),B.draw(S,Le,se,lt,re,n.CullFaceMode.backCCW,pn,"terrain_raster",t.gridBuffer,ye,Me)}var Ae,Ne})}function sa(d,t){const s=1<<d.z;return!t&&(d.x===0||d.x===s-1)||d.y===0||d.y===s-1}const ls=d=>({u_matrix:d});function Ls(d,t,s,p,x){if(x>0){const S=n.exported.now(),z=(S-d.timeAdded)/x,B=t?(S-t.timeAdded)/x:-1,V=s.getSource(),$=p.coveringZoomLevel({tileSize:V.tileSize,roundZoom:V.roundZoom}),H=!t||Math.abs(t.tileID.overscaledZ-$)>Math.abs(d.tileID.overscaledZ-$),re=H&&d.refreshedUponExpiration?1:n.clamp(H?z:1-B,0,1);return d.refreshedUponExpiration&&z>=1&&(d.refreshedUponExpiration=!1),t?{opacity:1,mix:1-re}:{opacity:re,mix:0}}return{opacity:1,mix:0}}class cs extends n.SourceCache{constructor(t){const s=Ie("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new cn(Xt(),null),t.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,s,p){if(t.freezeTileCoverage)return;this.transform=t;const x=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((S,z)=>{if(S[z.key]="",!this._tiles[z.key]){const B=new n.Tile(z,this._source.tileSize*z.overscaleFactor(),t.tileZoom);B.state="loaded",this._tiles[z.key]=B}return S},{});for(const S in this._tiles)S in x||(this.freeFBO(S),this._tiles[S].state="unloaded",delete this._tiles[S])}freeFBO(t){const s=this.proxyCachedFBO[t];if(s!==void 0){const p=Object.values(s);this.renderCachePool.push(...p),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ko extends n.OverscaledTileID{constructor(t,s,p){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=s,this.projMatrix=p}}class Qa extends n.Elevation{constructor(t,s){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,x,S]=function(V){const $=new n.StructArrayLayout4i8,H=new n.StructArrayLayout3ui6,re=131;$.reserve(17161),H.reserve(33800);const se=n.EXTENT/128,me=n.EXTENT+se/2,ae=me+se;for(let Le=-se;Le<ae;Le+=se)for(let ye=-se;ye<ae;ye+=se){const Me=ye<0||ye>me||Le<0||Le>me?24575:0,Ae=n.clamp(Math.round(ye),0,n.EXTENT),Ne=n.clamp(Math.round(Le),0,n.EXTENT);$.emplaceBack(Ae+Me,Ne,Ae,Ne)}const ue=(Le,ye)=>{const Me=ye*re+Le;H.emplaceBack(Me+1,Me,Me+re),H.emplaceBack(Me+re,Me+re+1,Me+1)};for(let Le=1;Le<129;Le++)for(let ye=1;ye<129;ye++)ue(ye,Le);return[0,129].forEach(Le=>{for(let ye=0;ye<130;ye++)ue(ye,Le),ue(Le,ye)}),[$,H,32768]}(),z=t.context;this.gridBuffer=z.createVertexBuffer(p,X.members),this.gridIndexBuffer=z.createIndexBuffer(x),this.gridSegments=n.SegmentVector.simpleSegment(0,0,p.length,x.length),this.gridNoSkirtSegments=n.SegmentVector.simpleSegment(0,0,p.length,S),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new cs(s.map),this.orthoMatrix=n.create$1(),n.ortho(this.orthoMatrix,0,n.EXTENT,0,n.EXTENT,0,1);const B=z.gl;this._overlapStencilMode=new n.StencilMode({func:B.GEQUAL,mask:255},0,255,B.KEEP,B.KEEP,B.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(t,s,p){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const x=t.terrain.properties;this.sourceCache=t._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const S=()=>{this.sourceCache.used&&n.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const z=this.sourceCache.getSource().tileSize/128,B=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(s,z*B,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,S(),this._initializing=!0),S(),s.updateElevation(!p),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||t.efficiency!==100&&n.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(n.MercatorCoordinate.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=s.getIds().map(V=>{const $=s.getTileByID(V).tileID;return $.projMatrix=p.calculateProjMatrix($.toUnwrapped()),$});(function(V,$){const H=$.transform.pointCoordinate($.transform.getCameraPoint()),re=new n.pointGeometry(H.x,H.y);V.sort((se,me)=>{if(me.overscaledZ-se.overscaledZ)return me.overscaledZ-se.overscaledZ;const ae=new n.pointGeometry(se.canonical.x+(1<<se.canonical.z)*se.wrap,se.canonical.y),ue=new n.pointGeometry(me.canonical.x+(1<<me.canonical.z)*me.wrap,me.canonical.y),Le=re.mult(1<<se.canonical.z);return Le.x-=.5,Le.y-=.5,Le.distSqr(ae)-Le.distSqr(ue)})})(x,this.painter),this._previousZoom=p.zoom;const S=this.proxyToSource||{};this.proxyToSource={},x.forEach(V=>{this.proxyToSource[V.key]={}}),this.terrainTileForTile={};const z=this._style._sourceCaches;for(const V in z){const $=z[V];if(!$.used||($!==this.sourceCache&&(this._findCoveringTileCache[$.id]={}),this._setupProxiedCoordsForOrtho($,t[V],S),$.usedForTerrain))continue;const H=t[V];$.getSource().reparseOverscaled&&this._assignTerrainTiles(H)}this.proxiedCoords[s.id]=x.map(V=>new ko(V,V.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(S),this.renderingToTexture=!1,this._updateTimestamp=n.exported.now();const B={};this._visibleDemTiles=[];for(const V of this.proxyCoords){const $=this.terrainTileForTile[V.key];if(!$)continue;const H=$.tileID.key;H in B||(this._visibleDemTiles.push($),B[H]=H)}}_assignTerrainTiles(t){this._initializing||t.forEach(s=>{if(this.terrainTileForTile[s.key])return;const p=this._findTileCoveringTileID(s,this.sourceCache);p&&(this.terrainTileForTile[s.key]=p)})}_prepareDEMTextures(){const t=this.painter.context,s=t.gl;for(const p in this.terrainTileForTile){const x=this.terrainTileForTile[p],S=x.dem;!S||x.demTexture&&!x.needsDEMTextureUpload||(t.activeTexture.set(s.TEXTURE1),as(this.painter,x,S))}}_prepareDemTileUniforms(t,s,p,x){if(!s||s.demTexture==null)return!1;const S=t.tileID.canonical,z=Math.pow(2,s.tileID.canonical.z-S.z),B=x||"";return p["u_dem_tl"+B]=[S.x*z%1,S.y*z%1],p["u_dem_scale"+B]=z,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let t=0;const s=this._visibleDemTiles.reduce((p,x)=>{if(!x.dem)return p;const S=x.dem.tree.minimums[0];return S>0&&t++,p+S},0);return t?s/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,s=t.gl;t.activeTexture.set(s.TEXTURE2);const p=this._getLoadedAreaMinimum(),x={width:1,height:1,data:new Uint8Array(n.DEMData.pack(p,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(x,{premultiply:!1}):S=this._emptyDEMTexture=new n.Texture(t,x,s.RGBA,{premultiply:!1}),S}setupElevationDraw(t,s,p){const x=this.painter.context,S=x.gl,z=(B=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:n.DEMData.getUnpackVector(B),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var B;z.u_dem_size=this.sourceCache.getSource().tileSize,z.u_exaggeration=this.exaggeration();let V=null,$=null,H=1;if(p&&p.morphing&&this._useVertexMorphing){const re=p.morphing.srcDemTile,se=p.morphing.dstDemTile;H=p.morphing.phase,re&&se&&(this._prepareDemTileUniforms(t,re,z,"_prev")&&($=re),this._prepareDemTileUniforms(t,se,z)&&(V=se))}if($&&V?(x.activeTexture.set(S.TEXTURE2),V.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE,S.NEAREST),x.activeTexture.set(S.TEXTURE4),$.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE,S.NEAREST),z.u_dem_lerp=H):(V=this.terrainTileForTile[t.tileID.key],x.activeTexture.set(S.TEXTURE2),(this._prepareDemTileUniforms(t,V,z)?V.demTexture:this.emptyDEMTexture).bind(S.NEAREST,S.CLAMP_TO_EDGE,S.NEAREST)),p&&p.useDepthForOcclusion&&(x.activeTexture.set(S.TEXTURE3),this._depthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE,S.NEAREST),z.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),p&&p.useMeterToDem&&V){const re=(1<<V.tileID.canonical.z)*n.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;z.u_meter_to_dem=re}p&&p.labelPlaneMatrixInv&&(z.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),s.setTerrainUniformValues(x,z)}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const s=this.painter,p=this.painter.context,x=this.proxySourceCache,S=this.proxiedCoords[x.id],z=()=>{p.bindFramebuffer.set(null),p.viewport.set([0,0,s.width,s.height]),this.renderingToTexture=!1},B=this._drapedRenderBatches.shift();let V=[];const $=s.style.order;let H=0;for(let re=0;re<S.length;re++){const se=S[re],me=x.getTileByID(se.proxyTileKey),ae=x.proxyCachedFBO[se.key]?x.proxyCachedFBO[se.key][t]:void 0;let ue,Le;if(ue=this.currentFBO=ae!==void 0?x.renderCache[ae]:this.pool[H++],me.texture=ue.tex,ae===void 0||ue.dirty){p.bindFramebuffer.set(ue.fb.framebuffer),this.renderedToTile=!1,ue.dirty&&(p.clear({color:n.Color.transparent}),ue.dirty=!1);for(let ye=B.start;ye<=B.end;++ye){const Me=s.style._layers[$[ye]];if(Me.isHidden(s.transform.zoom))continue;const Ae=s.style._getLayerSourceCache(Me),Ne=Ae?this.proxyToSource[se.key][Ae.id]:[se];if(!Ne)continue;const He=Ne;p.viewport.set([0,0,ue.fb.width,ue.fb.height]),Le!==(Ae?Ae.id:null)&&(this._setupStencil(Ne,Me,Ae),Le=Ae?Ae.id:null),s.renderLayer(s,Ae,Me,He)}ue.dirty=this.renderedToTile,this.renderedToTile&&V.push(me.tileID),H===5&&(H=0,V.length>0&&(z(),Ni(s,this,x,V,this._updateTimestamp),this.renderingToTexture=!0,V=[]))}else V.push(me.tileID)}return z(),V.length>0&&Ni(s,this,x,V,this._updateTimestamp),B.end+1}postRender(){}renderCacheEfficiency(t){const s=t.order.length;if(s===0)return{efficiency:100};let p,x=0,S=0,z=!1;for(let B=0;B<s;++B){const V=t._layers[t.order[B]];this._style.isLayerDraped(V)?(z&&++x,++S):z||(z=!0,p=V.id)}return S===0?{efficiency:100}:{efficiency:100*(1-x/S),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{t=Math.min(t,s.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,s,p){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(S=>S.dem).map(S=>{const z=S.tileID,B=Math.pow(2,z.overscaledZ),{x:V,y:$}=z.canonical,H=V/B,re=(V+1)/B,se=$/B,me=($+1)/B;return{minx:H,miny:se,maxx:re,maxy:me,t:S.dem.tree.raycastRoot(H,se,re,me,t,s,p),tile:S}});x.sort((S,z)=>(S.t!==null?S.t:Number.MAX_VALUE)-(z.t!==null?z.t:Number.MAX_VALUE));for(const S of x){if(S.t==null)return null;const z=S.tile.dem.tree.raycast(S.minx,S.miny,S.maxx,S.maxy,t,s,p);if(z!=null)return z}return null}_createFBO(){const t=this.painter.context,s=t.gl,p=this.drapeBufferSize;t.activeTexture.set(s.TEXTURE0);const x=new n.Texture(t,{width:p[0],height:p[1],data:null},s.RGBA);x.bind(s.LINEAR,s.CLAMP_TO_EDGE);const S=t.createFramebuffer(p[0],p[1],!1);return S.colorAttachment.set(x.texture),S.depthAttachment=new kt(t,S.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,S.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):S.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&s.texParameterf(s.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:S,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const s=this._style._layers[t],p=s.isHidden(this.painter.transform.zoom),x=s.getCrossfadeParameters(),S=!!x&&x.t!==1,z=s.hasTransition();return s.type!=="custom"&&!p&&(S||z)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const s in this._style._sourceCaches)if(this._style._sourceCaches[s]._source instanceof Mn){t=!0;break}if(t)for(let s=0;s<this._style.order.length;++s){const p=this._style._layers[this._style.order[s]],x=p.isHidden(this.painter.transform.zoom),S=this._style._getLayerSourceCache(p);if(p.type!=="raster"||x||!S)continue;const z=p.paint.get("raster-fade-duration");for(const B of this.proxyCoords){const V=this.proxyToSource[B.key][S.id];if(V)for(const $ of V){const H=Ls(S.getTile($),S.findLoadedParent($,0),S,this.painter.transform,z);(H.opacity!==1||H.mix!==0)&&this._clearRenderCacheForTile(S.id,$)}}}}_setupDrapedRenderBatches(){const t=this._style.order,s=t.length;if(s===0)return;const p=[];let x,S=0,z=this._style._layers[t[S]];for(;!this._style.isLayerDraped(z)&&z.isHidden(this.painter.transform.zoom)&&++S<s;)z=this._style._layers[t[S]];for(;S<s;++S){const B=this._style._layers[t[S]];B.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(B)?x===void 0&&(x=S):x!==void 0&&(p.push({start:x,end:S-1}),x=void 0))}x!==void 0&&p.push({start:x,end:S-1}),this._drapedRenderBatches=p}_setupRenderCache(t){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const S=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let z=0;z<S.length;++z){const B=Object.values(S[z]);s.renderCachePool.push(...B)}}return}this._clearRasterFadeFromRenderCache();const p=this.proxyCoords,x=this._tilesDirty;for(let S=p.length-1;S>=0;S--){const z=p[S];if(s.getTileByID(z.key),s.proxyCachedFBO[z.key]!==void 0){const B=t[z.key],V=this.proxyToSource[z.key];let $=0;for(const H in V){const re=V[H],se=B[H];if(!se||se.length!==re.length||re.some((me,ae)=>me!==se[ae]||x[H]&&x[H].hasOwnProperty(me.key))){$=-1;break}++$}for(const H in s.proxyCachedFBO[z.key])s.renderCache[s.proxyCachedFBO[z.key][H]].dirty=$<0||$!==Object.values(B).length}else for(let B=0;B<this._drapedRenderBatches.length;++B){const V=this._drapedRenderBatches[B];let $=s.renderCachePool.pop();$===void 0&&s.renderCache.length<50&&($=s.renderCache.length,s.renderCache.push(this._createFBO())),$!==void 0&&(s.proxyCachedFBO[z.key]===void 0&&(s.proxyCachedFBO[z.key]={}),s.proxyCachedFBO[z.key][V.start]=$,s.renderCache[$].dirty=!0)}}this._tilesDirty={}}_setupStencil(t,s,p){if(!p||!this._sourceTilesOverlap[p.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,S=x.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let z;if(s.isTileClipped())z=t.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);z=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+z>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=z,this._overlapStencilMode.ref=this._stencilRef,s.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):n.StencilMode.disabled}_renderTileClippingMasks(t,s){const p=this.painter,x=this.painter.context,S=x.gl;p._tileClippingMaskIDs={},x.setColorMode(n.ColorMode.disabled),x.setDepthMode(n.DepthMode.disabled);const z=p.useProgram("clippingMask");for(const B of t){const V=p._tileClippingMaskIDs[B.key]=--s;z.draw(x,S.TRIANGLES,n.DepthMode.disabled,new n.StencilMode({func:S.ALWAYS,mask:0},V,255,S.KEEP,S.KEEP,S.REPLACE),n.ColorMode.disabled,n.CullFaceMode.disabled,ls(B.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(t){const s=this.painter.transform;if(t.x<0||t.x>s.width||t.y<0||t.y>s.height)return null;const p=[t.x,t.y,1,1];n.transformMat4(p,p,s.pixelMatrixInverse),n.scale$2(p,p,1/p[3]),p[0]/=s.worldSize,p[1]/=s.worldSize;const x=s._camera.position,S=n.mercatorZfromAltitude(1,s.center.lat),z=[x[0],x[1],x[2]/S,0],B=n.subtract([],p.slice(0,3),z);n.normalize(B,B);const V=this.raycast(z,B,this._exaggeration);return V!==null&&V?(n.scaleAndAdd(z,z,B,V),z[3]=z[2],z[2]*=S,z):null}drawDepth(){const t=this.painter,s=t.context,p=this.proxySourceCache,x=Math.ceil(t.width),S=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===S||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const z=s.gl,B=s.createFramebuffer(x,S,!0);s.activeTexture.set(z.TEXTURE0);const V=new n.Texture(s,{width:x,height:S,data:null},z.RGBA);V.bind(z.NEAREST,z.CLAMP_TO_EDGE),B.colorAttachment.set(V.texture);const $=s.createRenderbuffer(s.gl.DEPTH_COMPONENT16,x,S);B.depthAttachment.set($),this._depthFBO=B,this._depthTexture=V}s.bindFramebuffer.set(this._depthFBO.framebuffer),s.viewport.set([0,0,x,S]),function(z,B,V,$){const H=z.context,re=H.gl;H.clear({depth:1});const se=z.useProgram("terrainDepth"),me=new n.DepthMode(re.LESS,n.DepthMode.ReadWrite,z.depthRangeFor3D);for(const ae of $){const ue=V.getTile(ae),Le=Qi(ae.projMatrix,0);B.setupElevationDraw(ue,se),se.draw(H,re.TRIANGLES,me,n.StencilMode.disabled,n.ColorMode.unblended,n.CullFaceMode.backCCW,Le,"terrain_depth",B.gridBuffer,B.gridIndexBuffer,B.gridNoSkirtSegments)}}(t,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,s,p){if(t.getSource()instanceof te)return this._setupProxiedCoordsForImageSource(t,s,p);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const x=this.proxiedCoords[t.id]=[],S=this.proxyCoords;for(let B=0;B<S.length;B++){const V=S[B],$=this._findTileCoveringTileID(V,t);if($){const H=this._createProxiedId(V,$,p[V.key]&&p[V.key][t.id]);x.push(H),this.proxyToSource[V.key][t.id]=[H]}}let z=!1;for(let B=0;B<s.length;B++){const V=t.getTile(s[B]);if(!V||!V.hasData())continue;const $=this._findTileCoveringTileID(V.tileID,this.proxySourceCache);if($&&$.tileID.canonical.z!==V.tileID.canonical.z){const H=this.proxyToSource[$.tileID.key][t.id],re=this._createProxiedId($.tileID,V,p[$.tileID.key]&&p[$.tileID.key][t.id]);H?H.splice(H.length-1,0,re):this.proxyToSource[$.tileID.key][t.id]=[re],x.push(re),z=!0}}this._sourceTilesOverlap[t.id]=z}_setupProxiedCoordsForImageSource(t,s,p){if(!t.getSource().loaded())return;const x=this.proxiedCoords[t.id]=[],S=this.proxyCoords,z=t.getSource(),B=new n.pointGeometry(z.tileID.x,z.tileID.y)._div(1<<z.tileID.z),V=z.coordinates.map(n.MercatorCoordinate.fromLngLat).reduce((H,re)=>(H.min.x=Math.min(H.min.x,re.x-B.x),H.min.y=Math.min(H.min.y,re.y-B.y),H.max.x=Math.max(H.max.x,re.x-B.x),H.max.y=Math.max(H.max.y,re.y-B.y),H),{min:new n.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),$=(H,re)=>{const se=H.wrap+H.canonical.x/(1<<H.canonical.z),me=H.canonical.y/(1<<H.canonical.z),ae=n.EXTENT/(1<<H.canonical.z),ue=re.wrap+re.canonical.x/(1<<re.canonical.z),Le=re.canonical.y/(1<<re.canonical.z);return se+ae<ue+V.min.x||se>ue+V.max.x||me+ae<Le+V.min.y||me>Le+V.max.y};for(let H=0;H<S.length;H++){const re=S[H];for(let se=0;se<s.length;se++){const me=t.getTile(s[se]);if(!me||!me.hasData()||$(re,me.tileID))continue;const ae=this._createProxiedId(re,me,p[re.key]&&p[re.key][t.id]),ue=this.proxyToSource[re.key][t.id];ue?ue.push(ae):this.proxyToSource[re.key][t.id]=[ae],x.push(ae)}}}_createProxiedId(t,s,p){let x=this.orthoMatrix;if(p){const S=p.find(z=>z.key===s.tileID.key);if(S)return S}if(s.tileID.key!==t.key){const S=t.canonical.z-s.tileID.canonical.z;let z,B,V;x=n.create$1();const $=s.tileID.wrap-t.wrap<<t.overscaledZ;S>0?(z=n.EXTENT>>S,B=z*((s.tileID.canonical.x<<S)-t.canonical.x+$),V=z*((s.tileID.canonical.y<<S)-t.canonical.y)):(z=n.EXTENT<<-S,B=n.EXTENT*(s.tileID.canonical.x-(t.canonical.x+$<<-S)),V=n.EXTENT*(s.tileID.canonical.y-(t.canonical.y<<-S))),n.ortho(x,0,z,0,z,0,1),n.translate(x,x,[B,V,0])}return new ko(s.tileID,t.key,x)}_findTileCoveringTileID(t,s){let p=s.getTile(t);if(p&&p.hasData())return p;const x=this._findCoveringTileCache[s.id],S=x[t.key];if(p=S?s.getTileByID(S):null,p&&p.hasData()||S===null)return p;let z=p?p.tileID:t,B=z.overscaledZ;const V=s.getSource().minzoom,$=[];if(!S){const re=s.getSource().maxzoom;if(t.canonical.z>=re){const se=t.canonical.z-re;s.getSource().reparseOverscaled?(B=Math.max(t.canonical.z+2,s.transform.tileZoom),z=new n.OverscaledTileID(B,t.wrap,re,t.canonical.x>>se,t.canonical.y>>se)):se!==0&&(B=re,z=new n.OverscaledTileID(B,t.wrap,re,t.canonical.x>>se,t.canonical.y>>se))}z.key!==t.key&&($.push(z.key),p=s.getTile(z))}const H=re=>{$.forEach(se=>{x[se]=re}),$.length=0};for(B-=1;B>=V&&(!p||!p.hasData());B--){p&&H(p.tileID.key);const re=z.calculateScaledKey(B);if(p=s.getTileByID(re),p&&p.hasData())break;const se=x[re];if(se===null)break;se===void 0?$.push(re):p=s.getTileByID(se)}return H(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(t){this.renderedToTile||(this.renderedToTile=!0)}_clearRenderCacheForTile(t,s){let p=this._tilesDirty[t];p||(p=this._tilesDirty[t]={}),p[s.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(s){let p,x,S;const z=new n.StructArrayLayout2ui4,B=131;for(x=1;x<129;x++){for(p=1;p<129;p++)S=x*B+p,z.emplaceBack(S,S+1),z.emplaceBack(S,S+B),z.emplaceBack(S+1,S+B),x===128&&z.emplaceBack(S+B,S+B+1);z.emplaceBack(S+1,S+1+B)}return z}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=n.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Aa(d){const t=[];for(let s=0;s<d.length;s++){if(d[s]===null)continue;const p=d[s].split(" ");t.push(p.pop())}return t}class No{static cacheKey(t,s,p){let x=`${t}${p?p.cacheKey:""}`;for(const S of s)x+="/"+S;return x}constructor(t,s,p,x,S,z){const B=t.gl;this.program=B.createProgram();const V=Aa(p.staticAttributes),$=x?x.getBinderAttributes():[],H=V.concat($),re=p.staticUniforms?Aa(p.staticUniforms):[],se=x?x.getBinderUniforms():[],me=re.concat(se),ae=[];for(const He of me)ae.indexOf(He)<0&&ae.push(He);let ue=x?x.defines():[];ue=ue.concat(z.map(He=>"#define "+He));const Le=ue.concat(ia.fragmentSource,ji,Ao.fragmentSource,p.fragmentSource).join(`
`),ye=ue.concat(ia.vertexSource,ji,Ao.vertexSource,ss.vertexSource,p.vertexSource).join(`
`),Me=B.createShader(B.FRAGMENT_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);B.shaderSource(Me,Le),B.compileShader(Me),B.attachShader(this.program,Me);const Ae=B.createShader(B.VERTEX_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);B.shaderSource(Ae,ye),B.compileShader(Ae),B.attachShader(this.program,Ae),this.attributes={};const Ne={};this.numAttributes=H.length;for(let He=0;He<this.numAttributes;He++)H[He]&&(B.bindAttribLocation(this.program,He,H[He]),this.attributes[H[He]]=He);B.linkProgram(this.program),B.deleteShader(Ae),B.deleteShader(Me);for(let He=0;He<ae.length;He++){const We=ae[He];if(We&&!Ne[We]){const lt=B.getUniformLocation(this.program,We);lt&&(Ne[We]=lt)}}this.fixedUniforms=S(t,Ne),this.binderUniforms=x?x.getUniforms(t,Ne):[],z.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((He,We)=>({u_dem:new n.Uniform1i(He,We.u_dem),u_dem_prev:new n.Uniform1i(He,We.u_dem_prev),u_dem_unpack:new n.Uniform4f(He,We.u_dem_unpack),u_dem_tl:new n.Uniform2f(He,We.u_dem_tl),u_dem_scale:new n.Uniform1f(He,We.u_dem_scale),u_dem_tl_prev:new n.Uniform2f(He,We.u_dem_tl_prev),u_dem_scale_prev:new n.Uniform1f(He,We.u_dem_scale_prev),u_dem_size:new n.Uniform1f(He,We.u_dem_size),u_dem_lerp:new n.Uniform1f(He,We.u_dem_lerp),u_exaggeration:new n.Uniform1f(He,We.u_exaggeration),u_depth:new n.Uniform1i(He,We.u_depth),u_depth_size_inv:new n.Uniform2f(He,We.u_depth_size_inv),u_meter_to_dem:new n.Uniform1f(He,We.u_meter_to_dem),u_label_plane_matrix_inv:new n.UniformMatrix4f(He,We.u_label_plane_matrix_inv)}))(t,Ne)),z.indexOf("FOG")!==-1&&(this.fogUniforms=((He,We)=>({u_fog_matrix:new n.UniformMatrix4f(He,We.u_fog_matrix),u_fog_range:new n.Uniform2f(He,We.u_fog_range),u_fog_color:new n.Uniform4f(He,We.u_fog_color),u_fog_horizon_blend:new n.Uniform1f(He,We.u_fog_horizon_blend),u_fog_temporal_offset:new n.Uniform1f(He,We.u_fog_temporal_offset)}))(t,Ne))}setTerrainUniformValues(t,s){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const x in s)p[x].set(s[x])}}setFogUniformValues(t,s){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const x in s)p[x].location&&p[x].set(s[x])}}draw(t,s,p,x,S,z,B,V,$,H,re,se,me,ae,ue,Le){const ye=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(p),t.setStencilMode(x),t.setColorMode(S),t.setCullFace(z);for(const Ae in this.fixedUniforms)this.fixedUniforms[Ae].set(B[Ae]);ae&&ae.setUniforms(t,this.binderUniforms,se,{zoom:me});const Me={[ye.LINES]:2,[ye.TRIANGLES]:3,[ye.LINE_STRIP]:1}[s];for(const Ae of re.get()){const Ne=Ae.vaos||(Ae.vaos={});(Ne[V]||(Ne[V]=new fo)).bind(t,this,$,ae?ae.getPaintVertexBuffers():[],H,Ae.vertexOffset,ue,Le),ye.drawElements(s,Ae.primitiveLength*Me,ye.UNSIGNED_SHORT,Ae.primitiveOffset*Me*2)}}}function go(d,t,s){const p=1/ht(s,1,t.transform.tileZoom),x=Math.pow(2,s.tileID.overscaledZ),S=s.tileSize*Math.pow(2,t.transform.tileZoom)/x,z=S*(s.tileID.canonical.x+s.tileID.wrap*x),B=S*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[p,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[z>>16,B>>16],u_pixel_coord_lower:[65535&z,65535&B]}}const ka=(d,t,s,p)=>{const x=t.style.light,S=x.properties.get("position"),z=[S.x,S.y,S.z],B=n.create$2();x.properties.get("anchor")==="viewport"&&(n.fromRotation(B,-t.transform.angle),n.transformMat3(z,z,B));const V=x.properties.get("color");return{u_matrix:d,u_lightpos:z,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[V.r,V.g,V.b],u_vertical_gradient:+s,u_opacity:p}},Er=(d,t,s,p,x,S,z)=>n.extend(ka(d,t,s,p),go(S,t,z),{u_height_factor:-Math.pow(2,x.overscaledZ)/z.tileSize/8}),mi=d=>({u_matrix:d}),eo=(d,t,s,p)=>n.extend(mi(d),go(s,t,p)),Ds=(d,t)=>({u_matrix:d,u_world:t}),La=(d,t,s,p,x)=>n.extend(eo(d,t,s,p),{u_world:x}),us=(d,t,s,p)=>{const x=d.transform;let S;if(p.paint.get("circle-pitch-alignment")==="map"){const z=ht(s,1,x.zoom);S=[z,z]}else S=x.pixelsToGLUnits;return{u_camera_to_center_distance:x.cameraToCenterDistance,u_matrix:d.translatePosMatrix(t.projMatrix,s,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:n.exported.devicePixelRatio,u_extrude_scale:S}},Ti=d=>{const t=[];return d.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),d.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t},Da=(d,t,s)=>{const p=n.EXTENT/s.tileSize;return{u_matrix:d,u_camera_to_center_distance:t.cameraToCenterDistance,u_extrude_scale:[t.pixelsToGLUnits[0]/p,t.pixelsToGLUnits[1]/p]}},hs=(d,t,s=1)=>({u_matrix:d,u_color:t,u_overlay:0,u_overlay_scale:s}),ds=(d,t,s,p)=>({u_matrix:d,u_extrude_scale:ht(t,1,s),u_intensity:p}),zs=(d,t,s,p)=>{const x=d.transform;return{u_matrix:aa(d,t,s,p),u_ratio:1/ht(t,1,x.zoom),u_device_pixel_ratio:n.exported.devicePixelRatio,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},za=(d,t,s,p,x)=>n.extend(zs(d,t,s,p),{u_image:0,u_image_height:x}),to=(d,t,s,p,x)=>{const S=d.transform,z=Os(t,S);return{u_matrix:aa(d,t,s,x),u_texsize:t.imageAtlasTexture.size,u_ratio:1/ht(t,1,S.zoom),u_device_pixel_ratio:n.exported.devicePixelRatio,u_image:0,u_scale:[z,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},el=(d,t,s,p,x)=>{const S=Os(t,d.transform);return n.extend(zs(d,t,s,x),{u_texsize:t.lineAtlasTexture.size,u_scale:[S,p.fromScale,p.toScale],u_image:0,u_mix:p.t})};function Os(d,t){return 1/ht(d,1,t.tileZoom)}function aa(d,t,s,p){return d.translatePosMatrix(p||t.tileID.projMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const El=(d,t,s,p,x)=>{return{u_matrix:d,u_tl_parent:t,u_scale_parent:s,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(z=x.paint.get("raster-saturation"),z>0?1-1/(1.001-z):-z),u_contrast_factor:(S=x.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:tl(x.paint.get("raster-hue-rotate"))};var S,z};function tl(d){d*=Math.PI/180;const t=Math.sin(d),s=Math.cos(d);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const la=(d,t,s,p,x,S,z,B,V,$)=>{const H=x.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_pitch:H.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:H.width/H.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:z,u_coord_matrix:B,u_is_text:+V,u_pitch_with_map:+p,u_texsize:$,u_texture:0}},Fs=(d,t,s,p,x,S,z,B,V,$,H)=>{const{cameraToCenterDistance:re,_pitch:se}=x.transform;return n.extend(la(d,t,s,p,x,S,z,B,V,$),{u_gamma_scale:p?re*Math.cos(x.terrain?0:se):1,u_device_pixel_ratio:n.exported.devicePixelRatio,u_is_halo:+H})},Rs=(d,t,s,p,x,S,z,B,V,$)=>n.extend(Fs(d,t,s,p,x,S,z,B,!0,V,!0),{u_texsize_icon:$,u_texture_icon:1}),Go=(d,t,s)=>({u_matrix:d,u_opacity:t,u_color:s}),ca=(d,t,s,p,x,S)=>n.extend(function(z,B,V,$){const H=V.imageManager.getPattern(z.from.toString()),re=V.imageManager.getPattern(z.to.toString()),{width:se,height:me}=V.imageManager.getPixelSize(),ae=Math.pow(2,$.tileID.overscaledZ),ue=$.tileSize*Math.pow(2,V.transform.tileZoom)/ae,Le=ue*($.tileID.canonical.x+$.tileID.wrap*ae),ye=ue*$.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:H.tl,u_pattern_br_a:H.br,u_pattern_tl_b:re.tl,u_pattern_br_b:re.br,u_texsize:[se,me],u_mix:B.t,u_pattern_size_a:H.displaySize,u_pattern_size_b:re.displaySize,u_scale_a:B.fromScale,u_scale_b:B.toScale,u_tile_units_to_pixels:1/ht($,1,V.transform.tileZoom),u_pixel_coord_upper:[Le>>16,ye>>16],u_pixel_coord_lower:[65535&Le,65535&ye]}}(p,S,s,x),{u_matrix:d,u_opacity:t}),Oa={fillExtrusion:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_lightpos:new n.Uniform3f(d,t.u_lightpos),u_lightintensity:new n.Uniform1f(d,t.u_lightintensity),u_lightcolor:new n.Uniform3f(d,t.u_lightcolor),u_vertical_gradient:new n.Uniform1f(d,t.u_vertical_gradient),u_opacity:new n.Uniform1f(d,t.u_opacity)}),fillExtrusionPattern:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_lightpos:new n.Uniform3f(d,t.u_lightpos),u_lightintensity:new n.Uniform1f(d,t.u_lightintensity),u_lightcolor:new n.Uniform3f(d,t.u_lightcolor),u_vertical_gradient:new n.Uniform1f(d,t.u_vertical_gradient),u_height_factor:new n.Uniform1f(d,t.u_height_factor),u_image:new n.Uniform1i(d,t.u_image),u_texsize:new n.Uniform2f(d,t.u_texsize),u_pixel_coord_upper:new n.Uniform2f(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(d,t.u_pixel_coord_lower),u_scale:new n.Uniform3f(d,t.u_scale),u_fade:new n.Uniform1f(d,t.u_fade),u_opacity:new n.Uniform1f(d,t.u_opacity)}),fill:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix)}),fillPattern:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_image:new n.Uniform1i(d,t.u_image),u_texsize:new n.Uniform2f(d,t.u_texsize),u_pixel_coord_upper:new n.Uniform2f(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(d,t.u_pixel_coord_lower),u_scale:new n.Uniform3f(d,t.u_scale),u_fade:new n.Uniform1f(d,t.u_fade)}),fillOutline:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_world:new n.Uniform2f(d,t.u_world)}),fillOutlinePattern:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_world:new n.Uniform2f(d,t.u_world),u_image:new n.Uniform1i(d,t.u_image),u_texsize:new n.Uniform2f(d,t.u_texsize),u_pixel_coord_upper:new n.Uniform2f(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(d,t.u_pixel_coord_lower),u_scale:new n.Uniform3f(d,t.u_scale),u_fade:new n.Uniform1f(d,t.u_fade)}),circle:(d,t)=>({u_camera_to_center_distance:new n.Uniform1f(d,t.u_camera_to_center_distance),u_extrude_scale:new n.Uniform2f(d,t.u_extrude_scale),u_device_pixel_ratio:new n.Uniform1f(d,t.u_device_pixel_ratio),u_matrix:new n.UniformMatrix4f(d,t.u_matrix)}),collisionBox:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_camera_to_center_distance:new n.Uniform1f(d,t.u_camera_to_center_distance),u_extrude_scale:new n.Uniform2f(d,t.u_extrude_scale)}),collisionCircle:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_inv_matrix:new n.UniformMatrix4f(d,t.u_inv_matrix),u_camera_to_center_distance:new n.Uniform1f(d,t.u_camera_to_center_distance),u_viewport_size:new n.Uniform2f(d,t.u_viewport_size)}),debug:(d,t)=>({u_color:new n.UniformColor(d,t.u_color),u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_overlay:new n.Uniform1i(d,t.u_overlay),u_overlay_scale:new n.Uniform1f(d,t.u_overlay_scale)}),clippingMask:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix)}),heatmap:(d,t)=>({u_extrude_scale:new n.Uniform1f(d,t.u_extrude_scale),u_intensity:new n.Uniform1f(d,t.u_intensity),u_matrix:new n.UniformMatrix4f(d,t.u_matrix)}),heatmapTexture:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_world:new n.Uniform2f(d,t.u_world),u_image:new n.Uniform1i(d,t.u_image),u_color_ramp:new n.Uniform1i(d,t.u_color_ramp),u_opacity:new n.Uniform1f(d,t.u_opacity)}),hillshade:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_image:new n.Uniform1i(d,t.u_image),u_latrange:new n.Uniform2f(d,t.u_latrange),u_light:new n.Uniform2f(d,t.u_light),u_shadow:new n.UniformColor(d,t.u_shadow),u_highlight:new n.UniformColor(d,t.u_highlight),u_accent:new n.UniformColor(d,t.u_accent)}),hillshadePrepare:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_image:new n.Uniform1i(d,t.u_image),u_dimension:new n.Uniform2f(d,t.u_dimension),u_zoom:new n.Uniform1f(d,t.u_zoom),u_unpack:new n.Uniform4f(d,t.u_unpack)}),line:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_ratio:new n.Uniform1f(d,t.u_ratio),u_device_pixel_ratio:new n.Uniform1f(d,t.u_device_pixel_ratio),u_units_to_pixels:new n.Uniform2f(d,t.u_units_to_pixels)}),lineGradient:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_ratio:new n.Uniform1f(d,t.u_ratio),u_device_pixel_ratio:new n.Uniform1f(d,t.u_device_pixel_ratio),u_units_to_pixels:new n.Uniform2f(d,t.u_units_to_pixels),u_image:new n.Uniform1i(d,t.u_image),u_image_height:new n.Uniform1f(d,t.u_image_height)}),linePattern:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_texsize:new n.Uniform2f(d,t.u_texsize),u_ratio:new n.Uniform1f(d,t.u_ratio),u_device_pixel_ratio:new n.Uniform1f(d,t.u_device_pixel_ratio),u_image:new n.Uniform1i(d,t.u_image),u_units_to_pixels:new n.Uniform2f(d,t.u_units_to_pixels),u_scale:new n.Uniform3f(d,t.u_scale),u_fade:new n.Uniform1f(d,t.u_fade)}),lineSDF:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_texsize:new n.Uniform2f(d,t.u_texsize),u_ratio:new n.Uniform1f(d,t.u_ratio),u_device_pixel_ratio:new n.Uniform1f(d,t.u_device_pixel_ratio),u_units_to_pixels:new n.Uniform2f(d,t.u_units_to_pixels),u_image:new n.Uniform1i(d,t.u_image),u_scale:new n.Uniform3f(d,t.u_scale),u_mix:new n.Uniform1f(d,t.u_mix)}),raster:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_tl_parent:new n.Uniform2f(d,t.u_tl_parent),u_scale_parent:new n.Uniform1f(d,t.u_scale_parent),u_buffer_scale:new n.Uniform1f(d,t.u_buffer_scale),u_fade_t:new n.Uniform1f(d,t.u_fade_t),u_opacity:new n.Uniform1f(d,t.u_opacity),u_image0:new n.Uniform1i(d,t.u_image0),u_image1:new n.Uniform1i(d,t.u_image1),u_brightness_low:new n.Uniform1f(d,t.u_brightness_low),u_brightness_high:new n.Uniform1f(d,t.u_brightness_high),u_saturation_factor:new n.Uniform1f(d,t.u_saturation_factor),u_contrast_factor:new n.Uniform1f(d,t.u_contrast_factor),u_spin_weights:new n.Uniform3f(d,t.u_spin_weights)}),symbolIcon:(d,t)=>({u_is_size_zoom_constant:new n.Uniform1i(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(d,t.u_is_size_feature_constant),u_size_t:new n.Uniform1f(d,t.u_size_t),u_size:new n.Uniform1f(d,t.u_size),u_camera_to_center_distance:new n.Uniform1f(d,t.u_camera_to_center_distance),u_pitch:new n.Uniform1f(d,t.u_pitch),u_rotate_symbol:new n.Uniform1i(d,t.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(d,t.u_aspect_ratio),u_fade_change:new n.Uniform1f(d,t.u_fade_change),u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(d,t.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(d,t.u_coord_matrix),u_is_text:new n.Uniform1i(d,t.u_is_text),u_pitch_with_map:new n.Uniform1i(d,t.u_pitch_with_map),u_texsize:new n.Uniform2f(d,t.u_texsize),u_texture:new n.Uniform1i(d,t.u_texture)}),symbolSDF:(d,t)=>({u_is_size_zoom_constant:new n.Uniform1i(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(d,t.u_is_size_feature_constant),u_size_t:new n.Uniform1f(d,t.u_size_t),u_size:new n.Uniform1f(d,t.u_size),u_camera_to_center_distance:new n.Uniform1f(d,t.u_camera_to_center_distance),u_pitch:new n.Uniform1f(d,t.u_pitch),u_rotate_symbol:new n.Uniform1i(d,t.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(d,t.u_aspect_ratio),u_fade_change:new n.Uniform1f(d,t.u_fade_change),u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(d,t.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(d,t.u_coord_matrix),u_is_text:new n.Uniform1i(d,t.u_is_text),u_pitch_with_map:new n.Uniform1i(d,t.u_pitch_with_map),u_texsize:new n.Uniform2f(d,t.u_texsize),u_texture:new n.Uniform1i(d,t.u_texture),u_gamma_scale:new n.Uniform1f(d,t.u_gamma_scale),u_device_pixel_ratio:new n.Uniform1f(d,t.u_device_pixel_ratio),u_is_halo:new n.Uniform1i(d,t.u_is_halo)}),symbolTextAndIcon:(d,t)=>({u_is_size_zoom_constant:new n.Uniform1i(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(d,t.u_is_size_feature_constant),u_size_t:new n.Uniform1f(d,t.u_size_t),u_size:new n.Uniform1f(d,t.u_size),u_camera_to_center_distance:new n.Uniform1f(d,t.u_camera_to_center_distance),u_pitch:new n.Uniform1f(d,t.u_pitch),u_rotate_symbol:new n.Uniform1i(d,t.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(d,t.u_aspect_ratio),u_fade_change:new n.Uniform1f(d,t.u_fade_change),u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(d,t.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(d,t.u_coord_matrix),u_is_text:new n.Uniform1i(d,t.u_is_text),u_pitch_with_map:new n.Uniform1i(d,t.u_pitch_with_map),u_texsize:new n.Uniform2f(d,t.u_texsize),u_texsize_icon:new n.Uniform2f(d,t.u_texsize_icon),u_texture:new n.Uniform1i(d,t.u_texture),u_texture_icon:new n.Uniform1i(d,t.u_texture_icon),u_gamma_scale:new n.Uniform1f(d,t.u_gamma_scale),u_device_pixel_ratio:new n.Uniform1f(d,t.u_device_pixel_ratio),u_is_halo:new n.Uniform1i(d,t.u_is_halo)}),background:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_opacity:new n.Uniform1f(d,t.u_opacity),u_color:new n.UniformColor(d,t.u_color)}),backgroundPattern:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_opacity:new n.Uniform1f(d,t.u_opacity),u_image:new n.Uniform1i(d,t.u_image),u_pattern_tl_a:new n.Uniform2f(d,t.u_pattern_tl_a),u_pattern_br_a:new n.Uniform2f(d,t.u_pattern_br_a),u_pattern_tl_b:new n.Uniform2f(d,t.u_pattern_tl_b),u_pattern_br_b:new n.Uniform2f(d,t.u_pattern_br_b),u_texsize:new n.Uniform2f(d,t.u_texsize),u_mix:new n.Uniform1f(d,t.u_mix),u_pattern_size_a:new n.Uniform2f(d,t.u_pattern_size_a),u_pattern_size_b:new n.Uniform2f(d,t.u_pattern_size_b),u_scale_a:new n.Uniform1f(d,t.u_scale_a),u_scale_b:new n.Uniform1f(d,t.u_scale_b),u_pixel_coord_upper:new n.Uniform2f(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(d,t.u_pixel_coord_lower),u_tile_units_to_pixels:new n.Uniform1f(d,t.u_tile_units_to_pixels)}),terrainRaster:Xn,terrainDepth:Xn,skybox:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_sun_direction:new n.Uniform3f(d,t.u_sun_direction),u_cubemap:new n.Uniform1i(d,t.u_cubemap),u_opacity:new n.Uniform1f(d,t.u_opacity),u_temporal_offset:new n.Uniform1f(d,t.u_temporal_offset)}),skyboxGradient:(d,t)=>({u_matrix:new n.UniformMatrix4f(d,t.u_matrix),u_color_ramp:new n.Uniform1i(d,t.u_color_ramp),u_center_direction:new n.Uniform3f(d,t.u_center_direction),u_radius:new n.Uniform1f(d,t.u_radius),u_opacity:new n.Uniform1f(d,t.u_opacity),u_temporal_offset:new n.Uniform1f(d,t.u_temporal_offset)}),skyboxCapture:(d,t)=>({u_matrix_3f:new n.UniformMatrix3f(d,t.u_matrix_3f),u_sun_direction:new n.Uniform3f(d,t.u_sun_direction),u_sun_intensity:new n.Uniform1f(d,t.u_sun_intensity),u_color_tint_r:new n.Uniform4f(d,t.u_color_tint_r),u_color_tint_m:new n.Uniform4f(d,t.u_color_tint_m),u_luminance:new n.Uniform1f(d,t.u_luminance)})};let Vo;function yo(d,t,s,p,x,S,z){const B=d.context,V=B.gl,$=d.useProgram("collisionBox"),H=[];let re=0,se=0;for(let Ae=0;Ae<p.length;Ae++){const Ne=p[Ae],He=t.getTile(Ne),We=He.getBucket(s);if(!We)continue;let lt=Ne.projMatrix;x[0]===0&&x[1]===0||(lt=d.translatePosMatrix(Ne.projMatrix,He,x,S));const ut=z?We.textCollisionBox:We.iconCollisionBox,It=We.collisionCircleArray;if(It.length>0){const ze=n.create$1(),Gt=lt;n.mul$1(ze,We.placementInvProjMatrix,d.transform.glCoordMatrix),n.mul$1(ze,ze,We.placementViewportMatrix),H.push({circleArray:It,circleOffset:se,transform:Gt,invTransform:ze}),re+=It.length/4,se=re}ut&&(d.terrain&&d.terrain.setupElevationDraw(He,$),$.draw(B,V.LINES,n.DepthMode.disabled,n.StencilMode.disabled,d.colorModeForRenderPass(),n.CullFaceMode.disabled,Da(lt,d.transform,He),s.id,ut.layoutVertexBuffer,ut.indexBuffer,ut.segments,null,d.transform.zoom,null,ut.collisionVertexBuffer,ut.collisionVertexBufferExt))}if(!z||!H.length)return;const me=d.useProgram("collisionCircle"),ae=new n.StructArrayLayout2f1f2i16;ae.resize(4*re),ae._trim();let ue=0;for(const Ae of H)for(let Ne=0;Ne<Ae.circleArray.length/4;Ne++){const He=4*Ne,We=Ae.circleArray[He+0],lt=Ae.circleArray[He+1],ut=Ae.circleArray[He+2],It=Ae.circleArray[He+3];ae.emplace(ue++,We,lt,ut,It,0),ae.emplace(ue++,We,lt,ut,It,1),ae.emplace(ue++,We,lt,ut,It,2),ae.emplace(ue++,We,lt,ut,It,3)}(!Vo||Vo.length<2*re)&&(Vo=function(Ae){const Ne=2*Ae,He=new n.StructArrayLayout3ui6;He.resize(Ne),He._trim();for(let We=0;We<Ne;We++){const lt=6*We;He.uint16[lt+0]=4*We+0,He.uint16[lt+1]=4*We+1,He.uint16[lt+2]=4*We+2,He.uint16[lt+3]=4*We+2,He.uint16[lt+4]=4*We+3,He.uint16[lt+5]=4*We+0}return He}(re));const Le=B.createIndexBuffer(Vo,!0),ye=B.createVertexBuffer(ae,n.collisionCircleLayout.members,!0);for(const Ae of H){const Ne={u_matrix:Ae.transform,u_inv_matrix:Ae.invTransform,u_camera_to_center_distance:(Me=d.transform).cameraToCenterDistance,u_viewport_size:[Me.width,Me.height]};me.draw(B,V.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,d.colorModeForRenderPass(),n.CullFaceMode.disabled,Ne,s.id,ye,Le,n.SegmentVector.simpleSegment(0,2*Ae.circleOffset,Ae.circleArray.length,Ae.circleArray.length/2),null,d.transform.zoom,null,null,null)}var Me;ye.destroy(),Le.destroy()}const ua=n.identity(new Float32Array(16));function no(d,t,s,p,x,S){const{horizontalAlign:z,verticalAlign:B}=n.getAnchorAlignment(d),V=-(z-.5)*t,$=-(B-.5)*s,H=n.evaluateVariableOffset(d,p);return new n.pointGeometry((V/x+H[0])*S,($/x+H[1])*S)}function qo(d,t,s,p,x,S,z,B,V,$,H,re){const se=d.text.placedSymbolArray,me=d.text.dynamicLayoutVertexArray,ae=d.icon.dynamicLayoutVertexArray,ue={};me.clear();for(let Le=0;Le<se.length;Le++){const ye=se.get(Le),Me=d.allowVerticalPlacement&&!ye.placedOrientation,Ae=ye.hidden||!ye.crossTileID||Me?null:p[ye.crossTileID];if(Ae){const Ne=new n.pointGeometry(ye.anchorX,ye.anchorY),He=re(Ne),We=yr(Ne,s?B:z,He),lt=wi(S.cameraToCenterDistance,We.signedDistanceFromCamera);let ut=x.evaluateSizeForFeature(d.textSizeData,$,ye)*lt/n.ONE_EM;s&&(ut*=d.tilePixelRatio/V);const{width:It,height:ze,anchor:Gt,textOffset:Lt,textScale:pn}=Ae,on=no(Gt,It,ze,Lt,pn,ut),an=s?yr(Ne.add(on),z,He).point:We.point.add(t?on.rotate(-S.angle):on),Pn=d.allowVerticalPlacement&&ye.placedOrientation===n.WritingMode.vertical?Math.PI/2:0;for(let Be=0;Be<ye.numGlyphs;Be++)n.addDynamicAttributes(me,an,Pn);H&&ye.associatedIconIndex>=0&&(ue[ye.associatedIconIndex]={shiftedAnchor:an,angle:Pn})}else po(ye.numGlyphs,me)}if(H){ae.clear();const Le=d.icon.placedSymbolArray;for(let ye=0;ye<Le.length;ye++){const Me=Le.get(ye);if(Me.hidden)po(Me.numGlyphs,ae);else{const Ae=ue[ye];if(Ae)for(let Ne=0;Ne<Me.numGlyphs;Ne++)n.addDynamicAttributes(ae,Ae.shiftedAnchor,Ae.angle);else po(Me.numGlyphs,ae)}}d.icon.dynamicLayoutVertexBuffer.updateData(ae)}d.text.dynamicLayoutVertexBuffer.updateData(me)}function ha(d,t,s){return s.iconsInText&&t?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function Bs(d,t,s,p,x,S,z,B,V,$,H,re){const se=d.context,me=se.gl,ae=d.transform,ue=B==="map",Le=V==="map",ye=ue&&s.layout.get("symbol-placement")!=="point",Me=ue&&!Le&&!ye,Ae=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ne=!1;const He=d.depthModeForSublayer(0,n.DepthMode.ReadOnly),We=s.layout.get("text-variable-anchor"),lt=[],ut=d.terrain&&Le?["PITCH_WITH_MAP_TERRAIN"]:null;for(const It of p){const ze=t.getTile(It),Gt=ze.getBucket(s);if(!Gt)continue;const Lt=x?Gt.text:Gt.icon;if(!Lt||!Lt.segments.get().length)continue;const pn=Lt.programConfigurations.get(s.id),on=x||Gt.sdfIcons,an=x?Gt.textSizeData:Gt.iconSizeData,Pn=Le||ae.pitch!==0,Be=d.useProgram(ha(on,x,Gt),pn,ut),nt=n.evaluateSizeForZoom(an,ae.zoom);let zt,Yt,yn,fn,Cn=[0,0],rr=null;if(x){if(Yt=ze.glyphAtlasTexture,yn=me.LINEAR,zt=ze.glyphAtlasTexture.size,Gt.iconsInText){Cn=ze.imageAtlasTexture.size,rr=ze.imageAtlasTexture;const _i=an.kind==="composite"||an.kind==="camera";fn=Pn||d.options.rotating||d.options.zooming||_i?me.LINEAR:me.NEAREST}}else{const _i=s.layout.get("icon-size").constantOr(0)!==1||Gt.iconsNeedLinear;Yt=ze.imageAtlasTexture,yn=on||d.options.rotating||d.options.zooming||_i||Pn?me.LINEAR:me.NEAREST,zt=ze.imageAtlasTexture.size}const br=ht(ze,1,d.transform.zoom),Yn=On(It.projMatrix,Le,ue,d.transform,br),or=d.terrain&&Le&&ye?n.invert(new Float32Array(16),Yn):ua,Or=Ln(It.projMatrix,Le,ue,d.transform,br),Hn=We&&Gt.hasTextData(),Jn=s.layout.get("icon-text-fit")!=="none"&&Hn&&Gt.hasIconData();if(ye){const _i=ae.elevation;ts(Gt,It.projMatrix,d,x,Yn,Or,Le,$,_i?Oo=>_i.getAtTileOffset(It,Oo.x,Oo.y):null)}const Fn=d.translatePosMatrix(It.projMatrix,ze,S,z),dr=ye||x&&We||Jn?ua:Yn,Fr=d.translatePosMatrix(Or,ze,S,z,!0),ir=on&&s.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Jr;Jr=on?Gt.iconsInText?Rs(an.kind,nt,Me,Le,d,Fn,dr,Fr,zt,Cn):Fs(an.kind,nt,Me,Le,d,Fn,dr,Fr,x,zt,!0):la(an.kind,nt,Me,Le,d,Fn,dr,Fr,x,zt);const xs={program:Be,buffers:Lt,uniformValues:Jr,atlasTexture:Yt,atlasTextureIcon:rr,atlasInterpolation:yn,atlasInterpolationIcon:fn,isSDF:on,hasHalo:ir,tile:ze,labelPlaneMatrixInv:or};if(Ae&&Gt.canOverlap){Ne=!0;const _i=Lt.segments.get();for(const Oo of _i)lt.push({segments:new n.SegmentVector([Oo]),sortKey:Oo.sortKey,state:xs})}else lt.push({segments:Lt.segments,sortKey:0,state:xs})}Ne&&lt.sort((It,ze)=>It.sortKey-ze.sortKey);for(const It of lt){const ze=It.state;if(d.terrain&&d.terrain.setupElevationDraw(ze.tile,ze.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:ze.labelPlaneMatrixInv}),se.activeTexture.set(me.TEXTURE0),ze.atlasTexture.bind(ze.atlasInterpolation,me.CLAMP_TO_EDGE),ze.atlasTextureIcon&&(se.activeTexture.set(me.TEXTURE1),ze.atlasTextureIcon&&ze.atlasTextureIcon.bind(ze.atlasInterpolationIcon,me.CLAMP_TO_EDGE)),ze.isSDF){const Gt=ze.uniformValues;ze.hasHalo&&(Gt.u_is_halo=1,Wn(ze.buffers,It.segments,s,d,ze.program,He,H,re,Gt)),Gt.u_is_halo=0}Wn(ze.buffers,It.segments,s,d,ze.program,He,H,re,ze.uniformValues)}}function Wn(d,t,s,p,x,S,z,B,V){const $=p.context;x.draw($,$.gl.TRIANGLES,S,z,B,n.CullFaceMode.disabled,V,s.id,d.layoutVertexBuffer,d.indexBuffer,t,s.paint,p.transform.zoom,d.programConfigurations.get(s.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function Lo(d,t,s,p,x,S,z){const B=d.context.gl,V=s.paint.get("fill-pattern"),$=V&&V.constantOr(1),H=s.getCrossfadeParameters();let re,se,me,ae,ue;z?(se=$&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",re=B.LINES):(se=$?"fillPattern":"fill",re=B.TRIANGLES);for(const Le of p){const ye=t.getTile(Le);if($&&!ye.patternsLoaded())continue;const Me=ye.getBucket(s);if(!Me)continue;d.prepareDrawTile(Le);const Ae=Me.programConfigurations.get(s.id),Ne=d.useProgram(se,Ae);$&&(d.context.activeTexture.set(B.TEXTURE0),ye.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Ae.updatePaintBuffers(H));const He=V.constantOr(null);if(He&&ye.imageAtlas){const lt=ye.imageAtlas,ut=lt.patternPositions[He.to.toString()],It=lt.patternPositions[He.from.toString()];ut&&It&&Ae.setConstantPatternPositions(ut,It)}const We=d.translatePosMatrix(Le.projMatrix,ye,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(z){ae=Me.indexBuffer2,ue=Me.segments2;const lt=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[B.drawingBufferWidth,B.drawingBufferHeight];me=se==="fillOutlinePattern"&&$?La(We,d,H,ye,lt):Ds(We,lt)}else ae=Me.indexBuffer,ue=Me.segments,me=$?eo(We,d,H,ye):mi(We);d.prepareDrawProgram(d.context,Ne,Le.toUnwrapped()),Ne.draw(d.context,re,x,d.stencilModeForClipping(Le),S,n.CullFaceMode.disabled,me,s.id,Me.layoutVertexBuffer,ae,ue,s.paint,d.transform.zoom,Ae)}}function da(d,t,s,p,x,S,z){const B=d.context,V=B.gl,$=s.paint.get("fill-extrusion-pattern"),H=$.constantOr(1),re=s.getCrossfadeParameters(),se=s.paint.get("fill-extrusion-opacity");for(const me of p){const ae=t.getTile(me),ue=ae.getBucket(s);if(!ue)continue;const Le=ue.programConfigurations.get(s.id),ye=d.useProgram(H?"fillExtrusionPattern":"fillExtrusion",Le);if(d.terrain){const We=d.terrain;if(!ue.enableTerrain)continue;if(We.setupElevationDraw(ae,ye,{useMeterToDem:!0}),ps(B,t,me,ue,s,We),!ue.centroidVertexBuffer){const lt=ye.attributes.a_centroid_pos;lt!==void 0&&V.vertexAttrib2f(lt,0,0)}}H&&(d.context.activeTexture.set(V.TEXTURE0),ae.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),Le.updatePaintBuffers(re));const Me=$.constantOr(null);if(Me&&ae.imageAtlas){const We=ae.imageAtlas,lt=We.patternPositions[Me.to.toString()],ut=We.patternPositions[Me.from.toString()];lt&&ut&&Le.setConstantPatternPositions(lt,ut)}const Ae=d.translatePosMatrix(me.projMatrix,ae,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Ne=s.paint.get("fill-extrusion-vertical-gradient"),He=H?Er(Ae,d,Ne,se,me,re,ae):ka(Ae,d,Ne,se);d.prepareDrawProgram(B,ye,me.toUnwrapped()),ye.draw(B,B.gl.TRIANGLES,x,S,z,n.CullFaceMode.backCCW,He,s.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,s.paint,d.transform.zoom,Le,d.terrain?ue.centroidVertexBuffer:null)}}function ps(d,t,s,p,x,S){const z=[ye=>{let Me=ye.canonical.x-1,Ae=ye.wrap;return Me<0&&(Me=(1<<ye.canonical.z)-1,Ae--),new n.OverscaledTileID(ye.overscaledZ,Ae,ye.canonical.z,Me,ye.canonical.y)},ye=>{let Me=ye.canonical.x+1,Ae=ye.wrap;return Me===1<<ye.canonical.z&&(Me=0,Ae++),new n.OverscaledTileID(ye.overscaledZ,Ae,ye.canonical.z,Me,ye.canonical.y)},ye=>new n.OverscaledTileID(ye.overscaledZ,ye.wrap,ye.canonical.z,ye.canonical.x,(ye.canonical.y===0?1<<ye.canonical.z:ye.canonical.y)-1),ye=>new n.OverscaledTileID(ye.overscaledZ,ye.wrap,ye.canonical.z,ye.canonical.x,ye.canonical.y===(1<<ye.canonical.z)-1?0:ye.canonical.y+1)],B=ye=>{const Me=t.getSource().maxzoom,Ae=lt=>{const ut=t.getTileByID(lt);if(ut&&ut.hasData())return ut.getBucket(x)};let Ne,He,We;return(ye.overscaledZ===ye.canonical.z||ye.overscaledZ>=Me)&&(Ne=Ae(ye.key)),ye.overscaledZ>=Me&&(He=Ae(ye.calculateScaledKey(ye.overscaledZ+1))),ye.overscaledZ>Me&&(We=Ae(ye.calculateScaledKey(ye.overscaledZ-1))),Ne||He||We},V=[0,0,0],$=(ye,Me)=>(V[0]=Math.min(ye.min.y,Me.min.y),V[1]=Math.max(ye.max.y,Me.max.y),V[2]=n.EXTENT-Me.min.x>ye.max.x?Me.min.x-n.EXTENT:ye.max.x,V),H=(ye,Me)=>(V[0]=Math.min(ye.min.x,Me.min.x),V[1]=Math.max(ye.max.x,Me.max.x),V[2]=n.EXTENT-Me.min.y>ye.max.y?Me.min.y-n.EXTENT:ye.max.y,V),re=[(ye,Me)=>$(ye,Me),(ye,Me)=>$(Me,ye),(ye,Me)=>H(ye,Me),(ye,Me)=>H(Me,ye)],se=new n.pointGeometry(0,0);let me,ae,ue;const Le=(ye,Me,Ae,Ne,He)=>{const We=[[Ne?Ae:ye,Ne?ye:Ae,0],[Ne?Ae:Me,Ne?Me:Ae,0]],lt=He<0?n.EXTENT+He:He,ut=[Ne?lt:(ye+Me)/2,Ne?(ye+Me)/2:lt,0];return Ae===0&&He<0||Ae!==0&&He>0?S.getForTilePoints(ue,[ut],!0,ae):We.push(ut),S.getForTilePoints(s,We,!0,me),Math.max(We[0][2],We[1][2],ut[2])/S.exaggeration()};for(let ye=0;ye<4;ye++){const Me=p.borders[ye];if(Me.length===0&&(p.borderDone[ye]=!0),p.borderDone[ye])continue;const Ae=ue=z[ye](s),Ne=B(Ae);if(!Ne||!Ne.enableTerrain||(ae=S.findDEMTileFor(Ae),!ae||!ae.dem))continue;if(!me){const ut=S.findDEMTileFor(s);if(!ut||!ut.dem)return;me=ut}const He=(ye<2?1:5)-ye,We=Ne.borders[He];let lt=0;for(let ut=0;ut<Me.length;ut++){const It=p.featuresOnBorder[Me[ut]],ze=It.borders[ye];let Gt;for(;lt<We.length&&(Gt=Ne.featuresOnBorder[We[lt]],!(Gt.borders[He][1]>ze[0]+3));)Ne.borderDone[He]||Ne.encodeCentroid(void 0,Gt,!1),lt++;if(Gt&&lt<We.length){const Lt=lt;let pn=0;for(;!(Gt.borders[He][0]>ze[1]-3)&&(pn++,++lt!==We.length);)Gt=Ne.featuresOnBorder[We[lt]];if(Gt=Ne.featuresOnBorder[We[Lt]],It.intersectsCount()>1||Gt.intersectsCount()>1||pn!==1){pn!==1&&(lt=Lt),p.encodeCentroid(void 0,It,!1),Ne.borderDone[He]||Ne.encodeCentroid(void 0,Gt,!1);continue}const on=re[ye](It,Gt),an=ye%2?n.EXTENT-1:0;se.x=Le(on[0],Math.min(n.EXTENT-1,on[1]),an,ye<2,on[2]),se.y=0,p.encodeCentroid(se,It,!1),Ne.borderDone[He]||Ne.encodeCentroid(se,Gt,!1)}else p.encodeCentroid(void 0,It,!1)}p.borderDone[ye]=p.needsCentroidUpdate=!0,Ne.borderDone[He]||(Ne.borderDone[He]=Ne.needsCentroidUpdate=!0)}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(d)}const nl=new n.Color(1,0,0,1),Il=new n.Color(0,1,0,1),rl=new n.Color(0,0,1,1),il=new n.Color(1,0,1,1),Fa=new n.Color(0,1,1,1);function js(d,t,s,p){fs(d,0,t+s/2,d.transform.width,s,p)}function Us(d,t,s,p){fs(d,t-s/2,0,s,d.transform.height,p)}function fs(d,t,s,p,x,S){const z=d.context,B=z.gl;B.enable(B.SCISSOR_TEST),B.scissor(t*n.exported.devicePixelRatio,s*n.exported.devicePixelRatio,p*n.exported.devicePixelRatio,x*n.exported.devicePixelRatio),z.clear({color:S}),B.disable(B.SCISSOR_TEST)}function Zo(d,t,s){const p=d.context,x=p.gl,S=s.projMatrix,z=d.useProgram("debug"),B=t.getTileByID(s.key);d.terrain&&d.terrain.setupElevationDraw(B,z);const V=n.DepthMode.disabled,$=n.StencilMode.disabled,H=d.colorModeForRenderPass(),re="$debug";p.activeTexture.set(x.TEXTURE0),d.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),z.draw(p,x.LINE_STRIP,V,$,H,n.CullFaceMode.disabled,hs(S,n.Color.red),re,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments);const se=B.latestRawTileData,me=Math.floor((se&&se.byteLength||0)/1024),ae=t.getTile(s).tileSize,ue=512/Math.min(ae,512)*(s.overscaledZ/d.transform.zoom)*.5;let Le=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(Le+=" => "+s.overscaledZ),function(ye,Me){ye.initDebugOverlayCanvas();const Ae=ye.debugOverlayCanvas,Ne=ye.context.gl,He=ye.debugOverlayCanvas.getContext("2d");He.clearRect(0,0,Ae.width,Ae.height),He.shadowColor="white",He.shadowBlur=2,He.lineWidth=1.5,He.strokeStyle="white",He.textBaseline="top",He.font="bold 36px Open Sans, sans-serif",He.fillText(Me,5,5),He.strokeText(Me,5,5),ye.debugOverlayTexture.update(Ae),ye.debugOverlayTexture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE)}(d,`${Le} ${me}kb`),z.draw(p,x.TRIANGLES,V,$,n.ColorMode.alphaBlended,n.CullFaceMode.disabled,hs(S,n.Color.transparent,ue),re,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments)}const Ra=n.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ns}=Ra;function Ir(d,t,s,p){d.emplaceBack(t,s,p)}class pa{constructor(t){this.vertexArray=new n.StructArrayLayout3f12,this.indices=new n.StructArrayLayout3ui6,Ir(this.vertexArray,-1,-1,1),Ir(this.vertexArray,1,-1,1),Ir(this.vertexArray,-1,1,1),Ir(this.vertexArray,1,1,1),Ir(this.vertexArray,-1,-1,-1),Ir(this.vertexArray,1,-1,-1),Ir(this.vertexArray,-1,1,-1),Ir(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Ns),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=n.SegmentVector.simpleSegment(0,0,36,12)}}function $o(d,t,s,p,x,S){const z=d.gl,B=t.paint.get("sky-atmosphere-color"),V=t.paint.get("sky-atmosphere-halo-color"),$=t.paint.get("sky-atmosphere-sun-intensity"),H=((re,se,me,ae,ue)=>({u_matrix_3f:re,u_sun_direction:se,u_sun_intensity:me,u_color_tint_r:[ae.r,ae.g,ae.b,ae.a],u_color_tint_m:[ue.r,ue.g,ue.b,ue.a],u_luminance:5e-5}))(n.fromMat4([],p),x,$,B,V);z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_CUBE_MAP_POSITIVE_X+S,t.skyboxTexture,0),s.draw(d,z.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,n.ColorMode.unblended,n.CullFaceMode.frontCW,H,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const fa={symbol:function(d,t,s,p,x){if(d.renderPass!=="translucent")return;const S=n.StencilMode.disabled,z=d.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(B,V,$,H,re,se,me){const ae=V.transform,ue=re==="map",Le=se==="map";for(const ye of B){const Me=H.getTile(ye),Ae=Me.getBucket($);if(!Ae||!Ae.text||!Ae.text.segments.get().length)continue;const Ne=n.evaluateSizeForZoom(Ae.textSizeData,ae.zoom),He=ht(Me,1,V.transform.zoom),We=On(ye.projMatrix,Le,ue,V.transform,He),lt=$.layout.get("icon-text-fit")!=="none"&&Ae.hasIconData();if(Ne){const ut=Math.pow(2,ae.zoom-Me.tileID.overscaledZ),It=ae.elevation;qo(Ae,ue,Le,me,n.symbolSize,ae,We,ye.projMatrix,ut,Ne,lt,It?ze=>It.getAtTileOffset(ye,ze.x,ze.y):ze=>0)}}}(p,d,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),x),s.paint.get("icon-opacity").constantOr(1)!==0&&Bs(d,t,s,p,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),S,z),s.paint.get("text-opacity").constantOr(1)!==0&&Bs(d,t,s,p,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),S,z),t.map.showCollisionBoxes&&(yo(d,t,s,p,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),yo(d,t,s,p,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(d,t,s,p){if(d.renderPass!=="translucent")return;const x=s.paint.get("circle-opacity"),S=s.paint.get("circle-stroke-width"),z=s.paint.get("circle-stroke-opacity"),B=s.layout.get("circle-sort-key").constantOr(1)!==void 0;if(x.constantOr(1)===0&&(S.constantOr(1)===0||z.constantOr(1)===0))return;const V=d.context,$=V.gl,H=d.depthModeForSublayer(0,n.DepthMode.ReadOnly),re=n.StencilMode.disabled,se=d.colorModeForRenderPass(),me=[];for(let ae=0;ae<p.length;ae++){const ue=p[ae],Le=t.getTile(ue),ye=Le.getBucket(s);if(!ye)continue;const Me=ye.programConfigurations.get(s.id),Ae=Ti(s),Ne={programConfiguration:Me,program:d.useProgram("circle",Me,Ae),layoutVertexBuffer:ye.layoutVertexBuffer,indexBuffer:ye.indexBuffer,uniformValues:us(d,ue,Le,s),tile:Le};if(B){const He=ye.segments.get();for(const We of He)me.push({segments:new n.SegmentVector([We]),sortKey:We.sortKey,state:Ne})}else me.push({segments:ye.segments,sortKey:0,state:Ne})}B&&me.sort((ae,ue)=>ae.sortKey-ue.sortKey);for(const ae of me){const{programConfiguration:ue,program:Le,layoutVertexBuffer:ye,indexBuffer:Me,uniformValues:Ae,tile:Ne}=ae.state,He=ae.segments;d.terrain&&d.terrain.setupElevationDraw(Ne,Le,{useDepthForOcclusion:!0}),d.prepareDrawProgram(V,Le,Ne.tileID.toUnwrapped()),Le.draw(V,$.TRIANGLES,H,re,se,n.CullFaceMode.disabled,Ae,s.id,ye,Me,He,s.paint,d.transform.zoom,ue)}},heatmap:function(d,t,s,p){if(s.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const x=d.context,S=x.gl,z=n.StencilMode.disabled,B=new n.ColorMode([S.ONE,S.ONE],n.Color.transparent,[!0,!0,!0,!0]);(function(V,$,H){const re=V.gl;V.activeTexture.set(re.TEXTURE1),V.viewport.set([0,0,$.width/4,$.height/4]);let se=H.heatmapFbo;if(se)re.bindTexture(re.TEXTURE_2D,se.colorAttachment.get()),V.bindFramebuffer.set(se.framebuffer);else{const me=re.createTexture();re.bindTexture(re.TEXTURE_2D,me),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MAG_FILTER,re.LINEAR),se=H.heatmapFbo=V.createFramebuffer($.width/4,$.height/4,!1),function(ae,ue,Le,ye){const Me=ae.gl;Me.texImage2D(Me.TEXTURE_2D,0,Me.RGBA,ue.width/4,ue.height/4,0,Me.RGBA,ae.extRenderToTextureHalfFloat?ae.extTextureHalfFloat.HALF_FLOAT_OES:Me.UNSIGNED_BYTE,null),ye.colorAttachment.set(Le)}(V,$,me,se)}})(x,d,s),x.clear({color:n.Color.transparent});for(let V=0;V<p.length;V++){const $=p[V];if(t.hasRenderableParent($))continue;const H=t.getTile($),re=H.getBucket(s);if(!re)continue;const se=re.programConfigurations.get(s.id),me=d.useProgram("heatmap",se),{zoom:ae}=d.transform;d.terrain&&d.terrain.setupElevationDraw(H,me),d.prepareDrawProgram(x,me,$.toUnwrapped()),me.draw(x,S.TRIANGLES,n.DepthMode.disabled,z,B,n.CullFaceMode.disabled,ds($.projMatrix,H,ae,s.paint.get("heatmap-intensity")),s.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,s.paint,d.transform.zoom,se)}x.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(x,S){const z=x.context,B=z.gl,V=S.heatmapFbo;if(!V)return;z.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,V.colorAttachment.get()),z.activeTexture.set(B.TEXTURE1);let $=S.colorRampTexture;$||($=S.colorRampTexture=new n.Texture(z,S.colorRamp,B.RGBA)),$.bind(B.LINEAR,B.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(z,B.TRIANGLES,n.DepthMode.disabled,n.StencilMode.disabled,x.colorModeForRenderPass(),n.CullFaceMode.disabled,((H,re,se,me)=>{const ae=n.create$1();n.ortho(ae,0,H.width,H.height,0,0,1);const ue=H.context.gl;return{u_matrix:ae,u_world:[ue.drawingBufferWidth,ue.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:re.paint.get("heatmap-opacity")}})(x,S),S.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,S.paint,x.transform.zoom)}(d,s))},line:function(d,t,s,p){if(d.renderPass!=="translucent")return;const x=s.paint.get("line-opacity"),S=s.paint.get("line-width");if(x.constantOr(1)===0||S.constantOr(1)===0)return;const z=d.depthModeForSublayer(0,n.DepthMode.ReadOnly),B=d.colorModeForRenderPass(),V=s.paint.get("line-dasharray"),$=V.constantOr(1),H=s.layout.get("line-cap"),re=s.paint.get("line-pattern"),se=re.constantOr(1),me=s.paint.get("line-gradient"),ae=s.getCrossfadeParameters(),ue=se?"linePattern":$?"lineSDF":me?"lineGradient":"line",Le=d.context,ye=Le.gl;for(const Me of p){const Ae=t.getTile(Me);if(se&&!Ae.patternsLoaded())continue;const Ne=Ae.getBucket(s);if(!Ne)continue;d.prepareDrawTile(Me);const He=Ne.programConfigurations.get(s.id),We=d.useProgram(ue,He),lt=re.constantOr(null);if(lt&&Ae.imageAtlas){const Lt=Ae.imageAtlas,pn=Lt.patternPositions[lt.to.toString()],on=Lt.patternPositions[lt.from.toString()];pn&&on&&He.setConstantPatternPositions(pn,on)}const ut=V.constantOr(null),It=H.constantOr(null);if(!se&&ut&&It&&Ae.lineAtlas){const Lt=Ae.lineAtlas,pn=Lt.getDash(ut.to,It),on=Lt.getDash(ut.from,It);pn&&on&&He.setConstantPatternPositions(pn,on)}const ze=d.terrain?Me.projMatrix:null,Gt=se?to(d,Ae,s,ae,ze):$?el(d,Ae,s,ae,ze):me?za(d,Ae,s,ze,Ne.lineClipsArray.length):zs(d,Ae,s,ze);if(se)Le.activeTexture.set(ye.TEXTURE0),Ae.imageAtlasTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),He.updatePaintBuffers(ae);else if($)Le.activeTexture.set(ye.TEXTURE0),Ae.lineAtlasTexture.bind(ye.LINEAR,ye.REPEAT),He.updatePaintBuffers(ae);else if(me){const Lt=Ne.gradients[s.id];let pn=Lt.texture;if(s.gradientVersion!==Lt.version){let on=256;if(s.stepInterpolant){const an=t.getSource().maxzoom,Pn=Me.canonical.z===an?Math.ceil(1<<d.transform.maxZoom-Me.canonical.z):1;on=n.clamp(n.nextPowerOfTwo(Ne.maxLineLength/n.EXTENT*1024*Pn),256,Le.maxTextureSize)}Lt.gradient=n.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:on,image:Lt.gradient||void 0,clips:Ne.lineClipsArray}),Lt.texture?Lt.texture.update(Lt.gradient):Lt.texture=new n.Texture(Le,Lt.gradient,ye.RGBA),Lt.version=s.gradientVersion,pn=Lt.texture}Le.activeTexture.set(ye.TEXTURE0),pn.bind(s.stepInterpolant?ye.NEAREST:ye.LINEAR,ye.CLAMP_TO_EDGE)}d.prepareDrawProgram(Le,We,Me.toUnwrapped()),We.draw(Le,ye.TRIANGLES,z,d.stencilModeForClipping(Me),B,n.CullFaceMode.disabled,Gt,s.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,s.paint,d.transform.zoom,He,Ne.layoutVertexBuffer2)}},fill:function(d,t,s,p){const x=s.paint.get("fill-color"),S=s.paint.get("fill-opacity");if(S.constantOr(1)===0)return;const z=d.colorModeForRenderPass(),B=s.paint.get("fill-pattern"),V=d.opaquePassEnabledForLayer()&&!B.constantOr(1)&&x.constantOr(n.Color.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===V){const $=d.depthModeForSublayer(1,d.renderPass==="opaque"?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly);Lo(d,t,s,p,$,z,!1)}if(d.renderPass==="translucent"&&s.paint.get("fill-antialias")){const $=d.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,n.DepthMode.ReadOnly);Lo(d,t,s,p,$,z,!0)}},"fill-extrusion":function(d,t,s,p){const x=s.paint.get("fill-extrusion-opacity");if(x!==0&&d.renderPass==="translucent"){const S=new n.DepthMode(d.context.gl.LEQUAL,n.DepthMode.ReadWrite,d.depthRangeFor3D);if(x!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))da(d,t,s,p,S,n.StencilMode.disabled,n.ColorMode.disabled),da(d,t,s,p,S,d.stencilModeFor3D(),d.colorModeForRenderPass());else{const z=d.colorModeForRenderPass();da(d,t,s,p,S,n.StencilMode.disabled,z)}}},hillshade:function(d,t,s,p){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const x=d.context,S=d.depthModeForSublayer(0,n.DepthMode.ReadOnly),z=d.colorModeForRenderPass(),B=d.terrain&&d.terrain.renderingToTexture,[V,$]=d.renderPass!=="translucent"||B?[{},p]:d.stencilConfigForOverlap(p);for(const H of $){const re=t.getTile(H);if(re.needsHillshadePrepare&&d.renderPass==="offscreen")Ui(d,re,s,S,n.StencilMode.disabled,z);else if(d.renderPass==="translucent"){const se=B&&d.terrain?d.terrain.stencilModeForRTTOverlap(H):V[H.overscaledZ];As(d,H,re,s,S,se,z)}}x.viewport.set([0,0,d.width,d.height])},raster:function(d,t,s,p,x,S){if(d.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!p.length)return;const z=d.context,B=z.gl,V=t.getSource(),$=d.useProgram("raster"),H=d.colorModeForRenderPass(),re=d.terrain&&d.terrain.renderingToTexture,[se,me]=V instanceof te||re?[{},p]:d.stencilConfigForOverlap(p),ae=me[me.length-1].overscaledZ,ue=!d.options.moving;for(const Le of me){const ye=re?n.DepthMode.disabled:d.depthModeForSublayer(Le.overscaledZ-ae,s.paint.get("raster-opacity")===1?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly,B.LESS),Me=Le.toUnwrapped(),Ae=t.getTile(Le);if(re&&(!Ae||!Ae.hasData()))continue;const Ne=re?Le.projMatrix:d.transform.calculateProjMatrix(Me,ue),He=d.terrain&&re?d.terrain.stencilModeForRTTOverlap(Le):se[Le.overscaledZ],We=S?0:s.paint.get("raster-fade-duration");Ae.registerFadeDuration(We);const lt=t.findLoadedParent(Le,0),ut=Ls(Ae,lt,t,d.transform,We);let It,ze;d.terrain&&d.terrain.prepareDrawTile(Le);const Gt=s.paint.get("raster-resampling")==="nearest"?B.NEAREST:B.LINEAR;z.activeTexture.set(B.TEXTURE0),Ae.texture.bind(Gt,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),z.activeTexture.set(B.TEXTURE1),lt?(lt.texture.bind(Gt,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),It=Math.pow(2,lt.tileID.overscaledZ-Ae.tileID.overscaledZ),ze=[Ae.tileID.canonical.x*It%1,Ae.tileID.canonical.y*It%1]):Ae.texture.bind(Gt,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST);const Lt=El(Ne,ze||[0,0],It||1,ut,s);d.prepareDrawProgram(z,$,Me),V instanceof te?$.draw(z,B.TRIANGLES,ye,n.StencilMode.disabled,H,n.CullFaceMode.disabled,Lt,s.id,V.boundsBuffer,d.quadTriangleIndexBuffer,V.boundsSegments):$.draw(z,B.TRIANGLES,ye,He,H,n.CullFaceMode.disabled,Lt,s.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}},background:function(d,t,s,p){const x=s.paint.get("background-color"),S=s.paint.get("background-opacity");if(S===0)return;const z=d.context,B=z.gl,V=d.transform,$=V.tileSize,H=s.paint.get("background-pattern");if(d.isPatternMissing(H))return;const re=!H&&x.a===1&&S===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==re)return;const se=n.StencilMode.disabled,me=d.depthModeForSublayer(0,re==="opaque"?n.DepthMode.ReadWrite:n.DepthMode.ReadOnly),ae=d.colorModeForRenderPass(),ue=d.useProgram(H?"backgroundPattern":"background"),Le=p||V.coveringTiles({tileSize:$});H&&(z.activeTexture.set(B.TEXTURE0),d.imageManager.bind(d.context));const ye=s.getCrossfadeParameters();for(const Me of Le){const Ae=Me.toUnwrapped(),Ne=p?Me.projMatrix:d.transform.calculateProjMatrix(Ae);d.prepareDrawTile(Me);const He=H?ca(Ne,S,d,H,{tileID:Me,tileSize:$},ye):Go(Ne,S,x);d.prepareDrawProgram(z,ue,Ae),ue.draw(z,B.TRIANGLES,me,se,ae,n.CullFaceMode.disabled,He,s.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}},sky:function(d,t,s){const p=s.paint.get("sky-opacity");if(p===0)return;const x=d.context,S=s.paint.get("sky-type"),z=new n.DepthMode(x.gl.LEQUAL,n.DepthMode.ReadOnly,[0,1]),B=d.frameCounter/1e3%1;S==="atmosphere"?d.renderPass==="offscreen"?s.needsSkyboxCapture(d)&&(function(V,$,H,re){const se=V.context,me=se.gl;let ae=$.skyboxFbo;if(!ae){ae=$.skyboxFbo=se.createFramebuffer(32,32,!1),$.skyboxGeometry=new pa(se),$.skyboxTexture=se.gl.createTexture(),me.bindTexture(me.TEXTURE_CUBE_MAP,$.skyboxTexture),me.texParameteri(me.TEXTURE_CUBE_MAP,me.TEXTURE_WRAP_S,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_CUBE_MAP,me.TEXTURE_WRAP_T,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_CUBE_MAP,me.TEXTURE_MIN_FILTER,me.LINEAR),me.texParameteri(me.TEXTURE_CUBE_MAP,me.TEXTURE_MAG_FILTER,me.LINEAR);for(let Me=0;Me<6;++Me)me.texImage2D(me.TEXTURE_CUBE_MAP_POSITIVE_X+Me,0,me.RGBA,32,32,0,me.RGBA,me.UNSIGNED_BYTE,null)}se.bindFramebuffer.set(ae.framebuffer),se.viewport.set([0,0,32,32]);const ue=$.getCenter(V,!0),Le=V.useProgram("skyboxCapture"),ye=new Float64Array(16);n.identity(ye),n.rotateY(ye,ye,.5*-Math.PI),$o(se,$,Le,ye,ue,0),n.identity(ye),n.rotateY(ye,ye,.5*Math.PI),$o(se,$,Le,ye,ue,1),n.identity(ye),n.rotateX(ye,ye,.5*-Math.PI),$o(se,$,Le,ye,ue,2),n.identity(ye),n.rotateX(ye,ye,.5*Math.PI),$o(se,$,Le,ye,ue,3),n.identity(ye),$o(se,$,Le,ye,ue,4),n.identity(ye),n.rotateY(ye,ye,Math.PI),$o(se,$,Le,ye,ue,5),se.viewport.set([0,0,V.width,V.height])}(d,s),s.markSkyboxValid(d)):d.renderPass==="sky"&&function(V,$,H,re,se){const me=V.context,ae=me.gl,ue=V.transform,Le=V.useProgram("skybox");me.activeTexture.set(ae.TEXTURE0),ae.bindTexture(ae.TEXTURE_CUBE_MAP,$.skyboxTexture);const ye=((Me,Ae,Ne,He,We)=>({u_matrix:Me,u_sun_direction:Ae,u_cubemap:0,u_opacity:He,u_temporal_offset:We}))(ue.skyboxMatrix,$.getCenter(V,!1),0,re,se);V.prepareDrawProgram(me,Le),Le.draw(me,ae.TRIANGLES,H,n.StencilMode.disabled,V.colorModeForRenderPass(),n.CullFaceMode.backCW,ye,"skybox",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}(d,s,z,p,B):S==="gradient"&&d.renderPass==="sky"&&function(V,$,H,re,se){const me=V.context,ae=me.gl,ue=V.transform,Le=V.useProgram("skyboxGradient");$.skyboxGeometry||($.skyboxGeometry=new pa(me)),me.activeTexture.set(ae.TEXTURE0);let ye=$.colorRampTexture;ye||(ye=$.colorRampTexture=new n.Texture(me,$.colorRamp,ae.RGBA)),ye.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);const Me=((Ae,Ne,He,We,lt)=>({u_matrix:Ae,u_color_ramp:0,u_center_direction:Ne,u_radius:n.degToRad(He),u_opacity:We,u_temporal_offset:lt}))(ue.skyboxMatrix,$.getCenter(V,!1),$.paint.get("sky-gradient-radius"),re,se);V.prepareDrawProgram(me,Le),Le.draw(me,ae.TRIANGLES,H,n.StencilMode.disabled,V.colorModeForRenderPass(),n.CullFaceMode.backCW,Me,"skyboxGradient",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}(d,s,z,p,B)},debug:function(d,t,s){for(let p=0;p<s.length;p++)Zo(d,t,s[p])},custom:function(d,t,s){const p=d.context,x=s.implementation;if(d.renderPass==="offscreen"){const S=x.prerender;S&&(d.setCustomLayerDefaults(),p.setColorMode(d.colorModeForRenderPass()),S.call(x,p.gl,d.transform.customLayerMatrix()),p.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),p.setColorMode(d.colorModeForRenderPass()),p.setStencilMode(n.StencilMode.disabled);const S=x.renderingMode==="3d"?new n.DepthMode(d.context.gl.LEQUAL,n.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,n.DepthMode.ReadOnly);p.setDepthMode(S),x.render(p.gl,d.transform.customLayerMatrix()),p.setDirty(),d.setBaseState(),p.bindFramebuffer.set(null)}}};class Wo{constructor(t,s){this.context=new Sn(t),this.transform=s,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=n.SourceCache.maxUnderzooming+n.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ta,this.gpuTimers={},this.frameCounter=0}updateTerrain(t,s){const p=!!t&&!!t.terrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Qa(this,t));const x=this._terrain;this.transform.elevation=p?x:null,x.update(t,this.transform,s)}_updateFog(t){const s=t.fog;if(!s||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,x]=s.getFovAdjustedRange(this.transform._fov);if(p>x)return void(this.transform.fogCullDistSq=null);const S=p+.78*(x-p);this.transform.fogCullDistSq=S*S}get terrain(){return this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,s){if(this.width=t*n.exported.devicePixelRatio,this.height=s*n.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const t=this.context,s=new n.StructArrayLayout2i4;s.emplaceBack(0,0),s.emplaceBack(n.EXTENT,0),s.emplaceBack(0,n.EXTENT),s.emplaceBack(n.EXTENT,n.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(s,n.posAttributes.members),this.tileExtentSegments=n.SegmentVector.simpleSegment(0,0,4,2);const p=new n.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(n.EXTENT,0),p.emplaceBack(0,n.EXTENT),p.emplaceBack(n.EXTENT,n.EXTENT),this.debugBuffer=t.createVertexBuffer(p,n.posAttributes.members),this.debugSegments=n.SegmentVector.simpleSegment(0,0,4,5);const x=new n.StructArrayLayout4i8;x.emplaceBack(0,0,0,0),x.emplaceBack(n.EXTENT,0,n.EXTENT,0),x.emplaceBack(0,n.EXTENT,0,n.EXTENT),x.emplaceBack(n.EXTENT,n.EXTENT,n.EXTENT,n.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(x,X.members),this.rasterBoundsSegments=n.SegmentVector.simpleSegment(0,0,4,2);const S=new n.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(S,n.posAttributes.members),this.viewportSegments=n.SegmentVector.simpleSegment(0,0,4,2);const z=new n.StructArrayLayout1ui2;z.emplaceBack(0),z.emplaceBack(1),z.emplaceBack(3),z.emplaceBack(2),z.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(z);const B=new n.StructArrayLayout3ui6;B.emplaceBack(0,1,2),B.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(B),this.emptyTexture=new n.Texture(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA),this.identityMat=n.create$1();const V=this.context.gl;this.stencilClearMode=new n.StencilMode({func:V.ALWAYS,mask:0},0,255,V.ZERO,V.ZERO,V.ZERO),this.loadTimeStamps.push(n.window.performance.now())}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=n.create$1();n.ortho(p,0,this.width,this.height,0,0,1),n.scale$1(p,p,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,s.TRIANGLES,n.DepthMode.disabled,this.stencilClearMode,n.ColorMode.disabled,n.CullFaceMode.disabled,ls(p),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s,p){if(!(s&&this.currentStencilSource!==s.id&&t.isTileClipped()&&p&&p.length))return;this.currentStencilSource=s.id;const x=this.context,S=x.gl;this.nextStencilID+p.length>256&&this.clearStencil(),x.setColorMode(n.ColorMode.disabled),x.setDepthMode(n.DepthMode.disabled);const z=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const B of p){const V=this._tileClippingMaskIDs[B.key]=this.nextStencilID++;z.draw(x,S.TRIANGLES,n.DepthMode.disabled,new n.StencilMode({func:S.ALWAYS,mask:0},V,255,S.KEEP,S.KEEP,S.REPLACE),n.ColorMode.disabled,n.CullFaceMode.disabled,ls(B.projMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new n.StencilMode({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const s=this.context.gl;return new n.StencilMode({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,p=t.sort((z,B)=>B.overscaledZ-z.overscaledZ),x=p[p.length-1].overscaledZ,S=p[0].overscaledZ-x+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const z={};for(let B=0;B<S;B++)z[B+x]=new n.StencilMode({func:s.GEQUAL,mask:255},B+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=S,[z,p]}return[{[x]:n.StencilMode.disabled},p]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const s=1/8;return new n.ColorMode([t.CONSTANT_COLOR,t.ONE],new n.Color(s,s,s,0),[!0,!0,!0,!0])}return this.renderPass==="opaque"?n.ColorMode.unblended:n.ColorMode.alphaBlended}depthModeForSublayer(t,s,p){if(!this.opaquePassEnabledForLayer())return n.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new n.DepthMode(p||this.context.gl.LEQUAL,s,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(n.exported.now()),this.imageManager.beginFrame();const p=this.style.order,x=this.style._sourceCaches;for(const $ in x){const H=x[$];H.used&&H.prepare(this.context)}const S={},z={},B={};for(const $ in x){const H=x[$];S[$]=H.getVisibleCoordinates(),z[$]=S[$].slice().reverse(),B[$]=H.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let $=0;$<p.length;$++)if(this.style._layers[p[$]].is3D()){this.opaquePassCutoff=$;break}if(this.terrain&&(this.terrain.updateTileBinding(B),this.opaquePassCutoff=0),!n.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const $ of p){const H=this.style._layers[$],re=t._getLayerSourceCache(H);if(!H.hasOffscreenPass()||H.isHidden(this.transform.zoom))continue;const se=re?z[re.id]:void 0;(H.type==="custom"||H.isSky()||se&&se.length)&&this.renderLayer(this,re,H,se)}this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let V=n.Color.transparent;if(this.style.fog&&(V=this.style.fog.properties.get("color")),this.context.clear({color:s.showOverdrawInspector?n.Color.black:V,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const $=this.style._layers[p[this.currentLayer]],H=t._getLayerSourceCache($);if($.isSky())continue;const re=H?z[H.id]:void 0;this._renderTileClippingMasks($,H,re),this.renderLayer(this,H,$,re)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const $=this.style._layers[p[this.currentLayer]],H=t._getLayerSourceCache($);$.isSky()&&this.renderLayer(this,H,$,H?z[H.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const $=this.style._layers[p[this.currentLayer]],H=t._getLayerSourceCache($);if($.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped($)){if($.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const re=H?($.type==="symbol"?B:z)[H.id]:void 0;this._renderTileClippingMasks($,H,H?S[H.id]:void 0),this.renderLayer(this,H,$,re),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let $=null;n.values(this.style._layers).forEach(H=>{const re=t._getLayerSourceCache(H);re&&!H.isHidden(this.transform.zoom)&&(!$||$.getSource().maxzoom<re.getSource().maxzoom)&&($=re)}),$&&this.options.showTileBoundaries&&fa.debug(this,$,$.getVisibleCoordinates())}this.options.showPadding&&function($){const H=$.transform.padding;js($,$.transform.height-(H.top||0),3,nl),js($,H.bottom||0,3,Il),Us($,H.left||0,3,rl),Us($,$.transform.width-(H.right||0),3,il);const re=$.transform.centerPoint;(function(se,me,ae,ue){fs(se,me-1,ae-10,2,20,ue),fs(se,me-10,ae-1,20,2,ue)})($,re.x,$.transform.height-re.y,Fa)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%n.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(n.window.performance.now()),this.saveCanvasCopy())}renderLayer(t,s,p,x){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||x&&x.length)&&(this.id=p.id,this.gpuTimingStart(p),fa[p.type](t,s,p,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let p=this.gpuTimers[t.id];p||(p=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),p.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const s={};for(const p in t){const x=t[p],S=this.context.extTimerQuery,z=S.getQueryObjectEXT(x.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(x.query),s[p]=z}return s}translatePosMatrix(t,s,p,x,S){if(!p[0]&&!p[1])return t;const z=S?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(z){const $=Math.sin(z),H=Math.cos(z);p=[p[0]*H-p[1]*$,p[0]*$+p[1]*H]}const B=[S?p[0]:ht(s,p[0],this.transform.zoom),S?p[1]:ht(s,p[1],this.transform.zoom),0],V=new Float32Array(16);return n.translate(V,t,B),V}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),p=this.imageManager.getPattern(t.to.toString());return!s||!p}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,s=this.style&&this.style.fog,p=[];return this.terrain&&!this.terrain.renderingToTexture&&p.push("TERRAIN"),s&&!t&&s.getOpacity(this.transform.pitch)!==0&&p.push("FOG"),t&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}useProgram(t,s,p){this.cache=this.cache||{};const x=p||[],S=this.currentGlobalDefines().concat(x),z=No.cacheKey(t,S,s);return this.cache[z]||(this.cache[z]=new No(this.context,t,Cs[t],s,Oa[t],S)),this.cache[z]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=n.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(t){this.terrain&&this.terrain.prepareDrawTile(t)}prepareDrawProgram(t,s,p){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const S=x.getOpacity(this.transform.pitch);S!==0&&s.setFogUniformValues(t,((z,B,V,$)=>{const H=B.properties.get("color"),re=z.frameCounter/1e3%1,se=[H.r/H.a,H.g/H.a,H.b/H.a,$];return{u_fog_matrix:V?z.transform.calculateFogTileMatrix(V):z.identityMat,u_fog_range:B.getFovAdjustedRange(z.transform._fov),u_fog_color:se,u_fog_horizon_blend:B.properties.get("horizon-blend"),u_fog_temporal_offset:re}})(this,x,p,S))}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}}class ms{constructor(t=0,s=0,p=0,x=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(p)||p<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=p,this.right=x}interpolate(t,s,p){return s.top!=null&&t.top!=null&&(this.top=n.number(t.top,s.top,p)),s.bottom!=null&&t.bottom!=null&&(this.bottom=n.number(t.bottom,s.bottom,p)),s.left!=null&&t.left!=null&&(this.left=n.number(t.left,s.left,p)),s.right!=null&&t.right!=null&&(this.right=n.number(t.right,s.right,p)),this}getCenter(t,s){const p=n.clamp((this.left+t-this.right)/2,0,t),x=n.clamp((this.top+s-this.bottom)/2,0,s);return new n.pointGeometry(p,x)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ms(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ro(d,t){return[d[4*t],d[4*t+1],d[4*t+2],d[4*t+3]]}function Ba(d,t,s){d[4*t+0]=s[0],d[4*t+1]=s[1],d[4*t+2]=s[2],d[4*t+3]=s[3]}function _o(d,t){const s=ro(d,3);n.fromQuat(d,t),Ba(d,3,s)}function Gi(d,t){Ba(d,3,[t[0],t[1],t[2],1])}function gi(d,t){const s=n.identity$1([]);return n.rotateZ$1(s,s,-t),n.rotateX$1(s,s,-d),s}function Xr(d,t){const s=[d[0],d[1],0],p=[t[0],t[1],0];if(n.length(s)>=1e-15){const z=n.normalize([],s);n.scale(p,z,n.dot(p,z)),t[0]=p[0],t[1]=p[1]}const x=n.cross([],t,d);if(n.len(x)<1e-15)return null;const S=Math.atan2(-x[1],x[0]);return gi(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),S)}class gs{constructor(t,s){this.position=t,this.orientation=s}get position(){return this._position}set position(t){this._position=this._renderWorldCopies?function(s){if(!s)return;const p=Array.isArray(s)?new n.MercatorCoordinate(s[0],s[1],s[2]):s;return p.x=n.wrap(p.x,0,1),p}(t):t}lookAtPoint(t,s){if(this.orientation=null,!this.position)return;const p=this._elevation?this._elevation.getAtPointOrZero(n.MercatorCoordinate.fromLngLat(t)):0,x=this.position,S=n.MercatorCoordinate.fromLngLat(t,p),z=[S.x-x.x,S.y-x.y,S.z-x.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=Xr(z,s)}setPitchBearing(t,s){this.orientation=gi(n.degToRad(t),n.degToRad(-s))}}class Vi{constructor(t,s){this._transform=n.identity([]),this._orientation=n.identity$1([]),s&&(this._orientation=s,_o(this._transform,this._orientation)),t&&Gi(this._transform,t)}get mercatorPosition(){const t=this.position;return new n.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=ro(this._transform,3);return[t[0],t[1],t[2]]}set position(t){Gi(this._transform,t)}get orientation(){return this._orientation}set orientation(t){this._orientation=t,_o(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,s){this._orientation=gi(t,s),_o(this._transform,this._orientation)}forward(){const t=ro(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=ro(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=ro(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,s){const p=new Float64Array(16);return n.invert(p,this.getWorldToCamera(t,s)),p}getWorldToCameraPosition(t,s,p){const x=this.position;n.scale(x,x,-t);const S=new Float64Array(16);return n.fromScaling(S,[p,p,p]),n.translate(S,S,x),S[10]*=s,S}getWorldToCamera(t,s){const p=new Float64Array(16),x=new Float64Array(4),S=this.position;return n.conjugate(x,this._orientation),n.scale(S,S,-t),n.fromQuat(p,x),n.translate(p,p,S),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=s,p[9]*=s,p[10]*=s,p[11]*=s,p}getCameraToClipPerspective(t,s,p,x){const S=new Float64Array(16);return n.perspective(S,t,s,p,x),S}getDistanceToElevation(t){const s=t===0?0:n.mercatorZfromAltitude(t,this.position[1]),p=this.forward();return(s-this.position[2])/p[2]}clone(){return new Vi([...this.position],[...this.orientation])}}class ma{constructor(t,s,p,x,S){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=S===void 0||S,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=p==null?0:p,this._maxPitch=x==null?60:x,this.setMaxBounds(),this.width=0,this.height=0,this._center=new n.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ms,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._camera=new Vi,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const t=new ma(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._cameraZoom=this._cameraZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,t?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(t){this._terrainEnabled()&&this._cameraZoom==null&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),t&&this._constrainCameraAltitude(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return n.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return n.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const s=-n.wrap(t,-180,180)*Math.PI/180;var p;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(p=new n.ARRAY_TYPE(4),n.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(x,S,z){var B=S[0],V=S[1],$=S[2],H=S[3],re=Math.sin(z),se=Math.cos(z);x[0]=B*se+$*re,x[1]=V*se+H*re,x[2]=B*-re+$*se,x[3]=V*-re+H*se}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=n.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const t=this._elevation.getAtPointOrZero(n.MercatorCoordinate.fromLngLat(this.center),-1);return t===-1?(this._cameraZoom=null,!1):(this._centerAltitude=t,!0)}_updateCameraOnTerrain(){const t=this.cameraToCenterDistance/this.worldSize,s=n.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(s+t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let x=0,S=0;for(let z=0;z<s.length;z++){const B=new n.pointGeometry(s[z][0]*this.width,p+s[z][1]*(this.height-p)),V=t.pointCoordinate(B);if(!V)continue;const $=1/Math.hypot(V[0]-this._camera.position[0],V[1]-this._camera.position[1]);x+=V[3]*$,S+=$}return S===0?NaN:x/S}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._cameraZoom==null||!this._elevation)return;const t=this._cameraZoom,s=this._elevation.getAtPointOrZero(n.MercatorCoordinate.fromLngLat(this.center)),p=n.mercatorZfromAltitude(s,this.center.lat),x=this._mercatorZfromZoom(t),S=this._mercatorZfromZoom(this._maxZoom),z=Math.max(x-p,S);this._setZoom(this._zoomFromMercatorZ(z))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let p;p=t.z<this._camera.position[2]?[s.x,s.y,s.z]:[t.x,t.y,t.z];const x=n.length(n.sub([],this._camera.position,p));return n.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let s=!1;if(t.orientation&&!n.exactEquals(t.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(t.orientation)),t.position){const p=[t.position.x,t.position.y,t.position.z];n.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,s=new gs;return s.position=new n.MercatorCoordinate(t[0],t[1],t[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this._renderWorldCopies,s}_setCameraOrientation(t){if(!n.length$1(t))return!1;n.normalize$1(t,t);const s=n.transformQuat([],[0,0,-1],t),p=n.transformQuat([],[0,-1,0],t);if(p[2]<0)return!1;const x=Xr(s,p);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(t){const s=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;t[2]=n.clamp(t[2],x/p,x/s),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,p){this._unmodified=!1,this._edgeInsets.interpolate(t,s,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new n.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const p=this.pointCoordinate(new n.pointGeometry(0,0)),x=this.pointCoordinate(new n.pointGeometry(this.width,0)),S=this.pointCoordinate(new n.pointGeometry(this.width,this.height)),z=this.pointCoordinate(new n.pointGeometry(0,this.height)),B=Math.floor(Math.min(p.x,x.x,S.x,z.x)),V=Math.floor(Math.max(p.x,x.x,S.x,z.x)),$=1;for(let H=B-$;H<=V+$;H++)H!==0&&s.push(new n.UnwrappedTileID(H,t))}return s}coveringTiles(t){let s=this.coveringZoomLevel(t);const p=s,x=this.elevation&&!t.isTerrainDEM;if(t.minzoom!==void 0&&s<t.minzoom)return[];t.maxzoom!==void 0&&s>t.maxzoom&&(s=t.maxzoom);const S=n.MercatorCoordinate.fromLngLat(this.center),z=1<<s,B=[z*S.x,z*S.y,0],V=ee.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s),$=this.pointCoordinate(this.getCameraPoint()),H=z*n.mercatorZfromAltitude(1,this.center.lat),re=this._camera.position[2]/n.mercatorZfromAltitude(1,this.center.lat),se=[z*$.x,z*$.y,re],me=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ae=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation?s:0,ue=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Le=t.isTerrainDEM?-ue:this._elevation?this._elevation.getMinElevationBelowMSL():0,ye=ze=>({aabb:new Q([ze*z,0,Le],[(ze+1)*z,z,ue]),zoom:0,x:0,y:0,wrap:ze,fullyVisible:!1}),Me=[],Ae=[],Ne=s,He=t.reparseOverscaled?p:s,We=ze=>{if(!this._elevation||!ze.tileID)return;const Gt=this._elevation.getMinMaxForTile(ze.tileID),Lt=ze.aabb;Gt?(Lt.min[2]=Gt.min,Lt.max[2]=Gt.max,Lt.center[2]=(Lt.min[2]+Lt.max[2])/2):(ze.shouldSplit=It(ze),ze.shouldSplit||(Lt.min[2]=Lt.max[2]=Lt.center[2]=this._centerAltitude))},lt=ze=>ze*ze,ut=lt((re-this._centerAltitude)*H),It=ze=>{if(ze.zoom<ae)return!0;if(ze.zoom===Ne)return!1;if(ze.shouldSplit!=null)return ze.shouldSplit;const Gt=ze.aabb.distanceX(se),Lt=ze.aabb.distanceY(se);let pn=ut;x&&(pn=lt(ze.aabb.distanceZ(se)*H));const on=Gt*Gt+Lt*Lt+pn;return on<lt((1<<Ne-ze.zoom)*me*((an,Pn)=>{if(Pn*lt(.707)<an)return 1;const Be=Math.sqrt(Pn/an);return Be/(1.4144271570014144+(Math.pow(1.1,Be-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(pn,ut),on))};if(this._renderWorldCopies)for(let ze=1;ze<=3;ze++)Me.push(ye(-ze)),Me.push(ye(ze));for(Me.push(ye(0));Me.length>0;){const ze=Me.pop(),Gt=ze.x,Lt=ze.y;let pn=ze.fullyVisible;if(!pn){const on=ze.aabb.intersects(V);if(on===0)continue;pn=on===2}if(ze.zoom!==Ne&&It(ze))for(let on=0;on<4;on++){const an=(Gt<<1)+on%2,Pn=(Lt<<1)+(on>>1),Be={aabb:ze.aabb.quadrant(on),zoom:ze.zoom+1,x:an,y:Pn,wrap:ze.wrap,fullyVisible:pn,tileID:void 0,shouldSplit:void 0};x&&(Be.tileID=new n.OverscaledTileID(ze.zoom+1===Ne?He:ze.zoom+1,ze.wrap,ze.zoom+1,an,Pn),We(Be)),Me.push(Be)}else{const on=ze.zoom===Ne?He:ze.zoom;if(t.minzoom&&t.minzoom>on)continue;const an=B[0]-(.5+Gt+(ze.wrap<<ze.zoom))*(1<<s-ze.zoom),Pn=B[1]-.5-Lt,Be=ze.tileID?ze.tileID:new n.OverscaledTileID(on,ze.wrap,ze.zoom,Gt,Lt);Ae.push({tileID:Be,distanceSq:an*an+Pn*Pn})}}if(this.fogCullDistSq){const ze=this.fogCullDistSq;Ae.splice(0,Ae.length,...Ae.filter(Gt=>{const Lt=[0,0,0,1],pn=[n.EXTENT,n.EXTENT,0,1],on=this.calculateFogTileMatrix(Gt.tileID.toUnwrapped());n.transformMat4(Lt,Lt,on),n.transformMat4(pn,pn,on);const an=n.getAABBPointSquareDist(Lt,pn);if(an===0)return!0;let Pn=!1;const Be=this.horizonLineFromTop();if(an>ze&&Be!==0){const nt=this.calculateProjMatrix(Gt.tileID.toUnwrapped());let zt;x&&this._elevation&&(zt=this._elevation.getMinMaxForTile(Gt.tileID)),zt||(zt={min:Le,max:ue});const Yt=n.furthestTileCorner(this.bearing),yn=[Yt[0]*n.EXTENT,Yt[1]*n.EXTENT,zt.max];n.transformMat4$1(yn,yn,nt),Pn=(1-yn[1])*this.height*.5<Be}return an<ze||Pn}))}return Ae.sort((ze,Gt)=>ze.distanceSq-Gt.distanceSq).map(ze=>ze.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=n.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new n.pointGeometry(n.mercatorXfromLng(t.lng)*this.worldSize,n.mercatorYfromLat(s)*this.worldSize)}unproject(t){return new n.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(t,s){const p=this.pointCoordinate(s),x=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(t),z=new n.MercatorCoordinate(S.x-(p.x-x.x),S.y-(p.y-x.y));this.center=this.coordinateLocation(z),this._renderWorldCopies&&(this.center=this.center.wrap())}setLocation(t){this.center=this.coordinateLocation(t),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t){return this._coordinatePoint(this.locationCoordinate(t),!1)}locationPoint3D(t){return this._coordinatePoint(this.locationCoordinate(t),!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t){return n.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t.toLngLat()}pointRayIntersection(t,s){const p=s!=null?s:this._centerAltitude,x=[t.x,t.y,0,1],S=[t.x,t.y,1,1];n.transformMat4(x,x,this.pixelMatrixInverse),n.transformMat4(S,S,this.pixelMatrixInverse);const z=S[3];n.scale$2(x,x,1/x[3]),n.scale$2(S,S,1/z);const B=x[2],V=S[2];return{p0:x,p1:S,t:B===V?0:(p-B)/(V-B)}}screenPointToMercatorRay(t){const s=[t.x,t.y,0,1],p=[t.x,t.y,1,1];return n.transformMat4(s,s,this.pixelMatrixInverse),n.transformMat4(p,p,this.pixelMatrixInverse),n.scale$2(s,s,1/s[3]),n.scale$2(p,p,1/p[3]),s[2]=n.mercatorZfromAltitude(s[2],this._center.lat)*this.worldSize,p[2]=n.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,n.scale$2(s,s,1/this.worldSize),n.scale$2(p,p,1/this.worldSize),new K([s[0],s[1],s[2]],n.normalize([],n.sub([],p,s)))}rayIntersectionCoordinate(t){const{p0:s,p1:p,t:x}=t,S=n.mercatorZfromAltitude(s[2],this._center.lat),z=n.mercatorZfromAltitude(p[2],this._center.lat);return new n.MercatorCoordinate(n.number(s[0],p[0],x)/this.worldSize,n.number(s[1],p[1],x)/this.worldSize,n.number(S,z,x))}pointCoordinate(t){const s=this.horizonLineFromTop(!1),p=new n.pointGeometry(t.x,Math.max(s,t.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(p))}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);const s=this.elevation;let p=this.elevation.pointCoordinate(t);if(p)return new n.MercatorCoordinate(p[0],p[1],p[2]);let x=0,S=this.horizonLineFromTop();if(t.y>S)return this.pointCoordinate(t);const z=.02*S,B=t.clone();for(let V=0;V<10&&S-x>z;V++){B.y=n.number(x,S,.66);const $=s.pointCoordinate(B);$?(S=B.y,p=$):x=B.y}return p?new n.MercatorCoordinate(p[0],p[1],p[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){if(this.elevation)return!this.elevation.pointCoordinate(t);{const s=this.horizonLineFromTop();return t.y<s}}_coordinatePoint(t,s){const p=s&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,x=[t.x*this.worldSize,t.y*this.worldSize,p+t.toAltitude(),1];return n.transformMat4(x,x,this.pixelMatrix),x[3]>0?new n.pointGeometry(x[0]/x[3],x[1]/x[3]):new n.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}getBounds(){return this._terrainEnabled()?this._getBounds3D():new n.LngLatBounds().extend(this.pointLocation(new n.pointGeometry(this._edgeInsets.left,this._edgeInsets.top))).extend(this.pointLocation(new n.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top))).extend(this.pointLocation(new n.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom))).extend(this.pointLocation(new n.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom)))}_getBounds3D(){const t=this.elevation,s=t.visibleDemTiles.reduce((x,S)=>{if(S.dem){const z=S.dem.tree;x.min=Math.min(x.min,z.minimums[0]),x.max=Math.max(x.max,z.maximums[0])}return x},{min:Number.MAX_VALUE,max:0});s.min*=t.exaggeration(),s.max*=t.exaggeration();const p=this.horizonLineFromTop();return[new n.pointGeometry(0,p),new n.pointGeometry(this.width,p),new n.pointGeometry(this.width,this.height),new n.pointGeometry(0,this.height)].reduce((x,S)=>x.extend(this.coordinateLocation(this.rayIntersectionCoordinate(this.pointRayIntersection(S,s.min)))).extend(this.coordinateLocation(this.rayIntersectionCoordinate(this.pointRayIntersection(S,s.max)))),new n.LngLatBounds)}horizonLineFromTop(t=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-.97*s;return t?Math.max(0,p):p}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new n.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,s){const p=t.canonical,x=s/this.zoomScale(p.z),S=p.x+Math.pow(2,p.z)*t.wrap,z=n.identity(new Float64Array(16));return n.translate(z,z,[S*x,p.y*x,0]),n.scale$1(z,z,[x/n.EXTENT,x/n.EXTENT,1]),z}calculateFogTileMatrix(t){const s=t.key,p=this._fogTileMatrixCache;if(p[s])return p[s];const x=this.calculatePosMatrix(t,this.cameraWorldSize);return n.multiply(x,this.worldToFogMatrix,x),p[s]=new Float32Array(x),p[s]}calculateProjMatrix(t,s=!1){const p=t.key,x=s?this._alignedProjMatrixCache:this._projMatrixCache;if(x[p])return x[p];const S=this.calculatePosMatrix(t,this.worldSize);return n.multiply(S,s?this.alignedProjMatrix:this.projMatrix,S),x[p]=new Float32Array(S),x[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const s=this._camera.position,p=this._camera.forward();if(s[2]<=0||p[2]>=0)return;const x=n.mercatorZfromAltitude(1,this._center.lat);s[2]/=x,p[2]/=x,n.normalize(p,p);const S=t.raycast(s,p,t.exaggeration());if(S){const z=n.scaleAndAdd([],s,p,S),B=new n.MercatorCoordinate(z[0],z[1],n.mercatorZfromAltitude(z[2],n.latFromMercatorY(z[1]))),V=this._camera.position,$=B.z+n.length([B.x-V[0],B.y-V[1],B.z-V[2]]);this._cameraZoom=this._zoomFromMercatorZ($),this._centerAltitude=B.toAltitude(),this._center=B.toLngLat(),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const s=t.getAtPointOrZero(this._camera.mercatorPosition),p=this._minimumHeightOverTerrain()*Math.cos(n.degToRad(this._maxPitch)),x=n.mercatorZfromAltitude(s,this._center.lat),S=this._camera.position[2]-x;if(S<p){const z=n.MercatorCoordinate.fromLngLat(this._center,this._centerAltitude),B=this._camera.mercatorPosition,V=[z.x-B.x,z.y-B.y,z.z-B.z],$=n.length(V);V[2]-=p-S;const H=n.length(V);if(H===0)return;n.scale(V,V,$/H),this._camera.position=[z.x-V[0],z.y-V[1],z.z-V[2]],this._camera.orientation=Xr(V,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,s,p,x,S=-90,z=90,B=-180,V=180;const $=this.size,H=this._unmodified;if(this.latRange){const me=this.latRange;S=n.mercatorYfromLat(me[1])*this.worldSize,z=n.mercatorYfromLat(me[0])*this.worldSize,t=z-S<$.y?$.y/(z-S):0}if(this.lngRange){const me=this.lngRange;B=n.mercatorXfromLng(me[0])*this.worldSize,V=n.mercatorXfromLng(me[1])*this.worldSize,s=V-B<$.x?$.x/(V-B):0}const re=this.point,se=Math.max(s||0,t||0);if(se)return this.center=this.unproject(new n.pointGeometry(s?(V+B)/2:re.x,t?(z+S)/2:re.y)),this.zoom+=this.scaleZoom(se),this._unmodified=H,void(this._constraining=!1);if(this.latRange){const me=re.y,ae=$.y/2;me-ae<S&&(x=S+ae),me+ae>z&&(x=z-ae)}if(this.lngRange){const me=re.x,ae=$.x/2;me-ae<B&&(p=B+ae),me+ae>V&&(p=V-ae)}p===void 0&&x===void 0||(this.center=this.unproject(new n.pointGeometry(p!==void 0?p:re.x,x!==void 0?x:re.y))),this._constrainCameraAltitude(),this._unmodified=H,this._constraining=!1}_minZoomForBounds(){const t=(x,S)=>Math.log2(x/(this.tileSize*Math.abs(S[1]-S[0])));let s=0;if(this.latRange){const x=this.latRange;s=t(this.height,[n.mercatorYfromLat(x[0]),n.mercatorYfromLat(x[1])])}let p=0;if(this.lngRange){const x=this.lngRange;p=t(this.width,[n.mercatorXfromLng(x[0]),n.mercatorXfromLng(x[1])])}return Math.max(s,p)}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const s=this.pixelsPerMeter;this._updateCameraState();const p=Math.PI/2+this._pitch,x=this.fovAboveCenter,S=this.elevation?this.elevation.getMinElevationBelowMSL()*s:0,z=(this._camera.position[2]*this.worldSize-S)/Math.cos(this._pitch),B=Math.sin(x)*z/Math.sin(n.clamp(Math.PI-p-x,.01,Math.PI-.01)),V=this.point,$=V.x,H=V.y,re=Math.cos(Math.PI/2-this._pitch)*B+z,se=Math.min(1.01*re,z*(1/this._horizonShift)),me=this.height/50,ae=this._camera.getWorldToCamera(this.worldSize,s),ue=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,me,se);ue[8]=2*-t.x/this.width,ue[9]=2*t.y/this.height;let Le=n.mul$1([],ue,ae);this.mercatorMatrix=n.scale$1([],Le,[this.worldSize,this.worldSize,this.worldSize/s]),this.projMatrix=Le,this.invProjMatrix=n.invert(new Float64Array(16),this.projMatrix);const ye=new Float32Array(16);n.identity(ye),n.scale$1(ye,ye,[1,-1,1]),n.rotateX(ye,ye,this._pitch),n.rotateZ(ye,ye,this.angle);const Me=n.perspective(new Float32Array(16),this._fov,this.width/this.height,me,se),Ae=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Me[8]=2*-t.x/this.width,Me[9]=2*(t.y+Ae)/this.height,this.skyboxMatrix=n.multiply(ye,Me,ye);const Ne=this.width%2/2,He=this.height%2/2,We=Math.cos(this.angle),lt=Math.sin(this.angle),ut=$-Math.round($)+We*Ne+lt*He,It=H-Math.round(H)+We*He+lt*Ne,ze=new Float64Array(Le);if(n.translate(ze,ze,[ut>.5?ut-1:ut,It>.5?It-1:It,0]),this.alignedProjMatrix=ze,Le=n.create$1(),n.scale$1(Le,Le,[this.width/2,-this.height/2,1]),n.translate(Le,Le,[1,-1,0]),this.labelPlaneMatrix=Le,Le=n.create$1(),n.scale$1(Le,Le,[1,-1,1]),n.translate(Le,Le,[-1,-1,0]),n.scale$1(Le,Le,[2/this.width,2/this.height,1]),this.glCoordMatrix=Le,this.pixelMatrix=n.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),Le=n.invert(new Float64Array(16),this.pixelMatrix),!Le)throw new Error("failed to invert matrix");this.pixelMatrixInverse=Le,this._projMatrixCache={},this._alignedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,s=this.cameraPixelsPerMeter,p=this._camera.position,x=1/this.height,S=[t,t,s];n.scale(S,S,x),n.scale(p,p,-1),n.multiply$1(p,p,S);const z=n.create$1();n.translate(z,z,p),n.scale$1(z,z,S),this.mercatorFogMatrix=z,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,s,x)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const t=this._camera.forward(),s=this.cameraToCenterDistance,p=this.point,x=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-n.mercatorZfromAltitude(this._centerAltitude,this.center.lat),S=this.cameraToCenterDistance/x;this._camera.position=[p.x/this.worldSize-t[0]*s/S,p.y/this.worldSize-t[1]*s/S,n.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-t[2]*s/S]}_translateCameraConstrained(t){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=t[2];let x=1;p>0&&(x=Math.min((s-this._camera.position[2])/p,1)),this._camera.position=n.scaleAndAdd([],this._camera.position,t,x),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,s=this._camera.forward(),{pitch:p,bearing:x}=this._camera.getPitchBearing(),S=n.mercatorZfromAltitude(this._centerAltitude,this.center.lat),z=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.degToRad(this._maxPitch)),B=Math.max((t[2]-S)/Math.cos(p),z),V=this._zoomFromMercatorZ(B);n.scaleAndAdd(t,t,s,B),this._pitch=n.clamp(p,n.degToRad(this.minPitch),n.degToRad(this.maxPitch)),this.angle=n.wrap(x,-Math.PI,Math.PI),this._setZoom(n.clamp(V,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=new n.MercatorCoordinate(t[0],t[1],t[2]).toLngLat(),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((this._cameraZoom!=null?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!!this._elevation}isHorizonVisibleForPoints(t,s){const p=Math.min(t.x,s.x),x=Math.max(t.x,s.x),S=Math.min(t.y,s.y),z=Math.max(t.y,s.y),B=[new n.pointGeometry(p,S),new n.pointGeometry(x,z),new n.pointGeometry(p,z),new n.pointGeometry(x,S)],V=this._renderWorldCopies?-3:0,$=this._renderWorldCopies?4:1;for(const H of B){const re=this.pointRayIntersection(H);if(re.t<0)return!0;const se=this.rayIntersectionCoordinate(re);if(se.x<V||se.y<0||se.x>$||se.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.radToDeg(this.fovAboveCenter)>88||this.isHorizonVisibleForPoints(new n.pointGeometry(0,0),new n.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,s){const p=n.length(n.sub([],this._camera.position,t)),x=this._zoomFromMercatorZ(p)+s;return p-this._mercatorZfromZoom(x)}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.pointGeometry(0,t))}}class ga{constructor(t){this._hashName=t&&encodeURIComponent(t),n.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(s,p){let x=!1,S=null;const z=()=>{S=null,x&&(s(),S=setTimeout(z,300),x=!1)};return()=>(x=!0,S||z(),S)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,n.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return n.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const s=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,x=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,x),z=Math.round(s.lng*S)/S,B=Math.round(s.lat*S)/S,V=this._map.getBearing(),$=this._map.getPitch();let H="";if(H+=t?`/${z}/${B}/${p}`:`${p}/${B}/${z}`,(V||$)&&(H+="/"+Math.round(10*V)/10),$&&(H+="/"+Math.round($)),this._hashName){const re=this._hashName;let se=!1;const me=n.window.location.hash.slice(1).split("&").map(ae=>{const ue=ae.split("=")[0];return ue===re?(se=!0,`${ue}=${H}`):ae}).filter(ae=>ae);return se||me.push(`${re}=${H}`),"#"+me.join("&")}return"#"+H}_getCurrentHash(){const t=n.window.location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(s=p)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(s=>isNaN(s))){const s=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:s,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=n.window.location.href.replace(/(#.+)?$/,this.getHashString());n.window.history.replaceState(n.window.history.state,null,t)}}const vo={linearity:.3,easing:n.bezier(0,0,.3,1)},yi=n.extend({deceleration:2500,maxSpeed:1400},vo),Gs=n.extend({deceleration:20,maxSpeed:1400},vo),Do=n.extend({deceleration:1e3,maxSpeed:360},vo),zo=n.extend({deceleration:1e3,maxSpeed:90},vo);class Pi{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=n.exported.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new n.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)s.zoom+=S.zoomDelta||0,s.bearing+=S.bearingDelta||0,s.pitch+=S.pitchDelta||0,S.panDelta&&s.pan._add(S.panDelta),S.around&&(s.around=S.around),S.pinchAround&&(s.pinchAround=S.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(s.pan.mag()){const S=ys(s.pan.mag(),p,n.extend({},yi,t||{}));x.offset=s.pan.mult(S.amount/s.pan.mag()),x.center=this._map.transform.center,Ci(x,S)}if(s.zoom){const S=ys(s.zoom,p,Gs);x.zoom=this._map.transform.zoom+S.amount,Ci(x,S)}if(s.bearing){const S=ys(s.bearing,p,Do);x.bearing=this._map.transform.bearing+n.clamp(S.amount,-179,179),Ci(x,S)}if(s.pitch){const S=ys(s.pitch,p,zo);x.pitch=this._map.transform.pitch+S.amount,Ci(x,S)}if(x.zoom||x.bearing){const S=s.pinchAround===void 0?s.around:s.pinchAround;x.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),n.extend(x,{noMoveStart:!0})}}function Ci(d,t){(!d.duration||d.duration<t.duration)&&(d.duration=t.duration,d.easing=t.easing)}function ys(d,t,s){const{maxSpeed:p,linearity:x,deceleration:S}=s,z=n.clamp(d*x/(t/1e3),-p,p),B=Math.abs(z)/(S*x);return{easing:s.easing,duration:1e3*B,amount:z*(B/2)}}class ti extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,p,x={}){const S=M.mousePos(s.getCanvasContainer(),p),z=s.unproject(S);super(t,n.extend({point:S,lngLat:z,originalEvent:p},x)),this._defaultPrevented=!1,this.target=s}}class _s extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,p){const x=t==="touchend"?p.changedTouches:p.touches,S=M.touchPos(s.getCanvasContainer(),x),z=S.map(V=>s.unproject(V)),B=S.reduce((V,$,H,re)=>V.add($.div(re.length)),new n.pointGeometry(0,0));super(t,{points:S,point:B,lngLats:z,lngLat:s.unproject(B),originalEvent:p}),this._defaultPrevented=!1}}class Ai extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,p){super(t,{originalEvent:p}),this._defaultPrevented=!1}}class ja{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Ai(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new ti(t.type,this._map,t))}mouseup(t){this._map.fire(new ti(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new ti(t.type,this._map,t))}dblclick(t){return this._firePreventable(new ti(t.type,this._map,t))}mouseover(t){this._map.fire(new ti(t.type,this._map,t))}mouseout(t){this._map.fire(new ti(t.type,this._map,t))}touchstart(t){return this._firePreventable(new _s(t.type,this._map,t))}touchmove(t){this._map.fire(new _s(t.type,this._map,t))}touchend(t){this._map.fire(new _s(t.type,this._map,t))}touchcancel(t){this._map.fire(new _s(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ur{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(t){this._map.fire(new ti(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ti("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new ti(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ua{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(M.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const p=s;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=p,this._box||(this._box=M.create("div","vjmapgis-boxzoom",this._container),this._container.classList.add("vjmapgis-crosshair"),this._fireEvent("boxzoomstart",t));const S=Math.min(x.x,p.x),z=Math.max(x.x,p.x),B=Math.min(x.y,p.y),V=Math.max(x.y,p.y);this._map._requestDomTask(()=>{this._box&&(M.setTransform(this._box,`translate(${S}px,${B}px)`),this._box.style.width=z-S+"px",this._box.style.height=V-B+"px")})}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const p=this._startPos,x=s;if(this.reset(),M.suppressClick(),p.x!==x.x||p.y!==x.y)return this._map.fire(new n.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:S=>S.fitScreenCoordinates(p,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("vjmapgis-crosshair"),this._box&&(M.remove(this._box),this._box=null),M.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new n.Event(t,{originalEvent:s}))}}function ki(d,t){const s={};for(let p=0;p<d.length;p++)s[d[p].identifier]=t[p];return s}class ol{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),p.length===this.numTouches&&(this.centroid=function(x){const S=new n.pointGeometry(0,0);for(const z of x)S._add(z);return S.div(x.length)}(s),this.touches=ki(p,s)))}touchmove(t,s,p){if(this.aborted||!this.centroid)return;const x=ki(p,s);for(const S in this.touches){const z=this.touches[S],B=x[S];(!B||B.dist(z)>30)&&(this.aborted=!0)}}touchend(t,s,p){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class qi{constructor(t){this.singleTap=new ol(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,p){this.singleTap.touchstart(t,s,p)}touchmove(t,s,p){this.singleTap.touchmove(t,s,p)}touchend(t,s,p){const x=this.singleTap.touchend(t,s,p);if(x){const S=t.timeStamp-this.lastTime<500,z=!this.lastTap||this.lastTap.dist(x)<30;if(S&&z||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class vs{constructor(){this._zoomIn=new qi({numTouches:1,numTaps:2}),this._zoomOut=new qi({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,p){this._zoomIn.touchstart(t,s,p),this._zoomOut.touchstart(t,s,p)}touchmove(t,s,p){this._zoomIn.touchmove(t,s,p),this._zoomOut.touchmove(t,s,p)}touchend(t,s,p){const x=this._zoomIn.touchend(t,s,p),S=this._zoomOut.touchend(t,s,p);return x?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:z=>z.easeTo({duration:300,zoom:z.getZoom()+1,around:z.unproject(x)},{originalEvent:t})}):S?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:z=>z.easeTo({duration:300,zoom:z.getZoom()-1,around:z.unproject(S)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Tl={0:1,2:2};class Na{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const p=M.mouseButton(t);this._correctButton(t,p)&&(this._lastPoint=s,this._eventButton=p)}mousemoveWindow(t,s){const p=this._lastPoint;if(p){if(t.preventDefault(),function(x,S){const z=Tl[S];return x.buttons===void 0||(x.buttons&z)!==z}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(p,s)}}mouseupWindow(t){this._lastPoint&&M.mouseButton(t)===this._eventButton&&(this._moved&&M.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sl extends Na{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class Ga extends Na{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const p=.8*(s.x-t.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(t){t.preventDefault()}}class ya extends Na{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const p=-.5*(s.y-t.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(t){t.preventDefault()}}class io{constructor(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new n.pointGeometry(0,0)}touchstart(t,s,p){return this._calculateTransform(t,s,p)}touchmove(t,s,p){if(this._active&&!(p.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,s,p)}touchend(t,s,p){this._calculateTransform(t,s,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,p){p.length>0&&(this._active=!0);const x=ki(p,s),S=new n.pointGeometry(0,0),z=new n.pointGeometry(0,0);let B=0;for(const $ in x){const H=x[$],re=this._touches[$];re&&(S._add(H),z._add(H.sub(re)),B++,x[$]=H)}if(this._touches=x,B<this._minTouches||!z.mag())return;const V=z.div(B);return this._sum._add(V),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(B),panDelta:V}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class f{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,s,p){return{}}touchstart(t,s,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,p){if(!this._firstTwoTouches)return;t.preventDefault();const[x,S]=this._firstTwoTouches,z=E(p,s,x),B=E(p,s,S);if(!z||!B)return;const V=this._aroundCenter?null:z.add(B).div(2);return this._move([z,B],V,t)}touchend(t,s,p){if(!this._firstTwoTouches)return;const[x,S]=this._firstTwoTouches,z=E(p,s,x),B=E(p,s,S);z&&B||(this._active&&M.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function E(d,t,s){for(let p=0;p<d.length;p++)if(d[p].identifier===s)return t[p]}function k(d,t){return Math.log(d/t)/Math.LN2}class G extends f{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const p=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(k(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:k(this._distance,p),pinchAround:s}}}function Z(d,t){return 180*d.angleWith(t)/Math.PI}class J extends f{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const p=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Z(this._vector,p),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,p=Z(t,this._startVector);return Math.abs(p)<s}}function ne(d){return Math.abs(d.y)>Math.abs(d.x)}class fe extends f{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(t){this._lastPoints=t,ne(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,p){const x=t[0].sub(this._lastPoints[0]),S=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(x,S,p.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(x.y+S.y)/2*-.5}}gestureBeginsVertically(t,s,p){if(this._valid!==void 0)return this._valid;const x=t.mag()>=2,S=s.mag()>=2;if(!x&&!S)return;if(!x||!S)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const z=t.y>0==s.y>0;return ne(t)&&ne(s)&&z}}const ce={panStep:100,bearingStep:15,pitchStep:10};class Se{constructor(){const t=ce;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,p=0,x=0,S=0,z=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?p=-1:(t.preventDefault(),S=-1);break;case 39:t.shiftKey?p=1:(t.preventDefault(),S=1);break;case 38:t.shiftKey?x=1:(t.preventDefault(),z=-1);break;case 40:t.shiftKey?x=-1:(t.preventDefault(),z=1);break;default:return}return this._rotationDisabled&&(p=0,x=0),{cameraAnimation:B=>{const V=B.getZoom();B.easeTo({duration:300,easeId:"keyboardHandler",easing:_e,zoom:s?Math.round(V)+s*(t.shiftKey?2:1):V,bearing:B.getBearing()+p*this._bearingStep,pitch:B.getPitch()+x*this._pitchStep,offset:[-S*this._panStep,-z*this._panStep],center:B.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function _e(d){return d*(2-d)}const De=4.000244140625;class Ge{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,n.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;let s=t.deltaMode===n.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const p=n.exported.now(),x=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,s!==0&&s%De==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(x*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=M.mousePos(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform,s=()=>t._terrainEnabled()?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const V=this._type==="wheel"&&Math.abs(this._delta)>De?this._wheelZoomRate:this._defaultZoomRate;let $=2/(1+Math.exp(-Math.abs(this._delta*V)));this._delta<0&&$!==0&&($=1/$);const H=s(),re=Math.pow(2,H),se=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):re;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(se*$))),this._type==="wheel"&&(this._startZoom=s(),this._easing=this._smoothOutEasing(200)),this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:s(),x=this._startZoom,S=this._easing;let z,B=!1;if(this._type==="wheel"&&x&&S){const V=Math.min((n.exported.now()-this._lastWheelEventTime)/200,1),$=S(V);z=n.number(x,p,$),V<1?this._frameId||(this._frameId=!0):B=!0}else z=p,B=!0;return this._active=!0,B&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!B,zoomDelta:z-s(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=n.ease;if(this._prevEase){const p=this._prevEase,x=(n.exported.now()-p.start)/p.duration,S=p.easing(x+.01)-p.easing(x),z=.27/Math.sqrt(S*S+1e-4)*.01,B=Math.sqrt(.0729-z*z);s=n.bezier(z,B,.25,1)}return this._prevEase={start:n.exported.now(),duration:t,easing:s},s}reset(){this._active=!1}}class Xe{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class it{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(t.shiftKey?-1:1),around:p.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zt{constructor(){this._tap=new qi({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,s,p){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=s[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(t,s,p))}touchmove(t,s,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const x=s[0],S=x.y-this._swipePoint.y;return this._swipePoint=x,t.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(t,s,p)}touchend(t,s,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(t,s,p)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wt{constructor(t,s,p){this._el=t,this._mousePan=s,this._touchPan=p}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("vjmapgis-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("vjmapgis-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Nt{constructor(t,s,p){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Te{constructor(t,s,p,x){this._el=t,this._touchZoom=s,this._touchRotate=p,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("vjmapgis-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("vjmapgis-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const qe=d=>d.zoom||d.drag||d.pitch||d.rotate;class wt extends n.Event{}class pt{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,s){const p=n.sub([],s,t);this.radius=n.length(p[2]<0?n.div([],p,this.constants):[p[0],p[1],0])}projectRay(t){n.div(t,t,this.constants),n.normalize(t,t),n.mul$2(t,t,this.constants);const s=n.scale([],t,this.radius);if(s[2]>0){const p=n.scale([],[0,0,1],n.dot(s,[0,0,1])),x=n.scale([],n.normalize([],[s[0],s[1],0]),this.radius),S=n.add([],s,n.scale([],n.sub([],n.add([],x,p),s),2));s[0]=S[0],s[1]=S[1]}return s}}function Jt(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class en{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pi(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new pt,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),n.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[n.window.document,"mousemove",{capture:!0}],[n.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[n.window,"blur",void 0]];for(const[x,S,z]of this._listeners)M.addEventListener(x,S,x===n.window.document?this.handleWindowEvent:this.handleEvent,z)}destroy(){for(const[t,s,p]of this._listeners)M.removeEventListener(t,s,t===n.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(t){const s=this._map,p=s.getCanvasContainer();this._add("mapEvent",new ja(s,t));const x=s.boxZoom=new Ua(s,t);this._add("boxZoom",x);const S=new vs,z=new it;s.doubleClickZoom=new Xe(z,S),this._add("tapZoom",S),this._add("clickZoom",z);const B=new Zt;this._add("tapDragZoom",B);const V=s.touchPitch=new fe;this._add("touchPitch",V);const $=new Ga(t),H=new ya(t);s.dragRotate=new Nt(t,$,H),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);const re=new sl(t),se=new io(t);s.dragPan=new Wt(p,re,se),this._add("mousePan",re),this._add("touchPan",se,["touchZoom","touchRotate"]);const me=new J,ae=new G;s.touchZoomRotate=new Te(p,ae,me,B),this._add("touchRotate",me,["touchPan","touchZoom"]),this._add("touchZoom",ae,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ur(s));const ue=s.scrollZoom=new Ge(s,this);this._add("scrollZoom",ue,["mousePan"]);const Le=s.keyboard=new Se;this._add("keyboard",Le);for(const ye of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[ye]&&s[ye].enable(t[ye])}_add(t,s,p){this._handlers.push({handlerName:t,handler:s,allowed:p}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(qe(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,s,p){for(const x in t)if(x!==p&&(!s||s.indexOf(x)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,t.type+"Window")}_getMapTouches(t){const s=[];for(const p of t)this._el.contains(p.target)&&s.push(p);return s}handleEvent(t,s){if(t.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const p=t.type==="renderFrame",x=p?void 0:t,S={needsRenderFrame:!1},z={},B={},V=t.touches?this._getMapTouches(t.touches):void 0,$=V?M.touchPos(this._el,V):p?void 0:M.mousePos(this._el,t);for(const{handlerName:se,handler:me,allowed:ae}of this._handlers){if(!me.isEnabled())continue;let ue;this._blockedByActive(B,ae,se)?me.reset():me[s||t.type]&&(ue=me[s||t.type](t,$,V),this.mergeHandlerResult(S,z,ue,se,x),ue&&ue.needsRenderFrame&&this._triggerRenderFrame()),(ue||me.isActive())&&(B[se]=me)}const H={};for(const se in this._previousActiveHandlers)B[se]||(H[se]=x);this._previousActiveHandlers=B,(Object.keys(H).length||Jt(S))&&(this._changes.push([S,z,H]),this._triggerRenderFrame()),(Object.keys(B).length||Jt(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:re}=S;re&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],re(this._map))}mergeHandlerResult(t,s,p,x,S){if(!p)return;n.extend(t,p);const z={handlerName:x,originalEvent:p.originalEvent||S};p.zoomDelta!==void 0&&(s.zoom=z),p.panDelta!==void 0&&(s.drag=z),p.pitchDelta!==void 0&&(s.pitch=z),p.bearingDelta!==void 0&&(s.rotate=z)}_applyChanges(){const t={},s={},p={};for(const[x,S,z]of this._changes)x.panDelta&&(t.panDelta=(t.panDelta||new n.pointGeometry(0,0))._add(x.panDelta)),x.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(t.around=x.around),x.aroundCoord!==void 0&&(t.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(t.pinchAround=x.pinchAround),x.noInertia&&(t.noInertia=x.noInertia),n.extend(s,S),n.extend(p,z);this._updateMapTransform(t,s,p),this._changes=[]}_updateMapTransform(t,s,p){const x=this._map,S=x.transform,z=Me=>[Me.x,Me.y,Me.z];if((Me=>{const Ae=this._eventsInProgress.drag;return Ae&&!this._handlersById[Ae.handlerName].isActive()})()&&!Jt(t)){const Me=S.zoom;S.cameraElevationReference="sea",S.recenterOnTerrain(),S.cameraElevationReference="ground",Me!==S.zoom&&this._map._update(!0)}if(!Jt(t))return this._fireEvents(s,p,!0);let{panDelta:B,zoomDelta:V,bearingDelta:$,pitchDelta:H,around:re,aroundCoord:se,pinchAround:me}=t;me!==void 0&&(re=me),(Me=>s.drag&&!this._eventsInProgress.drag)()&&re&&(this._dragOrigin=z(S.pointCoordinate3D(re)),this._trackingEllipsoid.setup(S._camera.position,this._dragOrigin)),S.cameraElevationReference="sea",x._stop(!0),re=re||x.transform.centerPoint,$&&(S.bearing+=$),H&&(S.pitch+=H),S._updateCameraState();const ae=[0,0,0];if(B){const Me=S.screenPointToMercatorRay(re),Ae=S.screenPointToMercatorRay(re.sub(B)),Ne=this._trackingEllipsoid.projectRay(Me.dir),He=this._trackingEllipsoid.projectRay(Ae.dir);ae[0]=He[0]-Ne[0],ae[1]=He[1]-Ne[1]}const ue=S.zoom,Le=[0,0,0];if(V){const Me=z(se||S.pointCoordinate3D(re)),Ae={dir:n.normalize([],n.sub([],Me,S._camera.position))},Ne=S.screenPointToMercatorRay(S.centerPoint);if(Ae.dir[2]<0){const He=n.altitudeFromMercatorZ(Me[2],Me[1]),We=S.rayIntersectionCoordinate(S.pointRayIntersection(S.centerPoint,He)),lt=S.zoomDeltaToMovement(z(We),V)*(Ne.dir[2]/Ae.dir[2]);n.scale(Le,Ae.dir,lt)}else if(S._terrainEnabled()){const He=S.zoomDeltaToMovement(Me,V);n.scale(Le,Ae.dir,He)}}const ye=n.add(ae,ae,Le);S._translateCameraConstrained(ye),V&&Math.abs(S.zoom-ue)>1e-4&&S.recenterOnTerrain(),S.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,p,!0)}_fireEvents(t,s,p){const x=qe(this._eventsInProgress),S=qe(t),z={};for(const H in t){const{originalEvent:re}=t[H];this._eventsInProgress[H]||(z[H+"start"]=re),this._eventsInProgress[H]=t[H]}!x&&S&&this._fireEvent("movestart",S.originalEvent);for(const H in z)this._fireEvent(H,z[H]);S&&this._fireEvent("move",S.originalEvent);for(const H in t){const{originalEvent:re}=t[H];this._fireEvent(H,re)}const B={};let V;for(const H in this._eventsInProgress){const{handlerName:re,originalEvent:se}=this._eventsInProgress[H];this._handlersById[re].isActive()||(delete this._eventsInProgress[H],V=s[re]||se,B[H+"end"]=V)}for(const H in B)this._fireEvent(H,B[H]);const $=qe(this._eventsInProgress);if(p&&(x||S)&&!$){this._updatingCamera=!0;const H=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),re=se=>se!==0&&-this._bearingSnap<se&&se<this._bearingSnap;H?(re(H.bearing||this._map.getBearing())&&(H.bearing=0),this._map.easeTo(H,{originalEvent:V})):(this._map.fire(new n.Event("moveend",{originalEvent:V})),re(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new n.Event(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new wt("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ht extends n.Evented{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,n.bindAll(["_renderFrameCallback"],this)}getCenter(){return new n.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,p){return t=n.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,n.extend({offset:t},s),p)}panTo(t,s,p){return this.easeTo(n.extend({center:t},s),p)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,p){return this.easeTo(n.extend({zoom:t},s),p)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,p){return this.easeTo(n.extend({bearing:t},s),p)}resetNorth(t,s){return this.rotateTo(0,n.extend({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(n.extend({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=n.LngLatBounds.convert(t);const p=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),p,s)}_extendCameraOptions(t){const s={top:0,bottom:0,right:0,left:0};if(typeof(t=n.extend({padding:s,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=="number"){const p=t.padding;t.padding={top:p,bottom:p,right:p,left:p}}return t.padding=n.extend(s,t.padding),t}_cameraForBoxAndBearing(t,s,p,x){const S=this._extendCameraOptions(x),z=this.transform,B=z.padding,V=z.project(n.LngLat.convert(t)),$=z.project(n.LngLat.convert(s)),H=V.rotate(-n.degToRad(p)),re=$.rotate(-n.degToRad(p)),se=new n.pointGeometry(Math.max(H.x,re.x),Math.max(H.y,re.y)),me=new n.pointGeometry(Math.min(H.x,re.x),Math.min(H.y,re.y)),ae=se.sub(me),ue=(z.width-(B.left+B.right+S.padding.left+S.padding.right))/ae.x,Le=(z.height-(B.top+B.bottom+S.padding.top+S.padding.bottom))/ae.y;if(Le<0||ue<0)return void n.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ye=Math.min(z.scaleZoom(z.scale*Math.min(ue,Le)),S.maxZoom),Me=typeof S.offset.x=="number"?new n.pointGeometry(S.offset.x,S.offset.y):n.pointGeometry.convert(S.offset),Ae=new n.pointGeometry((S.padding.left-S.padding.right)/2,(S.padding.top-S.padding.bottom)/2).rotate(p*Math.PI/180),Ne=Me.add(Ae).mult(z.scale/z.zoomScale(ye));return{center:z.unproject(V.add($).div(2).sub(Ne)),zoom:ye,bearing:p}}_cameraForBox(t,s,p,x,S){const z=this._extendCameraOptions(S);p=p||0,x=x||0,t=n.LngLat.convert(t),s=n.LngLat.convert(s);const B=this.transform.clone();B.padding=z.padding;const V=this.getFreeCameraOptions(),$=new n.LngLat(.5*(t.lng+s.lng),.5*(t.lat+s.lat)),H=.5*(p+x);if(B._camera.position[2]<n.mercatorZfromAltitude(H,$.lat))return void n.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");V.lookAtPoint($),B.setFreeCameraOptions(V);const re=n.MercatorCoordinate.fromLngLat(t),se=n.MercatorCoordinate.fromLngLat(s),me=B.pointRayIntersection(B.centerPoint,H),ae=[(ue=B.rayIntersectionCoordinate(me)).x,ue.y,ue.z];var ue;const Le=B.screenPointToMercatorRay(B.centerPoint);let ye,Me=0;do{const Ae=Math.floor(B.zoom),Ne=1<<Ae,He=Math.min(Ne*re.x,Ne*se.x),We=Math.min(Ne*re.y,Ne*se.y),lt=Math.max(Ne*re.x,Ne*se.x),ut=Math.max(Ne*re.y,Ne*se.y),It=new Q([He,We,p],[lt,ut,x]),ze=ee.fromInvProjectionMatrix(B.invProjMatrix,B.worldSize,Ae);if(It.intersects(ze)!==2){ye&&(B._camera.position=n.scaleAndAdd([],B._camera.position,Le.dir,-ye),B._updateStateFromCamera());break}const Gt=n.sub([],B._camera.position,ae);ye=.5*n.length(Gt),B._camera.position=n.scaleAndAdd([],B._camera.position,Le.dir,ye);try{B._updateStateFromCamera()}catch{return void n.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++Me<10);return{center:B.center,zoom:B.zoom,bearing:B.bearing,pitch:B.pitch}}fitBounds(t,s,p){return this._fitInternal(this.cameraForBounds(t,s),s,p)}_raycastElevationBox(t,s){const p=this.transform.elevation;if(!p)return;const x=new n.pointGeometry(t.x,s.y),S=new n.pointGeometry(s.x,t.y),z=p.pointCoordinate(t);if(!z)return;const B=p.pointCoordinate(s);if(!B)return;const V=p.pointCoordinate(x);if(!V)return;const $=p.pointCoordinate(S);if(!$)return;const H=new n.MercatorCoordinate(z[0],z[1]).toLngLat(),re=new n.MercatorCoordinate(B[0],B[1]).toLngLat(),se=new n.MercatorCoordinate(V[0],V[1]).toLngLat(),me=new n.MercatorCoordinate($[0],$[1]).toLngLat(),ae=Math.min(H.lng,Math.min(re.lng,Math.min(se.lng,me.lng))),ue=Math.min(H.lat,Math.min(re.lat,Math.min(se.lat,me.lat))),Le=Math.max(H.lng,Math.max(re.lng,Math.max(se.lng,me.lng))),ye=Math.max(H.lat,Math.max(re.lat,Math.max(se.lat,me.lat))),Me=Math.min(z[3],Math.min(B[3],Math.min(V[3],$[3]))),Ae=Math.max(z[3],Math.max(B[3],Math.max(V[3],$[3])));return{minLngLat:new n.LngLat(ae,ue),maxLngLat:new n.LngLat(Le,ye),minAltitude:Me,maxAltitude:Ae}}fitScreenCoordinates(t,s,p,x,S){let z,B,V,$;const H=n.pointGeometry.convert(t),re=n.pointGeometry.convert(s),se=this._raycastElevationBox(H,re);if(se)z=se.minLngLat,B=se.maxLngLat,V=se.minAltitude,$=se.maxAltitude;else{if(this.transform.isHorizonVisibleForPoints(H,re))return this;z=this.transform.pointLocation(H),B=this.transform.pointLocation(re)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(n.pointGeometry.convert(t)),this.transform.pointLocation(n.pointGeometry.convert(s)),p,x):this._cameraForBox(z,B,V,$,x),x,S)}_fitInternal(t,s,p){return t?(delete(s=n.extend(t,s)).padding,s.linear?this.easeTo(s,p):this.flyTo(s,p)):this}jumpTo(t,s){this.stop();const p=this.transform;let x=!1,S=!1,z=!1;return"zoom"in t&&p.zoom!==+t.zoom&&(x=!0,p.zoom=+t.zoom),t.center!==void 0&&(p.center=n.LngLat.convert(t.center)),"bearing"in t&&p.bearing!==+t.bearing&&(S=!0,p.bearing=+t.bearing),"pitch"in t&&p.pitch!==+t.pitch&&(z=!0,p.pitch=+t.pitch),t.padding==null||p.isPaddingEqual(t.padding)||(p.padding=t.padding),this.fire(new n.Event("movestart",s)).fire(new n.Event("move",s)),x&&this.fire(new n.Event("zoomstart",s)).fire(new n.Event("zoom",s)).fire(new n.Event("zoomend",s)),S&&this.fire(new n.Event("rotatestart",s)).fire(new n.Event("rotate",s)).fire(new n.Event("rotateend",s)),z&&this.fire(new n.Event("pitchstart",s)).fire(new n.Event("pitch",s)).fire(new n.Event("pitchend",s)),this.fire(new n.Event("moveend",s))}getFreeCameraOptions(){return this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,s){this.stop();const p=this.transform,x=p.zoom,S=p.pitch,z=p.bearing;p.setFreeCameraOptions(t);const B=x!==p.zoom,V=S!==p.pitch,$=z!==p.bearing;return this.fire(new n.Event("movestart",s)).fire(new n.Event("move",s)),B&&this.fire(new n.Event("zoomstart",s)).fire(new n.Event("zoom",s)).fire(new n.Event("zoomend",s)),$&&this.fire(new n.Event("rotatestart",s)).fire(new n.Event("rotate",s)).fire(new n.Event("rotateend",s)),V&&this.fire(new n.Event("pitchstart",s)).fire(new n.Event("pitch",s)).fire(new n.Event("pitchend",s)),this.fire(new n.Event("moveend",s)),this}easeTo(t,s){this._stop(!1,t.easeId),((t=n.extend({offset:[0,0],duration:500,easing:n.ease},t)).animate===!1||!t.essential&&n.exported.prefersReducedMotion)&&(t.duration=0);const p=this.transform,x=this.getZoom(),S=this.getBearing(),z=this.getPitch(),B=this.getPadding(),V="zoom"in t?+t.zoom:x,$="bearing"in t?this._normalizeBearing(t.bearing,S):S,H="pitch"in t?+t.pitch:z,re="padding"in t?t.padding:p.padding,se=n.pointGeometry.convert(t.offset);let me=p.centerPoint.add(se);const ae=p.pointLocation(me),ue=n.LngLat.convert(t.center||ae);this._normalizeCenter(ue);const Le=p.project(ae),ye=p.project(ue).sub(Le),Me=p.zoomScale(V-x);let Ae,Ne;t.around&&(Ae=n.LngLat.convert(t.around),Ne=p.locationPoint(Ae));const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||V!==x,this._rotating=this._rotating||S!==$,this._pitching=this._pitching||H!==z,this._padding=!p.isPaddingEqual(re),this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,He),this._ease(We=>{if(this._zooming&&(p.zoom=n.number(x,V,We)),this._rotating&&(p.bearing=n.number(S,$,We)),this._pitching&&(p.pitch=n.number(z,H,We)),this._padding&&(p.interpolatePadding(B,re,We),me=p.centerPoint.add(se)),Ae)p.setLocationAtPoint(Ae,Ne);else{const lt=p.zoomScale(p.zoom-x),ut=V>x?Math.min(2,Me):Math.max(.5,Me),It=Math.pow(ut,1-We),ze=p.unproject(Le.add(ye.mult(We*It)).mult(lt));p.setLocationAtPoint(p.renderWorldCopies?ze.wrap():ze,me)}this._fireMoveEvents(s)},We=>{p.recenterOnTerrain(),this._afterEase(s,We)},t),this}_prepareEase(t,s,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",s||p.moving||this.fire(new n.Event("movestart",t)),this._zooming&&!p.zooming&&this.fire(new n.Event("zoomstart",t)),this._rotating&&!p.rotating&&this.fire(new n.Event("rotatestart",t)),this._pitching&&!p.pitching&&this.fire(new n.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new n.Event("move",t)),this._zooming&&this.fire(new n.Event("zoom",t)),this._rotating&&this.fire(new n.Event("rotate",t)),this._pitching&&this.fire(new n.Event("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId,this.transform.cameraElevationReference="ground";const p=this._zooming,x=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new n.Event("zoomend",t)),x&&this.fire(new n.Event("rotateend",t)),S&&this.fire(new n.Event("pitchend",t)),this.fire(new n.Event("moveend",t))}flyTo(t,s){if(!t.essential&&n.exported.prefersReducedMotion){const an=n.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(an,s)}this.stop(),t=n.extend({offset:[0,0],speed:1.2,curve:1.42,easing:n.ease},t);const p=this.transform,x=this.getZoom(),S=this.getBearing(),z=this.getPitch(),B=this.getPadding(),V="zoom"in t?n.clamp(+t.zoom,p.minZoom,p.maxZoom):x,$="bearing"in t?this._normalizeBearing(t.bearing,S):S,H="pitch"in t?+t.pitch:z,re="padding"in t?t.padding:p.padding,se=p.zoomScale(V-x),me=n.pointGeometry.convert(t.offset);let ae=p.centerPoint.add(me);const ue=p.pointLocation(ae),Le=n.LngLat.convert(t.center||ue);this._normalizeCenter(Le);const ye=p.project(ue),Me=p.project(Le).sub(ye);let Ae=t.curve;const Ne=Math.max(p.width,p.height),He=Ne/se,We=Me.mag();if("minZoom"in t){const an=n.clamp(Math.min(t.minZoom,x,V),p.minZoom,p.maxZoom),Pn=Ne/p.zoomScale(an-x);Ae=Math.sqrt(Pn/We*2)}const lt=Ae*Ae;function ut(an){const Pn=(He*He-Ne*Ne+(an?-1:1)*lt*lt*We*We)/(2*(an?He:Ne)*lt*We);return Math.log(Math.sqrt(Pn*Pn+1)-Pn)}function It(an){return(Math.exp(an)-Math.exp(-an))/2}function ze(an){return(Math.exp(an)+Math.exp(-an))/2}const Gt=ut(0);let Lt=function(an){return ze(Gt)/ze(Gt+Ae*an)},pn=function(an){return Ne*((ze(Gt)*(It(Pn=Gt+Ae*an)/ze(Pn))-It(Gt))/lt)/We;var Pn},on=(ut(1)-Gt)/Ae;if(Math.abs(We)<1e-6||!isFinite(on)){if(Math.abs(Ne-He)<1e-6)return this.easeTo(t,s);const an=He<Ne?-1:1;on=Math.abs(Math.log(He/Ne))/Ae,pn=function(){return 0},Lt=function(Pn){return Math.exp(an*Ae*Pn)}}return t.duration="duration"in t?+t.duration:1e3*on/("screenSpeed"in t?+t.screenSpeed/Ae:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=S!==$,this._pitching=H!==z,this._padding=!p.isPaddingEqual(re),this._prepareEase(s,!1),this._ease(an=>{const Pn=an*on,Be=1/Lt(Pn);p.zoom=an===1?V:x+p.scaleZoom(Be),this._rotating&&(p.bearing=n.number(S,$,an)),this._pitching&&(p.pitch=n.number(z,H,an)),this._padding&&(p.interpolatePadding(B,re,an),ae=p.centerPoint.add(me));const nt=an===1?Le:p.unproject(ye.add(Me.mult(pn(Pn))).mult(Be));p.setLocationAtPoint(p.renderWorldCopies?nt.wrap():nt,ae),p._updateCenterElevation(),this._fireMoveEvents(s)},()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,s)}if(!t){const p=this.handlers;p&&p.stop(!1)}return this}_ease(t,s,p){p.animate===!1||p.duration===0?(t(1),s()):(this._easeStart=n.exported.now(),this._easeOptions=p,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((n.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=n.wrap(t,-180,180);const p=Math.abs(t-s);return Math.abs(t-360-s)<p&&(t-=360),Math.abs(t+360-s)<p&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const p=t.lng-s.center.lng;t.lng+=p>180?-360:p<-180?360:0}}class _n{constructor(t={}){this.options=t,n.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const s=this.options&&this.options.compact;return this._map=t,this._container=M.create("div","vjmapgis-ctrl vjmapgis-ctrl-attrib"),this._compactButton=M.create("button","vjmapgis-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=M.create("div","vjmapgis-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),s&&this._container.classList.add("vjmapgis-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){M.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const p=this._map._getUIString("AttributionControl."+s);t.title=p,t.setAttribute("aria-label",p)}_toggleAttribution(){this._container.classList.contains("vjmapgis-compact-show")?(this._container.classList.remove("vjmapgis-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("vjmapgis-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".vjmaps-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.config.ACCESS_TOKEN}];if(t){const p=s.reduce((x,S,z)=>(S.value&&(x+=`${S.key}=${S.value}${z<s.length-1?"&":""}`),x),"?");t.href=`${n.config.FEEDBACK_URL}/${p}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(x=>typeof x!="string"?"":x)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const s=this._map.style._sourceCaches;for(const x in s){const S=s[x];if(S.used){const z=S.getSource();z.attribution&&t.indexOf(z.attribution)<0&&t.push(z.attribution)}}t.sort((x,S)=>x.length-S.length),t=t.filter((x,S)=>{for(let z=S+1;z<t.length;z++)if(t[z].indexOf(x)>=0)return!1;return!0});const p=t.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,t.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("vjmapgis-attrib-empty")):this._container.classList.add("vjmapgis-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("vjmapgis-compact"):this._container.classList.remove("vjmapgis-compact","vjmapgis-compact-show")}}class gn{constructor(){n.bindAll(["_updateLogo"],this),n.bindAll(["_updateCompact"],this)}onAdd(t){this._map=t,this._container=M.create("div","vjmapgis-ctrl");const s=M.create("a","vjmapgis-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href=" https://www.vjmap.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){M.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const s in t){const p=t[s].getSource();if(p.hasOwnProperty("vjmaps_logo")&&!p.vjmaps_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("vjmapgis-compact"):s.classList.remove("vjmapgis-compact")}}}class Un{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,p=s?this._queue.concat(s):this._queue;for(const x of p)if(x.id===t)return void(x.cancelled=!0)}run(t=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const p of s)if(!p.cancelled&&(p.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Kn(d,t,s){if(d=new n.LngLat(d.lng,d.lat),t){const p=new n.LngLat(d.lng-360,d.lat),x=new n.LngLat(d.lng+360,d.lat),S=360*Math.ceil(Math.abs(d.lng-s.center.lng)/360),z=s.locationPoint(d).distSqr(t),B=t.x<0||t.y<0||t.x>s.width||t.y>s.height;s.locationPoint(p).distSqr(t)<z&&(B||Math.abs(p.lng-s.center.lng)<S)?d=p:s.locationPoint(x).distSqr(t)<z&&(B||Math.abs(x.lng-s.center.lng)<S)&&(d=x)}for(;Math.abs(d.lng-s.center.lng)>180;){const p=s.locationPoint(d);if(p.x>=0&&p.y>=0&&p.x<=s.width&&p.y<=s.height)break;d.lng>s.center.lng?d.lng-=360:d.lng+=360}return d}const Tn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function fr(d,t,s){const p=d.classList;for(const x in Tn)p.remove(`vjmapgis-${s}-anchor-${x}`);p.add(`vjmapgis-${s}-anchor-${t}`)}class ni extends n.Evented{constructor(t,s){if(super(),(t instanceof n.window.HTMLElement||s)&&(t=n.extend({element:t},s)),n.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=n.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=M.create("div"),this._element.setAttribute("aria-label","Map marker");const p=M.createNS("http://www.w3.org/2000/svg","svg"),x=41,S=27;p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height",x+"px"),p.setAttributeNS(null,"width",S+"px"),p.setAttributeNS(null,"viewBox",`0 0 ${S} ${x}`);const z=M.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"stroke","none"),z.setAttributeNS(null,"stroke-width","1"),z.setAttributeNS(null,"fill","none"),z.setAttributeNS(null,"fill-rule","evenodd");const B=M.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill-rule","nonzero");const V=M.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(3.0, 29.0)"),V.setAttributeNS(null,"fill","#000000");const $=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Me of $){const Ae=M.createNS("http://www.w3.org/2000/svg","ellipse");Ae.setAttributeNS(null,"opacity","0.04"),Ae.setAttributeNS(null,"cx","10.5"),Ae.setAttributeNS(null,"cy","5.80029008"),Ae.setAttributeNS(null,"rx",Me.rx),Ae.setAttributeNS(null,"ry",Me.ry),V.appendChild(Ae)}const H=M.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"fill",this._color);const re=M.createNS("http://www.w3.org/2000/svg","path");re.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),H.appendChild(re);const se=M.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"opacity","0.25"),se.setAttributeNS(null,"fill","#000000");const me=M.createNS("http://www.w3.org/2000/svg","path");me.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),se.appendChild(me);const ae=M.createNS("http://www.w3.org/2000/svg","g");ae.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ae.setAttributeNS(null,"fill","#FFFFFF");const ue=M.createNS("http://www.w3.org/2000/svg","g");ue.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Le=M.createNS("http://www.w3.org/2000/svg","circle");Le.setAttributeNS(null,"fill","#000000"),Le.setAttributeNS(null,"opacity","0.25"),Le.setAttributeNS(null,"cx","5.5"),Le.setAttributeNS(null,"cy","5.5"),Le.setAttributeNS(null,"r","5.4999962");const ye=M.createNS("http://www.w3.org/2000/svg","circle");ye.setAttributeNS(null,"fill","#FFFFFF"),ye.setAttributeNS(null,"cx","5.5"),ye.setAttributeNS(null,"cy","5.5"),ye.setAttributeNS(null,"r","5.4999962"),ue.appendChild(Le),ue.appendChild(ye),B.appendChild(V),B.appendChild(H),B.appendChild(se),B.appendChild(ae),B.appendChild(ue),p.appendChild(B),p.setAttributeNS(null,"height",x*this._scale+"px"),p.setAttributeNS(null,"width",S*this._scale+"px"),this._element.appendChild(p),this._offset=n.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("vjmapgis-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()}),fr(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),M.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=n.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const s=38.1,p=13.5,x=Math.sqrt(Math.pow(p,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-s],"bottom-left":[x,-1*(s-p+x)],"bottom-right":[-x,-1*(s-p+x)],left:[p,-1*(s-p)],right:[-p,-1*(s-p)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const s=t.code,p=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,p=this._element;this._popup&&(s===p||p.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_evaluateOpacity(){const t=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(t))return void this._clearFadeTimer();const s=this._map.unproject(t);let p=!1;if(this._map.getTerrain()){const S=this._map.getFreeCameraOptions();if(S.position){const z=S.position.toLngLat();p=z.distanceTo(s)<.9*z.distanceTo(this._lngLat)}}const x=(1-this._map._queryFogOpacity(s))*(p?.2:1);this._element.style.opacity=""+x,this._popup&&this._popup._setOpacity(""+x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(t){const s=this._map.transform;return!!t&&t.x>=0&&t.x<s.width&&t.y>=0&&t.y<s.height}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Kn(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let s="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?s=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(s=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&M.setTransform(this._element,`${Tn[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${s}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const t=this._map.transform,s=this._offset.mult(this._scale);return this._rotationAlignment==="map"&&s._rotate(t.angle),this._pitchAlignment==="map"&&(s.y*=Math.cos(t._pitch)),s}getOffset(){return this._offset}setOffset(t){return this._offset=n.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const s=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.Event("dragstart"))),this.fire(new n.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new n.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Li{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const s=n.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,s,p){this._start=this.getValue(s),this._end=t,this._startTime=s,this._endTime=s+p}}const ci={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"vjmaps logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},{HTMLImageElement:Cr,HTMLElement:Di,ImageBitmap:mr}=n.window,Vs={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Tr(d){d.parentNode&&d.parentNode.removeChild(d)}const rt={showCompass:!0,showZoom:!0,visualizePitch:!1};class ie{constructor(t,s,p=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new Ga({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,p&&(this.mousePitch=new ya({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),n.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),M.addEventListener(s,"mousedown",this.mousedown),M.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),M.addEventListener(s,"touchmove",this.touchmove),M.addEventListener(s,"touchend",this.touchend),M.addEventListener(s,"touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),M.disableDrag()}move(t,s){const p=this.map,x=this.mouseRotate.mousemoveWindow(t,s);if(x&&x.bearingDelta&&p.setBearing(p.getBearing()+x.bearingDelta),this.mousePitch){const S=this.mousePitch.mousemoveWindow(t,s);S&&S.pitchDelta&&p.setPitch(p.getPitch()+S.pitchDelta)}}off(){const t=this.element;M.removeEventListener(t,"mousedown",this.mousedown),M.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),M.removeEventListener(t,"touchmove",this.touchmove),M.removeEventListener(t,"touchend",this.touchend),M.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){M.enableDrag(),M.removeEventListener(n.window,"mousemove",this.mousemove),M.removeEventListener(n.window,"mouseup",this.mouseup)}mousedown(t){this.down(n.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),M.mousePos(this.element,t)),M.addEventListener(n.window,"mousemove",this.mousemove),M.addEventListener(n.window,"mouseup",this.mouseup)}mousemove(t){this.move(t,M.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=M.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=M.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ge={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Re,$e=0,tt=!1;const Ut={maxWidth:100,unit:"metric"};function Et(d,t,s){const p=s&&s.maxWidth||100,x=d._container.clientHeight/2,S=d.unproject([0,x]),z=d.unproject([p,x]),B=S.distanceTo(z);if(s&&s.unit==="imperial"){const V=3.2808*B;V>5280?Ct(t,p,V/5280,d._getUIString("ScaleControl.Miles"),d):Ct(t,p,V,d._getUIString("ScaleControl.Feet"),d)}else s&&s.unit==="nautical"?Ct(t,p,B/1852,d._getUIString("ScaleControl.NauticalMiles"),d):B>=1e3?Ct(t,p,B/1e3,d._getUIString("ScaleControl.Kilometers"),d):Ct(t,p,B,d._getUIString("ScaleControl.Meters"),d)}function Ct(d,t,s,p,x){const S=function(B){const V=Math.pow(10,(""+Math.floor(B)).length-1);let $=B/V;return $=$>=10?10:$>=5?5:$>=3?3:$>=2?2:$>=1?1:function(H){const re=Math.pow(10,Math.ceil(-Math.log(H)/Math.LN10));return Math.round(H*re)/re}($),V*$}(s),z=S/s;x._requestDomTask(()=>{d.style.width=t*z+"px",d.innerHTML=`${S}&nbsp;${p}`})}const tn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ln=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function hn(d){if(d){if(typeof d=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(d,2)));return{center:new n.pointGeometry(0,0),top:new n.pointGeometry(0,d),"top-left":new n.pointGeometry(t,t),"top-right":new n.pointGeometry(-t,t),bottom:new n.pointGeometry(0,-d),"bottom-left":new n.pointGeometry(t,-t),"bottom-right":new n.pointGeometry(-t,-t),left:new n.pointGeometry(d,0),right:new n.pointGeometry(-d,0)}}if(d instanceof n.pointGeometry||Array.isArray(d)){const t=n.pointGeometry.convert(d);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:n.pointGeometry.convert(d.center||[0,0]),top:n.pointGeometry.convert(d.top||[0,0]),"top-left":n.pointGeometry.convert(d["top-left"]||[0,0]),"top-right":n.pointGeometry.convert(d["top-right"]||[0,0]),bottom:n.pointGeometry.convert(d.bottom||[0,0]),"bottom-left":n.pointGeometry.convert(d["bottom-left"]||[0,0]),"bottom-right":n.pointGeometry.convert(d["bottom-right"]||[0,0]),left:n.pointGeometry.convert(d.left||[0,0]),right:n.pointGeometry.convert(d.right||[0,0])}}return hn(new n.pointGeometry(0,0))}const vn={version:n.version,supported:u,setRTLTextPlugin:n.setRTLTextPlugin,getRTLTextPluginStatus:n.getRTLTextPluginStatus,Map:class extends Ht{constructor(d){if((d=n.extend({},Vs,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ma(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._renderTaskQueue=new Un,this._domRenderTaskQueue=new Un,this._controls=[],this._markers=[],this._mapId=n.uniqueId(),this._locale=n.extend({},ci,d.locale),this._clickTolerance=d.clickTolerance,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Li(0),this._requestManager=new n.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,typeof d.container=="string"){if(this._container=n.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof Di))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),n.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),n.window!==void 0&&(n.window.addEventListener("online",this._onWindowOnline,!1),n.window.addEventListener("resize",this._onWindowResize,!1),n.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new en(this,d),this._hash=d.hash&&new ga(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,n.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.attributionControl&&this.addControl(new _n({customAttribution:d.customAttribution})),this._logoControl=new gn,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new n.Event(t.dataType+"data",t))}),this.on("dataloading",t=>{this.fire(new n.Event(t.dataType+"dataloading",t))})}_getMapId(){return this._mapId}addControl(d,t){if(t===void 0&&(t=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=d.onAdd(this);this._controls.push(d);const p=this._controlPositions[t];return t.indexOf("bottom")!==-1?p.insertBefore(s,p.firstChild):p.appendChild(s),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(d);return t>-1&&this._controls.splice(t,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}resize(d){const t=this._containerDimensions(),s=t[0],p=t[1];this._resizeCanvas(s,p),this.transform.resize(s,p),this.painter.resize(s,p);const x=!this._moving;return x&&(this.stop(),this.fire(new n.Event("movestart",d)).fire(new n.Event("move",d))),this.fire(new n.Event("resize",d)),x&&this.fire(new n.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(n.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d==null?85:d)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}project(d){return this.transform.locationPoint3D(n.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(n.pointGeometry.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(d,t,s){if(d==="mouseenter"||d==="mouseover"){let p=!1;return{layer:t,listener:s,delegates:{mousemove:S=>{const z=this.getLayer(t)?this.queryRenderedFeatures(S.point,{layers:[t]}):[];z.length?p||(p=!0,s.call(this,new ti(d,this,S.originalEvent,{features:z}))):p=!1},mouseout:()=>{p=!1}}}}if(d==="mouseleave"||d==="mouseout"){let p=!1;return{layer:t,listener:s,delegates:{mousemove:z=>{(this.getLayer(t)?this.queryRenderedFeatures(z.point,{layers:[t]}):[]).length?p=!0:p&&(p=!1,s.call(this,new ti(d,this,z.originalEvent)))},mouseout:z=>{p&&(p=!1,s.call(this,new ti(d,this,z.originalEvent)))}}}}{const p=x=>{const S=this.getLayer(t)?this.queryRenderedFeatures(x.point,{layers:[t]}):[];S.length&&(x.features=S,s.call(this,x),delete x.features)};return{layer:t,listener:s,delegates:{[d]:p}}}}on(d,t,s){if(s===void 0)return super.on(d,t);const p=this._createDelegatedListener(d,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(p);for(const x in p.delegates)this.on(x,p.delegates[x]);return this}once(d,t,s){if(s===void 0)return super.once(d,t);const p=this._createDelegatedListener(d,t,s);for(const x in p.delegates)this.once(x,p.delegates[x]);return this}off(d,t,s){return s===void 0?super.off(d,t):(this._delegatedListeners&&this._delegatedListeners[d]&&(p=>{const x=this._delegatedListeners[d];for(let S=0;S<x.length;S++){const z=x[S];if(z.layer===t&&z.listener===s){for(const B in z.delegates)this.off(B,z.delegates[B]);return x.splice(S,1),this}}})(),this)}queryRenderedFeatures(d,t){return this.style?(t!==void 0||d===void 0||d instanceof n.pointGeometry||Array.isArray(d)||(t=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],t=t||{},this.transform)):[]}querySourceFeatures(d,t){return this.style.querySourceFeatures(d,t)}setStyle(d,t){return(t=n.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(d,t))}_getUIString(d){const t=this._locale[d];if(t==null)throw new Error(`Missing UI string '${d}'`);return t}_updateStyle(d,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),d&&(this.style=new Bi(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Bi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,t){if(typeof d=="string"){const s=this._requestManager.normalizeStyleURL(d),p=this._requestManager.transformRequest(s,n.ResourceType.Style);n.getJSON(p,(x,S)=>{x?this.fire(new n.ErrorEvent(x)):S&&this._updateDiff(S,t)})}else typeof d=="object"&&this._updateDiff(d,t)}_updateDiff(d,t){try{this.style.setState(d)&&this._update(!0)}catch(s){n.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(d,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():n.warnOnce("There is no style added to the map.")}addSource(d,t){return this._lazyInitEmptyStyle(),this.style.addSource(d,t),this._update(!0)}isSourceLoaded(d){const t=this.style&&this.style._getSourceCaches(d);if(t.length!==0)return t.every(s=>s.loaded());this.fire(new n.ErrorEvent(new Error(`There is no source with ID '${d}'`)))}areTilesLoaded(){const d=this.style&&this.style._sourceCaches;for(const t in d){const s=d[t]._tiles;for(const p in s){const x=s[p];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}addSourceType(d,t,s){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,t,s)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,t,{pixelRatio:s=1,sdf:p=!1,stretchX:x,stretchY:S,content:z}={}){if(this._lazyInitEmptyStyle(),t instanceof Cr||mr&&t instanceof mr){const{width:B,height:V,data:$}=n.exported.getImageData(t);this.style.addImage(d,{data:new n.RGBAImage({width:B,height:V},$),pixelRatio:s,stretchX:x,stretchY:S,content:z,sdf:p,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:B,height:V,data:$}=t,H=t;this.style.addImage(d,{data:new n.RGBAImage({width:B,height:V},new Uint8Array($)),pixelRatio:s,stretchX:x,stretchY:S,content:z,sdf:p,version:0,userImage:H}),H.onAdd&&H.onAdd(this,d)}}}updateImage(d,t){const s=this.style.getImage(d);if(!s)return this.fire(new n.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=t instanceof Cr||mr&&t instanceof mr?n.exported.getImageData(t):t,{width:x,height:S,data:z}=p;return x===void 0||S===void 0?this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):x!==s.data.width||S!==s.data.height?this.fire(new n.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(s.data.replace(z,!(t instanceof Cr||mr&&t instanceof mr)),void this.style.updateImage(d,s))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new n.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,t){n.getImage(this._requestManager.transformRequest(d,n.ResourceType.Image),(s,p)=>{t(s,p instanceof Cr?n.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(d,t){return this._lazyInitEmptyStyle(),this.style.addLayer(d,t),this._update(!0)}moveLayer(d,t){return this.style.moveLayer(d,t),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,t,s){return this.style.setLayerZoomRange(d,t,s),this._update(!0)}setFilter(d,t,s={}){return this.style.setFilter(d,t,s),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,t,s,p={}){return this.style.setPaintProperty(d,t,s,p),this._update(!0)}getPaintProperty(d,t){return this.style.getPaintProperty(d,t)}setLayoutProperty(d,t,s,p={}){return this.style.setLayoutProperty(d,t,s,p),this._update(!0)}getLayoutProperty(d,t){return this.style.getLayoutProperty(d,t)}setLight(d,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.LngLat.convert(d),this.transform):0}queryTerrainElevation(d,t){const s=this.transform.elevation;return s?(t=n.extend({},{exaggerated:!0},t),s.getAtPoint(n.MercatorCoordinate.fromLngLat(d),null,t.exaggerated)):null}setFeatureState(d,t){return this.style.setFeatureState(d,t),this._update()}removeFeatureState(d,t){return this.style.removeFeatureState(d,t),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let d=0,t=0;return this._container&&(d=this._container.clientWidth||400,t=this._container.clientHeight||300),[d,t]}_detectMissingCSS(){n.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.warnOnce("This page appears to be missing CSS declarations for vjmaps GL JS, which may cause the map to display incorrectly. Please ensure your page includes vjmaps-gl.css, as described in  https://www.vjmap.com/vjmaps-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("vjmapgis-map"),(this._missingCSSCanary=M.create("div","vjmapgis-canary",d)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=M.create("div","vjmapgis-canvas-container",d);this._interactive&&t.classList.add("vjmapgis-interactive"),this._canvas=M.create("canvas","vjmapgis-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions();this._resizeCanvas(s[0],s[1]);const p=this._controlContainer=M.create("div","vjmapgis-control-container",d),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(S=>{x[S]=M.create("div","vjmapgis-ctrl-"+S,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,t){const s=n.exported.devicePixelRatio||1;this._canvas.width=s*d,this._canvas.height=s*t,this._canvas.style.width=d+"px",this._canvas.style.height=t+"px"}_addMarker(d){this._markers.push(d)}_removeMarker(d){const t=this._markers.indexOf(d);t!==-1&&this._markers.splice(t,1)}_setupPainter(){const d=n.extend({},u.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);t?(n.storeAuthState(t,!0),this.painter=new Wo(t,this.transform),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.exported$1.testSupport(t)):this.fire(new n.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new n.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.isMoving()&&this.loaded()?d():this._domRenderTaskQueue.add(d)}_render(d){let t;const s=this.painter.context.extTimerQuery,p=n.exported.now();this.listens("gpu-timing-frame")&&(t=s.createQueryEXT(),s.beginQueryEXT(s.TIME_ELAPSED_EXT,t));let x=this._updateAverageElevation(p);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;let S=!1;const z=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const V=this.transform.zoom,$=n.exported.now();this.style.zoomHistory.update(V,$);const H=new n.EvaluationParameters(V,{now:$,fadeDuration:z,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),re=H.crossFadingFactor();re===1&&re===this._crossFadingFactor||(S=!0,this._crossFadingFactor=re),this.style.update(H)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,z,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:z,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new n.Event("load"))),this.style&&(this.style.hasTransitions()||S)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const V=n.exported.now()-p;s.endQueryEXT(s.TIME_ELAPSED_EXT,t),setTimeout(()=>{const $=s.getQueryObjectEXT(t,s.QUERY_RESULT_EXT)/1e6;s.deleteQueryEXT(t),this.fire(new n.Event("gpu-timing-frame",{cpuTime:V,gpuTime:$}))},50)}if(this.listens("gpu-timing-layer")){const V=this.painter.collectGpuTimers();setTimeout(()=>{const $=this.painter.queryGpuTimers(V);this.fire(new n.Event("gpu-timing-layer",{layerTimes:$}))},50)}const B=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(B||this._repaint)this.triggerRepaint();else{const V=!this.isMoving()&&this.loaded();if(V&&(x=this._updateAverageElevation(p,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),V&&(this.fire(new n.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const $=this._calculateSpeedIndex();this.fire(new n.Event("speedindexcompleted",{speedIndex:$})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||B||(this._fullyLoaded=!0,this._authenticate()),this}_updateAverageElevation(d,t=!1){const s=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);if((t||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const p=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();isNaN(x)?x=0:this._averageElevationLastSampledAt=d;const S=Math.abs(p-x);if(S>1)this._averageElevation.easeTo(x,d,300);else if(S>1e-4)return this._averageElevation.jumpTo(x),s(x)}return!!this._averageElevation.isEasing(d)&&s(this._averageElevation.getValue(d))}_authenticate(){n.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===n.AUTH_ERR_MSG||d.status===401)){const t=this.painter.context.gl;n.storeAuthState(t,!1),this._logoControl instanceof gn&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.ErrorEvent(new Error("A valid vjmaps access token is required to use vjmaps GL JS. To create an account or a new access token, visit https://account.vjmap.com/ ")))}}),n.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const s=this.painter.context.gl,p=s.createFramebuffer();function x(S){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,S,0);const z=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,z),z}return s.bindFramebuffer(s.FRAMEBUFFER,p),this._canvasPixelComparison(x(d),t.canvasCopies.map(x),t.timeStamps)}_canvasPixelComparison(d,t,s){let p=s[1]-s[0];const x=d.length/4;for(let S=0;S<t.length;S++){const z=t[S];let B=0;for(let V=0;V<z.length;V+=4)z[V]===d[V]&&z[V+1]===d[V+1]&&z[V+2]===d[V+2]&&z[V+3]===d[V+3]&&(B+=1);p+=(s[S+2]-s[S+1])*(1-B/x)}return p}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),n.window!==void 0&&(n.window.removeEventListener("resize",this._onWindowResize,!1),n.window.removeEventListener("orientationchange",this._onWindowResize,!1),n.window.removeEventListener("online",this._onWindowOnline,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),Tr(this._canvasContainer),Tr(this._controlContainer),Tr(this._missingCSSCanary),this._container.classList.remove("vjmapgis-map"),n.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new n.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=n.exported.frame(t=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(t)}))}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}_setCacheLimits(d,t){n.setCacheLimits(d,t)}get version(){return n.version}},NavigationControl:class{constructor(d){this.options=n.extend({},rt,d),this._container=M.create("div","vjmapgis-ctrl vjmapgis-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(n.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("vjmapgis-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),M.create("span","vjmapgis-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("vjmapgis-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),M.create("span","vjmapgis-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(n.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("vjmapgis-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=M.create("span","vjmapgis-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const d=this._map.getZoom(),t=d===this._map.getMaxZoom(),s=d===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())}_rotateCompassArrow(){const d=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=d)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ie(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){M.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,t){const s=M.create("button",d,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(d,t){const s=this._map._getUIString("NavigationControl."+t);d.title=s,d.setAttribute("aria-label",s)}},GeolocateControl:class extends n.Evented{constructor(d){super(),this.options=n.extend({},ge,d),n.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(d){var t;return this._map=d,this._container=M.create("div","vjmapgis-ctrl vjmapgis-ctrl-group"),t=this._setupUI,Re!==void 0?t(Re):n.window.navigator.permissions!==void 0?n.window.navigator.permissions.query({name:"geolocation"}).then(s=>{Re=s.state!=="denied",t(Re)}):(Re=!!n.window.navigator.geolocation,t(Re)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(n.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),M.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,$e=0,tt=!1}_isOutOfMapMaxBounds(d){const t=this._map.getMaxBounds(),s=d.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("vjmapgis-ctrl-geolocate-active"),this._geolocateButton.classList.add("vjmapgis-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("vjmapgis-ctrl-geolocate-active"),this._geolocateButton.classList.add("vjmapgis-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("vjmapgis-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("vjmapgis-ctrl-geolocate-background"),this._geolocateButton.classList.add("vjmapgis-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("vjmapgis-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new n.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("vjmapgis-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("vjmapgis-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("vjmapgis-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("vjmapgis-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("vjmapgis-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("vjmapgis-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("vjmapgis-user-location-dot-stale"),this.fire(new n.Event("geolocate",d)),this._finish()}}_updateCamera(d){const t=new n.LngLat(d.coords.longitude,d.coords.latitude),s=d.coords.accuracy,p=this._map.getBearing(),x=n.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),x,{geolocateSource:!0})}_updateMarker(d){if(d){const t=new n.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map._container.clientHeight/2,t=this._map.unproject([0,d]),s=this._map.unproject([100,d]),p=t.distanceTo(s)/100,x=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=x+"px",this._circleElement.style.height=x+"px"}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("vjmapgis-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("vjmapgis-ctrl-geolocate-active"),this._geolocateButton.classList.remove("vjmapgis-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("vjmapgis-ctrl-geolocate-background"),this._geolocateButton.classList.remove("vjmapgis-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&tt)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("vjmapgis-user-location-dot-stale"),this.fire(new n.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=M.create("button","vjmapgis-ctrl-geolocate",this._container),M.create("span","vjmapgis-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",d===!1){n.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=M.create("div","vjmapgis-user-location-dot"),this._userLocationDotMarker=new ni(this._dotElement),this._circleElement=M.create("div","vjmapgis-user-location-accuracy-circle"),this._accuracyCircleMarker=new ni({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("vjmapgis-ctrl-geolocate-background"),this._geolocateButton.classList.remove("vjmapgis-ctrl-geolocate-active"),this.fire(new n.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return n.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":$e--,tt=!1,this._watchState="OFF",this._geolocateButton.classList.remove("vjmapgis-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("vjmapgis-ctrl-geolocate-active"),this._geolocateButton.classList.remove("vjmapgis-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("vjmapgis-ctrl-geolocate-background"),this._geolocateButton.classList.remove("vjmapgis-ctrl-geolocate-background-error"),this.fire(new n.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("vjmapgis-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("vjmapgis-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("vjmapgis-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("vjmapgis-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("vjmapgis-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("vjmapgis-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("vjmapgis-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("vjmapgis-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("vjmapgis-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("vjmapgis-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),$e++,$e>1?(d={maximumAge:6e5,timeout:0},tt=!0):(d=this.options.positionOptions,tt=!1),this._geolocationWatchID=n.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else n.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){n.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("vjmapgis-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:_n,ScaleControl:class{constructor(d){this.options=n.extend({},Ut,d),n.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Et(this._map,this._container,this.options)}onAdd(d){return this._map=d,this._container=M.create("div","vjmapgis-ctrl vjmapgis-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){M.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(d){this.options.unit=d,Et(this._map,this._container,this.options)}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof n.window.HTMLElement?this._container=d.container:n.warnOnce("Full screen control 'container' must be a DOM element.")),n.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in n.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in n.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=M.create("div","vjmapgis-ctrl vjmapgis-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){M.remove(this._controlContainer),this._map=null,n.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!n.window.document.fullscreenEnabled&&!n.window.document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=M.create("button","vjmapgis-ctrl-fullscreen",this._controlContainer);M.create("span","vjmapgis-ctrl-icon",d).setAttribute("aria-hidden",!0),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),n.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(n.window.document.fullscreenElement||n.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("vjmapgis-ctrl-shrink"),this._fullscreenButton.classList.toggle("vjmapgis-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?n.window.document.exitFullscreen?n.window.document.exitFullscreen():n.window.document.webkitCancelFullScreen&&n.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends n.Evented{constructor(d){super(),this.options=n.extend(Object.create(tn),d),n.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("vjmapgis-popup-track-pointer"),this._map._canvasContainer.classList.add("vjmapgis-track-pointer")):this._map.on("move",this._update),this.fire(new n.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&M.remove(this._content),this._container&&(M.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new n.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=n.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("vjmapgis-popup-track-pointer"),this._map._canvasContainer.classList.remove("vjmapgis-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("vjmapgis-popup-track-pointer"),this._map._canvasContainer.classList.add("vjmapgis-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(n.window.document.createTextNode(d))}setHTML(d){const t=n.window.document.createDocumentFragment(),s=n.window.document.createElement("body");let p;for(s.innerHTML=d;p=s.firstChild,p;)t.appendChild(p);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=M.create("div","vjmapgis-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){this._container&&this._container.classList.add(d)}removeClassName(d){this._container&&this._container.classList.remove(d)}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}_createCloseButton(){this.options.closeButton&&(this._closeButton=M.create("button","vjmapgis-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(d){this._update(d.point)}_onMouseMove(d){this._update(d.point)}_onDrag(d){this._update(d.point)}_update(d){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=M.create("div","vjmapgis-popup",this._map.getContainer()),this._tip=M.create("div","vjmapgis-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(S=>this._container.classList.add(S)),this._trackPointer&&this._container.classList.add("vjmapgis-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Kn(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!d))return;const t=this._pos=this._trackPointer&&d?d:this._map.project(this._lngLat);let s=this.options.anchor;const p=hn(this.options.offset);if(!s){const S=this._container.offsetWidth,z=this._container.offsetHeight;let B;B=t.y+p.bottom.y<z?["top"]:t.y>this._map.transform.height-z?["bottom"]:[],t.x<S/2?B.push("left"):t.x>this._map.transform.width-S/2&&B.push("right"),s=B.length===0?"bottom":B.join("-")}const x=t.add(p[s]).round();this._map._requestDomTask(()=>{this._container&&s&&(M.setTransform(this._container,`${Tn[s]} translate(${x.x}px,${x.y}px)`),fr(this._container,s,"popup"))})}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(ln);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._content&&(this._content.style.opacity=d),this._tip&&(this._tip.style.opacity=d)}},Marker:ni,Style:Bi,LngLat:n.LngLat,LngLatBounds:n.LngLatBounds,Point:n.pointGeometry,MercatorCoordinate:n.MercatorCoordinate,FreeCameraOptions:gs,Evented:n.Evented,config:n.config,prewarm:function(){Xt().acquire(gt)},clearPrewarmedResources:function(){const d=yt;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(gt),yt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return n.config.ACCESS_TOKEN},set accessToken(d){n.config.ACCESS_TOKEN=d},get baseApiUrl(){return n.config.API_URL},set baseApiUrl(d){n.config.API_URL=d},get workerCount(){return jt.workerCount},set workerCount(d){jt.workerCount=d},get maxParallelImageRequests(){return n.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){n.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){n.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:n.exported.setNow,restoreNow:n.exported.restoreNow};return vn}),a}()}).call(this,U(31))},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.OverlayLayerBase=void 0,w.OverlayLayerBase=class{constructor(){}addTo(O,I){this.options.sourceLayer&&this.setLayerSource(this.layerId,this.sourceId,this.options.sourceLayer),this.options.isHoverPointer&&this.hoverPointer(),this.options.isHoverFeatureState&&this.hoverFeatureState()}getSourceId(){return this.sourceId}getLayerId(){return this.layerId}getData(){var O,I;return(I=(O=this._map)===null||O===void 0?void 0:O.getSource(this.getSourceId()))===null||I===void 0?void 0:I._data}remove(){this._map&&this._map.removeSourceEx(this.sourceId)}hoverPointer(){this._map.hoverPointer(this.layerId)}hoverFeatureState(O,I){this._map.hoverFeatureState(this.layerId,this.sourceId,this.options.sourceLayer,O,I)}hoverPopup(O,I){return this._map.hoverPopup(this.layerId,O,I)}clickPopup(O,I){return this._map.clickPopup(this.layerId,O,I)}clickLayer(O){return this._map.clickLayer(this.layerId,O)}hoverLayer(O){return this._map.hoverLayer(this.layerId,O)}show(){this._map.show(this.layerId)}hide(){this._map.hide(this.layerId)}toggle(O){return this._map.toggle(this.layerId,O)}setProperty(O,I){return this._map.setProperty(this.layerId,O,I)}getLayerStyle(){return this._map.getLayerStyle(this.layerId)}setLayerStyle(O){return this._map.setLayerStyle(this.layerId,O)}setFilter(O){return this._map.setFilterEx(this.layerId,O)}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.equals=w.toRadian=w.EPSILON=void 0,w.EPSILON=1e-8;const O=Math.PI/180;w.toRadian=function(I){return I*O},w.equals=function(I,g){return Math.abs(I-g)<=w.EPSILON*Math.max(1,Math.abs(I),Math.abs(g))}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbCurve=void 0;const O=U(3);class I extends O.DbEntity{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbCurve"}}w.DbCurve=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.Projection=void 0;const O=U(1);class I{static lngLat2Mercator(a){const l=O.GeoPoint.convert(a),n=l.x*I.EQUATORIAL_SEMIPERIMETER/180;let u=Math.log(Math.tan((90+l.y)*Math.PI/360))/(Math.PI/180);return u=u*I.EQUATORIAL_SEMIPERIMETER/180,[n,u]}static mercator2LngLat(a){const l=O.GeoPoint.convert(a),n=l.x/I.EQUATORIAL_SEMIPERIMETER*180;let u=l.y/I.EQUATORIAL_SEMIPERIMETER*180;return u=180/Math.PI*(2*Math.atan(Math.exp(u*Math.PI/180))-Math.PI/2),[n,u]}}w.Projection=I,I.EQUATORIAL_SEMIPERIMETER=200375083427892e-7,I.EARTH_BOUNDS=[-I.EQUATORIAL_SEMIPERIMETER,-I.EQUATORIAL_SEMIPERIMETER,I.EQUATORIAL_SEMIPERIMETER,I.EQUATORIAL_SEMIPERIMETER]},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.isGeoPointLike=void 0;const O=U(1);w.isGeoPointLike=function(I){if(Array.isArray(I)){const[g,a,l]=I;return typeof g=="number"&&typeof a=="number"&&(l===void 0||typeof l=="number")}return I instanceof O.GeoPoint||typeof I=="object"&&("x"in I&&"y"in I||"lng"in I&&"lat"in I||"lon"in I&&"lat"in I)}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.geoBounds=w.GeoBounds=void 0;const O=U(36),I=U(12),g=U(1),a=U(9);class l{constructor(u,v){this.min=u!=null?u:new g.GeoPoint(-1/0,-1/0),this.max=v!=null?v:new g.GeoPoint(1/0,1/0),this.set(this.min,this.max)}static fromArray(u){return new l(new g.GeoPoint(u[0],u[1]),new g.GeoPoint(u[2],u[3]))}static fromString(u){const v=JSON.parse(u);if(Array.isArray(v)&&v.length===4)return new l(new g.GeoPoint(v[0],v[1]),new g.GeoPoint(v[2],v[3]));throw Error("param is not array length four string")}static fromDataExtent(u){const v=new l,_=[];return I.transform.convert(u,b=>(_.push(new g.GeoPoint(b[0],b[1])),b)),v.update(_),v}static fromCenterWH(u,v,_){const b=g.GeoPoint.convert(u);return _=_!=null?_:v,new l(new g.GeoPoint(b.x-v/2,b.y-_/2),new g.GeoPoint(b.x+v/2,b.y+_/2))}set(u,v){let _=Math.min(u.x,v.x),b=Math.min(u.y,v.y),M=Math.max(u.x,v.x),P=Math.max(u.y,v.y);this.min.x=_,this.min.y=b,this.max.x=M,this.max.y=P}center(){return new g.GeoPoint((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2)}randomPoint(u=.6,v=.6){const _=this.width()*Math.random()*u,b=this.height()*Math.random()*v,M=this.center();return new g.GeoPoint(M.x-this.width()*u/2+_,M.y-this.height()*v/2+b)}randomPoints(u,v,_=.6,b=.6){const M=O.randInt(u,v),P=[];for(let C=0;C<M;C++)P.push(this.randomPoint(_,b));return P}randomGeoJsonPointCollection(u,v=.6,_=.6,b){if(b=b!=null?b:()=>{},u===1){const M=this.randomPoint(v,_);return{type:"Feature",id:1,properties:Object.assign({index:1},b(1)),geometry:{type:"Point",coordinates:[M.x,M.y]}}}{const M={type:"FeatureCollection",features:[]};for(let P=0;P<u;P++){const C=this.randomPoint(v,_),L={type:"Feature",id:P+1,properties:Object.assign({index:P+1},b(P+1)),geometry:{type:"Point",coordinates:[C.x,C.y]}};M.features.push(L)}return M}}randomGeoJsonLineCollection(u,v,_=.6,b=.6,M){M=M!=null?M:()=>{};{const P=O.randInt(1,u),C={type:"FeatureCollection",features:[]};for(let L=0;L<P;L++){const D=O.randInt(2,v),F=[];for(let K=0;K<D;K++){const ee=this.randomPoint(_,b);F.push([ee.x,ee.y])}const j={type:"Feature",id:L+1,properties:Object.assign({index:L+1},M(L+1)),geometry:{type:"LineString",coordinates:F}};C.features.push(j)}return C}}randomGeoJsonPolygonCollection(u,v,_=.6,b=.6,M){M=M!=null?M:()=>{};{const P=O.randInt(1,u),C={type:"FeatureCollection",features:[]};for(let L=0;L<P;L++){const D=O.randInt(3,v),F=[];for(let K=0;K<D;K++)F.push(this.randomPoint(_,b));const j={type:"Feature",id:L+1,properties:Object.assign({index:L+1},M(L+1)),geometry:{type:"Polygon",coordinates:[F]}};C.features.push(j)}return C}}toArray(){return[this.min.x,this.min.y,this.max.x,this.max.y]}toPointArray(){return[[this.min.x,this.max.y],[this.max.x,this.max.y],[this.max.x,this.min.y],[this.min.x,this.min.y]]}toString(u=6){return`${this.min.toString(u)}, ${this.max.toString(u)}`}clone(){return new l(this.min,this.max)}square(u){if(u){const v=a.Projection.lngLat2Mercator(this.min),_=a.Projection.lngLat2Mercator(this.max),b=new l(g.GeoPoint.convert(v),g.GeoPoint.convert(_)).square(!1),M=a.Projection.mercator2LngLat(b.min),P=a.Projection.mercator2LngLat(b.max);return new l(g.GeoPoint.convert(M),g.GeoPoint.convert(P))}{const v=this.center(),_=this.width()>this.height()?this.width():this.height();return new l(new g.GeoPoint(v.x-_/2,v.y-_/2),new g.GeoPoint(v.x+_/2,v.y+_/2))}}width(){return this.max.x-this.min.x}height(){return this.max.y-this.min.y}scale(u,v){u=u||1,v||(v=this.center());const _=v.x,b=v.y,M=(this.min.x-_)*u+_,P=(this.min.y-b)*u+b,C=(this.max.x-_)*u+_,L=(this.max.y-b)*u+b;return new l(new g.GeoPoint(M,P),new g.GeoPoint(C,L))}scaleXY(u,v,_){u=u!=null?u:1,v=v!=null?v:1,_||(_=this.center());const b=_.x,M=_.y,P=(this.min.x-b)*u+b,C=(this.min.y-M)*u+M,L=(this.max.x-b)*v+b,D=(this.max.y-M)*v+M;return new l(new g.GeoPoint(P,C),new g.GeoPoint(L,D))}translate(u,v){this.min.x+=u,this.min.y+=v,this.max.x+=u,this.max.y+=v}update(u){let v=-1/0,_=-1/0,b=1/0,M=1/0;for(let P=0;P<u.length;P++){const C=u[P];C.x<b&&(b=C.x),C.x>v&&(v=C.x),C.y<M&&(M=C.y),C.y>_&&(_=C.y)}this.min.x=b,this.min.y=M,this.max.x=v,this.max.y=_}updateByBounds(u){let v,_=-1/0,b=-1/0,M=1/0,P=1/0;for(let C=0;C<u.length;C++)v=u[C],v.min.x<M&&(M=v.min.x),v.min.y<P&&(P=v.min.y),v.max.x>_&&(_=v.max.x),v.max.y>b&&(b=v.max.y);this.min.x=M,this.min.y=P,this.max.x=_,this.max.y=b}intersect(u){const v=Math.max(this.min.x,u.min.x),_=Math.min(this.max.x,u.max.x),b=Math.max(this.min.y,u.min.y),M=_-v,P=Math.min(this.max.y,u.max.y)-b;if(M<0||P<0)return null;const C=new g.GeoPoint(v,b),L=new g.GeoPoint(v+M,b+P);return new l(C,L)}union(u){const v=new g.GeoPoint(Math.min(this.min.x,u.min.x),Math.min(this.min.y,u.min.y)),_=new g.GeoPoint(Math.max(this.max.x,u.max.x),Math.max(this.max.y,u.max.y));return new l(v,_)}isIntersect(u){return this.min.x<=u.max.x&&this.max.x>=u.min.x&&this.min.y<=u.max.y&&u.min.y<=this.max.y}isContains(u){return this.min.x<=u.min.x&&this.min.y<=u.min.y&&this.max.x>=u.max.x&&this.max.y>=u.max.y}contains(u){return u.x>=this.min.x&&u.x<=this.max.x&&u.y>=this.min.y&&u.y<=this.max.y}closestInterval(u,v,_=!0){return v<=u.min?{value:u.min,contained:!1}:u.max<=v?{value:u.max,contained:!1}:_?{value:v,contained:!0}:v-u.min<u.max-v?{value:u.min,contained:!0}:{value:u.max,contained:!0}}closestPoint(u,v=!0){const _=this.closestInterval({min:this.min.x,max:this.max.x},u.x,v),b=this.closestInterval({min:this.min.y,max:this.max.y},u.y,v);return!_.contained&&!b.contained?new g.GeoPoint(_.value,b.value):_.contained&&!b.contained?new g.GeoPoint(u.x,b.value):!_.contained&&b.contained?new g.GeoPoint(_.value,u.y):v?u:Math.abs(u.x-_.value)<Math.abs(u.y-b.value)?new g.GeoPoint(_.value,u.y):new g.GeoPoint(u.x,b.value)}}w.GeoBounds=l,w.geoBounds=function(n,u){return new l(n,u)}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.transform=void 0;const O=U(37),I=U(73),g=U(74);w.transform={CRSTypes:O.CRSTypes,convert:I.default,EpsgCrsTypes:g.EpsgCrsTypes,getEpsgParam:g.getEpsgParam}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.MathUtils=void 0,function(O){function I(g,a,l){return g<a?a:g>l?l:g}O.clamp=I,O.wrap=function(g,a,l,n=!1){const u=l-a,v=((g-a)%u+u)%u+a;return v===a?n?a:l:v},O.smoothStep=function(g,a,l){return(l=I((l-g)/(a-g),0,1))*l*(3-2*l)},O.smootherStep=function(g,a,l){return(l=I((l-g)/(a-g),0,1))*l*l*(l*(6*l-15)+10)},O.map=function(g,a,l,n,u){return(g-a)*(u-n)/(l-a)+n},O.min2=function(g,a){let l;return g!==void 0&&(l=g),a!==void 0&&(l=l===void 0?a:Math.min(l,a)),l},O.lerp=function(g,a,l){return g+l*(a-g)},O.max2=function(g,a){let l;return g!==void 0&&(l=g),a!==void 0&&(l=l===void 0?a:Math.max(l,a)),l},O.isClamped=function(g,a,l){return!(a!==void 0&&g<a)&&!(l!==void 0&&g>l)},O.easeInOutCubic=function(g,a,l){return g+(a-g)*(l<.5?4*l*l*l:(l-1)*(2*l-2)*(2*l-2)+1)},O.equals=function(g,a,l=8){const n=1/Math.pow(10,l);return Math.abs(g-a)<=n}}(w.MathUtils||(w.MathUtils={}))},function(he,w,U){U.r(w),U.d(w,"invariant",function(){return I}),U.d(w,"warning",function(){return O});var O=function(){},I=function(){}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.clamp=void 0,w.clamp=(O,I,g)=>Math.min(Math.max(g,O),I)},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.mix=void 0,w.mix=(O,I,g)=>-g*O+g*I+O},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.bufferConvexPolygon=w.clipPolygon=w._getEdgeIntersection=w.clipSegment=w.multiLineSplit=w.lineSplit=w.segmentIntersect=w.closestPointOnPolylines=w.closestPointOnPolyline=w.closestPointOnSegment=w.pointToSegmentDistance=w.simplify=void 0;const O=U(11),I=U(1);var g=U(13).MathUtils.wrap,a=U(18).Math2D.dist;const l=U(0);function n(L,D,F){return C(L,D,F)}function u(L,D){let F,j=0,K=0,ee=0;for(let Q=1;Q<D.length;Q++){const le=n(L,D[Q-1],D[Q]),pe=a(le.x,le.y,L.x,L.y,le.z,L.z);Q===1?(j=pe,F=le,K=0,ee=a(le.x,le.y,D[Q-1].x,D[Q-1].y,le.z,D[Q-1].z)):pe<j&&(j=pe,F=le,K=Q-1,ee=a(le.x,le.y,D[Q-1].x,D[Q-1].y,le.z,D[Q-1].z))}return{closestLength:j,closestPoint:F,closestIndex:K,closestPrePointDist:ee}}function v(L,D,F,j,K,ee,Q,le){const pe=(le-ee)*(F-L)-(Q-K)*(j-D),de=(Q-K)*(D-ee)-(le-ee)*(L-K),Ee=(F-L)*(D-ee)-(j-D)*(L-K);if(l.isZero(pe))return l.isZero(de)&&l.isZero(Ee)?{result:"COLINEAR",status:!1}:{result:"PARALLEL",status:!1};const Pe=de/pe,Je=Ee/pe;return Pe>=0&&Pe<=1&&Je>=0&&Je<=1?{status:!0,x:L+Pe*(F-L),y:D+Pe*(j-D),ratio:Pe}:{result:"NONE",status:!1}}function _(L,D,F){if(F=F!=null?F:6,L.length<2||D.length<2)return[[...L]];const j=[],K=Q=>{let le=0;for(le=0;le<j.length;le++){const pe=j[le];if(!(pe.closestPointIndex<Q.closestPointIndex)&&!(pe.closestPointIndex===Q.closestPointIndex&&pe.ratio<Q.ratio))break}j.splice(le,0,Q)};for(let Q=1;Q<L.length;Q++)for(let le=1;le<D.length;le++){const pe=v(L[Q-1].x,L[Q-1].y,L[Q].x,L[Q].y,D[le-1].x,D[le-1].y,D[le].x,D[le].y);if(pe.status&&!l.isZero(pe.ratio)&&!l.isZero(pe.ratio-1)){const de=new I.GeoPoint(pe.x,pe.y),Ee=new I.GeoPoint(L[Q-1].x,L[Q-1].y),Pe=new I.GeoPoint(L[Q].x,L[Q].y);de.equals(Ee,F)||de.equals(Pe,F)||K({point:de,closestPointIndex:Q-1,ratio:pe.ratio})}}const ee=[];if(j.length===0)return[[...L]];{let Q=[],le=0;for(let pe=0;pe<j.length;pe++){const de=j[pe];for(;!(le>de.closestPointIndex||le>=L.length);)Q.push(L[le]),le++;Q.push(de.point),ee.push(Q),Q=[],Q.push(de.point)}for(let pe=le;pe<L.length;pe++)Q.push(L[pe]);ee.push(Q)}return ee}function b(L,D,F,j){const K=D.x-L.x,ee=D.y-L.y,Q=j.min,le=j.max;let pe=0,de=0;return 8&F?(pe=L.x+K*(le.y-L.y)/ee,de=le.y):4&F?(pe=L.x+K*(Q.y-L.y)/ee,de=Q.y):2&F?(pe=le.x,de=L.y+ee*(le.x-L.x)/K):1&F&&(pe=Q.x,de=L.y+ee*(Q.x-L.x)/K),new I.GeoPoint(pe,de)}function M(L,D){let F=0;return L.x<D.min.x?F|=1:L.x>D.max.x&&(F|=2),L.y<D.min.y?F|=4:L.y>D.max.y&&(F|=8),F}function P(L,D){const F=D.x-L.x,j=D.y-L.y;return F*F+j*j}function C(L,D,F,j){if(L.z!==void 0&&D.z!==void 0&&F.z!==void 0){const Ee=function(Pe,Je,xt){const vt=xt.clone().sub(Je),ct=Pe.clone().sub(Je).dot(vt)/vt.lengthSq();return Je.clone().lerp(xt,Math.min(Math.max(ct,0),1))}(L,D,F);if(j){const Pe=L.x-Ee.x,Je=L.y-Ee.y;let xt=0;return Ee.z!==void 0&&(xt=L.z-Ee.z),Pe*Pe+Je*Je+xt*xt}return Ee}let K=D.x,ee=D.y,Q=F.x-K,le=F.y-ee;const pe=Q*Q+le*le;let de;return pe>0&&(de=((L.x-K)*Q+(L.y-ee)*le)/pe,de>1?(K=F.x,ee=F.y):de>0&&(K+=Q*de,ee+=le*de)),Q=L.x-K,le=L.y-ee,j?Q*Q+le*le:new I.GeoPoint(K,ee)}w.simplify=function(L,D){if(!D||!L.length)return L.slice();const F=D*D;return L=function(j,K){const ee=j.length,Q=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(ee);let le;Q[0]=Q[ee-1]=1,function de(Ee,Pe,Je,xt,vt){let ct,Rt,Pt=0,nn=0;for(ct=xt+1;ct<=vt-1;ct++)Rt=C(Ee[ct],Ee[xt],Ee[vt],!0),Rt>Pt&&(nn=ct,Pt=Rt);Pt>Je&&(Pe[nn]=1,de(Ee,Pe,Je,xt,nn),de(Ee,Pe,Je,nn,vt))}(j,Q,K,0,ee-1);var pe=[];for(le=0;le<ee;le++)Q[le]&&pe.push(j[le]);return pe}(L=function(j,K){for(var ee=[j[0]],Q=1,le=0,pe=j.length;Q<pe;Q++)P(j[Q],j[le])>K&&(ee.push(j[Q]),le=Q);return le<pe-1&&ee.push(j[pe-1]),ee}(L,F),F)},w.pointToSegmentDistance=function(L,D,F){return Math.sqrt(C(L,D,F,!0))},w.closestPointOnSegment=n,w.closestPointOnPolyline=u,w.closestPointOnPolylines=function(L,D){let F,j=Number.MAX_VALUE,K=0,ee=0,Q=0;for(let le=0;le<D.length;le++){const pe=D[le],de=O.GeoBounds.fromDataExtent(pe).closestPoint(L);if(a(de.x,de.y,L.x,L.y,de.z,L.z)>j)continue;const Ee=u(L,pe);Ee.closestLength<j&&(j=Ee.closestLength,F=Ee.closestPoint,K=le,ee=Ee.closestIndex,Q=Ee.closestPrePointDist)}return{closestLength:j,closestPoint:F,closestIndex:K,closestPointIndex:ee,closestPrePointDist:Q}},w.segmentIntersect=v,w.lineSplit=_,w.multiLineSplit=function(L,D){const F=[],j=L.map(ee=>O.GeoBounds.fromDataExtent(ee)),K=new Set;for(let ee=0;ee<L.length;ee++)if(!K.has(ee)){for(let Q=0;Q<L.length;Q++)if(ee!==Q&&!K.has(ee)&&!K.has(Q)&&j[ee].isIntersect(j[Q])){const le=_(L[ee],L[Q]);if(le.length>1){K.add(ee),L.push(...le),j.push(...le.map(pe=>O.GeoBounds.fromDataExtent(pe)));break}}}for(let ee=0;ee<L.length;ee++)K.has(ee)||F.push(L[ee]);return F},w.clipSegment=function(L,D,F){let j,K,ee,Q=M(L,F),le=M(D,F);for(;;){if(!(Q|le))return[L,D];if(Q&le)return!1;j=Q||le,K=b(L,D,j,F),ee=M(K,F),j===Q?(L=K,Q=ee):(D=K,le=ee)}},w._getEdgeIntersection=b,w.clipPolygon=function(L,D){let F;const j=[1,4,2,8];let K,ee,Q,le,pe,de,Ee,Pe;for(K=0,de=L.length;K<de;K++)L[K]._code=M(L[K],D);for(Q=0;Q<4;Q++){for(Ee=j[Q],F=[],K=0,de=L.length,ee=de-1;K<de;ee=K++)le=L[K],pe=L[ee],le._code&Ee?pe._code&Ee||(Pe=b(pe,le,Ee,D),Pe._code=M(Pe,D),F.push(Pe)):(pe._code&Ee&&(Pe=b(pe,le,Ee,D),Pe._code=M(Pe,D),F.push(Pe)),F.push(le));L=F}return L},w.bufferConvexPolygon=function(L,D){const F=[];for(let j=0;j<L.length;j++){const K=g(j-1,-1,L.length-1),ee=g(j+1,-1,L.length-1),Q=L[K],le=L[j],pe=L[ee],de=Q.sub(le).unit(),Ee=pe.sub(le).unit(),Pe=Ee.angleWithSep(de.x,de.y),Je=de.add(Ee).unit().mult(-1*D/Math.sin(Pe/2));F.push(le.add(Je))}return F}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.Math2D=void 0;const O=U(1);(function(I){function g(l,n,u,v){return(l-u)*(l-u)+(n-v)*(n-v)}function a(l,n,u,v,_,b){return Math.sqrt(_!==void 0&&b!==void 0?(l-u)*(l-u)+(n-v)*(n-v)+(_-b)*(_-b):g(l,n,u,v))}I.Box=class{constructor(l=0,n=0,u=0,v=0){this.x=l,this.y=n,this.w=u,this.h=v}set(l,n,u,v){this.x=l,this.y=n,this.w=u,this.h=v}contains(l,n){return this.x<=l&&this.x+this.w>=l&&this.y<=n&&this.y+this.h>=n}containsBox(l){const n=l.x+l.w,u=l.y+l.h;return this.contains(l.x,l.y)&&this.contains(n,l.y)&&this.contains(l.x,u)&&this.contains(n,u)}intersects(l){return this.x<=l.x+l.w&&this.x+this.w>=l.x&&this.y<=l.y+l.h&&this.y+this.h>=l.y}},I.distSquared=g,I.dist=a,I.lineDist=function(l){let n=0;const u=l.map(v=>O.GeoPoint.convert(v));for(let v=1;v<u.length;v++)n+=a(u[v-1].x,u[v-1].y,u[v].x,u[v].y,u[v].z,u[v].z);return n},I.computeSquaredLineLength=function(l){let n=0;const u=l.length-4;for(let v=0;v<u;v+=3){const _=l[v+3]-l[v],b=l[v+4]-l[v+1];n+=_*_+b*b}return n},I.distToSegmentSquared=function(l,n,u,v,_,b){const M=g(u,v,_,b);if(M===0)return g(l,n,u,v);let P=((l-u)*(_-u)+(n-v)*(b-v))/M;return P=Math.max(0,Math.min(1,P)),g(l,n,u+P*(_-u),v+P*(b-v))},I.intersectLineAndCircle=function(l,n,u,v,_,b=0,M=0){const P=u-l,C=v-n,L=P*P+C*C,D=l*v-u*n-C*b+P*M,F=_*_*L-D*D;if(F<-1e-10)return;const j=D*C,K=-D*P;if(F<1e-10)return{x1:b+j/L,y1:M+K/L};const ee=Math.sqrt(F),Q=(C<0?-1:1)*P*ee,le=Math.abs(C)*ee;return{x1:b+(j+Q)/L,y1:M+(K+le)/L,x2:b+(j-Q)/L,y2:M+(K-le)/L}},I.intersectLines=function(l,n,u,v,_,b,M,P,C={x:0,y:0}){const L=(l-u)*(b-P)-(n-v)*(_-M);if(L===0)return;const D=((l*v-n*u)*(_-M)-(l-u)*(_*P-b*M))/L,F=((l*v-n*u)*(b-P)-(n-v)*(_*P-b*M))/L;return C.x=D,C.y=F,C}})(w.Math2D||(w.Math2D={}))},function(he,w,U){var O=this&&this.__createBinding||(Object.create?function(g,a,l,n){n===void 0&&(n=l),Object.defineProperty(g,n,{enumerable:!0,get:function(){return a[l]}})}:function(g,a,l,n){n===void 0&&(n=l),g[n]=a[l]}),I=this&&this.__exportStar||function(g,a){for(var l in g)l==="default"||a.hasOwnProperty(l)||O(a,g,l)};Object.defineProperty(w,"__esModule",{value:!0}),I(U(42),w),I(U(43),w),I(U(44),w),I(U(98),w)},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.interpolate=void 0;const O=U(14),I=U(28),g=U(15),a=U(16),l=U(21),n=U(48),u=U(23),v=U(49),_=(M,P)=>C=>a.mix(M,P,C);function b(M,P,C){const L=[],D=C||(typeof(F=M[0])=="number"?_:typeof F=="string"?I.color.test(F)?l.mixColor:n.mixComplex:Array.isArray(F)?n.mixArray:typeof F=="object"?n.mixObject:void 0);var F;const j=M.length-1;for(let K=0;K<j;K++){let ee=D(M[K],M[K+1]);if(P){const Q=Array.isArray(P)?P[K]:P;ee=u.pipe(Q,ee)}L.push(ee)}return L}w.interpolate=function(M,P,{clamp:C=!0,ease:L,mixer:D}={}){const F=M.length;O.invariant(F===P.length,"Both input and output ranges must be the same length"),O.invariant(!L||!Array.isArray(L)||L.length===F-1,"Array of easing functions must be of length `input.length - 1`, as it applies to the transitions **between** the defined values."),M[0]>M[F-1]&&(M=[].concat(M),P=[].concat(P),M.reverse(),P.reverse());const j=b(P,L,D),K=F===2?function([ee,Q],[le]){return pe=>le(v.progress(ee,Q,pe))}(M,j):function(ee,Q){const le=ee.length,pe=le-1;return de=>{let Ee=0,Pe=!1;if(de<=ee[0]?Pe=!0:de>=ee[pe]&&(Ee=pe-1,Pe=!0),!Pe){let xt=1;for(;xt<le&&!(ee[xt]>de||xt===pe);xt++);Ee=xt-1}const Je=v.progress(ee[Ee],ee[Ee+1],de);return Q[Ee](Je)}}(M,j);return C?ee=>K(g.clamp(M[0],M[F-1],ee)):K}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.mixColor=w.mixLinearColor=void 0;const O=U(14),I=U(28),g=U(16);w.mixLinearColor=(u,v,_)=>{const b=u*u,M=v*v;return Math.sqrt(Math.max(0,_*(M-b)+b))};const a=[I.hex,I.rgba,I.hsla],l=u=>a.find(v=>v.test(u)),n=u=>`'${u}' is not an animatable color. Use the equivalent color code instead.`;w.mixColor=(u,v)=>{const _=l(u),b=l(v);O.invariant(!!_,n(u)),O.invariant(!!b,n(v)),O.invariant(_.transform===b.transform,"Both colors must be hex/RGBA, OR both must be HSLA.");const M=_.parse(u),P=b.parse(v),C=Object.assign({},M),L=_===I.hsla?g.mix:w.mixLinearColor;return D=>{for(const F in C)F!=="alpha"&&(C[F]=L(M[F],P[F],D));return C.alpha=g.mix(M.alpha,P.alpha,D),_.transform(C)}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.isNum=w.zeroPoint=void 0,w.zeroPoint={x:0,y:0,z:0},w.isNum=O=>typeof O=="number"},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.pipe=void 0;const O=(I,g)=>a=>g(I(a));w.pipe=(...I)=>I.reduce(O)},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.bounceInOut=w.bounceIn=w.bounceOut=w.anticipate=w.backInOut=w.backOut=w.backIn=w.circInOut=w.circOut=w.circIn=w.easeInOut=w.easeOut=w.easeIn=w.linear=void 0;const O=U(52);w.linear=I=>I,w.easeIn=O.createExpoIn(2),w.easeOut=O.reverseEasing(w.easeIn),w.easeInOut=O.mirrorEasing(w.easeIn),w.circIn=I=>1-Math.sin(Math.acos(I)),w.circOut=O.reverseEasing(w.circIn),w.circInOut=O.mirrorEasing(w.circOut),w.backIn=O.createBackIn(1.525),w.backOut=O.reverseEasing(w.backIn),w.backInOut=O.mirrorEasing(w.backIn),w.anticipate=O.createAnticipate(1.525),w.bounceOut=I=>{if(I===1||I===0)return I;const g=I*I;return I<4/11?7.5625*g:I<8/11?9.075*g-9.9*I+3.4:I<.9?4356/361*g-35442/1805*I+16061/1805:10.8*I*I-20.52*I+10.72},w.bounceIn=O.reverseEasing(w.bounceOut),w.bounceInOut=I=>I<.5?.5*(1-w.bounceOut(1-2*I)):.5*w.bounceOut(2*I-1)+.5},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.isPoint=void 0,w.isPoint=O=>O.hasOwnProperty("x")&&O.hasOwnProperty("y")},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.Polygon=void 0;const O=U(0),I=U(6);class g extends I.OverlayLayerBase{constructor(l){super(),this.options=O.extend({},l)}addTo(l,n){var u,v;if(this._map=l,this.sourceId=(u=this.options.sourceId)!==null&&u!==void 0?u:"custom_polygon_"+O.RandomID(),this.options.data){const _=O.createPolygonGeoJson(this.options.data);l.addGeoJSONSource(this.sourceId,_)}this.layerId=(v=this.options.layerId)!==null&&v!==void 0?v:"custom_polygon_layer_"+O.RandomID(),l.addFillLayer(this.layerId,this.sourceId,this.options,n),super.addTo(l,n)}setData(l){l=O.createPolygonGeoJson(l),this._map.setData(this.sourceId,l)}setFillSortKey(l){return this._map.setFillSortKey(this.layerId,l),this}setFillAntialias(l){return this._map.setFillAntialias(this.layerId,l),this}setFillOpacity(l){return this._map.setFillOpacity(this.layerId,l),this}setFillColor(l){return this._map.setFillColor(this.layerId,l),this}setFillOutlineColor(l){return this._map.setFillOutlineColor(this.layerId,l),this}setFillTranslate(l){return this._map.setFillTranslate(this.layerId,l),this}setFillTranslateAnchor(l){return this._map.setFillTranslateAnchor(this.layerId,l),this}setFillPattern(l){return this._map.setFillPattern(this.layerId,l),this}getFillSortKey(){return this._map.getFillSortKey(this.layerId)}getFillAntialias(){return this._map.getFillAntialias(this.layerId)}getFillOpacity(){return this._map.getFillOpacity(this.layerId)}getFillColor(){return this._map.getFillColor(this.layerId)}getFillOutlineColor(){return this._map.getFillOutlineColor(this.layerId)}getFillTranslate(){return this._map.getFillTranslate(this.layerId)}getFillTranslateAnchor(){return this._map.getFillTranslateAnchor(this.layerId)}getFillPattern(){return this._map.getFillPattern(this.layerId)}}w.Polygon=g},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.Polyline=void 0;const O=U(0),I=U(6);class g extends I.OverlayLayerBase{constructor(l){super(),this.options=O.extend({},l)}addTo(l,n){var u,v;if(this._map=l,this.sourceId=(u=this.options.sourceId)!==null&&u!==void 0?u:"custom_polyline_"+O.RandomID(),this.options.data){const _=O.createLineGeoJson(this.options.data);l.addGeoJSONSource(this.sourceId,_)}this.layerId=(v=this.options.layerId)!==null&&v!==void 0?v:"custom_polyline_layer_"+O.RandomID(),l.addLineLayer(this.layerId,this.sourceId,this.options,n),super.addTo(l,n)}setData(l){l=O.createLineGeoJson(l),this._map.setData(this.sourceId,l)}setLineCap(l){return this._map.setLineCap(this.layerId,l),this}getLineCap(){return this._map.getLineCap(this.layerId)}setLineJoin(l){return this._map.setLineJoin(this.layerId,l),this}getLineJoin(){return this._map.getLineJoin(this.layerId)}setLineMiterMimit(l){return this._map.setLineMiterMimit(this.layerId,l),this}getLineMiterMimit(){return this._map.getLineMiterMimit(this.layerId)}setLineRoundLimit(l){return this._map.setLineRoundLimit(this.layerId,l),this}getLineRoundLimit(){return this._map.getLineRoundLimit(this.layerId)}setLineSortKey(l){return this._map.setLineSortKey(this.layerId,l),this}getLineSortKey(){return this._map.getLineSortKey(this.layerId)}setLineOpacity(l){return this._map.setLineOpacity(this.layerId,l),this}getLineOpacity(){return this._map.getLineOpacity(this.layerId)}setLineColor(l){return this._map.setLineColor(this.layerId,l),this}getLineColor(){return this._map.getLineColor(this.layerId)}setLineTranslate(l){return this._map.setLineTranslate(this.layerId,l),this}getLineTranslate(){return this._map.getLineTranslate(this.layerId)}setLineTranslateAnchor(l){return this._map.setLineTranslateAnchor(this.layerId,l),this}getLineTranslateAnchor(){return this._map.getLineTranslateAnchor(this.layerId)}setLineWidth(l){return this._map.setLineWidth(this.layerId,l),this}getLineWidth(){return this._map.getLineWidth(this.layerId)}setLineGapWidth(l){return this._map.setLineGapWidth(this.layerId,l),this}getLineGapWidth(){return this._map.getLineGapWidth(this.layerId)}setLineOffset(l){return this._map.setLineOffset(this.layerId,l),this}getLineOffset(){return this._map.getLineOffset(this.layerId)}setLineBlur(l){return this._map.setLineBlur(this.layerId,l),this}getLineBlur(){return this._map.getLineBlur(this.layerId)}setLineDasharray(l){return this._map.setLineDasharray(this.layerId,l),this}getLineDasharray(){return this._map.getLineDasharray(this.layerId)}setLinePattern(l){return this._map.setLinePattern(this.layerId,l),this}getLinePattern(){return this._map.getLinePattern(this.layerId)}setLineGradient(l){return this._map.setLineGradient(this.layerId,l),this}getLineGradient(){return this._map.getLineGradient(this.layerId)}}w.Polyline=g},function(he,w,U){U.r(w),U.d(w,"alpha",function(){return _}),U.d(w,"number",function(){return v}),U.d(w,"scale",function(){return b}),U.d(w,"degrees",function(){return P}),U.d(w,"percent",function(){return C}),U.d(w,"progressPercentage",function(){return j}),U.d(w,"px",function(){return L}),U.d(w,"vh",function(){return D}),U.d(w,"vw",function(){return F}),U.d(w,"hsla",function(){return Q}),U.d(w,"rgbUnit",function(){return pe}),U.d(w,"rgba",function(){return de}),U.d(w,"hex",function(){return Ee}),U.d(w,"color",function(){return Pe}),U.d(w,"complex",function(){return Rt}),U.d(w,"filter",function(){return cn});var O=function(){return(O=Object.assign||function(ht){for(var un,rn=1,wn=arguments.length;rn<wn;rn++)for(var An in un=arguments[rn])Object.prototype.hasOwnProperty.call(un,An)&&(ht[An]=un[An]);return ht}).apply(this,arguments)},I=function(ht,un){return function(rn){return Math.max(Math.min(rn,un),ht)}},g=function(ht){return ht%1?Number(ht.toFixed(5)):ht},a=/(-)?([\d]*\.?[\d])+/g,l=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,n=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function u(ht){return typeof ht=="string"}var v={test:function(ht){return typeof ht=="number"},parse:parseFloat,transform:function(ht){return ht}},_=O(O({},v),{transform:I(0,1)}),b=O(O({},v),{default:1}),M=function(ht){return{test:function(un){return u(un)&&un.endsWith(ht)&&un.split(" ").length===1},parse:parseFloat,transform:function(un){return""+un+ht}}},P=M("deg"),C=M("%"),L=M("px"),D=M("vh"),F=M("vw"),j=O(O({},C),{parse:function(ht){return C.parse(ht)/100},transform:function(ht){return C.transform(100*ht)}}),K=function(ht,un){return function(rn){return Boolean(u(rn)&&n.test(rn)&&rn.startsWith(ht)||un&&Object.prototype.hasOwnProperty.call(rn,un))}},ee=function(ht,un,rn){return function(wn){var An;if(!u(wn))return wn;var dn=wn.match(a),Lr=dn[0],oi=dn[1],kn=dn[2],xi=dn[3];return(An={})[ht]=parseFloat(Lr),An[un]=parseFloat(oi),An[rn]=parseFloat(kn),An.alpha=xi!==void 0?parseFloat(xi):1,An}},Q={test:K("hsl","hue"),parse:ee("hue","saturation","lightness"),transform:function(ht){var un=ht.hue,rn=ht.saturation,wn=ht.lightness,An=ht.alpha,dn=An===void 0?1:An;return"hsla("+Math.round(un)+", "+C.transform(g(rn))+", "+C.transform(g(wn))+", "+g(_.transform(dn))+")"}},le=I(0,255),pe=O(O({},v),{transform:function(ht){return Math.round(le(ht))}}),de={test:K("rgb","red"),parse:ee("red","green","blue"),transform:function(ht){var un=ht.red,rn=ht.green,wn=ht.blue,An=ht.alpha,dn=An===void 0?1:An;return"rgba("+pe.transform(un)+", "+pe.transform(rn)+", "+pe.transform(wn)+", "+g(_.transform(dn))+")"}},Ee={test:K("#"),parse:function(ht){var un="",rn="",wn="",An="";return ht.length>5?(un=ht.substr(1,2),rn=ht.substr(3,2),wn=ht.substr(5,2),An=ht.substr(7,2)):(un=ht.substr(1,1),rn=ht.substr(2,1),wn=ht.substr(3,1),An=ht.substr(4,1),un+=un,rn+=rn,wn+=wn,An+=An),{red:parseInt(un,16),green:parseInt(rn,16),blue:parseInt(wn,16),alpha:An?parseInt(An,16)/255:1}},transform:de.transform},Pe={test:function(ht){return de.test(ht)||Ee.test(ht)||Q.test(ht)},parse:function(ht){return de.test(ht)?de.parse(ht):Q.test(ht)?Q.parse(ht):Ee.parse(ht)},transform:function(ht){return u(ht)?ht:ht.hasOwnProperty("red")?de.transform(ht):Q.transform(ht)}};function Je(ht){var un=[],rn=0,wn=ht.match(l);wn&&(rn=wn.length,ht=ht.replace(l,"${c}"),un.push.apply(un,wn.map(Pe.parse)));var An=ht.match(a);return An&&(ht=ht.replace(a,"${n}"),un.push.apply(un,An.map(v.parse))),{values:un,numColors:rn,tokenised:ht}}function xt(ht){return Je(ht).values}function vt(ht){var un=Je(ht),rn=un.values,wn=un.numColors,An=un.tokenised,dn=rn.length;return function(Lr){for(var oi=An,kn=0;kn<dn;kn++)oi=oi.replace(kn<wn?"${c}":"${n}",kn<wn?Pe.transform(Lr[kn]):g(Lr[kn]));return oi}}var ct=function(ht){return typeof ht=="number"?0:ht},Rt={test:function(ht){var un,rn,wn,An;return isNaN(ht)&&u(ht)&&((rn=(un=ht.match(a))===null||un===void 0?void 0:un.length)!==null&&rn!==void 0?rn:0)+((An=(wn=ht.match(l))===null||wn===void 0?void 0:wn.length)!==null&&An!==void 0?An:0)>0},parse:xt,createTransformer:vt,getAnimatableNone:function(ht){var un=xt(ht);return vt(ht)(un.map(ct))}},Pt=new Set(["brightness","contrast","saturate","opacity"]);function nn(ht){var un=ht.slice(0,-1).split("("),rn=un[0],wn=un[1];if(rn==="drop-shadow")return ht;var An=(wn.match(a)||[])[0];if(!An)return ht;var dn=wn.replace(An,""),Lr=Pt.has(rn)?1:0;return An!==wn&&(Lr*=100),rn+"("+Lr+dn+")"}var mn=/([a-z-]*)\(.*?\)/g,cn=O(O({},Rt),{getAnimatableNone:function(ht){var un=ht.match(mn);return un?un.map(nn).join(" "):ht}})},function(he,w,U){U.r(w),U.d(w,"cancelSync",function(){return b}),U.d(w,"flushSync",function(){return M}),U.d(w,"getFrameData",function(){return D});var O=typeof performance!="undefined"?function(){return performance.now()}:function(){return Date.now()},I=typeof window!="undefined"?function(F){return window.requestAnimationFrame(F)}:function(F){return setTimeout(function(){return F(O())},1/60*1e3)},g=!0,a=!1,l=!1,n={delta:0,timestamp:0},u=["read","update","preRender","render","postRender"],v=u.reduce(function(F,j){return F[j]=function(K){var ee=[],Q=[],le=0,pe=!1,de=new WeakSet,Ee={schedule:function(Pe,Je,xt){Je===void 0&&(Je=!1),xt===void 0&&(xt=!1);var vt=xt&&pe,ct=vt?ee:Q;return Je&&de.add(Pe),ct.indexOf(Pe)===-1&&(ct.push(Pe),vt&&pe&&(le=ee.length)),Pe},cancel:function(Pe){var Je=Q.indexOf(Pe);Je!==-1&&Q.splice(Je,1),de.delete(Pe)},process:function(Pe){var Je;if(pe=!0,ee=(Je=[Q,ee])[0],(Q=Je[1]).length=0,le=ee.length)for(var xt=0;xt<le;xt++){var vt=ee[xt];vt(Pe),de.has(vt)&&(Ee.schedule(vt),K())}pe=!1}};return Ee}(function(){return a=!0}),F},{}),_=u.reduce(function(F,j){var K=v[j];return F[j]=function(ee,Q,le){return Q===void 0&&(Q=!1),le===void 0&&(le=!1),a||L(),K.schedule(ee,Q,le)},F},{}),b=u.reduce(function(F,j){return F[j]=v[j].cancel,F},{}),M=u.reduce(function(F,j){return F[j]=function(){return v[j].process(n)},F},{}),P=function(F){return v[F].process(n)},C=function(F){a=!1,n.delta=g?1/60*1e3:Math.max(Math.min(F-n.timestamp,40),1),n.timestamp=F,l=!0,u.forEach(P),l=!1,a&&(g=!1,I(C))},L=function(){a=!0,g=!0,l||I(C)},D=function(){return n};w.default=_},function(he,w,U){var O=this&&this.__createBinding||(Object.create?function(g,a,l,n){n===void 0&&(n=l),Object.defineProperty(g,n,{enumerable:!0,get:function(){return a[l]}})}:function(g,a,l,n){n===void 0&&(n=l),g[n]=a[l]}),I=this&&this.__exportStar||function(g,a){for(var l in g)l==="default"||a.hasOwnProperty(l)||O(a,g,l)};Object.defineProperty(w,"__esModule",{value:!0}),I(U(5),w),I(U(61),w),I(U(0),w),I(U(2),w),I(U(19),w),I(U(101),w),I(U(130),w),I(U(148),w),I(U(149),w),U(150),I(U(32),w),I(U(151),w),I(U(152),w),I(U(153),w),I(U(154),w),I(U(6),w),I(U(26),w),I(U(27),w),I(U(155),w),I(U(156),w),I(U(157),w),I(U(158),w),I(U(159),w),I(U(160),w),I(U(161),w),I(U(34),w),I(U(162),w),I(U(163),w),I(U(164),w),I(U(165),w),I(U(166),w),I(U(167),w),I(U(168),w),I(U(169),w)},function(he,w){var U,O,I=he.exports={};function g(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function l(L){if(U===setTimeout)return setTimeout(L,0);if((U===g||!U)&&setTimeout)return U=setTimeout,setTimeout(L,0);try{return U(L,0)}catch{try{return U.call(null,L,0)}catch{return U.call(this,L,0)}}}(function(){try{U=typeof setTimeout=="function"?setTimeout:g}catch{U=g}try{O=typeof clearTimeout=="function"?clearTimeout:a}catch{O=a}})();var n,u=[],v=!1,_=-1;function b(){v&&n&&(v=!1,n.length?u=n.concat(u):_=-1,u.length&&M())}function M(){if(!v){var L=l(b);v=!0;for(var D=u.length;D;){for(n=u,u=[];++_<D;)n&&n[_].run();_=-1,D=u.length}n=null,v=!1,function(F){if(O===clearTimeout)return clearTimeout(F);if((O===a||!O)&&clearTimeout)return O=clearTimeout,clearTimeout(F);try{O(F)}catch{try{return O.call(null,F)}catch{return O.call(this,F)}}}(L)}}function P(L,D){this.fun=L,this.array=D}function C(){}I.nextTick=function(L){var D=new Array(arguments.length-1);if(arguments.length>1)for(var F=1;F<arguments.length;F++)D[F-1]=arguments[F];u.push(new P(L,D)),u.length!==1||v||l(M)},P.prototype.run=function(){this.fun.apply(null,this.array)},I.title="browser",I.browser=!0,I.env={},I.argv=[],I.version="",I.versions={},I.on=C,I.addListener=C,I.once=C,I.off=C,I.removeListener=C,I.removeAllListeners=C,I.emit=C,I.prependListener=C,I.prependOnceListener=C,I.listeners=function(L){return[]},I.binding=function(L){throw new Error("process.binding is not supported")},I.cwd=function(){return"/"},I.chdir=function(L){throw new Error("process.chdir is not supported")},I.umask=function(){return 0}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.MapGlUtils=w.upperCamelCase=w.kebabCase=void 0;const O=U(5);var I={paints:"fill-antialias,fill-opacity,fill-color,fill-outline-color,fill-translate,fill-translate-anchor,fill-pattern,fill-extrusion-opacity,fill-extrusion-color,fill-extrusion-translate,fill-extrusion-translate-anchor,fill-extrusion-pattern,fill-extrusion-height,fill-extrusion-base,fill-extrusion-vertical-gradient,line-opacity,line-color,line-translate,line-translate-anchor,line-width,line-gap-width,line-offset,line-blur,line-dasharray,line-pattern,line-gradient,circle-radius,circle-color,circle-blur,circle-opacity,circle-translate,circle-translate-anchor,circle-pitch-scale,circle-pitch-alignment,circle-stroke-width,circle-stroke-color,circle-stroke-opacity,heatmap-radius,heatmap-weight,heatmap-intensity,heatmap-color,heatmap-opacity,icon-opacity,icon-color,icon-halo-color,icon-halo-width,icon-halo-blur,icon-translate,icon-translate-anchor,text-opacity,text-color,text-halo-color,text-halo-width,text-halo-blur,text-translate,text-translate-anchor,raster-opacity,raster-hue-rotate,raster-brightness-min,raster-brightness-max,raster-saturation,raster-contrast,raster-resampling,raster-fade-duration,hillshade-illumination-direction,hillshade-illumination-anchor,hillshade-exaggeration,hillshade-shadow-color,hillshade-highlight-color,hillshade-accent-color,background-color,background-pattern,background-opacity".split(","),layouts:"visibility,fill-sort-key,circle-sort-key,line-cap,line-join,line-miter-limit,line-round-limit,line-sort-key,symbol-placement,symbol-spacing,symbol-avoid-edges,symbol-sort-key,symbol-z-order,icon-allow-overlap,icon-ignore-placement,icon-optional,icon-rotation-alignment,icon-size,icon-text-fit,icon-text-fit-padding,icon-image,icon-rotate,icon-padding,icon-keep-upright,icon-offset,icon-anchor,icon-pitch-alignment,text-pitch-alignment,text-rotation-alignment,text-field,text-font,text-size,text-max-width,text-line-height,text-letter-spacing,text-justify,text-radial-offset,text-variable-anchor,text-anchor,text-max-angle,text-writing-mode,text-rotate,text-padding,text-keep-upright,text-transform,text-offset,text-allow-overlap,text-ignore-placement,text-optional".split(",")};function g(_){var b;return((b=String(_).match(/\.(geo)?json/))!==null&&b!==void 0?b:_.type==="Feature")||_.type==="FeatureCollection"?{type:"geojson",data:_}:String(_).match(/^vjmaps:\/\//)?{type:"vector",url:_}:_}w.kebabCase=_=>_.replace(/[A-Z]/g,b=>"-"+b.toLowerCase()),w.upperCamelCase=_=>_.replace(/(^|-)([a-z])/g,(b,M,P)=>""+P.toUpperCase());const a=(_,b)=>Array.isArray(_)?_:_ instanceof RegExp?b.getStyle().layers.map(M=>M.id).filter(M=>M.match(_)):_ instanceof Function?b.getStyle().layers.filter(M=>_(M)).map(M=>M.id):[_],l=_=>function(b,...M){return a(b,this.map).map(P=>_.call(this,P,...M))},n=_=>function(b,...M){const P=a(b,this.map).map(C=>_.call(this,C,...M));return()=>P.forEach(C=>C())},u=["line","fill","circle","symbol","video","raster","fill-extrusion","heatmap","hillshade"];class v{constructor(){this._isloaded=!1}static init(b,M){if(b.U=new v,b.U.map=b,M){for(const P in b.U)if(P!=="makeSource"&&P!=="update"&&P!=="addRasterDem"&&!b.U.hasOwnProperty(P)){let C=P;P in b&&(C=P+"Ex"),b[C]=(...L)=>b.U[P](...L)}}return b.U}static async newMap(b={},M={}){if(b.style||(b.style={version:8,layers:[],sources:{}}),M.addLayers||M.addSources||M.transformStyle||M.mixStyles){const C=b.style;let L;typeof C=="string"?L=await(await fetch(C)).json():L=C;const D=new v;(function(F,j=[]){F.layers=[...F.layers,...j.map(K=>this.layerStyle(K))]}).call(D,L,M.addLayers),function(F,j={}){F.sources=Object.assign(Object.assign({},F.sources),j)}(L,M.addSources),function(F,j=K=>K){F=j(F)}(L,M.transformStyle),function(F,j={}){Object.keys(j).forEach(K=>{const ee=j[K].layers;delete j[K].layers,F.sources[K]=j[K],F.layers=[...F.layers,...ee.map(Q=>this.layerStyle(Object.assign({source:K},Q)))]})}.call(D,L,M.mixStyles),b.style=L}const P=new O.Map(b);return v.init(P),P}}w.MapGlUtils=v,Object.assign(v.prototype,{hoverPointer:(()=>function(_){const b=a(_,this.map),M=L=>this.map.getCanvas().style.cursor="pointer",P=L=>{this.map.queryRenderedFeatures(L.point,{layers:b}).length===0&&(this.map.getCanvas().style.cursor=C)},C=this.map.getCanvas().style.cursor;for(const L of b)this.map.on("mouseleave",L,P),this.map.on("mouseenter",L,M);return()=>{for(const L of b)this.map.off("mouseenter",L,M),this.map.off("mouseleave",L,P);this.map.getCanvas().style.cursor=C}}).call(void 0),hoverFeatureState:n(function(_,b,M,P,C){if(Array.isArray(b)){const K=b.map(([ee,Q])=>this.hoverFeatureState(_,ee,Q));return()=>K.forEach(ee=>ee())}if(b===void 0){const K=this.getLayerStyle(_);b=K.source,M=K["source-layer"]}let L;const D=K=>{L&&this.map.setFeatureState({source:b,sourceLayer:M,id:L},{hover:K})},F=K=>{const ee=K.features[0];ee&&ee.id===L||(D(!1),ee&&(L&&C&&C(Object.assign(Object.assign({},K),{oldFeatureId:L})),L=ee.id,D(!0),P&&P(K)))},j=K=>{D(!1),K&&K.oldFeatureId&&(K.oldFeatureId=L),L=void 0,C&&C(K)};return this.map.on("mousemove",_,F),this.map.on("mouseleave",_,j),()=>{this.map.off("mousemove",_,F),this.map.off("mouseleave",_,j),j()}}),hoverPopup(_,b,M={}){const P=new O.Popup(Object.assign({closeButton:!1},M));return n(function(C,L){const D=this.map;function F(K){K.features[0]&&(P.setLngLat(K.lngLat),P.setHTML(L(K.features[0],P)),P.addTo(D))}function j(K){P.remove()}return this.map.on("mouseenter",C,F),this.map.on("mouseout",C,j),()=>{this.map.off("mouseenter",C,F),this.map.off("mouseout",C,j),j()}}).call(this,_,b)},clickPopup(_,b,M={}){const P=new O.Popup(Object.assign({},M));return n(function(C,L){const D=this.map;function F(j){j.features[0]&&(P.setLngLat(j.features[0].geometry.coordinates.slice()),P.setHTML(L(j.features[0],P)),P.addTo(D))}return this.map.on("click",C,F),()=>this.map.off("click",C,F)}).call(this,_,b)},clickLayer:n(function(_,b){const M=P=>{P.features=this.map.queryRenderedFeatures(P.point,{layers:[_]}),b(P)};return this.map.on("click",_,M),()=>this.map.off("click",_,M)}),clickOneLayer(_,b,M){const P=C=>{let L=!1;for(const D of _){const F=this.map.queryRenderedFeatures(C.point,{layers:[D]});if(F[0])try{b({event:C,layer:D,feature:F[0],features:F})}finally{L=!0;break}}!L&&M&&M(C)};return this.map.on("click",P),()=>this.map.off("click",P)},hoverLayer:n(function(_,b){const M=this.map;function P(L){L.features=M.queryRenderedFeatures(L.point,{layers:[_]}),b(L)}function C(L){L.features=void 0,b(L)}return this.map.on("mouseenter",_,P),this.map.on("mouseout",_,C),()=>{this.map.off("mouseenter",_,P),this.map.off("mouseout",_,C),C()}}),mapAddLayerBefore(_,b){b?this.map.addLayer(_,b):this.map.addLayer(_)},addLayerEx(_,b,M,P,C){return this.mapAddLayerBefore(this.layerStyle(_,b,M,P),C),this.makeSource(b)},addLayerBefore(_,b,M,P,C){return this.mapAddLayerBefore(Object.assign({id:_,source:g(b),type:M},this.properties(P)),C),this.makeSource(b)},setLayer(_,b,M,P,C){const L=this.layerStyle(_,b,M,P),D=this.map.getStyle(),F=D.layers.findIndex(K=>K.id===L.id),j=D.layers.findIndex(K=>K.id===C);return F>=0?D.layers.splice(F,1,L):j>=0?D.layers.splice(j,0,L):D.layers.push(L),this.map.setStyle(D),this.makeSource(b)},removeLayerEx:l(function(_){const b=M=>{M.error.message.match(/does not exist/)||console.error(M.error)};this.map.once("error",b),this.map.removeLayer(_),this.map.off("error",b)}),addGeoJSONSource(_,b={type:"FeatureCollection",features:[]},M){return this.addSourceEx(_,Object.assign({type:"geojson",data:b},M))},addSourceEx(_,b){const M=this.map.getStyle();return M.sources[_]=b,this.map.setStyle(M),this.makeSource(_)},layersBySource(_){return this.map.getStyle().layers.filter(b=>b.source===_).map(b=>b.id)},addVectorSource(_,b,M={}){return typeof b=="string"?b.match(/\{z\}/)?this.addSourceEx(_,Object.assign({type:"vector",tiles:[b]},M)):this.addSourceEx(_,Object.assign({type:"vector",url:b},M)):this.addSourceEx(_,Object.assign({type:"vector"},this.properties(b)))},setProperty:l(function(_,b,M){if(typeof b=="object")Object.keys(b).forEach(P=>this.setProperty(_,P,b[P]));else{const P=w.kebabCase(b);(function(C){return I.paints.includes(C)})(P)?this.map.setPaintProperty(_,P,M):function(C){return I.layouts.includes(C)}(P)&&this.map.setLayoutProperty(_,P,M)}}),properties(_){if(!_)return;const b={},M={paint:{},layout:{},other:{}};return Object.keys(_).forEach(P=>{const C=w.kebabCase(P);M[function(L){return I.paints.includes(L)?"paint":I.layouts.includes(L)?"layout":"other"}(C)][C]=_[P]}),Object.keys(M.paint).length&&(b.paint=M.paint),Object.keys(M.layout).length&&(b.layout=M.layout),Object.assign(b,M.other),b},layerStyle(..._){var b;const[M,P,C]=_,L=_.find(F=>typeof F=="object"&&!Array.isArray(F)),D=(b=this.properties(L))!==null&&b!==void 0?b:{};return typeof M=="string"&&(D.id=M),typeof P=="string"&&(D.source=P),typeof C=="string"&&(D.type=C),D},getLayerStyle(_){return this.map.getStyle().layers.find(b=>b.id===_)},setLayerStyle:l(function(_,b){const M=(L={},D={})=>Object.keys(L).forEach(F=>{F in D||this.setProperty(_,F,void 0)});b||(_=(b=_).id);const P=this.getLayerStyle(_),C=this.properties(b);M(P.paint,C.paint),M(P.layout,C.layout),this.setProperty(_,Object.assign(Object.assign({},C.paint),C.layout))}),setData(_,b={type:"FeatureCollection",features:[]}){this.map.getSource(_).setData(b)},show:l(function(_){this.setVisibility(_,"visible")}),hide:l(function(_){this.setVisibility(_,"none")}),toggle:l(function(_,b){this.setVisibility(_,b?"visible":"none")}),showSource:l(function(_){this.setVisibility(this.layersBySource(_),"visible")}),hideSource:l(function(_){this.setVisibility(this.layersBySource(_),"none")}),toggleSource:l(function(_,b){this.setVisibility(this.layersBySource(_),b?"visible":"none")}),setFilterEx:l(function(_,b){this.map.setFilter(_,b)}),removeSourceEx:l(function(_){const b=this.layersBySource(_);this.removeLayerEx(b),this.map.getSource(_)&&this.map.removeSource(_)}),setLayerSource:l(function(_,b,M){const P=this.map.getStyle().layers,C=P.findIndex(F=>F.id===_),L=P[C],D=P[C+1]&&P[C+1].id;L.source=b,M?L["source-layer"]=M:M!==void 0&&delete L["source-layer"],this.map.removeLayer(_),this.mapAddLayerBefore(L,D)}),onLoad(_){if(!_)return new Promise(b=>this.onLoad(b));{let b;arguments.length===2&&(b=arguments[0],_=arguments[1]),this.map.loaded()||this._isloaded?b?_.bind(b)():_():this.map.once("load",()=>{this._isloaded=!0,b?_.bind(b)():_()})}},setRootProperty(_,b){const M=this.map.getStyle();M[w.kebabCase(_)]=b,this.map.setStyle(M)},setTransition(_){this.setRootProperty("transition",_)},loadImageEx(_,b,M){return typeof b=="string"?new Promise((P,C)=>{this.map.loadImage(b,(L,D)=>{L?C("Error loading image "+b,L):(this.map.addImage(_,D,M),P(_,b,D))})}):this.map.addImage(_,b,M)},lockOrientation(){this.map.touchZoomRotate.disableRotation(),this.map.dragRotate.disable()},fontsInUse(){function _(P){Array.isArray(P)&&(P[0]==="literal"?b.push(...P[1]):P.forEach(_))}const b=[],M=this.map.getStyle().layers.map(P=>P.layout&&P.layout["text-font"]).filter(Boolean);for(const P of M)if(P.stops)try{b.push(...P.stops.flat().filter(Array.isArray).flat())}catch{}else P.every(C=>typeof C=="string")?b.push(...P):_(P);return[...new Set(b)]}}),function(_){const b=(C,L)=>{const D="set"+w.upperCamelCase(C);_[D]=l(function(F,j){return this.map[L](F,C,j)})},M=(C,L)=>{const D="get"+w.upperCamelCase(C);_[D]=l(function(F){return this.map[L](F,C)})},P=(C,L,D)=>{let F;F=D?function(j,K,ee){return this.setLayer(j,D,C,K,ee)}:function(j,K,ee,Q){return this.setLayer(j,K,C,ee,Q)},L[`add${w.upperCamelCase(C)}Layer`]=F};_.makeSource=function(C){const L=new v;return L.map=this.map,u.forEach(function(D){P(D,L,C)}),L},_.update=_.setData,I.paints.forEach(C=>b(C,"setPaintProperty")),I.layouts.forEach(C=>b(C,"setLayoutProperty")),I.paints.forEach(C=>M(C,"getPaintProperty")),I.layouts.forEach(C=>M(C,"getLayoutProperty")),u.forEach(C=>P(C,_)),["raster","raster-dem","image","video"].forEach(C=>function(L){let D="add"+w.upperCamelCase(L),F=D+"Source";D==="addImage"&&(D="addImageSource",F="addImageSource"),_[D]=function(j,K){return this.addSourceEx(j,Object.assign({type:L},K))},_[F]=_[D]}(C))}(v.prototype)},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.MessageTipControl=void 0,w.MessageTipControl=class{constructor(O={}){this.style=O.style||{},this.message=`<h1 style='color:#F9EEED;line-height:40px'>${O.message}</h1>`}_insertControl(){this.container=document.createElement("div"),this.container.classList.add("vjmap-ctrl"),this.container.style.border=this.style.border||"1px",this.container.style.marginLeft=this.style.marginLeft||"60px",this.container.style.backgroundColor=this.style.backgroundColor||"#bd362f",this.container.style.boxShadow="0 0 12px #999999",this.panel=document.createElement("div"),this.panel.innerHTML=this.message,this.container.appendChild(this.panel)}updateMessage(O){this.message=`<h1 style='color:#F9EEED;line-height:40px'>${O}</h1>`,this.panel.innerHTML=this.message}onAdd(O){return this.map=O,this._insertControl(),this.container}onRemove(){this.container.parentNode.removeChild(this.container)}getDefaultPosition(){return"top-left"}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.Symbol=void 0;const O=U(0),I=U(6);class g extends I.OverlayLayerBase{constructor(l){super(),this.options=O.extend({},l)}addTo(l,n){var u,v;if(this._map=l,this.sourceId=(u=this.options.sourceId)!==null&&u!==void 0?u:"custom_symbol_"+O.RandomID(),this.options.data){const _=O.createPointGeoJson(this.options.data);l.addGeoJSONSource(this.sourceId,_)}this.layerId=(v=this.options.layerId)!==null&&v!==void 0?v:"custom_symbol_layer_"+O.RandomID(),l.addSymbolLayer(this.layerId,this.sourceId,this.options,n),super.addTo(l,n)}setData(l){l=O.createPointGeoJson(l),this._map.setData(this.sourceId,l)}setSymbolPlacement(l){return this._map.setSymbolPlacement(this.layerId,l),this}getSymbolPlacement(){return this._map.getSymbolPlacement(this.layerId)}setSymbolSpacing(l){return this._map.setSymbolSpacing(this.layerId,l),this}getSymbolSpacing(){return this._map.getSymbolSpacing(this.layerId)}setSymbolAvoidEdges(l){return this._map.setSymbolAvoidEdges(this.layerId,l),this}getSymbolAvoidEdges(){return this._map.getSymbolAvoidEdges(this.layerId)}setSymbolSortKey(l){return this._map.setSymbolSortKey(this.layerId,l),this}getSymbolSortKey(){return this._map.getSymbolSortKey(this.layerId)}setSymbolZOrder(l){return this._map.setSymbolZOrder(this.layerId,l),this}getSymbolZOrder(){return this._map.getSymbolZOrder(this.layerId)}setIconAllowOverlap(l){return this._map.setIconAllowOverlap(this.layerId,l),this}getIconAllowOverlap(){return this._map.getIconAllowOverlap(this.layerId)}setIconIgnorePlacement(l){return this._map.setIconIgnorePlacement(this.layerId,l),this}getIconIgnorePlacement(){return this._map.getIconIgnorePlacement(this.layerId)}setIconOptional(l){return this._map.setIconOptional(this.layerId,l),this}getIconOptional(){return this._map.getIconOptional(this.layerId)}setIconRotationAlignment(l){return this._map.setIconRotationAlignment(this.layerId,l),this}getIconRotationAlignment(){return this._map.getIconRotationAlignment(this.layerId)}setIconSize(l){return this._map.setIconSize(this.layerId,l),this}getIconSize(){return this._map.getIconSize(this.layerId)}setIconTextFit(l){return this._map.setIconTextFit(this.layerId,l),this}getIconTextFit(){return this._map.getIconTextFit(this.layerId)}setIconTextFitPadding(l){return this._map.setIconTextFitPadding(this.layerId,l),this}getIconTextFitPadding(){return this._map.getIconTextFitPadding(this.layerId)}setIconImage(l){return this._map.setIconImage(this.layerId,l),this}getIconImage(){return this._map.getIconImage(this.layerId)}setIconRotate(l){return this._map.setIconRotate(this.layerId,l),this}getIconRotate(){return this._map.getIconRotate(this.layerId)}setIconPadding(l){return this._map.setIconPadding(this.layerId,l),this}getIconPadding(){return this._map.getIconPadding(this.layerId)}setIconKeepUpright(l){return this._map.setIconKeepUpright(this.layerId,l),this}getIconKeepUpright(){return this._map.getIconKeepUpright(this.layerId)}setIconOffset(l){return this._map.setIconOffset(this.layerId,l),this}getIconOffset(){return this._map.getIconOffset(this.layerId)}setIconAnchor(l){return this._map.setIconAnchor(this.layerId,l),this}getIconAnchor(){return this._map.getIconAnchor(this.layerId)}setIconPitchAlignment(l){return this._map.setIconPitchAlignment(this.layerId,l),this}getIconPitchAlignment(){return this._map.getIconPitchAlignment(this.layerId)}setTextPitchAlignment(l){return this._map.setTextPitchAlignment(this.layerId,l),this}getTextPitchAlignment(){return this._map.getTextPitchAlignment(this.layerId)}setTextRotationAlignment(l){return this._map.setTextRotationAlignment(this.layerId,l),this}getTextRotationAlignment(){return this._map.getTextRotationAlignment(this.layerId)}setTextField(l){return this._map.setTextField(this.layerId,l),this}getTextField(){return this._map.getTextField(this.layerId)}setTextFont(l){return this._map.setTextFont(this.layerId,l),this}getTextFont(){return this._map.getTextFont(this.layerId)}setTextSize(l){return this._map.setTextSize(this.layerId,l),this}getTextSize(){return this._map.getTextSize(this.layerId)}setTextMaxWidth(l){return this._map.setTextMaxWidth(this.layerId,l),this}getTextMaxWidth(){return this._map.getTextMaxWidth(this.layerId)}setTextLineHeight(l){return this._map.setTextLineHeight(this.layerId,l),this}getTextLineHeight(){return this._map.getTextLineHeight(this.layerId)}setTextLetterSpacing(l){return this._map.setTextLetterSpacing(this.layerId,l),this}getTextLetterSpacing(){return this._map.getTextLetterSpacing(this.layerId)}setTextJustify(l){return this._map.setTextJustify(this.layerId,l),this}getTextJustify(){return this._map.getTextJustify(this.layerId)}setTextRadialOffset(l){return this._map.setTextRadialOffset(this.layerId,l),this}getTextRadialOffset(){return this._map.getTextRadialOffset(this.layerId)}setTextVariableAnchor(l){return this._map.setTextVariableAnchor(this.layerId,l),this}getTextVariableAnchor(){return this._map.getTextVariableAnchor(this.layerId)}setTextAnchor(l){return this._map.setTextAnchor(this.layerId,l),this}getTextAnchor(){return this._map.getTextAnchor(this.layerId)}setTextMaxAngle(l){return this._map.setTextMaxAngle(this.layerId,l),this}getTextMaxAngle(){return this._map.getTextMaxAngle(this.layerId)}setTextWritingMode(l){return this._map.setTextWritingMode(this.layerId,l),this}getTextWritingMode(){return this._map.getTextWritingMode(this.layerId)}setTextRotate(l){return this._map.setTextRotate(this.layerId,l),this}getTextRotate(){return this._map.getTextRotate(this.layerId)}setTextPadding(l){return this._map.setTextPadding(this.layerId,l),this}getTextPadding(){return this._map.getTextPadding(this.layerId)}setTextKeepUpright(l){return this._map.setTextKeepUpright(this.layerId,l),this}getTextKeepUpright(){return this._map.getTextKeepUpright(this.layerId)}setTextTransform(l){return this._map.setTextTransform(this.layerId,l),this}getTextTransform(){return this._map.getTextTransform(this.layerId)}setTextOffset(l){return this._map.setTextOffset(this.layerId,l),this}getTextOffset(){return this._map.getTextOffset(this.layerId)}setTextAllowOverlap(l){return this._map.setTextAllowOverlap(this.layerId,l),this}getTextAllowOverlap(){return this._map.getTextAllowOverlap(this.layerId)}setTextIgnorePlacement(l){return this._map.setTextIgnorePlacement(this.layerId,l),this}getTextIgnorePlacement(){return this._map.getTextIgnorePlacement(this.layerId)}setTextOptional(l){return this._map.setTextOptional(this.layerId,l),this}getTextOptional(){return this._map.getTextOptional(this.layerId)}setIconOpacity(l){return this._map.setIconOpacity(this.layerId,l),this}getIconOpacity(){return this._map.getIconOpacity(this.layerId)}setIconColor(l){return this._map.setIconColor(this.layerId,l),this}getIconColor(){return this._map.getIconColor(this.layerId)}setIconHaloColor(l){return this._map.setIconHaloColor(this.layerId,l),this}getIconHaloColor(){return this._map.getIconHaloColor(this.layerId)}setIconHaloWidth(l){return this._map.setIconHaloWidth(this.layerId,l),this}getIconHaloWidth(){return this._map.getIconHaloWidth(this.layerId)}setIconHaloBlur(l){return this._map.setIconHaloBlur(this.layerId,l),this}getIconHaloBlur(){return this._map.getIconHaloBlur(this.layerId)}setIconTranslate(l){return this._map.setIconTranslate(this.layerId,l),this}getIconTranslate(){return this._map.getIconTranslate(this.layerId)}setIconTranslateAnchor(l){return this._map.setIconTranslateAnchor(this.layerId,l),this}getIconTranslateAnchor(){return this._map.getIconTranslateAnchor(this.layerId)}setTextOpacity(l){return this._map.setTextOpacity(this.layerId,l),this}getTextOpacity(){return this._map.getTextOpacity(this.layerId)}setTextColor(l){return this._map.setTextColor(this.layerId,l),this}getTextColor(){return this._map.getTextColor(this.layerId)}setTextHaloColor(l){return this._map.setTextHaloColor(this.layerId,l),this}getTextHaloColor(){return this._map.getTextHaloColor(this.layerId)}setTextHaloWidth(l){return this._map.setTextHaloWidth(this.layerId,l),this}getTextHaloWidth(){return this._map.getTextHaloWidth(this.layerId)}setTextHaloBlur(l){return this._map.setTextHaloBlur(this.layerId,l),this}getTextHaloBlur(){return this._map.getTextHaloBlur(this.layerId)}setTextTranslate(l){return this._map.setTextTranslate(this.layerId,l),this}getTextTranslate(){return this._map.getTextTranslate(this.layerId)}setTextTranslateAnchor(l){return this._map.setTextTranslateAnchor(this.layerId,l),this}getTextTranslateAnchor(){return this._map.getTextTranslateAnchor(this.layerId)}}w.Symbol=g},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.extend=w.bindAll=w.pick=w.cloneDeep=void 0,w.cloneDeep=function(O){const I=new Map,g=function a(l){if(l===null)return null;if(typeof l=="object"){const n=I.get(l);if(n!==void 0)return n;if(Array.isArray(l)){const u=[];I.set(l,u),u.length=l.length;for(let v=0;v<u.length;++v)u[v]=a(l[v]);return u}if(l instanceof Date){const u=new Date(l.getTime());return I.set(l,u),u}if(l instanceof RegExp){const u=new RegExp(l.source,l.flags);return I.set(l,u),u}if(l.constructor!==Object)throw new Error("cloneDeep doesn't support objects with custom prototypes");{const u={};I.set(l,u);for(const v in l)l.hasOwnProperty(v)&&(u[v]=a(l[v]));return u}}return l}(O);return I.clear(),g},w.pick=function(O,I){const g={};for(const a of I)O.hasOwnProperty(a)&&(g[a]=O[a]);return g},w.bindAll=function(O,I){O.forEach(g=>{I[g]&&(I[g]=I[g].bind(I))})},w.extend=function(O,...I){for(const g of I)for(const a in g)O[a]=g[a];return O}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.randInt=w.isClosedPolygon=w.calculateSignedArea=w.isCounterClockwise=w.radToDeg=w.degToRad=void 0;const O=Math.PI/180,I=180/Math.PI;function g(a){let l=0;for(let n,u,v=0,_=a.length,b=_-1;v<_;b=v++)n=a[v],u=a[b],l+=(u.x-n.x)*(n.y+u.y);return l}w.degToRad=function(a){return a*O},w.radToDeg=function(a){return a*I},w.isCounterClockwise=function(a,l,n){return(n.y-a.y)*(l.x-a.x)>(l.y-a.y)*(n.x-a.x)},w.calculateSignedArea=g,w.isClosedPolygon=function(a){if(a.length<4)return!1;const l=a[0],n=a[a.length-1];return!(Math.abs(l.x-n.x)>0||Math.abs(l.y-n.y)>0)&&Math.abs(g(a))>.01},w.randInt=function(a,l){return Math.floor(Math.random()*(l-a+1)+a)}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.crsMap=w.BD09MC=w.EPSG3857=w.BD09=w.GCJ02=w.WGS84=w.CRSTypes=void 0;const O=U(38),I=U(69),g=U(70),a=U(71),l=U(72);var n;(function(u){u.WGS84="WGS84",u.WGS1984="WGS84",u.EPSG4326="WGS84",u.GCJ02="GCJ02",u.AMap="GCJ02",u.BD09="BD09",u.BD09LL="BD09",u.Baidu="BD09",u.BMap="BD09",u.BD09MC="BD09MC",u.BD09Meter="BD09MC",u.EPSG3857="EPSG3857",u.EPSG900913="EPSG3857",u.EPSG102100="EPSG3857",u.WebMercator="EPSG3857",u.WM="EPSG3857"})(n=w.CRSTypes||(w.CRSTypes={})),w.WGS84={to:{[n.GCJ02]:l.WGS84ToGCJ02,[n.BD09]:O.compose(I.GCJ02ToBD09,l.WGS84ToGCJ02),[n.BD09MC]:O.compose(g.BD09toBD09MC,I.GCJ02ToBD09,l.WGS84ToGCJ02),[n.EPSG3857]:a.WGS84ToEPSG3857}},w.GCJ02={to:{[n.WGS84]:l.GCJ02ToWGS84,[n.BD09]:I.GCJ02ToBD09,[n.BD09MC]:O.compose(g.BD09toBD09MC,I.GCJ02ToBD09),[n.EPSG3857]:O.compose(a.WGS84ToEPSG3857,l.GCJ02ToWGS84)}},w.BD09={to:{[n.WGS84]:O.compose(l.GCJ02ToWGS84,I.BD09ToGCJ02),[n.GCJ02]:I.BD09ToGCJ02,[n.EPSG3857]:O.compose(a.WGS84ToEPSG3857,l.GCJ02ToWGS84,I.BD09ToGCJ02),[n.BD09MC]:g.BD09toBD09MC}},w.EPSG3857={to:{[n.WGS84]:a.ESPG3857ToWGS84,[n.GCJ02]:O.compose(l.WGS84ToGCJ02,a.ESPG3857ToWGS84),[n.BD09]:O.compose(I.GCJ02ToBD09,l.WGS84ToGCJ02,a.ESPG3857ToWGS84),[n.BD09MC]:O.compose(g.BD09toBD09MC,I.GCJ02ToBD09,l.WGS84ToGCJ02,a.ESPG3857ToWGS84)}},w.BD09MC={to:{[n.WGS84]:O.compose(l.GCJ02ToWGS84,I.BD09ToGCJ02,g.BD09MCtoBD09),[n.GCJ02]:O.compose(I.BD09ToGCJ02,g.BD09MCtoBD09),[n.EPSG3857]:O.compose(a.WGS84ToEPSG3857,l.GCJ02ToWGS84,I.BD09ToGCJ02,g.BD09MCtoBD09),[n.BD09]:g.BD09MCtoBD09}},w.crsMap={WGS84:w.WGS84,GCJ02:w.GCJ02,BD09:w.BD09,EPSG3857:w.EPSG3857,BD09MC:w.BD09MC},w.default=w.crsMap},function(he,w,U){function O(I){return!!I&&Object.prototype.toString.call(I)==="[object Array]"}Object.defineProperty(w,"__esModule",{value:!0}),w.coordEach=w.compose=w.isString=w.isNumber=w.isArray=w.isObject=w.assert=void 0,w.assert=function(I,g){if(!I)throw new Error(g)},w.isObject=function(I){return!!I&&I.constructor===Object},w.isArray=O,w.isNumber=function(I){return!isNaN(Number(I))&&I!==null&&!O(I)},w.isString=function(I){return typeof I=="string"},w.compose=function(...I){const g=I.length-1;return function(...a){let l=g,n=I[g].apply(null,a);for(;l--;)n=I[l].call(null,n);return n}},w.coordEach=function I(g,a,l=!1){if(g===null)return;let n,u,v,_,b,M,P,C,L=0,D=0;const{type:F}=g,j=F==="FeatureCollection",K=F==="Feature",ee=j?g.features.length:1;for(let Q=0;Q<ee;Q++){P=j?g.features[Q].geometry:K?g.geometry:g,C=!!P&&P.type==="GeometryCollection",b=C?P.geometries.length:1;for(let le=0;le<b;le++){let pe=0,de=0;if(_=C?P.geometries[le]:P,_===null)continue;const Ee=_.type;switch(L=!l||Ee!=="Polygon"&&Ee!=="MultiPolygon"?0:1,Ee){case null:break;case"Point":case"GeometryPoint":if(M=_.coordinates,a(M,D,Q,pe,de)===!1)return!1;D++,pe++;break;case"LineString":case"MultiPoint":for(M=_.coordinates,n=0;n<M.length;n++){if(a(M[n],D,Q,pe,de)===!1)return!1;D++,Ee==="MultiPoint"&&pe++}Ee==="LineString"&&pe++;break;case"Polygon":case"MultiLineString":for(M=_.coordinates,n=0;n<M.length;n++){for(u=0;u<M[n].length-L;u++){if(a(M[n][u],D,Q,pe,de)===!1)return!1;D++}Ee==="MultiLineString"&&pe++,Ee==="Polygon"&&de++}Ee==="Polygon"&&pe++;break;case"MultiPolygon":for(M=_.coordinates,n=0;n<M.length;n++){for(de=0,u=0;u<M[n].length;u++){for(v=0;v<M[n][u].length-L;v++){if(a(M[n][u][v],D,Q,pe,de)===!1)return!1;D++}de++}pe++}break;case"GeometryCollection":for(n=0;n<_.geometries.length;n++)if(I(_.geometries[n],a,l)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.mat3=void 0;const O=U(7);(function(I){I.create=function(){const g=new Float32Array(9);return g[0]=1,g[1]=0,g[2]=0,g[3]=0,g[4]=1,g[5]=0,g[6]=0,g[7]=0,g[8]=1,g},I.fromMat4=function(g,a){return g[0]=a[0],g[1]=a[1],g[2]=a[2],g[3]=a[4],g[4]=a[5],g[5]=a[6],g[6]=a[8],g[7]=a[9],g[8]=a[10],g},I.clone=function(g){const a=new Float32Array(9);return a[0]=g[0],a[1]=g[1],a[2]=g[2],a[3]=g[3],a[4]=g[4],a[5]=g[5],a[6]=g[6],a[7]=g[7],a[8]=g[8],a},I.copy=function(g,a){return g[0]=a[0],g[1]=a[1],g[2]=a[2],g[3]=a[3],g[4]=a[4],g[5]=a[5],g[6]=a[6],g[7]=a[7],g[8]=a[8],g},I.fromValues=function(g,a,l,n,u,v,_,b,M){const P=new Float32Array(9);return P[0]=g,P[1]=a,P[2]=l,P[3]=n,P[4]=u,P[5]=v,P[6]=_,P[7]=b,P[8]=M,P},I.set=function(g,a,l,n,u,v,_,b,M,P){return g[0]=a,g[1]=l,g[2]=n,g[3]=u,g[4]=v,g[5]=_,g[6]=b,g[7]=M,g[8]=P,g},I.identity=function(g){return g[0]=1,g[1]=0,g[2]=0,g[3]=0,g[4]=1,g[5]=0,g[6]=0,g[7]=0,g[8]=1,g},I.transpose=function(g,a){if(g===a){const l=a[1],n=a[2],u=a[5];g[1]=a[3],g[2]=a[6],g[3]=l,g[5]=a[7],g[6]=n,g[7]=u}else g[0]=a[0],g[1]=a[3],g[2]=a[6],g[3]=a[1],g[4]=a[4],g[5]=a[7],g[6]=a[2],g[7]=a[5],g[8]=a[8];return g},I.invert=function(g,a){const l=a[0],n=a[1],u=a[2],v=a[3],_=a[4],b=a[5],M=a[6],P=a[7],C=a[8],L=C*_-b*P,D=-C*v+b*M,F=P*v-_*M;let j=l*L+n*D+u*F;return j?(j=1/j,g[0]=L*j,g[1]=(-C*n+u*P)*j,g[2]=(b*n-u*_)*j,g[3]=D*j,g[4]=(C*l-u*M)*j,g[5]=(-b*l+u*v)*j,g[6]=F*j,g[7]=(-P*l+n*M)*j,g[8]=(_*l-n*v)*j,g):null},I.adjoint=function(g,a){const l=a[0],n=a[1],u=a[2],v=a[3],_=a[4],b=a[5],M=a[6],P=a[7],C=a[8];return g[0]=_*C-b*P,g[1]=u*P-n*C,g[2]=n*b-u*_,g[3]=b*M-v*C,g[4]=l*C-u*M,g[5]=u*v-l*b,g[6]=v*P-_*M,g[7]=n*M-l*P,g[8]=l*_-n*v,g},I.determinant=function(g){const a=g[0],l=g[1],n=g[2],u=g[3],v=g[4],_=g[5],b=g[6],M=g[7],P=g[8];return a*(P*v-_*M)+l*(-P*u+_*b)+n*(M*u-v*b)},I.multiply=function(g,a,l){const n=a[0],u=a[1],v=a[2],_=a[3],b=a[4],M=a[5],P=a[6],C=a[7],L=a[8],D=l[0],F=l[1],j=l[2],K=l[3],ee=l[4],Q=l[5],le=l[6],pe=l[7],de=l[8];return g[0]=D*n+F*_+j*P,g[1]=D*u+F*b+j*C,g[2]=D*v+F*M+j*L,g[3]=K*n+ee*_+Q*P,g[4]=K*u+ee*b+Q*C,g[5]=K*v+ee*M+Q*L,g[6]=le*n+pe*_+de*P,g[7]=le*u+pe*b+de*C,g[8]=le*v+pe*M+de*L,g},I.translate=function(g,a,l){const n=a[0],u=a[1],v=a[2],_=a[3],b=a[4],M=a[5],P=a[6],C=a[7],L=a[8],D=l[0],F=l[1];return g[0]=n,g[1]=u,g[2]=v,g[3]=_,g[4]=b,g[5]=M,g[6]=D*n+F*_+P,g[7]=D*u+F*b+C,g[8]=D*v+F*M+L,g},I.rotate=function(g,a,l){const n=a[0],u=a[1],v=a[2],_=a[3],b=a[4],M=a[5],P=a[6],C=a[7],L=a[8],D=Math.sin(l),F=Math.cos(l);return g[0]=F*n+D*_,g[1]=F*u+D*b,g[2]=F*v+D*M,g[3]=F*_-D*n,g[4]=F*b-D*u,g[5]=F*M-D*v,g[6]=P,g[7]=C,g[8]=L,g},I.scale=function(g,a,l){const n=l[0],u=l[1];return g[0]=n*a[0],g[1]=n*a[1],g[2]=n*a[2],g[3]=u*a[3],g[4]=u*a[4],g[5]=u*a[5],g[6]=a[6],g[7]=a[7],g[8]=a[8],g},I.fromTranslation=function(g,a){return g[0]=1,g[1]=0,g[2]=0,g[3]=0,g[4]=1,g[5]=0,g[6]=a[0],g[7]=a[1],g[8]=1,g},I.fromRotation=function(g,a){const l=Math.sin(a),n=Math.cos(a);return g[0]=n,g[1]=l,g[2]=0,g[3]=-l,g[4]=n,g[5]=0,g[6]=0,g[7]=0,g[8]=1,g},I.fromScaling=function(g,a){return g[0]=a[0],g[1]=0,g[2]=0,g[3]=0,g[4]=a[1],g[5]=0,g[6]=0,g[7]=0,g[8]=1,g},I.fromMat2d=function(g,a){return g[0]=a[0],g[1]=a[1],g[2]=0,g[3]=a[2],g[4]=a[3],g[5]=0,g[6]=a[4],g[7]=a[5],g[8]=1,g},I.fromQuat=function(g,a){const l=a[0],n=a[1],u=a[2],v=a[3],_=l+l,b=n+n,M=u+u,P=l*_,C=n*_,L=n*b,D=u*_,F=u*b,j=u*M,K=v*_,ee=v*b,Q=v*M;return g[0]=1-L-j,g[3]=C-Q,g[6]=D+ee,g[1]=C+Q,g[4]=1-P-j,g[7]=F-K,g[2]=D-ee,g[5]=F+K,g[8]=1-P-L,g},I.normalFromMat4=function(g,a){const l=a[0],n=a[1],u=a[2],v=a[3],_=a[4],b=a[5],M=a[6],P=a[7],C=a[8],L=a[9],D=a[10],F=a[11],j=a[12],K=a[13],ee=a[14],Q=a[15],le=l*b-n*_,pe=l*M-u*_,de=l*P-v*_,Ee=n*M-u*b,Pe=n*P-v*b,Je=u*P-v*M,xt=C*K-L*j,vt=C*ee-D*j,ct=C*Q-F*j,Rt=L*ee-D*K,Pt=L*Q-F*K,nn=D*Q-F*ee;let mn=le*nn-pe*Pt+de*Rt+Ee*ct-Pe*vt+Je*xt;return mn?(mn=1/mn,g[0]=(b*nn-M*Pt+P*Rt)*mn,g[1]=(M*ct-_*nn-P*vt)*mn,g[2]=(_*Pt-b*ct+P*xt)*mn,g[3]=(u*Pt-n*nn-v*Rt)*mn,g[4]=(l*nn-u*ct+v*vt)*mn,g[5]=(n*ct-l*Pt-v*xt)*mn,g[6]=(K*Je-ee*Pe+Q*Ee)*mn,g[7]=(ee*de-j*Je-Q*pe)*mn,g[8]=(j*Pe-K*de+Q*le)*mn,g):null},I.str=function(g){return"mat3("+g[0]+", "+g[1]+", "+g[2]+", "+g[3]+", "+g[4]+", "+g[5]+", "+g[6]+", "+g[7]+", "+g[8]+")"},I.frob=function(g){return Math.sqrt(Math.pow(g[0],2)+Math.pow(g[1],2)+Math.pow(g[2],2)+Math.pow(g[3],2)+Math.pow(g[4],2)+Math.pow(g[5],2)+Math.pow(g[6],2)+Math.pow(g[7],2)+Math.pow(g[8],2))},I.add=function(g,a,l){return g[0]=a[0]+l[0],g[1]=a[1]+l[1],g[2]=a[2]+l[2],g[3]=a[3]+l[3],g[4]=a[4]+l[4],g[5]=a[5]+l[5],g[6]=a[6]+l[6],g[7]=a[7]+l[7],g[8]=a[8]+l[8],g},I.subtract=function(g,a,l){return g[0]=a[0]-l[0],g[1]=a[1]-l[1],g[2]=a[2]-l[2],g[3]=a[3]-l[3],g[4]=a[4]-l[4],g[5]=a[5]-l[5],g[6]=a[6]-l[6],g[7]=a[7]-l[7],g[8]=a[8]-l[8],g},I.multiplyScalar=function(g,a,l){return g[0]=a[0]*l,g[1]=a[1]*l,g[2]=a[2]*l,g[3]=a[3]*l,g[4]=a[4]*l,g[5]=a[5]*l,g[6]=a[6]*l,g[7]=a[7]*l,g[8]=a[8]*l,g},I.multiplyScalarAndAdd=function(g,a,l,n){return g[0]=a[0]+l[0]*n,g[1]=a[1]+l[1]*n,g[2]=a[2]+l[2]*n,g[3]=a[3]+l[3]*n,g[4]=a[4]+l[4]*n,g[5]=a[5]+l[5]*n,g[6]=a[6]+l[6]*n,g[7]=a[7]+l[7]*n,g[8]=a[8]+l[8]*n,g},I.exactEquals=function(g,a){return g[0]===a[0]&&g[1]===a[1]&&g[2]===a[2]&&g[3]===a[3]&&g[4]===a[4]&&g[5]===a[5]&&g[6]===a[6]&&g[7]===a[7]&&g[8]===a[8]},I.equals=function(g,a){const l=g[0],n=g[1],u=g[2],v=g[3],_=g[4],b=g[5],M=g[6],P=g[7],C=g[8],L=a[0],D=a[1],F=a[2],j=a[3],K=a[4],ee=a[5],Q=a[6],le=a[7],pe=a[8];return Math.abs(l-L)<=O.EPSILON*Math.max(1,Math.abs(l),Math.abs(L))&&Math.abs(n-D)<=O.EPSILON*Math.max(1,Math.abs(n),Math.abs(D))&&Math.abs(u-F)<=O.EPSILON*Math.max(1,Math.abs(u),Math.abs(F))&&Math.abs(v-j)<=O.EPSILON*Math.max(1,Math.abs(v),Math.abs(j))&&Math.abs(_-K)<=O.EPSILON*Math.max(1,Math.abs(_),Math.abs(K))&&Math.abs(b-ee)<=O.EPSILON*Math.max(1,Math.abs(b),Math.abs(ee))&&Math.abs(M-Q)<=O.EPSILON*Math.max(1,Math.abs(M),Math.abs(Q))&&Math.abs(P-le)<=O.EPSILON*Math.max(1,Math.abs(P),Math.abs(le))&&Math.abs(C-pe)<=O.EPSILON*Math.max(1,Math.abs(C),Math.abs(pe))}})(w.mat3||(w.mat3={}))},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.vec3=void 0;const O=U(7);(function(I){function g(){const u=new Float32Array(3);return u[0]=0,u[1]=0,u[2]=0,u}function a(u,v,_){const b=new Float32Array(3);return b[0]=u,b[1]=v,b[2]=_,b}function l(u,v){const _=v[0],b=v[1],M=v[2];let P=_*_+b*b+M*M;return P>0&&(P=1/Math.sqrt(P),u[0]=v[0]*P,u[1]=v[1]*P,u[2]=v[2]*P),u}function n(u,v){return u[0]*v[0]+u[1]*v[1]+u[2]*v[2]}I.create=g,I.clone=function(u){const v=new Float32Array(3);return v[0]=u[0],v[1]=u[1],v[2]=u[2],v},I.fromValues=a,I.copy=function(u,v){return u[0]=v[0],u[1]=v[1],u[2]=v[2],u},I.set=function(u,v,_,b){return u[0]=v,u[1]=_,u[2]=b,u},I.add=function(u,v,_){return u[0]=v[0]+_[0],u[1]=v[1]+_[1],u[2]=v[2]+_[2],u},I.subtract=function(u,v,_){return u[0]=v[0]-_[0],u[1]=v[1]-_[1],u[2]=v[2]-_[2],u},I.multiply=function(u,v,_){return u[0]=v[0]*_[0],u[1]=v[1]*_[1],u[2]=v[2]*_[2],u},I.divide=function(u,v,_){return u[0]=v[0]/_[0],u[1]=v[1]/_[1],u[2]=v[2]/_[2],u},I.ceil=function(u,v){return u[0]=Math.ceil(v[0]),u[1]=Math.ceil(v[1]),u[2]=Math.ceil(v[2]),u},I.floor=function(u,v){return u[0]=Math.floor(v[0]),u[1]=Math.floor(v[1]),u[2]=Math.floor(v[2]),u},I.min=function(u,v,_){return u[0]=Math.min(v[0],_[0]),u[1]=Math.min(v[1],_[1]),u[2]=Math.min(v[2],_[2]),u},I.max=function(u,v,_){return u[0]=Math.max(v[0],_[0]),u[1]=Math.max(v[1],_[1]),u[2]=Math.max(v[2],_[2]),u},I.round=function(u,v){return u[0]=Math.round(v[0]),u[1]=Math.round(v[1]),u[2]=Math.round(v[2]),u},I.scale=function(u,v,_){return u[0]=v[0]*_,u[1]=v[1]*_,u[2]=v[2]*_,u},I.scaleAndAdd=function(u,v,_,b){return u[0]=v[0]+_[0]*b,u[1]=v[1]+_[1]*b,u[2]=v[2]+_[2]*b,u},I.distance=function(u,v){const _=v[0]-u[0],b=v[1]-u[1],M=v[2]-u[2];return Math.sqrt(_*_+b*b+M*M)},I.squaredDistance=function(u,v){const _=v[0]-u[0],b=v[1]-u[1],M=v[2]-u[2];return _*_+b*b+M*M},I.length=function(u){const v=u[0],_=u[1],b=u[2];return Math.sqrt(v*v+_*_+b*b)},I.squaredLength=function(u){const v=u[0],_=u[1],b=u[2];return v*v+_*_+b*b},I.negate=function(u,v){return u[0]=-v[0],u[1]=-v[1],u[2]=-v[2],u},I.inverse=function(u,v){return u[0]=1/v[0],u[1]=1/v[1],u[2]=1/v[2],u},I.normalize=l,I.dot=n,I.cross=function(u,v,_){const b=v[0],M=v[1],P=v[2],C=_[0],L=_[1],D=_[2];return u[0]=M*D-P*L,u[1]=P*C-b*D,u[2]=b*L-M*C,u},I.lerp=function(u,v,_,b){const M=v[0],P=v[1],C=v[2];return u[0]=M+b*(_[0]-M),u[1]=P+b*(_[1]-P),u[2]=C+b*(_[2]-C),u},I.hermite=function(u,v,_,b,M,P){const C=P*P,L=C*(2*P-3)+1,D=C*(P-2)+P,F=C*(P-1),j=C*(3-2*P);return u[0]=v[0]*L+_[0]*D+b[0]*F+M[0]*j,u[1]=v[1]*L+_[1]*D+b[1]*F+M[1]*j,u[2]=v[2]*L+_[2]*D+b[2]*F+M[2]*j,u},I.bezier=function(u,v,_,b,M,P){const C=1-P,L=C*C,D=P*P,F=L*C,j=3*P*L,K=3*D*C,ee=D*P;return u[0]=v[0]*F+_[0]*j+b[0]*K+M[0]*ee,u[1]=v[1]*F+_[1]*j+b[1]*K+M[1]*ee,u[2]=v[2]*F+_[2]*j+b[2]*K+M[2]*ee,u},I.random=function(u,v=1){const _=2*Math.random()*Math.PI,b=2*Math.random()-1,M=Math.sqrt(1-b*b)*v;return u[0]=Math.cos(_)*M,u[1]=Math.sin(_)*M,u[2]=b*v,u},I.transformMat4=function(u,v,_){const b=v[0],M=v[1],P=v[2];let C=_[3]*b+_[7]*M+_[11]*P+_[15];return C=C||1,u[0]=(_[0]*b+_[4]*M+_[8]*P+_[12])/C,u[1]=(_[1]*b+_[5]*M+_[9]*P+_[13])/C,u[2]=(_[2]*b+_[6]*M+_[10]*P+_[14])/C,u},I.transformMat3=function(u,v,_){const b=v[0],M=v[1],P=v[2];return u[0]=b*_[0]+M*_[3]+P*_[6],u[1]=b*_[1]+M*_[4]+P*_[7],u[2]=b*_[2]+M*_[5]+P*_[8],u},I.transformQuat=function(u,v,_){const b=v[0],M=v[1],P=v[2],C=_[0],L=_[1],D=_[2],F=_[3],j=F*b+L*P-D*M,K=F*M+D*b-C*P,ee=F*P+C*M-L*b,Q=-C*b-L*M-D*P;return u[0]=j*F+Q*-C+K*-D-ee*-L,u[1]=K*F+Q*-L+ee*-C-j*-D,u[2]=ee*F+Q*-D+j*-L-K*-C,u},I.rotateX=function(u,v,_,b){const M=[],P=[];return M[0]=v[0]-_[0],M[1]=v[1]-_[1],M[2]=v[2]-_[2],P[0]=M[0],P[1]=M[1]*Math.cos(b)-M[2]*Math.sin(b),P[2]=M[1]*Math.sin(b)+M[2]*Math.cos(b),u[0]=P[0]+_[0],u[1]=P[1]+_[1],u[2]=P[2]+_[2],u},I.rotateY=function(u,v,_,b){const M=[],P=[];return M[0]=v[0]-_[0],M[1]=v[1]-_[1],M[2]=v[2]-_[2],P[0]=M[2]*Math.sin(b)+M[0]*Math.cos(b),P[1]=M[1],P[2]=M[2]*Math.cos(b)-M[0]*Math.sin(b),u[0]=P[0]+_[0],u[1]=P[1]+_[1],u[2]=P[2]+_[2],u},I.rotateZ=function(u,v,_,b){const M=[],P=[];return M[0]=v[0]-_[0],M[1]=v[1]-_[1],M[2]=v[2]-_[2],P[0]=M[0]*Math.cos(b)-M[1]*Math.sin(b),P[1]=M[0]*Math.sin(b)+M[1]*Math.cos(b),P[2]=M[2],u[0]=P[0]+_[0],u[1]=P[1]+_[1],u[2]=P[2]+_[2],u},I.forEach=function(u,v,_,b,M,P){const C=g();let L,D;for(v||(v=3),_||(_=0),D=b?Math.min(b*v+_,u.length):u.length,L=_;L<D;L+=v)C[0]=u[L],C[1]=u[L+1],C[2]=u[L+2],M(C,C,P),u[L]=C[0],u[L+1]=C[1],u[L+2]=C[2];return u},I.angle=function(u,v){const _=a(u[0],u[1],u[2]),b=a(v[0],v[1],v[2]);l(_,_),l(b,b);const M=n(_,b);return M>1?0:M<-1?Math.PI:Math.acos(M)},I.str=function(u){return"vec3("+u[0]+", "+u[1]+", "+u[2]+")"},I.exactEquals=function(u,v){return u[0]===v[0]&&u[1]===v[1]&&u[2]===v[2]},I.equals=function(u,v){const _=u[0],b=u[1],M=u[2],P=v[0],C=v[1],L=v[2];return Math.abs(_-P)<=O.EPSILON*Math.max(1,Math.abs(_),Math.abs(P))&&Math.abs(b-C)<=O.EPSILON*Math.max(1,Math.abs(b),Math.abs(C))&&Math.abs(M-L)<=O.EPSILON*Math.max(1,Math.abs(M),Math.abs(L))}})(w.vec3||(w.vec3={}))},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.vec4=void 0;const O=U(7);(function(I){function g(){const n=new Float32Array(4);return n[0]=0,n[1]=0,n[2]=0,n[3]=0,n}function a(n,u,v){return n[0]=u[0]*v,n[1]=u[1]*v,n[2]=u[2]*v,n[3]=u[3]*v,n}function l(n,u){const v=u[0],_=u[1],b=u[2],M=u[3];let P=v*v+_*_+b*b+M*M;return P>0&&(P=1/Math.sqrt(P),n[0]=v*P,n[1]=_*P,n[2]=b*P,n[3]=M*P),n}I.create=g,I.clone=function(n){const u=new Float32Array(4);return u[0]=n[0],u[1]=n[1],u[2]=n[2],u[3]=n[3],u},I.fromValues=function(n,u,v,_){const b=new Float32Array(4);return b[0]=n,b[1]=u,b[2]=v,b[3]=_,b},I.copy=function(n,u){return n[0]=u[0],n[1]=u[1],n[2]=u[2],n[3]=u[3],n},I.set=function(n,u,v,_,b){return n[0]=u,n[1]=v,n[2]=_,n[3]=b,n},I.add=function(n,u,v){return n[0]=u[0]+v[0],n[1]=u[1]+v[1],n[2]=u[2]+v[2],n[3]=u[3]+v[3],n},I.subtract=function(n,u,v){return n[0]=u[0]-v[0],n[1]=u[1]-v[1],n[2]=u[2]-v[2],n[3]=u[3]-v[3],n},I.multiply=function(n,u,v){return n[0]=u[0]*v[0],n[1]=u[1]*v[1],n[2]=u[2]*v[2],n[3]=u[3]*v[3],n},I.divide=function(n,u,v){return n[0]=u[0]/v[0],n[1]=u[1]/v[1],n[2]=u[2]/v[2],n[3]=u[3]/v[3],n},I.ceil=function(n,u){return n[0]=Math.ceil(u[0]),n[1]=Math.ceil(u[1]),n[2]=Math.ceil(u[2]),n[3]=Math.ceil(u[3]),n},I.floor=function(n,u){return n[0]=Math.floor(u[0]),n[1]=Math.floor(u[1]),n[2]=Math.floor(u[2]),n[3]=Math.floor(u[3]),n},I.min=function(n,u,v){return n[0]=Math.min(u[0],v[0]),n[1]=Math.min(u[1],v[1]),n[2]=Math.min(u[2],v[2]),n[3]=Math.min(u[3],v[3]),n},I.max=function(n,u,v){return n[0]=Math.max(u[0],v[0]),n[1]=Math.max(u[1],v[1]),n[2]=Math.max(u[2],v[2]),n[3]=Math.max(u[3],v[3]),n},I.round=function(n,u){return n[0]=Math.round(u[0]),n[1]=Math.round(u[1]),n[2]=Math.round(u[2]),n[3]=Math.round(u[3]),n},I.scale=a,I.scaleAndAdd=function(n,u,v,_){return n[0]=u[0]+v[0]*_,n[1]=u[1]+v[1]*_,n[2]=u[2]+v[2]*_,n[3]=u[3]+v[3]*_,n},I.distance=function(n,u){const v=u[0]-n[0],_=u[1]-n[1],b=u[2]-n[2],M=u[3]-n[3];return Math.sqrt(v*v+_*_+b*b+M*M)},I.squaredDistance=function(n,u){const v=u[0]-n[0],_=u[1]-n[1],b=u[2]-n[2],M=u[3]-n[3];return v*v+_*_+b*b+M*M},I.length=function(n){const u=n[0],v=n[1],_=n[2],b=n[3];return Math.sqrt(u*u+v*v+_*_+b*b)},I.squaredLength=function(n){const u=n[0],v=n[1],_=n[2],b=n[3];return u*u+v*v+_*_+b*b},I.negate=function(n,u){return n[0]=-u[0],n[1]=-u[1],n[2]=-u[2],n[3]=-u[3],n},I.inverse=function(n,u){return n[0]=1/u[0],n[1]=1/u[1],n[2]=1/u[2],n[3]=1/u[3],n},I.normalize=l,I.dot=function(n,u){return n[0]*u[0]+n[1]*u[1]+n[2]*u[2]+n[3]*u[3]},I.lerp=function(n,u,v,_){const b=u[0],M=u[1],P=u[2],C=u[3];return n[0]=b+_*(v[0]-b),n[1]=M+_*(v[1]-M),n[2]=P+_*(v[2]-P),n[3]=C+_*(v[3]-C),n},I.random=function(n,u=1){return n[0]=Math.random(),n[1]=Math.random(),n[2]=Math.random(),n[3]=Math.random(),l(n,n),a(n,n,u),n},I.transformMat4=function(n,u,v){const _=u[0],b=u[1],M=u[2],P=u[3];return n[0]=v[0]*_+v[4]*b+v[8]*M+v[12]*P,n[1]=v[1]*_+v[5]*b+v[9]*M+v[13]*P,n[2]=v[2]*_+v[6]*b+v[10]*M+v[14]*P,n[3]=v[3]*_+v[7]*b+v[11]*M+v[15]*P,n},I.transformQuat=function(n,u,v){const _=u[0],b=u[1],M=u[2],P=v[0],C=v[1],L=v[2],D=v[3],F=D*_+C*M-L*b,j=D*b+L*_-P*M,K=D*M+P*b-C*_,ee=-P*_-C*b-L*M;return n[0]=F*D+ee*-P+j*-L-K*-C,n[1]=j*D+ee*-C+K*-P-F*-L,n[2]=K*D+ee*-L+F*-C-j*-P,n[3]=u[3],n},I.forEach=function(n,u,v,_,b,M){const P=g();let C,L;for(u||(u=4),v||(v=0),L=_?Math.min(_*u+v,n.length):n.length,C=v;C<L;C+=u)P[0]=n[C],P[1]=n[C+1],P[2]=n[C+2],P[3]=n[C+3],b(P,P,M),n[C]=P[0],n[C+1]=P[1],n[C+2]=P[2],n[C+3]=P[3];return n},I.str=function(n){return"vec4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"},I.exactEquals=function(n,u){return n[0]===u[0]&&n[1]===u[1]&&n[2]===u[2]&&n[3]===u[3]},I.equals=function(n,u){const v=n[0],_=n[1],b=n[2],M=n[3],P=u[0],C=u[1],L=u[2],D=u[3];return Math.abs(v-P)<=O.EPSILON*Math.max(1,Math.abs(v),Math.abs(P))&&Math.abs(_-C)<=O.EPSILON*Math.max(1,Math.abs(_),Math.abs(C))&&Math.abs(b-L)<=O.EPSILON*Math.max(1,Math.abs(b),Math.abs(L))&&Math.abs(M-D)<=O.EPSILON*Math.max(1,Math.abs(M),Math.abs(D))}})(w.vec4||(w.vec4={}))},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.EVENTS=w.METHODS=void 0,w.METHODS={GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE",PATCH:"PATCH",OPTIONS:"OPTIONS",HEAD:"HEAD"},w.EVENTS={READY_STATE_CHANGE:"readystatechange",LOAD_START:"loadstart",PROGRESS:"progress",ABORT:"abort",ERROR:"error",LOAD:"load",TIMEOUT:"timeout",LOAD_END:"loadend"}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.httpHelper=void 0;const O=U(42),I={method:O.METHODS.GET,data:void 0,headers:{Accept:"application/json","Content-Type":"application/json"},dump:JSON.stringify,load:JSON.parse,xmlHttpRequest:()=>new XMLHttpRequest,promise:n=>new Promise(n),withCredentials:!1},g=(n,u)=>({status:n.status,response:n.response,data:u,xhr:n});let a=Object.assign({},I);const l=n=>((u,v)=>(u&&u.promise?u.promise:a.promise||I.promise)(v))(n,(u,v)=>{const _=Object.assign(Object.assign(Object.assign({},I),a),n),b=_.xmlHttpRequest();if(_.abort&&typeof n.abort=="function"&&n.abort(()=>{v(g(b)),b.abort()}),_.url===void 0)throw new Error("No URL defined");b.open(_.method,_.params?`${_.url.split("?")[0]}?${new URLSearchParams(_.params)}`:_.url,!0),b.withCredentials=_.withCredentials,b.addEventListener(O.EVENTS.LOAD,()=>{if(b.status>=200&&b.status<300){let P;b.responseText&&(P=_.raw===!0?b.responseText:_.load(b.responseText)),u(g(b,P))}else v(g(b))}),b.addEventListener(O.EVENTS.ABORT,()=>v(g(b))),b.addEventListener(O.EVENTS.ERROR,()=>v(g(b))),b.addEventListener(O.EVENTS.TIMEOUT,()=>v(g(b)));for(const P in _.headers)({}).hasOwnProperty.call(_.headers,P)&&b.setRequestHeader(P,_.headers[P]);if(_.events)for(const P in _.events)({}).hasOwnProperty.call(_.events,P)&&b.addEventListener(P,_.events[P].bind(null,b),!1);const M=typeof _.data!="object"||_.raw?_.data:_.dump(_.data);M!==void 0?b.send(M):b.send()});w.httpHelper={configure:n=>{a=Object.assign(Object.assign({},a),n)},event:O.EVENTS,methods:O.METHODS,rqeust:l,get:(n,u,v)=>l(Object.assign({url:n,method:O.METHODS.GET,params:u},v)),put:(n,u,v)=>l(Object.assign({url:n,method:O.METHODS.PUT,data:u},v)),post:(n,u,v)=>l(Object.assign({url:n,method:O.METHODS.POST,data:u},v)),patch:(n,u,v)=>l(Object.assign({url:n,method:O.METHODS.PATCH,data:u},v)),del:(n,u)=>l(Object.assign({url:n,method:O.METHODS.DELETE},u)),options:(n,u)=>l(Object.assign({url:n,method:O.METHODS.OPTIONS},u))}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.MapOpenWay=void 0,function(O){O.Memory="Memory",O.GeomRender="GeomRender"}(w.MapOpenWay||(w.MapOpenWay={}))},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.decryptFromBase64=w.encryptToBase64=void 0;const O=function(){var g,a,l={};l.btoa===void 0&&(l.btoa=(g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),function(D){var F,j,K,ee,Q,le,pe;for(j=K=0,ee=D.length,le=(ee-=Q=ee%3)/3<<2,Q>0&&(le+=4),F=new Array(le);j<ee;)pe=D.charCodeAt(j++)<<16|D.charCodeAt(j++)<<8|D.charCodeAt(j++),F[K++]=g[pe>>18]+g[pe>>12&63]+g[pe>>6&63]+g[63&pe];return Q==1?(pe=D.charCodeAt(j++),F[K++]=g[pe>>2]+g[(3&pe)<<4]+"=="):Q==2&&(pe=D.charCodeAt(j++)<<8|D.charCodeAt(j++),F[K++]=g[pe>>10]+g[pe>>4&63]+g[(15&pe)<<2]+"="),F.join("")})),l.atob===void 0&&(l.atob=(a=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],function(D){var F,j,K,ee,Q,le,pe,de,Ee,Pe;if((pe=D.length)%4!=0||/[^ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\+\/\=]/.test(D))return"";for(Ee=pe,(de=D.charAt(pe-2)=="="?1:D.charAt(pe-1)=="="?2:0)>0&&(Ee-=4),Ee=3*(Ee>>2)+de,Pe=new Array(Ee),Q=le=0;Q<pe&&(F=a[D.charCodeAt(Q++)])!=-1&&(j=a[D.charCodeAt(Q++)])!=-1&&(Pe[le++]=String.fromCharCode(F<<2|(48&j)>>4),(K=a[D.charCodeAt(Q++)])!=-1)&&(Pe[le++]=String.fromCharCode((15&j)<<4|(60&K)>>2),(ee=a[D.charCodeAt(Q++)])!=-1);)Pe[le++]=String.fromCharCode((3&K)<<6|ee);return Pe.join("")}));function n(D,F){var j=D.length,K=j<<2;if(F){var ee=D[j-1];if(ee<(K-=4)-3||ee>K)return null;K=ee}for(var Q=0;Q<j;Q++)D[Q]=String.fromCharCode(255&D[Q],D[Q]>>>8&255,D[Q]>>>16&255,D[Q]>>>24&255);var le=D.join("");return F?le.substring(0,K):le}function u(D,F){var j,K=D.length,ee=K>>2;(3&K)!=0&&++ee,F?(j=new Array(ee+1))[ee]=K:j=new Array(ee);for(var Q=0;Q<K;++Q)j[Q>>2]|=D.charCodeAt(Q)<<((3&Q)<<3);return j}function v(D){return 4294967295&D}function _(D,F,j,K,ee,Q){return(j>>>5^F<<2)+(F>>>3^j<<4)^(D^F)+(Q[3&K^ee]^j)}function b(D){return D.length<4&&(D.length=4),D}function M(D){if(/^[\x00-\x7f]*$/.test(D))return D;for(var F=[],j=D.length,K=0,ee=0;K<j;++K,++ee){var Q=D.charCodeAt(K);if(Q<128)F[ee]=D.charAt(K);else if(Q<2048)F[ee]=String.fromCharCode(192|Q>>6,128|63&Q);else{if(!(Q<55296||Q>57343)){if(K+1<j){var le=D.charCodeAt(K+1);if(Q<56320&&56320<=le&&le<=57343){var pe=65536+((1023&Q)<<10|1023&le);F[ee]=String.fromCharCode(240|pe>>18&63,128|pe>>12&63,128|pe>>6&63,128|63&pe),++K;continue}}throw new Error("Malformed string")}F[ee]=String.fromCharCode(224|Q>>12,128|Q>>6&63,128|63&Q)}}return F.join("")}function P(D,F){return(F==null||F<0)&&(F=D.length),F===0?"":/^[\x00-\x7f]*$/.test(D)||!/^[\x00-\xff]*$/.test(D)?F===D.length?D:D.substr(0,F):F<32767?function(j,K){for(var ee=new Array(K),Q=0,le=0,pe=j.length;Q<K&&le<pe;Q++){var de=j.charCodeAt(le++);switch(de>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:ee[Q]=de;break;case 12:case 13:if(!(le<pe))throw new Error("Unfinished UTF-8 octet sequence");ee[Q]=(31&de)<<6|63&j.charCodeAt(le++);break;case 14:if(!(le+1<pe))throw new Error("Unfinished UTF-8 octet sequence");ee[Q]=(15&de)<<12|(63&j.charCodeAt(le++))<<6|63&j.charCodeAt(le++);break;case 15:if(!(le+2<pe))throw new Error("Unfinished UTF-8 octet sequence");var Ee=((7&de)<<18|(63&j.charCodeAt(le++))<<12|(63&j.charCodeAt(le++))<<6|63&j.charCodeAt(le++))-65536;if(!(0<=Ee&&Ee<=1048575))throw new Error("Character outside valid Unicode range: 0x"+Ee.toString(16));ee[Q++]=Ee>>10&1023|55296,ee[Q]=1023&Ee|56320;break;default:throw new Error("Bad UTF-8 encoding 0x"+de.toString(16))}}return Q<K&&(ee.length=Q),String.fromCharCode.apply(String,ee)}(D,F):function(j,K){for(var ee=[],Q=new Array(32768),le=0,pe=0,de=j.length;le<K&&pe<de;le++){var Ee=j.charCodeAt(pe++);switch(Ee>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:Q[le]=Ee;break;case 12:case 13:if(!(pe<de))throw new Error("Unfinished UTF-8 octet sequence");Q[le]=(31&Ee)<<6|63&j.charCodeAt(pe++);break;case 14:if(!(pe+1<de))throw new Error("Unfinished UTF-8 octet sequence");Q[le]=(15&Ee)<<12|(63&j.charCodeAt(pe++))<<6|63&j.charCodeAt(pe++);break;case 15:if(!(pe+2<de))throw new Error("Unfinished UTF-8 octet sequence");var Pe=((7&Ee)<<18|(63&j.charCodeAt(pe++))<<12|(63&j.charCodeAt(pe++))<<6|63&j.charCodeAt(pe++))-65536;if(!(0<=Pe&&Pe<=1048575))throw new Error("Character outside valid Unicode range: 0x"+Pe.toString(16));Q[le++]=Pe>>10&1023|55296,Q[le]=1023&Pe|56320;break;default:throw new Error("Bad UTF-8 encoding 0x"+Ee.toString(16))}if(le>=32766){var Je=le+1;Q.length=Je,ee[ee.length]=String.fromCharCode.apply(String,Q),K-=Je,le=-1}}return le>0&&(Q.length=le,ee[ee.length]=String.fromCharCode.apply(String,Q)),ee.join("")}(D,F)}function C(D,F){return D==null||D.length===0?D:(D=M(D),F=M(F),n(function(j,K){var ee,Q,le,pe,de,Ee,Pe=j.length,Je=Pe-1;for(Q=j[Je],le=0,Ee=0|Math.floor(6+52/Pe);Ee>0;--Ee){for(pe=(le=v(le+2654435769))>>>2&3,de=0;de<Je;++de)ee=j[de+1],Q=j[de]=v(j[de]+_(le,ee,Q,de,pe,K));ee=j[0],Q=j[Je]=v(j[Je]+_(le,ee,Q,Je,pe,K))}return j}(u(D,!0),b(u(F,!1))),!1))}function L(D,F){return D==null||D.length===0?D:(F=M(F),P(n(function(j,K){var ee,Q,le,pe,de,Ee=j.length,Pe=Ee-1;for(ee=j[0],le=v(2654435769*Math.floor(6+52/Ee));le!==0;le=v(le-2654435769)){for(pe=le>>>2&3,de=Pe;de>0;--de)Q=j[de-1],ee=j[de]=v(j[de]-_(le,ee,Q,de,pe,K));Q=j[Pe],ee=j[0]=v(j[0]-_(le,ee,Q,0,pe,K))}return j}(u(D,!1),b(u(F,!1))),!0)))}return{utf8Encode:M,utf8Decode:P,encrypt:C,encryptToBase64:function(D,F){return l.btoa(C(D,F))},encryptToBase64Url:function(D,F){return l.btoa(C(D,F)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},decrypt:L,decryptFromBase64:function(D,F){return D==null||D.length===0?D:L(l.atob(D),F)},decryptFromBase64Url:function(D,F){return D==null||D.length===0?D:L(l.atob(((j=D)+"===".slice((j.length+3)%4)).replace(/-/g,"+").replace(/_/g,"/")),F);var j}}}(),I=[35,94,118,106,109,97,112,95,99,111,109,42,64].map(g=>String.fromCodePoint(g)).join("");w.encryptToBase64=function(g){return O.encryptToBase64Url(g,I)},w.decryptFromBase64=function(g){return O.decryptFromBase64Url(g,I)}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbRasterImage=void 0;const O=U(3);class I extends O.DbEntity{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbRasterImage"}}w.DbRasterImage=I},function(he,w,U){var O=this&&this.__rest||function(u,v){var _={};for(var b in u)Object.prototype.hasOwnProperty.call(u,b)&&v.indexOf(b)<0&&(_[b]=u[b]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function"){var M=0;for(b=Object.getOwnPropertySymbols(u);M<b.length;M++)v.indexOf(b[M])<0&&Object.prototype.propertyIsEnumerable.call(u,b[M])&&(_[b[M]]=u[b[M]])}return _};Object.defineProperty(w,"__esModule",{value:!0}),w.createAnimation=void 0;const I=U(29),g=U(20),a=U(131),l=U(133),n=u=>{const v=({delta:_})=>u(_);return{start:()=>I.default.update(v,!0),stop:()=>I.cancelSync.update(v)}};w.createAnimation=function(u){var v,_,{from:b,autoplay:M=!0,driver:P=n,elapsed:C=0,repeat:L=0,repeatType:D="loop",repeatDelay:F=0,onPlay:j,onStop:K,onComplete:ee,onRepeat:Q,onUpdate:le}=u,pe=O(u,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]);let de,Ee,Pe,{to:Je}=pe,xt=0,vt=pe.duration,ct=!1,Rt=!0;const Pt=a.detectAnimationFromOptions(pe);((_=(v=Pt).needsInterpolation)===null||_===void 0?void 0:_.call(v,b,Je))&&(Pe=g.interpolate([0,100],[b,Je],{clamp:!1}),b=0,Je=100);const nn=Pt(Object.assign(Object.assign({},pe),{from:b,to:Je}));function mn(cn){if(Rt||(cn=-cn),C+=cn,!ct){const ht=nn.next(Math.max(0,C));Ee=ht.value,Pe&&(Ee=Pe(Ee)),ct=Rt?ht.done:C<=0}le==null||le(Ee),ct&&(xt===0&&(vt=vt!=null?vt:C),xt<L?l.hasRepeatDelayElapsed(C,vt,F,Rt)&&(xt++,D==="reverse"?(Rt=xt%2==0,C=l.reverseElapsed(C,vt,F,Rt)):(C=l.loopElapsed(C,vt,F),D==="mirror"&&nn.flipTarget()),ct=!1,Q&&Q()):(de.stop(),ee&&ee()))}return M&&(j==null||j(),de=P(mn),de.start()),{stop:()=>{K==null||K(),de.stop()},start:()=>{j==null||j(),de.start()}}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.mixComplex=w.mixObject=w.mixArray=void 0;const O=U(14),I=U(28),g=U(22),a=U(16),l=U(21),n=U(23);function u(_,b){return g.isNum(_)?M=>a.mix(_,b,M):I.color.test(_)?l.mixColor(_,b):w.mixComplex(_,b)}function v(_){const b=I.complex.parse(_),M=b.length;let P=0,C=0,L=0;for(let D=0;D<M;D++)P||typeof b[D]=="number"?P++:b[D].hue!==void 0?L++:C++;return{parsed:b,numNumbers:P,numRGB:C,numHSL:L}}w.mixArray=(_,b)=>{const M=[..._],P=M.length,C=_.map((L,D)=>u(L,b[D]));return L=>{for(let D=0;D<P;D++)M[D]=C[D](L);return M}},w.mixObject=(_,b)=>{const M=Object.assign(Object.assign({},_),b),P={};for(const C in M)_[C]!==void 0&&b[C]!==void 0&&(P[C]=u(_[C],b[C]));return C=>{for(const L in P)M[L]=P[L](C);return M}},w.mixComplex=(_,b)=>{const M=I.complex.createTransformer(b),P=v(_),C=v(b);return O.invariant(P.numHSL===C.numHSL&&P.numRGB===C.numRGB&&P.numNumbers>=C.numNumbers,`Complex values '${_}' and '${b}' too different to mix. Ensure all colors are of the same type.`),n.pipe(w.mixArray(P.parsed,C.parsed),M)}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.progress=void 0,w.progress=(O,I,g)=>{const a=I-O;return a===0?1:(g-O)/a}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.decay=void 0,w.decay=function({velocity:O=0,from:I=0,power:g=.8,timeConstant:a=350,restDelta:l=.5,modifyTarget:n}){const u={done:!1,value:I};let v=g*O;const _=I+v,b=n===void 0?_:n(_);return b!==_&&(v=b-I),{next:M=>{const P=-v*Math.exp(-M/a);return u.done=!(P>l||P<-l),u.value=u.done?b:b+P,u},flipTarget:()=>{}}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.keyframes=w.convertOffsetToTimes=w.defaultOffset=w.defaultEasing=void 0;const O=U(24),I=U(20);function g(n,u){return n.map(()=>u||O.easeInOut).splice(0,n.length-1)}function a(n){const u=n.length;return n.map((v,_)=>_!==0?_/(u-1):0)}function l(n,u){return n.map(v=>v*u)}w.defaultEasing=g,w.defaultOffset=a,w.convertOffsetToTimes=l,w.keyframes=function({from:n=0,to:u=1,ease:v,offset:_,duration:b=300}){const M={done:!1,value:n},P=Array.isArray(u)?u:[n,u],C=l(_&&_.length===P.length?_:a(P),b);function L(){return I.interpolate(C,P,{ease:Array.isArray(v)?v:g(P,v)})}let D=L();return{next:F=>(M.value=D(F),M.done=F>=b,M),flipTarget:()=>{P.reverse(),D=L()}}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.createAnticipate=w.createBackIn=w.createExpoIn=w.mirrorEasing=w.reverseEasing=void 0,w.reverseEasing=O=>I=>1-O(1-I),w.mirrorEasing=O=>I=>I<=.5?O(2*I)/2:(2-O(2*(1-I)))/2,w.createExpoIn=O=>I=>I**O,w.createBackIn=O=>I=>I*I*((O+1)*I-O),w.createAnticipate=O=>{const I=w.createBackIn(O);return g=>(g*=2)<1?.5*I(g):.5*(2-Math.pow(2,-10*(g-1)))}},function(he,w,U){var O=this&&this.__rest||function(v,_){var b={};for(var M in v)Object.prototype.hasOwnProperty.call(v,M)&&_.indexOf(M)<0&&(b[M]=v[M]);if(v!=null&&typeof Object.getOwnPropertySymbols=="function"){var P=0;for(M=Object.getOwnPropertySymbols(v);P<M.length;P++)_.indexOf(M[P])<0&&Object.prototype.propertyIsEnumerable.call(v,M[P])&&(b[M[P]]=v[M[P]])}return b};Object.defineProperty(w,"__esModule",{value:!0}),w.spring=void 0;const I=U(132),g=["duration","bounce"],a=["stiffness","damping","mass"];function l(v,_){return _.some(b=>v[b]!==void 0)}function n(v){var{from:_=0,to:b=1,restSpeed:M=2,restDelta:P}=v,C=O(v,["from","to","restSpeed","restDelta"]);const L={done:!1,value:_};let{stiffness:D,damping:F,mass:j,velocity:K,duration:ee,isResolvedFromDuration:Q}=function(Ee){let Pe=Object.assign({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},Ee);if(!l(Ee,a)&&l(Ee,g)){const Je=I.findSpring(Ee);Pe=Object.assign(Object.assign(Object.assign({},Pe),Je),{velocity:0,mass:1}),Pe.isResolvedFromDuration=!0}return Pe}(C),le=u,pe=u;function de(){const Ee=K?-K/1e3:0,Pe=b-_,Je=F/(2*Math.sqrt(D*j)),xt=Math.sqrt(D/j)/1e3;if(P=(P!=null?P:Math.abs(b-_)<=1)?.01:.4,Je<1){const vt=I.calcAngularFreq(xt,Je);le=ct=>{const Rt=Math.exp(-Je*xt*ct);return b-Rt*((Ee+Je*xt*Pe)/vt*Math.sin(vt*ct)+Pe*Math.cos(vt*ct))},pe=ct=>{const Rt=Math.exp(-Je*xt*ct);return Je*xt*Rt*(Math.sin(vt*ct)*(Ee+Je*xt*Pe)/vt+Pe*Math.cos(vt*ct))-Rt*(Math.cos(vt*ct)*(Ee+Je*xt*Pe)-vt*Pe*Math.sin(vt*ct))}}else if(Je===1)le=vt=>b-Math.exp(-xt*vt)*(Pe+(Ee+xt*Pe)*vt);else{const vt=xt*Math.sqrt(Je*Je-1);le=ct=>{const Rt=Math.exp(-Je*xt*ct),Pt=Math.min(vt*ct,300);return b-Rt*((Ee+Je*xt*Pe)*Math.sinh(Pt)+vt*Pe*Math.cosh(Pt))/vt}}}return de(),{next:Ee=>{const Pe=le(Ee);if(Q)L.done=Ee>=ee;else{const Je=1e3*pe(Ee),xt=Math.abs(Je)<=M,vt=Math.abs(b-Pe)<=P;L.done=xt&&vt}return L.value=L.done?b:Pe,L},flipTarget:()=>{K=-K,[_,b]=[b,_],de()}}}w.spring=n,n.needsInterpolation=(v,_)=>typeof v=="string"||typeof _=="string";const u=v=>0},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.velocityPerSecond=void 0,w.velocityPerSecond=function(O,I){return I?O*(1e3/I):0}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.radiansToDegrees=void 0,w.radiansToDegrees=O=>180*O/Math.PI},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.degreesToRadians=void 0,w.degreesToRadians=O=>O*Math.PI/180},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.isPoint3D=void 0;const O=U(25);w.isPoint3D=I=>O.isPoint(I)&&I.hasOwnProperty("z")},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.smoothFrame=void 0;const O=U(59);w.smoothFrame=(I,g,a,l=0)=>O.toDecimal(I+a*(g-I)/Math.max(l,a))},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.toDecimal=void 0,w.toDecimal=(O,I=2)=>(I=10**I,Math.round(O*I)/I)},function(he,w,U){var O=this&&this.__createBinding||(Object.create?function(a,l,n,u){u===void 0&&(u=n),Object.defineProperty(a,u,{enumerable:!0,get:function(){return l[n]}})}:function(a,l,n,u){u===void 0&&(u=n),a[u]=l[n]}),I=this&&this.__exportStar||function(a,l){for(var n in a)n==="default"||l.hasOwnProperty(n)||O(l,a,n)};Object.defineProperty(w,"__esModule",{value:!0});const g=U(30);I(U(30),w),w.default=g},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0});const O=U(5),I=U(32),g=U(62),a=U(63),l=O.Map.prototype.addControl;O.Map.prototype.addControl=function(){var b,M,P,C;arguments.length>0&&(((M=(b=arguments[0])===null||b===void 0?void 0:b.constructor)===null||M===void 0?void 0:M.name)==="LogoControl"||typeof((P=arguments[0])===null||P===void 0?void 0:P._updateLogo)=="function"&&typeof((C=arguments[0])===null||C===void 0?void 0:C._updateCompact)=="function")||typeof l=="function"&&l.call(this,...arguments)};const n=O.Map.prototype._setupContainer;O.Map.prototype._setupContainer=function(){I.MapGlUtils.init(this,!0),a.recvMapAuthEvent(this),typeof n=="function"&&n.call(this,...arguments),g.initAuthorize(this)};const u=O.Map.prototype._authenticate;function v(b,M,P){const C=P&&P.maxWidth||100,L=b._container.clientHeight/2,D=b.unproject([0,L]),F=b.unproject([C,L]);let j=D.distanceTo(F);if(b.getProjection()){const K=b.fromLngLat(D),ee=b.fromLngLat(F);j=K.distanceTo(ee)}if(P&&P.unit==="imperial"){const K=3.2808*j;K>5280?_(M,C,K/5280,b._getUIString("ScaleControl.Miles")):_(M,C,K,b._getUIString("ScaleControl.Feet"))}else P&&P.unit==="nautical"?_(M,C,j/1852,b._getUIString("ScaleControl.NauticalMiles")):j>=1e3?_(M,C,j/1e3,b._getUIString("ScaleControl.Kilometers")):_(M,C,j,b._getUIString("ScaleControl.Meters"))}function _(b,M,P,C){const L=function(F){const j=Math.pow(10,(""+Math.floor(F)).length-1);let K=F/j;return K=K>=10?10:K>=5?5:K>=3?3:K>=2?2:K>=1?1:function(ee){const Q=Math.pow(10,Math.ceil(-Math.log(ee)/Math.LN10));return Math.round(ee*Q)/Q}(K),j*K}(P),D=L/P;b.style.width=M*D+"px",b.innerHTML=`${L}&nbsp;${C}`}O.Map.prototype._authenticate=()=>{},O.Map.prototype.enableAuthenticate=function(){O.Map.prototype._authenticate=u},O.Map.prototype.disableAuthenticate=function(){O.Map.prototype._authenticate=()=>{}},O.ScaleControl.prototype._onMove=function(){v(this._map,this._container,this.options)},O.ScaleControl.prototype.setUnit=function(b){this.options.unit=b,v(this._map,this._container,this.options)}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.initAuthorize=void 0;const O=U(33);w.initAuthorize=function(I){const g=[22320,22270,23545,35937,38656,35843,29992,97,116,116,97,99,104,26469,20851,32852,26381,21153,23545,35937,65292,22914,32,109,97,112,46,97,116,116,97,99,104,40,115,118,99,44,32,112,114,106,41,59].map(u=>String.fromCodePoint(u)).join("");let a=new O.MessageTipControl({message:g}),l=!1,n={};setInterval(()=>{if(!I._svc)return void(l||(l=!0,I.addControl(a)));const u=[95,99,117,115,116,111,109,95,101,118,116,95,97,117,116,104].map(v=>String.fromCodePoint(v)).join("");I.fire(u,n)},18e4)}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.recvMapAuthEvent=void 0;const O=U(64),I=U(2),g=U(33),a=U(100),l=U(45);w.recvMapAuthEvent=function(n){let u=null;const v=[36229,36807,20102,26368,22823,24182,21457,25968,29992,25143,65292,35775,38382,35831,27714,23558,19981,20801,35768,65281].map(C=>String.fromCodePoint(C)).join("");let _=null,b=!1,M={};const P=[95,99,117,115,116,111,109,95,101,118,116,95,97,117,116,104].map(C=>String.fromCodePoint(C)).join("");n.on(P,async C=>{if(!n._svc)return;let L=await async function(D,F){let j=D._svc;const K=j._url("heart")+"?token="+j.accessToken;F.getVisitorId||(F.getVisitorId=a.getVisitorId());let ee={};try{let Q=await F.getVisitorId(),le=await j._post(K,{tm:l.encryptToBase64(Q)});le&&"data"in le&&(le=le.data);let pe=l.decryptFromBase64(le.info);ee=JSON.parse(pe)}catch{ee={}}return ee}(n,M);JSON.stringify(L)=="{}"||!L.trial&&L.permitAccessUserCount>0?(u&&u.remove(),u=null):u?I.randInt(0,20)<=1&&(u.remove(),u=(await O.addImage(n)).layer):u=(await O.addImage(n)).layer,L.overMaxAccessUser?b?_&&_.updateMessage(v+`: ${L.curAccessUserCount} > ${L.permitAccessUserCount}`):(b=!0,_||(_=new g.MessageTipControl({message:v+`: ${L.curAccessUserCount} > ${L.permitAccessUserCount}`})),n.addControl(_)):(b=!1,_&&(n.removeControl(_),_=null))})}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.addImage=void 0;const O=U(34);w.addImage=async function(I){const g=[95,105,109,103,95,119,109,95].map(l=>String.fromCodePoint(l)).join(""),a=()=>{const l=I.getGeoBounds(.6),n=[];for(let v=0;v<30;v++)for(let _=0;_<v+1;_++){const b=l.randomPoint(),M={point:I.toLngLat(b),properties:{z:v}};n.push(M)}const u=new O.Symbol({filter:["==",["zoom"],["get","z"]],data:n,iconImage:g});return u.addTo(I),u};return new Promise((l,n)=>{try{const u="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAAAoCAYAAAAcwQPnAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAXGSURBVHja7Fwxb+M2FP5SnDo4CBQD0RAN8aJFiztkSZYsXW7pPylQtL+jwxW46x+5JUuXLvFQD83iRYsXZVAOic+IhhMgdtAn+0lHyTpbshWUHxBIlki+x8ePfOQjlSOlFAwM2sZ3xgQGhlgGhlgGhlgGBoZYBq8Db8oPnM+fNMkU/1C6qprf62eq8G71ZwEq+SqvKqZTlTJSXZkaealGt7TwvkI/rQylqt6lQse0pEtaI1/3vr5+9fXNbYiGeYvtuxz+3g2x9gAXgA9gACAAMDP927jCNuCRVPm9ZZrBEKsN/Asg5v0MQGKa4X8wx9oDFgD+4khlSGVGrNZhSGWIZWDweog1qJm4+5zYGxwAJ0+/+SdPv+5k/6Py6Qbn8yfNSk0lgAp4z4YvxIYWgApr4lguoGwRvzrl7ykAkU/5UMrj/QxQiYLyszyI+SwC1BhIXaaLADWpiOuMgPQMmfxctwRI51l9VFITx/KA1KJMLytLDRjHioD0AVDzPcSxXECdF+ugIuq1aBDHWunO3wn1nmniWD7Tr+zPZxag4myxldsfLmVEy+GHSRNiOQBsjhoAEADqMStwRSyXCtiZAggzwZXEGpBMObFyZcvEAonlswJQGWlsADeUQcOkc+rgA+peNjINfZXJTAOSKNfNBtIfKP8OSGPRMDagbkSDB2yQnGALEssHUo+dadohscYkRcg6JtTlElAOO1RUQSwLUNfUX9pgJMhzp7IOK2UX7L8cvpucPP1Cu2Bl/+Xw/fzk6Wemxf1y+GG+yRVGGZkQiVVcVEoTAnhmukCED6oQM08IYN4gPQB8D2AidIjpPvMy8uckSwFjAA7DGYFmVTpjWZ7m3Uesg7YjXidCFkS5bocue0z5MwBTsdhJANyLNFW4Zh3/LtlgDuBOpKm0/3L4bgIAy+EfBfsvh+832b92jvUo5kI6OKKBu0BYsYqUz7/wWp6ruRvKfub1tKYj5NdpRZqAOo06qLvDcheajgEAx6Jt7Io5ql3T6WPRufwO7F9LrLCmkRwALw1HnkOEKaISgbZFtEGPvBc7LdfxoqJxc7wI+QvN+xHfBxvad5uO0ShM9GaD+4poNLtUgXMxovUR04qRpu0tpBfaxt5Awm1GrDpixQBuK96NWMcm+jyL0bFV77Mp8v5IwU6JWI7w032GzRFXGnvRYvlxlStoIQyTbOkRrJJu+9a/EbFC+uAzMawe0g1+C65EhwhKbsHqcZzMail/E5eVHIpY0h0O+PscwMMrIVVYM/lukwR92p5K9pSnFk0i74+lSfxpx6vBXeGSVHHHpJIr5jYbZsHyrC1HkmTDar5r/RsTK59Angk32GecNVjRtYXjjmTFG8IhEuOK1V6TvKdMGx6CWNIdXvR8NdjFRLpuZBxgHbwtv/sJwFtsjqnVdeaLBqOzpRmxQurmNtA/PNSIJd1h390gxKqvLrY00hjZq3GrOvLm6XVHq32Rzt+iDgHr4dbUIw9u6uTPSPa68IqHdaAUhyJWuEf3YlWMPJZmFDkuXfNGiZjuSmPMG7rLRJR5VhGGiOhqvBLZrhnKmHZok3+o06WGnB51mFWszhOGgyymG5X0v+G7O81otav9Aeg3oTV6KnBH+6G4Gb31Vzo33PCdZA2zen4JVdjFD1W2+fq2JGMKpANulkLs2t8KedzVTweyvKwOacjN2DFPN8y5yQtxouBSbGD7TJ9/pRMC6ay48V7YhGZ+BZXpGu5wusFD8XQI5aug4emGXHeLv2Pm151uuCydoggB0P6FMqfrEXP1PFkO/7zdhljivhGx+HmXllg/sqK3X+Xtx+dfklgz8/lXd67wWzHixPWqZtLY97maQQ+JZYkJtNx9tzk/iNDv7wkHQl+DLdDVVzpzrPfprlHckwp7TCoeKFzPDBg26DqCb4jVEAkbYiYCdcmeVpW7hio+GlrsjiPzH/0MXtMcy8AQy8DAEMvAEMvAEMvAoGX8NwAiCOY0OotnkAAAAABJRU5ErkJggg==";if(I&&I.style)if(I.hasImage(g))l({layer:a()});else{const v=new Image(150,40);v.src=u,v.onload=()=>{I.hasImage(g)||I.addImage(g,v),l({layer:a()})}}else l({layer:null})}catch{l({layer:null})}})}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.applyMixinsWithoutProperties=w.applyMixins=void 0,w.applyMixins=function(O,I){I.forEach(g=>{Object.getOwnPropertyNames(g.prototype).forEach(a=>{O.prototype[a]=g.prototype[a]})})},w.applyMixinsWithoutProperties=function(O,I){I.forEach(g=>{Object.getOwnPropertyNames(g.prototype).forEach(a=>{const l=Object.getOwnPropertyDescriptor(g.prototype,a);l!==void 0&&l.get===void 0&&a!=="constructor"&&(O.prototype[a]=g.prototype[a])})})}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.getOptionValue=void 0,w.getOptionValue=function(...O){for(const I of O)if(I!=null)return I}},function(he,w,U){function O(l,n){return n=n!=null?n:[],new Proxy(function(){},{get(u,v,_){if(v==="then"){if((n==null?void 0:n.length)===0)return{then:()=>_};const b=l.remote({type:"GET",path:n});return b.then.bind(b)}return O(l,n==null?void 0:n.concat(v))},set:(u,v,_)=>l.remote({type:"SET",path:n.concat(v),value:_}),apply:(u,v,_)=>l.remote({type:"APPLY",path:n,args:_}),construct:(u,v)=>l.remote({type:"CONSTRUCT",args:v})})}Object.defineProperty(w,"__esModule",{value:!0}),w.WorkerExpose=w.WorkerLink=w.WorkerProxy=void 0,w.WorkerProxy=function(l){let n,u;if(typeof l=="function"){const v=Function.prototype.toString;n=u=URL.createObjectURL(new Blob([`${v.call(g)}
(${v.call(a)})(${v.call(l)})`]))}else typeof l=="string"&&(n=l,l.indexOf("blob:")===0&&(u=n));if(n){const v=new Worker(n);return u&&(v.oURL=u),O(new I(v))}throw"WorkerProxy only supports functions, classes, urls"},w.WorkerLink=function(l){return O(new I(l))};class I{constructor(n,u){this.w=n,this.uid=u!=null?u:`${Date.now()}-${g()}`,this.c=0,this.cbs={},n.addEventListener("message",v=>{if(this.w.oURL)try{URL.revokeObjectURL(this.w.oURL)}catch{}finally{delete this.w.oURL}const _=v.data&&v.data.id,b=_&&this.cbs[_];b&&(delete this.cbs[_],v.data.error?b[1](new Error(v.data.error)):b[0](v.data.targetId?O(new I(n,v.data.targetId)):v.data.value))})}remote(n){const u=n.args||[],v=`${this.uid}-${++this.c}`;return new Promise((_,b)=>{this.cbs[v]=[_,b],this.w.postMessage(Object.assign({},n,{id:v,args:u,target:this.uid}))})}}function g(){return Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}function a(l){const n=l,u={};self.addEventListener("message",async v=>{const _=v.data||{};_.path=_.path||[];const b=_.target&&u[_.target]||n,M=C=>C.reduce((L,D)=>L&&L[D],b),P=_&&_.id;if(P&&_.type){const C={id:P},L=M(_.path),D=M(_.path.slice(0,-1));switch(_.type){case"GET":C.value=L;break;case"SET":const F=_.path.length&&_.path[_.path.length-1];F&&(D[F]=_.value),C.value=!!F;break;case"APPLY":try{C.value=await L.apply(D,_.args||[])}catch(j){C.error=j.toString()}break;case"CONSTRUCT":try{C.value=new L(..._.args),C.targetId=(j=>{const K=`${Date.now()}-${g()}`;return u[K]=j,K})(C.value)}catch(j){C.error=j.toString()}}self.postMessage(C)}})}w.WorkerExpose=a},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.Dom=void 0;const O=U(2);(function(I){I.create=function(_,b,M){const P=window.document.createElement(_);return b!==void 0&&(P.className=b),M&&M.appendChild(P),P},I.createNS=function(_,b){return window.document.createElementNS(_,b)};const g=window.document&&window.document.documentElement.style,a=g&&g.userSelect!==void 0?"userSelect":"WebkitUserSelect";let l;I.disableDrag=function(){g&&a&&(l=g[a],g[a]="none")},I.enableDrag=function(){g&&a&&(g[a]=l)},I.setTransform=function(_,b){_.style.transform=b};let n=!1;try{const _=Object.defineProperty({},"passive",{get(){n=!0}});window.addEventListener("test",_,_),window.removeEventListener("test",_,_)}catch{n=!1}I.addEventListener=function(_,b,M,P={}){"passive"in P&&n?_.addEventListener(b,M,P):_.addEventListener(b,M,P.capture)},I.removeEventListener=function(_,b,M,P={}){"passive"in P&&n?_.removeEventListener(b,M,P):_.removeEventListener(b,M,P.capture)};const u=function(_){_.preventDefault(),_.stopPropagation(),window.removeEventListener("click",u,!0)};function v(_,b,M){const P=_.offsetWidth===b.width?1:_.offsetWidth/b.width;return new O.GeoPoint((M.clientX-b.left)*P,(M.clientY-b.top)*P)}I.suppressClick=function(){window.addEventListener("click",u,!0),window.setTimeout(()=>{window.removeEventListener("click",u,!0)},0)},I.mousePos=function(_,b){const M=_.getBoundingClientRect();return v(_,M,b)},I.touchPos=function(_,b){const M=_.getBoundingClientRect(),P=[];for(let C=0;C<b.length;C++)P.push(v(_,M,b[C]));return P},I.mouseButton=function(_){return window.InstallTrigger!==void 0&&_.button===2&&_.ctrlKey&&window.navigator.platform.toUpperCase().includes("MAC")?0:_.button},I.remove=function(_){_.parentNode&&_.parentNode.removeChild(_)}})(w.Dom||(w.Dom={}))},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.GCJ02ToBD09=w.BD09ToGCJ02=void 0;const{sin:O,cos:I,atan2:g,sqrt:a,PI:l}=Math,n=3e3*l/180;w.BD09ToGCJ02=function(u){const[v,_]=u,b=v-.0065,M=_-.006,P=a(b*b+M*M)-2e-5*O(M*n),C=g(M,b)-3e-6*I(b*n);return[P*I(C),P*O(C)]},w.GCJ02ToBD09=function(u){const[v,_]=u,b=v,M=_,P=a(b*b+M*M)+2e-5*O(M*n),C=g(M,b)+3e-6*I(b*n);return[P*I(C)+.0065,P*O(C)+.006]}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.BD09MCtoBD09=w.BD09toBD09MC=void 0;const{abs:O}=Math,I=[1289059486e-2,836237787e-2,5591021,348198983e-2,167804312e-2,0],g=[75,60,45,30,15,0],a=[[1410526172116255e-23,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,173379812e-1],[-7435856389565537e-24,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,1026014486e-2],[-3030883460898826e-23,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,685681737e-2],[-1981981304930552e-23,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,448277706e-2],[309191371068437e-23,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,25551644e-1],[2890871144776878e-24,8983055095805407e-21,-3068298e-14,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],l=[[-.0015702102444,111320.7020616939,1704480524535203,-10338987376042340,26112667856603880,-35149669176653700,26595700718403920,-10725012454188240,1800819912950474,82.5],[.0008277824516172526,111320.7020463578,6477955746671607e-7,-4082003173641316e-6,1077490566351142e-5,-1517187553151559e-5,1205306533862167e-5,-5124939663577472e-6,9133119359512032e-7,67.5],[.00337398766765,111320.7020202162,4481351045890365e-9,-2339375119931662e-8,7968221547186455e-8,-1159649932797253e-7,9723671115602145e-8,-4366194633752821e-8,8477230501135234e-9,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837749470245e-9,992013.7397791013,-122195221711287e-8,1340652697009075e-9,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758690035394e-9,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]];function n(u,v,_){const b=O(v)/_[9];let M=_[0]+_[1]*O(u),P=_[2]+_[3]*b+_[4]*b**2+_[5]*b**3+_[6]*b**4+_[7]*b**5+_[8]*b**6;return M*=u<0?-1:1,P*=v<0?-1:1,[M,P]}w.BD09toBD09MC=function(u){const[v,_]=u;let b=[];for(let M=0;M<g.length;M++)if(O(_)>g[M]){b=l[M];break}return n(v,_,b)},w.BD09MCtoBD09=function(u){const[v,_]=u;let b=[];for(let M=0;M<I.length;M++)if(_>=I[M]){b=a[M];break}return n(v,_,b)}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.WGS84ToEPSG3857=w.ESPG3857ToWGS84=void 0;const O=180/Math.PI,I=Math.PI/180,g=6378137,a=20037508342789244e-9;w.ESPG3857ToWGS84=function(l){return[l[0]*O/g,(.5*Math.PI-2*Math.atan(Math.exp(-l[1]/g)))*O]},w.WGS84ToEPSG3857=function(l){const n=Math.abs(l[0])<=180?l[0]:l[0]-360*(l[0]<0?-1:1),u=[g*n*I,g*Math.log(Math.tan(.25*Math.PI+.5*l[1]*I))];return u[0]>a&&(u[0]=a),u[0]<-a&&(u[0]=-a),u[1]>a&&(u[1]=a),u[1]<-a&&(u[1]=-a),u}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.GCJ02ToWGS84=w.WGS84ToGCJ02=void 0;const{sin:O,cos:I,sqrt:g,abs:a,PI:l}=Math,n=6378245,u=.006693421622965823;function v(M,P){return M>=72.004&&M<=137.8347&&P>=.8293&&P<=55.8271}function _(M,P){let C=function(K,ee){let Q=300+K+2*ee+.1*K*K+.1*K*ee+.1*g(a(K));return Q+=2*(20*O(6*K*l)+20*O(2*K*l))/3,Q+=2*(20*O(K*l)+40*O(K/3*l))/3,Q+=2*(150*O(K/12*l)+300*O(K/30*l))/3,Q}(M-105,P-35),L=function(K,ee){let Q=2*K-100+3*ee+.2*ee*ee+.1*K*ee+.2*g(a(K));return Q+=2*(20*O(6*K*l)+20*O(2*K*l))/3,Q+=2*(20*O(ee*l)+40*O(ee/3*l))/3,Q+=2*(160*O(ee/12*l)+320*O(ee*l/30))/3,Q}(M-105,P-35);const D=P/180*l;let F=O(D);F=1-u*F*F;const j=g(F);return C=180*C/(n/j*I(D)*l),L=180*L/(n*(1-u)/(F*j)*l),[C,L]}function b(M){const[P,C]=M;if(!v(P,C))return[P,C];const L=_(P,C);return[P+L[0],C+L[1]]}w.WGS84ToGCJ02=b,w.GCJ02ToWGS84=function(M){const[P,C]=M;if(!v(P,C))return[P,C];let[L,D]=[P,C],F=b([L,D]),j=F[0]-P,K=F[1]-C;for(;a(j)>1e-6||a(K)>1e-6;)L-=j,D-=K,F=b([L,D]),j=F[0]-P,K=F[1]-C;return[L,D]}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0});const O=U(1),I=U(10),g=U(37),a=U(38);w.default=function(l,n,u){a.assert(!!l,"The args[0] input coordinate is required");const v=typeof l;if(a.assert(v==="string"||v==="object","Invalid input coordinate type: "+v),v==="string")try{l=JSON.parse(l)}catch{throw new Error("Invalid input coordinate: "+l)}let _;if(typeof n=="function")_=n;else{if(a.assert(!!n,"The args[1] original coordinate system is required"),a.assert(!!u,"The args[2] target coordinate system is required"),n===u)return l;const b=g.default[n];a.assert(!!b,"Invalid original coordinate system: "+n);const M=b.to[u];a.assert(!!M,"Invalid target coordinate system: "+u),_=M}if(I.isGeoPointLike(l)){const b=O.GeoPoint.convert(l);return _([b.x,b.y])}return a.isArray(l)?l.length===0?l:Array.isArray(l)&&l[0].length>0&&Array.isArray(l[0][0])&&l[0][0].length>=2?l.map(b=>b.map(M=>{const P=O.GeoPoint.convert(M);return _([P.x,P.y])})):l.map(b=>{const M=O.GeoPoint.convert(b);return _([M.x,M.y])}):(a.coordEach(l,b=>{[b[0],b[1]]=_(b)}),l)}},function(he,w,U){var O;Object.defineProperty(w,"__esModule",{value:!0}),w.getEpsgParam=w.EpsgCrsTypes=void 0,function(I){I.Beijing54="Beijing54",I.Xian80="Xian80",I.CGCS2000="CGCS2000",I.Wgs84="Wgs84",I.Merc3857="Merc3857"}(O=w.EpsgCrsTypes||(w.EpsgCrsTypes={})),w.getEpsgParam=function(I,g){if(I==O.Wgs84)return{epsg:"EPSG:4326",proj:"+proj=longlat +datum=WGS84 +no_defs"};if(I==O.Merc3857)return{epsg:"EPSG:3857",proj:"+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs"};let a=+(g+"").substr(0,2);if(I==O.Beijing54){if(a>=13&&a<=23){let l=a-13;return{epsg:"EPSG:"+(21413+l),proj:`+proj=tmerc +lat_0=0 +lon_0=${75+6*l} +k=1.000000 +x_0=${135e5+1e6*l} +y_0=0 +ellps=krass +units=m +no_defs  no_defs`}}if(a>=25&&a<=45){let l=a-25;return{epsg:"EPSG:"+(2401+l),proj:`+proj=tmerc +lat_0=0 +lon_0=${75+3*l} +k=1.000000 +x_0=${255e5+1e6*l} +y_0=0 +ellps=krass +units=m +no_defs  no_defs`}}}else if(I==O.Xian80){if(a>=13&&a<=23){let l=a-13;return{epsg:"EPSG:"+(2327+l),proj:`+proj=tmerc +lat_0=0 +lon_0=${75+6*l} +k=1.000000 +x_0=${135e5+1e6*l} +y_0=0 +a=6378140 +b=6356755.288157528 +units=m +no_defs  no_defs`}}if(a>=25&&a<=45){let l=a-25;return{epsg:"EPSG:"+(2349+l),proj:`+proj=tmerc +lat_0=0 +lon_0=${75+3*l} +k=1.000000 +x_0=${255e5+1e6*l} +y_0=0 +a=6378140 +b=6356755.288157528 +units=m +no_defs  no_defs`}}}else if(I==O.CGCS2000){if(a>=13&&a<=23){let l=a-13;return{epsg:"EPSG:"+(4491+l),proj:`+proj=tmerc +lat_0=0 +lon_0=${75+6*l} +k=1 +x_0=${135e5+1e6*l} +y_0=0 +ellps=GRS80 +units=m +no_defs `}}if(a>=25&&a<=45){let l=a-25;return{epsg:"EPSG:"+(4513+l),proj:`+proj=tmerc +lat_0=0 +lon_0=${75+3*l} +k=1 +x_0=${255e5+1e6*l} +y_0=0 +ellps=GRS80 +units=m +no_defs `}}}return null}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.GeoProjection=void 0;const O=U(12),I=U(11),g=U(1),a=U(10),l=U(9);class n extends l.Projection{constructor(v){super(),this._ratio_x=1,this._ratio_y=1,this.mapExtent=typeof v=="string"?I.GeoBounds.fromString(v):v,this.setExtent(this.mapExtent)}setExtent(v){this.mapExtent=v,this._ratio_x=(l.Projection.EARTH_BOUNDS[2]-l.Projection.EARTH_BOUNDS[0])/this.mapExtent.width(),this._ratio_y=(l.Projection.EARTH_BOUNDS[3]-l.Projection.EARTH_BOUNDS[1])/this.mapExtent.height()}toMercator(v){const _=g.GeoPoint.convert(v);return[l.Projection.EARTH_BOUNDS[0]+(_.x-this.mapExtent.min.x)*this._ratio_x,l.Projection.EARTH_BOUNDS[1]+(_.y-this.mapExtent.min.y)*this._ratio_y]}fromMercator(v){const _=g.GeoPoint.convert(v);return[this.mapExtent.min.x+(_.x-l.Projection.EARTH_BOUNDS[0])/this._ratio_x,this.mapExtent.min.y+(_.y-l.Projection.EARTH_BOUNDS[1])/this._ratio_y]}toLngLat(v){if(a.isGeoPointLike(v)){const _=this.toMercator(v);return l.Projection.mercator2LngLat(_)}return O.transform.convert(v,_=>{const b=this.toMercator(_);return l.Projection.mercator2LngLat(b)})}fromLngLat(v){if(a.isGeoPointLike(v)){const _=l.Projection.lngLat2Mercator(v),b=this.fromMercator(_);return new g.GeoPoint(b[0],b[1])}return O.transform.convert(v,_=>{const b=l.Projection.lngLat2Mercator(_);return g.GeoPoint.convert(this.fromMercator(b))})}getMapExtent(){return this.mapExtent}toMeter(v){return v*l.Projection.EQUATORIAL_SEMIPERIMETER*2/this.getMapExtent().width()}fromMeter(v){return v*this.getMapExtent().width()/(2*l.Projection.EQUATORIAL_SEMIPERIMETER)}}w.GeoProjection=n},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.LnglatProjection=void 0;const O=U(11),I=U(1),g=U(10),a=U(9);class l extends a.Projection{constructor(){super(),this.mapExtent=new O.GeoBounds(new I.GeoPoint(-180,-90),new I.GeoPoint(180,90)),this.setExtent(this.mapExtent)}setExtent(u){this.mapExtent=u}toMercator(u){return a.Projection.lngLat2Mercator(u)}fromMercator(u){return a.Projection.mercator2LngLat(u)}toLngLat(u){if(g.isGeoPointLike(u)){const v=I.GeoPoint.convert(u);return[v.x,v.y]}return u}fromLngLat(u){return g.isGeoPointLike(u)?I.GeoPoint.convert(u):u}getMapExtent(){return this.mapExtent}toMeter(u){return u*a.Projection.EQUATORIAL_SEMIPERIMETER*2/this.getMapExtent().width()}fromMeter(u){return u*this.getMapExtent().width()/(2*a.Projection.EQUATORIAL_SEMIPERIMETER)}}w.LnglatProjection=l},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.coordTransfromByInvFourParamter=w.coordTransfromByFourParamter=w.coordTransfromGetFourParamter=void 0;const O=U(1);function I(n){let u=[];for(let v=0;v<n[0].length;v++){let _=[];for(let b=0;b<n.length;b++)_.push(n[b][v]);u.push(_)}return u}function g(n){if(n.length!==n[0].length)throw new Error;let u=n.length,v=0;if(u>3)for(let _=0;_<u;_++){let b=new Array(u-1).fill(0).map(M=>new Array(u-1).fill(0));for(let M=0;M<u-1;M++)for(let P=0;P<u-1;P++)b[M][P]=P<_?n[M+1][P]:n[M+1][P+1];v+=n[0][_]*Math.pow(-1,0+_)*g(b)}else u===3?v=n[0][0]*n[1][1]*n[2][2]+n[0][1]*n[1][2]*n[2][0]+n[0][2]*n[1][0]*n[2][1]-n[0][2]*n[1][1]*n[2][0]-n[0][1]*n[1][0]*n[2][2]-n[0][0]*n[1][2]*n[2][1]:u===2?v=n[0][0]*n[1][1]-n[0][1]*n[1][0]:u===1&&(v=n[0][0]);return v}function a(n){if(n[0].length!==n.length)throw new Error;let u=g(n),v=function(_){if(_[0].length!==_.length)throw new Error;let b=_.length,M=new Array(b).fill(0).map(P=>new Array(b).fill(0));for(let P=0;P<b;P++)for(let C=0;C<b;C++){let L=[];for(let D=0;D<_.length;D++)if(D!==P){let F=[];for(let j=0;j<_.length;j++)j!==C&&F.push(_[D][j]);L.push(F)}M[P][C]=Math.pow(-1,P+C)*g(L)}return I(M)}(n);for(let _=0;_<v.length;_++)for(let b=0;b<v.length;b++)v[_][b]/=u;return v}function l(n,u){if(n[0].length!==u.length)throw new Error;let v=n.length,_=n[0].length,b=u[0].length,M=new Array(v).fill(0).map(P=>new Array(b).fill(0));for(let P=0;P<v;P++)for(let C=0;C<b;C++)for(let L=0;L<_;L++)M[P][C]+=n[P][L]*u[L][C];return M}w.coordTransfromGetFourParamter=function(n,u,v){if(u.length!=n.length)throw Error("\u8F93\u5165\u70B9\u548C\u8F93\u51FA\u70B9\u5750\u6807\u957F\u5EA6\u5FC5\u987B\u4E00\u6837!");if(v)return function(de,Ee){let Pe=[],Je=[];for(let Pt=0;Pt<de.length;Pt++){Pe.push([Ee[Pt][0]-de[Pt][0]]),Pe.push([Ee[Pt][1]-de[Pt][1]]),Je.push([1,0,de[Pt][0]]),Je.push([0,1,de[Pt][1]]);let nn=[];for(let mn=0;mn<de.length;mn++)nn.push(Pt==mn?1:0)}let xt=I(Je),vt=l(xt,Je),ct=l(a(vt),xt),Rt=l(ct,Pe);return{dx:+Rt[0],dy:+Rt[1],scale:+Rt[2]+1,rotate:0}}(n.map(de=>[de.x,de.y]),u.map(de=>[de.x,de.y]));let _=u.length,b=0,M=0,P=0,C=0;for(let de=0;de<_;de++)b+=n[de].x,M+=n[de].y,P+=u[de].x,C+=u[de].y;let L=b/_,D=M/_,F=P/_,j=C/_,K=0,ee=0,Q=0;for(let de=0;de<_;de++){let Ee=n[de].x-L,Pe=n[de].y-D,Je=u[de].x-F,xt=u[de].y-j;K+=Ee*Je+Pe*xt,ee+=Ee*xt-Pe*Je,Q+=Ee*Ee+Pe*Pe}let le=Math.sqrt(K*K+ee*ee)/Q,pe=Math.atan(ee/K);return{dx:F-le*Math.cos(pe)*L+le*Math.sin(pe)*D,dy:j-le*Math.sin(pe)*L-le*Math.cos(pe)*D,scale:le,rotate:pe}},w.coordTransfromByFourParamter=function(n,u){let v=u.dx+u.scale*Math.cos(u.rotate)*n.x-u.scale*Math.sin(u.rotate)*n.y,_=u.dy+u.scale*Math.sin(u.rotate)*n.x+u.scale*Math.cos(u.rotate)*n.y;return new O.GeoPoint(v,_)},w.coordTransfromByInvFourParamter=function(n,u){let v=n.x-u.dx,_=n.y-u.dy,b=1/u.scale,M=-u.rotate,P=b*Math.cos(M)*v-b*Math.sin(M)*_,C=b*Math.sin(M)*v+b*Math.cos(M)*_;return new O.GeoPoint(P,C)}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.interpolateLineRange=w.interpolatePointsByRatio=void 0;const O=U(1),I=U(9),g=U(12);var a=U(13).MathUtils.lerp;function l(u,v){const _=u[0]-v[0],b=u[1]-v[1];return Math.sqrt(_*_+b*b)}function n(u,v,_,b){return[u[0]-_*b,u[1]+v*b]}w.interpolatePointsByRatio=function(u,v,_=!1){if(v<=0||u.length===0)return[];if(v>=1)return[...u];{const b=[];g.transform.convert(u,L=>{if(_)b.push(I.Projection.lngLat2Mercator(L));else{const D=O.GeoPoint.convert(L);b.push([D.x,D.y])}return L});let M=0;for(let L=1;L<b.length;L++)M+=l(b[L],b[L-1]);const P=M*v;M=0;const C=[b[0]];for(let L=1;L<b.length;L++){const D=l(b[L],b[L-1]);if(M+=D,!(M<=P)){const F=(D-M+P)/D;C.push([a(b[L-1][0],b[L][0],F),a(b[L-1][1],b[L][1],F)]);break}C.push(b[L])}if(!_)return C;{const L=[];g.transform.convert(C,D=>(L.push(I.Projection.mercator2LngLat(D)),D))}}},w.interpolateLineRange=function(u,v,_=!1,b=0,M=0,P=!0){const C=[];g.transform.convert(u,de=>{let Ee;if(_)Ee=I.Projection.lngLat2Mercator(de);else{const Pe=O.GeoPoint.convert(de);Ee=[Pe.x,Pe.y]}if(C.length>0){let Pe=C.length-1;Math.abs(C[Pe][1]-Ee[1])<1e-8&&Math.abs(C[Pe][0]-Ee[0])<1e-8||C.push(Ee)}else C.push(Ee);return de}),M=M||0,b=b||0;let L=0;const D=[0],F=[];for(let de=1;de<C.length;de++){const Ee=l(C[de],C[de-1]);L+=Ee,F.push(b/Ee),D.push(L)}L/(v-1)<M&&(v=L/M+1);const j=L/(v-1),K=[n(C[0],C[1][0]-C[0][0],C[1][1]-C[0][1],F[0])];let ee=0,Q=0,le=C[0],pe=j;for(let de=0;de<v-2;de++){for(;pe>D[ee+1];)ee++,Q=D[ee],le=C[ee],P&&K.push(n(C[ee],C[ee][0]-C[ee-1][0],C[ee][1]-C[ee-1][1],F[ee]));const Ee=pe-Q,Pe=C[ee+1][0]-C[ee][0],Je=C[ee+1][1]-C[ee][1],xt=Ee/(D[ee+1]-D[ee]);le=[le[0]+Pe*xt,le[1]+Je*xt],K.push(n(le,Pe,Je,F[ee])),Q=pe,pe+=j}if(P)for(let de=ee+1;de<C.length-1;de++)K.push(n(C[de],C[de][0]-C[de-1][0],C[de][1]-C[de-1][1],F[de]));if(K.push(n(C[C.length-1],C[C.length-1][0]-C[C.length-2][0],C[C.length-1][1]-C[C.length-2][1],F[F.length-1])),_){const de=[];return g.transform.convert(K,Ee=>(de.push(I.Projection.mercator2LngLat(Ee)),Ee)),de}return K}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.getEllipseFeature=w.getEllipsePolygonCoordinates=w.getCircleFeature=w.getCirclePolygonCoordinates=void 0;const O=U(1);var I=U(13).MathUtils.wrap;function g(l,n,u=360,v=0,_=360,b=!0){const M=O.GeoPoint.convert(l),P=[];v=I(v,0,360,!0),(_=I(_,0,360))<v&&(_+=360);const C=(_-v)/u;for(let L=0;L<u+1;L++){const D=Math.PI/180*(v+L*C),F=M.x+n*Math.cos(D),j=M.y+n*Math.sin(D);P.push([F,j])}return b&&_-v!=360&&P.push([M.x,M.y]),P}function a(l,n,u,v=360,_=0,b=360,M=!0){const P=O.GeoPoint.convert(l),C=[];_=I(_,0,360,!0),(b=I(b,0,360))<_&&(b+=360);const L=(b-_)/v;for(let D=0;D<v+1;D++){const F=Math.PI/180*(_+D*L),j=P.x+n*Math.cos(F),K=P.y+u*Math.sin(F);C.push([j,K])}return M&&b-_!=360&&C.push([P.x,P.y]),C}w.getCirclePolygonCoordinates=g,w.getCircleFeature=function(l,n,u=360,v=0,_=360,b=!0){return{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[g(l,n,u)]}}},w.getEllipsePolygonCoordinates=a,w.getEllipseFeature=function(l,n,u,v=360,_=0,b=360,M=!0){return{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[a(l,n,u,v)]}}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.buildTransformerMatrix3d=w.buildTransformer=void 0;const O=Math.log(2);function I(a,l,n,u,v,_){const b=u+"-"+v,M=a.length;if(_.hasOwnProperty(b))return _[b];if(l===1){const D=Math.round(Math.log((1<<M)-1&~v)/O);return a[n][D]}const P=u|1<<n;let C=n+1;for(;u&1<<C;)C++;let L=0;for(let D=0,F=0;D<M;D++){const j=1<<D;j&v||(L+=(F%2?-1:1)*a[n][D]*I(a,l-1,C,P,v|j,_),F++)}return _[b]=L,L}function g(a,l){const n=[[a[0],a[1],1,0,0,0,-l[0]*a[0],-l[0]*a[1]],[0,0,0,a[0],a[1],1,-l[1]*a[0],-l[1]*a[1]],[a[2],a[3],1,0,0,0,-l[2]*a[2],-l[2]*a[3]],[0,0,0,a[2],a[3],1,-l[3]*a[2],-l[3]*a[3]],[a[4],a[5],1,0,0,0,-l[4]*a[4],-l[4]*a[5]],[0,0,0,a[4],a[5],1,-l[5]*a[4],-l[5]*a[5]],[a[6],a[7],1,0,0,0,-l[6]*a[6],-l[6]*a[7]],[0,0,0,a[6],a[7],1,-l[7]*a[6],-l[7]*a[7]]],u={},v=I(n,8,0,0,0,u);if(v===0)return;const _=[];for(let b=0;b<8;b++)for(let M=0;M<8;M++)_[M]==null&&(_[M]=0),_[M]+=((b+M)%2?-1:1)*I(n,7,b===0?1:0,1<<b,1<<M,u)/v*l[b];return _}w.buildTransformer=g,w.buildTransformerMatrix3d=function(a,l){const n=g(a,l);if(!!n)return`matrix3d(${[n[0],n[3],0,n[6],n[1],n[4],0,n[7],0,0,1,0,n[2],n[5],0,1].join(",")})`}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.offsetPoints=w.offsetPointLine=void 0;const O=U(1),I=U(17);function g(b,M){if(b&&!(b.length<1))for(var P=1,C=b.length;P<C;P++)M(b[P-1],b[P])}function a(b,M){if(b.x===M.x)return b.y===M.y?null:{x:b.x};const P=(M.y-b.y)/(M.x-b.x);return{a:P,b:b.y-P*b.x}}function l(b,M,P,C){const L=a(b,M),D=a(P,C);if(L===null||D===null)return null;if(L.hasOwnProperty("x"))return D.hasOwnProperty("x")?null:{x:L.x,y:D.a*L.x+D.b};if(D.hasOwnProperty("x"))return{x:D.x,y:L.a*D.x+L.b};if(L.a===D.a)return null;const F=(D.b-L.b)/(L.a-D.a);return{x:F,y:L.a*F+L.b}}function n(b,M,P){return{x:b.x+M*Math.cos(P),y:b.y+M*Math.sin(P)}}function u(b,M){const P=[];return g(b,(C,L)=>{if(C.x===L.x&&C.y===L.y)return;const D=Math.atan2(C.y-L.y,C.x-L.x)-Math.PI/2;P.push({offsetAngle:D,original:[C,L],offset:[n(C,M,D),n(L,M,D)]})}),P}function v(b){return{x:b[1].x-b[0].x,y:b[1].y-b[0].y}}function _(b,M){const P=v(b),C=v(M);return Math.atan2(P.x*C.y-P.y*C.x,P.x*C.x+P.y*C.y)}w.offsetPointLine=u,w.offsetPoints=function(b,M){const P=b.map(C=>O.GeoPoint.convert(C));return function(C,L){let D=[];const F=C[0],j=C[C.length-1];return F&&j&&(D.push(F.offset[0]),g(C,(K,ee)=>{D=D.concat(function(Q,le,pe){return function(de,Ee,Pe){if(de.offsetAngle===Ee.offsetAngle)return[de.offset[1]];const Je=_(de.offset,Ee.offset);if(Je*Pe>0&&Je*_(de.offset,[de.offset[0],Ee.offset[1]])>0)return[l(de.offset[0],de.offset[1],Ee.offset[0],Ee.offset[1])];const xt=[],vt=de.original[1],ct=Pe>0,Rt=ct?Ee.offsetAngle:de.offsetAngle;let Pt=ct?de.offsetAngle:Ee.offsetAngle;Pt<Rt&&(Pt+=2*Math.PI);const nn=Math.PI/8;for(var mn=Rt;mn<Pt;mn+=nn)xt.push(n(vt,Pe,mn));return xt.push(n(vt,Pe,Pt)),ct?xt.reverse():xt}(Q,le,pe).filter(function(de){return de})}(K,ee,L))}),D.push(j.offset[1])),D}(u(I.simplify(P,M==null?void 0:M.smoothFactor),M.offset),M.offset)}},function(he,w,U){function O(I,g){I+=1;const a=(g=g!=null?g:0)*(Math.PI/180);return 400750166855784e-7*Math.cos(a)/Math.pow(2,I+8)}Object.defineProperty(w,"__esModule",{value:!0}),w.pixelValue=w.metersPerPixel=void 0,w.metersPerPixel=O,w.pixelValue=function(I,g,a){return I/O(a=a!=null?a:0,g+=1)}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.isPointInPolygon=w.polygonCentroid=w.polygonIsClockwise=w.calcPolygonArea=void 0;const O=U(1);w.calcPolygonArea=function(I){const g=[];for(const n of I)g.push(n.x),g.push(n.y);let a=0,l=0;for(let n=0;n<g.length;n+=2)a=(n+2)%g.length,l+=g[n]*g[a+1],l-=g[n+1]*g[a];return l/=2,l<0?-l:l},w.polygonIsClockwise=function(I){if(I==null||I.length===0)return!0;let g=0;for(let a=0;a<I.length-1;++a)g+=-.5*(I[a+1].y+I[a].y)*(I[a+1].x-I[a].x);return g+=-.5*(I[0].y+I[I.length-1].y)*(I[0].x-I[I.length-1].x),g<0},w.polygonCentroid=function(I){const g=[0,0];let a=0;for(let v=0;v<I.length-1;v+=1){const _=I[v].x,b=I[v].y,M=I[v+1].x,P=I[v+1].y,C=_*P-M*b;a+=C,g[0]+=(_+M)*C,g[1]+=(b+P)*C}const l=I[0],n=I[I.length-1],u=l.x*n.y-n.x*l.y;return a+=u,g[0]+=(l.x+n.x)*u,g[1]+=(l.y+n.y)*u,a*=.5,g[0]/=6*a,g[1]/=6*a,new O.GeoPoint(g[0],g[1])},w.isPointInPolygon=(I,g)=>{const a=[],l=[];g.forEach(M=>{a.push(M.x),l.push(M.y)});const{x:n,y:u}=I,v=a.length;let _=v-1,b=0;for(let M=0;M<v;M++)(l[M]<=u&&u<l[_]||l[_]<=u&&u<l[M])&&n>(a[_]-a[M])*(u-l[M])/(l[_]-l[M])+a[M]&&(b=!b),_=M;return!!b}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.findShortestPath=w.buildTopoGraph=w.Graph=void 0;const O=U(1),I=U(18);var g=I.Math2D.lineDist;const a=U(17);class l extends Error{constructor(_){super(_),Object.setPrototypeOf(this,l.prototype)}}function n(v){const _={addNode:P,removeNode:function(pe){return Object.keys(b).forEach(function(de){b[de].forEach(function(Ee){Ee===pe&&ee(de,Ee)})}),delete b[pe],_},nodes:C,adjacent:L,addEdge:K,removeEdge:ee,hasEdge:function(pe,de){return L(pe).includes(de)},setEdgeWeight:F,getEdgeWeight:j,indegree:function(pe){let de=0;function Ee(Pe){Pe===pe&&de++}return Object.keys(b).forEach(function(Pe){b[Pe].forEach(Ee)}),de},outdegree:function(pe){return pe in b?b[pe].length:0},depthFirstSearch:Q,hasCycle:function(){try{return Q(void 0,!0,!0),!1}catch(pe){if(pe instanceof l)return!0;throw pe}},lowestCommonAncestors:function(pe,de){const Ee=[],Pe=[];return function Je(xt,vt){return!!xt[vt]||(xt[vt]=!0,Ee.push(vt),vt===de?(Pe.push(vt),!1):L(vt).every(ct=>Je(xt,ct)))}({},pe)&&function Je(xt,vt){xt[vt]||(xt[vt]=!0,Ee.includes(vt)?Pe.push(vt):Pe.length===0&&L(vt).forEach(ct=>{Je(xt,ct)}))}({},de),Pe},topologicalSort:function(pe,de=!0){return Q(pe,de,!0).reverse()},shortestPath:function(pe,de){const Ee={},Pe={};let Je={};function xt(){let ct,Rt=1/0;return Object.keys(Je).forEach(function(Pt){Ee[Pt]<Rt&&(Rt=Ee[Pt],ct=Pt)}),ct===void 0?(Je={},null):(delete Je[ct],ct)}function vt(ct,Rt){const Pt=j(ct,Rt);Ee[Rt]>Ee[ct]+Pt&&(Ee[Rt]=Ee[ct]+Pt,Pe[Rt]=ct)}return function(){for(function(){if(C().forEach(function(ct){Ee[ct]=1/0}),Ee[pe]!==1/0)throw new Error("Source node is not in the graph");if(Ee[de]!==1/0)throw new Error("Destination node is not in the graph");Ee[pe]=0}(),C().forEach(function(ct){Je[ct]=!0});Object.keys(Je).length!==0;){const ct=xt();if(ct===null)return;L(ct).forEach(function(Rt){vt(ct,Rt)})}}(),function(){const ct=[];let Rt=0,Pt=de;for(;Pe[Pt];)ct.push(Pt),Rt+=j(Pe[Pt],Pt),Pt=Pe[Pt];if(Pt!==pe)throw new Error("No path found");return ct.push(Pt),ct.reverse(),ct.weight=Rt,ct}()},serialize:function(){const pe={nodes:C().map(function(de){return{id:de}}),links:[]};return pe.nodes.forEach(function(de){const Ee=de.id;L(Ee).forEach(function(Pe){pe.links.push({source:Ee,target:Pe,weight:j(Ee,Pe)})})}),pe},deserialize:le},b={},M={};function P(pe){return b[pe]=L(pe),_}function C(){const pe={};return Object.keys(b).forEach(function(de){pe[de]=!0,b[de].forEach(function(Ee){pe[Ee]=!0})}),Object.keys(pe)}function L(pe){return b[pe]||[]}function D(pe,de){return pe+"|"+de}function F(pe,de,Ee){return M[D(pe,de)]=Ee,_}function j(pe,de){const Ee=M[D(pe,de)];return Ee===void 0?1:Ee}function K(pe,de,Ee){return P(pe),P(de),L(pe).push(de),Ee!==void 0&&F(pe,de,Ee),_}function ee(pe,de){return b[pe]&&(b[pe]=L(pe).filter(function(Ee){return Ee!==de})),_}function Q(pe,de=!0,Ee=!1){pe||(pe=C()),typeof de!="boolean"&&(de=!0);const Pe={},Je={},xt=[];function vt(ct){if(Je[ct]&&Ee)throw new l("Cycle found");Pe[ct]||(Pe[ct]=!0,Je[ct]=!0,L(ct).forEach(vt),Je[ct]=!1,xt.push(ct))}return de?pe.forEach(vt):(pe.forEach(function(ct){Pe[ct]=!0}),pe.forEach(function(ct){L(ct).forEach(vt)})),xt}function le(pe){return pe.nodes.forEach(function(de){P(de.id)}),pe.links.forEach(function(de){K(de.source,de.target,de.weight)}),_}return v&&le(v),_}function u(v,_,b){var M,P;_=_!=null?_:6,b=b!=null&&b;const C=j=>j.roundStr(_),L=n(),D={},F={edges:{},inputNodes:{},outputNodes:{}};for(let j=0;j<v.length;j++){const K=j+1;if(v[j].id=(M=v[j].id)!==null&&M!==void 0?M:j+1+"",D[v[j].id]=K,v[j].weight=(P=v[j].weight)!==null&&P!==void 0?P:g(v[j].points),v[j].points.length<2)throw Error(`index ${j}, id: ${v[j].id} points length is ${v[j].points.length}, must large two`);const ee=v[j].points[0],Q=v[j].points[v[j].points.length-1],le=C(ee),pe=C(Q);L.addEdge(le,pe,v[j].weight);let de=`${le}_${pe}`;F.edges[de]=F.edges[de]||[],F.edges[de].push(K),F.outputNodes[le]=F.outputNodes[le]||[],F.outputNodes[le].push(K),F.inputNodes[pe]=F.inputNodes[pe]||[],F.inputNodes[pe].push(K),b||(L.addEdge(pe,le,v[j].weight),de=`${pe}_${le}`,F.edges[de]=F.edges[de]||[],F.edges[de].push(-K),F.outputNodes[pe]=F.outputNodes[pe]||[],F.outputNodes[pe].push(K),F.inputNodes[le]=F.inputNodes[le]||[],F.inputNodes[le].push(K))}return{graph:L,topo:F}}w.Graph=n,w.buildTopoGraph=u,w.findShortestPath=function(v,_,b,M,P){const C=O.GeoPoint.convert(v),L=O.GeoPoint.convert(_),D=b.map(le=>le.points),F=(le,pe)=>{const de=le[pe.closestIndex],Ee=[],Pe=[];for(let Je=0;Je<de.length;Je++)Je<pe.closestPointIndex?Ee.push(de[Je]):Je===pe.closestPointIndex?(Ee.push(de[Je]),Ee.push(pe.closestPoint),Pe.push(pe.closestPoint)):Pe.push(de[Je]);le[pe.closestIndex]=Ee,le.push(Pe)},j=(le,pe,de,Ee)=>{const Pe=de.edges[`${le}_${pe}`],Je=le.split(","),xt=new O.GeoPoint(+Je[0],+Je[1]),vt=pe.split(","),ct=new O.GeoPoint(+vt[0],+vt[1]);if(Pe.length===0)return{points:[xt,ct],index:-1,reverse:!1};{Pe.length>1&&Pe.sort((Pt,nn)=>I.Math2D.lineDist(Ee[Math.abs(Pt)-1])-I.Math2D.lineDist(Ee[Math.abs(nn)-1]));let Rt=Pe[0];return Rt>=0?{points:[...Ee[Rt-1]],index:Rt,reverse:!1}:(Rt=-Rt,{points:[...Ee[Rt-1].reverse()],index:Rt,reverse:!0})}},K=a.closestPointOnPolylines(C,D),ee=a.closestPointOnPolylines(L,D),Q=[...D];K.closestIndex!==ee.closestIndex?(F(Q,K),F(Q,ee)):((le,pe,de,Ee)=>{const Pe=le[pe];let Je=!1,xt=de,vt=Ee;Ee.closestPointIndex<de.closestPointIndex&&(Je=!0),Ee.closestPointIndex===de.closestPointIndex&&Ee.closestPrePointDist<de.closestPrePointDist&&(Je=!0),Je&&(xt=Ee,vt=de);const ct=[],Rt=[],Pt=[];for(let nn=0;nn<Pe.length;nn++)nn<xt.closestPointIndex?ct.push(Pe[nn]):nn===xt.closestPointIndex?(ct.push(Pe[nn]),ct.push(xt.closestPoint),Rt.push(xt.closestPoint),nn===vt.closestPointIndex&&(Rt.push(vt.closestPoint),Pt.push(vt.closestPoint))):nn<vt.closestPointIndex?Rt.push(Pe[nn]):nn===vt.closestPointIndex?(Rt.push(Pe[nn]),Rt.push(vt.closestPoint),Pt.push(vt.closestPoint)):Pt.push(Pe[nn]);le[pe.closestIndex]=ct,le.push(Rt),le.push(Pt)})(Q,K.closestIndex,K,ee);try{const le=u(Q.map(Pe=>({points:Pe}))),pe=le.graph.shortestPath(K.closestPoint.roundStr(),ee.closestPoint.roundStr()),de=[],Ee=[];for(let Pe=1;Pe<pe.length;Pe++){const Je=j(pe[Pe-1],pe[Pe],le.topo,Q);Pe===1?de.push(...Je.points):de.push(...Je.points.slice(1)),Ee.push(Je)}return{startPoint:K,endPoint:ee,route:de,routeDetail:Ee}}catch(le){return{error:le}}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.polylineToBezierCurve=w.getBezierCurveLength=w.bezierCurveToPolyline=void 0;const O=U(86);Object.defineProperty(w,"bezierCurveToPolyline",{enumerable:!0,get:function(){return O.bezierCurveToPolyline}}),Object.defineProperty(w,"getBezierCurveLength",{enumerable:!0,get:function(){return O.getBezierCurveLength}});const I=U(87);Object.defineProperty(w,"polylineToBezierCurve",{enumerable:!0,get:function(){return I.polylineToBezierCurve}})},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.getBezierCurveLength=w.bezierCurveToPolyline=void 0;function O(M){return M.reduce((P,C)=>P+C,0)}function I(M){return M.reduce((P,C)=>[...P,...C],[])}function g(M){const P=function(L){return L.slice(1)}(M),C=function(L){return L[0]}(M);return P.map((L,D)=>function(F,j,K,ee){const Q=new Map([]);return le=>{if(Q.has(le))return Q.get(le);const pe=1-le,de=Math.pow(pe,3),Ee=Math.pow(pe,2),Pe=Math.pow(le,3),Je=Math.pow(le,2),xt=[F[0]*de+3*j[0]*le*Ee+3*K[0]*Je*pe+ee[0]*Pe,F[1]*de+3*j[1]*le*Ee+3*K[1]*Je*pe+ee[1]*Pe];return Q.set(le,xt),xt}}(D===0?C:P[D-1][2],...L))}function a(M,P){return M.map((C,L)=>{const D=1/(P[L]-1);return new Array(P[L]).fill(0).map((F,j)=>C(j*D))})}function l(M){return new Array(M.length-1).fill(0).map((P,C)=>function([L,D],[F,j]){return Math.sqrt(Math.pow(L-F,2)+Math.pow(D-j,2))}(M[C],M[C+1]))}function n(M){const P=function(j){return j.map(l)}(M),C=O(P.map(({length:j})=>j)),L=P.map(O),D=O(L),F=D/C;return{totalLength:D,segmentLength:L,avgDistance:F,deviation:function(j,K){return O(j.map(ee=>ee.map(Q=>Math.abs(Q-K))).map(O))}(P,F)}}function u(M){return I(M).length}function v(M,P,C,L){let D=n(M);return D.deviation<=C?I(M):(M=function(F,j,{avgDistance:K,totalLength:ee,segmentLength:Q},le){let pe=u(F);return pe=Math.ceil(K/le*pe*1.1),a(j,Q.map(de=>Math.ceil(de/ee*pe)).map(de=>de>1?de:2))}(M,P,D,C),L<=0?I(M):(D=n(M),I(M=function(F,j,{avgDistance:K},ee){const Q=1/u(F)/10;return j.forEach((le,pe)=>{const de=F[pe].length,Ee=1/(de-1),Pe=new Array(de).fill(0).map((Je,xt)=>xt*Ee);for(let Je=0;Je<ee;Je++){const xt=l(F[pe]).map(ct=>ct-K);let vt=0;for(let ct=0;ct<de;ct++)ct!==0&&(vt+=xt[ct-1],Pe[ct]-=Q*vt,Pe[ct]>1&&(Pe[ct]=1),Pe[ct]<0&&(Pe[ct]=0),F[pe][ct]=le(Pe[ct]))}}),F}(M,P,D,L))))}function _(M,P=5,C=0){const L=g(M),D=v(function(j){const{length:K}=j;return a(j,new Array(K).fill(50))}(L),L,P,C),F=function(j){return j.slice(-1)[0][2]}(M);return D.push(F),D}function b(M,P=5,C=0){if(!(M instanceof Array))throw new Error("bezierCurveToPolyline: Invalid input of "+M);if(M.length<=1)throw new Error("bezierCurveToPolyline: The length of the bezierCurve should be greater than 1");if(typeof P!="number")throw new Error("bezierCurveToPolyline: Type of precision must be number");return _(M,P,C)}w.bezierCurveToPolyline=b,w.getBezierCurveLength=function(M,P=5,C=0){return O(l(b(M,P,C)))},w.default=b},function(he,w,U){function O(g,a,l=!1,n=.25,u=.25){const v=g.length;if(v<3||a>=v)return null;let _=a-1;_<0&&(_=l?v+_:0);let b=a+1;b>=v&&(b=l?b-v:v-1);let M=a+2;M>=v&&(M=l?M-v:v-1);const P=g[_],C=g[a],L=g[b],D=g[M];return[[C[0]+n*(L[0]-P[0]),C[1]+n*(L[1]-P[1])],[L[0]-u*(D[0]-C[0]),L[1]-u*(D[1]-C[1])]]}function I([g,a],[l,n]){return[l+(l-g),n+(n-a)]}Object.defineProperty(w,"__esModule",{value:!0}),w.polylineToBezierCurve=void 0,w.polylineToBezierCurve=function(g,a=!1,l=.25,n=.25){if(!(g instanceof Array))throw new Error("polylineToBezierCurve: Invalid input of "+g);if(g.length<=2)throw new Error("polylineToBezierCurve: The length of the polyline should be greater than 2");const u=g[0],v=g.length-1,_=new Array(v).fill(0).map((b,M)=>[...O(g,M,a,l,n),g[M+1]]);return a&&function(b,M){const P=b[0],C=b.slice(-1)[0];b.push([I(C[1],C[2]),I(P[0],M),M])}(_,u),_.unshift(g[0]),_}},function(he,w,U){var O=this&&this.__createBinding||(Object.create?function(g,a,l,n){n===void 0&&(n=l),Object.defineProperty(g,n,{enumerable:!0,get:function(){return a[l]}})}:function(g,a,l,n){n===void 0&&(n=l),g[n]=a[l]}),I=this&&this.__exportStar||function(g,a){for(var l in g)l==="default"||a.hasOwnProperty(l)||O(a,g,l)};Object.defineProperty(w,"__esModule",{value:!0}),I(U(7),w),I(U(39),w),I(U(89),w),I(U(90),w),I(U(40),w),I(U(41),w),I(U(91),w),I(U(92),w),I(U(93),w)},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.mat4=void 0;const O=U(7);(function(I){function g(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}I.create=function(){const a=new Float32Array(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},I.clone=function(a){const l=new Float32Array(16);return l[0]=a[0],l[1]=a[1],l[2]=a[2],l[3]=a[3],l[4]=a[4],l[5]=a[5],l[6]=a[6],l[7]=a[7],l[8]=a[8],l[9]=a[9],l[10]=a[10],l[11]=a[11],l[12]=a[12],l[13]=a[13],l[14]=a[14],l[15]=a[15],l},I.copy=function(a,l){return a[0]=l[0],a[1]=l[1],a[2]=l[2],a[3]=l[3],a[4]=l[4],a[5]=l[5],a[6]=l[6],a[7]=l[7],a[8]=l[8],a[9]=l[9],a[10]=l[10],a[11]=l[11],a[12]=l[12],a[13]=l[13],a[14]=l[14],a[15]=l[15],a},I.fromValues=function(a,l,n,u,v,_,b,M,P,C,L,D,F,j,K,ee){const Q=new Float32Array(16);return Q[0]=a,Q[1]=l,Q[2]=n,Q[3]=u,Q[4]=v,Q[5]=_,Q[6]=b,Q[7]=M,Q[8]=P,Q[9]=C,Q[10]=L,Q[11]=D,Q[12]=F,Q[13]=j,Q[14]=K,Q[15]=ee,Q},I.set=function(a,l,n,u,v,_,b,M,P,C,L,D,F,j,K,ee,Q){return a[0]=l,a[1]=n,a[2]=u,a[3]=v,a[4]=_,a[5]=b,a[6]=M,a[7]=P,a[8]=C,a[9]=L,a[10]=D,a[11]=F,a[12]=j,a[13]=K,a[14]=ee,a[15]=Q,a},I.identity=g,I.transpose=function(a,l){if(a===l){const n=l[1],u=l[2],v=l[3],_=l[6],b=l[7],M=l[11];a[1]=l[4],a[2]=l[8],a[3]=l[12],a[4]=n,a[6]=l[9],a[7]=l[13],a[8]=u,a[9]=_,a[11]=l[14],a[12]=v,a[13]=b,a[14]=M}else a[0]=l[0],a[1]=l[4],a[2]=l[8],a[3]=l[12],a[4]=l[1],a[5]=l[5],a[6]=l[9],a[7]=l[13],a[8]=l[2],a[9]=l[6],a[10]=l[10],a[11]=l[14],a[12]=l[3],a[13]=l[7],a[14]=l[11],a[15]=l[15];return a},I.invert=function(a,l){const n=l[0],u=l[1],v=l[2],_=l[3],b=l[4],M=l[5],P=l[6],C=l[7],L=l[8],D=l[9],F=l[10],j=l[11],K=l[12],ee=l[13],Q=l[14],le=l[15],pe=n*M-u*b,de=n*P-v*b,Ee=n*C-_*b,Pe=u*P-v*M,Je=u*C-_*M,xt=v*C-_*P,vt=L*ee-D*K,ct=L*Q-F*K,Rt=L*le-j*K,Pt=D*Q-F*ee,nn=D*le-j*ee,mn=F*le-j*Q;let cn=pe*mn-de*nn+Ee*Pt+Pe*Rt-Je*ct+xt*vt;return cn?(cn=1/cn,a[0]=(M*mn-P*nn+C*Pt)*cn,a[1]=(v*nn-u*mn-_*Pt)*cn,a[2]=(ee*xt-Q*Je+le*Pe)*cn,a[3]=(F*Je-D*xt-j*Pe)*cn,a[4]=(P*Rt-b*mn-C*ct)*cn,a[5]=(n*mn-v*Rt+_*ct)*cn,a[6]=(Q*Ee-K*xt-le*de)*cn,a[7]=(L*xt-F*Ee+j*de)*cn,a[8]=(b*nn-M*Rt+C*vt)*cn,a[9]=(u*Rt-n*nn-_*vt)*cn,a[10]=(K*Je-ee*Ee+le*pe)*cn,a[11]=(D*Ee-L*Je-j*pe)*cn,a[12]=(M*ct-b*Pt-P*vt)*cn,a[13]=(n*Pt-u*ct+v*vt)*cn,a[14]=(ee*de-K*Pe-Q*pe)*cn,a[15]=(L*Pe-D*de+F*pe)*cn,a):null},I.adjoint=function(a,l){const n=l[0],u=l[1],v=l[2],_=l[3],b=l[4],M=l[5],P=l[6],C=l[7],L=l[8],D=l[9],F=l[10],j=l[11],K=l[12],ee=l[13],Q=l[14],le=l[15];return a[0]=M*(F*le-j*Q)-D*(P*le-C*Q)+ee*(P*j-C*F),a[1]=-(u*(F*le-j*Q)-D*(v*le-_*Q)+ee*(v*j-_*F)),a[2]=u*(P*le-C*Q)-M*(v*le-_*Q)+ee*(v*C-_*P),a[3]=-(u*(P*j-C*F)-M*(v*j-_*F)+D*(v*C-_*P)),a[4]=-(b*(F*le-j*Q)-L*(P*le-C*Q)+K*(P*j-C*F)),a[5]=n*(F*le-j*Q)-L*(v*le-_*Q)+K*(v*j-_*F),a[6]=-(n*(P*le-C*Q)-b*(v*le-_*Q)+K*(v*C-_*P)),a[7]=n*(P*j-C*F)-b*(v*j-_*F)+L*(v*C-_*P),a[8]=b*(D*le-j*ee)-L*(M*le-C*ee)+K*(M*j-C*D),a[9]=-(n*(D*le-j*ee)-L*(u*le-_*ee)+K*(u*j-_*D)),a[10]=n*(M*le-C*ee)-b*(u*le-_*ee)+K*(u*C-_*M),a[11]=-(n*(M*j-C*D)-b*(u*j-_*D)+L*(u*C-_*M)),a[12]=-(b*(D*Q-F*ee)-L*(M*Q-P*ee)+K*(M*F-P*D)),a[13]=n*(D*Q-F*ee)-L*(u*Q-v*ee)+K*(u*F-v*D),a[14]=-(n*(M*Q-P*ee)-b*(u*Q-v*ee)+K*(u*P-v*M)),a[15]=n*(M*F-P*D)-b*(u*F-v*D)+L*(u*P-v*M),a},I.determinant=function(a){const l=a[0],n=a[1],u=a[2],v=a[3],_=a[4],b=a[5],M=a[6],P=a[7],C=a[8],L=a[9],D=a[10],F=a[11],j=a[12],K=a[13],ee=a[14],Q=a[15];return(l*b-n*_)*(D*Q-F*ee)-(l*M-u*_)*(L*Q-F*K)+(l*P-v*_)*(L*ee-D*K)+(n*M-u*b)*(C*Q-F*j)-(n*P-v*b)*(C*ee-D*j)+(u*P-v*M)*(C*K-L*j)},I.multiply=function(a,l,n){const u=l[0],v=l[1],_=l[2],b=l[3],M=l[4],P=l[5],C=l[6],L=l[7],D=l[8],F=l[9],j=l[10],K=l[11],ee=l[12],Q=l[13],le=l[14],pe=l[15];let de=n[0],Ee=n[1],Pe=n[2],Je=n[3];return a[0]=de*u+Ee*M+Pe*D+Je*ee,a[1]=de*v+Ee*P+Pe*F+Je*Q,a[2]=de*_+Ee*C+Pe*j+Je*le,a[3]=de*b+Ee*L+Pe*K+Je*pe,de=n[4],Ee=n[5],Pe=n[6],Je=n[7],a[4]=de*u+Ee*M+Pe*D+Je*ee,a[5]=de*v+Ee*P+Pe*F+Je*Q,a[6]=de*_+Ee*C+Pe*j+Je*le,a[7]=de*b+Ee*L+Pe*K+Je*pe,de=n[8],Ee=n[9],Pe=n[10],Je=n[11],a[8]=de*u+Ee*M+Pe*D+Je*ee,a[9]=de*v+Ee*P+Pe*F+Je*Q,a[10]=de*_+Ee*C+Pe*j+Je*le,a[11]=de*b+Ee*L+Pe*K+Je*pe,de=n[12],Ee=n[13],Pe=n[14],Je=n[15],a[12]=de*u+Ee*M+Pe*D+Je*ee,a[13]=de*v+Ee*P+Pe*F+Je*Q,a[14]=de*_+Ee*C+Pe*j+Je*le,a[15]=de*b+Ee*L+Pe*K+Je*pe,a},I.translate=function(a,l,n){const u=n[0],v=n[1],_=n[2];let b,M,P,C,L,D,F,j,K,ee,Q,le;return l===a?(a[12]=l[0]*u+l[4]*v+l[8]*_+l[12],a[13]=l[1]*u+l[5]*v+l[9]*_+l[13],a[14]=l[2]*u+l[6]*v+l[10]*_+l[14],a[15]=l[3]*u+l[7]*v+l[11]*_+l[15]):(b=l[0],M=l[1],P=l[2],C=l[3],L=l[4],D=l[5],F=l[6],j=l[7],K=l[8],ee=l[9],Q=l[10],le=l[11],a[0]=b,a[1]=M,a[2]=P,a[3]=C,a[4]=L,a[5]=D,a[6]=F,a[7]=j,a[8]=K,a[9]=ee,a[10]=Q,a[11]=le,a[12]=b*u+L*v+K*_+l[12],a[13]=M*u+D*v+ee*_+l[13],a[14]=P*u+F*v+Q*_+l[14],a[15]=C*u+j*v+le*_+l[15]),a},I.scale=function(a,l,n){const u=n[0],v=n[1],_=n[2];return a[0]=l[0]*u,a[1]=l[1]*u,a[2]=l[2]*u,a[3]=l[3]*u,a[4]=l[4]*v,a[5]=l[5]*v,a[6]=l[6]*v,a[7]=l[7]*v,a[8]=l[8]*_,a[9]=l[9]*_,a[10]=l[10]*_,a[11]=l[11]*_,a[12]=l[12],a[13]=l[13],a[14]=l[14],a[15]=l[15],a},I.rotate=function(a,l,n,u){let v=u[0],_=u[1],b=u[2],M=Math.sqrt(v*v+_*_+b*b);if(Math.abs(M)<O.EPSILON)return null;M=1/M,v*=M,_*=M,b*=M;const P=Math.sin(n),C=Math.cos(n),L=1-C,D=l[0],F=l[1],j=l[2],K=l[3],ee=l[4],Q=l[5],le=l[6],pe=l[7],de=l[8],Ee=l[9],Pe=l[10],Je=l[11],xt=v*v*L+C,vt=_*v*L+b*P,ct=b*v*L-_*P,Rt=v*_*L-b*P,Pt=_*_*L+C,nn=b*_*L+v*P,mn=v*b*L+_*P,cn=_*b*L-v*P,ht=b*b*L+C;return a[0]=D*xt+ee*vt+de*ct,a[1]=F*xt+Q*vt+Ee*ct,a[2]=j*xt+le*vt+Pe*ct,a[3]=K*xt+pe*vt+Je*ct,a[4]=D*Rt+ee*Pt+de*nn,a[5]=F*Rt+Q*Pt+Ee*nn,a[6]=j*Rt+le*Pt+Pe*nn,a[7]=K*Rt+pe*Pt+Je*nn,a[8]=D*mn+ee*cn+de*ht,a[9]=F*mn+Q*cn+Ee*ht,a[10]=j*mn+le*cn+Pe*ht,a[11]=K*mn+pe*cn+Je*ht,l!==a&&(a[12]=l[12],a[13]=l[13],a[14]=l[14],a[15]=l[15]),a},I.rotateX=function(a,l,n){const u=Math.sin(n),v=Math.cos(n),_=l[4],b=l[5],M=l[6],P=l[7],C=l[8],L=l[9],D=l[10],F=l[11];return l!==a&&(a[0]=l[0],a[1]=l[1],a[2]=l[2],a[3]=l[3],a[12]=l[12],a[13]=l[13],a[14]=l[14],a[15]=l[15]),a[4]=_*v+C*u,a[5]=b*v+L*u,a[6]=M*v+D*u,a[7]=P*v+F*u,a[8]=C*v-_*u,a[9]=L*v-b*u,a[10]=D*v-M*u,a[11]=F*v-P*u,a},I.rotateY=function(a,l,n){const u=Math.sin(n),v=Math.cos(n),_=l[0],b=l[1],M=l[2],P=l[3],C=l[8],L=l[9],D=l[10],F=l[11];return l!==a&&(a[4]=l[4],a[5]=l[5],a[6]=l[6],a[7]=l[7],a[12]=l[12],a[13]=l[13],a[14]=l[14],a[15]=l[15]),a[0]=_*v-C*u,a[1]=b*v-L*u,a[2]=M*v-D*u,a[3]=P*v-F*u,a[8]=_*u+C*v,a[9]=b*u+L*v,a[10]=M*u+D*v,a[11]=P*u+F*v,a},I.rotateZ=function(a,l,n){const u=Math.sin(n),v=Math.cos(n),_=l[0],b=l[1],M=l[2],P=l[3],C=l[4],L=l[5],D=l[6],F=l[7];return l!==a&&(a[8]=l[8],a[9]=l[9],a[10]=l[10],a[11]=l[11],a[12]=l[12],a[13]=l[13],a[14]=l[14],a[15]=l[15]),a[0]=_*v+C*u,a[1]=b*v+L*u,a[2]=M*v+D*u,a[3]=P*v+F*u,a[4]=C*v-_*u,a[5]=L*v-b*u,a[6]=D*v-M*u,a[7]=F*v-P*u,a},I.fromTranslation=function(a,l){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=l[0],a[13]=l[1],a[14]=l[2],a[15]=1,a},I.fromScaling=function(a,l){return a[0]=l[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=l[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=l[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},I.fromRotation=function(a,l,n){let u=n[0],v=n[1],_=n[2],b=Math.sqrt(u*u+v*v+_*_);if(Math.abs(b)<O.EPSILON)return null;b=1/b,u*=b,v*=b,_*=b;const M=Math.sin(l),P=Math.cos(l),C=1-P;return a[0]=u*u*C+P,a[1]=v*u*C+_*M,a[2]=_*u*C-v*M,a[3]=0,a[4]=u*v*C-_*M,a[5]=v*v*C+P,a[6]=_*v*C+u*M,a[7]=0,a[8]=u*_*C+v*M,a[9]=v*_*C-u*M,a[10]=_*_*C+P,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},I.fromXRotation=function(a,l){const n=Math.sin(l),u=Math.cos(l);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=u,a[6]=n,a[7]=0,a[8]=0,a[9]=-n,a[10]=u,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},I.fromYRotation=function(a,l){const n=Math.sin(l),u=Math.cos(l);return a[0]=u,a[1]=0,a[2]=-n,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=n,a[9]=0,a[10]=u,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},I.fromZRotation=function(a,l){const n=Math.sin(l),u=Math.cos(l);return a[0]=u,a[1]=n,a[2]=0,a[3]=0,a[4]=-n,a[5]=u,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},I.fromRotationTranslation=function(a,l,n){const u=l[0],v=l[1],_=l[2],b=l[3],M=u+u,P=v+v,C=_+_,L=u*M,D=u*P,F=u*C,j=v*P,K=v*C,ee=_*C,Q=b*M,le=b*P,pe=b*C;return a[0]=1-(j+ee),a[1]=D+pe,a[2]=F-le,a[3]=0,a[4]=D-pe,a[5]=1-(L+ee),a[6]=K+Q,a[7]=0,a[8]=F+le,a[9]=K-Q,a[10]=1-(L+j),a[11]=0,a[12]=n[0],a[13]=n[1],a[14]=n[2],a[15]=1,a},I.getTranslation=function(a,l){return a[0]=l[12],a[1]=l[13],a[2]=l[14],a},I.getScaling=function(a,l){const n=l[0],u=l[1],v=l[2],_=l[4],b=l[5],M=l[6],P=l[8],C=l[9],L=l[10];return a[0]=Math.sqrt(n*n+u*u+v*v),a[1]=Math.sqrt(_*_+b*b+M*M),a[2]=Math.sqrt(P*P+C*C+L*L),a},I.getRotation=function(a,l){const n=l[0]+l[5]+l[10];let u=0;return n>0?(u=2*Math.sqrt(n+1),a[3]=.25*u,a[0]=(l[6]-l[9])/u,a[1]=(l[8]-l[2])/u,a[2]=(l[1]-l[4])/u):l[0]>l[5]&&l[0]>l[10]?(u=2*Math.sqrt(1+l[0]-l[5]-l[10]),a[3]=(l[6]-l[9])/u,a[0]=.25*u,a[1]=(l[1]+l[4])/u,a[2]=(l[8]+l[2])/u):l[5]>l[10]?(u=2*Math.sqrt(1+l[5]-l[0]-l[10]),a[3]=(l[8]-l[2])/u,a[0]=(l[1]+l[4])/u,a[1]=.25*u,a[2]=(l[6]+l[9])/u):(u=2*Math.sqrt(1+l[10]-l[0]-l[5]),a[3]=(l[1]-l[4])/u,a[0]=(l[8]+l[2])/u,a[1]=(l[6]+l[9])/u,a[2]=.25*u),a},I.fromRotationTranslationScale=function(a,l,n,u){const v=l[0],_=l[1],b=l[2],M=l[3],P=v+v,C=_+_,L=b+b,D=v*P,F=v*C,j=v*L,K=_*C,ee=_*L,Q=b*L,le=M*P,pe=M*C,de=M*L,Ee=u[0],Pe=u[1],Je=u[2];return a[0]=(1-(K+Q))*Ee,a[1]=(F+de)*Ee,a[2]=(j-pe)*Ee,a[3]=0,a[4]=(F-de)*Pe,a[5]=(1-(D+Q))*Pe,a[6]=(ee+le)*Pe,a[7]=0,a[8]=(j+pe)*Je,a[9]=(ee-le)*Je,a[10]=(1-(D+K))*Je,a[11]=0,a[12]=n[0],a[13]=n[1],a[14]=n[2],a[15]=1,a},I.fromRotationTranslationScaleOrigin=function(a,l,n,u,v){const _=l[0],b=l[1],M=l[2],P=l[3],C=_+_,L=b+b,D=M+M,F=_*C,j=_*L,K=_*D,ee=b*L,Q=b*D,le=M*D,pe=P*C,de=P*L,Ee=P*D,Pe=u[0],Je=u[1],xt=u[2],vt=v[0],ct=v[1],Rt=v[2];return a[0]=(1-(ee+le))*Pe,a[1]=(j+Ee)*Pe,a[2]=(K-de)*Pe,a[3]=0,a[4]=(j-Ee)*Je,a[5]=(1-(F+le))*Je,a[6]=(Q+pe)*Je,a[7]=0,a[8]=(K+de)*xt,a[9]=(Q-pe)*xt,a[10]=(1-(F+ee))*xt,a[11]=0,a[12]=n[0]+vt-(a[0]*vt+a[4]*ct+a[8]*Rt),a[13]=n[1]+ct-(a[1]*vt+a[5]*ct+a[9]*Rt),a[14]=n[2]+Rt-(a[2]*vt+a[6]*ct+a[10]*Rt),a[15]=1,a},I.fromQuat=function(a,l){const n=l[0],u=l[1],v=l[2],_=l[3],b=n+n,M=u+u,P=v+v,C=n*b,L=u*b,D=u*M,F=v*b,j=v*M,K=v*P,ee=_*b,Q=_*M,le=_*P;return a[0]=1-D-K,a[1]=L+le,a[2]=F-Q,a[3]=0,a[4]=L-le,a[5]=1-C-K,a[6]=j+ee,a[7]=0,a[8]=F+Q,a[9]=j-ee,a[10]=1-C-D,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},I.frustum=function(a,l,n,u,v,_,b){const M=1/(n-l),P=1/(v-u),C=1/(_-b);return a[0]=2*_*M,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*_*P,a[6]=0,a[7]=0,a[8]=(n+l)*M,a[9]=(v+u)*P,a[10]=(b+_)*C,a[11]=-1,a[12]=0,a[13]=0,a[14]=b*_*2*C,a[15]=0,a},I.perspective=function(a,l,n,u,v){const _=1/Math.tan(l/2),b=1/(u-v);return a[0]=_/n,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=_,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(v+u)*b,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*v*u*b,a[15]=0,a},I.perspectiveFromFieldOfView=function(a,l,n,u){const v=Math.tan(l.upDegrees*Math.PI/180),_=Math.tan(l.downDegrees*Math.PI/180),b=Math.tan(l.leftDegrees*Math.PI/180),M=Math.tan(l.rightDegrees*Math.PI/180),P=2/(b+M),C=2/(v+_);return a[0]=P,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=C,a[6]=0,a[7]=0,a[8]=-(b-M)*P*.5,a[9]=(v-_)*C*.5,a[10]=u/(n-u),a[11]=-1,a[12]=0,a[13]=0,a[14]=u*n/(n-u),a[15]=0,a},I.ortho=function(a,l,n,u,v,_,b){const M=1/(l-n),P=1/(u-v),C=1/(_-b);return a[0]=-2*M,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*P,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*C,a[11]=0,a[12]=(l+n)*M,a[13]=(v+u)*P,a[14]=(b+_)*C,a[15]=1,a},I.lookAt=function(a,l,n,u){let v,_,b,M,P,C,L,D,F,j;const K=l[0],ee=l[1],Q=l[2],le=u[0],pe=u[1],de=u[2],Ee=n[0],Pe=n[1],Je=n[2];return Math.abs(K-Ee)<O.EPSILON&&Math.abs(ee-Pe)<O.EPSILON&&Math.abs(Q-Je)<O.EPSILON?g(a):(L=K-Ee,D=ee-Pe,F=Q-Je,j=1/Math.sqrt(L*L+D*D+F*F),L*=j,D*=j,F*=j,v=pe*F-de*D,_=de*L-le*F,b=le*D-pe*L,j=Math.sqrt(v*v+_*_+b*b),j?(j=1/j,v*=j,_*=j,b*=j):(v=0,_=0,b=0),M=D*b-F*_,P=F*v-L*b,C=L*_-D*v,j=Math.sqrt(M*M+P*P+C*C),j?(j=1/j,M*=j,P*=j,C*=j):(M=0,P=0,C=0),a[0]=v,a[1]=M,a[2]=L,a[3]=0,a[4]=_,a[5]=P,a[6]=D,a[7]=0,a[8]=b,a[9]=C,a[10]=F,a[11]=0,a[12]=-(v*K+_*ee+b*Q),a[13]=-(M*K+P*ee+C*Q),a[14]=-(L*K+D*ee+F*Q),a[15]=1,a)},I.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},I.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))},I.add=function(a,l,n){return a[0]=l[0]+n[0],a[1]=l[1]+n[1],a[2]=l[2]+n[2],a[3]=l[3]+n[3],a[4]=l[4]+n[4],a[5]=l[5]+n[5],a[6]=l[6]+n[6],a[7]=l[7]+n[7],a[8]=l[8]+n[8],a[9]=l[9]+n[9],a[10]=l[10]+n[10],a[11]=l[11]+n[11],a[12]=l[12]+n[12],a[13]=l[13]+n[13],a[14]=l[14]+n[14],a[15]=l[15]+n[15],a},I.subtract=function(a,l,n){return a[0]=l[0]-n[0],a[1]=l[1]-n[1],a[2]=l[2]-n[2],a[3]=l[3]-n[3],a[4]=l[4]-n[4],a[5]=l[5]-n[5],a[6]=l[6]-n[6],a[7]=l[7]-n[7],a[8]=l[8]-n[8],a[9]=l[9]-n[9],a[10]=l[10]-n[10],a[11]=l[11]-n[11],a[12]=l[12]-n[12],a[13]=l[13]-n[13],a[14]=l[14]-n[14],a[15]=l[15]-n[15],a},I.multiplyScalar=function(a,l,n){return a[0]=l[0]*n,a[1]=l[1]*n,a[2]=l[2]*n,a[3]=l[3]*n,a[4]=l[4]*n,a[5]=l[5]*n,a[6]=l[6]*n,a[7]=l[7]*n,a[8]=l[8]*n,a[9]=l[9]*n,a[10]=l[10]*n,a[11]=l[11]*n,a[12]=l[12]*n,a[13]=l[13]*n,a[14]=l[14]*n,a[15]=l[15]*n,a},I.multiplyScalarAndAdd=function(a,l,n,u){return a[0]=l[0]+n[0]*u,a[1]=l[1]+n[1]*u,a[2]=l[2]+n[2]*u,a[3]=l[3]+n[3]*u,a[4]=l[4]+n[4]*u,a[5]=l[5]+n[5]*u,a[6]=l[6]+n[6]*u,a[7]=l[7]+n[7]*u,a[8]=l[8]+n[8]*u,a[9]=l[9]+n[9]*u,a[10]=l[10]+n[10]*u,a[11]=l[11]+n[11]*u,a[12]=l[12]+n[12]*u,a[13]=l[13]+n[13]*u,a[14]=l[14]+n[14]*u,a[15]=l[15]+n[15]*u,a},I.exactEquals=function(a,l){return a[0]===l[0]&&a[1]===l[1]&&a[2]===l[2]&&a[3]===l[3]&&a[4]===l[4]&&a[5]===l[5]&&a[6]===l[6]&&a[7]===l[7]&&a[8]===l[8]&&a[9]===l[9]&&a[10]===l[10]&&a[11]===l[11]&&a[12]===l[12]&&a[13]===l[13]&&a[14]===l[14]&&a[15]===l[15]},I.equals=function(a,l){const n=a[0],u=a[1],v=a[2],_=a[3],b=a[4],M=a[5],P=a[6],C=a[7],L=a[8],D=a[9],F=a[10],j=a[11],K=a[12],ee=a[13],Q=a[14],le=a[15],pe=l[0],de=l[1],Ee=l[2],Pe=l[3],Je=l[4],xt=l[5],vt=l[6],ct=l[7],Rt=l[8],Pt=l[9],nn=l[10],mn=l[11],cn=l[12],ht=l[13],un=l[14],rn=l[15];return Math.abs(n-pe)<=O.EPSILON*Math.max(1,Math.abs(n),Math.abs(pe))&&Math.abs(u-de)<=O.EPSILON*Math.max(1,Math.abs(u),Math.abs(de))&&Math.abs(v-Ee)<=O.EPSILON*Math.max(1,Math.abs(v),Math.abs(Ee))&&Math.abs(_-Pe)<=O.EPSILON*Math.max(1,Math.abs(_),Math.abs(Pe))&&Math.abs(b-Je)<=O.EPSILON*Math.max(1,Math.abs(b),Math.abs(Je))&&Math.abs(M-xt)<=O.EPSILON*Math.max(1,Math.abs(M),Math.abs(xt))&&Math.abs(P-vt)<=O.EPSILON*Math.max(1,Math.abs(P),Math.abs(vt))&&Math.abs(C-ct)<=O.EPSILON*Math.max(1,Math.abs(C),Math.abs(ct))&&Math.abs(L-Rt)<=O.EPSILON*Math.max(1,Math.abs(L),Math.abs(Rt))&&Math.abs(D-Pt)<=O.EPSILON*Math.max(1,Math.abs(D),Math.abs(Pt))&&Math.abs(F-nn)<=O.EPSILON*Math.max(1,Math.abs(F),Math.abs(nn))&&Math.abs(j-mn)<=O.EPSILON*Math.max(1,Math.abs(j),Math.abs(mn))&&Math.abs(K-cn)<=O.EPSILON*Math.max(1,Math.abs(K),Math.abs(cn))&&Math.abs(ee-ht)<=O.EPSILON*Math.max(1,Math.abs(ee),Math.abs(ht))&&Math.abs(Q-un)<=O.EPSILON*Math.max(1,Math.abs(Q),Math.abs(un))&&Math.abs(le-rn)<=O.EPSILON*Math.max(1,Math.abs(le),Math.abs(rn))}})(w.mat4||(w.mat4={}))},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.vec2=void 0;const O=U(7);(function(I){function g(){const a=new Float32Array(2);return a[0]=0,a[1]=0,a}I.create=g,I.clone=function(a){const l=new Float32Array(2);return l[0]=a[0],l[1]=a[1],l},I.fromValues=function(a,l){const n=new Float32Array(2);return n[0]=a,n[1]=l,n},I.copy=function(a,l){return a[0]=l[0],a[1]=l[1],a},I.set=function(a,l,n){return a[0]=l,a[1]=n,a},I.add=function(a,l,n){return a[0]=l[0]+n[0],a[1]=l[1]+n[1],a},I.subtract=function(a,l,n){return a[0]=l[0]-n[0],a[1]=l[1]-n[1],a},I.multiply=function(a,l,n){return a[0]=l[0]*n[0],a[1]=l[1]*n[1],a},I.divide=function(a,l,n){return a[0]=l[0]/n[0],a[1]=l[1]/n[1],a},I.ceil=function(a,l){return a[0]=Math.ceil(l[0]),a[1]=Math.ceil(l[1]),a},I.floor=function(a,l){return a[0]=Math.floor(l[0]),a[1]=Math.floor(l[1]),a},I.min=function(a,l,n){return a[0]=Math.min(l[0],n[0]),a[1]=Math.min(l[1],n[1]),a},I.max=function(a,l,n){return a[0]=Math.max(l[0],n[0]),a[1]=Math.max(l[1],n[1]),a},I.round=function(a,l){return a[0]=Math.round(l[0]),a[1]=Math.round(l[1]),a},I.scale=function(a,l,n){return a[0]=l[0]*n,a[1]=l[1]*n,a},I.scaleAndAdd=function(a,l,n,u){return a[0]=l[0]+n[0]*u,a[1]=l[1]+n[1]*u,a},I.distance=function(a,l){var n=l[0]-a[0],u=l[1]-a[1];return Math.hypot(n,u)},I.squaredDistance=function(a,l){var n=l[0]-a[0],u=l[1]-a[1];return n*n+u*u},I.length=function(a){var l=a[0],n=a[1];return Math.hypot(l,n)},I.squaredLength=function(a){var l=a[0],n=a[1];return l*l+n*n},I.negate=function(a,l){return a[0]=-l[0],a[1]=-l[1],a},I.inverse=function(a,l){return a[0]=1/l[0],a[1]=1/l[1],a},I.normalize=function(a,l){var n=l[0],u=l[1],v=n*n+u*u;return v>0&&(v=1/Math.sqrt(v)),a[0]=l[0]*v,a[1]=l[1]*v,a},I.dot=function(a,l){return a[0]*l[0]+a[1]*l[1]},I.cross=function(a,l,n){var u=l[0]*n[1]-l[1]*n[0];return a[0]=a[1]=0,a[2]=u,a},I.lerp=function(a,l,n,u){var v=l[0],_=l[1];return a[0]=v+u*(n[0]-v),a[1]=_+u*(n[1]-_),a},I.random=function(a,l){l=l||1;const n=2*Math.random()*Math.PI;return a[0]=Math.cos(n)*l,a[1]=Math.sin(n)*l,a},I.transformMat2=function(a,l,n){var u=l[0],v=l[1];return a[0]=n[0]*u+n[2]*v,a[1]=n[1]*u+n[3]*v,a},I.transformMat2d=function(a,l,n){var u=l[0],v=l[1];return a[0]=n[0]*u+n[2]*v+n[4],a[1]=n[1]*u+n[3]*v+n[5],a},I.transformMat3=function(a,l,n){var u=l[0],v=l[1];return a[0]=n[0]*u+n[3]*v+n[6],a[1]=n[1]*u+n[4]*v+n[7],a},I.transformMat4=function(a,l,n){const u=l[0],v=l[1];return a[0]=n[0]*u+n[4]*v+n[12],a[1]=n[1]*u+n[5]*v+n[13],a},I.rotate=function(a,l,n,u){const v=l[0]-n[0],_=l[1]-n[1],b=Math.sin(u),M=Math.cos(u);return a[0]=v*M-_*b+n[0],a[1]=v*b+_*M+n[1],a},I.angle=function(a,l){const n=a[0],u=a[1],v=l[0],_=l[1],b=Math.sqrt((n*n+u*u)*(v*v+_*_)),M=b&&(n*v+u*_)/b;return Math.acos(Math.min(Math.max(M,-1),1))},I.zero=function(a){return a[0]=0,a[1]=0,a},I.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},I.exactEquals=function(a,l){return a[0]===l[0]&&a[1]===l[1]},I.equals=function(a,l){const n=a[0],u=a[1],v=l[0],_=l[1];return Math.abs(n-v)<=O.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(u-_)<=O.EPSILON*Math.max(1,Math.abs(u),Math.abs(_))},I.forEach=function(){const a=g();return function(l,n,u,v,_,b){let M,P;for(n||(n=2),u||(u=0),P=v?Math.min(v*n+u,l.length):l.length,M=u;M<P;M+=n)a[0]=l[M],a[1]=l[M+1],_(a,a,b),l[M]=a[0],l[M+1]=a[1];return l}}()})(w.vec2||(w.vec2={}))},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.quat=void 0;const O=U(39),I=U(40),g=U(41);(function(a){function l(){const _=new Float32Array(4);return _[0]=0,_[1]=0,_[2]=0,_[3]=1,_}function n(_,b,M){M*=.5;const P=Math.sin(M);return _[0]=P*b[0],_[1]=P*b[1],_[2]=P*b[2],_[3]=Math.cos(M),_}function u(_,b,M,P){const C=b[0],L=b[1],D=b[2],F=b[3];let j,K,ee,Q,le,pe=M[0],de=M[1],Ee=M[2],Pe=M[3];return K=C*pe+L*de+D*Ee+F*Pe,K<0&&(K=-K,pe=-pe,de=-de,Ee=-Ee,Pe=-Pe),1-K>1e-6?(j=Math.acos(K),ee=Math.sin(j),Q=Math.sin((1-P)*j)/ee,le=Math.sin(P*j)/ee):(Q=1-P,le=P),_[0]=Q*C+le*pe,_[1]=Q*L+le*de,_[2]=Q*D+le*Ee,_[3]=Q*F+le*Pe,_}function v(_,b){const M=b[0]+b[4]+b[8];let P;if(M>0)P=Math.sqrt(M+1),_[3]=.5*P,P=.5/P,_[0]=(b[5]-b[7])*P,_[1]=(b[6]-b[2])*P,_[2]=(b[1]-b[3])*P;else{let C=0;b[4]>b[0]&&(C=1),b[8]>b[3*C+C]&&(C=2);const L=(C+1)%3,D=(C+2)%3;P=Math.sqrt(b[3*C+C]-b[3*L+L]-b[3*D+D]+1),_[C]=.5*P,P=.5/P,_[3]=(b[3*L+D]-b[3*D+L])*P,_[L]=(b[3*L+C]+b[3*C+L])*P,_[D]=(b[3*D+C]+b[3*C+D])*P}return _}a.create=l,a.rotationTo=function(_,b,M){const P=I.vec3.create(),C=I.vec3.fromValues(1,0,0),L=I.vec3.fromValues(0,1,0),D=I.vec3.dot(b,M);return D<-.999999?(I.vec3.cross(P,C,b),I.vec3.length(P)<1e-6&&I.vec3.cross(P,L,b),I.vec3.normalize(P,P),n(_,P,Math.PI),_):D>.999999?(_[0]=0,_[1]=0,_[2]=0,_[3]=1,_):(I.vec3.cross(P,b,M),_[0]=P[0],_[1]=P[1],_[2]=P[2],_[3]=1+D,a.normalize(_,_))},a.setAxes=function(_,b,M,P){const C=O.mat3.create();return C[0]=M[0],C[3]=M[1],C[6]=M[2],C[1]=P[0],C[4]=P[1],C[7]=P[2],C[2]=-b[0],C[5]=-b[1],C[8]=-b[2],a.normalize(_,v(_,C))},a.clone=g.vec4.clone,a.fromValues=g.vec4.fromValues,a.copy=g.vec4.copy,a.set=g.vec4.set,a.identity=function(_){return _[0]=0,_[1]=0,_[2]=0,_[3]=1,_},a.setAxisAngle=n,a.getAxisAngle=function(_,b){const M=2*Math.acos(b[3]),P=Math.sin(M/2);return P!==0?(_[0]=b[0]/P,_[1]=b[1]/P,_[2]=b[2]/P):(_[0]=1,_[1]=0,_[2]=0),M},a.add=g.vec4.add,a.multiply=function(_,b,M){const P=b[0],C=b[1],L=b[2],D=b[3],F=M[0],j=M[1],K=M[2],ee=M[3];return _[0]=P*ee+D*F+C*K-L*j,_[1]=C*ee+D*j+L*F-P*K,_[2]=L*ee+D*K+P*j-C*F,_[3]=D*ee-P*F-C*j-L*K,_},a.scale=g.vec4.scale,a.rotateX=function(_,b,M){M*=.5;const P=b[0],C=b[1],L=b[2],D=b[3],F=Math.sin(M),j=Math.cos(M);return _[0]=P*j+D*F,_[1]=C*j+L*F,_[2]=L*j-C*F,_[3]=D*j-P*F,_},a.rotateY=function(_,b,M){M*=.5;const P=b[0],C=b[1],L=b[2],D=b[3],F=Math.sin(M),j=Math.cos(M);return _[0]=P*j-L*F,_[1]=C*j+D*F,_[2]=L*j+P*F,_[3]=D*j-C*F,_},a.rotateZ=function(_,b,M){M*=.5;const P=b[0],C=b[1],L=b[2],D=b[3],F=Math.sin(M),j=Math.cos(M);return _[0]=P*j+C*F,_[1]=C*j-P*F,_[2]=L*j+D*F,_[3]=D*j-L*F,_},a.calculateW=function(_,b){const M=b[0],P=b[1],C=b[2];return _[0]=M,_[1]=P,_[2]=C,_[3]=Math.sqrt(Math.abs(1-M*M-P*P-C*C)),_},a.dot=g.vec4.dot,a.lerp=g.vec4.lerp,a.slerp=u,a.sqlerp=function(_,b,M,P,C,L){const D=l(),F=l();return u(D,b,C,L),u(F,M,P,L),u(_,D,F,2*L*(1-L)),_},a.invert=function(_,b){const M=b[0],P=b[1],C=b[2],L=b[3],D=M*M+P*P+C*C+L*L,F=D?1/D:0;return _[0]=-M*F,_[1]=-P*F,_[2]=-C*F,_[3]=L*F,_},a.conjugate=function(_,b){return _[0]=-b[0],_[1]=-b[1],_[2]=-b[2],_[3]=b[3],_},a.length=g.vec4.length,a.squaredLength=g.vec4.squaredLength,a.normalize=g.vec4.normalize,a.fromMat3=v,a.str=function(_){return"quat("+_[0]+", "+_[1]+", "+_[2]+", "+_[3]+")"},a.exactEquals=g.vec4.exactEquals,a.equals=g.vec4.equals})(w.quat||(w.quat={}))},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.mat2=void 0;const O=U(7);(function(I){I.create=function(){const g=new Float32Array(4);return g[0]=1,g[1]=0,g[2]=0,g[3]=0,g},I.clone=function(g){const a=new Float32Array(4);return a[0]=g[0],a[1]=g[1],a[2]=g[2],a[3]=g[3],a},I.copy=function(g,a){return g[0]=a[0],g[1]=a[1],g[2]=a[2],g[3]=a[3],g},I.identity=function(g){return g[0]=1,g[1]=0,g[2]=0,g[3]=1,g},I.fromValues=function(g,a,l,n){const u=new Float32Array(4);return u[0]=g,u[1]=a,u[2]=l,u[3]=n,u},I.set=function(g,a,l,n,u){return g[0]=a,g[1]=l,g[2]=n,g[3]=u,g},I.transpose=function(g,a){if(g===a){const l=a[1];g[1]=a[2],g[2]=l}else g[0]=a[0],g[1]=a[2],g[2]=a[1],g[3]=a[3];return g},I.invert=function(g,a){const l=a[0],n=a[1],u=a[2],v=a[3];let _=l*v-u*n;return _?(_=1/_,g[0]=v*_,g[1]=-n*_,g[2]=-u*_,g[3]=l*_,g):null},I.adjoint=function(g,a){const l=a[0];return g[0]=a[3],g[1]=-a[1],g[2]=-a[2],g[3]=l,g},I.determinant=function(g){return g[0]*g[3]-g[2]*g[1]},I.multiply=function(g,a,l){const n=a[0],u=a[1],v=a[2],_=a[3],b=l[0],M=l[1],P=l[2],C=l[3];return g[0]=n*b+v*M,g[1]=u*b+_*M,g[2]=n*P+v*C,g[3]=u*P+_*C,g},I.rotate=function(g,a,l){const n=a[0],u=a[1],v=a[2],_=a[3],b=Math.sin(l),M=Math.cos(l);return g[0]=n*M+v*b,g[1]=u*M+_*b,g[2]=n*-b+v*M,g[3]=u*-b+_*M,g},I.scale=function(g,a,l){const n=a[0],u=a[1],v=a[2],_=a[3],b=l[0],M=l[1];return g[0]=n*b,g[1]=u*b,g[2]=v*M,g[3]=_*M,g},I.fromRotation=function(g,a){const l=Math.sin(a),n=Math.cos(a);return g[0]=n,g[1]=l,g[2]=-l,g[3]=n,g},I.fromScaling=function(g,a){return g[0]=a[0],g[1]=0,g[2]=0,g[3]=a[1],g},I.str=function(g){return"mat2("+g[0]+", "+g[1]+", "+g[2]+", "+g[3]+")"},I.frob=function(g){return Math.hypot(g[0],g[1],g[2],g[3])},I.LDU=function(g,a,l,n){return g[2]=n[2]/n[0],l[0]=n[0],l[1]=n[1],l[3]=n[3]-g[2]*l[1],[g,a,l]},I.add=function(g,a,l){return g[0]=a[0]+l[0],g[1]=a[1]+l[1],g[2]=a[2]+l[2],g[3]=a[3]+l[3],g},I.subtract=function(g,a,l){return g[0]=a[0]-l[0],g[1]=a[1]-l[1],g[2]=a[2]-l[2],g[3]=a[3]-l[3],g},I.exactEquals=function(g,a){return g[0]===a[0]&&g[1]===a[1]&&g[2]===a[2]&&g[3]===a[3]},I.equals=function(g,a){const l=g[0],n=g[1],u=g[2],v=g[3],_=a[0],b=a[1],M=a[2],P=a[3];return Math.abs(l-_)<=O.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(n-b)<=O.EPSILON*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(u-M)<=O.EPSILON*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(v-P)<=O.EPSILON*Math.max(1,Math.abs(v),Math.abs(P))},I.multiplyScalar=function(g,a,l){return g[0]=a[0]*l,g[1]=a[1]*l,g[2]=a[2]*l,g[3]=a[3]*l,g},I.multiplyScalarAndAdd=function(g,a,l,n){return g[0]=a[0]+l[0]*n,g[1]=a[1]+l[1]*n,g[2]=a[2]+l[2]*n,g[3]=a[3]+l[3]*n,g}})(w.mat2||(w.mat2={}))},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.mat2d=void 0;const O=U(7);(function(I){I.create=function(){const g=new Float32Array(4);return g[1]=0,g[2]=0,g[4]=0,g[5]=0,g[0]=1,g[3]=1,g},I.clone=function(g){const a=new Float32Array(6);return a[0]=g[0],a[1]=g[1],a[2]=g[2],a[3]=g[3],a[4]=g[4],a[5]=g[5],a},I.copy=function(g,a){return g[0]=a[0],g[1]=a[1],g[2]=a[2],g[3]=a[3],g[4]=a[4],g[5]=a[5],g},I.identity=function(g){return g[0]=1,g[1]=0,g[2]=0,g[3]=1,g[4]=0,g[5]=0,g},I.fromValues=function(g,a,l,n,u,v){const _=new Float32Array(6);return _[0]=g,_[1]=a,_[2]=l,_[3]=n,_[4]=u,_[5]=v,_},I.set=function(g,a,l,n,u,v,_){return g[0]=a,g[1]=l,g[2]=n,g[3]=u,g[4]=v,g[5]=_,g},I.invert=function(g,a){const l=a[0],n=a[1],u=a[2],v=a[3],_=a[4],b=a[5];let M=l*v-n*u;return M?(M=1/M,g[0]=v*M,g[1]=-n*M,g[2]=-u*M,g[3]=l*M,g[4]=(u*b-v*_)*M,g[5]=(n*_-l*b)*M,g):null},I.determinant=function(g){return g[0]*g[3]-g[1]*g[2]},I.multiply=function(g,a,l){const n=a[0],u=a[1],v=a[2],_=a[3],b=a[4],M=a[5],P=l[0],C=l[1],L=l[2],D=l[3],F=l[4],j=l[5];return g[0]=n*P+v*C,g[1]=u*P+_*C,g[2]=n*L+v*D,g[3]=u*L+_*D,g[4]=n*F+v*j+b,g[5]=u*F+_*j+M,g},I.rotate=function(g,a,l){const n=a[0],u=a[1],v=a[2],_=a[3],b=a[4],M=a[5],P=Math.sin(l),C=Math.cos(l);return g[0]=n*C+v*P,g[1]=u*C+_*P,g[2]=n*-P+v*C,g[3]=u*-P+_*C,g[4]=b,g[5]=M,g},I.scale=function(g,a,l){const n=a[0],u=a[1],v=a[2],_=a[3],b=a[4],M=a[5],P=l[0],C=l[1];return g[0]=n*P,g[1]=u*P,g[2]=v*C,g[3]=_*C,g[4]=b,g[5]=M,g},I.translate=function(g,a,l){const n=a[0],u=a[1],v=a[2],_=a[3],b=a[4],M=a[5],P=l[0],C=l[1];return g[0]=n,g[1]=u,g[2]=v,g[3]=_,g[4]=n*P+v*C+b,g[5]=u*P+_*C+M,g},I.fromRotation=function(g,a){const l=Math.sin(a),n=Math.cos(a);return g[0]=n,g[1]=l,g[2]=-l,g[3]=n,g[4]=0,g[5]=0,g},I.fromScaling=function(g,a){return g[0]=a[0],g[1]=0,g[2]=0,g[3]=a[1],g[4]=0,g[5]=0,g},I.fromTranslation=function(g,a){return g[0]=1,g[1]=0,g[2]=0,g[3]=1,g[4]=a[0],g[5]=a[1],g},I.str=function(g){return"mat2d("+g[0]+", "+g[1]+", "+g[2]+", "+g[3]+", "+g[4]+", "+g[5]+")"},I.frob=function(g){return Math.hypot(g[0],g[1],g[2],g[3],g[4],g[5],1)},I.add=function(g,a,l){return g[0]=a[0]+l[0],g[1]=a[1]+l[1],g[2]=a[2]+l[2],g[3]=a[3]+l[3],g[4]=a[4]+l[4],g[5]=a[5]+l[5],g},I.subtract=function(g,a,l){return g[0]=a[0]-l[0],g[1]=a[1]-l[1],g[2]=a[2]-l[2],g[3]=a[3]-l[3],g[4]=a[4]-l[4],g[5]=a[5]-l[5],g},I.multiplyScalar=function(g,a,l){return g[0]=a[0]*l,g[1]=a[1]*l,g[2]=a[2]*l,g[3]=a[3]*l,g[4]=a[4]*l,g[5]=a[5]*l,g},I.multiplyScalarAndAdd=function(g,a,l,n){return g[0]=a[0]+l[0]*n,g[1]=a[1]+l[1]*n,g[2]=a[2]+l[2]*n,g[3]=a[3]+l[3]*n,g[4]=a[4]+l[4]*n,g[5]=a[5]+l[5]*n,g},I.exactEquals=function(g,a){return g[0]===a[0]&&g[1]===a[1]&&g[2]===a[2]&&g[3]===a[3]&&g[4]===a[4]&&g[5]===a[5]},I.equals=function(g,a){const l=g[0],n=g[1],u=g[2],v=g[3],_=g[4],b=g[5],M=a[0],P=a[1],C=a[2],L=a[3],D=a[4],F=a[5];return Math.abs(l-M)<=O.EPSILON*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(n-P)<=O.EPSILON*Math.max(1,Math.abs(n),Math.abs(P))&&Math.abs(u-C)<=O.EPSILON*Math.max(1,Math.abs(u),Math.abs(C))&&Math.abs(v-L)<=O.EPSILON*Math.max(1,Math.abs(v),Math.abs(L))&&Math.abs(_-D)<=O.EPSILON*Math.max(1,Math.abs(_),Math.abs(D))&&Math.abs(b-F)<=O.EPSILON*Math.max(1,Math.abs(b),Math.abs(F))}})(w.mat2d||(w.mat2d={}))},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.utf8ToUnicode=w.isZero=w.randomColor=w.RandomID=void 0,w.RandomID=function(O){const I="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split("");O||(O=16);let g="";for(let a=0;a<O;a++)g+=I[Math.floor(Math.random()*I.length)];return g},w.randomColor=function(){const O=[];for(let I=0;I<3;++I){let g=Math.floor(256*Math.random()).toString(16);g=g.length===1?"0"+g:g,O.push(g)}return"#"+O.join("")},w.isZero=function(O,I){return O>=-(I=I!=null?I:1e-6)&&O<=I},w.utf8ToUnicode=function(O){let I,g,a,l="",n=O.length,u=0,v=n;for(;u<n;)if(I=O.charCodeAt(u),(128&I)==0){if(v<1)break;l+=String.fromCharCode(127&I),u++,v-=1}else if((224&I)==192){if(g=O.charCodeAt(u+1),v<2||(192&g)!=128)break;l+=String.fromCharCode((63&I)<<6|63&g),u+=2,v-=2}else{if((240&I)!=224||(g=O.charCodeAt(u+1),a=O.charCodeAt(u+2),v<3||(192&g)!=128||(192&a)!=128))break;l+=String.fromCharCode((15&I)<<12|(63&g)<<6|63&a),u+=3,v-=3}return v!=0?"":l}},function(he,w,U){var O;Object.defineProperty(w,"__esModule",{value:!0}),w.createFrameAnimation=w.FrameAnimationStatus=void 0,function(I){I[I.Run=0]="Run",I[I.Stop=1]="Stop",I[I.Pause=2]="Pause",I[I.End=3]="End"}(O=w.FrameAnimationStatus||(w.FrameAnimationStatus={})),w.createFrameAnimation=function(I,g,a){let l=null,n=O.Stop;const u=()=>{if(n!==O.Run)return I(n),void(a&&a(n));if(I(n))return n=O.End,l&&(window.cancelAnimationFrame(l),l=null),void(a&&a(n));if(g){const v=1e3/g;l=window.requestAnimationFrame(()=>{setTimeout(u,v)})}else l=window.requestAnimationFrame(u)};return{get running(){return n===O.Run},get status(){return n},stop:()=>{n!==O.Stop&&(l&&(window.cancelAnimationFrame(l),l=null),n=O.Stop,u())},start:()=>{n!==O.Run&&(n=O.Run,u())},pause:()=>{n!==O.Pause&&(n=O.Pause,u())}}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.createPolygonGeoJson=w.createLineGeoJson=w.createPointGeoJson=void 0;const O=U(2);function I(g,a){var l,n;const u={type:"FeatureCollection",features:[]};if(Array.isArray(g)){if(g.length===0)return u;const b=g[0];typeof b=="object"&&"points"in b||(g=[{points:g}])}else{if(!("points"in g))return g;g=[g]}const v=a==="Polygon";let _=!1;for(let b=0;b<g.length;b++){let M=[];const P=g[b].points;if(Array.isArray(P)&&P.length>0&&P[0].length>0&&Array.isArray(P[0][0])&&P[0][0].length>=2&&(_=!0),_)for(const F of P)F.length>0&&(O.GeoPoint.convert(F[0]).equals(O.GeoPoint.convert(F[F.length-1]))?M.push(F):M.push([...F,F[0]]));else{for(const F of P){const j=O.GeoPoint.convert(F);M.push([j.x,j.y])}v&&(M.length>0&&(O.GeoPoint.convert(M[0]).equals(O.GeoPoint.convert(M[M.length-1]))||M.push(M[0])),M=[M])}const C=(l=g[b].properties)!==null&&l!==void 0?l:{},L=(n=C.id)!==null&&n!==void 0?n:b+1;C.id=L;const D={type:"Feature",id:L,properties:C,geometry:{type:a,coordinates:M}};u.features.push(D)}return u}w.createPointGeoJson=function(g){var a,l;const n={type:"FeatureCollection",features:[]};if(Array.isArray(g)){if(g.length===0)return n;const u=g[0];typeof u=="object"&&"point"in u||(g=typeof u=="number"?[{point:g}]:g.map(v=>({point:v})))}else if("point"in g)g=[g];else{if("type"in g)return g;g=[{point:g}]}for(let u=0;u<g.length;u++){const v=O.GeoPoint.convert(g[u].point),_=(a=g[u].properties)!==null&&a!==void 0?a:{},b=(l=_.id)!==null&&l!==void 0?l:u+1;_.id=b;const M={type:"Feature",id:b,properties:_,geometry:{type:"Point",coordinates:[v.x,v.y]}};n.features.push(M)}return n},w.createLineGeoJson=function(g){return I(g,"LineString")},w.createPolygonGeoJson=function(g){return I(g,"Polygon")}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.addScript=void 0;const service_1=__webpack_require__(19);async function addScript(scripts){"src"in scripts&&(scripts=[scripts]);const results=scripts.map(script=>new Promise((resolve,reject)=>{var _a,_b,_c;const callback=(he,w)=>{he?reject(he):resolve(w)},jsLoaded=()=>{callback(null,!0)};script.strategy||(script.strategy=document.head?"inject":"eval"),script.injectLocation||(script.injectLocation="head"),script.async||(script.async=!1);const strategy=script.strategy.toLowerCase();if(strategy==="inject"){((_a=document.querySelector(script.injectLocation))!==null&&_a!==void 0?_a:document.head)||callback(new ReferenceError("Unable to find element in document."),!1);const he=script.src,w=script.injectLocation,U=he.endsWith("css")?"stylesheet":"script";if(U==="script"){const O=document.createElement("script");O.async=script.async,O.src=he,O.addEventListener("load",()=>jsLoaded()),O.addEventListener("error",()=>callback(new Error(`Script failed to load.
`+he),!1)),O.addEventListener("abort",()=>callback(new Error(`Script aborted.
`+he),!1)),((_b=document.querySelector(w))!==null&&_b!==void 0?_b:document.head).appendChild(O)}else if(U==="stylesheet"){const O=document.createElement("link");O.rel="stylesheet",O.href=he,O.addEventListener("load",()=>jsLoaded()),O.addEventListener("error",()=>callback(new Error(`Link failed to load.
`+he),!1)),O.addEventListener("abort",()=>callback(new Error(`Link aborted.
`+he),!1)),((_c=document.querySelector(w))!==null&&_c!==void 0?_c:document.head).appendChild(O)}else callback(new TypeError("Invalid resource type specified."),!1)}else strategy==="eval"?service_1.httpHelper.get(script.src).then(res=>{try{eval(res),jsLoaded()}catch(he){callback(he,!1)}}).catch(he=>callback(he,!1)):strategy==="href"?(window.location.href||callback(new ReferenceError("Unable to find href object."),!1),service_1.httpHelper.get(script.src).then(he=>{try{window.location.href="javascript:"+encodeURIComponent(he),jsLoaded()}catch(w){callback(w,!1)}}).catch(he=>callback(he,!1))):callback(new ReferenceError(`Invalid strategy: ${script.strategy}. 
With source: ${script.src}`),!1)}));return Promise.all(results)}exports.addScript=addScript},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.openMapDarkStyle=w.Service=void 0;const O=U(99),I=U(2),g=U(44),a=U(43),l=U(0),n=U(45);w.Service=class{constructor(u,v,_){this.serverUrl="",this.accessToken="",this._reqImpl=a.httpHelper,this._svr_url_map="",this._svr_url_service="",u.slice(-1)!=="/"&&(u+="/"),this.serverUrl=u,this.accessToken=v!=null?v:"",this._svr_url_service=this.serverUrl+"service/",u.indexOf("/api")!=0&&(this._svr_url_map=this.serverUrl+"map/"),_&&typeof _.get=="function"&&typeof _.post=="function"&&typeof _.del=="function"&&(this._reqImpl=_),setTimeout(async()=>{var b,M,P,C;try{let L={};const D=this._url("activate")+"/user";if(L=await this._get(D,{}),L&&"data"in L){let F=L.data;if(F&&F.uid){let j=(b=F.uid)!==null&&b!==void 0?b:"",K=(M=F.pid)!==null&&M!==void 0?M:"",ee=(P=F.tid)!==null&&P!==void 0?P:"",Q=(C=F.trial)!==null&&C!==void 0&&C,le="";typeof document=="object"&&document.title&&(le=document.title.substr(0,16));let pe=n.encryptToBase64(`u:${j}__p:${K}__m:${ee}__r:${Q}__t:${le}`);await this._get("https://vjmap.com/server/getverupdate",{id:pe})}}}catch{}},18e5)}_url(u){return`${this._svr_url_map}${u}`}serviceUrl(u){return`${this._svr_url_service}${u}`}_to_layer_string(u){return typeof u=="string"?u:Array.isArray(u)?u.length===0?"[]":JSON.stringify(u):""}_addTokenHeader(u){var v;return this.accessToken&&((u=u!=null?u:{}).headers=(v=u.headers)!==null&&v!==void 0?v:{},u.headers.Accept="application/json",u.headers["Content-Type"]="application/json",u.headers.token=this.accessToken),u}_get(u,v,_){return _=this._addTokenHeader(_),this._reqImpl.get(u,v,_)}_post(u,v,_){return _=this._addTokenHeader(_),this._reqImpl.post(u,v,_)}_del(u,v){return v=this._addTokenHeader(v),this._reqImpl.del(u,v)}toLayerIndex(u,v){const _=[];for(const b of u)_.push(v.findIndex(M=>M.name===b));return _}async _waitOpenMap(u,v,_){var b,M,P,C;if(v&&"data"in v){if(this._cur_map_param=(b=v.data)!==null&&b!==void 0?b:{},this._cur_map_param.mapopenway=(M=u==null?void 0:u.mapopenway)!==null&&M!==void 0?M:g.MapOpenWay.GeomRender,this._cur_map_param.darkMode=u.style&&u.style.backcolor===0,_&&this._cur_map_param.mapopenway===g.MapOpenWay.GeomRender&&((P=v.data)===null||P===void 0?void 0:P.status)==="working"){const L=await this.waitMapOpenFinish(this._cur_map_param.mapid,this._cur_map_param.version);if(!L.error)return u.version=(C=u.version)!==null&&C!==void 0?C:L.version,await this.openMap(u,!1);this._cur_map_param=Object.assign(Object.assign({},this._cur_map_param),L)}return this._cur_map_param}return v}setCurrentMapParam(u){var v;return this._cur_map_param=(v=this._cur_map_param)!==null&&v!==void 0?v:{},l.extend(this._cur_map_param,u),this.currentMapParam()}currentMapParam(){if(!this._cur_map_param)return null;let u={},v={};try{this._cur_map_param.styles&&(u=JSON.parse(this._cur_map_param.styles))}catch{}try{this._cur_map_param.layers&&(v=JSON.parse(this._cur_map_param.layers))}catch{}return{mapid:this._cur_map_param.mapid,version:this._cur_map_param.version,layer:this._cur_map_param.layer,mapopenway:this._cur_map_param.geom==="true"?g.MapOpenWay.GeomRender:g.MapOpenWay.Memory,dbid:this._cur_map_param.dbid,fileid:this._cur_map_param.fileid,filename:this._cur_map_param.filename,bounds:this._cur_map_param.bounds?I.GeoBounds.fromString(this._cur_map_param.bounds):null,mapBounds:this._cur_map_param.mapBounds?I.GeoBounds.fromString(this._cur_map_param.mapBounds):null,styles:u,layers:v,status:this._cur_map_param.status,type:this._cur_map_param.type,uploadname:this._cur_map_param.uploadname,description:this._cur_map_param.description,darkMode:this._cur_map_param.darkMode}}async openMap(u,v=!0){var _,b,M,P,C,L,D,F,j,K,ee;const Q=u.mapopenway!==g.MapOpenWay.Memory;let le={};const pe=`${this._url("openmap")}/${u.mapid}`,de=!(!u.fileid&&u.filedoc),Ee={version:(_=u.version)!==null&&_!==void 0?_:"",layer:(b=u.layer)!==null&&b!==void 0?b:"",geom:Q,fileid:(P=(M=u.fileid)!==null&&M!==void 0?M:u.filedoc)!==null&&P!==void 0?P:"",uploadname:(L=(C=u.uploadname)!==null&&C!==void 0?C:u.filename)!==null&&L!==void 0?L:"",stylename:u.style&&(D=u.style.name)!==null&&D!==void 0?D:"",layeron:u.style&&(F=this._to_layer_string(u.style.layeron))!==null&&F!==void 0?F:"",layeroff:u.style&&(j=this._to_layer_string(u.style.layeroff))!==null&&j!==void 0?j:"",clipbounds:u.style&&u.style.clipbounds?JSON.stringify(typeof u.style.clipbounds=="number"?[u.style.clipbounds,0,0,0]:u.style.clipbounds):"",bkcolor:u.style&&(K=u.style.backcolor)!==null&&K!==void 0?K:"",lineweight:u.style&&u.style.lineweight?JSON.stringify(u.style.lineweight):"",expression:u.style&&(ee=u.style.expression)!==null&&ee!==void 0?ee:""};return le=de?await this._get(pe,Ee):await this._post(pe,Ee),await this._waitOpenMap(u,le,v)}async updateMap(u,v=!0){var _,b,M,P,C,L,D,F,j,K;let ee={};const Q=`${this._url("updatemap")}/${u.mapid}`,le=!(!u.fileid&&u.filedoc),pe={geom:u.mapopenway!==g.MapOpenWay.Memory,fileid:(b=(_=u.fileid)!==null&&_!==void 0?_:u.filedoc)!==null&&b!==void 0?b:"",uploadname:(P=(M=u.uploadname)!==null&&M!==void 0?M:u.filename)!==null&&P!==void 0?P:"",stylename:u.style&&(C=u.style.name)!==null&&C!==void 0?C:"",layeron:u.style&&(L=this._to_layer_string(u.style.layeron))!==null&&L!==void 0?L:"",layeroff:u.style&&(D=this._to_layer_string(u.style.layeroff))!==null&&D!==void 0?D:"",clipbounds:u.style&&u.style.clipbounds?JSON.stringify(typeof u.style.clipbounds=="number"?[u.style.clipbounds,0,0,0]:u.style.clipbounds):"",bkcolor:u.style&&(F=u.style.backcolor)!==null&&F!==void 0?F:"",lineweight:u.style&&u.style.lineweight?JSON.stringify(u.style.lineweight):"",expression:u.style&&(j=u.style.expression)!==null&&j!==void 0?j:"",deleteOldVersion:(K=u.deleteOldVersion)!==null&&K!==void 0&&K};return ee=le?await this._get(Q,pe):await this._post(Q,pe),await this._waitOpenMap(u,ee,v)}glyphsUrl(){return`${this._svr_url_service}fonts/{fontstack}/{range}.pbf?token=${this.accessToken}`}baseUrl(){let u=this._svr_url_service,v=u.indexOf("api/");return v>0&&(u=u.substr(0,v)),u}spriteUrl(u){return`${this.baseUrl()}sprite/${u}`}setSprite(u){return this._spriteUrl="",u.indexOf(":")>0?this._spriteUrl=u:this._spriteUrl=this.spriteUrl(u),this._spriteUrl}blankTileUrl(){return`${this._svr_url_service}map/tile/blank?token=${this.accessToken}`}rasterTileUrl(u={}){var v,_,b,M,P,C,L,D,F,j;const K=(v=u==null?void 0:u.mapid)!==null&&v!==void 0?v:(_=this._cur_map_param)===null||_===void 0?void 0:_.mapid,ee=(P=(b=u==null?void 0:u.version)!==null&&b!==void 0?b:(M=this._cur_map_param)===null||M===void 0?void 0:M.version)!==null&&P!==void 0?P:"v1",Q=(C=u==null?void 0:u.layer)!==null&&C!==void 0?C:(L=this._cur_map_param)===null||L===void 0?void 0:L.layer,le=(j=(D=u==null?void 0:u.fileid)!==null&&D!==void 0?D:(F=this._cur_map_param)===null||F===void 0?void 0:F.fileid)!==null&&j!==void 0?j:"";return`${this._url("tile")}/${K}/${ee}/${Q}/{z}/{x}/{y}?tag=${le}&token=${this.accessToken}`}vectorTileUrl(u={}){var v,_,b,M,P,C,L,D,F,j,K;const ee=(v=u==null?void 0:u.mapid)!==null&&v!==void 0?v:(_=this._cur_map_param)===null||_===void 0?void 0:_.mapid,Q=(P=(b=u==null?void 0:u.version)!==null&&b!==void 0?b:(M=this._cur_map_param)===null||M===void 0?void 0:M.version)!==null&&P!==void 0?P:"v1",le=(D=(C=u==null?void 0:u.layer)!==null&&C!==void 0?C:(L=this._cur_map_param)===null||L===void 0?void 0:L.layer)!==null&&D!==void 0?D:"main",pe=(K=(F=u==null?void 0:u.fileid)!==null&&F!==void 0?F:(j=this._cur_map_param)===null||j===void 0?void 0:j.fileid)!==null&&K!==void 0?K:"";return`${this._url("tile")}/${ee}/${Q}/${le}/{z}/{x}/{y}.mvt?tag=${pe}&token=${this.accessToken}`}async checkFileHasUpload(u){const v=await this._get(this._url("mapfile"),{md5:u});return v&&"data"in v?v.data:v}uploadUrl(){return this._url("uploads")+"?token="+this.accessToken}strMd5(u){return O.hash(u)}styleVersion(){return 8}fileMd5(u){return new Promise((v,_)=>{const b=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,M=Math.ceil(u.size/2097152);let P=0;const C=new O.ArrayBuffer,L=new FileReader;function D(){var F=2097152*P,j=F+2097152>=u.size?u.size:F+2097152;L.readAsArrayBuffer(b.call(u,F,j))}L.onload=function(F){if(C.append(F.target.result),P++,P<M)D();else{var j=C.end();v(j)}},L.onerror=function(){_("file reader error")},D()})}uploadMap(u){return new Promise(async(v,_)=>{try{const P=await this.fileMd5(u),C=await this.checkFileHasUpload(P);if(C.result===!0)C.uploadname=u.name,v(C);else{var b=new FormData;b.append("fileToUpload",u);var M=new XMLHttpRequest;M.addEventListener("load",L=>{const D=JSON.parse(L.target.responseText);D&&D.uploadname&&(D.uploadname=u.name),v(D)},!1),M.addEventListener("error",L=>_(L),!1),M.addEventListener("abort",L=>_(L),!1),M.open("POST",this.uploadUrl()),M.send(b)}}catch(P){_(P)}})}async execCommand(u,v,_,b,M){var P,C,L,D;if(_=_!=null?_:(P=this._cur_map_param)===null||P===void 0?void 0:P.mapid,b=(L=b!=null?b:(C=this._cur_map_param)===null||C===void 0?void 0:C.version)!==null&&L!==void 0?L:"v1",!["listmaps"].includes(u)){const K=((D=this._cur_map_param)===null||D===void 0?void 0:D.geom)==="true";!v||"geom"in v&&v.geom!==void 0||(v.geom=K)}let F={};const j=`${this._url("cmd")}/${u}/${_}/${b}`;return F=M===!0?await this._get(j,v):await this._post(j,v),F&&"data"in F?F.data:F}async metadata(u,v){u=u!=null?u:"",v=v!=null?v:"_";const _=await this.execCommand("metadata",{},u,v,!0);if(_.styles)try{_.styles=JSON.parse(_.styles)}catch{}if(_.layers)try{_.layers=JSON.parse(_.layers)}catch{}return _}async listMaps(u="_",v="_"){u=u||"_",v=v||"_";const _=await this.execCommand("listmaps",{},u,v,!0);if(u!=="_"){const b=_[u];return v!=="*"&&Array.isArray(b)&&b.length===1?b[0]:b}return _}waitMapOpenFinish(u,v,_=5,b=120){return new Promise(async(M,P)=>{if(u==="_"||u===""||v==="*")return void M({error:"param error, mapid is empty",status:"error"});let C=1,L=!1;const D=setInterval(async()=>{try{if(L)return;if(C++,C>=b)return clearInterval(D),void M({error:"try max times",status:"error"});L=!0;const F=await this.listMaps(u,v);if(L=!1,F.geom!==!0)return clearInterval(D),void M({error:"is not GeomRender type map",status:"error",version:F.version});if(F.status==="runerror"||F.status==="error")return clearInterval(D),void M({error:F.errmsg,status:"error",version:F.version});F.status==="finish"&&(clearInterval(D),M({status:"finish",version:F.version}))}catch(F){clearInterval(D),M({error:F,status:"error"})}},1e3*_)})}_processQueryResult(u){const v=u.result,_=u.isgeocoord;let b=null,M=null;const P=this.currentMapParam();if(P&&(b=new I.GeoProjection(P.bounds),!_&&P.mapBounds&&(M=new I.GeoProjection(P.mapBounds))),v&&v.length>0)for(let C=0;C<v.length;C++){if(!v[C].geojson)continue;const L=v[C],D=JSON.parse(L.geojson);let F=!1;for(const j in D.geometries)if(Array.isArray(D.geometries[j]))for(const K in D.geometries[j]){const ee=D.geometries[j][K];for(const Q in ee)_?b&&(ee[Q]=b.toLngLat([ee[Q][0],ee[Q][1]])):ee[Q]=M&&b?b.toLngLat(M.fromMercator([ee[Q][0],ee[Q][1]])):I.Projection.mercator2LngLat([ee[Q][0],ee[Q][1]])}else if(D.geometries[j].type==="Polygon")for(let K=0;K<D.geometries[j].coordinates.length;K++){const ee=D.geometries[j].coordinates[K];for(const Q in ee)_?b&&(ee[Q]=b.toLngLat([ee[Q][0],ee[Q][1]])):ee[Q]=M&&b?b.toLngLat(M.fromMercator([ee[Q][0],ee[Q][1]])):I.Projection.mercator2LngLat([ee[Q][0],ee[Q][1]])}else{F=!0;const K=D.geometries[j].coordinates;for(const ee in K)_?b&&(K[ee]=b.toLngLat([K[ee][0],K[ee][1]])):K[ee]=M&&b?b.toLngLat(M.fromMercator([K[ee][0],K[ee][1]])):I.Projection.mercator2LngLat([K[ee][0],K[ee][1]])}!F&&L.isEnvelop&&(F=!0),u.result[C].geom=D,u.result[C].isline=F}return u}async pointQueryFeature(u){var v,_,b,M,P,C,L,D,F;const j=await this.execCommand("queryFeatures",{querytype:"point",zoom:(v=u.zoom)!==null&&v!==void 0?v:1,pixelToGeoLength:(_=u.pixelToGeoLength)!==null&&_!==void 0?_:void 0,layername:(b=u==null?void 0:u.layer)!==null&&b!==void 0?b:(M=this._cur_map_param)===null||M===void 0?void 0:M.layer,x:u.x,y:u.y,pixelsize:(P=u.pixelsize)!==null&&P!==void 0?P:5,maxReturnCount:(C=u.limit)!==null&&C!==void 0?C:void 0,maxGeomBytesSize:(L=u.maxGeomBytesSize)!==null&&L!==void 0?L:void 0,fields:(D=u.fields)!==null&&D!==void 0?D:"",geom:(F=u.geom)!==null&&F!==void 0?F:void 0},u.mapid,u.version);return this._processQueryResult(j)}async rectQueryFeature(u){var v,_,b,M,P,C,L;const D=await this.execCommand("queryFeatures",{querytype:"rect",zoom:(v=u.zoom)!==null&&v!==void 0?v:1,layername:(_=u==null?void 0:u.layer)!==null&&_!==void 0?_:(b=this._cur_map_param)===null||b===void 0?void 0:b.layer,x1:u.x1,y1:u.y1,x2:u.x2,y2:u.y2,maxReturnCount:(M=u.limit)!==null&&M!==void 0?M:void 0,maxGeomBytesSize:(P=u.maxGeomBytesSize)!==null&&P!==void 0?P:void 0,fields:(C=u.fields)!==null&&C!==void 0?C:"",geom:(L=u.geom)!==null&&L!==void 0?L:void 0},u.mapid,u.version);return this._processQueryResult(D)}async exprQueryFeature(u){var v,_,b,M,P,C,L,D;const F=await this.execCommand("queryFeatures",{querytype:"expresion",zoom:(v=u.zoom)!==null&&v!==void 0?v:1,layername:(_=u==null?void 0:u.layer)!==null&&_!==void 0?_:(b=this._cur_map_param)===null||b===void 0?void 0:b.layer,expr:u.expr,beginpos:u.beginpos,maxReturnCount:(M=u.limit)!==null&&M!==void 0?M:void 0,limit:(P=u.limit)!==null&&P!==void 0?P:void 0,fields:(C=u.fields)!==null&&C!==void 0?C:"",useCache:(L=u.useCache)!==null&&L!==void 0&&L,geom:(D=u.geom)!==null&&D!==void 0?D:void 0},u.mapid,u.version);return this._processQueryResult(F)}async conditionQueryFeature(u){var v,_,b,M,P,C,L,D,F,j;const K=await this.execCommand("queryFeatures",{querytype:"condition",zoom:(v=u.zoom)!==null&&v!==void 0?v:1,layername:(_=u==null?void 0:u.layer)!==null&&_!==void 0?_:(b=this._cur_map_param)===null||b===void 0?void 0:b.layer,condition:u.condition,beginpos:u.beginpos,maxReturnCount:(M=u.limit)!==null&&M!==void 0?M:void 0,limit:(P=u.limit)!==null&&P!==void 0?P:void 0,includegeom:(C=u.includegeom)!==null&&C!==void 0?C:void 0,realgeom:(L=u.realgeom)!==null&&L!==void 0?L:void 0,isContains:(D=u.isContains)!==null&&D!==void 0?D:void 0,fields:(F=u.fields)!==null&&F!==void 0?F:"",bounds:u.bounds?JSON.stringify(u.bounds):"",geom:(j=u.geom)!==null&&j!==void 0?j:void 0},u.mapid,u.version);return this._processQueryResult(K)}getMapLayers(){var u;let v=(u=this._cur_map_param)===null||u===void 0?void 0:u.layers;if(!v)throw Error("\u8C03\u7528\u6B64\u51FD\u6570\u524D\uFF0C\u8BF7\u786E\u4FDD\u5DF2\u901A\u8FC7 openMap \u51FD\u6570\u6253\u5F00\u4E86\u5730\u56FE\u3002");v=JSON.parse(v);const _=[];for(const b of v)_.push({name:b.name,color:b.color,index:b.index,isFrozen:b.isFrozen,isLocked:b.isLocked,isOff:b.isOff,lineWeight:b.lineWeight});return _}async cmdSwitchLayers(u){const v=this.currentMapParam(),_=v&&v.darkMode,b=await this.execCommand("switchlayer",{visibleLayer:u,darkMode:_});return this._cur_map_param&&(this._cur_map_param.layer=b.layerid),b}async cmdUpdateStyle(u){var v,_,b,M,P,C,L,D,F,j;const K=await this.execCommand("updateStyle",{stylename:u&&(v=u.name)!==null&&v!==void 0?v:"",layeron:u&&(_=this._to_layer_string(u.layeron))!==null&&_!==void 0?_:"",layeroff:u&&(b=this._to_layer_string(u.layeroff))!==null&&b!==void 0?b:"",clipbounds:u&&u.clipbounds?JSON.stringify(typeof u.clipbounds=="number"?[u.clipbounds,0,0,0]:u.clipbounds):"",bkcolor:u&&(M=u.backcolor)!==null&&M!==void 0?M:"",lineweight:u&&u.lineweight?JSON.stringify(u.lineweight):"",expression:u&&(P=u.expression)!==null&&P!==void 0?P:""},(C=u.mapid)!==null&&C!==void 0?C:(L=this._cur_map_param)===null||L===void 0?void 0:L.mapid,(j=(D=u.version)!==null&&D!==void 0?D:(F=this._cur_map_param)===null||F===void 0?void 0:F.version)!==null&&j!==void 0?j:"v1");return this._cur_map_param&&(this._cur_map_param.layer=K.layerid),K}async cmdSliceLayer(u){var v,_,b,M,P,C,L;return await this.execCommand("slicelayer",{layer:(v=u==null?void 0:u.layer)!==null&&v!==void 0?v:(_=this._cur_map_param)===null||_===void 0?void 0:_.layer,zoom:Math.min(u.zoom,16),ismvt:u.ismvt,iscancel:u.iscancel},(b=u.mapid)!==null&&b!==void 0?b:(M=this._cur_map_param)===null||M===void 0?void 0:M.mapid,(L=(P=u.version)!==null&&P!==void 0?P:(C=this._cur_map_param)===null||C===void 0?void 0:C.version)!==null&&L!==void 0?L:"v1")}async createStyle(u,v,_,b){var M,P,C;return b=b==null||b,v=v!=null?v:(M=this._cur_map_param)===null||M===void 0?void 0:M.mapid,_=(C=_!=null?_:(P=this._cur_map_param)===null||P===void 0?void 0:P.version)!==null&&C!==void 0?C:"v1",await this.execCommand("createMapStyle",Object.assign({geom:b},u),v,_)}async getStyleLayerName(u,v,_,b){let M=await this.metadata(u,v);if(!b){_=_==null||_;for(let P=0;P<M.styles.length;P++)if(M.styles[P].isgeom==_&&M.styles[P].issys)return M.styles[P].layername;for(let P=0;P<M.styles.length;P++)if(M.styles[P].isgeom==_)return M.styles[P].layername;return M.styles.length>0?M.styles[0].layername:""}for(let P=0;P<M.styles.length;P++)if(M.styles[P].name==b)return M.styles[P].layername}thumbnailUrl(u,v,_,b){var M,P,C;return u=u!=null?u:(M=this._cur_map_param)===null||M===void 0?void 0:M.mapid,v=(C=v!=null?v:(P=this._cur_map_param)===null||P===void 0?void 0:P.version)!==null&&C!==void 0?C:"v1",_=_!=null?_:100,b=b!=null?b:100,`${this._url("cmd")}/thumbnail/${u}/${v}/?width=${_}&height=${b}&token=${this.accessToken}`}wmsTileUrl(u){var v,_,b,M,P,C,L,D,F,j,K,ee,Q,le,pe;const de=(v=u.mapid)!==null&&v!==void 0?v:(_=this._cur_map_param)===null||_===void 0?void 0:_.mapid,Ee=(P=(b=u.version)!==null&&b!==void 0?b:(M=this._cur_map_param)===null||M===void 0?void 0:M.version)!==null&&P!==void 0?P:"v1",Pe=(C=u.layers)!==null&&C!==void 0?C:(L=this._cur_map_param)===null||L===void 0?void 0:L.layer,Je=(D=u.bbox)!==null&&D!==void 0?D:"{bbox-epsg-3857}",xt=(F=u.srs)!==null&&F!==void 0?F:"EPSG:3857",vt=(j=u.crs)!==null&&j!==void 0?j:"",ct=(K=u.mapbounds)!==null&&K!==void 0?K:"",Rt=(ee=u.width)!==null&&ee!==void 0?ee:256,Pt=(Q=u.height)!==null&&Q!==void 0?Q:256,nn=(le=u.transparent)===null||le===void 0||le,mn=(pe=u.fourParameter)!==null&&pe!==void 0?pe:"",cn=u.mvt===!0?".mvt":"";return`${this._url("cmd")}/wms/${de}/${Ee}${cn}?bbox=${Je}&mapbounds=${ct}&format=image/png&service=WMS&version=1.1.1&request=GetMap&srs=${xt}&transparent=${nn}&width=${Rt}&height=${Pt}&layers=${Pe}&crs=${vt}&fourParameter=${mn}&token=${this.accessToken}`}async cmdDeleteMap(u,v){return await this.execCommand("deletemap",{},u,v)}async cmdDeleteStyle(u){var v,_,b,M,P,C,L;const D=(v=u.mapid)!==null&&v!==void 0?v:(_=this._cur_map_param)===null||_===void 0?void 0:_.mapid,F=(P=(b=u.version)!==null&&b!==void 0?b:(M=this._cur_map_param)===null||M===void 0?void 0:M.version)!==null&&P!==void 0?P:"v1";return await this.execCommand("deletestyle",{styleid:(C=u.styleid)!==null&&C!==void 0?C:"",onlycleardata:(L=u.onlycleardata)!==null&&L!==void 0&&L},D,F)}async cmdDeleteCache(u){var v,_,b,M,P,C;const L=(v=u.mapid)!==null&&v!==void 0?v:(_=this._cur_map_param)===null||_===void 0?void 0:_.mapid,D=(P=(b=u.version)!==null&&b!==void 0?b:(M=this._cur_map_param)===null||M===void 0?void 0:M.version)!==null&&P!==void 0?P:"v1";return await this.execCommand("deletecache",{key:(C=u.key)!==null&&C!==void 0?C:""},L,D)}async cmdRunStatus(u){return await this.execCommand("runstatus",{detail:u!=null&&u})}async getConstData(){return this._constdata||(this._constdata=await this.execCommand("constData",{})),this._constdata}rasterBlankStyle(u,v,_){const b=_!=null?_:"rasterBlank";return this.rasterStyle(this.blankTileUrl(),u,v,b)}rasterLayerId(u){return(u!=null?u:"raster")+"-layer"}rasterSourceId(u){return(u!=null?u:"raster")+"-source"}rasterStyle(u,v,_,b){const M=b!=null?b:"raster";u=u!=null?u:this.rasterTileUrl();let P={};return this._spriteUrl&&(P.sprite=this._spriteUrl),Object.assign({version:8,sources:{[M+"-source"]:{type:"raster",tiles:[u],tileSize:256,minzoom:v!=null?v:0,maxzoom:_!=null?_:24}},glyphs:this.glyphsUrl(),layers:[{id:M+"-layer",type:"raster",source:M+"-source",minzoom:v!=null?v:0,maxzoom:_!=null?_:24,layout:{visibility:"visible"}}]},P)}vectorStyle(u,v,_,b,M,P,C){const L=b!=null?b:"vector";u=u!=null?u:this.vectorTileUrl();const D=this.currentMapParam(),F=D&&D.darkMode,j=["case",["boolean",["feature-state","hover"],!1],M!=null?M:F?"rgba(87,255,201,255)":"rgba(0,0,255,255)",["case",["==",["get","color"],"#757675"],F?"#FFFFFF":"#000000",["get","color"]]];let K={};return this._spriteUrl&&(K.sprite=this._spriteUrl),Object.assign(Object.assign({version:8,sources:{[L+"-source"]:{type:"vector",tiles:[u],maxzoom:_!=null?_:25,minzoom:v!=null?v:0}},glyphs:this.glyphsUrl()},K),{layers:[{id:L+"-layer-polygons-border",type:"line",source:L+"-source","source-layer":"polygons",paint:{"line-color":j,"line-opacity":["case",["boolean",["feature-state","hover"],!1],P!=null?P:0,["get","alpha"]]}},{id:L+"-layer-polygons",type:"fill",source:L+"-source","source-layer":"polygons",paint:{"fill-color":j,"fill-antialias":!1,"fill-outline-color":j,"fill-opacity":["case",["boolean",["feature-state","hover"],!1],P!=null?P:.5,["get","alpha"]]},layout:{}},{id:L+"-layer-lines",type:"line",source:L+"-source","source-layer":"lines",layout:{"line-cap":"round"},paint:{"line-color":j,"line-opacity":["case",["boolean",["feature-state","hover"],!1],P!=null?P:.5,["get","alpha"]],"line-width":["case",["boolean",["feature-state","hover"],!1],C!=null?C:3,["get","linewidth"]]}},{id:L+"-layer-points",type:"circle",source:L+"-source","source-layer":"points",paint:{"circle-radius":["case",["boolean",["feature-state","hover"],!1],3,1],"circle-color":j,"circle-stroke-color":j}}]})}async getFontsCapacity(){let u={};const v=this.serviceUrl("capacity/fonts");return u=await this._get(v,{}),u&&"data"in u?u.data:u}async clearCache(u=""){let v={};const _=this.serviceUrl("clearCache");return v=await this._get(_,{prefix:u}),v&&"data"in v?v.data:v}webMapUrl(u){u.tileUrl=encodeURIComponent(u.tileUrl);const v=Object.keys(u).reduce((_,b)=>_+b+"="+u[b]+"&","");return`${this._svr_url_service}map/tile/web/{z}/{x}/{y}?${v}token=${this.accessToken}`}},w.openMapDarkStyle=function(){return{backcolor:0}}},function(he,w,U){he.exports=function(O){var I=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function g(P,C){var L=P[0],D=P[1],F=P[2],j=P[3];D=((D+=((F=((F+=((j=((j+=((L=((L+=(D&F|~D&j)+C[0]-680876936|0)<<7|L>>>25)+D|0)&D|~L&F)+C[1]-389564586|0)<<12|j>>>20)+L|0)&L|~j&D)+C[2]+606105819|0)<<17|F>>>15)+j|0)&j|~F&L)+C[3]-1044525330|0)<<22|D>>>10)+F|0,D=((D+=((F=((F+=((j=((j+=((L=((L+=(D&F|~D&j)+C[4]-176418897|0)<<7|L>>>25)+D|0)&D|~L&F)+C[5]+1200080426|0)<<12|j>>>20)+L|0)&L|~j&D)+C[6]-1473231341|0)<<17|F>>>15)+j|0)&j|~F&L)+C[7]-45705983|0)<<22|D>>>10)+F|0,D=((D+=((F=((F+=((j=((j+=((L=((L+=(D&F|~D&j)+C[8]+1770035416|0)<<7|L>>>25)+D|0)&D|~L&F)+C[9]-1958414417|0)<<12|j>>>20)+L|0)&L|~j&D)+C[10]-42063|0)<<17|F>>>15)+j|0)&j|~F&L)+C[11]-1990404162|0)<<22|D>>>10)+F|0,D=((D+=((F=((F+=((j=((j+=((L=((L+=(D&F|~D&j)+C[12]+1804603682|0)<<7|L>>>25)+D|0)&D|~L&F)+C[13]-40341101|0)<<12|j>>>20)+L|0)&L|~j&D)+C[14]-1502002290|0)<<17|F>>>15)+j|0)&j|~F&L)+C[15]+1236535329|0)<<22|D>>>10)+F|0,D=((D+=((F=((F+=((j=((j+=((L=((L+=(D&j|F&~j)+C[1]-165796510|0)<<5|L>>>27)+D|0)&F|D&~F)+C[6]-1069501632|0)<<9|j>>>23)+L|0)&D|L&~D)+C[11]+643717713|0)<<14|F>>>18)+j|0)&L|j&~L)+C[0]-373897302|0)<<20|D>>>12)+F|0,D=((D+=((F=((F+=((j=((j+=((L=((L+=(D&j|F&~j)+C[5]-701558691|0)<<5|L>>>27)+D|0)&F|D&~F)+C[10]+38016083|0)<<9|j>>>23)+L|0)&D|L&~D)+C[15]-660478335|0)<<14|F>>>18)+j|0)&L|j&~L)+C[4]-405537848|0)<<20|D>>>12)+F|0,D=((D+=((F=((F+=((j=((j+=((L=((L+=(D&j|F&~j)+C[9]+568446438|0)<<5|L>>>27)+D|0)&F|D&~F)+C[14]-1019803690|0)<<9|j>>>23)+L|0)&D|L&~D)+C[3]-187363961|0)<<14|F>>>18)+j|0)&L|j&~L)+C[8]+1163531501|0)<<20|D>>>12)+F|0,D=((D+=((F=((F+=((j=((j+=((L=((L+=(D&j|F&~j)+C[13]-1444681467|0)<<5|L>>>27)+D|0)&F|D&~F)+C[2]-51403784|0)<<9|j>>>23)+L|0)&D|L&~D)+C[7]+1735328473|0)<<14|F>>>18)+j|0)&L|j&~L)+C[12]-1926607734|0)<<20|D>>>12)+F|0,D=((D+=((F=((F+=((j=((j+=((L=((L+=(D^F^j)+C[5]-378558|0)<<4|L>>>28)+D|0)^D^F)+C[8]-2022574463|0)<<11|j>>>21)+L|0)^L^D)+C[11]+1839030562|0)<<16|F>>>16)+j|0)^j^L)+C[14]-35309556|0)<<23|D>>>9)+F|0,D=((D+=((F=((F+=((j=((j+=((L=((L+=(D^F^j)+C[1]-1530992060|0)<<4|L>>>28)+D|0)^D^F)+C[4]+1272893353|0)<<11|j>>>21)+L|0)^L^D)+C[7]-155497632|0)<<16|F>>>16)+j|0)^j^L)+C[10]-1094730640|0)<<23|D>>>9)+F|0,D=((D+=((F=((F+=((j=((j+=((L=((L+=(D^F^j)+C[13]+681279174|0)<<4|L>>>28)+D|0)^D^F)+C[0]-358537222|0)<<11|j>>>21)+L|0)^L^D)+C[3]-722521979|0)<<16|F>>>16)+j|0)^j^L)+C[6]+76029189|0)<<23|D>>>9)+F|0,D=((D+=((F=((F+=((j=((j+=((L=((L+=(D^F^j)+C[9]-640364487|0)<<4|L>>>28)+D|0)^D^F)+C[12]-421815835|0)<<11|j>>>21)+L|0)^L^D)+C[15]+530742520|0)<<16|F>>>16)+j|0)^j^L)+C[2]-995338651|0)<<23|D>>>9)+F|0,D=((D+=((j=((j+=(D^((L=((L+=(F^(D|~j))+C[0]-198630844|0)<<6|L>>>26)+D|0)|~F))+C[7]+1126891415|0)<<10|j>>>22)+L|0)^((F=((F+=(L^(j|~D))+C[14]-1416354905|0)<<15|F>>>17)+j|0)|~L))+C[5]-57434055|0)<<21|D>>>11)+F|0,D=((D+=((j=((j+=(D^((L=((L+=(F^(D|~j))+C[12]+1700485571|0)<<6|L>>>26)+D|0)|~F))+C[3]-1894986606|0)<<10|j>>>22)+L|0)^((F=((F+=(L^(j|~D))+C[10]-1051523|0)<<15|F>>>17)+j|0)|~L))+C[1]-2054922799|0)<<21|D>>>11)+F|0,D=((D+=((j=((j+=(D^((L=((L+=(F^(D|~j))+C[8]+1873313359|0)<<6|L>>>26)+D|0)|~F))+C[15]-30611744|0)<<10|j>>>22)+L|0)^((F=((F+=(L^(j|~D))+C[6]-1560198380|0)<<15|F>>>17)+j|0)|~L))+C[13]+1309151649|0)<<21|D>>>11)+F|0,D=((D+=((j=((j+=(D^((L=((L+=(F^(D|~j))+C[4]-145523070|0)<<6|L>>>26)+D|0)|~F))+C[11]-1120210379|0)<<10|j>>>22)+L|0)^((F=((F+=(L^(j|~D))+C[2]+718787259|0)<<15|F>>>17)+j|0)|~L))+C[9]-343485551|0)<<21|D>>>11)+F|0,P[0]=L+P[0]|0,P[1]=D+P[1]|0,P[2]=F+P[2]|0,P[3]=j+P[3]|0}function a(P){var C,L=[];for(C=0;C<64;C+=4)L[C>>2]=P.charCodeAt(C)+(P.charCodeAt(C+1)<<8)+(P.charCodeAt(C+2)<<16)+(P.charCodeAt(C+3)<<24);return L}function l(P){var C,L=[];for(C=0;C<64;C+=4)L[C>>2]=P[C]+(P[C+1]<<8)+(P[C+2]<<16)+(P[C+3]<<24);return L}function n(P){var C,L,D,F,j,K,ee=P.length,Q=[1732584193,-271733879,-1732584194,271733878];for(C=64;C<=ee;C+=64)g(Q,a(P.substring(C-64,C)));for(L=(P=P.substring(C-64)).length,D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C=0;C<L;C+=1)D[C>>2]|=P.charCodeAt(C)<<(C%4<<3);if(D[C>>2]|=128<<(C%4<<3),C>55)for(g(Q,D),C=0;C<16;C+=1)D[C]=0;return F=(F=8*ee).toString(16).match(/(.*?)(.{0,8})$/),j=parseInt(F[2],16),K=parseInt(F[1],16)||0,D[14]=j,D[15]=K,g(Q,D),Q}function u(P){var C,L="";for(C=0;C<4;C+=1)L+=I[P>>8*C+4&15]+I[P>>8*C&15];return L}function v(P){var C;for(C=0;C<P.length;C+=1)P[C]=u(P[C]);return P.join("")}function _(P){return/[\u0080-\uFFFF]/.test(P)&&(P=unescape(encodeURIComponent(P))),P}function b(P){var C,L=[],D=P.length;for(C=0;C<D-1;C+=2)L.push(parseInt(P.substr(C,2),16));return String.fromCharCode.apply(String,L)}function M(){this.reset()}return v(n("hello")),typeof ArrayBuffer=="undefined"||ArrayBuffer.prototype.slice||function(){function P(C,L){return(C=0|C||0)<0?Math.max(C+L,0):Math.min(C,L)}ArrayBuffer.prototype.slice=function(C,L){var D,F,j,K,ee=this.byteLength,Q=P(C,ee),le=ee;return L!==O&&(le=P(L,ee)),Q>le?new ArrayBuffer(0):(D=le-Q,F=new ArrayBuffer(D),j=new Uint8Array(F),K=new Uint8Array(this,Q,D),j.set(K),F)}}(),M.prototype.append=function(P){return this.appendBinary(_(P)),this},M.prototype.appendBinary=function(P){this._buff+=P,this._length+=P.length;var C,L=this._buff.length;for(C=64;C<=L;C+=64)g(this._hash,a(this._buff.substring(C-64,C)));return this._buff=this._buff.substring(C-64),this},M.prototype.end=function(P){var C,L,D=this._buff,F=D.length,j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(C=0;C<F;C+=1)j[C>>2]|=D.charCodeAt(C)<<(C%4<<3);return this._finish(j,F),L=v(this._hash),P&&(L=b(L)),this.reset(),L},M.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},M.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},M.prototype.setState=function(P){return this._buff=P.buff,this._length=P.length,this._hash=P.hash,this},M.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},M.prototype._finish=function(P,C){var L,D,F,j=C;if(P[j>>2]|=128<<(j%4<<3),j>55)for(g(this._hash,P),j=0;j<16;j+=1)P[j]=0;L=(L=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),D=parseInt(L[2],16),F=parseInt(L[1],16)||0,P[14]=D,P[15]=F,g(this._hash,P)},M.hash=function(P,C){return M.hashBinary(_(P),C)},M.hashBinary=function(P,C){var L=v(n(P));return C?b(L):L},M.ArrayBuffer=function(){this.reset()},M.ArrayBuffer.prototype.append=function(P){var C,L,D,F,j,K=(L=this._buff.buffer,D=P,F=!0,(j=new Uint8Array(L.byteLength+D.byteLength)).set(new Uint8Array(L)),j.set(new Uint8Array(D),L.byteLength),F?j:j.buffer),ee=K.length;for(this._length+=P.byteLength,C=64;C<=ee;C+=64)g(this._hash,l(K.subarray(C-64,C)));return this._buff=C-64<ee?new Uint8Array(K.buffer.slice(C-64)):new Uint8Array(0),this},M.ArrayBuffer.prototype.end=function(P){var C,L,D=this._buff,F=D.length,j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(C=0;C<F;C+=1)j[C>>2]|=D[C]<<(C%4<<3);return this._finish(j,F),L=v(this._hash),P&&(L=b(L)),this.reset(),L},M.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},M.ArrayBuffer.prototype.getState=function(){var P,C=M.prototype.getState.call(this);return C.buff=(P=C.buff,String.fromCharCode.apply(null,new Uint8Array(P))),C},M.ArrayBuffer.prototype.setState=function(P){return P.buff=function(C,L){var D,F=C.length,j=new ArrayBuffer(F),K=new Uint8Array(j);for(D=0;D<F;D+=1)K[D]=C.charCodeAt(D);return L?K:j}(P.buff,!0),M.prototype.setState.call(this,P)},M.ArrayBuffer.prototype.destroy=M.prototype.destroy,M.ArrayBuffer.prototype._finish=M.prototype._finish,M.ArrayBuffer.hash=function(P,C){var L=v(function(D){var F,j,K,ee,Q,le,pe=D.length,de=[1732584193,-271733879,-1732584194,271733878];for(F=64;F<=pe;F+=64)g(de,l(D.subarray(F-64,F)));for(D=F-64<pe?D.subarray(F-64):new Uint8Array(0),j=D.length,K=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],F=0;F<j;F+=1)K[F>>2]|=D[F]<<(F%4<<3);if(K[F>>2]|=128<<(F%4<<3),F>55)for(g(de,K),F=0;F<16;F+=1)K[F]=0;return ee=(ee=8*pe).toString(16).match(/(.*?)(.{0,8})$/),Q=parseInt(ee[2],16),le=parseInt(ee[1],16)||0,K[14]=Q,K[15]=le,g(de,K),de}(new Uint8Array(P)));return C?b(L):L},M}()},function(he,w,U){async function O(){return(await(await function(a){var l=function(){return(l=Object.assign||function(we){for(var Oe,ke=1,dt=arguments.length;ke<dt;ke++)for(var mt in Oe=arguments[ke])Object.prototype.hasOwnProperty.call(Oe,mt)&&(we[mt]=Oe[mt]);return we}).apply(this,arguments)};function n(we,Oe,ke,dt){return new(ke||(ke=Promise))(function(mt,Dt){function Bt(kt){try{Ft(dt.next(kt))}catch(Qt){Dt(Qt)}}function Vt(kt){try{Ft(dt.throw(kt))}catch(Qt){Dt(Qt)}}function Ft(kt){var Qt;kt.done?mt(kt.value):(Qt=kt.value,Qt instanceof ke?Qt:new ke(function(Sn){Sn(Qt)})).then(Bt,Vt)}Ft((dt=dt.apply(we,Oe||[])).next())})}function u(we,Oe){var ke,dt,mt,Dt,Bt={label:0,sent:function(){if(1&mt[0])throw mt[1];return mt[1]},trys:[],ops:[]};return Dt={next:Vt(0),throw:Vt(1),return:Vt(2)},typeof Symbol=="function"&&(Dt[Symbol.iterator]=function(){return this}),Dt;function Vt(Ft){return function(kt){return function(Qt){if(ke)throw new TypeError("Generator is already executing.");for(;Bt;)try{if(ke=1,dt&&(mt=2&Qt[0]?dt.return:Qt[0]?dt.throw||((mt=dt.return)&&mt.call(dt),0):dt.next)&&!(mt=mt.call(dt,Qt[1])).done)return mt;switch(dt=0,mt&&(Qt=[2&Qt[0],mt.value]),Qt[0]){case 0:case 1:mt=Qt;break;case 4:return Bt.label++,{value:Qt[1],done:!1};case 5:Bt.label++,dt=Qt[1],Qt=[0];continue;case 7:Qt=Bt.ops.pop(),Bt.trys.pop();continue;default:if(!((mt=(mt=Bt.trys).length>0&&mt[mt.length-1])||Qt[0]!==6&&Qt[0]!==2)){Bt=0;continue}if(Qt[0]===3&&(!mt||Qt[1]>mt[0]&&Qt[1]<mt[3])){Bt.label=Qt[1];break}if(Qt[0]===6&&Bt.label<mt[1]){Bt.label=mt[1],mt=Qt;break}if(mt&&Bt.label<mt[2]){Bt.label=mt[2],Bt.ops.push(Qt);break}mt[2]&&Bt.ops.pop(),Bt.trys.pop();continue}Qt=Oe.call(we,Bt)}catch(Sn){Qt=[6,Sn],dt=0}finally{ke=mt=0}if(5&Qt[0])throw Qt[1];return{value:Qt[0]?Qt[1]:void 0,done:!0}}([Ft,kt])}}}function v(){for(var we=0,Oe=0,ke=arguments.length;Oe<ke;Oe++)we+=arguments[Oe].length;var dt=Array(we),mt=0;for(Oe=0;Oe<ke;Oe++)for(var Dt=arguments[Oe],Bt=0,Vt=Dt.length;Bt<Vt;Bt++,mt++)dt[mt]=Dt[Bt];return dt}function _(we,Oe){return new Promise(function(ke){return setTimeout(ke,we,Oe)})}function b(we,Oe){try{var ke=we();(dt=ke)&&typeof dt.then=="function"?ke.then(function(mt){return Oe(!0,mt)},function(mt){return Oe(!1,mt)}):Oe(!0,ke)}catch(mt){Oe(!1,mt)}var dt}function M(we,Oe,ke){return ke===void 0&&(ke=16),n(this,void 0,void 0,function(){var dt,mt,Dt;return u(this,function(Bt){switch(Bt.label){case 0:dt=Date.now(),mt=0,Bt.label=1;case 1:return mt<we.length?(Oe(we[mt],mt),(Dt=Date.now())>=dt+ke?(dt=Dt,[4,_(0)]):[3,3]):[3,4];case 2:Bt.sent(),Bt.label=3;case 3:return++mt,[3,1];case 4:return[2]}})})}function P(we,Oe){we=[we[0]>>>16,65535&we[0],we[1]>>>16,65535&we[1]],Oe=[Oe[0]>>>16,65535&Oe[0],Oe[1]>>>16,65535&Oe[1]];var ke=[0,0,0,0];return ke[3]+=we[3]+Oe[3],ke[2]+=ke[3]>>>16,ke[3]&=65535,ke[2]+=we[2]+Oe[2],ke[1]+=ke[2]>>>16,ke[2]&=65535,ke[1]+=we[1]+Oe[1],ke[0]+=ke[1]>>>16,ke[1]&=65535,ke[0]+=we[0]+Oe[0],ke[0]&=65535,[ke[0]<<16|ke[1],ke[2]<<16|ke[3]]}function C(we,Oe){we=[we[0]>>>16,65535&we[0],we[1]>>>16,65535&we[1]],Oe=[Oe[0]>>>16,65535&Oe[0],Oe[1]>>>16,65535&Oe[1]];var ke=[0,0,0,0];return ke[3]+=we[3]*Oe[3],ke[2]+=ke[3]>>>16,ke[3]&=65535,ke[2]+=we[2]*Oe[3],ke[1]+=ke[2]>>>16,ke[2]&=65535,ke[2]+=we[3]*Oe[2],ke[1]+=ke[2]>>>16,ke[2]&=65535,ke[1]+=we[1]*Oe[3],ke[0]+=ke[1]>>>16,ke[1]&=65535,ke[1]+=we[2]*Oe[2],ke[0]+=ke[1]>>>16,ke[1]&=65535,ke[1]+=we[3]*Oe[1],ke[0]+=ke[1]>>>16,ke[1]&=65535,ke[0]+=we[0]*Oe[3]+we[1]*Oe[2]+we[2]*Oe[1]+we[3]*Oe[0],ke[0]&=65535,[ke[0]<<16|ke[1],ke[2]<<16|ke[3]]}function L(we,Oe){return(Oe%=64)==32?[we[1],we[0]]:Oe<32?[we[0]<<Oe|we[1]>>>32-Oe,we[1]<<Oe|we[0]>>>32-Oe]:(Oe-=32,[we[1]<<Oe|we[0]>>>32-Oe,we[0]<<Oe|we[1]>>>32-Oe])}function D(we,Oe){return(Oe%=64)==0?we:Oe<32?[we[0]<<Oe|we[1]>>>32-Oe,we[1]<<Oe]:[we[1]<<Oe-32,0]}function F(we,Oe){return[we[0]^Oe[0],we[1]^Oe[1]]}function j(we){return we=F(we,[0,we[0]>>>1]),we=F(we=C(we,[4283543511,3981806797]),[0,we[0]>>>1]),F(we=C(we,[3301882366,444984403]),[0,we[0]>>>1])}function K(we,Oe){Oe=Oe||0;var ke,dt=(we=we||"").length%16,mt=we.length-dt,Dt=[0,Oe],Bt=[0,Oe],Vt=[0,0],Ft=[0,0],kt=[2277735313,289559509],Qt=[1291169091,658871167];for(ke=0;ke<mt;ke+=16)Vt=[255&we.charCodeAt(ke+4)|(255&we.charCodeAt(ke+5))<<8|(255&we.charCodeAt(ke+6))<<16|(255&we.charCodeAt(ke+7))<<24,255&we.charCodeAt(ke)|(255&we.charCodeAt(ke+1))<<8|(255&we.charCodeAt(ke+2))<<16|(255&we.charCodeAt(ke+3))<<24],Ft=[255&we.charCodeAt(ke+12)|(255&we.charCodeAt(ke+13))<<8|(255&we.charCodeAt(ke+14))<<16|(255&we.charCodeAt(ke+15))<<24,255&we.charCodeAt(ke+8)|(255&we.charCodeAt(ke+9))<<8|(255&we.charCodeAt(ke+10))<<16|(255&we.charCodeAt(ke+11))<<24],Vt=L(Vt=C(Vt,kt),31),Dt=P(Dt=L(Dt=F(Dt,Vt=C(Vt,Qt)),27),Bt),Dt=P(C(Dt,[0,5]),[0,1390208809]),Ft=L(Ft=C(Ft,Qt),33),Bt=P(Bt=L(Bt=F(Bt,Ft=C(Ft,kt)),31),Dt),Bt=P(C(Bt,[0,5]),[0,944331445]);switch(Vt=[0,0],Ft=[0,0],dt){case 15:Ft=F(Ft,D([0,we.charCodeAt(ke+14)],48));case 14:Ft=F(Ft,D([0,we.charCodeAt(ke+13)],40));case 13:Ft=F(Ft,D([0,we.charCodeAt(ke+12)],32));case 12:Ft=F(Ft,D([0,we.charCodeAt(ke+11)],24));case 11:Ft=F(Ft,D([0,we.charCodeAt(ke+10)],16));case 10:Ft=F(Ft,D([0,we.charCodeAt(ke+9)],8));case 9:Ft=C(Ft=F(Ft,[0,we.charCodeAt(ke+8)]),Qt),Bt=F(Bt,Ft=C(Ft=L(Ft,33),kt));case 8:Vt=F(Vt,D([0,we.charCodeAt(ke+7)],56));case 7:Vt=F(Vt,D([0,we.charCodeAt(ke+6)],48));case 6:Vt=F(Vt,D([0,we.charCodeAt(ke+5)],40));case 5:Vt=F(Vt,D([0,we.charCodeAt(ke+4)],32));case 4:Vt=F(Vt,D([0,we.charCodeAt(ke+3)],24));case 3:Vt=F(Vt,D([0,we.charCodeAt(ke+2)],16));case 2:Vt=F(Vt,D([0,we.charCodeAt(ke+1)],8));case 1:Vt=C(Vt=F(Vt,[0,we.charCodeAt(ke)]),kt),Dt=F(Dt,Vt=C(Vt=L(Vt,31),Qt))}return Dt=P(Dt=F(Dt,[0,we.length]),Bt=F(Bt,[0,we.length])),Bt=P(Bt,Dt),Dt=P(Dt=j(Dt),Bt=j(Bt)),Bt=P(Bt,Dt),("00000000"+(Dt[0]>>>0).toString(16)).slice(-8)+("00000000"+(Dt[1]>>>0).toString(16)).slice(-8)+("00000000"+(Bt[0]>>>0).toString(16)).slice(-8)+("00000000"+(Bt[1]>>>0).toString(16)).slice(-8)}function ee(we){return parseInt(we)}function Q(we){return parseFloat(we)}function le(we,Oe){return typeof we=="number"&&isNaN(we)?Oe:we}function pe(we){return we.reduce(function(Oe,ke){return Oe+(ke?1:0)},0)}function de(we,Oe){if(Oe===void 0&&(Oe=1),Math.abs(Oe)>=1)return Math.round(we/Oe)*Oe;var ke=1/Oe;return Math.round(we*ke)/ke}function Ee(we){return we&&typeof we=="object"&&"message"in we?we:{message:we}}function Pe(we,Oe,ke){var dt=Object.keys(we).filter(function(Dt){return!function(Bt,Vt){for(var Ft=0,kt=Bt.length;Ft<kt;++Ft)if(Bt[Ft]===Vt)return!0;return!1}(ke,Dt)}),mt=Array(dt.length);return M(dt,function(Dt,Bt){mt[Bt]=function(Vt,Ft){var kt=function(Sn){return typeof Sn!="function"},Qt=new Promise(function(Sn){var Mn=Date.now();b(Vt.bind(null,Ft),function(){for(var ve=[],X=0;X<arguments.length;X++)ve[X]=arguments[X];var te=Date.now()-Mn;if(!ve[0])return Sn(function(){return{error:Ee(ve[1]),duration:te}});var xe=ve[1];if(kt(xe))return Sn(function(){return{value:xe,duration:te}});Sn(function(){return new Promise(function(Ie){var Ue=Date.now();b(xe,function(){for(var Qe=[],Ke=0;Ke<arguments.length;Ke++)Qe[Ke]=arguments[Ke];var Ve=te+Date.now()-Ue;if(!Qe[0])return Ie({error:Ee(Qe[1]),duration:Ve});Ie({value:Qe[1],duration:Ve})})})})})});return function(){return Qt.then(function(Sn){return Sn()})}}(we[Dt],Oe)}),function(){return n(this,void 0,void 0,function(){var Dt,Bt,Vt,Ft,kt,Qt;return u(this,function(Sn){switch(Sn.label){case 0:for(Dt={},Bt=0,Vt=dt;Bt<Vt.length;Bt++)Ft=Vt[Bt],Dt[Ft]=void 0;kt=Array(dt.length),Qt=function(){var Mn;return u(this,function(ve){switch(ve.label){case 0:return Mn=!0,[4,M(dt,function(X,te){kt[te]||(mt[te]?kt[te]=mt[te]().then(function(xe){return Dt[X]=xe}):Mn=!1)})];case 1:return ve.sent(),Mn?[2,"break"]:[4,_(1)];case 2:return ve.sent(),[2]}})},Sn.label=1;case 1:return[5,Qt()];case 2:if(Sn.sent()==="break")return[3,4];Sn.label=3;case 3:return[3,1];case 4:return[4,Promise.all(kt)];case 5:return Sn.sent(),[2,Dt]}})})}}function Je(){var we=window,Oe=navigator;return pe(["MSCSSMatrix"in we,"msSetImmediate"in we,"msIndexedDB"in we,"msMaxTouchPoints"in Oe,"msPointerEnabled"in Oe])>=4}function xt(){var we=window,Oe=navigator;return pe(["msWriteProfilerMark"in we,"MSStream"in we,"msLaunchUri"in Oe,"msSaveBlob"in Oe])>=3&&!Je()}function vt(){var we=window,Oe=navigator;return pe(["webkitPersistentStorage"in Oe,"webkitTemporaryStorage"in Oe,Oe.vendor.indexOf("Google")===0,"webkitResolveLocalFileSystemURL"in we,"BatteryManager"in we,"webkitMediaStream"in we,"webkitSpeechGrammar"in we])>=5}function ct(){var we=window,Oe=navigator;return pe(["ApplePayError"in we,"CSSPrimitiveValue"in we,"Counter"in we,Oe.vendor.indexOf("Apple")===0,"getStorageUpdates"in Oe,"WebKitMediaKeys"in we])>=4}function Rt(){var we=window;return pe(["safari"in we,!("DeviceMotionEvent"in we),!("ongestureend"in we),!("standalone"in navigator)])>=3}function Pt(){var we,Oe,ke=window;return pe(["buildID"in navigator,"MozAppearance"in((Oe=(we=document.documentElement)===null||we===void 0?void 0:we.style)!==null&&Oe!==void 0?Oe:{}),"onmozfullscreenchange"in ke,"mozInnerScreenX"in ke,"CSSMozDocumentRule"in ke,"CanvasCaptureMediaStream"in ke])>=4}function nn(){var we=document;return we.fullscreenElement||we.msFullscreenElement||we.mozFullScreenElement||we.webkitFullscreenElement||null}function mn(){var we=vt(),Oe=Pt();if(!we&&!Oe)return!1;var ke=window;return pe(["onorientationchange"in ke,"orientation"in ke,we&&!("SharedWorker"in ke),Oe&&/android/i.test(navigator.appVersion)])>=2}function cn(we){var Oe=new Error(we);return Oe.name=we,Oe}function ht(we,Oe,ke){var dt,mt,Dt;return ke===void 0&&(ke=50),n(this,void 0,void 0,function(){var Bt,Vt;return u(this,function(Ft){switch(Ft.label){case 0:Bt=document,Ft.label=1;case 1:return Bt.body?[3,3]:[4,_(ke)];case 2:return Ft.sent(),[3,1];case 3:Vt=Bt.createElement("iframe"),Ft.label=4;case 4:return Ft.trys.push([4,,10,11]),[4,new Promise(function(kt,Qt){Vt.onload=kt,Vt.onerror=Qt;var Sn=Vt.style;Sn.setProperty("display","block","important"),Sn.position="absolute",Sn.top="0",Sn.left="0",Sn.visibility="hidden",Oe&&"srcdoc"in Vt?Vt.srcdoc=Oe:Vt.src="about:blank",Bt.body.appendChild(Vt);var Mn=function(){var ve,X;((X=(ve=Vt.contentWindow)===null||ve===void 0?void 0:ve.document)===null||X===void 0?void 0:X.readyState)==="complete"?kt():setTimeout(Mn,10)};Mn()})];case 5:Ft.sent(),Ft.label=6;case 6:return((mt=(dt=Vt.contentWindow)===null||dt===void 0?void 0:dt.document)===null||mt===void 0?void 0:mt.body)?[3,8]:[4,_(ke)];case 7:return Ft.sent(),[3,6];case 8:return[4,we(Vt,Vt.contentWindow)];case 9:return[2,Ft.sent()];case 10:return(Dt=Vt.parentNode)===null||Dt===void 0||Dt.removeChild(Vt),[7];case 11:return[2]}})})}function un(we){for(var Oe=function(Ft){for(var kt,Qt,Sn="Unexpected syntax '"+Ft+"'",Mn=/^\s*([a-z-]*)(.*)$/i.exec(Ft),ve=Mn[1]||void 0,X={},te=/([.:#][\w-]+|\[.+?\])/gi,xe=function(Ke,Ve){X[Ke]=X[Ke]||[],X[Ke].push(Ve)};;){var Ie=te.exec(Mn[2]);if(!Ie)break;var Ue=Ie[0];switch(Ue[0]){case".":xe("class",Ue.slice(1));break;case"#":xe("id",Ue.slice(1));break;case"[":var Qe=/^\[([\w-]+)([~|^$*]?=("(.*?)"|([\w-]+)))?(\s+[is])?\]$/.exec(Ue);if(!Qe)throw new Error(Sn);xe(Qe[1],(Qt=(kt=Qe[4])!==null&&kt!==void 0?kt:Qe[5])!==null&&Qt!==void 0?Qt:"");break;default:throw new Error(Sn)}}return[ve,X]}(we),ke=Oe[0],dt=Oe[1],mt=document.createElement(ke!=null?ke:"div"),Dt=0,Bt=Object.keys(dt);Dt<Bt.length;Dt++){var Vt=Bt[Dt];mt.setAttribute(Vt,dt[Vt].join(" "))}return mt}var rn,wn,An=["monospace","sans-serif","serif"],dn=["sans-serif-thin","ARNO PRO","Agency FB","Arabic Typesetting","Arial Unicode MS","AvantGarde Bk BT","BankGothic Md BT","Batang","Bitstream Vera Sans Mono","Calibri","Century","Century Gothic","Clarendon","EUROSTILE","Franklin Gothic","Futura Bk BT","Futura Md BT","GOTHAM","Gill Sans","HELV","Haettenschweiler","Helvetica Neue","Humanst521 BT","Leelawadee","Letter Gothic","Levenim MT","Lucida Bright","Lucida Sans","Menlo","MS Mincho","MS Outlook","MS Reference Specialty","MS UI Gothic","MT Extra","MYRIAD PRO","Marlett","Meiryo UI","Microsoft Uighur","Minion Pro","Monotype Corsiva","PMingLiU","Pristina","SCRIPTINA","Segoe UI Light","Serifa","SimHei","Small Fonts","Staccato222 BT","TRAJAN PRO","Univers CE 55 Medium","Vrinda","ZWAdobeF"];function Lr(we){return we.rect(0,0,10,10),we.rect(2,2,6,6),!we.isPointInPath(5,5,"evenodd")}function oi(we,Oe){we.width=240,we.height=60,Oe.textBaseline="alphabetic",Oe.fillStyle="#f60",Oe.fillRect(100,1,62,20),Oe.fillStyle="#069",Oe.font='11pt "Times New Roman"';var ke="Cwm fjordbank gly "+String.fromCharCode(55357,56835);return Oe.fillText(ke,2,15),Oe.fillStyle="rgba(102, 204, 0, 0.2)",Oe.font="18pt Arial",Oe.fillText(ke,4,45),xi(we)}function kn(we,Oe){we.width=122,we.height=110,Oe.globalCompositeOperation="multiply";for(var ke=0,dt=[["#f2f",40,40],["#2ff",80,40],["#ff2",60,80]];ke<dt.length;ke++){var mt=dt[ke],Dt=mt[0],Bt=mt[1],Vt=mt[2];Oe.fillStyle=Dt,Oe.beginPath(),Oe.arc(Bt,Vt,40,0,2*Math.PI,!0),Oe.closePath(),Oe.fill()}return Oe.fillStyle="#f9c",Oe.arc(60,60,60,0,2*Math.PI,!0),Oe.arc(60,60,20,0,2*Math.PI,!0),Oe.fill("evenodd"),xi(we)}function xi(we){return we.toDataURL()}function co(){var we=this;return function(){if(wn===void 0){var Oe=function(){var ke=uo();zi(ke)?wn=setTimeout(Oe,2500):(rn=ke,wn=void 0)};Oe()}}(),function(){return n(we,void 0,void 0,function(){var Oe;return u(this,function(ke){switch(ke.label){case 0:return zi(Oe=uo())?rn?[2,v(rn)]:nn()?[4,(dt=document,(dt.exitFullscreen||dt.msExitFullscreen||dt.mozCancelFullScreen||dt.webkitExitFullscreen).call(dt))]:[3,2]:[3,2];case 1:ke.sent(),Oe=uo(),ke.label=2;case 2:return zi(Oe)||(rn=Oe),[2,Oe]}var dt})})}}function uo(){var we=screen;return[le(Q(we.availTop),null),le(Q(we.width)-Q(we.availWidth)-le(Q(we.availLeft),0),null),le(Q(we.height)-Q(we.availHeight)-le(Q(we.availTop),0),null),le(Q(we.availLeft),null)]}function zi(we){for(var Oe=0;Oe<4;++Oe)if(we[Oe])return!1;return!0}var Dr={abpIndo:["#Iklan-Melayang","#Kolom-Iklan-728","#SidebarIklan-wrapper",'a[title="7naga poker" i]','[title="ALIENBOLA" i]'],abpvn:["#quangcaomb",".i-said-no-thing-can-stop-me-warning.dark",".quangcao",'[href^="https://r88.vn/"]','[href^="https://zbet.vn/"]'],adBlockFinland:[".mainostila",".sponsorit",".ylamainos",'a[href*="/clickthrgh.asp?"]','a[href^="https://app.readpeak.com/ads"]'],adBlockPersian:["#navbar_notice_50",'a[href^="http://g1.v.fwmrm.net/ad/"]',".kadr",'TABLE[width="140px"]',"#divAgahi"],adBlockWarningRemoval:["#adblock_message",".adblockInfo",".deadblocker-header-bar",".no-ad-reminder","#AdBlockDialog"],adGuardAnnoyances:['amp-embed[type="zen"]',".hs-sosyal","#cookieconsentdiv",'div[class^="app_gdpr"]',".as-oil"],adGuardBase:["#ad-fullbanner2-billboard-outer",".stky-ad-footer",".BetterJsPopOverlay","#ad_300X250","#bannerfloat22"],adGuardChinese:['#piao_div_0[style*="width:140px;"]','a[href*=".ttz5.cn"]','a[href*=".yabovip2027.com/"]',".tm3all2h4b","#duilian_left"],adGuardFrench:["#anAdScGp300x25",'a[href*=".kfiopkln.com/"]','a[href^="https://jsecoin.com/o/?"]','a[href^="https://www.clickadu.com/?"]',".bandeauClosePub"],adGuardGerman:[".banneritemwerbung_head_1",".boxstartwerbung",".werbung3",'a[href^="http://www.eis.de/index.phtml?refid="]','a[href^="https://www.tipico.com/?affiliateId="]'],adGuardJapanese:["#kauli_yad_1",".adArticleSidetile",".ads_entrymore",'a[href^="http://ad2.trafficgate.net/"]','a[href^="http://www.rssad.jp/"]'],adGuardMobile:["amp-auto-ads","#mgid_iframe",".amp_ad","amp-sticky-ad",".plugin-blogroll"],adGuardRussian:['a[href^="https://ya-distrib.ru/r/"]','a[href^="https://ad.letmeads.com/"]',".reclama",'div[id^="smi2adblock"]','div[id^="AdFox_banner_"]'],adGuardSocial:['a[href^="//www.stumbleupon.com/submit?url="]','a[href^="//telegram.me/share/url?"]',".etsy-tweet","#inlineShare",".popup-social"],adGuardSpanishPortuguese:["#barraPublicidade","#Publicidade","#publiEspecial","#queTooltip",'[href^="http://ads.glispa.com/"]'],adGuardTrackingProtection:['amp-embed[type="taboola"]',"#qoo-counter",'a[href^="http://click.hotlog.ru/"]','a[href^="http://hitcounter.ru/top/stat.php"]','a[href^="http://top.mail.ru/jump"]'],adGuardTurkish:["#backkapat","#reklami",'a[href^="http://adserv.ontek.com.tr/"]','a[href^="http://izlenzi.com/campaign/"]','a[href^="http://www.installads.net/"]'],bulgarian:["td#freenet_table_ads","#newAd","#ea_intext_div",".lapni-pop-over","#xenium_hot_offers"],easyList:["#adlabelheader","#anAdScGame300x250","#adTakeOverLeft","#ad_LargeRec01","#adundergame"],easyListChina:['a[href*=".wensixuetang.com/"]','A[href*="/hth107.com/"]','.appguide-wrap[onclick*="bcebos.com"]',".frontpageAdvM","#taotaole"],easyListCookie:["#Button_Cookie","#CWCookie","#CookieCon","#DGPR","#PnlCookie"],easyListCzechSlovak:["#onlajny-stickers","#reklamni-box",".reklama-megaboard",".sklik",'[id^="sklikReklama"]'],easyListDutch:["#advertentie","#vipAdmarktBannerBlock",".adstekst",'a[href^="http://adserver.webads.nl/adclick/"]',"#semilo-lrectangle"],easyListGermany:["#nativendo-hometop",'a[href^="http://www.kontakt-vermittler.de/?wm="]',"#gwerbung",'a[href^="https://marketing.net.brillen.de/"]',".werbenbox"],easyListItaly:[".box_adv_annunci",".sb-box-pubbliredazionale",'a[href^="http://affiliazioniads.snai.it/"]','a[href^="https://adserver.html.it/"]','a[href^="https://affiliazioniads.snai.it/"]'],easyListLithuania:[".reklamos_tarpas",".reklamos_nuorodos",'img[alt="Reklaminis skydelis"]','img[alt="Dedikuoti.lt serveriai"]','img[alt="Hostingas Serveriai.lt"]'],estonian:['A[href*="http://pay4results24.eu"]'],fanboyAnnoyances:["#feedback-tab","#taboola-below-article",".feedburnerFeedBlock",".widget-feedburner-counter",'[title="Subscribe to our blog"]'],fanboyAntiFacebook:[".util-bar-module-firefly-visible"],fanboyEnhancedTrackers:[".open.pushModal","#issuem-leaky-paywall-articles-zero-remaining-nag",'div[style*="box-shadow: rgb(136, 136, 136) 0px 0px 12px; color: "]','div[class$="-hide"][zoompage-fontsize][style="display: block;"]',".BlockNag__Card"],fanboySocial:[".td-tags-and-social-wrapper-box",".twitterContainer",".youtube-social",'a[title^="Like us on Facebook"]','img[alt^="Share on Digg"]'],frellwitSwedish:['a[href*="casinopro.se"][target="_blank"]','a[href*="doktor-se.onelink.me"]',"article.category-samarbete","div.holidAds","ul.adsmodern"],greekAdBlock:['A[href*="adman.otenet.gr/click?"]','A[href*="http://axiabanners.exodus.gr/"]','A[href*="http://interactive.forthnet.gr/click?"]',"DIV.agores300","TABLE.advright"],hungarian:['A[href*="ad.eval.hu"]','A[href*="ad.netmedia.hu"]','A[href*="daserver.ultraweb.hu"]',"#cemp_doboz",".optimonk-iframe-container"],iDontCareAboutCookies:['.alert-info[data-block-track*="CookieNotice"]',".ModuleTemplateCookieIndicator",".o--cookies--container",".cookie-msg-info-container","#cookies-policy-sticky"],icelandicAbp:['A[href^="/framework/resources/forms/ads.aspx"]'],latvian:['a[href="http://www.salidzini.lv/"][style="display: block; width: 120px; height: 40px; overflow: hidden; position: relative;"]','a[href="http://www.salidzini.lv/"][style="display: block; width: 88px; height: 31px; overflow: hidden; position: relative;"]'],listKr:['a[href*="//kingtoon.slnk.kr"]','a[href*="//playdsb.com/kr"]',"div.logly-lift-adz",'div[data-widget_id="ml6EJ074"]',"ins.daum_ddn_area"],listeAr:[".geminiLB1Ad",".right-and-left-sponsers",'a[href*=".aflam.info"]','a[href*="booraq.org"]','a[href*="dubizzle.com/ar/?utm_source="]'],listeFr:['a[href^="http://promo.vador.com/"]',"#adcontainer_recherche",'a[href*="weborama.fr/fcgi-bin/"]',".site-pub-interstitiel",'div[id^="crt-"][data-criteo-id]'],officialPolish:["#ceneo-placeholder-ceneo-12",'[href^="https://aff.sendhub.pl/"]','a[href^="http://advmanager.techfun.pl/redirect/"]','a[href^="http://www.trizer.pl/?utm_source"]',"div#skapiec_ad"],ro:['a[href^="//afftrk.altex.ro/Counter/Click"]','a[href^="/magazin/"]','a[href^="https://blackfridaysales.ro/trk/shop/"]','a[href^="https://event.2performant.com/events/click"]','a[href^="https://l.profitshare.ro/"]'],ruAd:['a[href*="//febrare.ru/"]','a[href*="//utimg.ru/"]','a[href*="://chikidiki.ru"]',"#pgeldiz",".yandex-rtb-block"],thaiAds:["a[href*=macau-uta-popup]","#ads-google-middle_rectangle-group",".ads300s",".bumq",".img-kosana"],webAnnoyancesUltralist:["#mod-social-share-2","#social-tools",".ctpl-fullbanner",".zergnet-recommend",".yt.btn-link.btn-md.btn"]};function Eo(we){var Oe;return n(this,void 0,void 0,function(){var ke,dt,mt,Dt,Bt,Vt,Ft;return u(this,function(kt){switch(kt.label){case 0:for(ke=document,dt=ke.createElement("div"),mt=new Array(we.length),Dt={},Dn(dt),Ft=0;Ft<we.length;++Ft)Bt=un(we[Ft]),Dn(Vt=ke.createElement("div")),Vt.appendChild(Bt),dt.appendChild(Vt),mt[Ft]=Bt;kt.label=1;case 1:return ke.body?[3,3]:[4,_(50)];case 2:return kt.sent(),[3,1];case 3:ke.body.appendChild(dt);try{for(Ft=0;Ft<we.length;++Ft)mt[Ft].offsetParent||(Dt[we[Ft]]=!0)}finally{(Oe=dt.parentNode)===null||Oe===void 0||Oe.removeChild(dt)}return[2,Dt]}})})}function Dn(we){we.style.setProperty("display","block","important")}function Hi(we){return matchMedia("(inverted-colors: "+we+")").matches}function Oi(we){return matchMedia("(forced-colors: "+we+")").matches}function Mr(we){return matchMedia("(prefers-contrast: "+we+")").matches}function si(we){return matchMedia("(prefers-reduced-motion: "+we+")").matches}function pi(we){return matchMedia("(dynamic-range: "+we+")").matches}var In=Math,tr=function(){return 0},Fi={default:[],apple:[{font:"-apple-system-body"}],serif:[{fontFamily:"serif"}],sans:[{fontFamily:"sans-serif"}],mono:[{fontFamily:"monospace"}],min:[{fontSize:"1px"}],system:[{fontFamily:"system-ui"}]},$r={fonts:function(){return ht(function(we,Oe){var ke=Oe.document,dt=ke.body;dt.style.fontSize="48px";var mt=ke.createElement("div"),Dt={},Bt={},Vt=function(Sn){var Mn=ke.createElement("span"),ve=Mn.style;return ve.position="absolute",ve.top="0",ve.left="0",ve.fontFamily=Sn,Mn.textContent="mmMwWLliI0O&1",mt.appendChild(Mn),Mn},Ft=An.map(Vt),kt=function(){for(var Sn={},Mn=function(te){Sn[te]=An.map(function(xe){return function(Ie,Ue){return Vt("'"+Ie+"',"+Ue)}(te,xe)})},ve=0,X=dn;ve<X.length;ve++)Mn(X[ve]);return Sn}();dt.appendChild(mt);for(var Qt=0;Qt<An.length;Qt++)Dt[An[Qt]]=Ft[Qt].offsetWidth,Bt[An[Qt]]=Ft[Qt].offsetHeight;return dn.filter(function(Sn){return Mn=kt[Sn],An.some(function(ve,X){return Mn[X].offsetWidth!==Dt[ve]||Mn[X].offsetHeight!==Bt[ve]});var Mn})})},domBlockers:function(we){var Oe=(we===void 0?{}:we).debug;return n(this,void 0,void 0,function(){var ke,dt,mt,Dt;return u(this,function(Bt){switch(Bt.label){case 0:return ct()||mn()?(ke=Object.keys(Dr),[4,Eo((Dt=[]).concat.apply(Dt,ke.map(function(Vt){return Dr[Vt]})))]):[2,void 0];case 1:return dt=Bt.sent(),Oe&&function(Vt){for(var Ft="DOM blockers debug:\n```",kt=0,Qt=Object.keys(Dr);kt<Qt.length;kt++){var Sn=Qt[kt];Ft+=`
`+Sn+":";for(var Mn=0,ve=Dr[Sn];Mn<ve.length;Mn++){var X=ve[Mn];Ft+=`
  `+X+" "+(Vt[X]?"\xF0\u0178\u0161\xAB":"\xE2\u017E\xA1\xEF\xB8\x8F")}}console.log(Ft+"\n```")}(dt),(mt=ke.filter(function(Vt){var Ft=Dr[Vt];return pe(Ft.map(function(kt){return dt[kt]}))>.6*Ft.length})).sort(),[2,mt]}})})},fontPreferences:function(){return function(we,Oe){return Oe===void 0&&(Oe=4e3),ht(function(ke,dt){var mt=dt.document,Dt=mt.body,Bt=Dt.style;Bt.width=Oe+"px",Bt.webkitTextSizeAdjust=Bt.textSizeAdjust="none",vt()?Dt.style.zoom=""+1/dt.devicePixelRatio:ct()&&(Dt.style.zoom="reset");var Vt=mt.createElement("div");return Vt.textContent=v(Array(Oe/20<<0)).map(function(){return"word"}).join(" "),Dt.appendChild(Vt),function(Ft,kt){for(var Qt={},Sn={},Mn=0,ve=Object.keys(Fi);Mn<ve.length;Mn++){var X=ve[Mn],te=Fi[X],xe=te[0],Ie=xe===void 0?{}:xe,Ue=te[1],Qe=Ue===void 0?"mmMwWLliI0fiflO&1":Ue,Ke=Ft.createElement("span");Ke.textContent=Qe,Ke.style.whiteSpace="nowrap";for(var Ve=0,et=Object.keys(Ie);Ve<et.length;Ve++){var gt=et[Ve],jt=Ie[gt];jt!==void 0&&(Ke.style[gt]=jt)}Qt[X]=Ke,kt.appendChild(Ft.createElement("br")),kt.appendChild(Ke)}for(var yt=0,Xt=Object.keys(Fi);yt<Xt.length;yt++)Sn[X=Xt[yt]]=Qt[X].getBoundingClientRect().width;return Sn}(mt,Dt)},'<!doctype html><html><head><meta name="viewport" content="width=device-width, initial-scale=1">')}()},audio:function(){var we=window,Oe=we.OfflineAudioContext||we.webkitOfflineAudioContext;if(!Oe)return-2;if(ct()&&!Rt()&&!function(){var kt=window;return pe(["DOMRectList"in kt,"RTCPeerConnectionIceEvent"in kt,"SVGGeometryElement"in kt,"ontransitioncancel"in kt])>=3}())return-1;var ke=new Oe(1,5e3,44100),dt=ke.createOscillator();dt.type="triangle",dt.frequency.value=1e4;var mt=ke.createDynamicsCompressor();mt.threshold.value=-50,mt.knee.value=40,mt.ratio.value=12,mt.attack.value=0,mt.release.value=.25,dt.connect(mt),mt.connect(ke.destination),dt.start(0);var Dt=function(kt){var Qt=function(){};return[new Promise(function(Sn,Mn){var ve=!1,X=0,te=0;kt.oncomplete=function(Ue){return Sn(Ue.renderedBuffer)};var xe=function(){setTimeout(function(){return Mn(cn("timeout"))},Math.min(500,te+5e3-Date.now()))},Ie=function(){try{switch(kt.startRendering(),kt.state){case"running":te=Date.now(),ve&&xe();break;case"suspended":document.hidden||X++,ve&&X>=3?Mn(cn("suspended")):setTimeout(Ie,500)}}catch(Ue){Mn(Ue)}};Ie(),Qt=function(){ve||(ve=!0,te>0&&xe())}}),Qt]}(ke),Bt=Dt[0],Vt=Dt[1],Ft=Bt.then(function(kt){return function(Qt){for(var Sn=0,Mn=0;Mn<Qt.length;++Mn)Sn+=Math.abs(Qt[Mn]);return Sn}(kt.getChannelData(0).subarray(4500))},function(kt){if(kt.name==="timeout"||kt.name==="suspended")return-3;throw kt});return Ft.catch(function(){}),function(){return Vt(),Ft}},screenFrame:function(){var we=this,Oe=co();return function(){return n(we,void 0,void 0,function(){var ke,dt;return u(this,function(mt){switch(mt.label){case 0:return[4,Oe()];case 1:return ke=mt.sent(),[2,[(dt=function(Dt){return Dt===null?null:de(Dt,10)})(ke[0]),dt(ke[1]),dt(ke[2]),dt(ke[3])]]}})})}},osCpu:function(){return navigator.oscpu},languages:function(){var we,Oe=navigator,ke=[],dt=Oe.language||Oe.userLanguage||Oe.browserLanguage||Oe.systemLanguage;if(dt!==void 0&&ke.push([dt]),Array.isArray(Oe.languages))vt()&&pe([!("MediaSettingsRange"in(we=window)),"RTCEncodedAudioFrame"in we,""+we.Intl=="[object Intl]",""+we.Reflect=="[object Reflect]"])>=3||ke.push(Oe.languages);else if(typeof Oe.languages=="string"){var mt=Oe.languages;mt&&ke.push(mt.split(","))}return ke},colorDepth:function(){return window.screen.colorDepth},deviceMemory:function(){return le(Q(navigator.deviceMemory),void 0)},screenResolution:function(){var we=screen,Oe=function(dt){return le(ee(dt),null)},ke=[Oe(we.width),Oe(we.height)];return ke.sort().reverse(),ke},hardwareConcurrency:function(){return le(ee(navigator.hardwareConcurrency),void 0)},timezone:function(){var we,Oe=(we=window.Intl)===null||we===void 0?void 0:we.DateTimeFormat;if(Oe){var ke=new Oe().resolvedOptions().timeZone;if(ke)return ke}var dt,mt=(dt=new Date().getFullYear(),-Math.max(Q(new Date(dt,0,1).getTimezoneOffset()),Q(new Date(dt,6,1).getTimezoneOffset())));return"UTC"+(mt>=0?"+":"")+Math.abs(mt)},sessionStorage:function(){try{return!!window.sessionStorage}catch{return!0}},localStorage:function(){try{return!!window.localStorage}catch{return!0}},indexedDB:function(){if(!Je()&&!xt())try{return!!window.indexedDB}catch{return!0}},openDatabase:function(){return!!window.openDatabase},cpuClass:function(){return navigator.cpuClass},platform:function(){var we=navigator.platform;return we==="MacIntel"&&ct()&&!Rt()?function(){if(navigator.platform==="iPad")return!0;var Oe=screen,ke=Oe.width/Oe.height;return pe(["MediaSource"in window,!!Element.prototype.webkitRequestFullscreen,ke>.65&&ke<1.53])>=2}()?"iPad":"iPhone":we},plugins:function(){var we=navigator.plugins;if(we){for(var Oe=[],ke=0;ke<we.length;++ke){var dt=we[ke];if(dt){for(var mt=[],Dt=0;Dt<dt.length;++Dt){var Bt=dt[Dt];mt.push({type:Bt.type,suffixes:Bt.suffixes})}Oe.push({name:dt.name,description:dt.description,mimeTypes:mt})}}return Oe}},canvas:function(){var we=function(){var dt=document.createElement("canvas");return dt.width=1,dt.height=1,[dt,dt.getContext("2d")]}(),Oe=we[0],ke=we[1];return function(dt,mt){return!(!mt||!dt.toDataURL)}(Oe,ke)?{winding:Lr(ke),geometry:kn(Oe,ke),text:oi(Oe,ke)}:{winding:!1,geometry:"",text:""}},touchSupport:function(){var we,Oe=navigator,ke=0;Oe.maxTouchPoints!==void 0?ke=ee(Oe.maxTouchPoints):Oe.msMaxTouchPoints!==void 0&&(ke=Oe.msMaxTouchPoints);try{document.createEvent("TouchEvent"),we=!0}catch{we=!1}return{maxTouchPoints:ke,touchEvent:we,touchStart:"ontouchstart"in window}},vendor:function(){return navigator.vendor||""},vendorFlavors:function(){for(var we=[],Oe=0,ke=["chrome","safari","__crWeb","__gCrWeb","yandex","__yb","__ybro","__firefox__","__edgeTrackingPreventionStatistics","webkit","oprt","samsungAr","ucweb","UCShellJava","puffinDevice"];Oe<ke.length;Oe++){var dt=ke[Oe],mt=window[dt];mt&&typeof mt=="object"&&we.push(dt)}return we.sort()},cookiesEnabled:function(){var we=document;try{we.cookie="cookietest=1; SameSite=Strict;";var Oe=we.cookie.indexOf("cookietest=")!==-1;return we.cookie="cookietest=1; SameSite=Strict; expires=Thu, 01-Jan-1970 00:00:01 GMT",Oe}catch{return!1}},colorGamut:function(){for(var we=0,Oe=["rec2020","p3","srgb"];we<Oe.length;we++){var ke=Oe[we];if(matchMedia("(color-gamut: "+ke+")").matches)return ke}},invertedColors:function(){return!!Hi("inverted")||!Hi("none")&&void 0},forcedColors:function(){return!!Oi("active")||!Oi("none")&&void 0},monochrome:function(){if(matchMedia("(min-monochrome: 0)").matches){for(var we=0;we<=100;++we)if(matchMedia("(max-monochrome: "+we+")").matches)return we;throw new Error("Too high value")}},contrast:function(){return Mr("no-preference")?0:Mr("high")||Mr("more")?1:Mr("low")||Mr("less")?-1:Mr("forced")?10:void 0},reducedMotion:function(){return!!si("reduce")||!si("no-preference")&&void 0},hdr:function(){return!!pi("high")||!pi("standard")&&void 0},math:function(){var we,Oe=In.acos||tr,ke=In.acosh||tr,dt=In.asin||tr,mt=In.asinh||tr,Dt=In.atanh||tr,Bt=In.atan||tr,Vt=In.sin||tr,Ft=In.sinh||tr,kt=In.cos||tr,Qt=In.cosh||tr,Sn=In.tan||tr,Mn=In.tanh||tr,ve=In.exp||tr,X=In.expm1||tr,te=In.log1p||tr;return{acos:Oe(.12312423423423424),acosh:ke(1e308),acoshPf:(we=1e154,In.log(we+In.sqrt(we*we-1))),asin:dt(.12312423423423424),asinh:mt(1),asinhPf:In.log(1+In.sqrt(2)),atanh:Dt(.5),atanhPf:In.log(3)/2,atan:Bt(.5),sin:Vt(-1e300),sinh:Ft(1),sinhPf:In.exp(1)-1/In.exp(1)/2,cos:kt(10.000000000123),cosh:Qt(1),coshPf:(In.exp(1)+1/In.exp(1))/2,tan:Sn(-1e300),tanh:Mn(1),tanhPf:(In.exp(2)-1)/(In.exp(2)+1),exp:ve(1),expm1:X(1),expm1Pf:In.exp(1)-1,log1p:te(10),log1pPf:In.log(11),powPI:In.pow(In.PI,-100)}}};function Xi(we){if(mn())return .4;if(ct())return Rt()?.5:.3;var Oe=we.platform.value||"";return/^Win/.test(Oe)?.6:/^Mac/.test(Oe)?.5:.7}function Vr(we){return de(.99+.01*we,1e-4)}function gr(we){return JSON.stringify(we,function(Oe,ke){return ke instanceof Error?l({name:(dt=ke).name,message:dt.message,stack:(mt=dt.stack)===null||mt===void 0?void 0:mt.split(`
`)},dt):ke;var dt,mt},2)}function ei(we){return K(function(Oe){for(var ke="",dt=0,mt=Object.keys(Oe).sort();dt<mt.length;dt++){var Dt=mt[dt],Bt=Oe[Dt],Vt=Bt.error?"error":JSON.stringify(Bt.value);ke+=(ke?"|":"")+Dt.replace(/([:|\\])/g,"\\$1")+":"+Vt}return ke}(we))}function ho(we){return we===void 0&&(we=50),function(Oe,ke){ke===void 0&&(ke=1/0);var dt=window.requestIdleCallback;return dt?new Promise(function(mt){return dt.call(window,function(){return mt()},{timeout:ke})}):_(Math.min(Oe,ke))}(we,2*we)}function Ji(we,Oe){var ke=Date.now();return{get:function(dt){return n(this,void 0,void 0,function(){var mt,Dt,Bt;return u(this,function(Vt){switch(Vt.label){case 0:return mt=Date.now(),[4,we()];case 1:return Dt=Vt.sent(),Bt=function(Ft){var kt;return{get visitorId(){return kt===void 0&&(kt=ei(this.components)),kt},set visitorId(Qt){kt=Qt},confidence:function(Qt){var Sn=Xi(Qt),Mn=Vr(Sn);return{score:Sn,comment:"$ if upgrade to Pro: https://fpjs.dev/pro".replace(/\$/g,""+Mn)}}(Ft),components:Ft,version:"3.3.0"}}(Dt),(Oe||(dt==null?void 0:dt.debug))&&console.log("Copy the text below to get the debug data:\n\n```\nversion: "+Bt.version+`
userAgent: `+navigator.userAgent+`
timeBetweenLoadAndGet: `+(mt-ke)+`
visitorId: `+Bt.visitorId+`
components: `+gr(Dt)+"\n```"),[2,Bt]}})})}}}function Ki(we){var Oe=we===void 0?{}:we,ke=Oe.delayFallback,dt=Oe.debug;return n(this,void 0,void 0,function(){return u(this,function(mt){switch(mt.label){case 0:return[4,ho(ke)];case 1:return mt.sent(),[2,Ji(Pe($r,{debug:dt},[]),dt)]}})})}var Io={load:Ki,hashComponents:ei,componentsToDebugString:gr},jo=K;return a.componentsToDebugString=gr,a.default=Io,a.getFullscreenElement=nn,a.getProConfidenceScore=function(){for(var we=[],Oe=0;Oe<arguments.length;Oe++)we[Oe]=arguments[Oe];return Vr(Xi.apply(void 0,we))},a.getScreenFrame=co,a.hashComponents=ei,a.isAndroid=mn,a.isChromium=vt,a.isDesktopSafari=Rt,a.isEdgeHTML=xt,a.isGecko=Pt,a.isTrident=Je,a.isWebKit=ct,a.load=Ki,a.loadSources=Pe,a.murmurX64Hash128=jo,a.prepareForSources=ho,a.sources=$r,a}({}).load()).get()).visitorId}Object.defineProperty(w,"__esModule",{value:!0}),w.getVisitorId=void 0,w.getVisitorId=function(){let I="";return async()=>(I||(I=await O()),I)}},function(he,w,U){var O=this&&this.__createBinding||(Object.create?function(g,a,l,n){n===void 0&&(n=l),Object.defineProperty(g,n,{enumerable:!0,get:function(){return a[l]}})}:function(g,a,l,n){n===void 0&&(n=l),g[n]=a[l]}),I=this&&this.__exportStar||function(g,a){for(var l in g)l==="default"||a.hasOwnProperty(l)||O(a,g,l)};Object.defineProperty(w,"__esModule",{value:!0}),I(U(102),w),I(U(103),w),I(U(104),w),I(U(105),w),I(U(106),w),I(U(3),w),I(U(107),w),I(U(8),w),I(U(108),w),I(U(109),w),I(U(110),w),I(U(111),w),I(U(112),w),I(U(113),w),I(U(114),w),I(U(115),w),I(U(116),w),I(U(117),w),I(U(118),w),I(U(119),w),I(U(46),w),I(U(120),w),I(U(4),w),I(U(121),w),I(U(122),w),I(U(123),w),I(U(124),w),I(U(125),w),I(U(126),w),I(U(127),w),I(U(128),w),I(U(129),w)},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbDocument=void 0,w.DbDocument=class{constructor(O={}){for(const I in O)this[I]=O[I]}appendEntity(O){var I;O&&(this.entitys=(I=this.entitys)!==null&&I!==void 0?I:[],Array.isArray(O)?this.entitys=[...this.entitys,...O]:this.entitys.push(O))}appendLayer(O){var I;O&&(this.layers=(I=this.layers)!==null&&I!==void 0?I:[],Array.isArray(O)?this.layers=[...this.layers,...O]:this.layers.push(O))}appendTextStyle(O){var I;O&&(this.textStyles=(I=this.textStyles)!==null&&I!==void 0?I:[],Array.isArray(O)?this.textStyles=[...this.textStyles,...O]:this.textStyles.push(O))}appendDimStyle(O){var I;O&&(this.dimStyles=(I=this.dimStyles)!==null&&I!==void 0?I:[],Array.isArray(O)?this.dimStyles=[...this.dimStyles,...O]:this.dimStyles.push(O))}appendLinetype(O){var I;O&&(this.linetypes=(I=this.linetypes)!==null&&I!==void 0?I:[],Array.isArray(O)?this.linetypes=[...this.linetypes,...O]:this.linetypes.push(O))}appendBlock(O){var I;O&&(this.blocks=(I=this.blocks)!==null&&I!==void 0?I:[],Array.isArray(O)?this.blocks=[...this.blocks,...O]:this.blocks.push(O))}toDoc(O){const I={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(g){var a,l,n,u,v,_,b,M="",P=0;for(g=I._utf8_encode(g);P<g.length;)u=(a=g.charCodeAt(P++))>>2,v=(3&a)<<4|(l=g.charCodeAt(P++))>>4,_=(15&l)<<2|(n=g.charCodeAt(P++))>>6,b=63&n,isNaN(l)?_=b=64:isNaN(n)&&(b=64),M=M+this._keyStr.charAt(u)+this._keyStr.charAt(v)+this._keyStr.charAt(_)+this._keyStr.charAt(b);return M},_utf8_encode:function(g){g=g.replace(/\r\n/g,`
`);for(var a="",l=0;l<g.length;l++){var n=g.charCodeAt(l);n<128?a+=String.fromCharCode(n):n>127&&n<2048?(a+=String.fromCharCode(n>>6|192),a+=String.fromCharCode(63&n|128)):(a+=String.fromCharCode(n>>12|224),a+=String.fromCharCode(n>>6&63|128),a+=String.fromCharCode(63&n|128))}return a}};return"data:application/dwg;base64,"+I.encode(O!=null?O:JSON.stringify(this))}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbLayer=void 0,w.DbLayer=class{constructor(O={}){for(const I in O)this[I]=O[I]}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbBlock=void 0,w.DbBlock=class{constructor(O={}){for(const I in O)this[I]=O[I]}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbTextStyle=void 0,w.DbTextStyle=class{constructor(O={}){for(const I in O)this[I]=O[I]}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbLineType=void 0,w.DbLineType=class{constructor(O={}){for(const I in O)this[I]=O[I]}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbLine=void 0;const O=U(3);class I extends O.DbEntity{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbLine"}}w.DbLine=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbPolyline=void 0;const O=U(8);class I extends O.DbCurve{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbPolyline"}}w.DbPolyline=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.Db2dPolyline=void 0;const O=U(8);class I extends O.DbCurve{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="Db2dPolyline"}}w.Db2dPolyline=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.Db3dPolyline=void 0;const O=U(8);class I extends O.DbCurve{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="Db3dPolyline"}}w.Db3dPolyline=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbSpline=void 0;const O=U(8);class I extends O.DbCurve{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbSpline"}}w.DbSpline=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbArc=void 0;const O=U(8);class I extends O.DbCurve{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbArc"}}w.DbArc=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbCircle=void 0;const O=U(8);class I extends O.DbCurve{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbCircle"}}w.DbCircle=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbEllipse=void 0;const O=U(8);class I extends O.DbCurve{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbEllipse"}}w.DbEllipse=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbBlockReference=void 0;const O=U(3);class I extends O.DbEntity{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbBlockReference"}}w.DbBlockReference=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbHatch=void 0;const O=U(3);class I extends O.DbEntity{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbHatch"}}w.DbHatch=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbText=void 0;const O=U(3);class I extends O.DbEntity{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbText"}}w.DbText=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbMText=void 0;const O=U(3);class I extends O.DbEntity{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbMText"}}w.DbMText=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbShape=void 0;const O=U(3);class I extends O.DbEntity{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbShape"}}w.DbShape=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbWipeout=void 0;const O=U(46);class I extends O.DbRasterImage{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbWipeout"}}w.DbWipeout=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.Db2LineAngularDimension=void 0;const O=U(4);class I extends O.DbDimension{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="Db2LineAngularDimension"}}w.Db2LineAngularDimension=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.Db3PointAngularDimension=void 0;const O=U(4);class I extends O.DbDimension{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="Db3PointAngularDimension"}}w.Db3PointAngularDimension=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbAlignedDimension=void 0;const O=U(4);class I extends O.DbDimension{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbAlignedDimension"}}w.DbAlignedDimension=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbArcDimension=void 0;const O=U(4);class I extends O.DbDimension{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbArcDimension"}}w.DbArcDimension=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbDiametricDimension=void 0;const O=U(4);class I extends O.DbDimension{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbDiametricDimension"}}w.DbDiametricDimension=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbOrdinateDimension=void 0;const O=U(4);class I extends O.DbDimension{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbOrdinateDimension"}}w.DbOrdinateDimension=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbRadialDimension=void 0;const O=U(4);class I extends O.DbDimension{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbRadialDimension"}}w.DbRadialDimension=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbRadialDimensionLarge=void 0;const O=U(4);class I extends O.DbDimension{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbRadialDimensionLarge"}}w.DbRadialDimensionLarge=I},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DbRotatedDimension=void 0;const O=U(4);class I extends O.DbDimension{constructor(a={}){super(a);for(const l in a)this[l]=a[l];this.typename="DbRotatedDimension"}}w.DbRotatedDimension=I},function(he,w,U){var O=this&&this.__createBinding||(Object.create?function(ht,un,rn,wn){wn===void 0&&(wn=rn),Object.defineProperty(ht,wn,{enumerable:!0,get:function(){return un[rn]}})}:function(ht,un,rn,wn){wn===void 0&&(wn=rn),ht[wn]=un[rn]}),I=this&&this.__exportStar||function(ht,un){for(var rn in ht)rn==="default"||un.hasOwnProperty(rn)||O(un,ht,rn)};Object.defineProperty(w,"__esModule",{value:!0});var g=U(47);Object.defineProperty(w,"createAnimation",{enumerable:!0,get:function(){return g.createAnimation}});var a=U(134);Object.defineProperty(w,"inertia",{enumerable:!0,get:function(){return a.inertia}});var l=U(50);Object.defineProperty(w,"decay",{enumerable:!0,get:function(){return l.decay}});var n=U(53);Object.defineProperty(w,"spring",{enumerable:!0,get:function(){return n.spring}});var u=U(51);Object.defineProperty(w,"keyframes",{enumerable:!0,get:function(){return u.keyframes}});var v=U(135);Object.defineProperty(w,"angle",{enumerable:!0,get:function(){return v.angle}});var _=U(136);Object.defineProperty(w,"applyOffset",{enumerable:!0,get:function(){return _.applyOffset}});var b=U(137);Object.defineProperty(w,"createAttractor",{enumerable:!0,get:function(){return b.createAttractor}}),Object.defineProperty(w,"attract",{enumerable:!0,get:function(){return b.attract}}),Object.defineProperty(w,"attractExpo",{enumerable:!0,get:function(){return b.attractExpo}});var M=U(15);Object.defineProperty(w,"clamp",{enumerable:!0,get:function(){return M.clamp}});var P=U(56);Object.defineProperty(w,"degreesToRadians",{enumerable:!0,get:function(){return P.degreesToRadians}});var C=U(138);Object.defineProperty(w,"distance",{enumerable:!0,get:function(){return C.distance}});var L=U(20);Object.defineProperty(w,"interpolate",{enumerable:!0,get:function(){return L.interpolate}});var D=U(57);Object.defineProperty(w,"isPoint3D",{enumerable:!0,get:function(){return D.isPoint3D}});var F=U(25);Object.defineProperty(w,"isPoint",{enumerable:!0,get:function(){return F.isPoint}});var j=U(21);Object.defineProperty(w,"mixColor",{enumerable:!0,get:function(){return j.mixColor}});var K=U(48);Object.defineProperty(w,"mixComplex",{enumerable:!0,get:function(){return K.mixComplex}});var ee=U(16);Object.defineProperty(w,"mix",{enumerable:!0,get:function(){return ee.mix}});var Q=U(23);Object.defineProperty(w,"pipe",{enumerable:!0,get:function(){return Q.pipe}});var le=U(139);Object.defineProperty(w,"pointFromVector",{enumerable:!0,get:function(){return le.pointFromVector}});var pe=U(49);Object.defineProperty(w,"progress",{enumerable:!0,get:function(){return pe.progress}});var de=U(55);Object.defineProperty(w,"radiansToDegrees",{enumerable:!0,get:function(){return de.radiansToDegrees}});var Ee=U(58);Object.defineProperty(w,"smoothFrame",{enumerable:!0,get:function(){return Ee.smoothFrame}});var Pe=U(140);Object.defineProperty(w,"smooth",{enumerable:!0,get:function(){return Pe.smooth}});var Je=U(141);Object.defineProperty(w,"snap",{enumerable:!0,get:function(){return Je.snap}});var xt=U(59);Object.defineProperty(w,"toDecimal",{enumerable:!0,get:function(){return xt.toDecimal}});var vt=U(142);Object.defineProperty(w,"velocityPerFrame",{enumerable:!0,get:function(){return vt.velocityPerFrame}});var ct=U(54);Object.defineProperty(w,"velocityPerSecond",{enumerable:!0,get:function(){return ct.velocityPerSecond}});var Rt=U(143);Object.defineProperty(w,"wrap",{enumerable:!0,get:function(){return Rt.wrap}});var Pt=U(24);Object.defineProperty(w,"linear",{enumerable:!0,get:function(){return Pt.linear}}),Object.defineProperty(w,"easeIn",{enumerable:!0,get:function(){return Pt.easeIn}}),Object.defineProperty(w,"easeInOut",{enumerable:!0,get:function(){return Pt.easeInOut}}),Object.defineProperty(w,"easeOut",{enumerable:!0,get:function(){return Pt.easeOut}}),Object.defineProperty(w,"circIn",{enumerable:!0,get:function(){return Pt.circIn}}),Object.defineProperty(w,"circInOut",{enumerable:!0,get:function(){return Pt.circInOut}}),Object.defineProperty(w,"circOut",{enumerable:!0,get:function(){return Pt.circOut}}),Object.defineProperty(w,"backIn",{enumerable:!0,get:function(){return Pt.backIn}}),Object.defineProperty(w,"backInOut",{enumerable:!0,get:function(){return Pt.backInOut}}),Object.defineProperty(w,"backOut",{enumerable:!0,get:function(){return Pt.backOut}}),Object.defineProperty(w,"anticipate",{enumerable:!0,get:function(){return Pt.anticipate}}),Object.defineProperty(w,"bounceIn",{enumerable:!0,get:function(){return Pt.bounceIn}}),Object.defineProperty(w,"bounceInOut",{enumerable:!0,get:function(){return Pt.bounceInOut}}),Object.defineProperty(w,"bounceOut",{enumerable:!0,get:function(){return Pt.bounceOut}});var nn=U(144);Object.defineProperty(w,"cubicBezier",{enumerable:!0,get:function(){return nn.cubicBezier}});var mn=U(145);Object.defineProperty(w,"steps",{enumerable:!0,get:function(){return mn.steps}});var cn=U(52);Object.defineProperty(w,"mirrorEasing",{enumerable:!0,get:function(){return cn.mirrorEasing}}),Object.defineProperty(w,"reverseEasing",{enumerable:!0,get:function(){return cn.reverseEasing}}),Object.defineProperty(w,"createExpoIn",{enumerable:!0,get:function(){return cn.createExpoIn}}),Object.defineProperty(w,"createBackIn",{enumerable:!0,get:function(){return cn.createBackIn}}),Object.defineProperty(w,"createAnticipate",{enumerable:!0,get:function(){return cn.createAnticipate}}),I(U(146),w),I(U(147),w)},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.detectAnimationFromOptions=void 0;const O=U(50),I=U(51),g=U(53),a={keyframes:I.keyframes,spring:g.spring,decay:O.decay};w.detectAnimationFromOptions=function(l){if(Array.isArray(l.to))return I.keyframes;if(a[l.type])return a[l.type];const n=new Set(Object.keys(l));return n.has("ease")||n.has("duration")&&!n.has("dampingRatio")?I.keyframes:n.has("dampingRatio")||n.has("stiffness")||n.has("mass")||n.has("damping")||n.has("restSpeed")||n.has("restDelta")?g.spring:I.keyframes}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.calcAngularFreq=w.findSpring=w.maxDamping=w.minDamping=w.maxDuration=w.minDuration=void 0;const O=U(14),I=U(15);w.minDuration=.01,w.maxDuration=10,w.minDamping=.05,w.maxDamping=1,w.findSpring=function({duration:a=800,bounce:l=.25,velocity:n=0,mass:u=1}){let v,_;O.warning(a<=1e3*w.maxDuration,"Spring duration must be 10 seconds or less");let b=1-l;b=I.clamp(w.minDamping,w.maxDamping,b),a=I.clamp(w.minDuration,w.maxDuration,a/1e3),b<1?(v=P=>{const C=P*b,L=C*a;return .001-(C-n)/g(P,b)*Math.exp(-L)},_=P=>{const C=P*b*a,L=C*n+n,D=Math.pow(b,2)*Math.pow(P,2)*a,F=Math.exp(-C),j=g(Math.pow(P,2),b);return(.001-v(P)>0?-1:1)*((L-D)*F)/j}):(v=P=>Math.exp(-P*a)*((P-n)*a+1)-.001,_=P=>Math.exp(-P*a)*(a*a*(n-P)));const M=function(P,C,L){let D=L;for(let F=1;F<12;F++)D-=P(D)/C(D);return D}(v,_,5/a);if(a*=1e3,isNaN(M))return{stiffness:100,damping:10,duration:a};{const P=Math.pow(M,2)*u;return{stiffness:P,damping:2*b*Math.sqrt(u*P),duration:a}}};function g(a,l){return a*Math.sqrt(1-l*l)}w.calcAngularFreq=g},function(he,w,U){function O(I,g,a=0){return I-g-a}Object.defineProperty(w,"__esModule",{value:!0}),w.hasRepeatDelayElapsed=w.reverseElapsed=w.loopElapsed=void 0,w.loopElapsed=O,w.reverseElapsed=function(I,g,a=0,l=!0){return l?O(g+-I,g,a):g-(I-g)+a},w.hasRepeatDelayElapsed=function(I,g,a,l){return l?I>=g+a:I<=-a}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.inertia=void 0;const O=U(29),I=U(54),g=U(47);w.inertia=function({from:a=0,velocity:l=0,min:n,max:u,power:v=.8,timeConstant:_=750,bounceStiffness:b=500,bounceDamping:M=10,restDelta:P=1,modifyTarget:C,driver:L,onUpdate:D,onComplete:F,onStop:j}){let K;function ee(de){return n!==void 0&&de<n||u!==void 0&&de>u}function Q(de){return n===void 0?u:u===void 0||Math.abs(n-de)<Math.abs(u-de)?n:u}function le(de){K==null||K.stop(),K=g.createAnimation(Object.assign(Object.assign({},de),{driver:L,onUpdate:Ee=>{var Pe;D==null||D(Ee),(Pe=de.onUpdate)===null||Pe===void 0||Pe.call(de,Ee)},onComplete:F,onStop:j}))}function pe(de){le(Object.assign({type:"spring",stiffness:b,damping:M,restDelta:P},de))}if(ee(a))pe({from:a,velocity:l,to:Q(a)});else{let de=v*l+a;C!==void 0&&(de=C(de));const Ee=Q(de),Pe=Ee===n?-1:1;let Je,xt;const vt=ct=>{Je=xt,xt=ct,l=I.velocityPerSecond(ct-Je,O.getFrameData().delta),(Pe===1&&ct>Ee||Pe===-1&&ct<Ee)&&pe({from:ct,to:Ee,velocity:l})};le({type:"decay",from:a,velocity:l,timeConstant:_,power:v,restDelta:P,modifyTarget:C,onUpdate:ee(de)?vt:void 0})}return{stop:()=>K==null?void 0:K.stop()}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.angle=void 0;const O=U(22),I=U(55);w.angle=(g,a=O.zeroPoint)=>I.radiansToDegrees(Math.atan2(a.y-g.y,a.x-g.x))},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.applyOffset=void 0,w.applyOffset=(O,I)=>{let g=!0;return I===void 0&&(I=O,g=!1),a=>g?a-O+I:(O=a,g=!0,I)}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.attractExpo=w.attract=w.createAttractor=void 0;const O=I=>I;w.createAttractor=(I=O)=>(g,a,l)=>{const n=a-l,u=-(0-g+1)*(0-I(Math.abs(n)));return n<=0?a+u:a-u},w.attract=w.createAttractor(),w.attractExpo=w.createAttractor(Math.sqrt)},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.distance=void 0;const O=U(22),I=U(25),g=U(57),a=(l,n)=>Math.abs(l-n);w.distance=function(l,n){if(O.isNum(l)&&O.isNum(n))return a(l,n);if(I.isPoint(l)&&I.isPoint(n)){const u=a(l.x,n.x),v=a(l.y,n.y),_=g.isPoint3D(l)&&g.isPoint3D(n)?a(l.z,n.z):0;return Math.sqrt(u**2+v**2+_**2)}return 0}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.pointFromVector=void 0;const O=U(56);w.pointFromVector=(I,g,a)=>(g=O.degreesToRadians(g),{x:a*Math.cos(g)+I.x,y:a*Math.sin(g)+I.y})},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.smooth=void 0;const O=U(29),I=U(58);w.smooth=(g=50)=>{let a=0,l=0;return n=>{const u=O.getFrameData().timestamp,v=u!==l?u-l:0,_=v?I.smoothFrame(a,n,v,g):a;return l=u,a=_,_}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.snap=void 0,w.snap=O=>{if(typeof O=="number")return I=>Math.round(I/O)*O;{let I=0;const g=O.length;return a=>{let l=Math.abs(O[0]-a);for(I=1;I<g;I++){const n=O[I],u=Math.abs(n-a);if(u===0)return n;if(u>l)return O[I-1];if(I===g-1)return n;l=u}}}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.velocityPerFrame=void 0,w.velocityPerFrame=function(O,I){return O/(1e3/I)}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.wrap=void 0,w.wrap=(O,I,g)=>{const a=I-O;return((g-O)%a+a)%a+O}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.cubicBezier=void 0;const O=U(24),I=(u,v)=>1-3*v+3*u,g=(u,v)=>3*v-6*u,a=u=>3*u,l=(u,v,_)=>((I(v,_)*u+g(v,_))*u+a(v))*u,n=(u,v,_)=>3*I(v,_)*u*u+2*g(v,_)*u+a(v);w.cubicBezier=function(u,v,_,b){if(u===v&&_===b)return O.linear;const M=new Float32Array(11);for(let C=0;C<11;++C)M[C]=l(.1*C,u,_);function P(C){let L=0,D=1;for(;D!==10&&M[D]<=C;++D)L+=.1;--D;const F=L+.1*((C-M[D])/(M[D+1]-M[D])),j=n(F,u,_);return j>=.001?function(K,ee,Q,le){for(let pe=0;pe<8;++pe){const de=n(ee,Q,le);if(de===0)return ee;ee-=(l(ee,Q,le)-K)/de}return ee}(C,F,u,_):j===0?F:function(K,ee,Q,le,pe){let de,Ee,Pe=0;do Ee=ee+(Q-ee)/2,de=l(Ee,le,pe)-K,de>0?Q=Ee:ee=Ee;while(Math.abs(de)>1e-7&&++Pe<10);return Ee}(C,L,L+.1,u,_)}return C=>C===0||C===1?C:l(P(C),v,b)}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.steps=void 0;const O=U(15);w.steps=(I,g="end")=>a=>{const l=(a=g==="end"?Math.min(a,.999):Math.max(a,.001))*I,n=g==="end"?Math.floor(l):Math.ceil(l);return O.clamp(0,1,n/I)}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0})},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0})},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0});const O=U(2),I=U(19),g=U(5);g.Map.prototype.hasVectorLayer=function(){return!!this.getSource("vector-source")},g.Map.prototype.attach=function(a,l,n){this._svc=a,this.setProjection(l),this._attach_options=n},g.Map.prototype.getService=function(){return this._svc},g.Map.prototype.getAttachOptions=function(){return this._attach_options},g.Map.prototype.changeSourceTiles=function(a,l,n){let u=!!l;const v=Array.isArray(a)?a:[a];if(a.length!==0){if(!u){const _=!!this.getSource("raster-source"),b=!!this.getSource("vector-source");v[0].includes(".mvt")||v[0].includes(".pbf")?_?(this.disableLayerClickHighlight(),this.switchRasterToVectorStyle(v[0]),n||this.enableVectorLayerHoverHighlight(this._tempVectorHoverHighlightCb,this._tempVectorHoverHighlightPrefix)):u=!0:b?(this.disableVectorLayerHoverHighlight(),this.switchVectorToRasterStyle(v[0]),n||this.enableLayerClickHighlight()):u=!0}l=l!=null?l:this.getSource("raster-source")?"raster-source":"vector-source",u&&(this.getSource(l).tiles=v,typeof this.style._getSourceCache=="function"?(this.style._getSourceCache(l).clearTiles(),this.style._getSourceCache(l).update(this.transform)):(this.style.sourceCaches[l].clearTiles(),this.style.sourceCaches[l].update(this.transform)),this.triggerRepaint())}},g.Map.prototype.setProjection=function(a){this._proj=a},g.Map.prototype.getProjection=function(){return this._proj},g.Map.prototype.toLngLat=function(a){if(this._proj)return a instanceof g.LngLatBounds?new g.LngLatBounds(this._proj.toLngLat(a.getSouthWest()),this._proj.toLngLat(a.getNorthEast())):a instanceof O.GeoBounds?new g.LngLatBounds(this._proj.toLngLat(a.min),this._proj.toLngLat(a.max)):this._proj.toLngLat(a);{const l=O.GeoPoint.convert(a);return[l.x,l.y]}},g.Map.prototype.fromLngLat=function(a){return this._proj?a instanceof g.LngLatBounds?new O.GeoBounds(this._proj.fromLngLat(a.getSouthWest()),this._proj.fromLngLat(a.getNorthEast())):a instanceof O.GeoBounds?new O.GeoBounds(this._proj.fromLngLat(a.min),this._proj.fromLngLat(a.max)):this._proj.fromLngLat(a):O.GeoPoint.convert(a)},g.Map.prototype.switchRasterToVectorStyle=function(a,l,n,u,v,_,b,M){var P;const C=l!=null?l:"raster",L=v!=null?v:"vector";this.removeLayer(C+"-layer"),this.removeSource(C+"-source");const D=this.getService().vectorStyle(a,n,u,v,_,b,M);this.addSource(L+"-source",D.sources[L+"-source"]);for(const F of(P=D.layers)!==null&&P!==void 0?P:[])this.addLayer(F)},g.Map.prototype.switchVectorToRasterStyle=function(a,l,n,u,v){var _;const b=v!=null?v:"raster",M=l!=null?l:"vector",P=this.getService(),C=P.vectorStyle(a,n,u,l);for(const D of(_=C.layers)!==null&&_!==void 0?_:[])this.removeLayer(D.id);this.removeSource(M+"-source");const L=P.rasterStyle(a,n,u,v);this.addSource(b+"-source",L.sources[b+"-source"]),this.addLayer(L.layers[0])},g.Map.prototype.enableVectorLayerHoverHighlight=function(a,l){var n,u;const v=l!=null?l:"vector";this._tempevents=(n=this._tempevents)!==null&&n!==void 0?n:{},this._tempHoverFeatureId,this._tempHoverLayer="",this._tempHoverFeature,this._tempVectorHoverHighlightCb=a,this._tempVectorHoverHighlightPrefix=l;const _=this.getService().vectorStyle("",0,0,l);for(const b of(u=_.layers)!==null&&u!==void 0?u:[])b.id.includes("layer-polygons-border")||(this._tempevents["mousemove_"+b.id]=M=>{this.isInteracting()||M.features.length>0&&(M.features[0].id!=this._tempHoverFeatureId||b.id!=this._tempHoverLayer)&&(this._tempHoverFeatureId&&this._tempHoverLayer&&(this.setFeatureState({source:v+"-source",sourceLayer:this._tempHoverLayer,id:this._tempHoverFeatureId},{hover:!1}),a&&a("mouseleave",this._tempHoverFeature,this._tempHoverLayer,M)),this._tempHoverFeatureId=M.features[0].id,this._tempHoverLayer=M.features[0].sourceLayer,this._tempHoverFeature=M.features[0],this.setFeatureState({source:v+"-source",sourceLayer:this._tempHoverLayer,id:this._tempHoverFeatureId},{hover:!0}),a&&a("mousemove",this._tempHoverFeature,this._tempHoverLayer,M))},this.on("mousemove",b.id,this._tempevents["mousemove_"+b.id]),this._tempevents["mouseleave_"+b.id]=M=>{this.isInteracting()||(this._tempHoverFeatureId&&this._tempHoverLayer&&(this.setFeatureState({source:v+"-source",sourceLayer:this._tempHoverLayer,id:this._tempHoverFeatureId},{hover:!1}),a&&a("mouseleave",this._tempHoverFeature,this._tempHoverLayer,M)),this._tempHoverFeatureId=null,this._tempHoverLayer=null,this._tempHoverFeature=null)},this.on("mouseleave",b.id,this._tempevents["mouseleave_"+b.id]),this._tempevents["click_"+b.id]=M=>{this.isInteracting()||this._tempHoverFeatureId&&this._tempHoverLayer&&a&&a("click",this._tempHoverFeature,this._tempHoverLayer,M)},this.on("click",b.id,this._tempevents["click_"+b.id]))},g.Map.prototype.disableVectorLayerHoverHighlight=function(a){var l,n;if(!this._tempevents)return!1;const u=this.getService().vectorStyle("",0,0,a);for(const v of(l=u.layers)!==null&&l!==void 0?l:[])v.id.includes("layer-polygons-border")||(this._tempevents=(n=this._tempevents)!==null&&n!==void 0?n:{},this._tempevents["mousemove_"+v.id]&&this.off("mousemove",v.id,this._tempevents["mousemove_"+v.id]),this._tempevents["mouseleave_"+v.id]&&this.off("mouseleave",v.id,this._tempevents["mouseleave_"+v.id]),delete this._tempevents["mousemove_"+v.id],delete this._tempevents["mouseleave_"+v.id]);return this._tempevents=null,!0},g.Map.prototype.enableLayerClickHighlight=async function(a,l,n,u){var v;await this.onLoad();const _=a.currentMapParam(),b=_&&_.darkMode,M=u!=null?u:"highlight",P=n!=null?n:b?"#57FFC9":"#11F",C=()=>{this.addSource(M+"-source",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.addLayer({id:M+"-line-layer",type:"line",source:M+"-source",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":P,"line-width":3,"line-opacity":.8}}),this.addLayer({id:M+"-fill-layer",type:"fill",source:M+"-source",paint:{"fill-color":P,"fill-opacity":1}})},L=()=>{this.getSource(M+"-source")&&this.getSource(M+"-source").setData({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:[]}}]})};L(),this._tempevents=(v=this._tempevents)!==null&&v!==void 0?v:{},this._tempevents.map_click_highlight=async D=>{if(this.isInteracting())return;const F=this.fromLngLat(D.lngLat),j=await a.pointQueryFeature({zoom:this.getZoom(),x:F.x,y:F.y});j&&j.result&&j.result.length>0?(j.result[0].geom&&n!="#0000"&&(this.getSource(M+"-source")||C(),this.getSource(M+"-source").setData(j.result[0].geom),j.result[0].isline?(this.setLayoutProperty(M+"-line-layer","visibility","visible"),this.setLayoutProperty(M+"-fill-layer","visibility","none")):(this.setLayoutProperty(M+"-line-layer","visibility","none"),this.setLayoutProperty(M+"-fill-layer","visibility","visible")),this.triggerRepaint()),l&&l(j.result[0],D)):(L(),this.triggerRepaint(),l&&l(null,D))},this.on("click",this._tempevents.map_click_highlight)},g.Map.prototype.disableLayerClickHighlight=function(a){const l=a!=null?a:"highlight",n=!!this.getSource(l);return n&&(this.removeLayer(l+"-line-layer"),this.removeLayer(l+"-fill-layer"),this.removeSource(l+"-source")),this._tempevents&&this._tempevents.map_click_highlight&&(this.off("click",this._tempevents.map_click_highlight),delete this._tempevents.map_click_highlight),n},g.Map.prototype.switchLayers=async function(a,l){await a.cmdSwitchLayers(l);const n=!!this.getSource("vector-source");this.changeSourceTiles(n?a.vectorTileUrl():a.rasterTileUrl())},g.Map.prototype.updateStyle=async function(a,l){const n=await a.cmdUpdateStyle(l);n.boundsChange&&this.updateMapExtent(n.bounds);const u=!!this.getSource("vector-source");this.changeSourceTiles(u?a.vectorTileUrl():a.rasterTileUrl())},g.Map.prototype.updateMapExtent=function(a){let l;l=Array.isArray(a)?O.GeoBounds.fromArray(a):typeof a=="string"?O.GeoBounds.fromString(a):a;const n=new O.GeoProjection(l);return this.setProjection(n),n},g.Map.prototype.fitMapBounds=function(a,l,n){const u=this.getProjection().getMapExtent();a=a!=null?a:.7;const v=u.scale(a,u.center());return this.fitBounds([this.toLngLat(v.max),this.toLngLat(v.min)],l,n),this},g.Map.prototype.getGeoBounds=function(a){const l=this.getProjection().getMapExtent();return a=a!=null?a:.7,l.scale(a,l.center())},g.Map.prototype.getMarkers=function(){return this._markers},g.Map.prototype.projectEx=function(a){const l=this.transform.locationCoordinate(g.LngLat.convert(a)),n=[l.x*this.transform.worldSize,l.y*this.transform.worldSize,l.toAltitude(),1];return O.vec4.transformMat4(n,n,this.transform.pixelMatrix),new g.Point(n[0]/n[3],n[1]/n[3])},g.Map.prototype.createThreeJsContext=function(a){if(typeof vjThree!="function")throw Error("no vjThree environment, Please add vjThree plugins.");return window._global_map_=this,new vjThree(this,this.getCanvas().getContext("webgl"),a)},g.Map.prototype.pixelToGeoLength=function(a,l){return this.getProjection().getMapExtent().width()*a/(512*Math.pow(2,l))},g.Map.prototype.geoToPixelLength=function(a,l){return a/this.pixelToGeoLength()},g.Map.prototype.geoToMercatorLength=function(a){const l=this.getProjection().getMapExtent();return a*O.Projection.EQUATORIAL_SEMIPERIMETER*2/l.width()},g.Map.prototype.mercatorToGeoLength=function(a){return a*this.getProjection().getMapExtent().width()/(2*O.Projection.EQUATORIAL_SEMIPERIMETER)},g.Map.prototype.setCustomKeyValue=function(a,l){this._customObj=this._customObj||{},this._customObj[a]=l},g.Map.prototype.getCustomKeyValue=function(a){if(this._customObj)return this._customObj[a]},g.Map.prototype.isInteracting=function(){return!!this._isInteracting},g.Map.prototype.setIsInteracting=function(a){return this._isInteracting=a,!!this._isInteracting},g.Map.prototype.setError=function(a){this.setCustomKeyValue("mapOpenError",a),a&&this.fire("maperror",a)},g.Map.prototype.getError=function(){return this.getCustomKeyValue("mapOpenError")},g.Map.prototype.removeMarkers=function(){let a=[...this.getMarkers()];for(let l of a)l&&l.remove&&l.remove();this.fire("removeMarkers",a)},g.Map.prototype.removePopups=function(){let a=[...document.getElementsByClassName("vjmapgis-popup")];for(let l of a)l.remove();this.fire("removePopups",a)},g.Map.prototype.switchMap=async function(a,l,n,u,v){this.fire("mapopenstart",a);let _=this.getService();if(!_){let L="service is null";return this.setError(L),L}let b,M=await _.openMap(a);if(M.error)return this.setError(M.error),M.error;let P=!1;if(a.mapopenway===I.MapOpenWay.Memory?b=_.rasterTileUrl():(b=n?_.vectorTileUrl():_.rasterTileUrl(),P=!!n),l)this.changeSourceTiles(b);else{let L=!1;P&&(L=this.disableVectorLayerHoverHighlight());let D,F=this.getStyle().sources;for(let j in F)this.removeSourceEx(j);this.removeMarkers(),this.removePopups(),D=a.mapopenway===I.MapOpenWay.Memory?_.rasterStyle():n?_.vectorStyle():_.rasterStyle(),this.setStyle(D),L&&this.enableVectorLayerHoverHighlight(this._tempVectorHoverHighlightCb,this._tempVectorHoverHighlightPrefix)}let C=O.GeoBounds.fromString(M.bounds);this.updateMapExtent(C),u&&this.setCenter(this.toLngLat(C.center())),v&&this.fitMapBounds(),this.fire("mapopenfinish",M)},g.Map.prototype.getEnvelopBounds=function(a){let l=(a=(a=a.replace("POLYGON((","")).replace("))","")).split(","),n=[];for(let u=0;u<4;u++){l[u]=l[u].trim();let v=l[u].split(" "),_=+v[0],b=+v[1],M=this._proj.fromMercator([_,b]);n.push(M)}return O.GeoBounds.fromDataExtent(n)}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.MousePositionControl=void 0;const O=U(2);w.MousePositionControl=class{constructor(I={}){var g,a,l,n,u,v;this.digits=(g=I.digits)!==null&&g!==void 0?g:5,this.trackCenter=(a=I.trackCenter)!==null&&a!==void 0&&a,this.labelFormat=(l=I.labelFormat)!==null&&l!==void 0?l:this.defaultLabelFormat,this.prj=I.projection,this.showLatLng=(n=I.showLatLng)!==null&&n!==void 0&&n,this.showZoom=(u=I.showZoom)!==null&&u!==void 0&&u,this.style=(v=I.style)!==null&&v!==void 0?v:{backgroundColor:"hsla(0,0%,100%,.75)",border:"1px solid #333"},this.coord=new O.GeoPoint(0,0)}insertControl(){this.container=document.createElement("div"),this.container.classList.add("vjmapgis-ctrl"),this.container.style.border=this.style.border,this.container.style.backgroundColor=this.style.backgroundColor,this.panel=document.createElement("div"),this.trackCenter?this.onMouseMove():this.panel.innerHTML=this.labelFormat(0,0,0,0,this.map),this.container.appendChild(this.panel)}defaultLabelFormat(I,g,a,l){let n="";return n=this.showLatLng?`x:${a.toFixed(this.digits)},y:${l.toFixed(this.digits)};lng:${I.toFixed(this.digits)},lat:${g.toFixed(this.digits)};`:`${a.toFixed(this.digits)}, ${l.toFixed(this.digits)}`,this.showZoom&&(n+=", zoom: "+this.map.getZoom().toFixed(2)),n}onMouseMove(I){var g;if(this.trackCenter){const l=(g=this.map)===null||g===void 0?void 0:g.getCenter();this.coord=new O.GeoPoint(l==null?void 0:l.lng,l==null?void 0:l.lat)}else this.coord=new O.GeoPoint(I.lngLat.lng,I.lngLat.lat);let a=this.prj;if(a||(a=this.map.getProjection()),a){const l=a.fromLngLat(this.coord);this.panel.innerHTML=this.labelFormat(this.coord.x,this.coord.y,l.x,l.y,this.map)}}onAdd(I){return this.map=I,this.insertControl(),this.trackCenter?this.map.on("move",this.onMouseMove.bind(this)):this.map.on("mousemove",this.onMouseMove.bind(this)),this.container}onRemove(){var I;this.trackCenter?this.map.off("move",this.onMouseMove.bind(this)):this.map.off("mousemove",this.onMouseMove.bind(this)),(I=this.container.parentNode)===null||I===void 0||I.removeChild(this.container)}getDefaultPosition(){return"bottom-left"}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0});const O=U(5);O.Marker.prototype.setAnimation=function(a){const l=this.getElement();if(l&&l.children&&l.children[0])switch(this._animationType=a,a){case"MAP_ANIMATION_NONE":l.children[0].classList.remove("markerKeyframesImgAnimation"),l.children[0].classList.remove("markerKeyframesAnimationDrop");break;case"MAP_ANIMATION_BOUNCE":l.children[0].classList.remove("markerKeyframesAnimationDrop"),l.children[0].classList.add("markerKeyframesImgAnimation");break;case"MAP_ANIMATION_DROP":l.children[0].classList.remove("markerKeyframesImgAnimation"),l.children[0].classList.add("markerKeyframesAnimationDrop"),l.children[0].style.display==="none"&&setTimeout(()=>{l.children[0].style.display="block"},10);break;default:l.children[0].classList.remove("markerKeyframesImgAnimation"),l.children[0].classList.remove("markerKeyframesAnimationDrop")}},O.Marker.prototype.show=function(){this._visible=!0,this.getElement().style.display="block"},O.Marker.prototype.hide=function(){this._visible=!1,this.getElement().style.display="none"},O.Marker.prototype.setColor=function(a){this.getElement().querySelectorAll('svg g[fill="'+this._color+'"]')[0].setAttribute("fill",a),this._color=a},O.Marker.prototype.setCursor=function(a){this._cursor=a,this.getElement().style.cursor=a};const I=O.Marker.prototype.addTo;O.Marker.prototype.addTo=function(){this.type||(this.type="marker"),typeof I=="function"&&I.call(this,...arguments);const a=D=>this.fire("click",D),l=D=>this.fire("mousemove",D),n=D=>this.fire("mousedown",D),u=D=>this.fire("mouseup",D),v=D=>this.fire("mouseover",D),_=D=>this.fire("mouseleave",D),b=D=>this.fire("dblclick",D),M=D=>this.fire("contextmenu",D),P=D=>this.fire("touchstart",D),C=D=>this.fire("touchmove",D),L=D=>this.fire("touchend",D);this.getElement().addEventListener("click",a),this.getElement().addEventListener("mouseover",v),this.getElement().addEventListener("mouseleave",_),this.getElement().addEventListener("dblclick",b),this.getElement().addEventListener("contextmenu",M),this.getElement().addEventListener("touchstart",P),this.getElement().addEventListener("touchmove",C),this.getElement().addEventListener("touchend",L),this.getElement().addEventListener("mousedown",n),this.getElement().addEventListener("mousemove",l),this.getElement().addEventListener("mouseup",u),this._remove_evt=()=>{this.getElement().removeEventListener("click",a),this.getElement().removeEventListener("mouseover",v),this.getElement().removeEventListener("mouseleave",_),this.getElement().removeEventListener("dblclick",b),this.getElement().removeEventListener("contextmenu",M),this.getElement().removeEventListener("touchstart",P),this.getElement().removeEventListener("touchmove",C),this.getElement().removeEventListener("touchend",L),this.getElement().removeEventListener("mousedown",n),this.getElement().removeEventListener("mousemove",l),this.getElement().removeEventListener("mouseup",u)}};const g=O.Marker.prototype.remove;O.Marker.prototype.remove=function(){typeof this._remove_evt=="function"&&this._remove_evt.call(this),typeof g=="function"&&g.call(this,...arguments)}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0})},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0})},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.Text=void 0;const O=U(0),I=U(5);class g extends I.Evented{constructor(l){var n;super(),l=l!=null?l:{},this._style={};const u=O.Dom.create("div");u.className="vjmap-text";const v=O.Dom.create("div");v.className="vjmap-text-content";const _=O.Dom.create("div");_.className="text-content-container",_.innerHTML=(n=l.text)!==null&&n!==void 0?n:"",v.appendChild(_),this._textContainerDom=_,u.appendChild(v),this._marker=new I.Marker(u,l),this._marker.setEventedParent(this),this.setStyle(l.style),this.type="text"}addTo(l){return this._map=l,this._marker.addTo(l),this}remove(){return this._marker.remove(),this}getLngLat(){return this._marker._lngLat}setLngLat(l){return this._marker.setLngLat(l),this}getElement(){return this._marker._element}setPopup(l){return this._marker.setPopup(l),this}getPopup(){return this._marker._popup}togglePopup(){return this._marker.togglePopup(),this}getOffset(){return this._marker._offset}setOffset(l){return this._marker.setOffset(l),this}setDraggable(l){return this._marker.setDraggable(l),this}isDraggable(){return this._marker._draggable}setRotation(l){return this._marker.setRotation(l),this}getRotation(){return this._marker._rotation}setRotationAlignment(l){return this._marker.setRotationAlignment(l),this}getRotationAlignment(){return this._marker._rotationAlignment}setPitchAlignment(l){return this._marker.setPitchAlignment(l),this}getPitchAlignment(){return this._marker._pitchAlignment}setAnimation(l){this._marker.setAnimation(l)}show(){this._marker.show()}hide(){this._marker.hide()}setCursor(l){this._marker.setCuror(l)}setText(l){return this._textContainerDom.innerHTML=l,this}getText(){return this._textContainerDom.innerHTML}setStyle(l={}){for(const n in l)if(l.hasOwnProperty(n)){const u=n.replace(/\-(\w)/g,function(v,_){return _.toUpperCase()});this._textContainerDom.style[u]=l[n],this._style[u]=l[n]}return this}getStyle(){return this._style}}w.Text=g},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.PolylineArrow=void 0;const O=U(2),I=U(0),g=U(35);var a=O.Math2D.lineDist;w.PolylineArrow=class{constructor(l){var n;this.options=g.extend({dirIconColor:"#fff",borderGapWidth:0,lineGapWidth:0,borderBlur:0,lineBlur:0,borderGradient:"",borderOffset:0,lineOffset:0,borderTranslateAnchor:"map",lineTranslateAnchor:"map",borderMiterLimit:1.05,lineMiterLimit:1.05,lineSortKey:0,showDir:!1,lineCap:"round",lineColor:"#0037e4",lineWidth:2,strokeDasharray:[2,2],strokeImage:"",lineJoin:"round",lineOpacity:1,lineTranslate:[0,0],showBorder:!1,borderWidth:1,borderOpacity:1,borderColor:"#000000",visible:!0,strokeStyle:"solid",animated:!1,dirSize:.4,dirSpacing:30,zIndex:100,beforeId:""},l),this.animateFun=null,this.animatedPointIdx=0,this.geojson={id:"custom_line_"+I.RandomID(),type:"line"},this.id=this.geojson.id,this.type="polyline",this.lineArrowImageName="vj-Polyline-arrow",this.borderGeoJson={id:"lineBorder_"+I.RandomID(),type:"line"},this._layers={one:"",two:"",three:""},this._map=(n=l.map)!==null&&n!==void 0?n:null,g.bindAll(["addTo","on","off","setColor","setOpacity","setWeight","setBorderColor","setBorderOpacity","setborderWidth","show","hide","setOptions","getId","getPath","animate","getOptions","getLength","getBounds","_addLayer","_addStrokeImage","setStrokeImage","_creatDirLine","setCursor","_addShowDirFun","_mouseenterCallbackFun","_mouseleaveCallbackFun","_createLineGeojson","_createBorderLine","setExtData","getExtData","_updateLineStyle","setzIndex","getzIndex","setHeight"],this),this._timeout=null,this._interval=null,this.init()}init(){this.createGeojson()}createGeojson(){this._createLineGeojson(),this.options.showBorder&&this._createBorderLine(),this.options.showDir&&this._creatDirLine(),this._map&&this.addTo(this._map,this.options.beforeId)}_createLineGeojson(){this.geojson.source={type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:this.options.path}}},this.options.minZoom&&(this.geojson.minZoom=this.options.minZoom),this.options.maxZoom&&(this.geojson.maxZoom=this.options.maxZoom),this.geojson.layout={"line-join":this.options.lineJoin,"line-cap":this.options.lineCap,"line-miter-limit":this.options.lineMiterLimit,"line-sort-key":this.options.lineSortKey,visibility:this.options.visible?"visible":"none"},this.geojson.paint={"line-color":this.options.lineColor,"line-width":this.options.lineWidth,"line-opacity":this.options.lineOpacity,"line-translate":this.options.lineTranslate,"line-gap-width":this.options.lineGapWidth,"line-blur":this.options.lineBlur,"line-offset":this.options.lineOffset,"line-translate-anchor":this.options.lineTranslateAnchor},this.options.lineGradient&&(this.geojson.paint["line-gradient"]=this.options.lineGradient),this.options.strokeStyle==="dashed"&&(this.geojson.paint["line-dasharray"]=this.options.strokeDasharray)}_createBorderLine(){this.borderGeoJson.source=this.geojson.source,this.options.minZoom&&(this.borderGeoJson.minZoom=this.options.minZoom),this.options.maxZoom&&(this.borderGeoJson.maxZoom=this.options.maxZoom),this.borderGeoJson.layout={"line-join":this.options.lineJoin,"line-cap":this.options.lineCap,"line-miter-limit":this.options.borderMiterLimit,"line-sort-key":this.options.lineSortKey,visibility:this.options.visible?"visible":"none"},this.borderGeoJson.paint={"line-color":this.options.borderColor,"line-width":this.options.lineWidth+2*this.options.borderWidth,"line-opacity":this.options.borderOpacity,"line-translate":this.options.lineTranslate,"line-gap-width":this.options.borderGapWidth,"line-blur":this.options.borderBlur,"line-offset":this.options.borderOffset,"line-translate-anchor":this.options.borderTranslateAnchor},this.options.borderGradient&&(this.borderGeoJson.paint["line-gradient"]=this.options.borderGradient),this._layers.one=this.borderGeoJson.id,this._layers.two=this.id}_creatDirLine(){var l,n,u;const v=(l=this.options.dirImageColor)!==null&&l!==void 0?l:"#ffffff",_=this.lineArrowImageName+v;let b={"symbol-avoid-edges":!1,"icon-anchor":"center","symbol-placement":"line","symbol-spacing":this.options.dirSpacing,"symbol-z-order":"source","icon-image":_,"icon-size":this.options.dirSize,"icon-rotate":0,"icon-pitch-alignment":"viewport",visibility:this.options.visible?"visible":"none"};b=g.extend(b,(n=this.options.dirLayout)!==null&&n!==void 0?n:{}),this.lineGeojson={id:"custom_line-icon_"+I.RandomID(),type:"symbol",source:this.geojson.source,layout:b,paint:{"icon-color":(u=this.options.dirIconColor)!==null&&u!==void 0?u:"#fff"}},this.options.minZoom&&(this.lineGeojson.minZoom=this.options.minZoom),this.options.maxZoom&&(this.lineGeojson.maxZoom=this.options.maxZoom),this._layers.three=this.lineGeojson.id}getLength(){const l=[];return O.transform.convert(this.getPath(),n=>(l.push(new O.GeoPoint(n[0],n[1])),n)),a(l)}getBounds(){return O.GeoBounds.fromDataExtent(this.getPath())}getId(){return this.id}remove(){var l,n,u,v,_,b;this._map&&(((l=this._map)===null||l===void 0?void 0:l.getLayer(this.borderGeoJson.id))&&((n=this._map)===null||n===void 0||n.removeLayer(this.borderGeoJson.id)),((u=this._map)===null||u===void 0?void 0:u.getLayer(this.id))&&((v=this._map)===null||v===void 0||v.removeLayer(this.id)),this.lineGeojson&&((_=this._map)===null||_===void 0?void 0:_.getLayer(this.lineGeojson.id))&&((b=this._map)===null||b===void 0||b.removeLayer(this.lineGeojson.id)),this._layers={one:"",two:"",three:""})}_addStrokeImage(){var l;this.options.strokeImage!==""&&(this.strokeImageName="custom_line_strokeImageName_"+I.RandomID(),(l=this._map)===null||l===void 0||l.loadImage(this.options.strokeImage,(n,u)=>{var v;n||((v=this._map)===null||v===void 0||v.addImage(this.strokeImageName,u),this.geojson.paint["line-pattern"]=this.strokeImageName,this._addLayer())}))}setStrokeImage(l){var n,u;l?(this.options.strokeImage=l,this.strokeImageName="custom_line_strokeImageName_"+I.RandomID(),(n=this._map)===null||n===void 0||n.loadImage(this.options.strokeImage,(v,_)=>{var b,M;v||((b=this._map)===null||b===void 0||b.addImage(this.strokeImageName,_),(M=this._map)===null||M===void 0||M.setPaintProperty(this.id,"line-pattern",this.strokeImageName),this.hide(),this.show())})):(u=this._map)===null||u===void 0||u.setPaintProperty(this.id,"line-pattern",null)}addTo(l,n){n=n!=null?n:"",l?(n&&(this.options.beforeId=n),this._map=l,l.loaded()?this.options.strokeImage===""?(this._addLayer(),this._addShowDirFun()):(this._addStrokeImage(),this._addShowDirFun()):l.onLoad(()=>{this.options.strokeImage===""?(this._addLayer(),this._addShowDirFun()):(this._addStrokeImage(),this._addShowDirFun())})):this._map&&this.remove()}_addShowDirFun(){var l,n,u,v,_,b;const M=(l=this.options.dirImageColor)!==null&&l!==void 0?l:"#ffffff",P=`<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"> 
                <path d="M529.6128 512L239.9232 222.4128 384.7168 77.5168 819.2 512 384.7168 946.4832 239.9232 801.5872z" p-id="9085" fill="${M}"></path> 
            </svg>
            `,C="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(P))),L=(n=this.options.dirImageSrc)!==null&&n!==void 0?n:C,D=this.lineArrowImageName+M;if(this.options.showDir)if((u=this._map)===null||u===void 0?void 0:u.hasImage(D))this._layers.three=this.lineGeojson.id,(b=this._map)===null||b===void 0||b.addLayer(this.lineGeojson,this.options.beforeId);else{const F=new Image((v=this.options.dirImageWidth)!==null&&v!==void 0?v:20,(_=this.options.dirImageHeight)!==null&&_!==void 0?_:20);F.src=L,F.onload=()=>{var j,K,ee;((j=this._map)===null||j===void 0?void 0:j.hasImage(D))||(K=this._map)===null||K===void 0||K.addImage(D,F),this._layers.three=this.lineGeojson.id,(ee=this._map)===null||ee===void 0||ee.addLayer(this.lineGeojson,this.options.beforeId)}}}_addLayer(){var l,n,u;this._layers.one=this.id,(l=this._map)===null||l===void 0||l.addLayer(this.geojson,this.options.beforeId),this.options.showBorder&&(this._layers.one=this.borderGeoJson.id,this._layers.two=this.id,(n=this._map)===null||n===void 0||n.addLayer(this.borderGeoJson,this.id)),this._mapStyleCursor=(u=this._map)===null||u===void 0?void 0:u.getCanvas().style.cursor,this.options.cursor&&this.setCursor(this.options.cursor)}setCursor(l){var n,u,v,_;l&&(this.options.cursor=l,(n=this._map)===null||n===void 0||n.off("mouseenter",this.geojson.id,this._mouseenterCallbackFun),(u=this._map)===null||u===void 0||u.off("mouseleave",this.geojson.id,this._mouseleaveCallbackFun),(v=this._map)===null||v===void 0||v.on("mouseenter",this.geojson.id,this._mouseenterCallbackFun),(_=this._map)===null||_===void 0||_.on("mouseleave",this.geojson.id,this._mouseleaveCallbackFun))}_mouseenterCallbackFun(){this._map&&this.options.cursor&&(this._map.getCanvas().style.cursor=this.options.cursor)}_mouseleaveCallbackFun(){this._map&&this.options.cursor&&typeof this._mapStyleCursor=="string"&&(this._map.getCanvas().style.cursor=this._mapStyleCursor)}setPath(l){var n,u,v;this.options.path=l,this.geojson.source.data.geometry.coordinates=l,this.options.showBorder&&((n=this._map)===null||n===void 0||n.getSource(this.borderGeoJson.id).setData(this.geojson.source.data)),(u=this._map)===null||u===void 0||u.getSource(this.geojson.id).setData(this.geojson.source.data),this.options.showDir&&(this.lineGeojson.source.data.geometry.coordinates=l,(v=this._map)===null||v===void 0||v.getSource(this.lineGeojson.id).setData(this.lineGeojson.source.data)),this._newInterpolatePoints=void 0}getPath(){return this.options.path}animate(l=100,n=10,u=!1,v,_){this._newInterpolatePoints||(this._newInterpolatePoints=O.interpolateLineRange(this.getPath(),l,!0)),l=this._newInterpolatePoints.length,this._newPoints=[];const b=I.createFrameAnimation(M=>{var P,C,L,D,F,j;if(this._newPoints.push(this._newInterpolatePoints[this.animatedPointIdx]),(this.animatedPointIdx>=l||M===I.FrameAnimationStatus.Stop)&&(this._newPoints=this.getPath()),this.geojson.source.data.geometry.coordinates=this._newPoints,this.options.showBorder&&((C=(P=this._map)===null||P===void 0?void 0:P.getSource(this.borderGeoJson.id))===null||C===void 0||C.setData(this.geojson.source.data.geometry)),this.options.showDir&&((D=(L=this._map)===null||L===void 0?void 0:L.getSource(this.lineGeojson.id))===null||D===void 0||D.setData(this.geojson.source.data.geometry)),(j=(F=this._map)===null||F===void 0?void 0:F.getSource(this.geojson.id))===null||j===void 0||j.setData(this.geojson.source.data.geometry),_){const ee={target:this,startPnt:this._newPoints[this._newPoints.length-2<0?0:this._newPoints.length-2],endPnt:this._newPoints[this._newPoints.length-1],coordinates:this._newPoints};_(M,ee)}this.animatedPointIdx++;let K=this.animatedPointIdx>=l;return K&&u&&(this._newPoints=[],this.animatedPointIdx=0,K=!1),M===I.FrameAnimationStatus.Stop&&(this._newPoints=[],this.animatedPointIdx=0,K=!0),K},n,v);return b.start(),b}on(l,n){var u;(u=this._map)===null||u===void 0||u.on(l,this.id,n)}once(l,n){var u;(u=this._map)===null||u===void 0||u.once(l,this.id,n)}off(l,n){var u;(u=this._map)===null||u===void 0||u.off(l,this.id,n)}setOptions(l){var n,u,v,_,b,M,P,C;((n=l.strokeImage)!==null&&n!==void 0?n:l.strokeImage==="")&&this.setStrokeImage(l.strokeImage);const L={lineColor:"line-color",lineWidth:"line-width",lineOpacity:"line-opacity",lineTranslate:"line-translate",lineGapWidth:"line-gap-width",lineBlur:"line-blur",lineGradient:"line-gradient",lineOffset:"line-offset",lineTranslateAnchor:"line-translate-anchor"},D=Object.keys(L),F={borderColor:"line-color",borderWidth:"line-width",borderOpacity:"line-opacity",lineTranslate:"line-translate",borderGapWidth:"line-gap-width",borderBlur:"line-blur",borderGradient:"line-gradient",borderOffset:"line-offset",borderTranslateAnchor:"line-translate-anchor"},j=Object.keys(F),K={lineJoin:"line-join",lineCap:"line-cap"},ee=Object.keys(K);let Q;for(Q in l)if(this.options[Q]=l[Q],(u=this._map)===null||u===void 0?void 0:u.getLayer(this.id)){if(D.includes(Q)&&(Q==="lineWidth"&&this.options.showBorder&&((v=this._map)===null||v===void 0||v.setPaintProperty(this.borderGeoJson.id,L[Q],l[Q]+2*this.options.borderWidth)),(_=this._map)===null||_===void 0||_.setPaintProperty(this.id,L[Q],l[Q])),this.options.showBorder&&j.includes(Q)){const le=Q==="borderWidth"?this.options.lineWidth+2*l[Q]:l[Q];(b=this._map)===null||b===void 0||b.setPaintProperty(this.borderGeoJson.id,F[Q],le)}ee.includes(Q)&&(this.options.showBorder&&((M=this._map)===null||M===void 0||M.setLayoutProperty(this.borderGeoJson.id,K[Q],l[Q])),(P=this._map)===null||P===void 0||P.setLayoutProperty(this.id,K[Q],l[Q]))}((C=this._map)===null||C===void 0?void 0:C.getLayer(this.id))&&this._updateLineStyle(l),l.map&&this.addTo(l.map)}_updateLineStyle(l){var n,u,v,_,b,M,P,C,L;((u=(n=this._map)===null||n===void 0?void 0:n.getLayer(this.borderGeoJson.id))!==null&&u!==void 0?u:!l.showBorder)?((v=this._map)===null||v===void 0?void 0:v.getLayer(this.borderGeoJson.id))&&!l.showBorder&&((_=this._map)===null||_===void 0||_.removeLayer(this.borderGeoJson.id),this._layers.one=this.id,this._layers.two=""):(this._createBorderLine(),this._layers.two=this.id,this._layers.one=this.borderGeoJson.id,(b=this._map)===null||b===void 0||b.addLayer(this.borderGeoJson,this.id)),l.strokeStyle==="dashed"?(M=this._map)===null||M===void 0||M.setPaintProperty(this.id,"line-dasharray",this.options.strokeDasharray):l.strokeStyle==="solid"&&((P=this._map)===null||P===void 0||P.setPaintProperty(this.id,"line-dasharray",null)),this.lineGeojson?l.showDir?l.dirSize&&((L=this._map)===null||L===void 0||L.setLayoutProperty(this.lineGeojson.id,"icon-size",this.options.dirSize)):((C=this._map)===null||C===void 0||C.removeLayer(this.lineGeojson.id),this.lineGeojson=null,this._layers.three=""):l.showDir&&(this._creatDirLine(),this._addShowDirFun()),l.path&&this.setPath(l.path),l.visible?this.show():l.visible||this.hide(),l.cursor&&l.cursor!==""&&this.setCursor(l.cursor)}getOptions(){return this.options}setColor(l){var n,u;this._map&&((n=this._map)===null||n===void 0?void 0:n.style.hasLayer(this.id))&&(this.options.lineColor=l,(u=this._map)===null||u===void 0||u.setPaintProperty(this.id,"line-color",l))}setOpacity(l){var n,u;this._map&&((n=this._map)===null||n===void 0?void 0:n.style.hasLayer(this.id))&&(this.options.lineOpacity=l,(u=this._map)===null||u===void 0||u.setPaintProperty(this.id,"line-opacity",l))}setWeight(l){var n,u,v;this._map&&((n=this._map)===null||n===void 0?void 0:n.style.hasLayer(this.id))&&(this.options.lineWidth=l,this.options.showBorder&&((u=this._map)===null||u===void 0||u.setPaintProperty(this.borderGeoJson.id,"line-width",l+2*this.options.borderWidth)),(v=this._map)===null||v===void 0||v.setPaintProperty(this.id,"line-width",l))}setBorderColor(l){var n,u;this._map&&((n=this._map)===null||n===void 0?void 0:n.style.hasLayer(this.borderGeoJson.id))&&(this.options.borderColor=l,this.options.showBorder&&((u=this._map)===null||u===void 0||u.setPaintProperty(this.borderGeoJson.id,"line-color",l)))}setBorderOpacity(l){var n,u;this._map&&((n=this._map)===null||n===void 0?void 0:n.style.hasLayer(this.borderGeoJson.id))&&(this.options.borderOpacity=l,this.options.showBorder&&((u=this._map)===null||u===void 0||u.setPaintProperty(this.borderGeoJson.id,"line-opacity",l)))}setborderWidth(l){var n,u;this._map&&((n=this._map)===null||n===void 0?void 0:n.style.hasLayer(this.borderGeoJson.id))&&(this.options.borderWidth=l,this.options.showBorder&&((u=this._map)===null||u===void 0||u.setPaintProperty(this.borderGeoJson.id,"line-width",this.options.lineWidth+2*l)))}show(){var l,n,u;this.options.showBorder&&((l=this._map)===null||l===void 0||l.setLayoutProperty(this.borderGeoJson.id,"visibility","visible")),(n=this._map)===null||n===void 0||n.setLayoutProperty(this.id,"visibility","visible"),this.options.showDir&&((u=this._map)===null||u===void 0||u.setLayoutProperty(this.lineGeojson.id,"visibility","visible"))}hide(){var l,n,u;this.options.showBorder&&((l=this._map)===null||l===void 0||l.setLayoutProperty(this.borderGeoJson.id,"visibility","none")),(n=this._map)===null||n===void 0||n.setLayoutProperty(this.id,"visibility","none"),this.options.showDir&&((u=this._map)===null||u===void 0||u.setLayoutProperty(this.lineGeojson.id,"visibility","none"))}showDir(){this.options.showDir=!0,this._creatDirLine(),this._addShowDirFun()}removeDir(){var l,n;this.options.showDir&&((l=this._map)===null||l===void 0?void 0:l.style.hasLayer(this.lineGeojson.id))&&((n=this._map)===null||n===void 0||n.removeLayer(this.lineGeojson.id)),this.options.showDir=!1}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.CircleFill=void 0;const O=U(2),I=U(26);class g extends I.Polygon{constructor(l){super(l)}addTo(l,n){var u,v,_;this.options.data=l.toLngLat(O.getCirclePolygonCoordinates(this.options.center,this.options.radius,(u=this.options.points)!==null&&u!==void 0?u:360,(v=this.options.startAngle)!==null&&v!==void 0?v:0,(_=this.options.endAngle)!==null&&_!==void 0?_:360,!0)),this.options.properties&&(this.options.data={points:this.options.data,properties:this.options.properties}),super.addTo(l,n)}updateData(){this.options.data=this._map.toLngLat(O.getCirclePolygonCoordinates(this.options.center,this.options.radius,this.options.startAngle,this.options.endAngle,this.options.points,!0)),this.options.properties&&(this.options.data={points:this.options.data,properties:this.options.properties}),this.setData(this.options.data)}setCenter(l,n=!0){return this.options.center=l,n&&this.updateData(),this}getCenter(){return this.options.center}setRadius(l,n=!0){return this.options.radius=l,n&&this.updateData(),this}getRadius(){return this.options.radius}setStartAngle(l,n=!0){return this.options.startAngle=l,n&&this.updateData(),this}getStartAngle(){return this.options.startAngle}setEndAngle(l,n=!0){return this.options.endAngle=l,n&&this.updateData(),this}getEndAngle(){return this.options.endAngle}setPoints(l,n=!0){return this.options.points=l,n&&this.updateData(),this}getPoints(){return this.options.points}}w.CircleFill=g},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.EllipseFill=void 0;const O=U(2),I=U(26);class g extends I.Polygon{constructor(l){super(l)}addTo(l,n){var u,v,_;this.options.data=l.toLngLat(O.getEllipsePolygonCoordinates(this.options.center,this.options.majorAxisRadius,this.options.minorAxisRadius,(u=this.options.points)!==null&&u!==void 0?u:360,(v=this.options.startAngle)!==null&&v!==void 0?v:0,(_=this.options.endAngle)!==null&&_!==void 0?_:360,!0)),this.options.properties&&(this.options.data={points:this.options.data,properties:this.options.properties}),super.addTo(l,n)}updateData(){this.options.data=this._map.toLngLat(O.getEllipsePolygonCoordinates(this.options.center,this.options.majorAxisRadius,this.options.minorAxisRadius,this.options.startAngle,this.options.endAngle,this.options.points,!0)),this.options.properties&&(this.options.data={points:this.options.data,properties:this.options.properties}),this.setData(this.options.data)}setCenter(l,n=!0){return this.options.center=l,n&&this.updateData(),this}getCenter(){return this.options.center}setMajorAxisRadius(l,n=!0){return this.options.majorAxisRadius=l,n&&this.updateData(),this}getMajorAxisRadius(){return this.options.majorAxisRadius}setMinorAxisRadius(l,n=!0){return this.options.minorAxisRadius=l,n&&this.updateData(),this}getMinorAxisRadius(){return this.options.minorAxisRadius}setStartAngle(l,n=!0){return this.options.startAngle=l,n&&this.updateData(),this}getStartAngle(){return this.options.startAngle}setEndAngle(l,n=!0){return this.options.endAngle=l,n&&this.updateData(),this}getEndAngle(){return this.options.endAngle}setPoints(l,n=!0){return this.options.points=l,n&&this.updateData(),this}getPoints(){return this.options.points}}w.EllipseFill=g},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.CircleEdge=void 0;const O=U(2),I=U(27);class g extends I.Polyline{constructor(l){super(l)}addTo(l,n){var u,v,_;this.options.data=l.toLngLat(O.getCirclePolygonCoordinates(this.options.center,this.options.radius,(u=this.options.points)!==null&&u!==void 0?u:360,(v=this.options.startAngle)!==null&&v!==void 0?v:0,(_=this.options.endAngle)!==null&&_!==void 0?_:360,!1)),this.options.properties&&(this.options.data={points:this.options.data,properties:this.options.properties}),super.addTo(l,n)}updateData(){this.options.data=this._map.toLngLat(getCirclePolylineCoordinates(this.options.center,this.options.radius,this.options.startAngle,this.options.endAngle,this.options.points,!0)),this.options.properties&&(this.options.data={points:this.options.data,properties:this.options.properties}),this.setData(this.options.data)}setCenter(l,n=!0){return this.options.center=l,n&&this.updateData(),this}getCenter(){return this.options.center}setRadius(l,n=!0){return this.options.radius=l,n&&this.updateData(),this}getRadius(){return this.options.radius}setStartAngle(l,n=!0){return this.options.startAngle=l,n&&this.updateData(),this}getStartAngle(){return this.options.startAngle}setEndAngle(l,n=!0){return this.options.endAngle=l,n&&this.updateData(),this}getEndAngle(){return this.options.endAngle}setPoints(l,n=!0){return this.options.points=l,n&&this.updateData(),this}getPoints(){return this.options.points}}w.CircleEdge=g},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.EllipseEdge=void 0;const O=U(2),I=U(27);class g extends I.Polyline{constructor(l){super(l)}addTo(l,n){var u,v,_;this.options.data=l.toLngLat(O.getCirclePolygonCoordinates(this.options.center,this.options.majorAxisRadius,this.options.minorAxisRadius,(u=this.options.points)!==null&&u!==void 0?u:360,(v=this.options.startAngle)!==null&&v!==void 0?v:0,(_=this.options.endAngle)!==null&&_!==void 0?_:360,!0)),this.options.properties&&(this.options.data={points:this.options.data,properties:this.options.properties}),super.addTo(l,n)}updateData(){this.options.data=this._map.toLngLat(getEllipsePolylineCoordinates(this.options.center,this.options.majorAxisRadius,this.options.minorAxisRadius,this.options.startAngle,this.options.endAngle,this.options.points,!0)),this.options.properties&&(this.options.data={points:this.options.data,properties:this.options.properties}),this.setData(this.options.data)}setCenter(l,n=!0){return this.options.center=l,n&&this.updateData(),this}getCenter(){return this.options.center}setMajorAxisRadius(l,n=!0){return this.options.majorAxisRadius=l,n&&this.updateData(),this}getMajorAxisRadius(){return this.options.majorAxisRadius}setMinorAxisRadius(l,n=!0){return this.options.minorAxisRadius=l,n&&this.updateData(),this}getMinorAxisRadius(){return this.options.minorAxisRadius}setStartAngle(l,n=!0){return this.options.startAngle=l,n&&this.updateData(),this}getStartAngle(){return this.options.startAngle}setEndAngle(l,n=!0){return this.options.endAngle=l,n&&this.updateData(),this}getEndAngle(){return this.options.endAngle}setPoints(l,n=!0){return this.options.points=l,n&&this.updateData(),this}getPoints(){return this.options.points}}w.EllipseEdge=g},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.BackgroundLayer=void 0;const O=U(0),I=U(6);class g extends I.OverlayLayerBase{constructor(l){super(),this.options=O.extend({},l)}addTo(l,n){var u,v;this._map=l,this.layerId=(u=this.options.layerId)!==null&&u!==void 0?u:"custom_background_layer_"+O.RandomID();const _={};this.options.backgroundColor&&(_["background-color"]=this.options.backgroundColor),this.options.backgroundPattern&&(_["background-pattern"]=this.options.backgroundPattern),this.options.backgroundOpacity&&(_["background-opacity"]=this.options.backgroundOpacity),l.addLayer({id:this.layerId,type:"background",paint:_,layout:{visibility:(v=this.options.visibility)!==null&&v!==void 0?v:"visible"}},n),super.addTo(l,n)}setBackgroundColor(l){return this._map.setBackgroundColor(this.layerId,l),this}getBackgroundColor(){return this._map.getBackgroundColor(this.layerId)}setBackgroundPattern(l){return this._map.setBackgroundPattern(this.layerId,l),this}getBackgroundPattern(){return this._map.getBackgroundPattern(this.layerId)}setBackgroundOpacity(l){return this._map.setBackgroundOpacity(this.layerId,l),this}getBackgroundOpacity(){return this._map.getBackgroundOpacity(this.layerId)}}w.BackgroundLayer=g},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.FillExtrusion=void 0;const O=U(0),I=U(6);class g extends I.OverlayLayerBase{constructor(l){super(),this.options=O.extend({},l)}addTo(l,n){var u,v;if(this._map=l,this.sourceId=(u=this.options.sourceId)!==null&&u!==void 0?u:"custom_fillExtrusion_"+O.RandomID(),this.options.data){const _=O.createPolygonGeoJson(this.options.data);l.addGeoJSONSource(this.sourceId,_)}this.layerId=(v=this.options.layerId)!==null&&v!==void 0?v:"custom_fillExtrusion_layer_"+O.RandomID(),l.addFillExtrusionLayer(this.layerId,this.sourceId,this.options,n),super.addTo(l,n)}setData(l){l=O.createPolygonGeoJson(l),this._map.setData(this.sourceId,l)}setFillExtrusionOpacity(l){return this._map.setFillExtrusionOpacity(this.layerId,l),this}getFillExtrusionOpacity(){return this._map.getFillExtrusionOpacity(this.layerId)}setFillExtrusionColor(l){return this._map.setFillExtrusionColor(this.layerId,l),this}getFillExtrusionColor(){return this._map.getFillExtrusionColor(this.layerId)}setFillExtrusionTranslate(l){return this._map.setFillExtrusionTranslate(this.layerId,l),this}getFillExtrusionTranslate(){return this._map.getFillExtrusionTranslate(this.layerId)}setFillExtrusionTranslateAnchor(l){return this._map.setFillExtrusionTranslateAnchor(this.layerId,l),this}getFillExtrusionTranslateAnchor(){return this._map.getFillExtrusionTranslateAnchor(this.layerId)}setFillExtrusionPattern(l){return this._map.setFillExtrusionPattern(this.layerId,l),this}getFillExtrusionPattern(){return this._map.getFillExtrusionPattern(this.layerId)}setFillExtrusionHeight(l){return this._map.setFillExtrusionHeight(this.layerId,l),this}getFillExtrusionHeight(){return this._map.getFillExtrusionHeight(this.layerId)}setFillExtrusionBase(l){return this._map.setFillExtrusionBase(this.layerId,l),this}getFillExtrusionBase(){return this._map.getFillExtrusionBase(this.layerId)}setFillExtrusionVerticalGradient(l){return this._map.setFillExtrusionVerticalGradient(this.layerId,l),this}getFillExtrusionVerticalGradient(){return this._map.getFillExtrusionVerticalGradient(this.layerId)}}w.FillExtrusion=g},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.SkyLayer=void 0;const O=U(0),I=U(6);class g extends I.OverlayLayerBase{constructor(l){super(),this.options=O.extend({},l)}addTo(l,n){var u,v;this._map=l,this.layerId=(u=this.options.layerId)!==null&&u!==void 0?u:"custom_sky_layer_"+O.RandomID();const _={};this.options.skyAtmosphereColor&&(_["sky-atmosphere-color"]=this.options.skyAtmosphereColor),this.options.skyAtmosphereHaloColor&&(_["sky-atmosphere-halo-color"]=this.options.skyAtmosphereHaloColor),this.options.skyAtmosphereSunIntensity&&(_["sky-atmosphere-sun-intensity"]=this.options.skyAtmosphereSunIntensity),this.options.skyAtmosphereSun&&(_["sky-atmosphere-sun"]=this.options.skyAtmosphereSun),this.options.skyGradient&&(_["sky-gradient"]=this.options.skyGradient),this.options.skyGradientCenter&&(_["sky-gradient-center"]=this.options.skyGradientCenter),this.options.skyGradientRadius&&(_["sky-gradient-radius"]=this.options.skyGradientRadius),this.options.skyOpacity&&(_["sky-opacity"]=this.options.skyOpacity),this.options.skyType&&(_["sky-type"]=this.options.skyType),l.addLayer({id:this.layerId,type:"sky",paint:_,layout:{visibility:(v=this.options.visibility)!==null&&v!==void 0?v:"visible"}},n),super.addTo(l,n)}setSkyType(l){return this._map.setSkyType(this.layerId,l),this}getSkyType(){return this._map.getSkyType(this.layerId)}setSkyAtmosphereSun(l){return this._map.setSkyAtmosphereSun(this.layerId,l),this}getSkyAtmosphereSun(){return this._map.getSkyAtmosphereSun(this.layerId)}setSkyAtmosphereSunIntensity(l){return this._map.setSkyAtmosphereSunIntensity(this.layerId,l),this}getSkyAtmosphereSunIntensity(){return this._map.getSkyAtmosphereSunIntensity(this.layerId)}setSkyGradientCenter(l){return this._map.setSkyGradientCenter(this.layerId,l),this}getSkyGradientCenter(){return this._map.getSkyGradientCenter(this.layerId)}setSkyGradientRadius(l){return this._map.setSkyGradientRadius(this.layerId,l),this}getSkyGradientRadius(){return this._map.getSkyGradientRadius(this.layerId)}setSkyGradient(l){return this._map.setSkyGradient(this.layerId,l),this}getSkyGradient(){return this._map.getSkyGradient(this.layerId)}setSkyAtmosphereHaloColor(l){return this._map.setSkyAtmosphereHaloColor(this.layerId,l),this}getSkyAtmosphereHaloColor(){return this._map.getSkyAtmosphereHaloColor(this.layerId)}setSkyAtmosphereColor(l){return this._map.setSkyAtmosphereColor(this.layerId,l),this}getSkyAtmosphereColor(){return this._map.getSkyAtmosphereColor(this.layerId)}setSkyOpacity(l){return this._map.setSkyOpacity(this.layerId,l),this}getSkyOpacity(){return this._map.getSkyOpacity(this.layerId)}}w.SkyLayer=g},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.Circle=void 0;const O=U(0),I=U(6);class g extends I.OverlayLayerBase{constructor(l){super(),this.options=O.extend({},l)}addTo(l,n){var u,v;if(this._map=l,this.sourceId=(u=this.options.sourceId)!==null&&u!==void 0?u:"custom_circle_"+O.RandomID(),this.options.data){const _=O.createPointGeoJson(this.options.data);l.addGeoJSONSource(this.sourceId,_)}this.layerId=(v=this.options.layerId)!==null&&v!==void 0?v:"custom_circle_layer_"+O.RandomID(),l.addCircleLayer(this.layerId,this.sourceId,this.options,n),super.addTo(l,n)}setData(l){l=O.createPointGeoJson(l),this._map.setData(this.sourceId,l)}setCircleSortKey(l){return this._map.setCircleSortKey(this.layerId,l),this}getCircleSortKey(){return this._map.getCircleSortKey(this.layerId)}setVisibility(l){return this._map.setVisibility(this.layerId,l),this}getVisibility(){return this._map.getVisibility(this.layerId)}setCircleRadius(l){return this._map.setCircleRadius(this.layerId,l),this}getCircleRadius(){return this._map.getCircleRadius(this.layerId)}setCircleColor(l){return this._map.setCircleColor(this.layerId,l),this}getCircleColor(){return this._map.getCircleColor(this.layerId)}setCircleBlur(l){return this._map.setCircleBlur(this.layerId,l),this}getCircleBlur(){return this._map.getCircleBlur(this.layerId)}setCircleOpacity(l){return this._map.setCircleOpacity(this.layerId,l),this}getCircleOpacity(){return this._map.getCircleOpacity(this.layerId)}setCircleTranslate(l){return this._map.setCircleTranslate(this.layerId,l),this}getCircleTranslate(){return this._map.getCircleTranslate(this.layerId)}setCircleTranslateAnchor(l){return this._map.setCircleTranslateAnchor(this.layerId,l),this}getCircleTranslateAnchor(){return this._map.getCircleTranslateAnchor(this.layerId)}setCirclePitchScale(l){return this._map.setCirclePitchScale(this.layerId,l),this}getCirclePitchScale(){return this._map.getCirclePitchScale(this.layerId)}setCirclePitchAlignment(l){return this._map.setCirclePitchAlignment(this.layerId,l),this}getCirclePitchAlignment(){return this._map.getCirclePitchAlignment(this.layerId)}setCircleStrokeWidth(l){return this._map.setCircleStrokeWidth(this.layerId,l),this}getCircleStrokeWidth(){return this._map.getCircleStrokeWidth(this.layerId)}setCircleStrokeColor(l){return this._map.setCircleStrokeColor(this.layerId,l),this}getCircleStrokeColor(){return this._map.getCircleStrokeColor(this.layerId)}setCircleStrokeOpacity(l){return this._map.setCircleStrokeOpacity(this.layerId,l),this}getCircleStrokeOpacity(){return this._map.getCircleStrokeOpacity(this.layerId)}}w.Circle=g},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.Heatmap=void 0;const O=U(0),I=U(6);class g extends I.OverlayLayerBase{constructor(l){super(),this.options=O.extend({},l)}addTo(l,n){var u,v;if(this._map=l,this.sourceId=(u=this.options.sourceId)!==null&&u!==void 0?u:"custom_heatmap_"+O.RandomID(),this.options.data){const _=O.createPointGeoJson(this.options.data);l.addGeoJSONSource(this.sourceId,_)}this.layerId=(v=this.options.layerId)!==null&&v!==void 0?v:"custom_heatmap_layer_"+O.RandomID(),l.addHeatmapLayer(this.layerId,this.sourceId,this.options,n),super.addTo(l,n)}setData(l){l=O.createPointGeoJson(l),this._map.setData(this.sourceId,l)}setHeatmapRadius(l){return this._map.setHeatmapRadius(this.layerId,l),this}getHeatmapRadius(){return this._map.getHeatmapRadius(this.layerId)}setHeatmapWeight(l){return this._map.setHeatmapWeight(this.layerId,l),this}getHeatmapWeight(){return this._map.getHeatmapWeight(this.layerId)}setHeatmapIntensity(l){return this._map.setHeatmapIntensity(this.layerId,l),this}getHeatmapIntensity(){return this._map.getHeatmapIntensity(this.layerId)}setHeatmapColor(l){return this._map.setHeatmapColor(this.layerId,l),this}getHeatmapColor(){return this._map.getHeatmapColor(this.layerId)}setHeatmapOpacity(l){return this._map.setHeatmapOpacity(this.layerId,l),this}getHeatmapOpacity(){return this._map.getHeatmapOpacity(this.layerId)}}w.Heatmap=g},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DivOverlay=void 0;const O=U(2);var I=O.Math2D.dist;w.DivOverlay=class{constructor(g){var a,l;this.options=g,this.minZoom=(a=this.options.minZoom)!==null&&a!==void 0?a:0,this.maxZoom=(l=this.options.maxZoom)!==null&&l!==void 0?l:100,this.isShow=!1}addTo(g,a){if(this._map=g,!this.parentContainer){let l=g.getContainer();if(a)if(typeof a=="string"){const n=document.getElementById(a);n&&(l=n)}else l=a;this.parentContainer=l}this._add()}_isShow(){var g,a;const l=(a=(g=this._map)===null||g===void 0?void 0:g.getZoom())!==null&&a!==void 0?a:0;return l>=this.minZoom&&l<this.maxZoom}_add(){var g,a,l,n;this._isShow()&&!this.isShow&&(this.isShow=!0,(g=this.parentContainer)===null||g===void 0||g.append(this.options.element),(a=this._map)===null||a===void 0||a.on("zoomend",this._updateZoom.bind(this)),(l=this._map)===null||l===void 0||l.on("moveend",this._update.bind(this)),(n=this._map)===null||n===void 0||n.on("move",this._update.bind(this)),this._updateZoom())}_remove(){var g,a,l;this.isShow&&(this.isShow=!1,(g=this._map)===null||g===void 0||g.off("zoomend",this._updateZoom.bind(this)),(a=this._map)===null||a===void 0||a.off("moveend",this._update.bind(this)),(l=this._map)===null||l===void 0||l.off("move",this._update.bind(this)),this.parentContainer&&this.parentContainer.removeChild(this.options.element))}remove(){this._remove()}updateBounds(g){this.options.bounds=g,this._update()}updateSize(g,a){this.options.width=g,this.options.height=a,this._update()}_updateZoom(){this._isShow()?(this._add(),this._update()):this._remove()}_updateDivSize(g){var a;if(!this.options.updateDivSize)return null;const l=(a=this.options.maxDivSize)!==null&&a!==void 0?a:5e4;return g>l&&(g=l),this.options.width>this.options.height?(this.options.height=g*this.options.height/this.options.width,this.options.width=g):(this.options.width=g*this.options.width/this.options.height,this.options.height=g),this.options.element.style.width=this.options.width+"px",this.options.element.style.height=this.options.height+"px",{width:this.options.width,height:this.options.height}}_adjustCoord(g,a){var l,n;const u=[];for(let b=0;b<a.length;b++){const M=(l=this._map)===null||l===void 0?void 0:l.projectEx((n=this._map)===null||n===void 0?void 0:n.toLngLat(a[b]));u.push(M.x),u.push(M.y)}let v=0;for(let b=0;b<u.length;b+=2)for(let M=0;M<u.length;M+=2){if(b===M)continue;const P=I(u[b],u[b+1],u[M],u[M+1]);P>v&&(v=P)}const _=this._updateDivSize(v);return _&&(g=[0,_.height,0,0,_.width,0,_.width,_.height]),{src:g,pts:u,maxLength:v}}_update(){if(!this.options.element)return;let g=this.options.bounds;g instanceof O.GeoBounds&&(g=[[g.min.x,g.min.y],[g.min.x,g.max.y],[g.max.x,g.max.y],[g.max.x,g.min.y]]);const a=this._adjustCoord([0,this.options.height,0,0,this.options.width,0,this.options.width,this.options.height],g),l=O.buildTransformerMatrix3d(a.src,a.pts);l!=null&&(this.options.element.style.transform=l),this.options.element.style.transformOrigin="0 0"}}},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.DeckLayer=void 0;const O=U(0),I=U(5);class g extends I.Evented{constructor(l){var n,u;super(),this.id=(n=l.id)!==null&&n!==void 0?n:"deck_layer_"+O.RandomID(),this.type="custom",this.renderingMode="3d",this.deckNs=(u=window.deck)!==null&&u!==void 0?u:l.deck,typeof this.deckNs!="object"||this.deckNs,this.layer=new this.deckNs.MapboxLayer(l);for(const v in this.layer)this[v]=this.layer[v]}onAdd(l,n){this.layer.onAdd(l,n);for(const u in this.layer)this[u]=this.layer[u];this.fire("load")}onRemove(){this.layer.onRemove(),this.fire("remove")}setProps(l){this.layer.setProps(l)}render(l,n){this.layer.render(l,n)}}w.DeckLayer=g},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0})},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.ThreeLayer=void 0;const O=U(0),I=U(5);class g extends I.Evented{constructor(l){var n;super(),this.id=(n=l.id)!==null&&n!==void 0?n:"three_layer_"+O.RandomID(),this.type="custom",this.renderingMode="3d",this.context=l.context,this._onAdd=l.onAdd,this._onRemove=l.onRemove,this._render=l.render}onAdd(l,n){typeof this._onAdd=="function"&&this._onAdd(),this.fire("load")}onRemove(){typeof this._onAdd=="function"?this._onRemove():this.context.removeLayer(this.id),this.fire("remove")}render(l,n){typeof this._render=="function"?this._render():this.context.update()}}w.ThreeLayer=g},function(he,w,U){Object.defineProperty(w,"__esModule",{value:!0}),w.Scene=void 0;const O=U(5),I=U(2);w.Scene=function(g,a,l){l=l!=null?l:{};let n=new g[["Map"].join("")+"box"]({mapInstance:a});l.id=a.getContainer().id,l.map=n,l.logoVisible=!1,window.mapboxgl={};const u=new g.Scene(l);delete window.mapboxgl;const v=u.getMapService();return v.lngLatToMercator=function(_,b){const{x:M=0,y:P=0,z:C=0}=O.MercatorCoordinate.fromLngLat(_,b);return{x:M,y:P,z:C}},v.getModelMatrix=function(_,b,M,P=[1,1,1],C={x:0,y:0,z:0}){const L=O.MercatorCoordinate.fromLngLat(_,b),D=L.meterInMercatorCoordinateUnits(),F=I.mat4.create();return I.mat4.translate(F,F,I.vec3.fromValues(L.x-C.x,L.y-C.y,L.z||0-C.z)),I.mat4.scale(F,F,I.vec3.fromValues(D*P[0],-D*P[1],D*P[2])),I.mat4.rotateX(F,F,M[0]),I.mat4.rotateY(F,F,M[1]),I.mat4.rotateZ(F,F,M[2]),F},v.meterToCoord=function(_,b){const M=new O.LngLat(_[0],_[1]),P=new O.LngLat(b[0],b[1]),C=M.distanceTo(P),L=O.MercatorCoordinate.fromLngLat({lng:_[0],lat:_[1]}),D=O.MercatorCoordinate.fromLngLat({lng:b[0],lat:b[1]}),{x:F,y:j}=L,{x:K,y:ee}=D;return 4194304*Math.sqrt(Math.pow(F-K,2)+Math.pow(j-ee,2))*2/C},u}},function(he,w,U){(function(O,I){Object.defineProperty(w,"__esModule",{value:!0}),w.Draw=void 0;var g={};(function(l,n){n(l)})(g,function(l){var n=function(f,E){var k={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},G={on:function(J,ne,fe){if(k[J]===void 0)throw new Error("Invalid event type: "+J);k[J].push({selector:ne,fn:fe})},render:function(J){E.store.featureChanged(J)}},Z=function(J,ne){for(var fe=k[J],ce=fe.length;ce--;){var Se=fe[ce];if(Se.selector(ne)){Se.fn.call(G,ne)||E&&E.store&&E.store.render(),E&&E.ui&&E.ui.updateMapClasses();break}}};return f.start.call(G),{render:f.render,stop:function(){f.stop&&f.stop()},trash:function(){f.trash&&(f.trash(),E.store.render())},combineFeatures:function(){f.combineFeatures&&f.combineFeatures()},uncombineFeatures:function(){f.uncombineFeatures&&f.uncombineFeatures()},drag:function(J){Z("drag",J)},click:function(J){Z("click",J)},mousemove:function(J){Z("mousemove",J)},mousedown:function(J){Z("mousedown",J)},mouseup:function(J){Z("mouseup",J)},mouseout:function(J){Z("mouseout",J)},keydown:function(J){Z("keydown",J)},keyup:function(J){Z("keyup",J)},touchstart:function(J){Z("touchstart",J)},touchmove:function(J){Z("touchmove",J)},touchend:function(J){Z("touchend",J)},tap:function(J){Z("tap",J)}}},u=6378137;function v(f){var E=0;if(f&&f.length>0){E+=Math.abs(_(f[0]));for(var k=1;k<f.length;k++)E-=Math.abs(_(f[k]))}return E}function _(f){var E,k,G,Z,J,ne,fe=0,ce=f.length;if(ce>2){for(ne=0;ne<ce;ne++)ne===ce-2?(G=ce-2,Z=ce-1,J=0):ne===ce-1?(G=ce-1,Z=0,J=1):(G=ne,Z=ne+1,J=ne+2),E=f[G],k=f[Z],fe+=(b(f[J][0])-b(E[0]))*Math.sin(b(k[1]));fe=fe*u*u/2}return fe}function b(f){return f*Math.PI/180}var M={geometry:function f(E){var k,G=0;switch(E.type){case"Polygon":return v(E.coordinates);case"MultiPolygon":for(k=0;k<E.coordinates.length;k++)G+=v(E.coordinates[k]);return G;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(k=0;k<E.geometries.length;k++)G+=f(E.geometries[k]);return G}},ring:_},P="vjmapgis-ctrl",C="vjmap-map-draw_ctrl-draw-btn",L="vjmap-map-draw_line",D="vjmap-map-draw_polygon",F="vjmap-map-draw_point",j="vjmap-map-draw_trash",K="vjmap-map-draw_combine",ee="vjmap-map-draw_uncombine",Q="vjmapgis-ctrl-group",le="active",pe="vjmap-map-draw_boxselect",de="vjmap-map-draw-hot",Ee="vjmap-map-draw-cold",Pe="add",Je="move",xt="drag",vt="pointer",ct="none",Rt={POLYGON:"polygon",LINE:"line_string",POINT:"point"},Pt="Feature",nn="Polygon",mn="LineString",cn="Point",ht="FeatureCollection",un="Multi",rn="MultiPoint",wn="MultiLineString",An="MultiPolygon",dn={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},Lr="draw.create",oi="draw.delete",kn="draw.update",xi="draw.selectionchange",co="draw.modechange",uo="draw.actionable",zi="draw.render",Dr="draw.combine",Eo="draw.uncombine",Dn="draw.updatecoordinate",Hi="move",Oi="change_coordinates",Mr="feature",si="midpoint",pi="vertex",In="true",tr="false",Fi=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],$r={Point:0,LineString:1,Polygon:2};function Xi(f,E){var k=$r[f.geometry.type]-$r[E.geometry.type];return k===0&&f.geometry.type===nn?f.area-E.area:k}function Vr(f){if(this._items={},this._nums={},this._length=f?f.length:0,f)for(var E=0,k=f.length;E<k;E++)this.add(f[E]),f[E]!==void 0&&(typeof f[E]=="string"?this._items[f[E]]=E:this._nums[f[E]]=E)}Vr.prototype.add=function(f){return this.has(f)||(this._length++,typeof f=="string"?this._items[f]=this._length:this._nums[f]=this._length),this},Vr.prototype.delete=function(f){return this.has(f)===!1||(this._length--,delete this._items[f],delete this._nums[f]),this},Vr.prototype.has=function(f){return(typeof f=="string"||typeof f=="number")&&(this._items[f]!==void 0||this._nums[f]!==void 0)},Vr.prototype.values=function(){var f=this,E=[];return Object.keys(this._items).forEach(function(k){E.push({k,v:f._items[k]})}),Object.keys(this._nums).forEach(function(k){E.push({k:JSON.parse(k),v:f._nums[k]})}),E.sort(function(k,G){return k.v-G.v}).map(function(k){return k.k})},Vr.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var gr=[Mr,si,pi],ei={click:function(f,E,k){return ho(f,E,k,k.options.clickBuffer)},touch:function(f,E,k){return ho(f,E,k,k.options.touchBuffer)}};function ho(f,E,k,G){if(k.map===null)return[];var Z=f?function(Se,_e){return _e===void 0&&(_e=0),[[Se.point.x-_e,Se.point.y-_e],[Se.point.x+_e,Se.point.y+_e]]}(f,G):E,J={};k.options.styles&&(J.layers=k.options.styles.map(function(Se){return Se.id}));var ne=k.map.queryRenderedFeatures(Z,J).filter(function(Se){return gr.indexOf(Se.properties.meta)!==-1}),fe=new Vr,ce=[];return ne.forEach(function(Se){var _e=Se.properties.id;fe.has(_e)||(fe.add(_e),ce.push(Se))}),function(Se){return Se.map(function(_e){return _e.geometry.type===nn&&(_e.area=M.geometry({type:Pt,property:{},geometry:_e.geometry})),_e}).sort(Xi).map(function(_e){return delete _e.area,_e})}(ce)}function Ji(f,E){var k=ei.click(f,null,E),G={mouse:ct};return k[0]&&(G.mouse=k[0].properties.active===In?Je:vt,G.feature=k[0].properties.meta),E.events.currentModeName().indexOf("draw")!==-1&&(G.mouse=Pe),E.ui.queueMapClasses(G),E.ui.updateMapClasses(),k[0]}function Ki(f,E){var k=f.x-E.x,G=f.y-E.y;return Math.sqrt(k*k+G*G)}function Io(f,E,k){k===void 0&&(k={});var G=k.fineTolerance!=null?k.fineTolerance:4,Z=k.grossTolerance!=null?k.grossTolerance:12,J=k.interval!=null?k.interval:500;f.point=f.point||E.point,f.time=f.time||E.time;var ne=Ki(f.point,E.point);return ne<G||ne<Z&&E.time-f.time<J}function jo(f,E,k){k===void 0&&(k={});var G=k.tolerance!=null?k.tolerance:25,Z=k.interval!=null?k.interval:250;return f.point=f.point||E.point,f.time=f.time||E.time,Ki(f.point,E.point)<G&&E.time-f.time<Z}function we(f,E){return f(E={exports:{}},E.exports),E.exports}var Oe=we(function(f){var E=f.exports=function(k,G){if(G||(G=16),k===void 0&&(k=128),k<=0)return"0";for(var Z=Math.log(Math.pow(2,k))/Math.log(G),J=2;Z===1/0;J*=2)Z=Math.log(Math.pow(2,k/J))/Math.log(G)*J;var ne=Z-Math.floor(Z),fe="";for(J=0;J<Math.floor(Z);J++)fe=Math.floor(Math.random()*G).toString(G)+fe;if(ne){var ce=Math.pow(G,ne);fe=Math.floor(Math.random()*ce).toString(G)+fe}var Se=parseInt(fe,G);return Se!==1/0&&Se>=Math.pow(2,k)?E(k,G):fe};E.rack=function(k,G,Z){var J=function(fe){var ce=0;do{if(ce++>10){if(!Z)throw new Error("too many ID collisions, use more bits");k+=Z}var Se=E(k,G)}while(Object.hasOwnProperty.call(ne,Se));return ne[Se]=fe,Se},ne=J.hats={};return J.get=function(fe){return J.hats[fe]},J.set=function(fe,ce){return J.hats[fe]=ce,J},J.bits=k||128,J.base=G||16,J}}),ke=function(f,E){this.ctx=f,this.properties=E.properties||{},this.coordinates=E.geometry.coordinates,this.id=E.id||Oe(),this.type=E.geometry.type};ke.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},ke.prototype.incomingCoords=function(f){this.setCoordinates(f)},ke.prototype.setCoordinates=function(f){this.coordinates=f,this.changed()},ke.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},ke.prototype.setProperty=function(f,E){this.properties[f]=E},ke.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:Pt,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},ke.prototype.internal=function(f){var E={id:this.id,meta:Mr,"meta:type":this.type,active:tr,mode:f};if(this.ctx.options.userProperties)for(var k in this.properties)E["user_"+k]=this.properties[k];return{type:Pt,properties:E,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var dt=function(f,E){ke.call(this,f,E)};(dt.prototype=Object.create(ke.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},dt.prototype.updateCoordinate=function(f,E,k){this.coordinates=arguments.length===3?[E,k]:[f,E],this.changed()},dt.prototype.getCoordinate=function(){return this.getCoordinates()};var mt=function(f,E){ke.call(this,f,E)};(mt.prototype=Object.create(ke.prototype)).isValid=function(){return this.coordinates.length>1},mt.prototype.addCoordinate=function(f,E,k){this.changed();var G=parseInt(f,10);this.coordinates.splice(G,0,[E,k])},mt.prototype.getCoordinate=function(f){var E=parseInt(f,10);return JSON.parse(JSON.stringify(this.coordinates[E]))},mt.prototype.removeCoordinate=function(f){this.changed(),this.coordinates.splice(parseInt(f,10),1)},mt.prototype.updateCoordinate=function(f,E,k){var G=parseInt(f,10);this.coordinates[G]=[E,k],this.changed()};var Dt=function(f,E){ke.call(this,f,E),this.coordinates=this.coordinates.map(function(k){return k.slice(0,-1)})};(Dt.prototype=Object.create(ke.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(f){return f.length>2})},Dt.prototype.incomingCoords=function(f){this.coordinates=f.map(function(E){return E.slice(0,-1)}),this.changed()},Dt.prototype.setCoordinates=function(f){this.coordinates=f,this.changed()},Dt.prototype.addCoordinate=function(f,E,k){this.changed();var G=f.split(".").map(function(Z){return parseInt(Z,10)});this.coordinates[G[0]].splice(G[1],0,[E,k])},Dt.prototype.removeCoordinate=function(f){this.changed();var E=f.split(".").map(function(G){return parseInt(G,10)}),k=this.coordinates[E[0]];k&&(k.splice(E[1],1),k.length<3&&this.coordinates.splice(E[0],1))},Dt.prototype.getCoordinate=function(f){var E=f.split(".").map(function(G){return parseInt(G,10)}),k=this.coordinates[E[0]];return JSON.parse(JSON.stringify(k[E[1]]))},Dt.prototype.getCoordinates=function(){var f=this.coordinates.map(function(E){return E.concat([E[0]])});return f.length==1&&f[0].length==1&&f[0][0]===void 0&&(f=[[]]),f},Dt.prototype.updateCoordinate=function(f,E,k){this.changed();var G=f.split("."),Z=parseInt(G[0],10),J=parseInt(G[1],10);this.coordinates[Z]===void 0&&(this.coordinates[Z]=[]),this.coordinates[Z][J]=[E,k]};var Bt={MultiPoint:dt,MultiLineString:mt,MultiPolygon:Dt},Vt=function(f,E,k,G,Z){var J=k.split("."),ne=parseInt(J[0],10),fe=J[1]?J.slice(1).join("."):null;return f[ne][E](fe,G,Z)},Ft=function(f,E){if(ke.call(this,f,E),delete this.coordinates,this.model=Bt[E.geometry.type],this.model===void 0)throw new TypeError(E.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(E.geometry.coordinates)};function kt(f){this.map=f.map,this.drawConfig=JSON.parse(JSON.stringify(f.options||{})),this._ctx=f}(Ft.prototype=Object.create(ke.prototype))._coordinatesToFeatures=function(f){var E=this,k=this.model.bind(this);return f.map(function(G){return new k(E.ctx,{id:Oe(),type:Pt,properties:{},geometry:{coordinates:G,type:E.type.replace("Multi","")}})})},Ft.prototype.isValid=function(){return this.features.every(function(f){return f.isValid()})},Ft.prototype.setCoordinates=function(f){this.features=this._coordinatesToFeatures(f),this.changed()},Ft.prototype.getCoordinate=function(f){return Vt(this.features,"getCoordinate",f)},Ft.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(f){return f.type===nn?f.getCoordinates():f.coordinates})))},Ft.prototype.updateCoordinate=function(f,E,k){Vt(this.features,"updateCoordinate",f,E,k),this.changed()},Ft.prototype.addCoordinate=function(f,E,k){Vt(this.features,"addCoordinate",f,E,k),this.changed()},Ft.prototype.removeCoordinate=function(f){Vt(this.features,"removeCoordinate",f),this.changed()},Ft.prototype.getFeatures=function(){return this.features},kt.prototype.setSelected=function(f){return this._ctx.store.setSelected(f)},kt.prototype.setSelectedCoordinates=function(f){var E=this;this._ctx.store.setSelectedCoordinates(f),f.reduce(function(k,G){return k[G.feature_id]===void 0&&(k[G.feature_id]=!0,E._ctx.store.get(G.feature_id).changed()),k},{})},kt.prototype.getSelected=function(){return this._ctx.store.getSelected()},kt.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},kt.prototype.isSelected=function(f){return this._ctx.store.isSelected(f)},kt.prototype.getFeature=function(f){if(this._ctx.store)return this._ctx.store.get(f)},kt.prototype.select=function(f){return this._ctx.store.select(f)},kt.prototype.deselect=function(f){return this._ctx.store.deselect(f)},kt.prototype.deleteFeature=function(f,E){return E===void 0&&(E={}),this._ctx.store.delete(f,E)},kt.prototype.addFeature=function(f){return this._ctx.store.add(f)},kt.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},kt.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},kt.prototype.setActionableState=function(f){f===void 0&&(f={});var E={trash:f.trash||!1,combineFeatures:f.combineFeatures||!1,uncombineFeatures:f.uncombineFeatures||!1};return this._ctx.events.actionable(E)},kt.prototype.changeMode=function(f,E,k){return E===void 0&&(E={}),k===void 0&&(k={}),this._ctx.events.changeMode(f,E,k)},kt.prototype.updateUIClasses=function(f){return this._ctx.ui.queueMapClasses(f)},kt.prototype.activateUIButton=function(f){return this._ctx.ui.setActiveButton(f)},kt.prototype.featuresAt=function(f,E,k){if(k===void 0&&(k="click"),k!=="click"&&k!=="touch")throw new Error("invalid buffer type");return ei[k](f,E,this._ctx)},kt.prototype.newFeature=function(f){var E=f.geometry.type;return E===cn?new dt(this._ctx,f):E===mn?new mt(this._ctx,f):E===nn?new Dt(this._ctx,f):new Ft(this._ctx,f)},kt.prototype.isInstanceOf=function(f,E){if(f===cn)return E instanceof dt;if(f===mn)return E instanceof mt;if(f===nn)return E instanceof Dt;if(f==="MultiFeature")return E instanceof Ft;throw new Error("Unknown feature class: "+f)},kt.prototype.doRender=function(f){return this._ctx.store.featureChanged(f)},kt.prototype.onSetup=function(){},kt.prototype.onDrag=function(){},kt.prototype.onClick=function(){},kt.prototype.onMouseMove=function(){},kt.prototype.onMouseDown=function(){},kt.prototype.onMouseUp=function(){},kt.prototype.onMouseOut=function(){},kt.prototype.onKeyUp=function(){},kt.prototype.onKeyDown=function(){},kt.prototype.onTouchStart=function(){},kt.prototype.onTouchMove=function(){},kt.prototype.onTouchEnd=function(){},kt.prototype.onTap=function(){},kt.prototype.onStop=function(){},kt.prototype.onTrash=function(){},kt.prototype.onCombineFeature=function(){},kt.prototype.onUncombineFeature=function(){},kt.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Qt={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Sn=Object.keys(Qt);function Mn(f){var E=Object.keys(f);return function(k,G){G===void 0&&(G={});var Z={},J=E.reduce(function(ne,fe){return ne[fe]=f[fe],ne},new kt(k));return{start:function(){var ne=this;Z=J.onSetup(G),Sn.forEach(function(fe){var ce,Se=Qt[fe],_e=function(){return!1};f[Se]&&(_e=function(){return!0}),ne.on(fe,_e,(ce=Se,function(De){return J[ce](Z,De)}))})},stop:function(){J.onStop(Z)},trash:function(){J.onTrash(Z)},combineFeatures:function(){J.onCombineFeatures(Z)},uncombineFeatures:function(){J.onUncombineFeatures(Z)},render:function(ne,fe){J.toDisplayFeatures(Z,ne,fe)}}}}function ve(f){return[].concat(f).filter(function(E){return E!==void 0})}function X(){var f=this;if(!(f.ctx.map&&f.ctx.map.getSource(de+f.ctx.options.styleId)!==void 0))return ce();var E=f.ctx.events.currentModeName();f.ctx.ui.queueMapClasses({mode:E});var k=[],G=[];f.isDirty?G=f.getAllIds():(k=f.getChangedIds().filter(function(Se){return f.get(Se)!==void 0}),G=f.sources.hot.filter(function(Se){return Se.properties.id&&k.indexOf(Se.properties.id)===-1&&f.get(Se.properties.id)!==void 0}).map(function(Se){return Se.properties.id})),f.sources.hot=[];var Z=f.sources.cold.length;f.sources.cold=f.isDirty?[]:f.sources.cold.filter(function(Se){var _e=Se.properties.id||Se.properties.parent;return k.indexOf(_e)===-1});var J=Z!==f.sources.cold.length||G.length>0;function ne(Se,_e){var De=f.get(Se).internal(E);f.ctx.events.currentModeRender(De,function(Ge){f.sources[_e].push(Ge)})}if(k.forEach(function(Se){return ne(Se,"hot")}),G.forEach(function(Se){return ne(Se,"cold")}),J&&f.ctx.map.getSource(Ee+f.ctx.options.styleId).setData({type:ht,features:f.sources.cold}),f.ctx.map.getSource(de+f.ctx.options.styleId).setData({type:ht,features:f.sources.hot}),f._emitSelectionChange&&(f.ctx.map.fire(xi,{styleId:f.ctx.options.styleId,features:f.getSelected().map(function(Se){return Se.toGeoJSON()}),points:f.getSelectedCoordinates().map(function(Se){return{type:Pt,properties:{},geometry:{type:cn,coordinates:Se.coordinates}}})}),f._emitSelectionChange=!1),f._deletedFeaturesToEmit.length){var fe=f._deletedFeaturesToEmit.map(function(Se){return Se.toGeoJSON()});f._deletedFeaturesToEmit=[],f.ctx.map.fire(oi,{features:fe,styleId:f.ctx.options.styleId})}function ce(){f.isDirty=!1,f.clearChangedIds()}ce(),f.ctx.map.fire(zi,{styleId:f.ctx.options.styleId})}function te(f){var E,k=this;this._features={},this._featureIds=new Vr,this._selectedFeatureIds=new Vr,this._selectedCoordinates=[],this._changedFeatureIds=new Vr,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=f,this.sources={hot:[],cold:[]},this.render=function(){E||(E=requestAnimationFrame(function(){E=null,X.call(k)}))},this.isDirty=!1}function xe(f,E){var k=f._selectedCoordinates.filter(function(G){return f._selectedFeatureIds.has(G.feature_id)});f._selectedCoordinates.length===k.length||E.silent||(f._emitSelectionChange=!0),f._selectedCoordinates=k}te.prototype.createRenderBatch=function(){var f=this,E=this.render,k=0;return this.render=function(){k++},function(){f.render=E,k>0&&f.render()}},te.prototype.setDirty=function(){return this.isDirty=!0,this},te.prototype.featureChanged=function(f){return this._changedFeatureIds.add(f),this},te.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},te.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},te.prototype.getAllIds=function(){return this._featureIds.values()},te.prototype.add=function(f){return this.featureChanged(f.id),this._features[f.id]=f,this._featureIds.add(f.id),this},te.prototype.delete=function(f,E){var k=this;return E===void 0&&(E={}),ve(f).forEach(function(G){k._featureIds.has(G)&&(k._featureIds.delete(G),k._selectedFeatureIds.delete(G),E.silent||k._deletedFeaturesToEmit.indexOf(k._features[G])===-1&&k._deletedFeaturesToEmit.push(k._features[G]),delete k._features[G],k.isDirty=!0)}),xe(this,E),this},te.prototype.get=function(f){return this._features[f]},te.prototype.getAll=function(){var f=this;return Object.keys(this._features).map(function(E){return f._features[E]})},te.prototype.select=function(f,E){var k=this;return E===void 0&&(E={}),ve(f).forEach(function(G){k._selectedFeatureIds.has(G)||(k._selectedFeatureIds.add(G),k._changedFeatureIds.add(G),E.silent||(k._emitSelectionChange=!0))}),this},te.prototype.deselect=function(f,E){var k=this;return E===void 0&&(E={}),ve(f).forEach(function(G){k._selectedFeatureIds.has(G)&&(k._selectedFeatureIds.delete(G),k._changedFeatureIds.add(G),E.silent||(k._emitSelectionChange=!0))}),xe(this,E),this},te.prototype.clearSelected=function(f){return f===void 0&&(f={}),this.deselect(this._selectedFeatureIds.values(),{silent:f.silent}),this},te.prototype.setSelected=function(f,E){var k=this;return E===void 0&&(E={}),f=ve(f),this.deselect(this._selectedFeatureIds.values().filter(function(G){return f.indexOf(G)===-1}),{silent:E.silent}),this.select(f.filter(function(G){return!k._selectedFeatureIds.has(G)}),{silent:E.silent}),this},te.prototype.setSelectedCoordinates=function(f){return this._selectedCoordinates=f,this._emitSelectionChange=!0,this},te.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},te.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},te.prototype.getSelected=function(){var f=this;return this._selectedFeatureIds.values().map(function(E){return f.get(E)})},te.prototype.getSelectedCoordinates=function(){var f=this;return this._selectedCoordinates.map(function(E){return{coordinates:f.get(E.feature_id).getCoordinate(E.coord_path)}})},te.prototype.isSelected=function(f){return this._selectedFeatureIds.has(f)},te.prototype.setFeatureProperty=function(f,E,k){this.get(f).setProperty(E,k),this.featureChanged(f)},te.prototype.storeMapConfig=function(){var f=this;Fi.forEach(function(E){f.ctx.map[E]&&(f._mapInitialConfig[E]=f.ctx.map[E].isEnabled())})},te.prototype.restoreMapConfig=function(){var f=this;Object.keys(this._mapInitialConfig).forEach(function(E){f._mapInitialConfig[E]?f.ctx.map[E].enable():f.ctx.map[E].disable()})},te.prototype.getInitialConfigValue=function(f){return this._mapInitialConfig[f]===void 0||this._mapInitialConfig[f]};var Ie=function(){for(var f=arguments,E={},k=0;k<arguments.length;k++){var G=f[k];for(var Z in G)Ue.call(G,Z)&&(E[Z]=G[Z])}return E},Ue=Object.prototype.hasOwnProperty,Qe=["mode","feature","mouse"];function Ke(f){var E={},k=null,G={mode:null,feature:null,mouse:null},Z={mode:null,feature:null,mouse:null};function J(_e){Z=Ie(Z,_e)}function ne(){var _e,De;if(f.container){var Ge=[],Xe=[];Qe.forEach(function(it){Z[it]!==G[it]&&(Ge.push(it+"-"+G[it]),Z[it]!==null&&Xe.push(it+"-"+Z[it]))}),Ge.length>0&&(_e=f.container.classList).remove.apply(_e,Ge),Xe.length>0&&(De=f.container.classList).add.apply(De,Xe),G=Ie(G,Z)}}function fe(_e,De){De===void 0&&(De={});var Ge=document.createElement("button");if(Ge.className=C+" "+De.className,Ge.setAttribute("title",De.title),De.style)for(var Xe in De.style)Ge.style[Xe]=De.style[Xe];return De.container.appendChild(Ge),Ge.addEventListener("click",function(it){if(it.preventDefault(),it.stopPropagation(),it.target===k)return ce(),void De.onDeactivate();Se(_e),De.onActivate()},!0),Ge}function ce(){k&&(k.classList.remove(le),k=null)}function Se(_e){ce();var De=E[_e];De&&De&&_e!=="trash"&&(De.classList.add(le),k=De)}return{setActiveButton:Se,queueMapClasses:J,updateMapClasses:ne,clearMapClasses:function(){J({mode:null,feature:null,mouse:null}),ne()},addButtons:function(){var _e=f.options.controls,De=document.createElement("div");if(De.className=Q+" "+P,!_e||f.options.isActionDrawMode==1)return De;_e[Rt.LINE]&&(E[Rt.LINE]=fe(Rt.LINE,{container:De,className:L,title:"LineString tool "+(f.options.keybindings?"(l)":""),onActivate:function(){return f.events.changeMode(dn.DRAW_LINE_STRING)},onDeactivate:function(){return f.events.trash()}})),_e[Rt.POLYGON]&&(E[Rt.POLYGON]=fe(Rt.POLYGON,{container:De,className:D,title:"Polygon tool "+(f.options.keybindings?"(p)":""),onActivate:function(){return f.events.changeMode(dn.DRAW_POLYGON)},onDeactivate:function(){return f.events.trash()}})),_e[Rt.POINT]&&(E[Rt.POINT]=fe(Rt.POINT,{container:De,className:F,title:"Marker tool "+(f.options.keybindings?"(m)":""),onActivate:function(){return f.events.changeMode(dn.DRAW_POINT)},onDeactivate:function(){return f.events.trash()}})),_e.trash&&(E.trash=fe("trash",{container:De,className:j,title:"Delete",onActivate:function(){f.events.trash()}})),_e.combine_features&&(E.combine_features=fe("combineFeatures",{container:De,className:K,title:"Combine",onActivate:function(){f.events.combineFeatures()}})),_e.uncombine_features&&(E.uncombine_features=fe("uncombineFeatures",{container:De,className:ee,title:"Uncombine",onActivate:function(){f.events.uncombineFeatures()}}));var Ge=f.options.addControls;if(Array.isArray(Ge)&&Ge.length>0)for(var Xe=function(){var Wt=Zt[it];_e[Wt.id]&&(Wt.isCheckbox?E[Wt.id]=function(Nt,Te){Te===void 0&&(Te={});var qe=document.createElement("input");if(qe.setAttribute("type","checkbox"),qe.setAttribute("title",Te.title),qe.checked=Te.checked===!0,qe.className=C+" "+Te.className,qe.setAttribute("title",Te.title),Te.style)for(var wt in Te.style)qe.style[wt]=Te.style[wt];return Te.container.appendChild(qe),qe.addEventListener("change",function(pt){pt.preventDefault(),pt.stopPropagation(),Te.onActivate(pt)},!0),qe}(Wt.id,{container:Wt.container||De,className:Wt.className,title:Wt.title||Wt.id,style:Wt.style,checked:Wt.checked,onActivate:function(Nt){Wt.onActivate&&Wt.onActivate(f,Nt)}}):E[Wt.id]=fe(Wt.id,{container:Wt.container||De,className:Wt.className,title:Wt.title||Wt.id,style:Wt.style,onActivate:function(){Wt.onActivate&&Wt.onActivate(f)},onDeactivate:function(){Wt.onDeactivate&&Wt.onDeactivate(f)}}))},it=0,Zt=Ge;it<Zt.length;it+=1)Xe();return De},removeButtons:function(){Object.keys(E).forEach(function(_e){var De=E[_e];De.parentNode&&De.parentNode.removeChild(De),delete E[_e]})}}}var Ve="vjmap-map-draw-hot",et="vjmap-map-draw-cold",gt="Feature",jt="FeatureCollection",yt="simple_select",Xt={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine",UPDATE_COORDINATE:"draw.updatecoordinate"},sn=function(){this.cursor=-1,this.recordes=[]};sn.prototype.addRecord=function(f){if(f){this.cursor+1<this.recordes.length&&(this.recordes=this.recordes.slice(0,this.cursor+1)),this.recordes.push(f);var E=this.recordes.length;this.cursor=E-1}return this},sn.prototype.undoRecord=function(){var f=this.recordes.length,E=null;return f===0?this.cursor=-1:f>0&&this.cursor>-1&&(E=this.recordes[this.cursor],this.cursor=this.cursor-1),E},sn.prototype.redoRecord=function(){var f=this.recordes.length,E=null;return f===0&&(this.cursor=-1),f>0&&this.cursor<f-1&&(E=this.recordes[this.cursor+1],this.cursor=this.cursor+1),E},sn.prototype.getCurrentRecord=function(){var f=this.recordes.length,E=null;return f===0?null:(this.cursor>-1&&this.cursor<f&&(E=this.recordes[this.cursor]),E)},sn.prototype.getAllRecords=function(){return this.recordes},sn.prototype.clear=function(){this.cursor=-1,this.recordes=[]};var Kt=function(f,E,k,G){f===void 0&&(f=0),E===void 0&&(E=0),k===void 0&&(k=[]),G===void 0&&(G=[]),this.type=f,this.action=E,this.features=k,this.prevFeatures=G};function je(f){var E=null,k=null,G=new sn,Z=Object.assign({},{onDrawCreate:function(ne){var fe=new Kt(3,0,ne.features);G.addRecord(fe)},onDrawUpdate:function(ne){var fe=new Kt(2,0,ne.features,ne.prevFeatures);G.addRecord(fe)},onDrawDelete:function(ne){var fe=new Kt(1,0,ne.features);G.addRecord(fe)},onDrawCombine:function(ne){var fe=new Kt(4,0,ne.createdFeatures,ne.deletedFeatures);G.addRecord(fe)},onDrawUncombine:function(ne){var fe=new Kt(4,0,ne.createdFeatures,ne.deletedFeatures);G.addRecord(fe)},onDrawReplace:function(ne){var fe=new Kt(4,0,ne.createdFeatures,ne.deletedFeatures);G.addRecord(fe)},onKeydown:function(ne){ne.keyCode===90?(ne.preventDefault(),api.undoHistory()):ne.keyCode===89&&(ne.preventDefault(),api.redoHistory())}}),J={onRemove:function(){return f.map.off("load",J.connect),clearInterval(k),J.removeLayers(),f.store.restoreMapConfig(),f.ui.removeButtons(),f.events.removeEventListeners(),f.ui.clearMapClasses(),f.map.off(Xt.CREATE,Z.onDrawCreate),f.map.off(Xt.UPDATE,Z.onDrawUpdate),f.map.off(Xt.DELETE,Z.onDrawDelete),f.map.off(Xt.COMBINE_FEATURES,Z.onDrawCombine),f.map.off(Xt.UNCOMBINE_FEATURES,Z.onDrawUncombine),f.map.off(Xt.REPLACE,Z.onDrawReplace),f.container.removeEventListener("keydown",Z.onKeydown),f.map=null,f.container=null,f.store=null,E&&E.parentNode&&E.parentNode.removeChild(E),E=null,this},connect:function(){f.map.off("load",J.connect),clearInterval(k),J.addLayers(),f.store.storeMapConfig(),f.events.addEventListeners()},undoHistory:function(){var ne=f.api;if(ne&&G){var fe=G.undoRecord();if(fe){var ce=fe.getType(),Se=fe.getFeatures(),_e=fe.getPrevFeatures();switch(ce){case 1:if(Se.length>0){Se.map(function(Nt){ne.add(Object.assign({},Nt,{type:Nt.type||gt}))});var De=Se.map(function(Nt){return Nt.id});ne.changeMode(yt,{featureIds:De})}break;case 2:if(Se.length>0){var Ge=Se.map(function(Nt){return Nt.id});ne.delete(Ge)}if(_e.length>0){_e.map(function(Nt){ne.add(Object.assign({},Nt,{type:Nt.type||gt}))});var Xe=_e.map(function(Nt){return Nt.id});ne.changeMode(yt,{featureIds:Xe})}break;case 3:if(Se.length>0){var it=Se.map(function(Nt){return Nt.id});ne.delete(it)}break;case 4:if(Se.length>0){var Zt=Se.map(function(Nt){return Nt.id});ne.delete(Zt)}if(_e.length>0){_e.map(function(Nt){ne.add(Object.assign({},Nt,{type:Nt.type||gt}))});var Wt=_e.map(function(Nt){return Nt.id});ne.changeMode(yt,{featureIds:Wt})}}}}},redoHistory:function(){var ne=f.api;if(ne&&G){var fe=G.redoRecord();if(fe){ne.getAll();var ce=fe.getType(),Se=fe.getFeatures(),_e=fe.getPrevFeatures();switch(ce){case 3:if(Se.length>0){Se.map(function(Nt){ne.add(Object.assign({},Nt,{type:Nt.type||gt}))});var De=Se.map(function(Nt){return Nt.id});ne.changeMode(yt,{featureIds:De})}break;case 2:if(_e.length>0){var Ge=_e.map(function(Nt){return Nt.id});ne.delete(Ge)}if(Se.length>0){Se.map(function(Nt){ne.add(Object.assign({},Nt,{type:Nt.type||gt}))});var Xe=Se.map(function(Nt){return Nt.id});ne.changeMode(yt,{featureIds:Xe})}break;case 1:if(Se.length>0){var it=Se.map(function(Nt){return Nt.id});ne.delete(it)}break;case 4:if(_e.length>0){var Zt=_e.map(function(Nt){return Nt.id});ne.delete(Zt)}if(Se.length>0){Se.map(function(Nt){ne.add(Object.assign({},Nt,{type:Nt.type||gt}))});var Wt=Se.map(function(Nt){return Nt.id});ne.changeMode(yt,{featureIds:Wt})}}}}},onAdd:function(ne){var fe=ne.fire;return ne.fire=function(ce,Se){var _e=arguments;return fe.length===1&&arguments.length!==1&&(_e=[Ie({},{type:ce},Se)]),fe.apply(ne,_e)},f.map=ne,f.events=function(ce){var Se=Object.keys(ce.options.modes).reduce(function(Te,qe){return Te[qe]=Mn(ce.options.modes[qe]),Te},{}),_e={},De={},Ge={},Xe=null,it=null;Ge.drag=function(Te,qe){qe({point:Te.point,time:new Date().getTime()})?(ce.ui.queueMapClasses({mouse:xt}),it.drag(Te)):Te.originalEvent.stopPropagation()},Ge.mousedrag=function(Te){Ge.drag(Te,function(qe){return!Io(_e,qe)})},Ge.touchdrag=function(Te){Ge.drag(Te,function(qe){return!jo(De,qe)})},Ge.mousemove=function(Te){if((Te.originalEvent.buttons!==void 0?Te.originalEvent.buttons:Te.originalEvent.which)===1)return Ge.mousedrag(Te);var qe=Ji(Te,ce);Te.featureTarget=qe,it.mousemove(Te)},Ge.mousedown=function(Te){_e={time:new Date().getTime(),point:Te.point};var qe=Ji(Te,ce);Te.featureTarget=qe,it.mousedown(Te)},Ge.mouseup=function(Te){var qe=Ji(Te,ce);Te.featureTarget=qe,Io(_e,{point:Te.point,time:new Date().getTime()})?it.click(Te):it.mouseup(Te)},Ge.mouseout=function(Te){it.mouseout(Te)},Ge.touchstart=function(Te){if(Te.originalEvent.preventDefault(),ce.options.touchEnabled){De={time:new Date().getTime(),point:Te.point};var qe=ei.touch(Te,null,ce)[0];Te.featureTarget=qe,it.touchstart(Te)}},Ge.touchmove=function(Te){if(Te.originalEvent.preventDefault(),ce.options.touchEnabled)return it.touchmove(Te),Ge.touchdrag(Te)},Ge.touchend=function(Te){if(Te.originalEvent.preventDefault(),ce.options.touchEnabled){var qe=ei.touch(Te,null,ce)[0];Te.featureTarget=qe,jo(De,{time:new Date().getTime(),point:Te.point})?it.tap(Te):it.touchend(Te)}};var Zt=function(Te){return!(Te===8||Te===46||Te>=48&&Te<=57)};function Wt(Te,qe,wt){wt===void 0&&(wt={}),it.stop();var pt=Se[Te];if(pt===void 0)throw new Error(Te+" is not valid");Xe=Te;var Jt=pt(ce,qe);it=n(Jt,ce),wt.silent||ce.map.fire(co,{mode:Te,styleId:ce.options.styleId}),ce.store&&(ce.store.setDirty(),ce.store.render())}Ge.keydown=function(Te){(Te.srcElement||Te.target).classList[0]==="vjmapgis-canvas"&&(Te.keyCode!==8&&Te.keyCode!==46||!ce.options.controls.trash?Zt(Te.keyCode)?it.keydown(Te):Te.keyCode===49&&ce.options.controls.point?Wt(dn.DRAW_POINT):Te.keyCode===50&&ce.options.controls.line_string?Wt(dn.DRAW_LINE_STRING):Te.keyCode===51&&ce.options.controls.polygon&&Wt(dn.DRAW_POLYGON):(Te.preventDefault(),it.trash()))},Ge.keyup=function(Te){Zt(Te.keyCode)&&it.keyup(Te)},Ge.zoomend=function(){ce.store.changeZoom()},Ge.data=function(Te){if(Te.dataType==="style"){var qe=ce.setup,wt=ce.map,pt=ce.options,Jt=ce.store;pt.styles.some(function(en){return wt.getLayer(en.id)})||(qe.addLayers(),Jt.setDirty(),Jt.render())}};var Nt={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){Xe=ce.options.defaultMode,it=n(Se[Xe](ce),ce)},changeMode:Wt,actionable:function(Te){var qe=!1;Object.keys(Te).forEach(function(wt){if(Nt[wt]===void 0)throw new Error("Invalid action type");Nt[wt]!==Te[wt]&&(qe=!0),Nt[wt]=Te[wt]}),qe&&ce.map.fire(uo,{actions:Nt,styleId:ce.options.styleId})},currentModeName:function(){return Xe},currentModeRender:function(Te,qe){return it.render(Te,qe)},fire:function(Te,qe){Ge[Te]&&Ge[Te](qe)},addEventListeners:function(){ce.map.on("mousemove",Ge.mousemove),ce.map.on("mousedown",Ge.mousedown),ce.map.on("mouseup",Ge.mouseup),ce.map.on("data",Ge.data),ce.map.on("touchmove",Ge.touchmove),ce.map.on("touchstart",Ge.touchstart),ce.map.on("touchend",Ge.touchend),ce.container.addEventListener("mouseout",Ge.mouseout),ce.options.keybindings&&(ce.container.addEventListener("keydown",Ge.keydown),ce.container.addEventListener("keyup",Ge.keyup))},removeEventListeners:function(){ce.map.off("mousemove",Ge.mousemove),ce.map.off("mousedown",Ge.mousedown),ce.map.off("mouseup",Ge.mouseup),ce.map.off("data",Ge.data),ce.map.off("touchmove",Ge.touchmove),ce.map.off("touchstart",Ge.touchstart),ce.map.off("touchend",Ge.touchend),ce.container.removeEventListener("mouseout",Ge.mouseout),ce.options.keybindings&&(ce.container.removeEventListener("keydown",Ge.keydown),ce.container.removeEventListener("keyup",Ge.keyup))},trash:function(Te){it.trash(Te)},combineFeatures:function(){it.combineFeatures()},uncombineFeatures:function(){it.uncombineFeatures()},getMode:function(){return Xe}}}(f),f.ui=Ke(f),f.container=ne.getContainer(),f.store=new te(f),E=f.ui.addButtons(),f.options.boxSelect&&(ne.boxZoom.disable(),ne.dragPan.disable(),ne.dragPan.enable()),ne.loaded()?J.connect():(ne.on("load",J.connect),k=setInterval(function(){ne.loaded()&&J.connect()},16)),ne.on(Xt.CREATE,Z.onDrawCreate),ne.on(Xt.UPDATE,Z.onDrawUpdate),ne.on(Xt.DELETE,Z.onDrawDelete),ne.on(Xt.COMBINE_FEATURES,Z.onDrawCombine),ne.on(Xt.UNCOMBINE_FEATURES,Z.onDrawUncombine),ne.on(Xt.REPLACE,Z.onDrawReplace),f.container.addEventListener("keydown",Z.onKeydown),f.events.start(),E},addLayers:function(){f.map.addSource(et+f.options.styleId,{data:{type:jt,features:[]},type:"geojson"}),f.map.addSource(Ve+f.options.styleId,{data:{type:jt,features:[]},type:"geojson"}),f.options.styles.forEach(function(ne){f.map.addLayer(ne)}),f.store.setDirty(!0),f.store.render()},removeLayers:function(){f.options.styles.forEach(function(ne){f.map.getLayer(ne.id)&&f.map.removeLayer(ne.id)}),f.map.getSource(et+f.options.styleId)&&f.map.removeSource(et+f.options.styleId),f.map.getSource(Ve+f.options.styleId)&&f.map.removeSource(Ve+f.options.styleId)}};return f.setup=J,J}Kt.prototype.getType=function(){return this.type},Kt.prototype.getAction=function(){return this.action},Kt.prototype.getFeatures=function(){return this.features},Kt.prototype.getPrevFeatures=function(){return this.prevFeatures};var ft=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function Zn(f){return function(E){var k=E.featureTarget;return!!k&&!!k.properties&&k.properties.meta===f}}function Bn(f){return!!f.featureTarget&&!!f.featureTarget.properties&&f.featureTarget.properties.active===In&&f.featureTarget.properties.meta===Mr}function bn(f){return!!f.featureTarget&&!!f.featureTarget.properties&&f.featureTarget.properties.active===tr&&f.featureTarget.properties.meta===Mr}function jn(f){return f.featureTarget===void 0}function Pr(f){var E=f.featureTarget;return!!E&&!!E.properties&&E.properties.meta===pi}function bi(f){return!!f.originalEvent&&f.originalEvent.shiftKey===!0}function zr(f){return f.keyCode===27}function $t(f){return f.keyCode===13}var On=Ln;function Ln(f,E){this.x=f,this.y=E}function yr(f,E){var k=E.getBoundingClientRect();return new On(f.clientX-k.left-(E.clientLeft||0),f.clientY-k.top-(E.clientTop||0))}function wi(f,E,k,G){return{type:Pt,properties:{meta:pi,parent:f,coord_path:k,active:G?In:tr},geometry:{type:cn,coordinates:E}}}Ln.prototype={clone:function(){return new Ln(this.x,this.y)},add:function(f){return this.clone()._add(f)},sub:function(f){return this.clone()._sub(f)},multByPoint:function(f){return this.clone()._multByPoint(f)},divByPoint:function(f){return this.clone()._divByPoint(f)},mult:function(f){return this.clone()._mult(f)},div:function(f){return this.clone()._div(f)},rotate:function(f){return this.clone()._rotate(f)},rotateAround:function(f,E){return this.clone()._rotateAround(f,E)},matMult:function(f){return this.clone()._matMult(f)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(f){return this.x===f.x&&this.y===f.y},dist:function(f){return Math.sqrt(this.distSqr(f))},distSqr:function(f){var E=f.x-this.x,k=f.y-this.y;return E*E+k*k},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(f){return Math.atan2(this.y-f.y,this.x-f.x)},angleWith:function(f){return this.angleWithSep(f.x,f.y)},angleWithSep:function(f,E){return Math.atan2(this.x*E-this.y*f,this.x*f+this.y*E)},_matMult:function(f){var E=f[0]*this.x+f[1]*this.y,k=f[2]*this.x+f[3]*this.y;return this.x=E,this.y=k,this},_add:function(f){return this.x+=f.x,this.y+=f.y,this},_sub:function(f){return this.x-=f.x,this.y-=f.y,this},_mult:function(f){return this.x*=f,this.y*=f,this},_div:function(f){return this.x/=f,this.y/=f,this},_multByPoint:function(f){return this.x*=f.x,this.y*=f.y,this},_divByPoint:function(f){return this.x/=f.x,this.y/=f.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var f=this.y;return this.y=this.x,this.x=-f,this},_rotate:function(f){var E=Math.cos(f),k=Math.sin(f),G=E*this.x-k*this.y,Z=k*this.x+E*this.y;return this.x=G,this.y=Z,this},_rotateAround:function(f,E){var k=Math.cos(f),G=Math.sin(f),Z=E.x+k*(this.x-E.x)-G*(this.y-E.y),J=E.y+G*(this.x-E.x)+k*(this.y-E.y);return this.x=Z,this.y=J,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ln.convert=function(f){return f instanceof Ln?f:Array.isArray(f)?new Ln(f[0],f[1]):f};function zn(f){var E=f[0],k=f[1],G=200375083427892e-7*E/180,Z=Math.log(Math.tan((90+k)*Math.PI/360))/(Math.PI/180);return[G,Z=200375083427892e-7*Z/180]}function ts(f){var E=f[0],k=f[1]/200375083427892e-7*180;return[E/200375083427892e-7*180,k=180/Math.PI*(2*Math.atan(Math.exp(k*Math.PI/180))-Math.PI/2)]}function Yi(f,E,k){E===void 0&&(E={}),k===void 0&&(k=null);var G,Z=f.geometry,J=Z.type,ne=Z.coordinates,fe=f.properties&&f.properties.id,ce=[];function Se(De,Ge){var Xe="",it=null;De.forEach(function(Zt,Wt){var Nt=Ge!=null?Ge+"."+Wt:String(Wt),Te=wi(fe,Zt,Nt,_e(Nt));if(E.midpoints&&it){var qe=function(pt,Jt,en){var Ht=Jt.geometry.coordinates,_n=en.geometry.coordinates;if(Ht[1]>85||Ht[1]<-85||_n[1]>85||_n[1]<-85)return null;var gn=zn(Ht),Un=zn(_n),Kn=ts([(gn[0]+Un[0])/2,(gn[1]+Un[1])/2]),Tn={lng:Kn[0],lat:Kn[1]};return{type:Pt,properties:{meta:si,parent:pt,lng:Tn.lng,lat:Tn.lat,coord_path:en.properties.coord_path},geometry:{type:cn,coordinates:[Tn.lng,Tn.lat]}}}(fe,it,Te);qe&&ce.push(qe)}it=Te;var wt=JSON.stringify(Zt);Xe!==wt&&ce.push(Te),Wt===0&&(Xe=wt)})}function _e(De){return!!E.selectedPaths&&E.selectedPaths.indexOf(De)!==-1}return J===cn?ce.push(wi(fe,ne,k,_e(k))):J===nn?ne.forEach(function(De,Ge){Se(De,k!==null?k+"."+Ge:String(Ge))}):J===mn?Se(ne,k):J.indexOf(un)===0&&(G=J.replace(un,""),ne.forEach(function(De,Ge){var Xe={type:Pt,properties:f.properties,geometry:{type:G,coordinates:De}};ce=ce.concat(Yi(Xe,E,Ge))})),ce}var Si=function(f){setTimeout(function(){f.map&&f.map.doubleClickZoom&&f._ctx&&f._ctx.store&&f._ctx.store.getInitialConfigValue&&f._ctx.store.getInitialConfigValue("doubleClickZoom")&&f.map.doubleClickZoom.enable()},0)},wr=function(f){setTimeout(function(){f.map&&f.map.doubleClickZoom&&f.map.doubleClickZoom.disable()},0)},hr=function(f){if(!f||!f.type)return null;var E=Qs[f.type];if(!E)return null;if(E==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:f}]};if(E==="feature")return{type:"FeatureCollection",features:[f]};if(E==="featurecollection")return f},Qs={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function To(f){switch(f&&f.type||null){case"FeatureCollection":return f.features=f.features.reduce(function(E,k){return E.concat(To(k))},[]),f;case"Feature":return f.geometry?To(f.geometry).map(function(E){var k={type:"Feature",properties:JSON.parse(JSON.stringify(f.properties)),geometry:E};return f.id!==void 0&&(k.id=f.id),k}):[f];case"MultiPoint":return f.coordinates.map(function(E){return{type:"Point",coordinates:E}});case"MultiPolygon":return f.coordinates.map(function(E){return{type:"Polygon",coordinates:E}});case"MultiLineString":return f.coordinates.map(function(E){return{type:"LineString",coordinates:E}});case"GeometryCollection":return f.geometries.map(To).reduce(function(E,k){return E.concat(k)},[]);case"Point":case"Polygon":case"LineString":return[f]}}var po=function(f){if(!f)return[];var E=To(hr(f)),k=[];return E.features.forEach(function(G){G.geometry&&(k=k.concat(function Z(J){return Array.isArray(J)&&J.length&&typeof J[0]=="number"?[J]:J.reduce(function(ne,fe){return Array.isArray(fe)&&Array.isArray(fe[0])?ne.concat(Z(fe)):(ne.push(fe),ne)},[])}(G.geometry.coordinates)))}),k},ns=we(function(f){var E=f.exports=function(_e){return new k(_e)};function k(_e){this.value=_e}function G(_e,De,Ge){var Xe=[],it=[],Zt=!0;return function Wt(Nt){var Te=Ge?Z(Nt):Nt,qe={},wt=!0,pt={node:Te,node_:Nt,path:[].concat(Xe),parent:it[it.length-1],parents:it,key:Xe.slice(-1)[0],isRoot:Xe.length===0,level:Xe.length,circular:null,update:function(Ht,_n){pt.isRoot||(pt.parent.node[pt.key]=Ht),pt.node=Ht,_n&&(wt=!1)},delete:function(Ht){delete pt.parent.node[pt.key],Ht&&(wt=!1)},remove:function(Ht){fe(pt.parent.node)?pt.parent.node.splice(pt.key,1):delete pt.parent.node[pt.key],Ht&&(wt=!1)},keys:null,before:function(Ht){qe.before=Ht},after:function(Ht){qe.after=Ht},pre:function(Ht){qe.pre=Ht},post:function(Ht){qe.post=Ht},stop:function(){Zt=!1},block:function(){wt=!1}};if(!Zt)return pt;function Jt(){if(typeof pt.node=="object"&&pt.node!==null){pt.keys&&pt.node_===pt.node||(pt.keys=J(pt.node)),pt.isLeaf=pt.keys.length==0;for(var Ht=0;Ht<it.length;Ht++)if(it[Ht].node_===Nt){pt.circular=it[Ht];break}}else pt.isLeaf=!0,pt.keys=null;pt.notLeaf=!pt.isLeaf,pt.notRoot=!pt.isRoot}Jt();var en=De.call(pt,pt.node);return en!==void 0&&pt.update&&pt.update(en),qe.before&&qe.before.call(pt,pt.node),wt&&(typeof pt.node!="object"||pt.node===null||pt.circular||(it.push(pt),Jt(),ce(pt.keys,function(Ht,_n){Xe.push(Ht),qe.pre&&qe.pre.call(pt,pt.node[Ht],Ht);var gn=Wt(pt.node[Ht]);Ge&&Se.call(pt.node,Ht)&&(pt.node[Ht]=gn.node),gn.isLast=_n==pt.keys.length-1,gn.isFirst=_n==0,qe.post&&qe.post.call(pt,gn),Xe.pop()}),it.pop()),qe.after&&qe.after.call(pt,pt.node)),pt}(_e).node}function Z(_e){if(typeof _e=="object"&&_e!==null){var De;if(fe(_e))De=[];else if(ne(_e)==="[object Date]")De=new Date(_e.getTime?_e.getTime():_e);else if(function(it){return ne(it)==="[object RegExp]"}(_e))De=new RegExp(_e);else if(function(it){return ne(it)==="[object Error]"}(_e))De={message:_e.message};else if(function(it){return ne(it)==="[object Boolean]"}(_e))De=new Boolean(_e);else if(function(it){return ne(it)==="[object Number]"}(_e))De=new Number(_e);else if(function(it){return ne(it)==="[object String]"}(_e))De=new String(_e);else if(Object.create&&Object.getPrototypeOf)De=Object.create(Object.getPrototypeOf(_e));else if(_e.constructor===Object)De={};else{var Ge=_e.constructor&&_e.constructor.prototype||_e.__proto__||{},Xe=function(){};Xe.prototype=Ge,De=new Xe}return ce(J(_e),function(it){De[it]=_e[it]}),De}return _e}k.prototype.get=function(_e){for(var De=this.value,Ge=0;Ge<_e.length;Ge++){var Xe=_e[Ge];if(!De||!Se.call(De,Xe)){De=void 0;break}De=De[Xe]}return De},k.prototype.has=function(_e){for(var De=this.value,Ge=0;Ge<_e.length;Ge++){var Xe=_e[Ge];if(!De||!Se.call(De,Xe))return!1;De=De[Xe]}return!0},k.prototype.set=function(_e,De){for(var Ge=this.value,Xe=0;Xe<_e.length-1;Xe++){var it=_e[Xe];Se.call(Ge,it)||(Ge[it]={}),Ge=Ge[it]}return Ge[_e[Xe]]=De,De},k.prototype.map=function(_e){return G(this.value,_e,!0)},k.prototype.forEach=function(_e){return this.value=G(this.value,_e,!1),this.value},k.prototype.reduce=function(_e,De){var Ge=arguments.length===1,Xe=Ge?this.value:De;return this.forEach(function(it){this.isRoot&&Ge||(Xe=_e.call(this,Xe,it))}),Xe},k.prototype.paths=function(){var _e=[];return this.forEach(function(De){_e.push(this.path)}),_e},k.prototype.nodes=function(){var _e=[];return this.forEach(function(De){_e.push(this.node)}),_e},k.prototype.clone=function(){var _e=[],De=[];return function Ge(Xe){for(var it=0;it<_e.length;it++)if(_e[it]===Xe)return De[it];if(typeof Xe=="object"&&Xe!==null){var Zt=Z(Xe);return _e.push(Xe),De.push(Zt),ce(J(Xe),function(Wt){Zt[Wt]=Ge(Xe[Wt])}),_e.pop(),De.pop(),Zt}return Xe}(this.value)};var J=Object.keys||function(_e){var De=[];for(var Ge in _e)De.push(Ge);return De};function ne(_e){return Object.prototype.toString.call(_e)}var fe=Array.isArray||function(_e){return Object.prototype.toString.call(_e)==="[object Array]"},ce=function(_e,De){if(_e.forEach)return _e.forEach(De);for(var Ge=0;Ge<_e.length;Ge++)De(_e[Ge],Ge,_e)};ce(J(k.prototype),function(_e){E[_e]=function(De){var Ge=[].slice.call(arguments,1),Xe=new k(De);return Xe[_e].apply(Xe,Ge)}});var Se=Object.hasOwnProperty||function(_e,De){return De in _e}}),Mi=Wr;function Wr(f){if(!(this instanceof Wr))return new Wr(f);this._bbox=f||[1/0,1/0,-1/0,-1/0],this._valid=!!f}Wr.prototype.include=function(f){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],f[0]),this._bbox[1]=Math.min(this._bbox[1],f[1]),this._bbox[2]=Math.max(this._bbox[2],f[0]),this._bbox[3]=Math.max(this._bbox[3],f[1]),this},Wr.prototype.equals=function(f){var E;return E=f instanceof Wr?f.bbox():f,this._bbox[0]==E[0]&&this._bbox[1]==E[1]&&this._bbox[2]==E[2]&&this._bbox[3]==E[3]},Wr.prototype.center=function(f){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Wr.prototype.union=function(f){var E;return this._valid=!0,E=f instanceof Wr?f.bbox():f,this._bbox[0]=Math.min(this._bbox[0],E[0]),this._bbox[1]=Math.min(this._bbox[1],E[1]),this._bbox[2]=Math.max(this._bbox[2],E[2]),this._bbox[3]=Math.max(this._bbox[3],E[3]),this},Wr.prototype.bbox=function(){return this._valid?this._bbox:null},Wr.prototype.contains=function(f){if(!f)return this._fastContains();if(!this._valid)return null;var E=f[0],k=f[1];return this._bbox[0]<=E&&this._bbox[1]<=k&&this._bbox[2]>=E&&this._bbox[3]>=k},Wr.prototype.intersect=function(f){return this._valid?(E=f instanceof Wr?f.bbox():f,!(this._bbox[0]>E[2]||this._bbox[2]<E[0]||this._bbox[3]<E[1]||this._bbox[1]>E[3])):null;var E},Wr.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var f="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",f)},Wr.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var $n={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Uo=Object.keys($n),rs=function(f){return Hr(f).bbox()};function Hr(f){for(var E=Mi(),k=po(f),G=0;G<k.length;G++)E.include(k[G]);return E}rs.polygon=function(f){return Hr(f).polygon()},rs.bboxify=function(f){return ns(f).map(function(E){E&&Uo.some(function(k){return!!E[k]&&$n[k].indexOf(E.type)!==-1})&&(E.bbox=Hr(E).bbox(),this.update(E))})};function ai(f,E){var k=-90,G=90,Z=-90,J=90,ne=270,fe=-270;f.forEach(function(Se){var _e=rs(Se),De=_e[1],Ge=_e[3],Xe=_e[0],it=_e[2];De>k&&(k=De),Ge<G&&(G=Ge),Ge>Z&&(Z=Ge),De<J&&(J=De),Xe<ne&&(ne=Xe),it>fe&&(fe=it)});var ce=E;return k+ce.lat>85&&(ce.lat=85-k),Z+ce.lat>90&&(ce.lat=90-Z),G+ce.lat<-85&&(ce.lat=-85-G),J+ce.lat<-90&&(ce.lat=-90-J),ne+ce.lng<=-270&&(ce.lng+=360*Math.ceil(Math.abs(ce.lng)/360)),fe+ce.lng>=270&&(ce.lng-=360*Math.ceil(Math.abs(ce.lng)/360)),ce}function Ms(f,E){var k=ai(f.map(function(Z){return Z.toGeoJSON()}),E),G=zn([k.lng,k.lat]);f.forEach(function(Z){var J,ne=Z.getCoordinates(),fe=function(Se){var _e=zn(Se);return ts([_e[0]+G[0],_e[1]+G[1]])},ce=function(Se){return Se.map(function(_e){return fe(_e)})};Z.type===cn?J=fe(ne):Z.type===mn||Z.type===rn?J=ne.map(fe):Z.type===nn||Z.type===wn?J=ne.map(ce):Z.type===An&&(J=ne.map(function(Se){return Se.map(function(_e){return ce(_e)})})),Z.incomingCoords(J)})}var _r={onSetup:function(f){var E=this,k={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:f.featureIds||[]};return this.setSelected(k.initiallySelectedFeatureIds.filter(function(G){return E.getFeature(G)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),k},fireUpdate:function(){this.map.fire(kn,{action:Hi,features:this.getSelected().map(function(f){return f.toGeoJSON()})})},fireActionable:function(){var f=this,E=this.getSelected(),k=E.filter(function(fe){return f.isInstanceOf("MultiFeature",fe)}),G=!1;if(E.length>1){G=!0;var Z=E[0].type.replace("Multi","");E.forEach(function(fe){fe.type.replace("Multi","")!==Z&&(G=!1)})}var J=k.length>0,ne=E.length>0;this.setActionableState({combineFeatures:G,uncombineFeatures:J,trash:ne})},getUniqueIds:function(f){return f.length?f.map(function(E){return E.properties.id}).filter(function(E){return E!==void 0}).reduce(function(E,k){return E.add(k),E},new Vr).values():[]},stopExtendedInteractions:function(f){f.boxSelectElement&&(f.boxSelectElement.parentNode&&f.boxSelectElement.parentNode.removeChild(f.boxSelectElement),f.boxSelectElement=null),this.map.dragPan.enable(),f.boxSelecting=!1,f.canBoxSelect=!1,f.dragMoving=!1,f.canDragMove=!1},onStop:function(){Si(this)},onMouseMove:function(f){return this.stopExtendedInteractions(f),!0},onMouseOut:function(f){return!f.dragMoving||this.fireUpdate()}};_r.onTap=_r.onClick=function(f,E){return jn(E)?this.clickAnywhere(f,E):Zn(pi)(E)?this.clickOnVertex(f,E):function(k){return!!k.featureTarget&&!!k.featureTarget.properties&&k.featureTarget.properties.meta===Mr}(E)?this.clickOnFeature(f,E):void 0},_r.clickAnywhere=function(f){var E=this,k=this.getSelectedIds();k.length&&(this.clearSelectedFeatures(),k.forEach(function(G){return E.doRender(G)})),Si(this),this.stopExtendedInteractions(f)},_r.clickOnVertex=function(f,E){this.changeMode(dn.DIRECT_SELECT,{featureId:E.featureTarget.properties.parent,coordPath:E.featureTarget.properties.coord_path,startPos:E.lngLat}),this.updateUIClasses({mouse:Je})},_r.startOnActiveFeature=function(f,E){this.stopExtendedInteractions(f),this.map.dragPan.disable(),this.doRender(E.featureTarget.properties.id),f.canDragMove=!0,f.dragMoveLocation=E.lngLat},_r.clickOnFeature=function(f,E){var k=this;wr(this),this.stopExtendedInteractions(f);var G=bi(E),Z=this.getSelectedIds(),J=E.featureTarget.properties.id,ne=this.isSelected(J);if(!G&&ne&&this.getFeature(J).type!==cn)return this.changeMode(dn.DIRECT_SELECT,{featureId:J});ne&&G?(this.deselect(J),this.updateUIClasses({mouse:vt}),Z.length===1&&Si(this)):!ne&&G?(this.select(J),this.updateUIClasses({mouse:Je})):ne||G||(Z.forEach(function(fe){return k.doRender(fe)}),this.setSelected(J),this.updateUIClasses({mouse:Je})),this.doRender(J)},_r.onMouseDown=function(f,E){return Bn(E)?this.startOnActiveFeature(f,E):this.drawConfig.boxSelect&&function(k){return!!k.originalEvent&&!!k.originalEvent.shiftKey&&k.originalEvent.button===0}(E)?this.startBoxSelect(f,E):void 0},_r.startBoxSelect=function(f,E){this.stopExtendedInteractions(f),this.map.dragPan.disable(),f.boxSelectStartLocation=yr(E.originalEvent,this.map.getContainer()),f.canBoxSelect=!0},_r.onTouchStart=function(f,E){if(Bn(E))return this.startOnActiveFeature(f,E)},_r.onDrag=function(f,E){return f.canDragMove?this.dragMove(f,E):this.drawConfig.boxSelect&&f.canBoxSelect?this.whileBoxSelect(f,E):void 0},_r.whileBoxSelect=function(f,E){f.boxSelecting=!0,this.updateUIClasses({mouse:Pe}),f.boxSelectElement||(f.boxSelectElement=document.createElement("div"),f.boxSelectElement.classList.add(pe),this.map.getContainer().appendChild(f.boxSelectElement));var k=yr(E.originalEvent,this.map.getContainer()),G=Math.min(f.boxSelectStartLocation.x,k.x),Z=Math.max(f.boxSelectStartLocation.x,k.x),J=Math.min(f.boxSelectStartLocation.y,k.y),ne=Math.max(f.boxSelectStartLocation.y,k.y),fe="translate("+G+"px, "+J+"px)";f.boxSelectElement.style.transform=fe,f.boxSelectElement.style.WebkitTransform=fe,f.boxSelectElement.style.width=Z-G+"px",f.boxSelectElement.style.height=ne-J+"px"},_r.dragMove=function(f,E){f.dragMoving=!0,E.originalEvent.stopPropagation();var k={lng:E.lngLat.lng-f.dragMoveLocation.lng,lat:E.lngLat.lat-f.dragMoveLocation.lat};Ms(this.getSelected(),k),f.dragMoveLocation=E.lngLat},_r.onTouchEnd=_r.onMouseUp=function(f,E){var k=this;if(f.dragMoving)this.fireUpdate();else if(f.boxSelecting){var G=[f.boxSelectStartLocation,yr(E.originalEvent,this.map.getContainer())],Z=this.featuresAt(null,G,"click"),J=this.getUniqueIds(Z).filter(function(ne){return!k.isSelected(ne)});J.length&&(this.select(J),J.forEach(function(ne){return k.doRender(ne)}),this.updateUIClasses({mouse:Je}))}this.stopExtendedInteractions(f)},_r.toDisplayFeatures=function(f,E,k){E.properties.active=this.isSelected(E.properties.id)?In:tr,k(E),this.fireActionable(),E.properties.active===In&&E.geometry.type!==cn&&Yi(E).forEach(k)},_r.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},_r.onCombineFeatures=function(){var f=this.getSelected();if(!(f.length===0||f.length<2)){for(var E=[],k=[],G=f[0].type.replace("Multi",""),Z=0;Z<f.length;Z++){var J=f[Z];if(J.type.replace("Multi","")!==G)return;J.type.includes("Multi")?J.getCoordinates().forEach(function(fe){E.push(fe)}):E.push(J.getCoordinates()),k.push(J.toGeoJSON())}if(k.length>1){var ne=this.newFeature({type:Pt,properties:k[0].properties,geometry:{type:"Multi"+G,coordinates:E}});this.addFeature(ne),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([ne.id]),this.map.fire(Dr,{createdFeatures:[ne.toGeoJSON()],deletedFeatures:k})}this.fireActionable()}},_r.onUncombineFeatures=function(){var f=this,E=this.getSelected();if(E.length!==0){for(var k=[],G=[],Z=function(ne){var fe=E[ne];f.isInstanceOf("MultiFeature",fe)&&(fe.getFeatures().forEach(function(ce){f.addFeature(ce),ce.properties=fe.properties,k.push(ce.toGeoJSON()),f.select([ce.id])}),f.deleteFeature(fe.id,{silent:!0}),G.push(fe.toGeoJSON()))},J=0;J<E.length;J++)Z(J);k.length>1&&this.map.fire(Eo,{createdFeatures:k,deletedFeatures:G}),this.fireActionable()}};var vr=Zn(pi),Es=Zn(si),qr={fireUpdate:function(){this.map.fire(kn,{action:Oi,features:this.getSelected().map(function(f){return f.toGeoJSON()})})},fireActionable:function(f){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:f.selectedCoordPaths.length>0})},startDragging:function(f,E){this.map.dragPan.disable(),f.canDragMove=!0,f.dragMoveLocation=E.lngLat},stopDragging:function(f){this.map.dragPan.enable(),f.dragMoving=!1,f.canDragMove=!1,f.dragMoveLocation=null},onVertex:function(f,E){this.startDragging(f,E);var k=E.featureTarget.properties,G=f.selectedCoordPaths.indexOf(k.coord_path);bi(E)||G!==-1?bi(E)&&G===-1&&f.selectedCoordPaths.push(k.coord_path):f.selectedCoordPaths=[k.coord_path];var Z=this.pathsToCoordinates(f.featureId,f.selectedCoordPaths);this.setSelectedCoordinates(Z)},onMidpoint:function(f,E){this.startDragging(f,E);var k=E.featureTarget.properties;f.feature.addCoordinate(k.coord_path,k.lng,k.lat),this.fireUpdate(),f.selectedCoordPaths=[k.coord_path]},pathsToCoordinates:function(f,E){return E.map(function(k){return{feature_id:f,coord_path:k}})},onFeature:function(f,E){f.selectedCoordPaths.length===0?this.startDragging(f,E):this.stopDragging(f)},dragFeature:function(f,E,k){Ms(this.getSelected(),k),f.dragMoveLocation=E.lngLat},dragVertex:function(f,E,k){for(var G=f.selectedCoordPaths.map(function(fe){return f.feature.getCoordinate(fe)}),Z=ai(G.map(function(fe){return{type:Pt,properties:{},geometry:{type:cn,coordinates:fe}}}),k),J=0;J<G.length;J++){var ne=G[J];f.feature.updateCoordinate(f.selectedCoordPaths[J],ne[0]+Z.lng,ne[1]+Z.lat)}},clickNoTarget:function(){this.changeMode(dn.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(dn.SIMPLE_SELECT)},clickActiveFeature:function(f){f.selectedCoordPaths=[],this.clearSelectedCoordinates(),f.feature.changed()},onSetup:function(f){var E=f.featureId,k=this.getFeature(E);if(!k)throw new Error("You must provide a featureId to enter direct_select mode");if(k.type===cn)throw new TypeError("direct_select mode doesn't handle point features");var G={featureId:E,feature:k,dragMoveLocation:f.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:f.coordPath?[f.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(E,G.selectedCoordPaths)),this.setSelected(E),wr(this),this.setActionableState({trash:!0}),G},onStop:function(){Si(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(f,E,k){f.featureId===E.properties.id?(E.properties.active=In,k(E),Yi(E,{map:this.map,midpoints:!0,selectedPaths:f.selectedCoordPaths}).forEach(k)):(E.properties.active=tr,k(E)),this.fireActionable(f)},onTrash:function(f){f.selectedCoordPaths.sort(function(E,k){return k.localeCompare(E,"en",{numeric:!0})}).forEach(function(E){return f.feature.removeCoordinate(E)}),this.fireUpdate(),f.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(f),f.feature.isValid()===!1&&(this.deleteFeature([f.featureId]),this.changeMode(dn.SIMPLE_SELECT,{}))},onMouseMove:function(f,E){var k=Bn(E),G=vr(E),Z=f.selectedCoordPaths.length===0;return k&&Z||G&&!Z?this.updateUIClasses({mouse:Je}):this.updateUIClasses({mouse:ct}),this.stopDragging(f),!0},onMouseOut:function(f){return f.dragMoving&&this.fireUpdate(),!0}};qr.onTouchStart=qr.onMouseDown=function(f,E){return vr(E)?this.onVertex(f,E):Bn(E)?this.onFeature(f,E):Es(E)?this.onMidpoint(f,E):void 0},qr.onDrag=function(f,E){if(f.canDragMove===!0){f.dragMoving=!0,E.originalEvent.stopPropagation();var k={lng:E.lngLat.lng-f.dragMoveLocation.lng,lat:E.lngLat.lat-f.dragMoveLocation.lat};f.selectedCoordPaths.length>0?this.dragVertex(f,E,k):this.dragFeature(f,E,k),f.dragMoveLocation=E.lngLat}},qr.onClick=function(f,E){return jn(E)?this.clickNoTarget(f,E):Bn(E)?this.clickActiveFeature(f,E):bn(E)?this.clickInactive(f,E):void this.stopDragging(f)},qr.onTap=function(f,E){return jn(E)?this.clickNoTarget(f,E):Bn(E)?this.clickActiveFeature(f,E):bn(E)?this.clickInactive(f,E):void 0},qr.onTouchEnd=qr.onMouseUp=function(f){f.dragMoving&&this.fireUpdate(),this.stopDragging(f)};var nr={};function Is(f,E){return!!f.lngLat&&f.lngLat.lng===E[0]&&f.lngLat.lat===E[1]}nr.onSetup=function(){var f=this.newFeature({type:Pt,properties:{},geometry:{type:cn,coordinates:[]}});return this.addFeature(f),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Pe}),this.activateUIButton(Rt.POINT),this.setActionableState({trash:!0}),this.map&&this.map.setIsInteracting(!0),{point:f,options:this._ctx.options}},nr.stopDrawingAndRemove=function(f){this.deleteFeature([f.point.id],{silent:!0}),this.changeMode(dn.SIMPLE_SELECT)},nr.onTap=nr.onClick=function(f,E){this.updateUIClasses({mouse:Je}),f.point.updateCoordinate("",E.lngLat.lng,E.lngLat.lat),this.map.fire(Lr,{features:[f.point.toGeoJSON()],styleId:f.options.styleId}),this.changeMode(dn.SIMPLE_SELECT,{featureIds:[f.point.id]})},nr.onStop=function(f){this.activateUIButton(),f.point.getCoordinate().length||this.deleteFeature([f.point.id],{silent:!0}),this.map&&this.map.setIsInteracting(!1)},nr.toDisplayFeatures=function(f,E,k){var G=E.properties.id===f.point.id;if(E.properties.active=G?In:tr,!G)return k(E)},nr.onTrash=nr.stopDrawingAndRemove,nr.onKeyUp=function(f,E){if(zr(E)||$t(E))return this.stopDrawingAndRemove(f,E)};var xr={onSetup:function(){var f=this.newFeature({type:Pt,properties:{},geometry:{type:nn,coordinates:[[]]}});return this.addFeature(f),this.clearSelectedFeatures(),wr(this),this.updateUIClasses({mouse:Pe}),this.activateUIButton(Rt.POLYGON),this.setActionableState({trash:!0}),this.map&&this.map.setIsInteracting(!0),{polygon:f,currentVertexPosition:0,options:this._ctx.options}},clickAnywhere:function(f,E){if(f.currentVertexPosition>0&&Is(E,f.polygon.coordinates[0][f.currentVertexPosition-1]))return this.changeMode(dn.SIMPLE_SELECT,{featureIds:[f.polygon.id]});this.updateUIClasses({mouse:Pe}),f.polygon.updateCoordinate("0."+f.currentVertexPosition,E.lngLat.lng,E.lngLat.lat),f.currentVertexPosition++,f.polygon.updateCoordinate("0."+f.currentVertexPosition,E.lngLat.lng,E.lngLat.lat)},clickOnVertex:function(f){return this.changeMode(dn.SIMPLE_SELECT,{featureIds:[f.polygon.id]})},onMouseMove:function(f,E){f.polygon.updateCoordinate("0."+f.currentVertexPosition,E.lngLat.lng,E.lngLat.lat),Pr(E)&&this.updateUIClasses({mouse:vt}),this.map.fire(Dn,{lnglat:[E.lngLat.lng,E.lngLat.lat],feature:f.polygon,event:E,state:f,styleId:f.options.styleId})}};xr.onTap=xr.onClick=function(f,E){return Pr(E)?this.clickOnVertex(f,E):this.clickAnywhere(f,E)},xr.onKeyUp=function(f,E){zr(E)?(this.deleteFeature([f.polygon.id],{silent:!0}),this.changeMode(dn.SIMPLE_SELECT)):$t(E)&&this.changeMode(dn.SIMPLE_SELECT,{featureIds:[f.polygon.id]})},xr.onStop=function(f){this.updateUIClasses({mouse:ct}),Si(this),this.activateUIButton(),this.getFeature(f.polygon.id)!==void 0&&(f.polygon.removeCoordinate("0."+f.currentVertexPosition),f.polygon.isValid()?this.map.fire(Lr,{features:[f.polygon.toGeoJSON()],styleId:f.options.styleId}):(this.deleteFeature([f.polygon.id],{silent:!0}),this.changeMode(dn.SIMPLE_SELECT,{},{silent:!0})),this.map&&this.map.setIsInteracting(!1))},xr.toDisplayFeatures=function(f,E,k){var G=E.properties.id===f.polygon.id;if(E.properties.active=G?In:tr,!G)return k(E);if(E.geometry.coordinates.length!==0){var Z=E.geometry.coordinates[0].length;if(!(Z<3)){if(E.properties.meta=Mr,k(wi(f.polygon.id,E.geometry.coordinates[0][0],"0.0",!1)),Z>3){var J=E.geometry.coordinates[0].length-3;k(wi(f.polygon.id,E.geometry.coordinates[0][J],"0."+J,!1))}if(Z<=4){var ne=[[E.geometry.coordinates[0][0][0],E.geometry.coordinates[0][0][1]],[E.geometry.coordinates[0][1][0],E.geometry.coordinates[0][1][1]]];if(k({type:Pt,properties:E.properties,geometry:{coordinates:ne,type:mn}}),Z===3)return}return k(E)}}},xr.onTrash=function(f){this.deleteFeature([f.polygon.id],{silent:!0}),this.changeMode(dn.SIMPLE_SELECT)};var li={onSetup:function(f){var E,k,G=(f=f||{}).featureId,Z="forward";if(G){if(!(E=this.getFeature(G)))throw new Error("Could not find a feature with the provided featureId");var J=f.from;if(J&&J.type==="Feature"&&J.geometry&&J.geometry.type==="Point"&&(J=J.geometry),J&&J.type==="Point"&&J.coordinates&&J.coordinates.length===2&&(J=J.coordinates),!J||!Array.isArray(J))throw new Error("Please use the `from` property to indicate which point to continue the line from");var ne=E.coordinates.length-1;if(E.coordinates[ne][0]===J[0]&&E.coordinates[ne][1]===J[1])k=ne+1,E.addCoordinate.apply(E,[k].concat(E.coordinates[ne]));else{if(E.coordinates[0][0]!==J[0]||E.coordinates[0][1]!==J[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");Z="backwards",k=0,E.addCoordinate.apply(E,[k].concat(E.coordinates[0]))}}else E=this.newFeature({type:Pt,properties:{},geometry:{type:mn,coordinates:[]}}),k=0,this.addFeature(E);return this.clearSelectedFeatures(),wr(this),this.updateUIClasses({mouse:Pe}),this.activateUIButton(Rt.LINE),this.setActionableState({trash:!0}),this.map&&this.map.setIsInteracting(!0),{line:E,currentVertexPosition:k,direction:Z,options:this._ctx.options}},clickAnywhere:function(f,E){if(f.currentVertexPosition>0&&Is(E,f.line.coordinates[f.currentVertexPosition-1])||f.direction==="backwards"&&Is(E,f.line.coordinates[f.currentVertexPosition+1]))return this.changeMode(dn.SIMPLE_SELECT,{featureIds:[f.line.id]});this.updateUIClasses({mouse:Pe}),f.line.updateCoordinate(f.currentVertexPosition,E.lngLat.lng,E.lngLat.lat),f.direction==="forward"?(f.currentVertexPosition++,f.line.updateCoordinate(f.currentVertexPosition,E.lngLat.lng,E.lngLat.lat)):f.line.addCoordinate(0,E.lngLat.lng,E.lngLat.lat)},clickOnVertex:function(f){return this.changeMode(dn.SIMPLE_SELECT,{featureIds:[f.line.id]})},onMouseMove:function(f,E){f.line.updateCoordinate(f.currentVertexPosition,E.lngLat.lng,E.lngLat.lat),Pr(E)&&this.updateUIClasses({mouse:vt}),this.map.fire(Dn,{lnglat:[E.lngLat.lng,E.lngLat.lat],feature:f.line,event:E,state:f,styleId:f.options.styleId})}};li.onTap=li.onClick=function(f,E){if(Pr(E))return this.clickOnVertex(f,E);this.clickAnywhere(f,E)},li.onKeyUp=function(f,E){$t(E)?this.changeMode(dn.SIMPLE_SELECT,{featureIds:[f.line.id]}):zr(E)&&(this.deleteFeature([f.line.id],{silent:!0}),this.changeMode(dn.SIMPLE_SELECT))},li.onStop=function(f){Si(this),this.activateUIButton(),this.getFeature(f.line.id)!==void 0&&(f.line.removeCoordinate(""+f.currentVertexPosition),f.line.isValid()?this.map.fire(Lr,{features:[f.line.toGeoJSON()],styleId:f.options.styleId}):(this.deleteFeature([f.line.id],{silent:!0}),this.changeMode(dn.SIMPLE_SELECT,{},{silent:!0})),this.map&&this.map.setIsInteracting(!1))},li.onTrash=function(f){this.deleteFeature([f.line.id],{silent:!0}),this.changeMode(dn.SIMPLE_SELECT)},li.toDisplayFeatures=function(f,E,k){var G=E.properties.id===f.line.id;if(E.properties.active=G?In:tr,!G)return k(E);E.geometry.coordinates.length<2||(E.properties.meta=Mr,k(wi(f.line.id,E.geometry.coordinates[f.direction==="forward"?E.geometry.coordinates.length-2:1],""+(f.direction==="forward"?E.geometry.coordinates.length-2:1),!1)),k(E))};var Ri={simple_select:_r,direct_select:qr,draw_point:nr,draw_polygon:xr,draw_line_string:li},Sl={defaultMode:dn.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:ft,modes:Ri,controls:{},userProperties:!1},Po={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Ya={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function is(f,E,k){return k===void 0&&(k={}),f.map(function(G){return G.source?G:Ie(G,{id:G.id+"."+E+k.styleId,source:E==="hot"?de+k.styleId:Ee+k.styleId})})}var Ei=we(function(f,E){var k="[object Arguments]",G="[object Map]",Z="[object Object]",J="[object Set]",ne=/^\[object .+?Constructor\]$/,fe=/^(?:0|[1-9]\d*)$/,ce={};ce["[object Float32Array]"]=ce["[object Float64Array]"]=ce["[object Int8Array]"]=ce["[object Int16Array]"]=ce["[object Int32Array]"]=ce["[object Uint8Array]"]=ce["[object Uint8ClampedArray]"]=ce["[object Uint16Array]"]=ce["[object Uint32Array]"]=!0,ce[k]=ce["[object Array]"]=ce["[object ArrayBuffer]"]=ce["[object Boolean]"]=ce["[object DataView]"]=ce["[object Date]"]=ce["[object Error]"]=ce["[object Function]"]=ce[G]=ce["[object Number]"]=ce[Z]=ce["[object RegExp]"]=ce[J]=ce["[object String]"]=ce["[object WeakMap]"]=!1;var Se=typeof O=="object"&&O&&O.Object===Object&&O,_e=typeof self=="object"&&self&&self.Object===Object&&self,De=Se||_e||Function("return this")(),Ge=E&&!E.nodeType&&E,Xe=Ge&&f&&!f.nodeType&&f,it=Xe&&Xe.exports===Ge,Zt=it&&Se.process,Wt=function(){try{return Zt&&Zt.binding&&Zt.binding("util")}catch{}}(),Nt=Wt&&Wt.isTypedArray;function Te(Be,nt){for(var zt=-1,Yt=Be==null?0:Be.length;++zt<Yt;)if(nt(Be[zt],zt,Be))return!0;return!1}function qe(Be){var nt=-1,zt=Array(Be.size);return Be.forEach(function(Yt,yn){zt[++nt]=[yn,Yt]}),zt}function wt(Be){var nt=-1,zt=Array(Be.size);return Be.forEach(function(Yt){zt[++nt]=Yt}),zt}var pt,Jt,en,Ht=Array.prototype,_n=Function.prototype,gn=Object.prototype,Un=De["__core-js_shared__"],Kn=_n.toString,Tn=gn.hasOwnProperty,fr=(pt=/[^.]+$/.exec(Un&&Un.keys&&Un.keys.IE_PROTO||""))?"Symbol(src)_1."+pt:"",ni=gn.toString,Li=RegExp("^"+Kn.call(Tn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ci=it?De.Buffer:void 0,Cr=De.Symbol,Di=De.Uint8Array,mr=gn.propertyIsEnumerable,Vs=Ht.splice,Tr=Cr?Cr.toStringTag:void 0,rt=Object.getOwnPropertySymbols,ie=ci?ci.isBuffer:void 0,ge=(Jt=Object.keys,en=Object,function(Be){return Jt(en(Be))}),Re=Me(De,"DataView"),$e=Me(De,"Map"),tt=Me(De,"Promise"),Ut=Me(De,"Set"),Et=Me(De,"WeakMap"),Ct=Me(Object,"create"),tn=We(Re),ln=We($e),hn=We(tt),vn=We(Ut),d=We(Et),t=Cr?Cr.prototype:void 0,s=t?t.valueOf:void 0;function p(Be){var nt=-1,zt=Be==null?0:Be.length;for(this.clear();++nt<zt;){var Yt=Be[nt];this.set(Yt[0],Yt[1])}}function x(Be){var nt=-1,zt=Be==null?0:Be.length;for(this.clear();++nt<zt;){var Yt=Be[nt];this.set(Yt[0],Yt[1])}}function S(Be){var nt=-1,zt=Be==null?0:Be.length;for(this.clear();++nt<zt;){var Yt=Be[nt];this.set(Yt[0],Yt[1])}}function z(Be){var nt=-1,zt=Be==null?0:Be.length;for(this.__data__=new S;++nt<zt;)this.add(Be[nt])}function B(Be){var nt=this.__data__=new x(Be);this.size=nt.size}function V(Be,nt){var zt=It(Be),Yt=!zt&&ut(Be),yn=!zt&&!Yt&&ze(Be),fn=!zt&&!Yt&&!yn&&an(Be),Cn=zt||Yt||yn||fn,rr=Cn?function(or,Or){for(var Hn=-1,Jn=Array(or);++Hn<or;)Jn[Hn]=Or(Hn);return Jn}(Be.length,String):[],br=rr.length;for(var Yn in Be)!nt&&!Tn.call(Be,Yn)||Cn&&(Yn=="length"||yn&&(Yn=="offset"||Yn=="parent")||fn&&(Yn=="buffer"||Yn=="byteLength"||Yn=="byteOffset")||He(Yn,br))||rr.push(Yn);return rr}function $(Be,nt){for(var zt=Be.length;zt--;)if(lt(Be[zt][0],nt))return zt;return-1}function H(Be){return Be==null?Be===void 0?"[object Undefined]":"[object Null]":Tr&&Tr in Object(Be)?function(nt){var zt=Tn.call(nt,Tr),Yt=nt[Tr];try{nt[Tr]=void 0;var yn=!0}catch{}var fn=ni.call(nt);return yn&&(zt?nt[Tr]=Yt:delete nt[Tr]),fn}(Be):function(nt){return ni.call(nt)}(Be)}function re(Be){return on(Be)&&H(Be)==k}function se(Be,nt,zt,Yt,yn){return Be===nt||(Be==null||nt==null||!on(Be)&&!on(nt)?Be!=Be&&nt!=nt:function(fn,Cn,rr,br,Yn,or){var Or=It(fn),Hn=It(Cn),Jn=Or?"[object Array]":Ne(fn),Fn=Hn?"[object Array]":Ne(Cn),dr=(Jn=Jn==k?Z:Jn)==Z,Fr=(Fn=Fn==k?Z:Fn)==Z,ir=Jn==Fn;if(ir&&ze(fn)){if(!ze(Cn))return!1;Or=!0,dr=!1}if(ir&&!dr)return or||(or=new B),Or||an(fn)?ue(fn,Cn,rr,br,Yn,or):function(ar,Qn,xo,bo,Ho,ui,Xo){switch(xo){case"[object DataView]":if(ar.byteLength!=Qn.byteLength||ar.byteOffset!=Qn.byteOffset)return!1;ar=ar.buffer,Qn=Qn.buffer;case"[object ArrayBuffer]":return!(ar.byteLength!=Qn.byteLength||!ui(new Di(ar),new Di(Qn)));case"[object Boolean]":case"[object Date]":case"[object Number]":return lt(+ar,+Qn);case"[object Error]":return ar.name==Qn.name&&ar.message==Qn.message;case"[object RegExp]":case"[object String]":return ar==Qn+"";case G:var Jo=qe;case J:var Va=1&bo;if(Jo||(Jo=wt),ar.size!=Qn.size&&!Va)return!1;var bs=Xo.get(ar);if(bs)return bs==Qn;bo|=2,Xo.set(ar,Qn);var va=ue(Jo(ar),Jo(Qn),bo,Ho,ui,Xo);return Xo.delete(ar),va;case"[object Symbol]":if(s)return s.call(ar)==s.call(Qn)}return!1}(fn,Cn,Jn,rr,br,Yn,or);if(!(1&rr)){var Jr=dr&&Tn.call(fn,"__wrapped__"),xs=Fr&&Tn.call(Cn,"__wrapped__");if(Jr||xs){var _i=Jr?fn.value():fn,Oo=xs?Cn.value():Cn;return or||(or=new B),Yn(_i,Oo,rr,br,or)}}return ir?(or||(or=new B),function(ar,Qn,xo,bo,Ho,ui){var Xo=1&xo,Jo=Le(ar),Va=Jo.length,bs=Le(Qn).length;if(Va!=bs&&!Xo)return!1;for(var va=Va;va--;){var wo=Jo[va];if(!(Xo?wo in Qn:Tn.call(Qn,wo)))return!1}var Pl=ui.get(ar);if(Pl&&ui.get(Qn))return Pl==Qn;var qs=!0;ui.set(ar,Qn),ui.set(Qn,ar);for(var Fo=Xo;++va<Va;){wo=Jo[va];var Zs=ar[wo],qa=Qn[wo];if(bo)var Cl=Xo?bo(qa,Zs,wo,Qn,ar,ui):bo(Zs,qa,wo,ar,Qn,ui);if(!(Cl===void 0?Zs===qa||Ho(Zs,qa,xo,bo,ui):Cl)){qs=!1;break}Fo||(Fo=wo=="constructor")}if(qs&&!Fo){var al=ar.constructor,ll=Qn.constructor;al==ll||!("constructor"in ar)||!("constructor"in Qn)||typeof al=="function"&&al instanceof al&&typeof ll=="function"&&ll instanceof ll||(qs=!1)}return ui.delete(ar),ui.delete(Qn),qs}(fn,Cn,rr,br,Yn,or)):!1}(Be,nt,zt,Yt,se,yn))}function me(Be){return!(!pn(Be)||function(nt){return!!fr&&fr in nt}(Be))&&(Gt(Be)?Li:ne).test(We(Be))}function ae(Be){if(zt=(nt=Be)&&nt.constructor,Yt=typeof zt=="function"&&zt.prototype||gn,nt!==Yt)return ge(Be);var nt,zt,Yt,yn=[];for(var fn in Object(Be))Tn.call(Be,fn)&&fn!="constructor"&&yn.push(fn);return yn}function ue(Be,nt,zt,Yt,yn,fn){var Cn=1&zt,rr=Be.length,br=nt.length;if(rr!=br&&!(Cn&&br>rr))return!1;var Yn=fn.get(Be);if(Yn&&fn.get(nt))return Yn==nt;var or=-1,Or=!0,Hn=2&zt?new z:void 0;for(fn.set(Be,nt),fn.set(nt,Be);++or<rr;){var Jn=Be[or],Fn=nt[or];if(Yt)var dr=Cn?Yt(Fn,Jn,or,nt,Be,fn):Yt(Jn,Fn,or,Be,nt,fn);if(dr!==void 0){if(dr)continue;Or=!1;break}if(Hn){if(!Te(nt,function(Fr,ir){if(Jr=ir,!Hn.has(Jr)&&(Jn===Fr||yn(Jn,Fr,zt,Yt,fn)))return Hn.push(ir);var Jr})){Or=!1;break}}else if(Jn!==Fn&&!yn(Jn,Fn,zt,Yt,fn)){Or=!1;break}}return fn.delete(Be),fn.delete(nt),Or}function Le(Be){return function(nt,zt,Yt){var yn=zt(nt);return It(nt)?yn:function(fn,Cn){for(var rr=-1,br=Cn.length,Yn=fn.length;++rr<br;)fn[Yn+rr]=Cn[rr];return fn}(yn,Yt(nt))}(Be,Pn,Ae)}function ye(Be,nt){var zt,Yt,yn=Be.__data__;return((Yt=typeof(zt=nt))=="string"||Yt=="number"||Yt=="symbol"||Yt=="boolean"?zt!=="__proto__":zt===null)?yn[typeof nt=="string"?"string":"hash"]:yn.map}function Me(Be,nt){var zt=function(Yt,yn){return Yt==null?void 0:Yt[yn]}(Be,nt);return me(zt)?zt:void 0}p.prototype.clear=function(){this.__data__=Ct?Ct(null):{},this.size=0},p.prototype.delete=function(Be){var nt=this.has(Be)&&delete this.__data__[Be];return this.size-=nt?1:0,nt},p.prototype.get=function(Be){var nt=this.__data__;if(Ct){var zt=nt[Be];return zt==="__lodash_hash_undefined__"?void 0:zt}return Tn.call(nt,Be)?nt[Be]:void 0},p.prototype.has=function(Be){var nt=this.__data__;return Ct?nt[Be]!==void 0:Tn.call(nt,Be)},p.prototype.set=function(Be,nt){var zt=this.__data__;return this.size+=this.has(Be)?0:1,zt[Be]=Ct&&nt===void 0?"__lodash_hash_undefined__":nt,this},x.prototype.clear=function(){this.__data__=[],this.size=0},x.prototype.delete=function(Be){var nt=this.__data__,zt=$(nt,Be);return!(zt<0)&&(zt==nt.length-1?nt.pop():Vs.call(nt,zt,1),--this.size,!0)},x.prototype.get=function(Be){var nt=this.__data__,zt=$(nt,Be);return zt<0?void 0:nt[zt][1]},x.prototype.has=function(Be){return $(this.__data__,Be)>-1},x.prototype.set=function(Be,nt){var zt=this.__data__,Yt=$(zt,Be);return Yt<0?(++this.size,zt.push([Be,nt])):zt[Yt][1]=nt,this},S.prototype.clear=function(){this.size=0,this.__data__={hash:new p,map:new($e||x),string:new p}},S.prototype.delete=function(Be){var nt=ye(this,Be).delete(Be);return this.size-=nt?1:0,nt},S.prototype.get=function(Be){return ye(this,Be).get(Be)},S.prototype.has=function(Be){return ye(this,Be).has(Be)},S.prototype.set=function(Be,nt){var zt=ye(this,Be),Yt=zt.size;return zt.set(Be,nt),this.size+=zt.size==Yt?0:1,this},z.prototype.add=z.prototype.push=function(Be){return this.__data__.set(Be,"__lodash_hash_undefined__"),this},z.prototype.has=function(Be){return this.__data__.has(Be)},B.prototype.clear=function(){this.__data__=new x,this.size=0},B.prototype.delete=function(Be){var nt=this.__data__,zt=nt.delete(Be);return this.size=nt.size,zt},B.prototype.get=function(Be){return this.__data__.get(Be)},B.prototype.has=function(Be){return this.__data__.has(Be)},B.prototype.set=function(Be,nt){var zt=this.__data__;if(zt instanceof x){var Yt=zt.__data__;if(!$e||Yt.length<199)return Yt.push([Be,nt]),this.size=++zt.size,this;zt=this.__data__=new S(Yt)}return zt.set(Be,nt),this.size=zt.size,this};var Ae=rt?function(Be){return Be==null?[]:(Be=Object(Be),function(nt,zt){for(var Yt=-1,yn=nt==null?0:nt.length,fn=0,Cn=[];++Yt<yn;){var rr=nt[Yt];zt(rr,Yt,nt)&&(Cn[fn++]=rr)}return Cn}(rt(Be),function(nt){return mr.call(Be,nt)}))}:function(){return[]},Ne=H;function He(Be,nt){return!!(nt=nt==null?9007199254740991:nt)&&(typeof Be=="number"||fe.test(Be))&&Be>-1&&Be%1==0&&Be<nt}function We(Be){if(Be!=null){try{return Kn.call(Be)}catch{}try{return Be+""}catch{}}return""}function lt(Be,nt){return Be===nt||Be!=Be&&nt!=nt}(Re&&Ne(new Re(new ArrayBuffer(1)))!="[object DataView]"||$e&&Ne(new $e)!=G||tt&&Ne(tt.resolve())!="[object Promise]"||Ut&&Ne(new Ut)!=J||Et&&Ne(new Et)!="[object WeakMap]")&&(Ne=function(Be){var nt=H(Be),zt=nt==Z?Be.constructor:void 0,Yt=zt?We(zt):"";if(Yt)switch(Yt){case tn:return"[object DataView]";case ln:return G;case hn:return"[object Promise]";case vn:return J;case d:return"[object WeakMap]"}return nt});var ut=re(function(){return arguments}())?re:function(Be){return on(Be)&&Tn.call(Be,"callee")&&!mr.call(Be,"callee")},It=Array.isArray,ze=ie||function(){return!1};function Gt(Be){if(!pn(Be))return!1;var nt=H(Be);return nt=="[object Function]"||nt=="[object GeneratorFunction]"||nt=="[object AsyncFunction]"||nt=="[object Proxy]"}function Lt(Be){return typeof Be=="number"&&Be>-1&&Be%1==0&&Be<=9007199254740991}function pn(Be){var nt=typeof Be;return Be!=null&&(nt=="object"||nt=="function")}function on(Be){return Be!=null&&typeof Be=="object"}var an=Nt?function(Be){return function(nt){return Be(nt)}}(Nt):function(Be){return on(Be)&&Lt(Be.length)&&!!ce[H(Be)]};function Pn(Be){return(nt=Be)!=null&&Lt(nt.length)&&!Gt(nt)?V(Be):ae(Be);var nt}f.exports=function(Be,nt){return se(Be,nt)}}),ea={Polygon:Dt,LineString:mt,Point:dt,MultiPolygon:Ft,MultiLineString:Ft,MultiPoint:Ft};function Co(f,E){return E.modes=dn,E.getFeatureIdsAt=function(k){return ei.click({point:k},null,f).map(function(G){return G.properties.id})},E.getSelectedIds=function(){return f.store.getSelectedIds()},E.getSelected=function(){return{type:ht,features:f.store.getSelectedIds().map(function(k){return f.store.get(k)}).map(function(k){return k.toGeoJSON()})}},E.getSelectedPoints=function(){return{type:ht,features:f.store.getSelectedCoordinates().map(function(k){return{type:Pt,properties:{},geometry:{type:cn,coordinates:k.coordinates}}})}},E.set=function(k){if(k.type===void 0||k.type!==ht||!Array.isArray(k.features))throw new Error("Invalid FeatureCollection");var G=f.store.createRenderBatch(),Z=f.store.getAllIds().slice(),J=E.add(k),ne=new Vr(J);return(Z=Z.filter(function(fe){return!ne.has(fe)})).length&&E.delete(Z),G(),J},E.add=function(k){var G=JSON.parse(JSON.stringify(hr(k))).features.map(function(Z){if(Z.id=Z.id||Oe(),Z.geometry===null)throw new Error("Invalid geometry: null");if(f.store.get(Z.id)===void 0||f.store.get(Z.id).type!==Z.geometry.type){var J=ea[Z.geometry.type];if(J===void 0)throw new Error("Invalid geometry type: "+Z.geometry.type+".");var ne=new J(f,Z);f.store.add(ne)}else{var fe=f.store.get(Z.id);fe.properties=Z.properties,Ei(fe.getCoordinates(),Z.geometry.coordinates)||fe.incomingCoords(Z.geometry.coordinates)}return Z.id});return f.store.render(),G},E.get=function(k){var G=f.store.get(k);if(G)return G.toGeoJSON()},E.getAll=function(){return{type:ht,features:f.store.getAll().map(function(k){return k.toGeoJSON()})}},E.delete=function(k){return f.store.delete(k,{silent:!0}),E.getMode()!==dn.DIRECT_SELECT||f.store.getSelectedIds().length?f.store.render():f.events.changeMode(dn.SIMPLE_SELECT,void 0,{silent:!0}),E},E.deleteAll=function(){return f.store.delete(f.store.getAllIds(),{silent:!0}),E.getMode()===dn.DIRECT_SELECT?f.events.changeMode(dn.SIMPLE_SELECT,void 0,{silent:!0}):f.store.render(),E},E.changeMode=function(k,G){return G===void 0&&(G={}),k===dn.SIMPLE_SELECT&&E.getMode()===dn.SIMPLE_SELECT?(Z=G.featureIds||[],J=f.store.getSelectedIds(),Z.length===J.length&&JSON.stringify(Z.map(function(ne){return ne}).sort())===JSON.stringify(J.map(function(ne){return ne}).sort())||(f.store.setSelected(G.featureIds,{silent:!0}),f.store.render()),E):(k===dn.DIRECT_SELECT&&E.getMode()===dn.DIRECT_SELECT&&G.featureId===f.store.getSelectedIds()[0]||f.events.changeMode(k,G,{silent:!0}),E);var Z,J},E.getMode=function(){return f.events.getMode()},E.trash=function(){return f.events.trash({silent:!0}),E},E.combineFeatures=function(){return f.events.combineFeatures({silent:!0}),E},E.uncombineFeatures=function(){return f.events.uncombineFeatures({silent:!0}),E},E.setFeatureProperty=function(k,G,Z){return f.store.setFeatureProperty(k,G,Z),E},E}var Ii=we(function(f,E){f.exports=function(){function k(Te,qe,wt,pt,Jt){(function en(Ht,_n,gn,Un,Kn){for(;Un>gn;){if(Un-gn>600){var Tn=Un-gn+1,fr=_n-gn+1,ni=Math.log(Tn),Li=.5*Math.exp(2*ni/3),ci=.5*Math.sqrt(ni*Li*(Tn-Li)/Tn)*(fr-Tn/2<0?-1:1);en(Ht,_n,Math.max(gn,Math.floor(_n-fr*Li/Tn+ci)),Math.min(Un,Math.floor(_n+(Tn-fr)*Li/Tn+ci)),Kn)}var Cr=Ht[_n],Di=gn,mr=Un;for(G(Ht,gn,_n),Kn(Ht[Un],Cr)>0&&G(Ht,gn,Un);Di<mr;){for(G(Ht,Di,mr),Di++,mr--;Kn(Ht[Di],Cr)<0;)Di++;for(;Kn(Ht[mr],Cr)>0;)mr--}Kn(Ht[gn],Cr)===0?G(Ht,gn,mr):G(Ht,++mr,Un),mr<=_n&&(gn=mr+1),_n<=mr&&(Un=mr-1)}})(Te,qe,wt||0,pt||Te.length-1,Jt||Z)}function G(Te,qe,wt){var pt=Te[qe];Te[qe]=Te[wt],Te[wt]=pt}function Z(Te,qe){return Te<qe?-1:Te>qe?1:0}var J=function(Te){Te===void 0&&(Te=9),this._maxEntries=Math.max(4,Te),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function ne(Te,qe,wt){if(!wt)return qe.indexOf(Te);for(var pt=0;pt<qe.length;pt++)if(wt(Te,qe[pt]))return pt;return-1}function fe(Te,qe){ce(Te,0,Te.children.length,qe,Te)}function ce(Te,qe,wt,pt,Jt){Jt||(Jt=Wt(null)),Jt.minX=1/0,Jt.minY=1/0,Jt.maxX=-1/0,Jt.maxY=-1/0;for(var en=qe;en<wt;en++){var Ht=Te.children[en];Se(Jt,Te.leaf?pt(Ht):Ht)}return Jt}function Se(Te,qe){return Te.minX=Math.min(Te.minX,qe.minX),Te.minY=Math.min(Te.minY,qe.minY),Te.maxX=Math.max(Te.maxX,qe.maxX),Te.maxY=Math.max(Te.maxY,qe.maxY),Te}function _e(Te,qe){return Te.minX-qe.minX}function De(Te,qe){return Te.minY-qe.minY}function Ge(Te){return(Te.maxX-Te.minX)*(Te.maxY-Te.minY)}function Xe(Te){return Te.maxX-Te.minX+(Te.maxY-Te.minY)}function it(Te,qe){return Te.minX<=qe.minX&&Te.minY<=qe.minY&&qe.maxX<=Te.maxX&&qe.maxY<=Te.maxY}function Zt(Te,qe){return qe.minX<=Te.maxX&&qe.minY<=Te.maxY&&qe.maxX>=Te.minX&&qe.maxY>=Te.minY}function Wt(Te){return{children:Te,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Nt(Te,qe,wt,pt,Jt){for(var en=[qe,wt];en.length;)if(!((wt=en.pop())-(qe=en.pop())<=pt)){var Ht=qe+Math.ceil((wt-qe)/pt/2)*pt;k(Te,Ht,qe,wt,Jt),en.push(qe,Ht,Ht,wt)}}return J.prototype.all=function(){return this._all(this.data,[])},J.prototype.search=function(Te){var qe=this.data,wt=[];if(!Zt(Te,qe))return wt;for(var pt=this.toBBox,Jt=[];qe;){for(var en=0;en<qe.children.length;en++){var Ht=qe.children[en],_n=qe.leaf?pt(Ht):Ht;Zt(Te,_n)&&(qe.leaf?wt.push(Ht):it(Te,_n)?this._all(Ht,wt):Jt.push(Ht))}qe=Jt.pop()}return wt},J.prototype.collides=function(Te){var qe=this.data;if(!Zt(Te,qe))return!1;for(var wt=[];qe;){for(var pt=0;pt<qe.children.length;pt++){var Jt=qe.children[pt],en=qe.leaf?this.toBBox(Jt):Jt;if(Zt(Te,en)){if(qe.leaf||it(Te,en))return!0;wt.push(Jt)}}qe=wt.pop()}return!1},J.prototype.load=function(Te){if(!Te||!Te.length)return this;if(Te.length<this._minEntries){for(var qe=0;qe<Te.length;qe++)this.insert(Te[qe]);return this}var wt=this._build(Te.slice(),0,Te.length-1,0);if(this.data.children.length)if(this.data.height===wt.height)this._splitRoot(this.data,wt);else{if(this.data.height<wt.height){var pt=this.data;this.data=wt,wt=pt}this._insert(wt,this.data.height-wt.height-1,!0)}else this.data=wt;return this},J.prototype.insert=function(Te){return Te&&this._insert(Te,this.data.height-1),this},J.prototype.clear=function(){return this.data=Wt([]),this},J.prototype.remove=function(Te,qe){if(!Te)return this;for(var wt,pt,Jt,en=this.data,Ht=this.toBBox(Te),_n=[],gn=[];en||_n.length;){if(en||(en=_n.pop(),pt=_n[_n.length-1],wt=gn.pop(),Jt=!0),en.leaf){var Un=ne(Te,en.children,qe);if(Un!==-1)return en.children.splice(Un,1),_n.push(en),this._condense(_n),this}Jt||en.leaf||!it(en,Ht)?pt?(wt++,en=pt.children[wt],Jt=!1):en=null:(_n.push(en),gn.push(wt),wt=0,pt=en,en=en.children[0])}return this},J.prototype.toBBox=function(Te){return Te},J.prototype.compareMinX=function(Te,qe){return Te.minX-qe.minX},J.prototype.compareMinY=function(Te,qe){return Te.minY-qe.minY},J.prototype.toJSON=function(){return this.data},J.prototype.fromJSON=function(Te){return this.data=Te,this},J.prototype._all=function(Te,qe){for(var wt=[];Te;)Te.leaf?qe.push.apply(qe,Te.children):wt.push.apply(wt,Te.children),Te=wt.pop();return qe},J.prototype._build=function(Te,qe,wt,pt){var Jt,en=wt-qe+1,Ht=this._maxEntries;if(en<=Ht)return fe(Jt=Wt(Te.slice(qe,wt+1)),this.toBBox),Jt;pt||(pt=Math.ceil(Math.log(en)/Math.log(Ht)),Ht=Math.ceil(en/Math.pow(Ht,pt-1))),(Jt=Wt([])).leaf=!1,Jt.height=pt;var _n=Math.ceil(en/Ht),gn=_n*Math.ceil(Math.sqrt(Ht));Nt(Te,qe,wt,gn,this.compareMinX);for(var Un=qe;Un<=wt;Un+=gn){var Kn=Math.min(Un+gn-1,wt);Nt(Te,Un,Kn,_n,this.compareMinY);for(var Tn=Un;Tn<=Kn;Tn+=_n){var fr=Math.min(Tn+_n-1,Kn);Jt.children.push(this._build(Te,Tn,fr,pt-1))}}return fe(Jt,this.toBBox),Jt},J.prototype._chooseSubtree=function(Te,qe,wt,pt){for(;pt.push(qe),!qe.leaf&&pt.length-1!==wt;){for(var Jt=1/0,en=1/0,Ht=void 0,_n=0;_n<qe.children.length;_n++){var gn=qe.children[_n],Un=Ge(gn),Kn=(Tn=Te,fr=gn,(Math.max(fr.maxX,Tn.maxX)-Math.min(fr.minX,Tn.minX))*(Math.max(fr.maxY,Tn.maxY)-Math.min(fr.minY,Tn.minY))-Un);Kn<en?(en=Kn,Jt=Un<Jt?Un:Jt,Ht=gn):Kn===en&&Un<Jt&&(Jt=Un,Ht=gn)}qe=Ht||qe.children[0]}var Tn,fr;return qe},J.prototype._insert=function(Te,qe,wt){var pt=wt?Te:this.toBBox(Te),Jt=[],en=this._chooseSubtree(pt,this.data,qe,Jt);for(en.children.push(Te),Se(en,pt);qe>=0&&Jt[qe].children.length>this._maxEntries;)this._split(Jt,qe),qe--;this._adjustParentBBoxes(pt,Jt,qe)},J.prototype._split=function(Te,qe){var wt=Te[qe],pt=wt.children.length,Jt=this._minEntries;this._chooseSplitAxis(wt,Jt,pt);var en=this._chooseSplitIndex(wt,Jt,pt),Ht=Wt(wt.children.splice(en,wt.children.length-en));Ht.height=wt.height,Ht.leaf=wt.leaf,fe(wt,this.toBBox),fe(Ht,this.toBBox),qe?Te[qe-1].children.push(Ht):this._splitRoot(wt,Ht)},J.prototype._splitRoot=function(Te,qe){this.data=Wt([Te,qe]),this.data.height=Te.height+1,this.data.leaf=!1,fe(this.data,this.toBBox)},J.prototype._chooseSplitIndex=function(Te,qe,wt){for(var pt,Jt,en,Ht,_n,gn,Un,Kn=1/0,Tn=1/0,fr=qe;fr<=wt-qe;fr++){var ni=ce(Te,0,fr,this.toBBox),Li=ce(Te,fr,wt,this.toBBox),ci=(Jt=ni,en=Li,Ht=Math.max(Jt.minX,en.minX),_n=Math.max(Jt.minY,en.minY),gn=Math.min(Jt.maxX,en.maxX),Un=Math.min(Jt.maxY,en.maxY),Math.max(0,gn-Ht)*Math.max(0,Un-_n)),Cr=Ge(ni)+Ge(Li);ci<Kn?(Kn=ci,pt=fr,Tn=Cr<Tn?Cr:Tn):ci===Kn&&Cr<Tn&&(Tn=Cr,pt=fr)}return pt||wt-qe},J.prototype._chooseSplitAxis=function(Te,qe,wt){var pt=Te.leaf?this.compareMinX:_e,Jt=Te.leaf?this.compareMinY:De;this._allDistMargin(Te,qe,wt,pt)<this._allDistMargin(Te,qe,wt,Jt)&&Te.children.sort(pt)},J.prototype._allDistMargin=function(Te,qe,wt,pt){Te.children.sort(pt);for(var Jt=this.toBBox,en=ce(Te,0,qe,Jt),Ht=ce(Te,wt-qe,wt,Jt),_n=Xe(en)+Xe(Ht),gn=qe;gn<wt-qe;gn++){var Un=Te.children[gn];Se(en,Te.leaf?Jt(Un):Un),_n+=Xe(en)}for(var Kn=wt-qe-1;Kn>=qe;Kn--){var Tn=Te.children[Kn];Se(Ht,Te.leaf?Jt(Tn):Tn),_n+=Xe(Ht)}return _n},J.prototype._adjustParentBBoxes=function(Te,qe,wt){for(var pt=wt;pt>=0;pt--)Se(qe[pt],Te)},J.prototype._condense=function(Te){for(var qe=Te.length-1,wt=void 0;qe>=0;qe--)Te[qe].children.length===0?qe>0?(wt=Te[qe-1].children).splice(wt.indexOf(Te[qe]),1):this.clear():fe(Te[qe],this.toBBox)},J}()}),os={centimeters:637100880,centimetres:637100880,degrees:63710088e-1/111325,feet:20902260511392e-6,inches:63710088e-1*39.37,kilometers:6371.0088,kilometres:6371.0088,meters:63710088e-1,metres:63710088e-1,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:63710088e-1/1852,radians:1,yards:63710088e-1*1.0936},Ml={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/63710088e-1,yards:1.0936133},ta={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function fi(f,E,k){k===void 0&&(k={});var G={type:"Feature"};return(k.id===0||k.id)&&(G.id=k.id),k.bbox&&(G.bbox=k.bbox),G.properties=E||{},G.geometry=f,G}function Pa(f,E,k){if(k===void 0&&(k={}),!f)throw new Error("coordinates is required");if(!Array.isArray(f))throw new Error("coordinates must be an Array");if(f.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ji(f[0])||!ji(f[1]))throw new Error("coordinates must contain numbers");return fi({type:"Point",coordinates:f},E,k)}function na(f,E,k){k===void 0&&(k={});for(var G=0,Z=f;G<Z.length;G++){var J=Z[G];if(J.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var ne=0;ne<J[J.length-1].length;ne++)if(J[J.length-1][ne]!==J[0][ne])throw new Error("First and last Position are not equivalent.")}return fi({type:"Polygon",coordinates:f},E,k)}function Ca(f,E,k){if(k===void 0&&(k={}),f.length<2)throw new Error("coordinates must be an array of two or more positions");return fi({type:"LineString",coordinates:f},E,k)}function Ts(f,E){E===void 0&&(E={});var k={type:"FeatureCollection"};return E.id&&(k.id=E.id),E.bbox&&(k.bbox=E.bbox),k.features=f,k}function Bi(f,E,k){return k===void 0&&(k={}),fi({type:"MultiLineString",coordinates:f},E,k)}function Ps(f,E,k){return k===void 0&&(k={}),fi({type:"MultiPoint",coordinates:f},E,k)}function ra(f,E,k){return k===void 0&&(k={}),fi({type:"MultiPolygon",coordinates:f},E,k)}function ss(f,E){E===void 0&&(E="kilometers");var k=os[E];if(!k)throw new Error(E+" units is invalid");return f*k}function Ao(f,E){E===void 0&&(E="kilometers");var k=os[E];if(!k)throw new Error(E+" units is invalid");return f/k}function ia(f){return 180*(f%(2*Math.PI))/Math.PI}function ji(f){return!isNaN(f)&&f!==null&&!Array.isArray(f)}var Cs=Object.freeze({__proto__:null,earthRadius:63710088e-1,factors:os,unitsFactors:Ml,areaFactors:ta,feature:fi,geometry:function(f,E,k){switch(f){case"Point":return Pa(E).geometry;case"LineString":return Ca(E).geometry;case"Polygon":return na(E).geometry;case"MultiPoint":return Ps(E).geometry;case"MultiLineString":return Bi(E).geometry;case"MultiPolygon":return ra(E).geometry;default:throw new Error(f+" is invalid")}},point:Pa,points:function(f,E,k){return k===void 0&&(k={}),Ts(f.map(function(G){return Pa(G,E)}),k)},polygon:na,polygons:function(f,E,k){return k===void 0&&(k={}),Ts(f.map(function(G){return na(G,E)}),k)},lineString:Ca,lineStrings:function(f,E,k){return k===void 0&&(k={}),Ts(f.map(function(G){return Ca(G,E)}),k)},featureCollection:Ts,multiLineString:Bi,multiPoint:Ps,multiPolygon:ra,geometryCollection:function(f,E,k){return k===void 0&&(k={}),fi({type:"GeometryCollection",geometries:f},E,k)},round:function(f,E){if(E===void 0&&(E=0),E&&!(E>=0))throw new Error("precision must be a positive number");var k=Math.pow(10,E||0);return Math.round(f*k)/k},radiansToLength:ss,lengthToRadians:Ao,lengthToDegrees:function(f,E){return ia(Ao(f,E))},bearingToAzimuth:function(f){var E=f%360;return E<0&&(E+=360),E},radiansToDegrees:ia,degreesToRadians:function(f){return f%360*Math.PI/180},convertLength:function(f,E,k){if(E===void 0&&(E="kilometers"),k===void 0&&(k="kilometers"),!(f>=0))throw new Error("length must be a positive number");return ss(Ao(f,E),k)},convertArea:function(f,E,k){if(E===void 0&&(E="meters"),k===void 0&&(k="kilometers"),!(f>=0))throw new Error("area must be a positive number");var G=ta[E];if(!G)throw new Error("invalid original units");var Z=ta[k];if(!Z)throw new Error("invalid final units");return f/G*Z},isNumber:ji,isObject:function(f){return!!f&&f.constructor===Object},validateBBox:function(f){if(!f)throw new Error("bbox is required");if(!Array.isArray(f))throw new Error("bbox must be an Array");if(f.length!==4&&f.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");f.forEach(function(E){if(!ji(E))throw new Error("bbox must only contain numbers")})},validateId:function(f){if(!f)throw new Error("id is required");if(["string","number"].indexOf(typeof f)===-1)throw new Error("id must be a number or a string")}});function Nn(f,E,k){k===void 0&&(k={});var G={type:"Feature"};return(k.id===0||k.id)&&(G.id=k.id),k.bbox&&(G.bbox=k.bbox),G.properties=E||{},G.geometry=f,G}function fo(f,E,k){if(k===void 0&&(k={}),!f)throw new Error("coordinates is required");if(!Array.isArray(f))throw new Error("coordinates must be an Array");if(f.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!As(f[0])||!As(f[1]))throw new Error("coordinates must contain numbers");return Nn({type:"Point",coordinates:f},E,k)}function mo(f,E,k){if(k===void 0&&(k={}),f.length<2)throw new Error("coordinates must be an array of two or more positions");return Nn({type:"LineString",coordinates:f},E,k)}function As(f){return!isNaN(f)&&f!==null&&!Array.isArray(f)}function as(f){return!!f&&f.constructor===Object}function Ui(f,E,k){if(f!==null)for(var G,Z,J,ne,fe,ce,Se,_e,De=0,Ge=0,Xe=f.type,it=Xe==="FeatureCollection",Zt=Xe==="Feature",Wt=it?f.features.length:1,Nt=0;Nt<Wt;Nt++){fe=(_e=!!(Se=it?f.features[Nt].geometry:Zt?f.geometry:f)&&Se.type==="GeometryCollection")?Se.geometries.length:1;for(var Te=0;Te<fe;Te++){var qe=0,wt=0;if((ne=_e?Se.geometries[Te]:Se)!==null){ce=ne.coordinates;var pt=ne.type;switch(De=!k||pt!=="Polygon"&&pt!=="MultiPolygon"?0:1,pt){case null:break;case"Point":if(E(ce,Ge,Nt,qe,wt)===!1)return!1;Ge++,qe++;break;case"LineString":case"MultiPoint":for(G=0;G<ce.length;G++){if(E(ce[G],Ge,Nt,qe,wt)===!1)return!1;Ge++,pt==="MultiPoint"&&qe++}pt==="LineString"&&qe++;break;case"Polygon":case"MultiLineString":for(G=0;G<ce.length;G++){for(Z=0;Z<ce[G].length-De;Z++){if(E(ce[G][Z],Ge,Nt,qe,wt)===!1)return!1;Ge++}pt==="MultiLineString"&&qe++,pt==="Polygon"&&wt++}pt==="Polygon"&&qe++;break;case"MultiPolygon":for(G=0;G<ce.length;G++){for(wt=0,Z=0;Z<ce[G].length;Z++){for(J=0;J<ce[G][Z].length-De;J++){if(E(ce[G][Z][J],Ge,Nt,qe,wt)===!1)return!1;Ge++}wt++}qe++}break;case"GeometryCollection":for(G=0;G<ne.geometries.length;G++)if(Ui(ne.geometries[G],E,k)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Xn(f,E){var k;switch(f.type){case"FeatureCollection":for(k=0;k<f.features.length&&E(f.features[k].properties,k)!==!1;k++);break;case"Feature":E(f.properties,0)}}function Qi(f,E){if(f.type==="Feature")E(f,0);else if(f.type==="FeatureCollection")for(var k=0;k<f.features.length&&E(f.features[k],k)!==!1;k++);}function ks(f,E,k){var G=k;return Qi(f,function(Z,J){G=J===0&&k===void 0?Z:E(G,Z,J)}),G}function oa(f,E){var k,G,Z,J,ne,fe,ce,Se,_e,De,Ge=0,Xe=f.type==="FeatureCollection",it=f.type==="Feature",Zt=Xe?f.features.length:1;for(k=0;k<Zt;k++){for(fe=Xe?f.features[k].geometry:it?f.geometry:f,Se=Xe?f.features[k].properties:it?f.properties:{},_e=Xe?f.features[k].bbox:it?f.bbox:void 0,De=Xe?f.features[k].id:it?f.id:void 0,ne=(ce=!!fe&&fe.type==="GeometryCollection")?fe.geometries.length:1,Z=0;Z<ne;Z++)if((J=ce?fe.geometries[Z]:fe)!==null)switch(J.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(E(J,Ge,Se,_e,De)===!1)return!1;break;case"GeometryCollection":for(G=0;G<J.geometries.length;G++)if(E(J.geometries[G],Ge,Se,_e,De)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}else if(E(null,Ge,Se,_e,De)===!1)return!1;Ge++}}function Ni(f,E){oa(f,function(k,G,Z,J,ne){var fe,ce=k===null?null:k.type;switch(ce){case null:case"Point":case"LineString":case"Polygon":return E(Nn(k,Z,{bbox:J,id:ne}),G,0)!==!1&&void 0}switch(ce){case"MultiPoint":fe="Point";break;case"MultiLineString":fe="LineString";break;case"MultiPolygon":fe="Polygon"}for(var Se=0;Se<k.coordinates.length;Se++){var _e=k.coordinates[Se];if(E(Nn({type:fe,coordinates:_e},Z),G,Se)===!1)return!1}})}function sa(f,E){Ni(f,function(k,G,Z){var J=0;if(k.geometry){var ne=k.geometry.type;if(ne!=="Point"&&ne!=="MultiPoint"){var fe,ce=0,Se=0,_e=0;return Ui(k,function(De,Ge,Xe,it,Zt){if(fe===void 0||G>ce||it>Se||Zt>_e)return fe=De,ce=G,Se=it,_e=Zt,void(J=0);var Wt=mo([fe,De],k.properties);if(E(Wt,G,Z,Zt,J)===!1)return!1;J++,fe=De})!==!1&&void 0}}})}function ls(f,E){if(!f)throw new Error("geojson is required");Ni(f,function(k,G,Z){if(k.geometry!==null){var J=k.geometry.type,ne=k.geometry.coordinates;switch(J){case"LineString":if(E(k,G,Z,0,0)===!1)return!1;break;case"Polygon":for(var fe=0;fe<ne.length;fe++)if(E(mo(ne[fe],k.properties),G,Z,fe)===!1)return!1}}})}var Ls=Object.freeze({__proto__:null,coordAll:function(f){var E=[];return Ui(f,function(k){E.push(k)}),E},coordEach:Ui,coordReduce:function(f,E,k,G){var Z=k;return Ui(f,function(J,ne,fe,ce,Se){Z=ne===0&&k===void 0?J:E(Z,J,ne,fe,ce,Se)},G),Z},featureEach:Qi,featureReduce:ks,findPoint:function(f,E){if(!as(E=E||{}))throw new Error("options is invalid");var k,G=E.featureIndex||0,Z=E.multiFeatureIndex||0,J=E.geometryIndex||0,ne=E.coordIndex||0,fe=E.properties;switch(f.type){case"FeatureCollection":G<0&&(G=f.features.length+G),fe=fe||f.features[G].properties,k=f.features[G].geometry;break;case"Feature":fe=fe||f.properties,k=f.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":k=f;break;default:throw new Error("geojson is invalid")}if(k===null)return null;var ce=k.coordinates;switch(k.type){case"Point":return fo(ce,fe,E);case"MultiPoint":return Z<0&&(Z=ce.length+Z),fo(ce[Z],fe,E);case"LineString":return ne<0&&(ne=ce.length+ne),fo(ce[ne],fe,E);case"Polygon":return J<0&&(J=ce.length+J),ne<0&&(ne=ce[J].length+ne),fo(ce[J][ne],fe,E);case"MultiLineString":return Z<0&&(Z=ce.length+Z),ne<0&&(ne=ce[Z].length+ne),fo(ce[Z][ne],fe,E);case"MultiPolygon":return Z<0&&(Z=ce.length+Z),J<0&&(J=ce[Z].length+J),ne<0&&(ne=ce[Z][J].length-ne),fo(ce[Z][J][ne],fe,E)}throw new Error("geojson is invalid")},findSegment:function(f,E){if(!as(E=E||{}))throw new Error("options is invalid");var k,G=E.featureIndex||0,Z=E.multiFeatureIndex||0,J=E.geometryIndex||0,ne=E.segmentIndex||0,fe=E.properties;switch(f.type){case"FeatureCollection":G<0&&(G=f.features.length+G),fe=fe||f.features[G].properties,k=f.features[G].geometry;break;case"Feature":fe=fe||f.properties,k=f.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":k=f;break;default:throw new Error("geojson is invalid")}if(k===null)return null;var ce=k.coordinates;switch(k.type){case"Point":case"MultiPoint":return null;case"LineString":return ne<0&&(ne=ce.length+ne-1),mo([ce[ne],ce[ne+1]],fe,E);case"Polygon":return J<0&&(J=ce.length+J),ne<0&&(ne=ce[J].length+ne-1),mo([ce[J][ne],ce[J][ne+1]],fe,E);case"MultiLineString":return Z<0&&(Z=ce.length+Z),ne<0&&(ne=ce[Z].length+ne-1),mo([ce[Z][ne],ce[Z][ne+1]],fe,E);case"MultiPolygon":return Z<0&&(Z=ce.length+Z),J<0&&(J=ce[Z].length+J),ne<0&&(ne=ce[Z][J].length-ne-1),mo([ce[Z][J][ne],ce[Z][J][ne+1]],fe,E)}throw new Error("geojson is invalid")},flattenEach:Ni,flattenReduce:function(f,E,k){var G=k;return Ni(f,function(Z,J,ne){G=J===0&&ne===0&&k===void 0?Z:E(G,Z,J,ne)}),G},geomEach:oa,geomReduce:function(f,E,k){var G=k;return oa(f,function(Z,J,ne,fe,ce){G=J===0&&k===void 0?Z:E(G,Z,J,ne,fe,ce)}),G},lineEach:ls,lineReduce:function(f,E,k){var G=k;return ls(f,function(Z,J,ne,fe){G=J===0&&k===void 0?Z:E(G,Z,J,ne,fe)}),G},propEach:Xn,propReduce:function(f,E,k){var G=k;return Xn(f,function(Z,J){G=J===0&&k===void 0?Z:E(G,Z,J)}),G},segmentEach:sa,segmentReduce:function(f,E,k){var G=k,Z=!1;return sa(f,function(J,ne,fe,ce,Se){G=Z===!1&&k===void 0?J:E(G,J,ne,fe,ce,Se),Z=!0}),G}});function cs(f){var E=[1/0,1/0,-1/0,-1/0];return Ui(f,function(k){E[0]>k[0]&&(E[0]=k[0]),E[1]>k[1]&&(E[1]=k[1]),E[2]<k[0]&&(E[2]=k[0]),E[3]<k[1]&&(E[3]=k[1])}),E}cs.default=cs;var ko=cs.default,Qa=Ls.featureEach,Aa=(Ls.coordEach,Cs.polygon,Cs.featureCollection);function No(f){var E=new Ii(f);return E.insert=function(k){if(k.type!=="Feature")throw new Error("invalid feature");return k.bbox=k.bbox?k.bbox:ko(k),Ii.prototype.insert.call(this,k)},E.load=function(k){var G=[];return Array.isArray(k)?k.forEach(function(Z){if(Z.type!=="Feature")throw new Error("invalid features");Z.bbox=Z.bbox?Z.bbox:ko(Z),G.push(Z)}):Qa(k,function(Z){if(Z.type!=="Feature")throw new Error("invalid features");Z.bbox=Z.bbox?Z.bbox:ko(Z),G.push(Z)}),Ii.prototype.load.call(this,G)},E.remove=function(k,G){if(k.type!=="Feature")throw new Error("invalid feature");return k.bbox=k.bbox?k.bbox:ko(k),Ii.prototype.remove.call(this,k,G)},E.clear=function(){return Ii.prototype.clear.call(this)},E.search=function(k){var G=Ii.prototype.search.call(this,this.toBBox(k));return Aa(G)},E.collides=function(k){return Ii.prototype.collides.call(this,this.toBBox(k))},E.all=function(){var k=Ii.prototype.all.call(this);return Aa(k)},E.toJSON=function(){return Ii.prototype.toJSON.call(this)},E.fromJSON=function(k){return Ii.prototype.fromJSON.call(this,k)},E.toBBox=function(k){var G;if(k.bbox)G=k.bbox;else if(Array.isArray(k)&&k.length===4)G=k;else if(Array.isArray(k)&&k.length===6)G=[k[0],k[1],k[3],k[4]];else if(k.type==="Feature")G=ko(k);else{if(k.type!=="FeatureCollection")throw new Error("invalid geojson");G=ko(k)}return{minX:G[0],minY:G[1],maxX:G[2],maxY:G[3]}},E}var go=No,ka=No;function Er(f){if(!f)throw new Error("coord is required");if(!Array.isArray(f)){if(f.type==="Feature"&&f.geometry!==null&&f.geometry.type==="Point")return f.geometry.coordinates;if(f.type==="Point")return f.coordinates}if(Array.isArray(f)&&f.length>=2&&!Array.isArray(f[0])&&!Array.isArray(f[1]))return f;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function mi(f){if(Array.isArray(f))return f;if(f.type==="Feature"){if(f.geometry!==null)return f.geometry.coordinates}else if(f.coordinates)return f.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function eo(f){return f.type==="Feature"?f.geometry:f}function Ds(f,E){return f.type==="FeatureCollection"?"FeatureCollection":f.type==="GeometryCollection"?"GeometryCollection":f.type==="Feature"&&f.geometry!==null?f.geometry.type:f.type}go.default=ka;var La={centimeters:637100880,centimetres:637100880,degrees:63710088e-1/111325,feet:20902260511392e-6,inches:63710088e-1*39.37,kilometers:6371.0088,kilometres:6371.0088,meters:63710088e-1,metres:63710088e-1,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:63710088e-1/1852,radians:1,yards:63710088e-1*1.0936};function us(f){return f%360*Math.PI/180}function Ti(f,E,k){k===void 0&&(k={});var G=Er(f),Z=Er(E),J=us(Z[1]-G[1]),ne=us(Z[0]-G[0]),fe=us(G[1]),ce=us(Z[1]),Se=Math.pow(Math.sin(J/2),2)+Math.pow(Math.sin(ne/2),2)*Math.cos(fe)*Math.cos(ce);return function(_e,De){De===void 0&&(De="kilometers");var Ge=La[De];if(!Ge)throw new Error(De+" units is invalid");return _e*Ge}(2*Math.atan2(Math.sqrt(Se),Math.sqrt(1-Se)),k.units)}function Da(f,E){E===void 0&&(E={});var k=E.precision,G=E.coordinates,Z=E.mutate;if(k=k==null||isNaN(k)?6:k,G=G==null||isNaN(G)?3:G,!f)throw new Error("<geojson> is required");if(typeof k!="number")throw new Error("<precision> must be a number");if(typeof G!="number")throw new Error("<coordinates> must be a number");Z!==!1&&Z!==void 0||(f=JSON.parse(JSON.stringify(f)));var J=Math.pow(10,k);return Ui(f,function(ne){(function(fe,ce,Se){fe.length>Se&&fe.splice(Se,fe.length);for(var _e=0;_e<fe.length;_e++)fe[_e]=Math.round(fe[_e]*ce)/ce})(ne,J,G)}),f}function hs(f){if(!f)throw new Error("geojson is required");var E=[];return Ni(f,function(k){(function(G,Z){var J=[],ne=G.geometry;if(ne!==null){switch(ne.type){case"Polygon":J=mi(ne);break;case"LineString":J=[mi(ne)]}J.forEach(function(fe){(function(ce,Se){var _e=[];return ce.reduce(function(De,Ge){var Xe,it,Zt,Wt,Nt,Te,qe=function(wt,pt,Jt){if(Jt===void 0&&(Jt={}),wt.length<2)throw new Error("coordinates must be an array of two or more positions");return function(en,Ht,_n){_n===void 0&&(_n={});var gn={type:"Feature"};return(_n.id===0||_n.id)&&(gn.id=_n.id),_n.bbox&&(gn.bbox=_n.bbox),gn.properties=Ht||{},gn.geometry=en,gn}({type:"LineString",coordinates:wt},pt,Jt)}([De,Ge],Se);return qe.bbox=(it=Ge,Zt=(Xe=De)[0],Wt=Xe[1],Nt=it[0],Te=it[1],[Zt<Nt?Zt:Nt,Wt<Te?Wt:Te,Zt>Nt?Zt:Nt,Wt>Te?Wt:Te]),_e.push(qe),Ge}),_e})(fe,G.properties).forEach(function(ce){ce.id=Z.length,Z.push(ce)})})}})(k,E)}),function(k,G){G===void 0&&(G={});var Z={type:"FeatureCollection"};return G.id&&(Z.id=G.id),G.bbox&&(Z.bbox=G.bbox),Z.features=k,Z}(E)}function ds(f,E,k){k===void 0&&(k={});var G={type:"Feature"};return(k.id===0||k.id)&&(G.id=k.id),k.bbox&&(G.bbox=k.bbox),G.properties=E||{},G.geometry=f,G}function zs(f,E){E===void 0&&(E={});var k={type:"FeatureCollection"};return E.id&&(k.id=E.id),E.bbox&&(k.bbox=E.bbox),k.features=f,k}function za(f){return!isNaN(f)&&f!==null&&!Array.isArray(f)}function to(f,E){var k={},G=[];if(f.type==="LineString"&&(f=ds(f)),E.type==="LineString"&&(E=ds(E)),f.type==="Feature"&&E.type==="Feature"&&f.geometry!==null&&E.geometry!==null&&f.geometry.type==="LineString"&&E.geometry.type==="LineString"&&f.geometry.coordinates.length===2&&E.geometry.coordinates.length===2){var Z=el(f,E);return Z&&G.push(Z),zs(G)}var J=go();return J.load(hs(E)),Qi(hs(f),function(ne){Qi(J.search(ne),function(fe){var ce=el(ne,fe);if(ce){var Se=mi(ce).join(",");k[Se]||(k[Se]=!0,G.push(ce))}})}),zs(G)}function el(f,E){var k=mi(f),G=mi(E);if(k.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(G.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var Z=k[0][0],J=k[0][1],ne=k[1][0],fe=k[1][1],ce=G[0][0],Se=G[0][1],_e=G[1][0],De=G[1][1],Ge=(De-Se)*(ne-Z)-(_e-ce)*(fe-J),Xe=(_e-ce)*(J-Se)-(De-Se)*(Z-ce),it=(ne-Z)*(J-Se)-(fe-J)*(Z-ce);if(Ge===0)return null;var Zt=Xe/Ge,Wt=it/Ge;return Zt>=0&&Zt<=1&&Wt>=0&&Wt<=1?function(Nt,Te,qe){if(qe===void 0&&(qe={}),!Nt)throw new Error("coordinates is required");if(!Array.isArray(Nt))throw new Error("coordinates must be an Array");if(Nt.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!za(Nt[0])||!za(Nt[1]))throw new Error("coordinates must contain numbers");return ds({type:"Point",coordinates:Nt},Te,qe)}([Z+Zt*(ne-Z),J+Zt*(fe-J)]):null}function Os(f){return f%360*Math.PI/180}function aa(f,E,k){if(k===void 0&&(k={}),k.final===!0)return function(De,Ge){var Xe=aa(Ge,De);return Xe=(Xe+180)%360}(f,E);var G=Er(f),Z=Er(E),J=Os(G[0]),ne=Os(Z[0]),fe=Os(G[1]),ce=Os(Z[1]),Se=Math.sin(ne-J)*Math.cos(ce),_e=Math.cos(fe)*Math.sin(ce)-Math.sin(fe)*Math.cos(ce)*Math.cos(ne-J);return Math.atan2(Se,_e)%(2*Math.PI)*180/Math.PI}var El={centimeters:637100880,centimetres:637100880,degrees:63710088e-1/111325,feet:20902260511392e-6,inches:63710088e-1*39.37,kilometers:6371.0088,kilometres:6371.0088,meters:63710088e-1,metres:63710088e-1,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:63710088e-1/1852,radians:1,yards:63710088e-1*1.0936};function tl(f){return 180*(f%(2*Math.PI))/Math.PI}function la(f){return f%360*Math.PI/180}function Fs(f){return!isNaN(f)&&f!==null&&!Array.isArray(f)}function Rs(f,E,k,G){G===void 0&&(G={});var Z=Er(f),J=la(Z[0]),ne=la(Z[1]),fe=la(k),ce=function(_e,De){De===void 0&&(De="kilometers");var Ge=El[De];if(!Ge)throw new Error(De+" units is invalid");return _e/Ge}(E,G.units),Se=Math.asin(Math.sin(ne)*Math.cos(ce)+Math.cos(ne)*Math.sin(ce)*Math.cos(fe));return function(_e,De,Ge){if(Ge===void 0&&(Ge={}),!_e)throw new Error("coordinates is required");if(!Array.isArray(_e))throw new Error("coordinates must be an Array");if(_e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Fs(_e[0])||!Fs(_e[1]))throw new Error("coordinates must contain numbers");return function(Xe,it,Zt){Zt===void 0&&(Zt={});var Wt={type:"Feature"};return(Zt.id===0||Zt.id)&&(Wt.id=Zt.id),Zt.bbox&&(Wt.bbox=Zt.bbox),Wt.properties=it||{},Wt.geometry=Xe,Wt}({type:"Point",coordinates:_e},De,Ge)}([tl(J+Math.atan2(Math.sin(fe)*Math.sin(ce)*Math.cos(ne),Math.cos(ce)-Math.sin(ne)*Math.sin(Se))),tl(Se)],G.properties)}function Go(f,E,k){k===void 0&&(k={});var G={type:"Feature"};return(k.id===0||k.id)&&(G.id=k.id),k.bbox&&(G.bbox=k.bbox),G.properties=E||{},G.geometry=f,G}function ca(f,E,k){if(k===void 0&&(k={}),!f)throw new Error("coordinates is required");if(!Array.isArray(f))throw new Error("coordinates must be an Array");if(f.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Vo(f[0])||!Vo(f[1]))throw new Error("coordinates must contain numbers");return Go({type:"Point",coordinates:f},E,k)}function Oa(f,E,k){if(k===void 0&&(k={}),f.length<2)throw new Error("coordinates must be an array of two or more positions");return Go({type:"LineString",coordinates:f},E,k)}function Vo(f){return!isNaN(f)&&f!==null&&!Array.isArray(f)}function yo(f,E,k){k===void 0&&(k={});var G=ca([1/0,1/0],{dist:1/0}),Z=0;return Ni(f,function(J){for(var ne=mi(J),fe=0;fe<ne.length-1;fe++){var ce=ca(ne[fe]);ce.properties.dist=Ti(E,ce,k);var Se=ca(ne[fe+1]);Se.properties.dist=Ti(E,Se,k);var _e=Ti(ce,Se,k),De=Math.max(ce.properties.dist,Se.properties.dist),Ge=aa(ce,Se),Xe=Rs(E,De,Ge+90,k),it=Rs(E,De,Ge-90,k),Zt=to(Oa([Xe.geometry.coordinates,it.geometry.coordinates]),Oa([ce.geometry.coordinates,Se.geometry.coordinates])),Wt=null;Zt.features.length>0&&((Wt=Zt.features[0]).properties.dist=Ti(E,Wt,k),Wt.properties.location=Z+Ti(ce,Wt,k)),ce.properties.dist<G.properties.dist&&((G=ce).properties.index=fe,G.properties.location=Z),Se.properties.dist<G.properties.dist&&((G=Se).properties.index=fe+1,G.properties.location=Z+_e),Wt&&Wt.properties.dist<G.properties.dist&&((G=Wt).properties.index=fe),Z+=_e}}),G}function ua(f,E,k){if(k===void 0&&(k={}),f.length<2)throw new Error("coordinates must be an array of two or more positions");return function(G,Z,J){J===void 0&&(J={});var ne={type:"Feature"};return(J.id===0||J.id)&&(ne.id=J.id),J.bbox&&(ne.bbox=J.bbox),ne.properties=Z||{},ne.geometry=G,ne}({type:"LineString",coordinates:f},E,k)}function no(f,E){E===void 0&&(E={});var k={type:"FeatureCollection"};return E.id&&(k.id=E.id),E.bbox&&(k.bbox=E.bbox),k.features=f,k}function qo(f,E){var k=[],G=go();return Ni(E,function(Z){if(k.forEach(function(fe,ce){fe.id=ce}),k.length){var J=G.search(Z);if(J.features.length){var ne=Bs(Z,J);k=k.filter(function(fe){return fe.id!==ne.id}),G.remove(ne),Qi(ha(ne,Z),function(fe){k.push(fe),G.insert(fe)})}}else(k=ha(f,Z).features).forEach(function(fe){fe.bbox||(fe.bbox=function(ce){var Se=ce[0],_e=ce[1],De=ce[2],Ge=ce[3];if(Ti(ce.slice(0,2),[De,_e])>=Ti(ce.slice(0,2),[Se,Ge])){var Xe=(_e+Ge)/2;return[Se,Xe-(De-Se)/2,De,Xe+(De-Se)/2]}var it=(Se+De)/2;return[it-(Ge-_e)/2,_e,it+(Ge-_e)/2,Ge]}(cs(fe)))}),G.load(no(k))}),no(k)}function ha(f,E){var k=[],G=mi(f)[0],Z=mi(f)[f.geometry.coordinates.length-1];if(Wn(G,Er(E))||Wn(Z,Er(E)))return no([f]);var J=go(),ne=hs(f);J.load(ne);var fe=J.search(E);if(!fe.features.length)return no([f]);var ce=Bs(E,fe),Se=ks(ne,function(_e,De,Ge){var Xe=mi(De)[1],it=Er(E);return Ge===ce.id?(_e.push(it),k.push(ua(_e)),Wn(it,Xe)?[it]:[it,Xe]):(_e.push(Xe),_e)},[G]);return Se.length>1&&k.push(ua(Se)),no(k)}function Bs(f,E){if(!E.features.length)throw new Error("lines must contain features");if(E.features.length===1)return E.features[0];var k,G=1/0;return Qi(E,function(Z){var J=yo(Z,f).properties.dist;J<G&&(k=Z,G=J)}),k}function Wn(f,E){return f[0]===E[0]&&f[1]===E[1]}function Lo(f,E,k){var G,Z,J,ne,fe,ce,Se,_e,De,Ge,Xe=0,it=0,Zt=f.type==="FeatureCollection",Wt=f.type==="Feature",Nt=Zt?f.features.length:1;for(G=0;G<Nt;G++)for(Se=(Ge=(De=Zt?f.features[G].geometry:Wt?f.geometry:f).type==="GeometryCollection")?De.geometries.length:1,ne=0;ne<Se;ne++)if(_e=(ce=Ge?De.geometries[ne]:De).coordinates,Xe=!k||ce.type!=="Polygon"&&ce.type!=="MultiPolygon"?0:1,ce.type==="Point")E(_e,it),it++;else if(ce.type==="LineString"||ce.type==="MultiPoint")for(Z=0;Z<_e.length;Z++)E(_e[Z],it),it++;else if(ce.type==="Polygon"||ce.type==="MultiLineString")for(Z=0;Z<_e.length;Z++)for(J=0;J<_e[Z].length-Xe;J++)E(_e[Z][J],it),it++;else if(ce.type==="MultiPolygon")for(Z=0;Z<_e.length;Z++)for(J=0;J<_e[Z].length;J++)for(fe=0;fe<_e[Z][J].length-Xe;fe++)E(_e[Z][J][fe],it),it++;else{if(ce.type!=="GeometryCollection")throw new Error("Unknown Geometry Type");for(Z=0;Z<ce.geometries.length;Z++)Lo(ce.geometries[Z],E,k)}}function da(f,E){var k;switch(f.type){case"FeatureCollection":for(k=0;k<f.features.length;k++)E(f.features[k].properties,k);break;case"Feature":E(f.properties,0)}}function ps(f,E){if(f.type==="Feature")E(f,0);else if(f.type==="FeatureCollection")for(var k=0;k<f.features.length;k++)E(f.features[k],k)}function nl(f,E){var k,G,Z,J,ne,fe,ce,Se=0,_e=f.type==="FeatureCollection",De=f.type==="Feature",Ge=_e?f.features.length:1;for(k=0;k<Ge;k++)for(ne=(ce=(fe=_e?f.features[k].geometry:De?f.geometry:f).type==="GeometryCollection")?fe.geometries.length:1,Z=0;Z<ne;Z++)if((J=ce?fe.geometries[Z]:fe).type==="Point"||J.type==="LineString"||J.type==="MultiPoint"||J.type==="Polygon"||J.type==="MultiLineString"||J.type==="MultiPolygon")E(J,Se),Se++;else{if(J.type!=="GeometryCollection")throw new Error("Unknown Geometry Type");for(G=0;G<J.geometries.length;G++)E(J.geometries[G],Se),Se++}}var Il={coordEach:Lo,coordReduce:function(f,E,k,G){var Z=k;return Lo(f,function(J,ne){Z=ne===0&&k===void 0?J:E(Z,J,ne)},G),Z},propEach:da,propReduce:function(f,E,k){var G=k;return da(f,function(Z,J){G=J===0&&k===void 0?Z:E(G,Z,J)}),G},featureEach:ps,featureReduce:function(f,E,k){var G=k;return ps(f,function(Z,J){G=J===0&&k===void 0?Z:E(G,Z,J)}),G},coordAll:function(f){var E=[];return Lo(f,function(k){E.push(k)}),E},geomEach:nl,geomReduce:function(f,E,k){var G=k;return nl(f,function(Z,J){G=J===0&&k===void 0?Z:E(G,Z,J)}),G}};function rl(f,E){if(!f)throw new Error("No geometry passed");return{type:"Feature",properties:E||{},geometry:f}}var il=function(f){if(!f)throw new Error("No features passed");return{type:"FeatureCollection",features:f}},Fa={onSetup:function(f){var E=f.spliter;E=E||"line_string";var k=this.getSelected().map(function(G){return G.toGeoJSON()});if(k.length<1)throw new Error("Please select a Linestring/MultiLinestring!");return{main:k,spliter:"passing_mode_"+E}},toDisplayFeatures:function(f,E,k){var G=this;k(E),this.changeMode(f.spliter,function(Z){f.main.forEach(function(J,ne){var fe=[];(function(Se){if(!Se)throw new Error("geojson is required");var _e=[];return Ni(Se,function(De){_e.push(De)}),function(De,Ge){Ge===void 0&&(Ge={});var Xe={type:"FeatureCollection"};return Ge.id&&(Xe.id=Ge.id),Ge.bbox&&(Xe.bbox=Ge.bbox),Xe.features=De,Xe}(_e)})(J).features.forEach(function(Se){if(Se.geometry.type!==mn&&Se.geometry.type!==wn)throw new Error("The feature is not Linestring/MultiLinestring!");var _e=function(De,Ge){if(!De)throw new Error("line is required");if(!Ge)throw new Error("splitter is required");var Xe=Ds(De),it=Ds(Ge);if(Xe!=="LineString")throw new Error("line must be LineString");if(it==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(it==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var Zt=Da(Ge,{precision:7});switch(it){case"Point":return ha(De,Zt);case"MultiPoint":return qo(De,Zt);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return qo(De,to(De,Zt))}}(Se,Z);_e.features.length<1?fe.push(il([Se])):fe.push(_e)});var ce=function(Se){var _e={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}},De=Object.keys(_e).reduce(function(Xe,it){return Xe[it.replace("Multi","")]=it,Xe},{});function Ge(Xe,it,Zt){Zt?_e[it].coordinates=_e[it].coordinates.concat(Xe.geometry.coordinates):_e[it].coordinates.push(Xe.geometry.coordinates),_e[it].properties.push(Xe.properties)}return Il.featureEach(Se,function(Xe){Xe.geometry&&(_e[Xe.geometry.type]?Ge(Xe,Xe.geometry.type,!0):De[Xe.geometry.type]&&Ge(Xe,De[Xe.geometry.type],!1))}),{type:"FeatureCollection",features:Object.keys(_e).filter(function(Xe){return _e[Xe].coordinates.length}).sort().map(function(Xe){return{type:"Feature",properties:{collectedProperties:_e[Xe].properties},geometry:{type:Xe,coordinates:_e[Xe].coordinates}}})}}(il(fe.flatMap(function(Se){return Se.features}))).features[0];ce.id=J.id,G._ctx.api.add(ce)})})}},js=[{id:"drawCircle",title:"\u7ED8\u5236\u5706",className:"vjmap-map-draw_circle",onActivate:function(f){f.api.changeMode("draw_circle")}},{id:"drawRectangle",title:"\u7ED8\u5236\u77E9\u5F62",className:"vjmap-map-draw_rectangle",onActivate:function(f){f.api.changeMode("draw_rectangle")}},{id:"splitLine",title:"\u5206\u5272\u7EBF",className:"vjmap-map-draw-cut-line",onActivate:function(f){f.api.changeMode("splitLineMode",{spliter:"line_string"})}},{id:"cutPolygon",title:"\u5206\u5272\u591A\u8FB9\u5F62",className:"vjmap-map-draw-cut-polygon",onActivate:function(f){f.api.changeMode("cutPolygonMode")}},{id:"undo",title:"\u64A4\u9500\u4E0A\u4E00\u6B65\u64CD\u4F5C",className:"vjmap-map-draw_undo",onActivate:function(f){f.api.undo()}},{id:"redo",title:"\u91CD\u590D\u4E0A\u4E00\u6B65\u64CD\u4F5C",className:"vjmap-map-draw_redo",onActivate:function(f){f.api.redo()}},{id:"snap_mode_snap",title:"\u6355\u6349\u70B9",className:"snap_mode_snap",isCheckbox:!0,checked:!0,onActivate:function(f,E){f.options.snap=E.target.checked}},{id:"snap_mode_grid",title:"\u6355\u6349\u7F51\u683C",isCheckbox:!0,checked:!0,className:"snap_mode_grid",onActivate:function(f,E){f.options.guides=E.target.checked}}],Us={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0,drawCircle:!0,snap_mode_snap:!0,snap_mode_grid:!0,splitLine:!0,cutPolygon:!0,drawRectangle:!0,redo:!0,undo:!0},fs=function(f,E){if(!f)throw new Error("No coordinates passed");for(var k=0;k<f.length;k++){var G=f[k];if(G.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var Z=0;Z<G[G.length-1].length;Z++)if(G[G.length-1][Z]!==G[0][Z])throw new Error("First and last Position are not equivalent.")}return rl({type:"Polygon",coordinates:f},E)};function Zo(f,E,k){if(k===void 0&&(k={}),!f)throw new Error("point is required");if(!E)throw new Error("polygon is required");var G=Er(f),Z=eo(E),J=Z.type,ne=E.bbox,fe=Z.coordinates;if(ne&&function(Ge,Xe){return Xe[0]<=Ge[0]&&Xe[1]<=Ge[1]&&Xe[2]>=Ge[0]&&Xe[3]>=Ge[1]}(G,ne)===!1)return!1;J==="Polygon"&&(fe=[fe]);for(var ce=!1,Se=0;Se<fe.length&&!ce;Se++)if(Ra(G,fe[Se][0],k.ignoreBoundary)){for(var _e=!1,De=1;De<fe[Se].length&&!_e;)Ra(G,fe[Se][De],!k.ignoreBoundary)&&(_e=!0),De++;_e||(ce=!0)}return ce}function Ra(f,E,k){var G=!1;E[0][0]===E[E.length-1][0]&&E[0][1]===E[E.length-1][1]&&(E=E.slice(0,E.length-1));for(var Z=0,J=E.length-1;Z<E.length;J=Z++){var ne=E[Z][0],fe=E[Z][1],ce=E[J][0],Se=E[J][1];if(f[1]*(ne-ce)+fe*(ce-f[0])+Se*(f[0]-ne)==0&&(ne-f[0])*(ce-f[0])<=0&&(fe-f[1])*(Se-f[1])<=0)return!k;fe>f[1]!=Se>f[1]&&f[0]<(ce-ne)*(f[1]-fe)/(Se-fe)+ne&&(G=!G)}return G}function Ns(f,E,k){k===void 0&&(k={});var G={type:"Feature"};return(k.id===0||k.id)&&(G.id=k.id),k.bbox&&(G.bbox=k.bbox),G.properties=E||{},G.geometry=f,G}function Ir(f,E){E===void 0&&(E={});var k=eo(f);switch(E.properties||f.type!=="Feature"||(E.properties=f.properties),k.type){case"Polygon":return function(G,Z){Z===void 0&&(Z={});var J=eo(G).coordinates,ne=Z.properties?Z.properties:G.type==="Feature"?G.properties:{};return pa(J,ne)}(k,E);case"MultiPolygon":return function(G,Z){Z===void 0&&(Z={});var J=eo(G).coordinates,ne=Z.properties?Z.properties:G.type==="Feature"?G.properties:{},fe=[];return J.forEach(function(ce){fe.push(pa(ce,ne))}),function(ce,Se){Se===void 0&&(Se={});var _e={type:"FeatureCollection"};return Se.id&&(_e.id=Se.id),Se.bbox&&(_e.bbox=Se.bbox),_e.features=ce,_e}(fe)}(k,E);default:throw new Error("invalid poly")}}function pa(f,E){return f.length>1?function(k,G,Z){return Z===void 0&&(Z={}),Ns({type:"MultiLineString",coordinates:k},G,Z)}(f,E):function(k,G,Z){if(Z===void 0&&(Z={}),k.length<2)throw new Error("coordinates must be an array of two or more positions");return Ns({type:"LineString",coordinates:k},G,Z)}(f[0],E)}function $o(f,E){var k=!0;return Ni(f,function(G){Ni(E,function(Z){if(k===!1)return!1;k=function(J,ne){switch(J.type){case"Point":switch(ne.type){case"Point":return fe=J.coordinates,ce=ne.coordinates,!(fe[0]===ce[0]&&fe[1]===ce[1]);case"LineString":return!fa(ne,J);case"Polygon":return!Zo(J,ne)}break;case"LineString":switch(ne.type){case"Point":return!fa(J,ne);case"LineString":return!function(Se,_e){return to(Se,_e).features.length>0}(J,ne);case"Polygon":return!Wo(ne,J)}break;case"Polygon":switch(ne.type){case"Point":return!Zo(ne,J);case"LineString":return!Wo(J,ne);case"Polygon":return!function(Se,_e){for(var De=0,Ge=Se.coordinates[0];De<Ge.length;De++)if(Zo(Ge[De],_e))return!0;for(var Xe=0,it=_e.coordinates[0];Xe<it.length;Xe++)if(Zo(it[Xe],Se))return!0;return to(Ir(Se),Ir(_e)).features.length>0}(ne,J)}}var fe,ce;return!1}(G.geometry,Z.geometry)})}),k}function fa(f,E){for(var k=0;k<f.coordinates.length-1;k++)if(ms(f.coordinates[k],f.coordinates[k+1],E.coordinates))return!0;return!1}function Wo(f,E){for(var k=0,G=E.coordinates;k<G.length;k++)if(Zo(G[k],f))return!0;return to(E,Ir(f)).features.length>0}function ms(f,E,k){var G=k[0]-f[0],Z=k[1]-f[1],J=E[0]-f[0],ne=E[1]-f[1];return G*ne-Z*J==0&&(Math.abs(J)>=Math.abs(ne)?J>0?f[0]<=k[0]&&k[0]<=E[0]:E[0]<=k[0]&&k[0]<=f[0]:ne>0?f[1]<=k[1]&&k[1]<=E[1]:E[1]<=k[1]&&k[1]<=f[1])}function ro(f){return f*(Math.PI/180)}function Ba(f,E,k,G){var Z=ro(k-f),J=ro(G-E),ne=Math.sin(Z/2)*Math.sin(Z/2)+Math.cos(ro(f))*Math.cos(ro(k))*Math.sin(J/2)*Math.sin(J/2);return 6371*(2*Math.atan2(Math.sqrt(ne),Math.sqrt(1-ne)))}function _o(f,E,k){var G=f,Z=E;return Array.isArray(f)&&f.length>0&&Array.isArray(f[0])&&f[0].length==2&&(G=f[0]),Array.isArray(E)&&E.length>0&&Array.isArray(E[0])&&E[0].length==2&&(Z=E[0]),Ti(G,Z,k)}var Gi="VERTICAL_GUIDE",gi="HORIZONTAL_GUIDE",Xr="SNAPNODE_GUIDE",gs=function(f,E,k,G){var Z=f.getCanvas(),J=Z.width,ne=Z.height;if(k&&!isNaN(k.lng)&&!isNaN(k.lat)){var fe=f.project(k),ce=fe.x,Se=fe.y;(ce>0&&ce<J&&Se>0&&Se<ne||G)&&E.push(k)}},Vi=function(f,E,k){var G=E.getAll().features;if(typeof E.getSnapFeatures=="function"){var Z=E.getSnapFeatures();Array.isArray(Z)&&(G=G.concat(Z))}else Array.isArray(E.getSnapFeatures)?G=G.concat(E.getSnapFeatures):E.getSnapFeatures&&E.getSnapFeatures.features&&Array.isArray(E.getSnapFeatures.features)&&(G=G.concat(E.getSnapFeatures.features));var J=[],ne=function(){var Se=f.getCanvas(),_e=Se.width,De=Se.height,Ge=(f.unproject([0,0]).toArray(),f.unproject([_e,0]).toArray());return f.unproject([_e,De]).toArray(),function(Xe){var it=[Xe[0],Xe[1]],Zt=[Xe[0],Xe[3]],Wt=[Xe[2],Xe[3]],Nt=[Xe[2],Xe[1]];return fs([[it,Nt,Wt,Zt,it]])}([f.unproject([0,De]).toArray(),Ge].flat())}(),fe=[],ce=function(Se,_e){if(_e===void 0&&(_e=!1),!Array.isArray(Se))throw Error("Your array is not an array");Array.isArray(Se[0])?Se.forEach(function(De){ce(De)}):Se.length===2&&gs(f,fe,Se,_e)};return G.forEach(function(Se){Se.id!==k.id?Se.id!==gi&&Se.id!==Gi&&Se.id!==Xr&&(ce(Se.geometry.coordinates),$o(ne,Se)||J.push(Se)):k.type===nn&&ce(Se.geometry.coordinates[0].slice(0,-2),!0)}),[J,fe]},ma=function(f,E){var k={};return E.forEach(function(G,Z){var J=function(ne,fe){var ce=[ne.lng,ne.lat],Se=fe.geometry.type==="Point",_e=fe.geometry.type==="Polygon",De=void 0,Ge=mi(fe);if(Se)return{isMarker:Se,latlng:{lng:Ge[0],lat:Ge[1]},distance:_o(Ge,ce)};var Xe=yo(De=_e?Ir(fe):fe,ce),it=Xe.geometry.coordinates,Zt=it[0],Wt=it[1],Nt=Xe.properties.index;return Nt+1===De.geometry.coordinates.length&&Nt--,{latlng:{lng:Zt,lat:Wt},segment:De.geometry.coordinates.slice(Nt,Nt+2),distance:Xe.properties.dist,isMarker:Se}}(f,G);(k.distance===void 0||J.distance<k.distance)&&((k=J).layer=G)}),k},ga=function(f,E,k){if(k===void 0&&(k=1.25),Array.isArray(f.segment)&&f.segment.length>=2){var G=f.segment[0],Z=f.segment[1];if(G&&Z){Array.isArray(G)&&G.length>0&&Array.isArray(G[0])&&G[0].length==2&&(G=G[0]),Array.isArray(Z)&&Z.length>0&&Array.isArray(Z[0])&&Z[0].length==2&&(Z=Z[0]);var J,ne,fe,ce=[f.latlng.lng,f.latlng.lat],Se=_o(G,ce),_e=_o(Z,ce),De=Se<_e?G:Z,Ge=Se<_e?Se:_e;if(E&&E.snapToMidPoints){var Xe=(J=G,ne=Z,Rs(J,Ti(J,ne)/2,aa(J,ne))).geometry.coordinates,it=_o(Xe,ce);it<Se&&it<_e&&(De=Xe,Ge=it)}return{lng:(fe=Ge<k?De:ce)[0],lat:fe[1]}}}},vo=function(f,E){var k,G,Z,J,ne,fe,ce,Se,_e,De,Ge,Xe,it=E.lngLat.lng,Zt=E.lngLat.lat;if(f.showSnapNodePoint=!1,E.originalEvent.altKey)return f.showVerticalSnapLine=!1,f.showHorizontalSnapLine=!1,{lng:it,lat:Zt};if(f.snapList.length<=0)return f.showSnapNodePoint=!1,{lng:it,lat:Zt};if(f.options.snap){if(k=ma({lng:it,lat:Zt},f.snapList),Object.keys(k).length===0)return!1;var Wt=k.isMarker,Nt=f.options.snapOptions?f.options.snapOptions.snapVertexPriorityDistance:void 0;if(Wt)Z=k.latlng;else if(!(Z=ga(k,f.options.snapOptions,Nt)))return{lng:it,lat:Zt};G=(f.options.snapOptions&&f.options.snapOptions.snapPx||15)*(J=Z.lat,ne=f.map.getZoom(),fe=J*(Math.PI/180),40075017*Math.cos(fe)/Math.pow(2,ne+8))}if(f.options.guides){var Te=(_e=f.vertices,De=E.lngLat,Ge=[],Xe=[],_e.forEach(function(en){Ge.push(en[0]),Xe.push(en[1])}),{verticalPx:Ge.find(function(en){return Math.abs(en-De.lng)<.009}),horizontalPx:Xe.find(function(en){return Math.abs(en-De.lat)<.009})});if(Se=Te.horizontalPx,ce=Te.verticalPx){var qe={lng:ce,lat:E.lngLat.lat+10},wt={lng:ce,lat:E.lngLat.lat-10};f.verticalGuide.updateCoordinate(0,qe.lng,qe.lat),f.verticalGuide.updateCoordinate(1,wt.lng,wt.lat)}if(Se){var pt={lng:E.lngLat.lng+10,lat:Se},Jt={lng:E.lngLat.lng-10,lat:Se};f.horizontalGuide.updateCoordinate(0,pt.lng,pt.lat),f.horizontalGuide.updateCoordinate(1,Jt.lng,Jt.lat)}f.showVerticalSnapLine=!!ce,f.showHorizontalSnapLine=!!Se}return k&&1e3*k.distance<G?(f.snapNodeGuide.updateCoordinate(Z.lng,Z.lat),f.showSnapNodePoint=!0,Z):ce||Se?(ce&&(it=ce),Se&&(Zt=Se),{lng:it,lat:Zt}):{lng:it,lat:Zt}},yi=function(f){return{id:f,type:Pt,properties:{isSnapGuide:"true"},geometry:{type:f==Xr?cn:mn,coordinates:[]}}},Gs=function(f,E){return!(E.properties.id!==Gi||f.options.guides&&f.showVerticalSnapLine)||!(E.properties.id!==gi||f.options.guides&&f.showHorizontalSnapLine)||!(E.properties.id!==Xr||f.options.snap&&f.showSnapNodePoint)},Do=Object.assign({},nr);Do.onSetup=function(f){var E=this,k=this.newFeature({type:Pt,properties:{},geometry:{type:cn,coordinates:[[]]}}),G=this.newFeature(yi(Gi)),Z=this.newFeature(yi(gi)),J=this.newFeature(yi(Xr));this.addFeature(k),this.addFeature(G),this.addFeature(Z),this.addFeature(J);var ne=this.getSelected();this.clearSelectedFeatures(),wr(this);var fe=Vi(this.map,this._ctx.api,k),ce=fe[0],Se=fe[1],_e={map:this.map,point:k,vertices:Se,snapList:ce,selectedFeatures:ne,verticalGuide:G,horizontalGuide:Z,snapNodeGuide:J};_e.options=this._ctx.options;var De=function(){var Xe=Vi(E.map,E._ctx.api,k),it=Xe[0],Zt=Xe[1];_e.vertices=Zt,_e.snapList=it};_e.moveendCallback=De;var Ge=function(Xe){_e.options=Xe};return _e.optionsChangedCallBAck=Ge,this.map.on("moveend",De),this.map.on("draw.snap.options_changed",Ge),this.map.setIsInteracting(!0),_e},Do.onClick=function(f){nr.onClick.call(this,f,{lngLat:{lng:f.snappedLng,lat:f.snappedLat}})},Do.onMouseMove=function(f,E){var k=vo(f,E),G=k.lng,Z=k.lat;f.snappedLng=G,f.snappedLat=Z,f.lastVertex&&f.lastVertex[0]===G&&f.lastVertex[1]===Z?this.updateUIClasses({mouse:vt}):this.updateUIClasses({mouse:Pe}),this.map.fire(Dn,{lnglat:[G,Z],event:E,state:f,styleId:f.options.styleId})},Do.toDisplayFeatures=function(f,E,k){Gs(f,E)||nr.toDisplayFeatures(f,E,k)},Do.onStop=function(f){this.deleteFeature(Gi,{silent:!0}),this.deleteFeature(gi,{silent:!0}),this.deleteFeature(Xr,{silent:!0}),this.map.off("moveend",f.moveendCallback),nr.onStop.call(this,f),this.map.setIsInteracting(!1)};var zo=Object.assign({},li);zo.onSetup=function(f){var E=this,k=this.newFeature({type:Pt,properties:{},geometry:{type:mn,coordinates:[[]]}}),G=this.newFeature(yi(Gi)),Z=this.newFeature(yi(gi)),J=this.newFeature(yi(Xr));this.addFeature(k),this.addFeature(G),this.addFeature(Z),this.addFeature(J);var ne=this.getSelected();this.clearSelectedFeatures(),wr(this);var fe=Vi(this.map,this._ctx.api,k),ce=fe[0],Se=fe[1],_e={map:this.map,line:k,currentVertexPosition:0,vertices:Se,snapList:ce,selectedFeatures:ne,verticalGuide:G,horizontalGuide:Z,snapNodeGuide:J,direction:"forward"};_e.options=this._ctx.options;var De=function(){var Xe=Vi(E.map,E._ctx.api,k),it=Xe[0],Zt=Xe[1];_e.vertices=Zt,_e.snapList=it};_e.moveendCallback=De;var Ge=function(Xe){_e.options=Xe};return _e.optionsChangedCallBAck=Ge,this.map.on("moveend",De),this.map.on("draw.snap.options_changed",Ge),this.map.setIsInteracting(!0),_e},zo.onClick=function(f){var E=f.snappedLng,k=f.snappedLat;if(f.currentVertexPosition>0){var G=f.line.coordinates[f.currentVertexPosition-1];if(f.lastVertex=G,G[0]===E&&G[1]===k)return this.changeMode(dn.SIMPLE_SELECT,{featureIds:[f.line.id]})}gs(f.map,f.vertices,{lng:E,lat:k}),f.line.updateCoordinate(f.currentVertexPosition,E,k),f.currentVertexPosition++,f.line.updateCoordinate(f.currentVertexPosition,E,k)},zo.onMouseMove=function(f,E){var k=vo(f,E),G=k.lng,Z=k.lat;f.line.updateCoordinate(f.currentVertexPosition,G,Z),f.snappedLng=G,f.snappedLat=Z,f.lastVertex&&f.lastVertex[0]===G&&f.lastVertex[1]===Z?this.updateUIClasses({mouse:vt}):this.updateUIClasses({mouse:Pe}),this.map.fire(Dn,{lnglat:[G,Z],feature:f.line,event:E,state:f,styleId:f.options.styleId})},zo.toDisplayFeatures=function(f,E,k){Gs(f,E)||li.toDisplayFeatures(f,E,k)},zo.onStop=function(f){this.deleteFeature(Gi,{silent:!0}),this.deleteFeature(gi,{silent:!0}),this.deleteFeature(Xr,{silent:!0}),this.map.off("moveend",f.moveendCallback),li.onStop.call(this,f),this.map.setIsInteracting(!1)};var Pi=Object.assign({},xr);Pi.onSetup=function(f){var E=this,k=this.newFeature({type:Pt,properties:{},geometry:{type:nn,coordinates:[[]]}}),G=this.newFeature(yi(Gi)),Z=this.newFeature(yi(gi)),J=this.newFeature(yi(Xr));this.addFeature(k),this.addFeature(G),this.addFeature(Z),this.addFeature(J);var ne=this.getSelected();this.clearSelectedFeatures(),wr(this);var fe=Vi(this.map,this._ctx.api,k),ce=fe[0],Se=fe[1],_e={map:this.map,polygon:k,currentVertexPosition:0,vertices:Se,snapList:ce,selectedFeatures:ne,verticalGuide:G,horizontalGuide:Z,snapNodeGuide:J};_e.options=this._ctx.options;var De=function(){var Xe=Vi(E.map,E._ctx.api,k),it=Xe[0],Zt=Xe[1];_e.vertices=Zt,_e.snapList=it};_e.moveendCallback=De;var Ge=function(Xe){_e.options=Xe};return _e.optionsChangedCallBAck=Ge,this.map.on("moveend",De),this.map.on("draw.snap.options_changed",Ge),this.map.setIsInteracting(!0),_e},Pi.onClick=function(f){var E=f.snappedLng,k=f.snappedLat;if(f.currentVertexPosition>0){var G=f.polygon.coordinates[0][f.currentVertexPosition-1];if(f.lastVertex=G,G[0]===E&&G[1]===k)return this.changeMode(dn.SIMPLE_SELECT,{featureIds:[f.polygon.id]})}gs(f.map,f.vertices,{lng:E,lat:k}),f.polygon.updateCoordinate("0."+f.currentVertexPosition,E,k),f.currentVertexPosition++,f.polygon.updateCoordinate("0."+f.currentVertexPosition,E,k)},Pi.onMouseMove=function(f,E){var k=vo(f,E),G=k.lng,Z=k.lat;f.polygon.updateCoordinate("0."+f.currentVertexPosition,G,Z),f.snappedLng=G,f.snappedLat=Z,f.lastVertex&&f.lastVertex[0]===G&&f.lastVertex[1]===Z?this.updateUIClasses({mouse:vt}):this.updateUIClasses({mouse:Pe}),this.map.fire(Dn,{lnglat:[G,Z],feature:f.polygon,event:E,state:f,styleId:f.options.styleId})},Pi.toDisplayFeatures=function(f,E,k){Gs(f,E)||xr.toDisplayFeatures(f,E,k)},Pi.onStop=function(f){this.deleteFeature(Gi,{silent:!0}),this.deleteFeature(gi,{silent:!0}),this.deleteFeature(Xr,{silent:!0}),this.map.off("moveend",f.moveendCallback),this.map.off("draw.snap.options_changed",f.optionsChangedCallBAck),xr.onStop.call(this,f),this.map.setIsInteracting(!1)};var Ci=Object.assign({},xr);Ci.onSetup=function(f){var E=this,k=this.newFeature({type:Pt,properties:{},geometry:{type:nn,coordinates:[[]]}}),G=this.newFeature(yi(Gi)),Z=this.newFeature(yi(gi)),J=this.newFeature(yi(Xr));this.addFeature(k),this.addFeature(G),this.addFeature(Z),this.addFeature(J);var ne=this.getSelected();this.clearSelectedFeatures(),wr(this);var fe=Vi(this.map,this._ctx.api,k),ce=fe[0],Se=fe[1],_e={map:this.map,polygon:k,currentVertexPosition:0,vertices:Se,snapList:ce,selectedFeatures:ne,verticalGuide:G,horizontalGuide:Z,snapNodeGuide:J};_e.options=this._ctx.options;var De=function(){var Xe=Vi(E.map,E._ctx.api,k),it=Xe[0],Zt=Xe[1];_e.vertices=Zt,_e.snapList=it};_e.moveendCallback=De;var Ge=function(Xe){_e.options=Xe};return _e.optionsChangedCallBAck=Ge,this.map.on("moveend",De),this.map.on("draw.snap.options_changed",Ge),this.map.setIsInteracting(!0),_e},Ci.onTap=function(f,E){f.startPoint&&this.onMouseMove(f,E),this.onClick(f,E)},Ci.onClick=function(f){var E=f.snappedLng,k=f.snappedLat;f.startPoint&&f.startPoint[0]!==E&&f.startPoint[1]!==k&&(this.updateUIClasses({mouse:"pointer"}),f.endPoint=[E,k],this.changeMode("simple_select",{featuresId:f.polygon.id}));var G=[E,k];f.startPoint=G},Ci.onMouseMove=function(f,E){var k=vo(f,E),G=k.lng,Z=k.lat;f.polygon.updateCoordinate("0."+f.currentVertexPosition,G,Z),f.snappedLng=G,f.snappedLat=Z,f.startPoint&&(f.polygon.updateCoordinate("0.0",f.startPoint[0],f.startPoint[1]),f.polygon.updateCoordinate("0.1",G,f.startPoint[1]),f.polygon.updateCoordinate("0.2",G,Z),f.polygon.updateCoordinate("0.3",f.startPoint[0],Z),f.polygon.updateCoordinate("0.4",f.startPoint[0],f.startPoint[1])),this.map.fire(Dn,{lnglat:[G,Z],feature:f.polygon,event:E,state:f,styleId:f.options.styleId})},Ci.toDisplayFeatures=function(f,E,k){Gs(f,E)||xr.toDisplayFeatures(f,E,k)},Ci.onStop=function(f){this.deleteFeature(Gi,{silent:!0}),this.deleteFeature(gi,{silent:!0}),this.deleteFeature(Xr,{silent:!0}),this.map.off("moveend",f.moveendCallback),this.map.off("draw.snap.options_changed",f.optionsChangedCallBAck),xr.onStop.call(this,f),this.map.setIsInteracting(!1)};var ys=ft.map(function(f){return f.id==="gl-draw-line-inactive"?Object.assign({},f,{filter:f.filter.concat([["!=","user_isSnapGuide","true"]])}):f}).concat([{id:"guide",type:"line",filter:["all",["==","$type","LineString"],["==","user_isSnapGuide","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#c00c00","line-width":1,"line-dasharray":[5,5]}}]);function ti(f,E){for(var k=zn(f),G=Math.floor(60),Z=1e3*E,J=[],ne=0;ne<G;ne++){var fe=6*ne*Math.PI/180,ce=k[0]+Z*Math.cos(fe),Se=k[1]+Z*Math.sin(fe);J.push([ce,Se])}return J.push(J[0]),J.map(function(_e){return ts(_e)})}var _s=Object.assign({},Ri.draw_polygon);_s.onSetup=function(f){var E=this.newFeature({type:Pt,properties:{isCircle:!0,center:[]},geometry:{type:nn,coordinates:[[]]}});return this.addFeature(E),this.clearSelectedFeatures(),wr(this),this.updateUIClasses({mouse:Pe}),this.activateUIButton(Rt.POLYGON),this.setActionableState({trash:!0}),{initialRadiusInKm:f.initialRadiusInKm||2,polygon:E,currentVertexPosition:0}},_s.clickAnywhere=function(f,E){if(f.currentVertexPosition===0){f.currentVertexPosition++;var k=[E.lngLat.lng,E.lngLat.lat],G=ti(k,f.initialRadiusInKm);f.polygon.incomingCoords([G]),f.polygon.properties.center=k,f.polygon.properties.radiusInKm=f.initialRadiusInKm}return this.changeMode(dn.SIMPLE_SELECT,{featureIds:[f.polygon.id]})};var Ai=Object.assign({},Ri.draw_polygon);function ja(f){var E=f.properties,k=f.geometry;if(!E.user_isCircle)return null;for(var G=[],Z=k.coordinates[0].slice(0,-1),J=0;J<Z.length;J+=Math.round(Z.length/4))G.push(wi(E.id,Z[J],"0."+J,!1));return G}Ai.onSetup=function(f){var E,k=this.newFeature({type:Pt,properties:{isCircle:!0,center:[]},geometry:{type:nn,coordinates:[[]]}});this.addFeature(k),this.clearSelectedFeatures(),wr(this),E=this,setTimeout(function(){E.map&&E.map.doubleClickZoom&&E.map.dragPan.disable()},0),this.updateUIClasses({mouse:Pe}),this.activateUIButton(Rt.POLYGON),this.setActionableState({trash:!0});var G={map:this.map,polygon:k,currentVertexPosition:0};return G.options=this._ctx.options,G},Ai.onMouseDown=Ai.onTouchStart=function(f,E){var k;if(f.polygon.properties.center.length!==0)return k=this,setTimeout(function(){k.map&&k.map.dragPan&&k._ctx&&k._ctx.store&&k._ctx.store.getInitialConfigValue&&k._ctx.store.getInitialConfigValue("dragPan")&&k.map.dragPan.enable()},0),this.changeMode(dn.SIMPLE_SELECT,{featureIds:[f.polygon.id]});f.polygon.properties.center=[E.lngLat.lng,E.lngLat.lat]},Ai.onDrag=Ai.onMouseMove=function(f,E){var k=f.polygon.properties.center;if(k.length>0){var G=Ba(k[1],k[0],E.lngLat.lat,E.lngLat.lng),Z=ti(k,G);f.polygon.incomingCoords([Z]),f.polygon.properties.radiusInKm=G}this.map.fire(Dn,{lnglat:[E.lngLat.lat,E.lngLat.lng],feature:f.polygon,event:E,state:f,styleId:f.options.styleId})},Ai.onMouseUp=Ai.onTouchEnd=function(f,E){},Ai.onClick=Ai.onTap=function(f,E){},Ai.toDisplayFeatures=function(f,E,k){var G=E.properties.id===f.polygon.id;return E.properties.active=G?In:tr,k(E)};var Ur=Ri.direct_select;Ur.dragFeature=function(f,E,k){Ms(this.getSelected(),k),this.getSelected().filter(function(G){return G.properties.isCircle}).map(function(G){return G.properties.center}).forEach(function(G){G[0]+=k.lng,G[1]+=k.lat}),f.dragMoveLocation=E.lngLat},Ur.dragVertex=function(f,E,k){if(f.feature.properties.isCircle){var G=f.feature.properties.center,Z=Ba(G[1],G[0],E.lngLat.lat,E.lngLat.lng),J=ti(G,Z);f.feature.incomingCoords([J]),f.feature.properties.radiusInKm=Z}else for(var ne=f.selectedCoordPaths.map(function(_e){return f.feature.getCoordinate(_e)}),fe=ai(ne.map(function(_e){return{type:Pt,properties:{},geometry:{type:cn,coordinates:_e}}}),k),ce=0;ce<ne.length;ce++){var Se=ne[ce];f.feature.updateCoordinate(f.selectedCoordPaths[ce],Se[0]+fe.lng,Se[1]+fe.lat)}},Ur.toDisplayFeatures=function(f,E,k){f.featureId===E.properties.id?(E.properties.active=In,k(E),(E.properties.user_isCircle?ja(E):Yi(E,{map:this.map,midpoints:!0,selectedPaths:f.selectedCoordPaths})).forEach(k)):(E.properties.active=tr,k(E)),this.fireActionable(f)};var Ua=Ri.simple_select;function ki(f){var E=f.onSetup,k=f.onClick,G=f.onMouseMove,Z=function(ne,fe){var ce={};for(var Se in ne)Object.prototype.hasOwnProperty.call(ne,Se)&&fe.indexOf(Se)===-1&&(ce[Se]=ne[Se]);return ce}(f,["onSetup","onClick","onMouseMove"]),J=Object.assign({},{originOnSetup:E,originOnMouseMove:G,originOnClick:k},Z);return J.onSetup=function(ne){var fe=this.originOnSetup();return fe.feature_type="point"in fe?"point":"line"in fe?"line":"polygon",fe.callBack=ne,fe},J.onTap=J.onClick=function(ne,fe){ne.feature_type==="point"?(this.updateUIClasses({mouse:Je}),ne.point.updateCoordinate("",fe.lngLat.lng,fe.lngLat.lat),typeof ne.callBack=="function"?ne.callBack(ne.point.toGeoJSON()):this.map.fire("draw.passing-create",{features:[ne.point.toGeoJSON()]}),this.changeMode(dn.SIMPLE_SELECT,{},{silent:!0})):this.originOnClick(ne,fe)},J.onMouseMove=function(ne,fe){this.updateUIClasses({mouse:Pe}),ne.feature_type==="point"?ne.point.updateCoordinate(fe.lngLat.lng,fe.lngLat.lat):this.originOnMouseMove(ne,fe)},J.onStop=function(ne){if("point"in ne)this.activateUIButton(),this.deleteFeature([ne.point.id],{silent:!0});else if("line"in ne||"polygon"in ne){var fe=ne.line||ne.polygon;if(this.updateUIClasses({mouse:ct}),Si(this),this.activateUIButton(),this.getFeature(fe.id)===void 0)return;fe.removeCoordinate(""+ne.currentVertexPosition),fe.isValid()&&(typeof ne.callBack=="function"?ne.callBack(fe.toGeoJSON()):this.map.fire("draw.passing-create",{features:[fe.toGeoJSON()]})),this.deleteFeature([fe.id],{silent:!0}),this.changeMode(dn.SIMPLE_SELECT,{},{silent:!0})}},J}Ua.dragMove=function(f,E){f.dragMoving=!0,E.originalEvent.stopPropagation();var k={lng:E.lngLat.lng-f.dragMoveLocation.lng,lat:E.lngLat.lat-f.dragMoveLocation.lat};Ms(this.getSelected(),k),this.getSelected().filter(function(G){return G.properties.isCircle}).map(function(G){return G.properties.center}).forEach(function(G){G[0]+=k.lng,G[1]+=k.lat}),f.dragMoveLocation=E.lngLat},Ua.toDisplayFeatures=function(f,E,k){E.properties.active=this.isSelected(E.properties.id)?In:tr,k(E),this.fireActionable(),E.properties.active===In&&E.geometry.type!==cn&&(E.properties.user_isCircle?ja(E):Yi(E)).forEach(k)};var ol=we(function(f,E){f.exports=function(){function k(rt,ie){if(!(rt instanceof ie))throw new TypeError("Cannot call a class as a function")}function G(rt,ie){for(var ge=0;ge<ie.length;ge++){var Re=ie[ge];Re.enumerable=Re.enumerable||!1,Re.configurable=!0,"value"in Re&&(Re.writable=!0),Object.defineProperty(rt,Re.key,Re)}}function Z(rt,ie,ge){return ie&&G(rt.prototype,ie),ge&&G(rt,ge),rt}/**
* splaytree v3.1.0
* Fast Splay tree for Node and browser
*
* @author Alexander Milevski <info@w8r.name>
* @license MIT
* @preserve
*/var J=function(rt,ie){this.next=null,this.key=rt,this.data=ie,this.left=null,this.right=null};function ne(rt,ie){return rt>ie?1:rt<ie?-1:0}function fe(rt,ie,ge){for(var Re=new J(null,null),$e=Re,tt=Re;;){var Ut=ge(rt,ie.key);if(Ut<0){if(ie.left===null)break;if(ge(rt,ie.left.key)<0){var Et=ie.left;if(ie.left=Et.right,Et.right=ie,(ie=Et).left===null)break}tt.left=ie,tt=ie,ie=ie.left}else{if(!(Ut>0)||ie.right===null||ge(rt,ie.right.key)>0&&(Et=ie.right,ie.right=Et.left,Et.left=ie,(ie=Et).right===null))break;$e.right=ie,$e=ie,ie=ie.right}}return $e.right=ie.left,tt.left=ie.right,ie.left=Re.right,ie.right=Re.left,ie}function ce(rt,ie,ge,Re){var $e=new J(rt,ie);if(ge===null)return $e.left=$e.right=null,$e;var tt=Re(rt,(ge=fe(rt,ge,Re)).key);return tt<0?($e.left=ge.left,$e.right=ge,ge.left=null):tt>=0&&($e.right=ge.right,$e.left=ge,ge.right=null),$e}function Se(rt,ie,ge){var Re=null,$e=null;if(ie){var tt=ge((ie=fe(rt,ie,ge)).key,rt);tt===0?(Re=ie.left,$e=ie.right):tt<0?($e=ie.right,ie.right=null,Re=ie):(Re=ie.left,ie.left=null,$e=ie)}return{left:Re,right:$e}}var _e=function(){function rt(ie){ie===void 0&&(ie=ne),this._root=null,this._size=0,this._comparator=ie}return rt.prototype.insert=function(ie,ge){return this._size++,this._root=ce(ie,ge,this._root,this._comparator)},rt.prototype.add=function(ie,ge){var Re=new J(ie,ge);this._root===null&&(Re.left=Re.right=null,this._size++,this._root=Re);var $e=this._comparator,tt=fe(ie,this._root,$e),Ut=$e(ie,tt.key);return Ut===0?this._root=tt:(Ut<0?(Re.left=tt.left,Re.right=tt,tt.left=null):Ut>0&&(Re.right=tt.right,Re.left=tt,tt.right=null),this._size++,this._root=Re),this._root},rt.prototype.remove=function(ie){this._root=this._remove(ie,this._root,this._comparator)},rt.prototype._remove=function(ie,ge,Re){var $e;return ge===null?null:Re(ie,(ge=fe(ie,ge,Re)).key)===0?(ge.left===null?$e=ge.right:($e=fe(ie,ge.left,Re)).right=ge.right,this._size--,$e):ge},rt.prototype.pop=function(){var ie=this._root;if(ie){for(;ie.left;)ie=ie.left;return this._root=fe(ie.key,this._root,this._comparator),this._root=this._remove(ie.key,this._root,this._comparator),{key:ie.key,data:ie.data}}return null},rt.prototype.findStatic=function(ie){for(var ge=this._root,Re=this._comparator;ge;){var $e=Re(ie,ge.key);if($e===0)return ge;ge=$e<0?ge.left:ge.right}return null},rt.prototype.find=function(ie){return this._root&&(this._root=fe(ie,this._root,this._comparator),this._comparator(ie,this._root.key)!==0)?null:this._root},rt.prototype.contains=function(ie){for(var ge=this._root,Re=this._comparator;ge;){var $e=Re(ie,ge.key);if($e===0)return!0;ge=$e<0?ge.left:ge.right}return!1},rt.prototype.forEach=function(ie,ge){for(var Re=this._root,$e=[],tt=!1;!tt;)Re!==null?($e.push(Re),Re=Re.left):$e.length!==0?(Re=$e.pop(),ie.call(ge,Re),Re=Re.right):tt=!0;return this},rt.prototype.range=function(ie,ge,Re,$e){for(var tt=[],Ut=this._comparator,Et=this._root;tt.length!==0||Et;)if(Et)tt.push(Et),Et=Et.left;else{if(Ut((Et=tt.pop()).key,ge)>0)break;if(Ut(Et.key,ie)>=0&&Re.call($e,Et))return this;Et=Et.right}return this},rt.prototype.keys=function(){var ie=[];return this.forEach(function(ge){var Re=ge.key;return ie.push(Re)}),ie},rt.prototype.values=function(){var ie=[];return this.forEach(function(ge){var Re=ge.data;return ie.push(Re)}),ie},rt.prototype.min=function(){return this._root?this.minNode(this._root).key:null},rt.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},rt.prototype.minNode=function(ie){if(ie===void 0&&(ie=this._root),ie)for(;ie.left;)ie=ie.left;return ie},rt.prototype.maxNode=function(ie){if(ie===void 0&&(ie=this._root),ie)for(;ie.right;)ie=ie.right;return ie},rt.prototype.at=function(ie){for(var ge=this._root,Re=!1,$e=0,tt=[];!Re;)if(ge)tt.push(ge),ge=ge.left;else if(tt.length>0){if(ge=tt.pop(),$e===ie)return ge;$e++,ge=ge.right}else Re=!0;return null},rt.prototype.next=function(ie){var ge=this._root,Re=null;if(ie.right){for(Re=ie.right;Re.left;)Re=Re.left;return Re}for(var $e=this._comparator;ge;){var tt=$e(ie.key,ge.key);if(tt===0)break;tt<0?(Re=ge,ge=ge.left):ge=ge.right}return Re},rt.prototype.prev=function(ie){var ge=this._root,Re=null;if(ie.left!==null){for(Re=ie.left;Re.right;)Re=Re.right;return Re}for(var $e=this._comparator;ge;){var tt=$e(ie.key,ge.key);if(tt===0)break;tt<0?ge=ge.left:(Re=ge,ge=ge.right)}return Re},rt.prototype.clear=function(){return this._root=null,this._size=0,this},rt.prototype.toList=function(){return function(ie){for(var ge=ie,Re=[],$e=!1,tt=new J(null,null),Ut=tt;!$e;)ge?(Re.push(ge),ge=ge.left):Re.length>0?ge=(ge=Ut=Ut.next=Re.pop()).right:$e=!0;return Ut.next=null,tt.next}(this._root)},rt.prototype.load=function(ie,ge,Re){ge===void 0&&(ge=[]),Re===void 0&&(Re=!1);var $e=ie.length,tt=this._comparator;if(Re&&function Et(Ct,tn,ln,hn,vn){if(!(ln>=hn)){for(var d=Ct[ln+hn>>1],t=ln-1,s=hn+1;;){do t++;while(vn(Ct[t],d)<0);do s--;while(vn(Ct[s],d)>0);if(t>=s)break;var p=Ct[t];Ct[t]=Ct[s],Ct[s]=p,p=tn[t],tn[t]=tn[s],tn[s]=p}Et(Ct,tn,ln,s,vn),Et(Ct,tn,s+1,hn,vn)}}(ie,ge,0,$e-1,tt),this._root===null)this._root=function Et(Ct,tn,ln,hn){var vn=hn-ln;if(vn>0){var d=ln+Math.floor(vn/2),t=Ct[d],s=tn[d],p=new J(t,s);return p.left=Et(Ct,tn,ln,d),p.right=Et(Ct,tn,d+1,hn),p}return null}(ie,ge,0,$e),this._size=$e;else{var Ut=function(Et,Ct,tn){for(var ln=new J(null,null),hn=ln,vn=Et,d=Ct;vn!==null&&d!==null;)tn(vn.key,d.key)<0?(hn.next=vn,vn=vn.next):(hn.next=d,d=d.next),hn=hn.next;return vn!==null?hn.next=vn:d!==null&&(hn.next=d),ln.next}(this.toList(),function(Et,Ct){for(var tn=new J(null,null),ln=tn,hn=0;hn<Et.length;hn++)ln=ln.next=new J(Et[hn],Ct[hn]);return ln.next=null,tn.next}(ie,ge),tt);$e=this._size+$e,this._root=function Et(Ct,tn,ln){var hn=ln-tn;if(hn>0){var vn=tn+Math.floor(hn/2),d=Et(Ct,tn,vn),t=Ct.head;return t.left=d,Ct.head=Ct.head.next,t.right=Et(Ct,vn+1,ln),t}return null}({head:Ut},0,$e)}return this},rt.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(rt.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(rt.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),rt.prototype.toString=function(ie){ie===void 0&&(ie=function(Re){return String(Re.key)});var ge=[];return function Re($e,tt,Ut,Et,Ct){if($e){Et(tt+(Ut?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+Ct($e)+`
`);var tn=tt+(Ut?"    ":"\u2502   ");$e.left&&Re($e.left,tn,!1,Et,Ct),$e.right&&Re($e.right,tn,!0,Et,Ct)}}(this._root,"",!0,function(Re){return ge.push(Re)},ie),ge.join("")},rt.prototype.update=function(ie,ge,Re){var $e=this._comparator,tt=Se(ie,this._root,$e),Ut=tt.left,Et=tt.right;$e(ie,ge)<0?Et=ce(ge,Re,Et,$e):Ut=ce(ge,Re,Ut,$e),this._root=function(Ct,tn,ln){return tn===null?Ct:(Ct===null||((tn=fe(Ct.key,tn,ln)).left=Ct),tn)}(Ut,Et,$e)},rt.prototype.split=function(ie){return Se(ie,this._root,this._comparator)},rt}(),De=function(rt,ie){return rt.ll.x<=ie.x&&ie.x<=rt.ur.x&&rt.ll.y<=ie.y&&ie.y<=rt.ur.y},Ge=function(rt,ie){if(ie.ur.x<rt.ll.x||rt.ur.x<ie.ll.x||ie.ur.y<rt.ll.y||rt.ur.y<ie.ll.y)return null;var ge=rt.ll.x<ie.ll.x?ie.ll.x:rt.ll.x,Re=rt.ur.x<ie.ur.x?rt.ur.x:ie.ur.x;return{ll:{x:ge,y:rt.ll.y<ie.ll.y?ie.ll.y:rt.ll.y},ur:{x:Re,y:rt.ur.y<ie.ur.y?rt.ur.y:ie.ur.y}}},Xe=Number.EPSILON;Xe===void 0&&(Xe=Math.pow(2,-52));var it=Xe*Xe,Zt=function(rt,ie){if(-Xe<rt&&rt<Xe&&-Xe<ie&&ie<Xe)return 0;var ge=rt-ie;return ge*ge<it*rt*ie?0:rt<ie?-1:1},Wt=function(){function rt(){k(this,rt),this.reset()}return Z(rt,[{key:"reset",value:function(){this.xRounder=new Nt,this.yRounder=new Nt}},{key:"round",value:function(ie,ge){return{x:this.xRounder.round(ie),y:this.yRounder.round(ge)}}}]),rt}(),Nt=function(){function rt(){k(this,rt),this.tree=new _e,this.round(0)}return Z(rt,[{key:"round",value:function(ie){var ge=this.tree.add(ie),Re=this.tree.prev(ge);if(Re!==null&&Zt(ge.key,Re.key)===0)return this.tree.remove(ie),Re.key;var $e=this.tree.next(ge);return $e!==null&&Zt(ge.key,$e.key)===0?(this.tree.remove(ie),$e.key):ie}}]),rt}(),Te=new Wt,qe=function(rt,ie){return rt.x*ie.y-rt.y*ie.x},wt=function(rt,ie){return rt.x*ie.x+rt.y*ie.y},pt=function(rt,ie,ge){var Re={x:ie.x-rt.x,y:ie.y-rt.y},$e={x:ge.x-rt.x,y:ge.y-rt.y},tt=qe(Re,$e);return Zt(tt,0)},Jt=function(rt){return Math.sqrt(wt(rt,rt))},en=function(rt,ie,ge){var Re={x:ie.x-rt.x,y:ie.y-rt.y},$e={x:ge.x-rt.x,y:ge.y-rt.y};return wt($e,Re)/Jt($e)/Jt(Re)},Ht=function(rt,ie,ge){return ie.y===0?null:{x:rt.x+ie.x/ie.y*(ge-rt.y),y:ge}},_n=function(rt,ie,ge){return ie.x===0?null:{x:ge,y:rt.y+ie.y/ie.x*(ge-rt.x)}},gn=function(){function rt(ie,ge){k(this,rt),ie.events===void 0?ie.events=[this]:ie.events.push(this),this.point=ie,this.isLeft=ge}return Z(rt,null,[{key:"compare",value:function(ie,ge){var Re=rt.comparePoints(ie.point,ge.point);return Re!==0?Re:(ie.point!==ge.point&&ie.link(ge),ie.isLeft!==ge.isLeft?ie.isLeft?1:-1:Kn.compare(ie.segment,ge.segment))}},{key:"comparePoints",value:function(ie,ge){return ie.x<ge.x?-1:ie.x>ge.x?1:ie.y<ge.y?-1:ie.y>ge.y?1:0}}]),Z(rt,[{key:"link",value:function(ie){if(ie.point===this.point)throw new Error("Tried to link already linked events");for(var ge=ie.point.events,Re=0,$e=ge.length;Re<$e;Re++){var tt=ge[Re];this.point.events.push(tt),tt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var ie=this.point.events.length,ge=0;ge<ie;ge++){var Re=this.point.events[ge];if(Re.segment.consumedBy===void 0)for(var $e=ge+1;$e<ie;$e++){var tt=this.point.events[$e];tt.consumedBy===void 0&&Re.otherSE.point.events===tt.otherSE.point.events&&Re.segment.consume(tt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var ie=[],ge=0,Re=this.point.events.length;ge<Re;ge++){var $e=this.point.events[ge];$e!==this&&!$e.segment.ringOut&&$e.segment.isInResult()&&ie.push($e)}return ie}},{key:"getLeftmostComparator",value:function(ie){var ge=this,Re=new Map,$e=function(tt){var Ut,Et,Ct,tn,ln,hn=tt.otherSE;Re.set(tt,{sine:(Ut=ge.point,Et=ie.point,Ct=hn.point,tn={x:Et.x-Ut.x,y:Et.y-Ut.y},ln={x:Ct.x-Ut.x,y:Ct.y-Ut.y},qe(ln,tn)/Jt(ln)/Jt(tn)),cosine:en(ge.point,ie.point,hn.point)})};return function(tt,Ut){Re.has(tt)||$e(tt),Re.has(Ut)||$e(Ut);var Et=Re.get(tt),Ct=Et.sine,tn=Et.cosine,ln=Re.get(Ut),hn=ln.sine,vn=ln.cosine;return Ct>=0&&hn>=0?tn<vn?1:tn>vn?-1:0:Ct<0&&hn<0?tn<vn?-1:tn>vn?1:0:hn<Ct?-1:hn>Ct?1:0}}}]),rt}(),Un=0,Kn=function(){function rt(ie,ge,Re,$e){k(this,rt),this.id=++Un,this.leftSE=ie,ie.segment=this,ie.otherSE=ge,this.rightSE=ge,ge.segment=this,ge.otherSE=ie,this.rings=Re,this.windings=$e}return Z(rt,null,[{key:"compare",value:function(ie,ge){var Re=ie.leftSE.point.x,$e=ge.leftSE.point.x,tt=ie.rightSE.point.x,Ut=ge.rightSE.point.x;if(Ut<Re)return 1;if(tt<$e)return-1;var Et=ie.leftSE.point.y,Ct=ge.leftSE.point.y,tn=ie.rightSE.point.y,ln=ge.rightSE.point.y;if(Re<$e){if(Ct<Et&&Ct<tn)return 1;if(Ct>Et&&Ct>tn)return-1;var hn=ie.comparePoint(ge.leftSE.point);if(hn<0)return 1;if(hn>0)return-1;var vn=ge.comparePoint(ie.rightSE.point);return vn!==0?vn:-1}if(Re>$e){if(Et<Ct&&Et<ln)return-1;if(Et>Ct&&Et>ln)return 1;var d=ge.comparePoint(ie.leftSE.point);if(d!==0)return d;var t=ie.comparePoint(ge.rightSE.point);return t<0?1:t>0?-1:1}if(Et<Ct)return-1;if(Et>Ct)return 1;if(tt<Ut){var s=ge.comparePoint(ie.rightSE.point);if(s!==0)return s}if(tt>Ut){var p=ie.comparePoint(ge.rightSE.point);if(p<0)return 1;if(p>0)return-1}if(tt!==Ut){var x=tn-Et,S=tt-Re,z=ln-Ct,B=Ut-$e;if(x>S&&z<B)return 1;if(x<S&&z>B)return-1}return tt>Ut?1:tt<Ut||tn<ln?-1:tn>ln?1:ie.id<ge.id?-1:ie.id>ge.id?1:0}}]),Z(rt,[{key:"replaceRightSE",value:function(ie){this.rightSE=ie,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var ie=this.leftSE.point.y,ge=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:ie<ge?ie:ge},ur:{x:this.rightSE.point.x,y:ie>ge?ie:ge}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(ie){return ie.x===this.leftSE.point.x&&ie.y===this.leftSE.point.y||ie.x===this.rightSE.point.x&&ie.y===this.rightSE.point.y}},{key:"comparePoint",value:function(ie){if(this.isAnEndpoint(ie))return 0;var ge=this.leftSE.point,Re=this.rightSE.point,$e=this.vector();if(ge.x===Re.x)return ie.x===ge.x?0:ie.x<ge.x?1:-1;var tt=(ie.y-ge.y)/$e.y,Ut=ge.x+tt*$e.x;if(ie.x===Ut)return 0;var Et=(ie.x-ge.x)/$e.x,Ct=ge.y+Et*$e.y;return ie.y===Ct?0:ie.y<Ct?-1:1}},{key:"getIntersection",value:function(ie){var ge=this.bbox(),Re=ie.bbox(),$e=Ge(ge,Re);if($e===null)return null;var tt=this.leftSE.point,Ut=this.rightSE.point,Et=ie.leftSE.point,Ct=ie.rightSE.point,tn=De(ge,Et)&&this.comparePoint(Et)===0,ln=De(Re,tt)&&ie.comparePoint(tt)===0,hn=De(ge,Ct)&&this.comparePoint(Ct)===0,vn=De(Re,Ut)&&ie.comparePoint(Ut)===0;if(ln&&tn)return vn&&!hn?Ut:!vn&&hn?Ct:null;if(ln)return hn&&tt.x===Ct.x&&tt.y===Ct.y?null:tt;if(tn)return vn&&Ut.x===Et.x&&Ut.y===Et.y?null:Et;if(vn&&hn)return null;if(vn)return Ut;if(hn)return Ct;var d=function(t,s,p,x){if(s.x===0)return _n(p,x,t.x);if(x.x===0)return _n(t,s,p.x);if(s.y===0)return Ht(p,x,t.y);if(x.y===0)return Ht(t,s,p.y);var S=qe(s,x);if(S==0)return null;var z={x:p.x-t.x,y:p.y-t.y},B=qe(z,s)/S,V=qe(z,x)/S;return{x:(t.x+V*s.x+(p.x+B*x.x))/2,y:(t.y+V*s.y+(p.y+B*x.y))/2}}(tt,this.vector(),Et,ie.vector());return d===null?null:De($e,d)?Te.round(d.x,d.y):null}},{key:"split",value:function(ie){var ge=[],Re=ie.events!==void 0,$e=new gn(ie,!0),tt=new gn(ie,!1),Ut=this.rightSE;this.replaceRightSE(tt),ge.push(tt),ge.push($e);var Et=new rt($e,Ut,this.rings.slice(),this.windings.slice());return gn.comparePoints(Et.leftSE.point,Et.rightSE.point)>0&&Et.swapEvents(),gn.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),Re&&($e.checkForConsuming(),tt.checkForConsuming()),ge}},{key:"swapEvents",value:function(){var ie=this.rightSE;this.rightSE=this.leftSE,this.leftSE=ie,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var ge=0,Re=this.windings.length;ge<Re;ge++)this.windings[ge]*=-1}},{key:"consume",value:function(ie){for(var ge=this,Re=ie;ge.consumedBy;)ge=ge.consumedBy;for(;Re.consumedBy;)Re=Re.consumedBy;var $e=rt.compare(ge,Re);if($e!==0){if($e>0){var tt=ge;ge=Re,Re=tt}if(ge.prev===Re){var Ut=ge;ge=Re,Re=Ut}for(var Et=0,Ct=Re.rings.length;Et<Ct;Et++){var tn=Re.rings[Et],ln=Re.windings[Et],hn=ge.rings.indexOf(tn);hn===-1?(ge.rings.push(tn),ge.windings.push(ln)):ge.windings[hn]+=ln}Re.rings=null,Re.windings=null,Re.consumedBy=ge,Re.leftSE.consumedBy=ge.leftSE,Re.rightSE.consumedBy=ge.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(this.prev){var ie=this.prev.consumedBy||this.prev;this._beforeState=ie.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var ie=this.beforeState();this._afterState={rings:ie.rings.slice(0),windings:ie.windings.slice(0),multiPolys:[]};for(var ge=this._afterState.rings,Re=this._afterState.windings,$e=this._afterState.multiPolys,tt=0,Ut=this.rings.length;tt<Ut;tt++){var Et=this.rings[tt],Ct=this.windings[tt],tn=ge.indexOf(Et);tn===-1?(ge.push(Et),Re.push(Ct)):Re[tn]+=Ct}for(var ln=[],hn=[],vn=0,d=ge.length;vn<d;vn++)if(Re[vn]!==0){var t=ge[vn],s=t.poly;if(hn.indexOf(s)===-1)if(t.isExterior)ln.push(s);else{hn.indexOf(s)===-1&&hn.push(s);var p=ln.indexOf(t.poly);p!==-1&&ln.splice(p,1)}}for(var x=0,S=ln.length;x<S;x++){var z=ln[x].multiPoly;$e.indexOf(z)===-1&&$e.push(z)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var ie=this.beforeState().multiPolys,ge=this.afterState().multiPolys;switch(Tr.type){case"union":var Re=ie.length===0,$e=ge.length===0;this._isInResult=Re!==$e;break;case"intersection":var tt,Ut;ie.length<ge.length?(tt=ie.length,Ut=ge.length):(tt=ge.length,Ut=ie.length),this._isInResult=Ut===Tr.numMultiPolys&&tt<Ut;break;case"xor":var Et=Math.abs(ie.length-ge.length);this._isInResult=Et%2==1;break;case"difference":var Ct=function(tn){return tn.length===1&&tn[0].isSubject};this._isInResult=Ct(ie)!==Ct(ge);break;default:throw new Error("Unrecognized operation type found ".concat(Tr.type))}return this._isInResult}}],[{key:"fromRing",value:function(ie,ge,Re){var $e,tt,Ut,Et=gn.comparePoints(ie,ge);if(Et<0)$e=ie,tt=ge,Ut=1;else{if(!(Et>0))throw new Error("Tried to create degenerate segment at [".concat(ie.x,", ").concat(ie.y,"]"));$e=ge,tt=ie,Ut=-1}return new rt(new gn($e,!0),new gn(tt,!1),[Re],[Ut])}}]),rt}(),Tn=function(){function rt(ie,ge,Re){if(k(this,rt),!Array.isArray(ie)||ie.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=ge,this.isExterior=Re,this.segments=[],typeof ie[0][0]!="number"||typeof ie[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var $e=Te.round(ie[0][0],ie[0][1]);this.bbox={ll:{x:$e.x,y:$e.y},ur:{x:$e.x,y:$e.y}};for(var tt=$e,Ut=1,Et=ie.length;Ut<Et;Ut++){if(typeof ie[Ut][0]!="number"||typeof ie[Ut][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Ct=Te.round(ie[Ut][0],ie[Ut][1]);Ct.x===tt.x&&Ct.y===tt.y||(this.segments.push(Kn.fromRing(tt,Ct,this)),Ct.x<this.bbox.ll.x&&(this.bbox.ll.x=Ct.x),Ct.y<this.bbox.ll.y&&(this.bbox.ll.y=Ct.y),Ct.x>this.bbox.ur.x&&(this.bbox.ur.x=Ct.x),Ct.y>this.bbox.ur.y&&(this.bbox.ur.y=Ct.y),tt=Ct)}$e.x===tt.x&&$e.y===tt.y||this.segments.push(Kn.fromRing(tt,$e,this))}return Z(rt,[{key:"getSweepEvents",value:function(){for(var ie=[],ge=0,Re=this.segments.length;ge<Re;ge++){var $e=this.segments[ge];ie.push($e.leftSE),ie.push($e.rightSE)}return ie}}]),rt}(),fr=function(){function rt(ie,ge){if(k(this,rt),!Array.isArray(ie))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Tn(ie[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var Re=1,$e=ie.length;Re<$e;Re++){var tt=new Tn(ie[Re],this,!1);tt.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=tt.bbox.ll.x),tt.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=tt.bbox.ll.y),tt.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=tt.bbox.ur.x),tt.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=tt.bbox.ur.y),this.interiorRings.push(tt)}this.multiPoly=ge}return Z(rt,[{key:"getSweepEvents",value:function(){for(var ie=this.exteriorRing.getSweepEvents(),ge=0,Re=this.interiorRings.length;ge<Re;ge++)for(var $e=this.interiorRings[ge].getSweepEvents(),tt=0,Ut=$e.length;tt<Ut;tt++)ie.push($e[tt]);return ie}}]),rt}(),ni=function(){function rt(ie,ge){if(k(this,rt),!Array.isArray(ie))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof ie[0][0][0]=="number"&&(ie=[ie])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var Re=0,$e=ie.length;Re<$e;Re++){var tt=new fr(ie[Re],this);tt.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=tt.bbox.ll.x),tt.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=tt.bbox.ll.y),tt.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=tt.bbox.ur.x),tt.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=tt.bbox.ur.y),this.polys.push(tt)}this.isSubject=ge}return Z(rt,[{key:"getSweepEvents",value:function(){for(var ie=[],ge=0,Re=this.polys.length;ge<Re;ge++)for(var $e=this.polys[ge].getSweepEvents(),tt=0,Ut=$e.length;tt<Ut;tt++)ie.push($e[tt]);return ie}}]),rt}(),Li=function(){function rt(ie){k(this,rt),this.events=ie;for(var ge=0,Re=ie.length;ge<Re;ge++)ie[ge].segment.ringOut=this;this.poly=null}return Z(rt,null,[{key:"factory",value:function(ie){for(var ge=[],Re=0,$e=ie.length;Re<$e;Re++){var tt=ie[Re];if(tt.isInResult()&&!tt.ringOut){for(var Ut=null,Et=tt.leftSE,Ct=tt.rightSE,tn=[Et],ln=Et.point,hn=[];Ut=Et,Et=Ct,tn.push(Et),Et.point!==ln;)for(;;){var vn=Et.getAvailableLinkedEvents();if(vn.length===0){var d=tn[0].point,t=tn[tn.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(d.x,",")+" ".concat(d.y,"]. Last matching segment found ends at")+" [".concat(t.x,", ").concat(t.y,"]."))}if(vn.length===1){Ct=vn[0].otherSE;break}for(var s=null,p=0,x=hn.length;p<x;p++)if(hn[p].point===Et.point){s=p;break}if(s===null){hn.push({index:tn.length,point:Et.point});var S=Et.getLeftmostComparator(Ut);Ct=vn.sort(S)[0].otherSE;break}var z=hn.splice(s)[0],B=tn.splice(z.index);B.unshift(B[0].otherSE),ge.push(new rt(B.reverse()))}ge.push(new rt(tn))}}return ge}}]),Z(rt,[{key:"getGeom",value:function(){for(var ie=this.events[0].point,ge=[ie],Re=1,$e=this.events.length-1;Re<$e;Re++){var tt=this.events[Re].point,Ut=this.events[Re+1].point;pt(tt,ie,Ut)!==0&&(ge.push(tt),ie=tt)}if(ge.length===1)return null;var Et=ge[0],Ct=ge[1];pt(Et,ie,Ct)===0&&ge.shift(),ge.push(ge[0]);for(var tn=this.isExteriorRing()?1:-1,ln=this.isExteriorRing()?0:ge.length-1,hn=this.isExteriorRing()?ge.length:-1,vn=[],d=ln;d!=hn;d+=tn)vn.push([ge[d].x,ge[d].y]);return vn}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var ie=this.enclosingRing();this._isExteriorRing=!ie||!ie.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var ie=this.events[0],ge=1,Re=this.events.length;ge<Re;ge++){var $e=this.events[ge];gn.compare(ie,$e)>0&&(ie=$e)}for(var tt=ie.segment.prevInResult(),Ut=tt?tt.prevInResult():null;;){if(!tt)return null;if(!Ut)return tt.ringOut;if(Ut.ringOut!==tt.ringOut)return Ut.ringOut.enclosingRing()!==tt.ringOut?tt.ringOut:tt.ringOut.enclosingRing();tt=Ut.prevInResult(),Ut=tt?tt.prevInResult():null}}}]),rt}(),ci=function(){function rt(ie){k(this,rt),this.exteriorRing=ie,ie.poly=this,this.interiorRings=[]}return Z(rt,[{key:"addInterior",value:function(ie){this.interiorRings.push(ie),ie.poly=this}},{key:"getGeom",value:function(){var ie=[this.exteriorRing.getGeom()];if(ie[0]===null)return null;for(var ge=0,Re=this.interiorRings.length;ge<Re;ge++){var $e=this.interiorRings[ge].getGeom();$e!==null&&ie.push($e)}return ie}}]),rt}(),Cr=function(){function rt(ie){k(this,rt),this.rings=ie,this.polys=this._composePolys(ie)}return Z(rt,[{key:"getGeom",value:function(){for(var ie=[],ge=0,Re=this.polys.length;ge<Re;ge++){var $e=this.polys[ge].getGeom();$e!==null&&ie.push($e)}return ie}},{key:"_composePolys",value:function(ie){for(var ge=[],Re=0,$e=ie.length;Re<$e;Re++){var tt=ie[Re];if(!tt.poly)if(tt.isExteriorRing())ge.push(new ci(tt));else{var Ut=tt.enclosingRing();Ut.poly||ge.push(new ci(Ut)),Ut.poly.addInterior(tt)}}return ge}}]),rt}(),Di=function(){function rt(ie){var ge=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kn.compare;k(this,rt),this.queue=ie,this.tree=new _e(ge),this.segments=[]}return Z(rt,[{key:"process",value:function(ie){var ge=ie.segment,Re=[];if(ie.consumedBy)return ie.isLeft?this.queue.remove(ie.otherSE):this.tree.remove(ge),Re;var $e=ie.isLeft?this.tree.insert(ge):this.tree.find(ge);if(!$e)throw new Error("Unable to find segment #".concat(ge.id," ")+"[".concat(ge.leftSE.point.x,", ").concat(ge.leftSE.point.y,"] -> ")+"[".concat(ge.rightSE.point.x,", ").concat(ge.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var tt=$e,Ut=$e,Et=void 0,Ct=void 0;Et===void 0;)(tt=this.tree.prev(tt))===null?Et=null:tt.key.consumedBy===void 0&&(Et=tt.key);for(;Ct===void 0;)(Ut=this.tree.next(Ut))===null?Ct=null:Ut.key.consumedBy===void 0&&(Ct=Ut.key);if(ie.isLeft){var tn=null;if(Et){var ln=Et.getIntersection(ge);if(ln!==null&&(ge.isAnEndpoint(ln)||(tn=ln),!Et.isAnEndpoint(ln)))for(var hn=this._splitSafely(Et,ln),vn=0,d=hn.length;vn<d;vn++)Re.push(hn[vn])}var t=null;if(Ct){var s=Ct.getIntersection(ge);if(s!==null&&(ge.isAnEndpoint(s)||(t=s),!Ct.isAnEndpoint(s)))for(var p=this._splitSafely(Ct,s),x=0,S=p.length;x<S;x++)Re.push(p[x])}if(tn!==null||t!==null){var z=null;z=tn===null?t:t===null||gn.comparePoints(tn,t)<=0?tn:t,this.queue.remove(ge.rightSE),Re.push(ge.rightSE);for(var B=ge.split(z),V=0,$=B.length;V<$;V++)Re.push(B[V])}Re.length>0?(this.tree.remove(ge),Re.push(ie)):(this.segments.push(ge),ge.prev=Et)}else{if(Et&&Ct){var H=Et.getIntersection(Ct);if(H!==null){if(!Et.isAnEndpoint(H))for(var re=this._splitSafely(Et,H),se=0,me=re.length;se<me;se++)Re.push(re[se]);if(!Ct.isAnEndpoint(H))for(var ae=this._splitSafely(Ct,H),ue=0,Le=ae.length;ue<Le;ue++)Re.push(ae[ue])}}this.tree.remove(ge)}return Re}},{key:"_splitSafely",value:function(ie,ge){this.tree.remove(ie);var Re=ie.rightSE;this.queue.remove(Re);var $e=ie.split(ge);return $e.push(Re),ie.consumedBy===void 0&&this.tree.insert(ie),$e}}]),rt}(),mr=I!==void 0&&I.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Vs=I!==void 0&&I.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Tr=new(function(){function rt(){k(this,rt)}return Z(rt,[{key:"run",value:function(ie,ge,Re){Tr.type=ie,Te.reset();for(var $e=[new ni(ge,!0)],tt=0,Ut=Re.length;tt<Ut;tt++)$e.push(new ni(Re[tt],!1));if(Tr.numMultiPolys=$e.length,Tr.type==="difference")for(var Et=$e[0],Ct=1;Ct<$e.length;)Ge($e[Ct].bbox,Et.bbox)!==null?Ct++:$e.splice(Ct,1);if(Tr.type==="intersection"){for(var tn=0,ln=$e.length;tn<ln;tn++)for(var hn=$e[tn],vn=tn+1,d=$e.length;vn<d;vn++)if(Ge(hn.bbox,$e[vn].bbox)===null)return[]}for(var t=new _e(gn.compare),s=0,p=$e.length;s<p;s++)for(var x=$e[s].getSweepEvents(),S=0,z=x.length;S<z;S++)if(t.insert(x[S]),t.size>mr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var B=new Di(t),V=t.size,$=t.pop();$;){var H=$.key;if(t.size===V){var re=H.segment;throw new Error("Unable to pop() ".concat(H.isLeft?"left":"right"," SweepEvent ")+"[".concat(H.point.x,", ").concat(H.point.y,"] from segment #").concat(re.id," ")+"[".concat(re.leftSE.point.x,", ").concat(re.leftSE.point.y,"] -> ")+"[".concat(re.rightSE.point.x,", ").concat(re.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(t.size>mr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(B.segments.length>Vs)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var se=B.process(H),me=0,ae=se.length;me<ae;me++){var ue=se[me];ue.consumedBy===void 0&&t.insert(ue)}V=t.size,$=t.pop()}Te.reset();var Le=Li.factory(B.segments);return new Cr(Le).getGeom()}}]),rt}());return{union:function(rt){for(var ie=arguments,ge=arguments.length,Re=new Array(ge>1?ge-1:0),$e=1;$e<ge;$e++)Re[$e-1]=ie[$e];return Tr.run("union",rt,Re)},intersection:function(rt){for(var ie=arguments,ge=arguments.length,Re=new Array(ge>1?ge-1:0),$e=1;$e<ge;$e++)Re[$e-1]=ie[$e];return Tr.run("intersection",rt,Re)},xor:function(rt){for(var ie=arguments,ge=arguments.length,Re=new Array(ge>1?ge-1:0),$e=1;$e<ge;$e++)Re[$e-1]=ie[$e];return Tr.run("xor",rt,Re)},difference:function(rt){for(var ie=arguments,ge=arguments.length,Re=new Array(ge>1?ge-1:0),$e=1;$e<ge;$e++)Re[$e-1]=ie[$e];return Tr.run("difference",rt,Re)}}}()});function qi(f,E,k){k===void 0&&(k={});var G={type:"Feature"};return(k.id===0||k.id)&&(G.id=k.id),k.bbox&&(G.bbox=k.bbox),G.properties=E||{},G.geometry=f,G}function vs(f,E){var k=eo(f),G=eo(E),Z=f.properties||{},J=ol.difference(k.coordinates,G.coordinates);return J.length===0?null:J.length===1?function(ne,fe,ce){ce===void 0&&(ce={});for(var Se=0,_e=ne;Se<_e.length;Se++){var De=_e[Se];if(De.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var Ge=0;Ge<De[De.length-1].length;Ge++)if(De[De.length-1][Ge]!==De[0][Ge])throw new Error("First and last Position are not equivalent.")}return qi({type:"Polygon",coordinates:ne},fe,ce)}(J[0],Z):function(ne,fe,ce){return ce===void 0&&(ce={}),qi({type:"MultiPolygon",coordinates:ne},fe,ce)}(J,Z)}var Tl={onSetup:function(){var f=this.getSelected().filter(function(E){return E.type==="Polygon"||E.type==="MultiPolygon"}).map(function(E){return E.toGeoJSON()});if(f.length<1)throw new Error("Please select a feature/features (Polygon or MultiPolygon) to split!");return{main:f}},toDisplayFeatures:function(f,E,k){var G=this;k(E),this.changeMode("passing_mode_polygon",function(Z){f.main.forEach(function(J,ne){if(J.geometry.type===nn||J.geometry.type===An){var fe=vs(J,Z),ce=G.newFeature(fe);ce.id=J.id,G.addFeature(ce)}else console.info("The feature is not Polygon/MultiPolygon!")})})}},Na=function(f,E){var k={options:f=function(J){J===void 0&&(J={});var ne=Ie(J);return J.controls||(ne.controls={}),J.displayControlsDefault===!1?ne.controls=Ie(Ya,J.controls):ne.controls=Ie(Po,J.controls),(ne=Ie(Sl,ne)).styles=is(ne.styles,"cold",J).concat(is(ne.styles,"hot",J)),ne}(f)};E=Co(k,E),k.api=E;var G=je(k);if(E.undo=G.undoHistory,E.redo=G.redoHistory,E.onAdd=G.onAdd,E.onRemove=G.onRemove,E.types=Rt,E.options=f,f.api)for(var Z in f.api)E[Z]=f.api[Z];return E},sl=Object.assign({},Ri,{draw_point:Do,draw_polygon:Pi,draw_line_string:zo,draw_circle:Ai,draw_rectangle:Ci,direct_select:Ur,simple_select:Ua,splitLineMode:Fa,cutPolygonMode:Tl,passing_mode_line_string:ki(Ri.draw_line_string),passing_mode_polygon:ki(Ri.draw_polygon)});function Ga(){return{modes:sl,styles:ys,userProperties:!0,snap:!0,snapOptions:{snapPx:15,snapToMidPoints:!1,snapVertexPriorityDistance:1.25},guides:!0,addControls:js,controls:Us}}function ya(f){f===void 0&&(f={});var E=Ga(),k=Object.assign({},E,f);if(f.addControls){for(var G=0,Z=f.addControls;G<Z.length;G+=1){var J=Z[G];f.controls&&f.controls[J.id]===!1||(k.controls[J.id]=!0)}k.addControls=[].concat(E.addControls);for(var ne=0,fe=f.addControls;ne<fe.length;ne+=1){for(var ce=fe[ne],Se=!1,_e=0;_e<E.addControls.length;_e++)if(E.addControls[_e].id==ce.id){Se=!0;break}Se||k.addControls.push(ce)}}f.api&&f.api.getSnapFeatures&&(k.api=k.api||{},k.api.getSnapFeatures=f.api.getSnapFeatures),k.styleId||(k.styleId="_"+Math.floor(65535*Math.random()).toString(32)),Na(k,this)}function io(f,E,k){return k===void 0&&(k={}),new Promise(function(G,Z){f.setIsInteracting(!0),k.isActionDrawMode=!0;var J=new ya(k);f.addControl(J,"top-left"),J.changeMode(E);var ne=null,fe=function(De){De.styleId==J.options.styleId&&(ne=De)},ce=function(De){De.styleId==J.options.styleId&&(_e(),ne?(f.setIsInteracting(!1),G(ne)):(setTimeout(function(){return f.setIsInteracting(!1)},500),G(Object.assign({},ne,{cancel:!0}))))},Se=function(De){De.styleId==J.options.styleId&&typeof k.updatecoordinate=="function"&&k.updatecoordinate(De)},_e=function(){f.off("draw.create",fe),f.off("draw.modechange",ce),f.off("draw.updatecoordinate",Se),f.removeControl(J)};f.on("draw.create",fe),f.on("draw.modechange",ce),f.on("draw.updatecoordinate",Se)})}l.SnapLineMode=zo,l.SnapModeDrawStyles=ys,l.SnapPointMode=Do,l.SnapPolygonMode=Pi,l.SnapRectangleMode=Ci,l.Tool=ya,l.actionDraw=io,l.actionDrawCircle=function(f,E){return E===void 0&&(E={}),io(f,"draw_circle",E)},l.actionDrawLineSting=function(f,E){return E===void 0&&(E={}),io(f,"draw_line_string",E)},l.actionDrawPoint=function(f,E){return E===void 0&&(E={}),io(f,"draw_point",E)},l.actionDrawPolygon=function(f,E){return E===void 0&&(E={}),io(f,"draw_polygon",E)},l.actionDrawRectangle=function(f,E){return E===void 0&&(E={}),io(f,"draw_rectangle",E)},l.defaultOptions=Ga,l.modes=sl,Object.defineProperty(l,"__esModule",{value:!0})});const a=Object.assign({},g);w.Draw=a}).call(this,U(170),U(31))},function(he,w){var U;U=function(){return this}();try{U=U||new Function("return this")()}catch{typeof window=="object"&&(U=window)}he.exports=U}])})})(vjmap_min$1);var vjmap=getDefaultExportFromCjs(vjmap_min$1.exports),vjmap_min="",Blueprint_vue_vue_type_style_index_0_lang="";const _hoisted_1={id:"map-container"},_sfc_main=defineComponent({setup(he){let w=null;return onMounted(async function(){const I={serviceUrl:"https://vjmap.com/server/api/v1",accessToken:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJJRCI6MSwiVXNlcm5hbWUiOiJyb290MSIsIk5pY2tOYW1lIjoicm9vdDEiLCJBdXRob3JpdHlJZCI6InJvb3QiLCJCdWZmZXJUaW1lIjo4NjQwMCwiZXhwIjoxOTQyMzA1MjQxLCJpc3MiOiJ2am1hcCIsIm5iZiI6MTYyNjk0NDI0MX0.29OAA4Cnjtw780VxIxWqduLtszp1EtpSNHAmWjiL_OM",exampleMapId:"sys_zp"};let g=new vjmap.Service(I.serviceUrl,I.accessToken),a=await g.openMap({mapid:"teethee",mapopenway:vjmap.MapOpenWay.GeomRender,style:vjmap.openMapDarkStyle()});if(a.error){console.error(a.error);return}let l=vjmap.GeoBounds.fromString(a.bounds),n=new vjmap.GeoProjection(l);w=new vjmap.Map({container:"map-container",style:g.vectorStyle(),center:n.toLngLat(l.center()),zoom:1,pitch:0,renderWorldCopies:!1}),w.attach(g,n),w.fitMapBounds(),await w.onLoad()}),(O,I)=>(openBlock(),createElementBlock("div",_hoisted_1))}}),TaskCard=Object.assign(_sfc_main$3,{install(he){he.component(_sfc_main$3.name,_sfc_main$3)}}),TaskInfo=Object.assign(_sfc_main$1,{install(he){he.component(_sfc_main$1.name,_sfc_main$1)}}),Blueprint=Object.assign(_sfc_main,{install(he){he.component(_sfc_main.name,_sfc_main)}});var display="";export{TaskCard as T,TaskInfo as a};
