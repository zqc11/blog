import{_ as V,n as g,w as H,u as P,o as W,N as z,D as K}from"./index.7e89e680.js";import{b as A}from"./ui.35468af9.js";/* empty css                   */import{d as x,o as v,z as D,A as d,h as i,r as l,a2 as X,e as t,w as u,V as Y,b as G,be as B,H as J,D as m,J as q,K as Q}from"./element-plus.5e3a2ffc.js";import{_ as Z}from"./plugin-vue_export-helper.98d5223b.js";import"./vform3-plus.79b63deb.js";const ee=x({name:"UploadFilled"}),oe={class:"icon",width:"200",height:"200",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},se=d("path",{fill:"currentColor",d:"M544 864V672h128L512 480 352 672h128v192H320v-1.6c-5.376.32-10.496 1.6-16 1.6A240 240 0 0164 624c0-123.136 93.12-223.488 212.608-237.248A239.808 239.808 0 01512 192a239.872 239.872 0 01235.456 194.752c119.488 13.76 212.48 114.112 212.48 237.248a240 240 0 01-240 240c-5.376 0-10.56-1.28-16-1.6v1.6H544z"},null,-1),ae=[se];function te(c,y,h,r,a,n){return v(),D("svg",oe,ae)}var ue=Z(ee,[["render",te]]);const R=c=>(q("data-v-6c9ac6ee"),c=c(),Q(),c),ne=m("\u6E05\u7A7A"),le=m("\u63D0\u4EA4\u56FE\u7EB8"),ce=R(()=>d("div",{class:"el-upload__text"},[m(" \u62D6\u653E\u6587\u4EF6 \u6216 "),d("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1)),re=R(()=>d("div",{class:"el-upload__tip"},"\u652F\u6301 AutoCAD \u7684 dwg \u548C dxf \u6587\u4EF6\u7C7B\u578B",-1)),de=x({setup(c){const{VITE_PROXY_DOMAIN:y,VITE_PROXY_DOMAIN_REAL:h}=K(),r=i(!1),a=i([]),n=i([]),p=g().GET_CURRENT_TASK(),E=i(),_=H(),C=P(),b=h+"/multiUpload";let w=new W.Service(_.serviceUrl,_.accessToken);const I=e=>{if(e.status==="ready"){const o=e.name.endsWith(".dwg");a.value.push(e),o&&n.value.push(e)}},k=e=>{const o=e.name.endsWith(".dwg");a.value.splice(a.value.indexOf(e),1),o&&n.value.splice(n.value.indexOf(e),1)},T=(e,o)=>{B.error("\u6587\u4EF6\uFF1A"+o.name+" \u8FC7\u5927\u4E0A\u4F20\u5931\u8D25")},N=()=>{a.value=[],n.value=[]},$=()=>{r.value=!0,n.value.forEach(async e=>{await j(e)}),a.value.forEach(e=>{const o=e.name.endsWith(".pdf"),s={filename:e.name,location:"",type:"pdf"};o&&F(s)}),E.value.submit(),r.value=!1,g().SET_CURRENT_BLUEPRINT(p.blueprints[0]),C.push("/taskInfo")},j=async e=>{if(!!e)try{let o=await w.uploadMap(e.raw);const s=await w.openMap(o);if(s.error)A("\u6253\u5F00\u56FE\u5F62\u5931\u8D25!",s.error);else{_.addMyMapId(o.mapid);const f={filename:o.uploadname,location:o.mapid,type:"dwg"};F(f)}}catch(o){r.value=!1,A("\u4E0A\u4F20\u56FE\u5F62\u5931\u8D25!",o)}},F=e=>{const o={taskId:p.id,blueprint:e};z(o).then(s=>{s.success&&(B.success("\u63D0\u4EA4\u6210\u529F"),p.blueprints.push(e))})};return(e,o)=>{const s=l("el-button"),f=l("el-col"),M=l("el-row"),S=l("el-divider"),U=l("el-icon"),L=l("el-upload"),O=X("loading");return v(),D("div",null,[t(M,{justify:"end"},{default:u(()=>[t(f,null,{default:u(()=>[t(s,{onClick:N},{default:u(()=>[ne]),_:1}),t(s,{type:"primary",onClick:$},{default:u(()=>[le]),_:1})]),_:1})]),_:1}),t(S),Y((v(),G(L,{class:"uploadfile-wrapper",drag:"",multiple:"",ref_key:"uploadRef",ref:E,accept:".dwg, .dxf, .pdf",action:b,"on-change":I,"on-remove":k,"on-error":T,"auto-upload":!1,"file-list":a.value,"element-loading-text":"\u6B63\u5728\u4E0A\u4F20,\u8BF7\u7A0D\u4FAF..."},{tip:u(()=>[re]),default:u(()=>[t(U,{class:"el-icon--upload",color:"#0000ff"},{default:u(()=>[t(J(ue))]),_:1}),ce]),_:1},8,["file-list"])),[[O,r.value]])])}}});var Ee=V(de,[["__scopeId","data-v-6c9ac6ee"]]);export{Ee as default};
